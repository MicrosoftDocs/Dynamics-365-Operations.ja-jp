---
title: "アップグレード切替テスト"
description: "このトピックでは、Dynamics 365 for Finance and Operations, Enterprise edition をオンにする前に、AX 2012 をオフにした後に発生するタスクをテストする方法について説明します。"
author: tariqbell
manager: AnnBe
ms.date: 05/29/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Developer, IT Pro
ms.reviewer: margoc
ms.search.scope: Operations, UnifiedOperations, Platform
ms.search.region: Global
ms.author: tabell
ms.search.validFrom: 2017-06-16
ms.dyn365.ops.version: Platform update 8
ms.translationtype: Human Translation
ms.sourcegitcommit: 6816e3820ab77c71bbf9bde4a068375448331671
ms.openlocfilehash: 711ad5cc3aafacf209704349effb4e08019205ac
ms.contentlocale: ja-jp
ms.lasthandoff: 06/15/2017

---

# <a name="upgrade-cutover-testing"></a>アップグレード切替テスト

[!include[banner](../includes/banner.md)]

[!include[upgrade banner](../includes/upgrade-banner.md)]

*切替*という用語は、新しいシステムを稼働させる最後のプロセスに使用します。 この切替プロセスは、Microsoft Dynamics AX 2012 がオフになってから、Microsoft Dynamics 365 for Finance and Operations, Enterprise edition をオンにする前に発生するタスクで構成されます。 アップグレード切替テストの目的は、切替プロセスを練習することで、実際の切替中に関係するすべての人がスムーズに作業できるようにすることです。

切替中には、2 つの主要なワーク ストリームがあります。

- **技術的なワーク ストリーム** – このワーク ストリームには、データ アップグレードの実行プロセスが含まれています。 業務では、許可されているダウンタイムの金額に制限が適用されます。 ダウンタイムの間は、AX 2012 または Finance and Operations のいずれも利用できません。 このワーク ストリームでは、業務でのダウンタイム制限を満たすために、データ アップグレード手順をチューニングする必要があります。
- **機能的なワーク ストリーム** – このワーク ストリームには、データのアップグレードが完了した後に実行されるコンフィギュレーション タスクが含まれます。 機能的なワークストリームと技術的なワークストリームの両方が業務のダウンタイム制限内に収まる必要があるため、これらのタスクをすべて文書化および定量化し、リソースを割り当てる必要があります。

次の図は、実稼動環境で発生するような、切替中の全体的なプロセスを示しています。

![切替プロセス](./media/cutover_1.png)

この切替プロセスは、次のような点でサンド ボックス環境での基本データのアップグレードとは異なります。

- AX 2012 データベースはコピーされずにバックアップされ、その後、元のデータベースが変更されます。 この方法は高速で、ロールバックが必要な場合はバックアップがロールバックされます。
- Finance and Operations の実稼働環境でのアクセスが制限されているために、Application Object Server (AOS) のサンド ボックス インスタンスで以前に実行されていたタスクは、Microsoft DSE チームによって実行されるようになりました。 これらのタスクには、bacpac ファイルのダウンロードおよびインポート、MajorversionDataUpgrade.zip パッケージの実行が含まれます。
- 次のタスクを追加しました。

    - スモーク テストを実行します。
    - アプリケーションの設定タスクを完了します。 このステップは、使用する機能に応じて大規模になる場合があります。 このステップでは、機能チームは新しいアプリケーションの機能を構成して、アップグレードされたシステムで使用できるようにします。
    - ユーザーがシステムに戻れるようにします。 アップグレードが完了して、システムを再度使用できることをユーザーに通知します。

## <a name="technical-workstream"></a>技術的なワーク ストリーム

技術的なワーク ストリームに含まれるさまざまな技術チームのメンバー: データベース管理者 (DBA)、AX 2012 のシステム管理者、サーバー管理者、AX 2012 および Finance and Operations に精通している開発者。 このトピックでは、どのタスクがどのロールを含めるかについて説明します。

切替テスト中には、技術チームは、データ アップグレード プロセスのパフォーマンスと信頼性のテストに焦点を当てて、ビジネスのダウンタイム制限を満たすようにします。 ハードウェアとソフトウェアの多くの要素がこのプロセスに関連しています。 これらの要素の一部はオンプレミスですが、他の要素は Microsoft クラウドに含まれています。 加えて、カスタム アプリケーション コードと標準コードの多くの要素が含まれています。 このテストの結果は、環境の切替プロセスを信頼する必要があります。

### <a name="turn-off-the-ax-2012-aos-instances"></a>AX 2012 AOS インスタンスをオフにします。

このタスクには、AX 2012 のシステム管理者とサーバー管理者が含まれます。

次の領域を検証する必要があります。

- **切替の時点で実行中のバッチ ジョブ** – 既に実行を開始している実行時間の長いバッチ ジョブは、システムの停止を防止します。 希望する時点で AOS インスタンスを停止できるように、事前に計画してください。 AX 2012 をオフにする前にバッチが完了するよう、バッチをスケジュールする必要があります。
- **システムの統合** – AX 2012 環境と統合されている他のシステムをお持ちかもしれません。 AX 2012 をオフにするための計画には、これらのシステムを考慮する必要があります。 たとえば、AX 2012 自体をオフにする前に、統合システムをしばらくオフにして、残りのインフライト トランザクションを完了する必要があります。 統合システムの要件は、企業間で広く異なります。 したがって、専門家チームはこのシナリオを個別に計画する必要があります。

### <a name="create-a-backup-of-the-ax-2012-database"></a>AX 2012 データベースのバックアップを作成します。

このタスクには、DBA が含まれます。 バックアップは、ロールバックが必要な場合に使用されます。 また、一定の期間保持され、切替時にシステム状態を示す基準点としても使用されます。

次の領域を検証する必要があります。

- バックアッププロセスの具体的なタイミングを取得します。
- 使用されるバックアップオプション (圧縮と非圧縮など) を調整し、可能な限り高速なバックアップを保証します。

### <a name="export-the-database-to-bacpac"></a>データベースを bacpac にエクスポートする

このタスクには、DBA が含まれます。 このタスクの出力は、新しいシステムの Microsoft Azure にアップロードされるエクスポート ファイルです。

次の領域を検証する必要があります。

- バックアッププロセスの具体的なタイミングを取得します。
- 可能な限り高速のエクスペリエンスを保証するために、エクスポート プロセスを最適化します。 最適化には、次のタスクが必要です。

    - CPU、ディスク I/O、メモリなどのエクスポート中にシステム リソースを測定します。
    - リソースのボトルネックが見つかった場合は、それらを軽減するための計画を作成します。 通常、より多くの必要なリソースを割り当てることでこれらのボトルネックが軽減されます。

### <a name="upload-the-bacpac-file-to-azure-storage"></a>Azure ストレージに bacpac ファイルをアップロードする

このタスクには、DBA またはサーバー管理者が関与します。 このタスクの間に、bacpac ファイルは Azure に移動されます。

次の領域を検証する必要があります。

- アップロードに使用するコンピューターを選択し、Azure ストレージ エクスプローラーのツールが設定され、使用できる状態になっていることを確認します。
- 複数回測定することにより、アップロード プロセスの具体的なタイミングを取得します。 アップロード時間は、インターネット接続の速度と、自分の場所に関連する Azure データセンターの地理的な場所に基づいて異なります。

### <a name="download-and-import-the-bacpac-file-to-the-azure-sql-database"></a>bacpac ファイルをダウンロードして Azure SQL データベースにインポートする

このタスクが稼働時に発生した場合、Microsoft DSE チームによってタスクが実行されます。 ただし、切替テスト中は、DBA が関与します。 このタスクの結果は、新しいシステムの Azure にアップロードされるエクスポート ファイルです。

次の領域を検証する必要があります。

- インポート プロセスの具体的なタイミングを取得します。
- 可能な限り高速のエクスペリエンスを保証するために、エクスポート プロセスを最適化します。 最適化には、次のタスクが必要です。

    - エクスポート中にシステム リソースを測定します。 次にいくつか例を挙げます。

        - **AOS コンピューター:** CPU、ディスク I/O、メモリ
        - **Azure SQL データベース インスタンス:** SQL データベース スループット (DTU)。 sys.dm_resource_stats システム ビューでは、AOS コンピューターの Microsoft SQL Server Management Studio から Azure SQL DTU を監視できます。

    - リソースのボトルネックが見つかった場合は、それらを軽減するための計画を作成します。 通常、より多くの必要なリソースを割り当てることでこれらのボトルネックが軽減されます。 このコンピューターは、Microsoft によって管理されているため、ボトルネックになっていると判断した場合は、リソースを増やすためにMicrosoft に要求を送信する必要があります。

### <a name="run-the-majorversiondataupgradezip-package"></a>MajorVersiondataUpgrade.zip パッケージを実行する

このタスクが稼働時に発生した場合、Microsoft DSE チームによってタスクが実行されます。 ただし、切替テスト中は、開発者が関与します。 このタスク中に、古いデータベース構造が新しいシステムの構造に変換されます。

データベースの同期プロセスは、このタスクの一部として実行されます。 この操作は SQL でコストがかかる操作であるため、クラスター化されたインデックスがテーブルで変更された場合など、状況によってはデータベースの同期にかなりの時間がかかる場合があります。

まず、分析とデバッグのプロセスを開発環境で実行することを強くお勧めします。 サンド ボックス環境では、デバッグと分析のオプションがさらに制限されます。 目標は、切替テストを実行するときに対処する必要のある問題がほとんど、あるいはまったくないことです。

次の領域を検証する必要があります。

- インポート プロセスの具体的なタイミングを取得します。
- 最速のエクスペリエンスを保証するために、プロセスを最適化します。 最適化には、次のタスクが必要です。

    - ReleaseUpdateScriptsExecution テーブルを使用して、個々のアップグレード スクリプトのパフォーマンスを監視します。
    - パフォーマンスを最適化するためにスクリプトを調整します。 このタスクでは、スクリプトの X++ コードをカスタマイズして、データセット用に最適化する必要があります。
    - Microsoft Dynamics Lifecycle Services (LCS) の監視または Management Studio の sys.dm_resources_stats システム ビューを使用して Azure SQL DTU を監視します。 リソースがすべて使用されている場合は、より高いデータベースレベルを Microsoft DSE チームに要求する必要があります。

### <a name="roll-back-to-ax-2012"></a>AX 2012 にロールバックする

このタスクの目的は、AX 2012 をオフにしたときのバックアップを使用してデータベースを復元し、AX 2012 を再度オンにすることです。 統合システムの状態も復元する必要があります。 ただし、統合システムは企業間で異なるため、特定の状況に応じてこのシナリオを個別に計画する必要があります。 ロールバックする必要はありませんが、必要な場合に備えてテスト済みのプロセスがあることが非常に重要です。

## <a name="functional-workstream"></a>機能的なワーク ストリーム

データのアップグレード後に、新しい環境でいくつかのコンフィギュレーション タスクが必要になります。 このワーク ストリームの目的は、すべてのコンフィギュレーション タスクを文書化および定量化し、リソースを各タスクに割り当てることで、ダウンタイム期間中にこれらのタスクを機能的なワーク ストリームとともに実行できるようにすることです。

通常、機能的なタスクでは、特定のシステム パラメータの値または他のコンフィギュレーション データの値の変更が含まれます。 これらのタスクは、機能テストのパス全体を通して識別されます。これは、切替テストとは別のアクティビティです。 このタイプのタスクが特定された場合、機能のリソースおよび開発者と共に確認する必要があります。

より大きな変更を行うには、新しいカスタム データ アップグレード スクリプトを作成して、データのアップグレード プロセス中にデータを更新する必要があります。 ただし、機能のリソースは、データのアップグレード後に新しいシステムを使用して、より小さな変更を手動で実行できます。

新しいデータのアップグレード スクリプトを持つ、より大規模な変更をテストする必要があります。 したがって、MajorVersionDataUpgrade.zip パッケージの 1 つ以上の追加の繰り返しを実行する必要があります。 手動のデータ入力のコストに対して、パッケージを再度実行するコストを比較検討することが重要です。

手動による変更のたびに、切替計画ドキュメントにタスクを追加する必要があります。 このタスクでは、次の詳細を示す必要があります。

-   タスクとは何か、また必要な作業は何か。
-   そのタスクを実行するのは誰か。
-   時間はどのくらいかかるか。

