---
title: 保存されたビューを十分に活用するフォームの作成
description: このトピックでは、保存されたビューの技術的な側面について説明します。また、保存されたビューを使用したフォームがうまく機能するよう、フォーム開発に関する考察を記載します。
author: jasongre
ms.date: 01/28/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: SysUserSetup, DefaultDashboard
audience: Developer
ms.reviewer: tfehr
ms.search.region: Global
ms.author: jasongre
ms.search.validFrom: 2019-07-31
ms.dyn365.ops.version: Platform update 28
ms.openlocfilehash: 54ac14fb92316f20074394f9d34dac13091c7e19
ms.sourcegitcommit: 89655f832e722cefbf796a95db10c25784cc2e8e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/31/2022
ms.locfileid: "8075085"
---
# <a name="build-forms-that-fully-utilize-saved-views"></a>保存されたビューを十分に活用するフォームの作成

[!include [banner](../includes/banner.md)]
[!include [preview banner](../includes/preview-banner.md)]

保存されたビューは、財務と運用アプリケーションにおけるパーソナライズ機能の中でも重要な拡張機能です。 [保存されたビュー](../../fin-ops/get-started/saved-views.md) のトピックでは、この機能の総合的な詳細情報を提供します。ここでは、保存されているビューの技術的な要素のみでなく、ビューの影響を受ける可能性のあるフォーム開発の側面も対象とします。 

## <a name="user-perceived-pages"></a>「ユーザー視点」のページ
従来、パーソナライゼーションには、1セットにつきモデル化されたフォームに対する 1:1 のリンクが含まれています。 多くのページでは、これはユーザーにとって理にかなっています。ユーザーが知覚するページとフォームをモデル化した方法とが合致するためです。 ただし、場合によっては 1:1のリンクとモデル化されたフォームが、パーソナライゼーションに対して直感的ではなく、わかりにくい場合があります。これはユーザーがモデル化されたフォーム間の境界に対して注意を払っていないためです。 

保存されたビューには、このような混乱を解消するべく 「ユーザー視点」 ページ上でビューを作成できる機能があります。 したがって、ユーザーはパーソナライゼーションを適用する方法とタイミングを知るために、フォームがどのようにモデル化されているかを理解する必要はありません。 たとえば、次の2つのシナリオを考えてみます。

- **単一のモデル化されたフォームにある複数の「ユーザー視点」ページ:** マスター詳細およびトランザクション詳細フォーム (たとえば **CustTable** や **PurchTable** フォームなど) は一般的に、グリッド ページと詳細ページからなる複数の「ユーザー視点」ページで構成されています。 

    これはユーザーはリストから詳細への切り替えることによってフォームの境界を超えていることに気づかない (気づく必要もないのですが) ためです。詳細フォームでのビューのサポートは、グリッド部分と詳細部分で別々にビューを定義できるように、異なる方法で処理されています。 つまり、「グリッド」と「詳細」のビュー セレクターでは、異なる一連の使用可能なビューを表示できます。 これらのフォームで対応している特殊ケースのビューを使用することで、「グリッド」ビューによるビュー定義でのフィルター適用も可能になります。その一方で「詳細」ビューではパーソナライゼーションのみが必要です。

- **単一の「ユーザー視点」ページに複数のモデル化されたフォーム:** モデル化されたフォーム (FactBox またはフォーム パーツ) にサブフォームを埋め込む機能により、複数のモデル化されたフォームが単一の「ユーザー視点」ページに対応している場合があります。 たとえば、 **すべての顧客** ページの詳細の部分には、情報ボックスの数と、フォームパーツの内容情報を取得する2つのファストタブがあります。 従来のパーソナライゼーションでは、ユーザーの期待に反して、**CustTable** フォームのパーソナライゼーションのエクスポートに任意の FactBox のパーソナライゼーションや **住所** または **連絡先情報** のクイック タブ内で行われたパーソナライゼーションも含まれていませんでした。 これと同様にユーザーが予期しないこととして、これらのサブフォームで行われたパーソナライゼーションはすべて、該当するフォームパーツが使用されているアプリケーションの他の部分にも反映されます。 例えば **すべての顧客** ページ内の **住所** ファストタブに変更を加えると、変更した内容が **すべての仕入先** ページの **住所** ファストタブにも反映されます。

    ビューでは、フォームパーツのパーソナライゼーションの範囲が、ユーザーの期待に合うように変更されています。 特にサブフォームのパーソナライゼーションは、作成された基本フォームに関連付けられるようになっています。 つまり、 **すべての顧客** の詳細ページからビューをエクスポートすると、元となっている **CustTable** フォームのパーソナライゼーションと、FactBox またはフォーム上の該当部分でモデル化されたフォームパーツからの個人設定が含まれます。 同様に、 **すべての顧客** ページ内の **住所** ファストタブ (フォームパーツ) で行ったパーソナライゼーションは、そのフォームパーツを使用している他のフォームには反映されません。

これらはパーソナライゼーション・サブシステムに対する高度な技術的変更であり、ビューが使用可能となっている場合にのみ利用できます。 これらの変更は、ユーザーがビューに関して予測可能で理解しやすいなエクスペリエンスを確実に得るために重要です。

## <a name="view-support"></a>ビューのサポート
フォームのスタイルは、ビューのサポートレベルによって決まります。

- ビューには、こちらのフォーム タイプのクエリが含まれています。

    - リスト ページ (Design.Style = ListPage)
    - 簡易リスト (Design.Style = SimpleList)
    - マスター詳細とトランザクション詳細のグリッド部分 (Design.Style=ListPage)
    - タスク シングルとタスク ダブルのページ (Design.Style または Design.Pattern = TaskSingle または TaskDouble)

        バージョン 10.0.25 では、「タスク シングルとタスク ダブルのページのビューで保存されるクエリを許可」機能により、フォーム タイプで定義されているビューのクエリ サポートを追加します。

- ビューには、こちらのフォーム タイプのクエリは含まれません。

    - このセクションで説明したその他のフル ページ フォーム
    - ワークスペース

        バージョン 10.0.25 では、「ワークスペースの保存済みビュー サポート」 *プレビュー* 機能を使用すると、モデリング されたワークスペースとユーザー作成のワークスペースの両方で保存済みビューを定義および共有できます。

    - ダイアログ

        バージョン 10.0.25 では、「ダイアログの保存済みビュー サポート」機能を使用すると、保存したビューをダイアログ ページで定義および共有できます。

    - [マスタの詳細] フォーム と [トランザクションの詳細] フォーム の詳細

- ビューは現在、次のフォーム タイプでサポートされていません。

    -  ダッシュボード
    - ドロップダウンダイアログ、ルックアップ、強化されたプレビューなどの、副次的なフォーム

## <a name="modifying-forms-to-fully-utilize-views"></a>フォームを変更してビューを完全に活用する
ほとんどのフォームは保存されたビューで十分に機能しますが、フォー上でビューが問題なく想定どおりに機能するためには、フォームロジックへの変更が必要となる部分も存在します。 以下は、新しいフォームを開発する際に留意すべき重要な項目です。

### <a name="custom-filters"></a>カスタム フィルター
カスタム フィルターは、フォームをモデル化され、クエリが変更されるコントロールです。 カスタム フィルターを使用した後に、ビューが未保存の変更を持つとしてマークされている場合や、カスタム フィルターの値が常に現在のビューまたはクエリに揃え常に揃える必要がある場合には、追加作業が必要となる場合があります。

- バージョン 10.0.25 より前においては、システム定義のフィルター処理メカニズム (クイック フィルター、グリッド列ヘッダー、フィルター ウィンドウ、または高度なフィルターまたは並べ替え) を通じて定義されたクエリ (フィルターや並べ替えなど) に対する調整だけが、未保存の変更があったことを示す表示がトリガされました。 カスタム フィルターを使用してクエリを変更した場合、ビューは (標準メカニズムの 1 つを使用する後、変更されるまで) 変更されていないと見なされます。 さらに、カスタム フィルターに関わるクエリの変更がビューに読み込まれている場合、カスタム フィルターの変更は反映されません。 その結果、最適でないユーザー エクスペリエンスが得られます。
- フォームの所有者は、バージョン 10.0.25 で、次の 2 つの方法を活用して、カスタム フィルターのより良い経験を提供できます。 これらの方法は、保存したビューでカスタム フィルター サポートを改善するために特別に導入されました。

    - **パブリック 無効 queryFiltersChanged():** この新しいメソッドは、クエリへの変更後、システムによってクエリが再実行される場合に呼び出されます (ビューの負荷やシステムのフィルター処理メカニズムが使用される場合など)。 したがって、カスタム フィルター コントロールを使用すると、最も最近実行したクエリを尋問して適切なフィルターを検索し、そのクエリが適切に反映するようにその値を更新することができます。
    - **element.formCustomFilterChanged():** この新しい API は、ユーザーの代わりにクエリを変更した場合、カスタム フィルター コントロールで呼び出されます。 呼び出されているとき、システムはビュー定義に未保存の変更をマークします。 推奨される方法として、コントロールに対する変更によってクエリが直ちに更新される場合や、1 つ以上のカスタム フィルターの調整で変更を有効にするボタンが必要な場合に、ボタン クリックのカスタム フィルタ用にコントロールの **modified()** 方法の最後の API を呼び出します。

### <a name="opting-forms-out-of-views"></a>ビューからフォームをアプトアウト
この方法では、一般にインストールは推奨されませんが、バージョン 10.0.25 では、開発者は必要に応じて、保存したビューのサポートから個々のフォームを選択できます。 この場合、フォームでビュー セレクターは使用できず、公開機能もありません。

保存済みビュー サポートからオプトするには、フォームの **init()** 方法の **super()** 前に、次のコードを入力します。 

this.disableSavedViewsOnForm();

### <a name="code-that-can-negatively-affect-views"></a>ビューに悪影響を与える可能性があるコード
フォームのスタートアップ サイクルにて X++ コードの遅延が発生すると、ビューがユーザーの期待どおりに機能しない可能性があります。 特に、次の項目にご注意ください:

- **executeQuery()** の **super()** の後、または **run()** の **super()** の後のクエリの変更により、ビューのクエリ側面が無視される可能性があります。
- **run()** の **super()** の後にフォームを変更すると、一部のユーザー パーソナライゼーションが既定ビューに誤って適用される可能性があります。

### <a name="secondary-list-pages"></a>二次リストのページ
長期的には、ビューがモデル化された二次リストのページを置き換える計画です。

- 通常、**保留中の得意先** などのセカンダリ リスト ページは、同じフォームを指すが異なるクエリを持つメニュー項目です。 クエリ内で渡されるメニュー項目は、既定のビューで定義されているクエリを上書きする可能性があり、これらのエントリ ポイントは、ユーザーがこれらのメニュー項目のいずれかを使用してフォームに移動しても既定のビュー クエリは実行できないので、ユーザーの混乱を引き起こす可能性があります。 現在の長期計画では、セカンダリ リスト ページを廃止 (非推奨) にして、それらをビューに移動させます。
- ユーザがフォーム キャプション (「すべての顧客」など) とビュー名 (「お客様」など) を混同しないように、フォーム キャプションを対応するエンティティの名前に変更することを検討してください。 たとえば、フォーム キャプションとして 「すべての顧客」 や 「すべての販売注文」 を使用する代わりに、「顧客」または「販売注文」へ変更します。

## <a name="known-issues"></a>既知の問題
このセクションでは、当機能のプレビュー版で発生する、保存されたビューにおける既知の問題の一覧について説明します。

### <a name="open-issues"></a>未処理の問題
- [解決済] ビューは、カスタム フィルターの使用後に未保存の変更があるとしてマークされません。 カスタム フィルターは、グリッド上のモデリング フィルター コントロールです (QuickFilter を除く)。 カスタム フィルター条件がビューに保存されている場合、カスタム フィルター コントロールは現在のクエリを正しく反映していない可能性があります。 この問題の解決策については、[ビューを最大限に活用するためフォームを変更](understanding-saved-views.md#modifying-forms-to-fully-utilize-views) セクションを参照してください。
- [解決済] ワークスペース、ダッシュボード、およびダイアログ ボックスのサポートを表示します。 この問題の解決策については、[サポートを表示](understanding-saved-views.md#view-support) セクションを参照してください。
- [解決済] [KB 4582751] フィールド (参照グループ フィールド) がカスタマイズ経由で追加された後、そのフィールドは空白のままです。
- 別のビューに切り替えるときにフィルター ウィンドウが開いている場合、フィルター ウィンドウはターゲット ビューのフィルターを反映するように更新されません。
- QuickFilter 条件が保存されているビューを別の環境に移動することはできません。 リリース 10.0.13 の修正により、状況はより適切に処理されますが、これらの条件を環境間で移動することはできません。

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
