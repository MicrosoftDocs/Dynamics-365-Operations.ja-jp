---
title: ファイルのアップロード コントロール
description: このトピックでは、ファイル アップロード コントロールについて説明します。 このコントロールを使用して、ファイルをアップロードできます。
author: aneesmsft
manager: AnnBe
ms.date: 06/20/2017
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer
ms.reviewer: sericks
ms.search.scope: Operations
ms.custom: 54311
ms.assetid: 82f47d4d-912c-4f85-81f9-b09c723f72fc
ms.search.region: Global
ms.author: aneesa
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: abc240b2d272c54f289cc900cb7e342f143fdcc1
ms.sourcegitcommit: 54baab2a04e5c534fc2d1fd67b67e23a152d4e57
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2020
ms.locfileid: "3017741"
---
# <a name="file-upload-control"></a><span data-ttu-id="83bf7-104">ファイルのアップロード コントロール</span><span class="sxs-lookup"><span data-stu-id="83bf7-104">File upload control</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="83bf7-105">このトピックでは、ファイル アップロード コントロールについて説明します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-105">This topic provides information about the file upload control.</span></span> <span data-ttu-id="83bf7-106">このコントロールを使用して、ファイルをアップロードできます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-106">This control lets users upload files.</span></span>

<a name="overview"></a><span data-ttu-id="83bf7-107">概要</span><span class="sxs-lookup"><span data-stu-id="83bf7-107">Overview</span></span>
--------

<span data-ttu-id="83bf7-108">ファイル アップロード コントロールを使用してユーザーはファイルをアップロードできます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-108">The file upload control lets users upload a file.</span></span> <span data-ttu-id="83bf7-109">また、これにより開発者は要件に基づいてアップロード処理を制御し、アップロードされたファイルを管理します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-109">It also lets developers control the upload process and manage the file that is uploaded, based on their requirements.</span></span> 

<span data-ttu-id="83bf7-110">[![ファイル アップロード コントロールの図](./media/fileupload001.png)](./media/fileupload001.png)</span><span class="sxs-lookup"><span data-stu-id="83bf7-110">[![Illustration of file upload control](./media/fileupload001.png)](./media/fileupload001.png)</span></span> 

<span data-ttu-id="83bf7-111">ファイル アップロード コントロールには 3 つのスタイルがあります。</span><span class="sxs-lookup"><span data-stu-id="83bf7-111">The file upload control can have three styles.</span></span> <span data-ttu-id="83bf7-112">スタイルを制御するには、**スタイル** プロパティを使用します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-112">You control the style by using the **Style** property.</span></span>

-   <span data-ttu-id="83bf7-113">**標準** スタイルは、**参照**、**アップロード**、および **キャンセル** ボタンと同時にファイル名フィールドを表示します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-113">The **Standard** style shows the file name field together with **Browse**, **Upload**, and **Cancel** buttons.</span></span>
-   <span data-ttu-id="83bf7-114">**最小限** スタイルは **参照** ボタンのみ表示します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-114">The **Minimal** style shows only the **Browse** button.</span></span>
-   <span data-ttu-id="83bf7-115">**MinimalWithFileName** スタイルは、ファイル名フィールドと **参照** ボタンを表示します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-115">The **MinimalWithFileName** style shows the file name field and the **Browse** button.</span></span>

<span data-ttu-id="83bf7-116">ファイル アップロード コントロールの **FileTypesAccepted** プロパティを使用すると、ユーザーがアップロードできるファイルの種類を制限できます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-116">The **FileTypesAccepted** property of the file upload control lets you limit the types of files that users can upload.</span></span> <span data-ttu-id="83bf7-117">ユーザーがアップロードできるファイル タイプは、主に関連するアップロード方法によって制御されます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-117">The file types that users can upload are primarily controlled by the associated upload strategy.</span></span> <span data-ttu-id="83bf7-118">ファイル アップロード コントロールの **FileTypesAccepted** プロパティは、さらに制限が必要な場合にのみ使用してください。</span><span class="sxs-lookup"><span data-stu-id="83bf7-118">The **FileTypesAccepted** property on the file upload control should be used only if further restrictions are required.</span></span> <span data-ttu-id="83bf7-119">アップロード コントロールは、アップロード戦略によって制限されているファイルの種類を指定するしようとすると、**参照**ボタンが使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="83bf7-119">If the upload control tries to specify file types that are restricted by the upload strategy, the **Browse** button becomes unavailable.</span></span>

| <span data-ttu-id="83bf7-120">許可されたファイル タイプ</span><span class="sxs-lookup"><span data-stu-id="83bf7-120">Allowed file types</span></span>    | <span data-ttu-id="83bf7-121">アップロード戦略の許可されたファイル タイプ</span><span class="sxs-lookup"><span data-stu-id="83bf7-121">Allowed file types from the upload strategy</span></span> | <span data-ttu-id="83bf7-122">最終結果</span><span class="sxs-lookup"><span data-stu-id="83bf7-122">Final result</span></span>                          |
|-----------------------|---------------------------------------------|---------------------------------------|
| <span data-ttu-id="83bf7-123">「.jpg、.png」</span><span class="sxs-lookup"><span data-stu-id="83bf7-123">".jpg,.png"</span></span>           | <span data-ttu-id="83bf7-124">「.jpg、.png、.gif、.txt」</span><span class="sxs-lookup"><span data-stu-id="83bf7-124">".jpg,.png,.gif,.txt"</span></span>                       | <span data-ttu-id="83bf7-125">「.jpg、.png」</span><span class="sxs-lookup"><span data-stu-id="83bf7-125">".jpg,.png"</span></span>                           |
| <span data-ttu-id="83bf7-126">「image/png」</span><span class="sxs-lookup"><span data-stu-id="83bf7-126">"image/png"</span></span>           | <span data-ttu-id="83bf7-127">「image/\*」</span><span class="sxs-lookup"><span data-stu-id="83bf7-127">"image/\*"</span></span>                                  | <span data-ttu-id="83bf7-128">「image/png」</span><span class="sxs-lookup"><span data-stu-id="83bf7-128">"image/png"</span></span>                           |
| <span data-ttu-id="83bf7-129">「image/\*」</span><span class="sxs-lookup"><span data-stu-id="83bf7-129">"image/\*"</span></span>            | <span data-ttu-id="83bf7-130">「image/png」</span><span class="sxs-lookup"><span data-stu-id="83bf7-130">"image/png"</span></span>                                 | <span data-ttu-id="83bf7-131">**参照** ボタンは使用できません。</span><span class="sxs-lookup"><span data-stu-id="83bf7-131">The **Browse** button is unavailable.</span></span> |
| <span data-ttu-id="83bf7-132">「.jpg、.png、.gif、.txt」</span><span class="sxs-lookup"><span data-stu-id="83bf7-132">".jpg,.png,.gif,.txt"</span></span> | <span data-ttu-id="83bf7-133">「.jpg、.png」</span><span class="sxs-lookup"><span data-stu-id="83bf7-133">".jpg,.png"</span></span>                                 | <span data-ttu-id="83bf7-134">**参照** ボタンは使用できません。</span><span class="sxs-lookup"><span data-stu-id="83bf7-134">The **Browse** button is unavailable.</span></span> |

<span data-ttu-id="83bf7-135">**OnBrowseButtonClicked**、**OnUploadAttemptStarted**、および**OnUploadCompleted** オーバーライドを使用すると、ファイル アップロード プロセスの様々なステージにフックすることができます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-135">You can use the **OnBrowseButtonClicked**, **OnUploadAttemptStarted**, and **OnUploadCompleted** overrides to hook into the various stages of the file upload process.</span></span> <span data-ttu-id="83bf7-136">また、カスタム ファイル アップロード戦略を作成して、**FileUpload Strategy Class** プロパティを使用してファイル アップロード コントロールと関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-136">You can also create custom file upload strategies and associate them with a file upload control by using the **FileUpload Strategy Class** property.</span></span>

## <a name="design-classes"></a><span data-ttu-id="83bf7-137">デザイン クラス</span><span class="sxs-lookup"><span data-stu-id="83bf7-137">Design classes</span></span>
<span data-ttu-id="83bf7-138">開発者がファイル アップロード コントロールのために使用できるクラスには、主に 2 種類あります。</span><span class="sxs-lookup"><span data-stu-id="83bf7-138">There are two main types of classes that developers can work with for the file upload control:</span></span>

-   <span data-ttu-id="83bf7-139">**戦略クラスをアップロード** – このクラスにより、開発者はユーザーがアップロードできるファイルの種類およびファイルの最大サイズなどのアップロードされたファイルに適用される必要があるさまざまなパラメータを制御できます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-139">**Upload strategy class** – This class lets developers control various parameters that should be enforced for uploaded files, such as the types of files that a user can upload and the maximum size of a file.</span></span> <span data-ttu-id="83bf7-140">また、これにより開発者はアップロード済みのファイルが保存される場所および方法を決定します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-140">It also lets developers determine where and how the uploaded file should be stored.</span></span> <span data-ttu-id="83bf7-141">すべてのアップロードは抽象 **FileUploadStrategyBase** クラスから戦略クラスへ継承する必要があります。</span><span class="sxs-lookup"><span data-stu-id="83bf7-141">All upload strategy classes must inherit from the abstract **FileUploadStrategyBase** class.</span></span>
-   <span data-ttu-id="83bf7-142">**結果クラスをアップロード** – このクラスにより、開発者は、名前、コンテンツ タイプ、アップロード状態など、ユーザーがアップロードしたファイルの詳細にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-142">**Upload result class** – This class lets developers access the details of a file that was uploaded by a user, such as its name, content type, and upload status.</span></span> <span data-ttu-id="83bf7-143">また、これにより開発者は対応するファイルを開いたり削除したりします。</span><span class="sxs-lookup"><span data-stu-id="83bf7-143">It also lets developers open and delete the corresponding file.</span></span> <span data-ttu-id="83bf7-144">すべてのアップロードは抽象 **FileUploadResultBase** クラスから結果クラスへ継承する必要があります。</span><span class="sxs-lookup"><span data-stu-id="83bf7-144">All upload result classes must inherit from the abstract **FileUploadResultBase** class.</span></span>

<span data-ttu-id="83bf7-145">このフレームワークは、**FileUploadTemporaryStorageStrategy** という名前のデフォルトのアップロード戦略クラスと **FileUploadTemporaryStorageResult** というデフォルトのアップロード結果クラスを提供します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-145">The framework provides a default upload strategy class that is named **FileUploadTemporaryStorageStrategy** and a default upload result class that is named **FileUploadTemporaryStorageResult**.</span></span> <span data-ttu-id="83bf7-146">このアップロード結果クラスは、アップロードされたファイルを一時的な BLOB ストレージに格納し、ダウンロード URL を提供します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-146">This upload result class stores uploaded files to the temporary blob storage and provides a download URL.</span></span> <span data-ttu-id="83bf7-147">開発者は、独自のカスタム アップロード戦略を実装し、必要に応じて結果クラスをアップロードすることもできます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-147">Developers can also implement their own custom upload strategy and upload result classes as required.</span></span> <span data-ttu-id="83bf7-148">アップロード方法については、**FileUploadStrategyBase** クラスからの 2 つの抽象メソッドは、実装される必要があります: **uploadFile** および **getResultClassName**。</span><span class="sxs-lookup"><span data-stu-id="83bf7-148">For the upload strategy, two abstract methods from the **FileUploadStrategyBase** class must be implemented: **uploadFile** and **getResultClassName**.</span></span> <span data-ttu-id="83bf7-149">**uploadFile** メソッドは、ファイルが保管される場所および方法を処理します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-149">The **uploadFile** method handles where and how the file is stored.</span></span> <span data-ttu-id="83bf7-150">**getResultClassName** メソッドは、この方法で使用されるアップロード結果クラスを取得します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-150">The **getResultClassName** method retrieves the upload result class that is used in this strategy.</span></span> <span data-ttu-id="83bf7-151">**FileUploadResultBase** クラスには、ファイル名、アップロード ステータス、ファイルのコンテンツタイプ、およびログ メッセージのフィールドがあります。</span><span class="sxs-lookup"><span data-stu-id="83bf7-151">The **FileUploadResultBase** class has fields for the file name, the upload status, the content type of the file, and the log message.</span></span> <span data-ttu-id="83bf7-152">このクラスは、必要に応じて拡張できます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-152">This class can be extended as required.</span></span> <span data-ttu-id="83bf7-153">すべての新しいプロパティはシリアル化および逆シリアル化することができます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-153">All new properties should be able to be serialized and deserialized.</span></span> <span data-ttu-id="83bf7-154">**openResult** メソッドはストリームとしてファイルを開き、**deleteResult** メソッドは対応するデータ ストレージからファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-154">The **openResult** method opens the file as a stream, and the **deleteResult** method deletes the file from the corresponding data storage.</span></span>

## <a name="sequence-diagram"></a><span data-ttu-id="83bf7-155">シーケンス図</span><span class="sxs-lookup"><span data-stu-id="83bf7-155">Sequence diagram</span></span>
<span data-ttu-id="83bf7-156">ファイル アップロード コントロールは、クライアントのファイルとアップロード方法を受け入れ、ファイル サービスに送信します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-156">The file upload control accepts the file and upload strategy in the client, and sends them to the file services.</span></span> <span data-ttu-id="83bf7-157">ファイル サービスは新しいセッションを開始し、戦略クラスのインスタンスを作成し、**uploadFile** メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="83bf7-157">The file services start a new session, create an instance of a strategy class, and call the **uploadFile** method.</span></span> <span data-ttu-id="83bf7-158">**uploadFile** メソッドがデータ ソース内へのファイルの格納を完了したとき、ファイルのアップロード結果クラスがファイル サービスへを返されます。</span><span class="sxs-lookup"><span data-stu-id="83bf7-158">When the **uploadFile** method has finished storing the file in the data source, a file upload result class returns to the file services.</span></span> <span data-ttu-id="83bf7-159">このクラスはクライアントに送り返され、後処理に対処する **OnUploadCompleted** イベントをトリガーする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="83bf7-159">This class is sent back to the client, which might trigger the **OnUploadCompleted** event to deal with the post-process.</span></span> 

<span data-ttu-id="83bf7-160">[![ファイル アップロード シーケンス ダイアグラム](./media/fileuploadcontrolusageanddesign1.png)](./media/fileuploadcontrolusageanddesign1.png)</span><span class="sxs-lookup"><span data-stu-id="83bf7-160">[![File upload sequence diagram](./media/fileuploadcontrolusageanddesign1.png)](./media/fileuploadcontrolusageanddesign1.png)</span></span>




