---
title: AX 2012 からのアップグレード - レベル 2 からレベル 5 のサンドボックス環境でデータをアップグレードするための DACPAC プロセス
description: このトピックでは、Microsoft Dynamics AX 2012 から Finance and Operations アプリにアップグレードする際に、リモート デスクトップ プロトコル (RDP) を使用してレベル 2 からレベル 5 のサンドボックス環境にアクセスできなくなった顧客に役立ちます。
author: laneswenka
manager: AnnBe
ms.date: 10/02/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.scope: Operations
ms.search.region: Global
ms.author: laswenka
ms.search.validFrom: 2017-06-16
ms.dyn365.ops.version: Platform update 20
ms.openlocfilehash: 2a82765d0058f78e90853c6c71e6470c1405f2c7
ms.sourcegitcommit: 42dbebced4a99dfe703689b7e38c3c5caecd12e1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/02/2020
ms.locfileid: "3949239"
---
# <a name="upgrade-from-ax-2012---dacpac-process-to-upgrade-data-in-sandbox-tiers-2-5-environments"></a><span data-ttu-id="bf0ea-103">AX 2012 からのアップグレード - レベル 2 からレベル 5 のサンドボックス環境でデータをアップグレードするための DACPAC プロセス</span><span class="sxs-lookup"><span data-stu-id="bf0ea-103">Upgrade from AX 2012 - Dacpac process to upgrade data in Sandbox Tiers 2-5 environments</span></span>

[!include [banner](../includes/banner.md)]

[!include [upgrade banner](../includes/upgrade-banner.md)]

<span data-ttu-id="bf0ea-104">このトピックでは、Microsoft Dynamics AX 2012 から Finance and Operations アプリにアップグレードする際に、リモート デスクトップ プロトコル (RDP) を使用してレベル 2 からレベル 5 のサンドボックス環境にアクセスできなくなった顧客に役立つプロセス ガイドです。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-104">This topic is a process guide that will help customers who no longer have Remote Desktop Protocol (RDP) access to their Tier-2 through Tier-5 sandbox environments when they upgrade from Microsoft Dynamics AX 2012 to Finance and Operations apps.</span></span> <span data-ttu-id="bf0ea-105">データ層アプリケーション パッケージ (DACPAC) に基づく新しいファイル形式と[データベース移動ツールキット](../database/database-movement-toolkit.md) を使用することで、AX 2012 のスキーマとデータをサンドボックス環境の既存の空のデータベースに取り込むことができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-105">By using a new file format this is based on data-tier application packages (DACPACs), and the [Database movement toolkit](../database/database-movement-toolkit.md), customers can bring their AX 2012 schema and data into an existing empty database in a sandbox environment.</span></span>

<span data-ttu-id="bf0ea-106">共有サンドボックス環境で実行する前に、開発環境でデータ アップグレード プロセスを実行することを**強くお勧め**します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-106">We **strongly recommend** that you run the data upgrade process in a development environment before you run it in a shared sandbox environment.</span></span> <span data-ttu-id="bf0ea-107">この方法を使用すると、データを正常にアップグレードするために必要な時間全体を削減することができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-107">This approach will help reduce the overall time that is required for a successful data upgrade.</span></span> <span data-ttu-id="bf0ea-108">詳細については[AX 2012からのアップグレード - データ アップグレードのためのアップグレード前のチェックリスト](prepare-data-upgrade.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-108">For more information, see [Upgrade from AX 2012 - Pre-upgrade checklist for data upgrade](prepare-data-upgrade.md).</span></span>

<span data-ttu-id="bf0ea-109">このプロセス ガイドでは、次の手順を実行する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-109">In this process guide, you will learn how to complete the following steps:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="bf0ea-110">サンドボックス環境データベースへのファイアウォールのアクセスを開放します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-110">Open firewall access to your sandbox environment database.</span></span>
> * <span data-ttu-id="bf0ea-111">すべてのオブジェクトのサンドボックス データベースを消去します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-111">Clear the sandbox database of all objects.</span></span>
> * <span data-ttu-id="bf0ea-112">スキーマを AX 2012 データベースからサンドボックス データベースに発行します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-112">Publish the schema from your AX 2012 database to the sandbox database.</span></span>
> * <span data-ttu-id="bf0ea-113">データをソース データベースからターゲット データベースに転送します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-113">Transfer the data from the source database to the target database.</span></span>
> * <span data-ttu-id="bf0ea-114">Microsoft Dynamics Lifecycle Services (LCS) からデータ アップグレード パッケージを適用します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-114">Apply the data upgrade package from Microsoft Dynamics Lifecycle Services (LCS).</span></span>
> * <span data-ttu-id="bf0ea-115">モック Go-Live 検証と実際の Go-Live で実稼働環境にデータベースをコピーします。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-115">Copy the database to production for mock go-live validation and actual go-live.</span></span>

## <a name="open-firewall-access-to-your-sandbox-environment-database"></a><span data-ttu-id="bf0ea-116">サンドボックス環境データベースへのファイアウォールのアクセスを開放する</span><span class="sxs-lookup"><span data-stu-id="bf0ea-116">Open firewall access to your sandbox environment database</span></span>

<span data-ttu-id="bf0ea-117">既定では、すべてのサンドボックス標準受け入れテスト環境でデータベース プラットフォームとして Azure SQL データベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-117">By default, all sandbox Standard Acceptance Test environments use Azure SQL Database as their database platform.</span></span> <span data-ttu-id="bf0ea-118">このような環境のデータベースは、最初に配置された Application Object Server (AOS) へのアクセスを制限するファイアウォールによって保護されています。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-118">The databases for these environments are protected by firewalls that restrict access to the Application Object Server (AOS) that they were originally deployed with.</span></span>

<span data-ttu-id="bf0ea-119">ただし、パブリック IP アドレスを使用して、ソース システムへのアクセスを許可することができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-119">However, your public IP address can be used to grant access to your source system.</span></span> <span data-ttu-id="bf0ea-120">環境タイプと RDP アクセスに応じて、さまざまな方法でこのアクセス権を付与できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-120">Different methods can be used to grant this access, depending on your environment type and RDP access.</span></span> <span data-ttu-id="bf0ea-121">方法に関係なく、データベースに接続するには、サーバーとデータベースを明示的に指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-121">Regardless of the method, connection to the database requires that the server and the database be explicitly specified.</span></span> <span data-ttu-id="bf0ea-122">この情報については、LCS の環境の詳細ページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-122">You can find this information on the environment details page in LCS.</span></span> 

<span data-ttu-id="bf0ea-123">ユーザー名レコード **axdbadmin** を検索して、**spartan-nam-opsprod365433\\DBOpsProd365_SandboxUAT_d2145fe** のような **{sqlServer\\sqlDatabase}** フォーマットでサーバーとデータベースを記録しておきます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-123">Find the user name record for **axdbadmin**, and make a note of the server and the database in the format **{sqlServer\\sqlDatabase}**, such as **spartan-nam-opsprod365433\\DBOpsProd365_SandboxUAT_d2145fe**.</span></span> <span data-ttu-id="bf0ea-124">この場合、Microsoft SQL Server Management Studio (SSMS) のサーバー値は **spartan-nam-opsprod365433.database.windows.net**、データベースの値は **DBOpsProd365_SandboxUAT_d2145fe**です。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-124">In this case, the server value for Microsoft SQL Server Management Studio (SSMS) is **spartan-nam-opsprod365433.database.windows.net**, and the database value is **DBOpsProd365_SandboxUAT_d2145fe**.</span></span> <span data-ttu-id="bf0ea-125">データベースを指定するには、SSMS の接続ダイアログ ボックスの**オプション**を選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-125">To specify the database, you must select **Options** in the SSMS connection dialog box.</span></span> <span data-ttu-id="bf0ea-126">**axdbadmin** の資格情報 (ユーザー名とパスワード) を使用します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-126">Use the **axdbadmin** credentials (user name and password).</span></span>

### <a name="microsoft-managed-environments-where-rdp-access-is-available"></a><span data-ttu-id="bf0ea-127">RDP アクセスが利用可能な Microsoft が管理する環境</span><span class="sxs-lookup"><span data-stu-id="bf0ea-127">Microsoft-managed environments where RDP access is available</span></span>

<span data-ttu-id="bf0ea-128">サンドボックスへの RDP アクセスがある場合は、サンドボックス AOS 仮想マシン (VM) にサインインして、SSMS を開きます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-128">If you have RDP access to your sandbox, sign in to the sandbox AOS virtual machine (VM), and open SSMS.</span></span> <span data-ttu-id="bf0ea-129">SSMS で、サーバー、ユーザー名、およびパスワードを入力します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-129">In SSMS, enter the server, user name, and password.</span></span> <span data-ttu-id="bf0ea-130">**オプション** タブで、LCS の **axdbadmin** レコードから明示的にデータベース名を入力します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-130">On the **Options** tab, explicitly enter the database name from the **axdbadmin** record in LCS.</span></span>

<span data-ttu-id="bf0ea-131">接続したら、データベースに対してクエリを開き、次の Transact-SQL (T-SQL) コマンドで IP アドレスを入力します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-131">After you're connected, open a query against the database, and enter your IP address in the following Transact-SQL (T-SQL) command.</span></span>

```sql
-- Create database-level firewall setting for IP a.b.c.d 
EXECUTE sp_set_database_firewall_rule N'AX 2012 Upgrade via RDP', 'a.b.c.d', 'a.b.c.d'; 
```

<span data-ttu-id="bf0ea-132">ソース環境に戻って SSMS を開き、ユーザー受け入れテスト (UAT) データベースに対して同じ **axdbadmin** 資格情報を使用して接続を試みます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-132">Back in your source environment, open SSMS, and try to connect by using the same **axdbadmin** credentials against the User Acceptance Testing (UAT) database.</span></span> <span data-ttu-id="bf0ea-133">次の手順に進む前に接続できることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-133">You must verify that you can connect before you move on to the next steps.</span></span>

<span data-ttu-id="bf0ea-134">ファイアウォール ルールは、データベースを更新するとき、または LCS からデータベースをインポートするときに削除されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-134">Note that firewall rules are deleted whenever you do a database refresh or whenever you do a database import from LCS.</span></span>

### <a name="microsoft-managed-environments-without-rdp-access"></a><span data-ttu-id="bf0ea-135">RDP へのアクセスがない Microsoft が管理する環境</span><span class="sxs-lookup"><span data-stu-id="bf0ea-135">Microsoft-managed environments without RDP access</span></span>

<span data-ttu-id="bf0ea-136">サンドボックスへの RDP アクセスがない場合は、ご利用の IP アドレスを LCS からセルフサービス方式で許可リストに追加できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-136">If you no longer have RDP access to your sandbox, you can add your IP address to the allow list in a self-service manner from LCS.</span></span> <span data-ttu-id="bf0ea-137">LCS で、サンドボックス環境の環境の詳細ページを開いて、**メンテナンス** > **アクセスの有効化**を選択してから、ダイアログ ボックスでソース環境の IP アドレスを追加します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-137">In LCS, open the environment details page for your sandbox environment, select **Maintain** > **Enable access**, and then, in the dialog box, add the IP address of your source environment.</span></span> <span data-ttu-id="bf0ea-138">このエントリは数時間後に期限切れになります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-138">This entry will expire after several hours.</span></span>

<span data-ttu-id="bf0ea-139">エントリが期限切れになる前に、サーバー、ユーザー名、およびパスワードを入力してサンドボックス データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-139">Before the entry expires, connect to the sandbox database by entering the server, user name, and password.</span></span> <span data-ttu-id="bf0ea-140">**オプション** タブで、LCS の **axdbadmin** レコードから明示的にデータベース名を入力します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-140">On the **Options** tab, explicitly enter the database name from the **axdbadmin** record in LCS.</span></span>

<span data-ttu-id="bf0ea-141">接続したら、データベースに対してクエリを開き、次の Transact-SQL (T-SQL) コマンドで IP アドレスを入力します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-141">After you're connected, open a query against the database, and enter your IP address in the following Transact-SQL (T-SQL) command.</span></span>

```sql
-- Create database-level firewall setting for IP a.b.c.d 
EXECUTE sp_set_database_firewall_rule N'AX 2012 Upgrade without RDP', 'a.b.c.d', 'a.b.c.d'; 
```

<span data-ttu-id="bf0ea-142">ファイアウォール ルールに 2 番目のエントリが作成されます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-142">A second entry is created in the firewall rules.</span></span> <span data-ttu-id="bf0ea-143">このエントリは期限切れになりません。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-143">This entry won't expire.</span></span> <span data-ttu-id="bf0ea-144">これらのファイアウォール ルールは、データベースを更新するとき、または LCS からデータベースをインポートするときに削除されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-144">Note that these firewall rules are deleted whenever you do a database refresh or whenever you do a database import from LCS.</span></span>

### <a name="self-service-environments"></a><span data-ttu-id="bf0ea-145">セルフサービス環境</span><span class="sxs-lookup"><span data-stu-id="bf0ea-145">Self-service environments</span></span>

<span data-ttu-id="bf0ea-146">AX 2012 のアップグレード シナリオでは、サンドボックス環境はサポートされていません。これは、サンドボックス環境では現在、データ アップグレード パッケージがサポートされていないためです。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-146">Unfortunately, sandbox environments of the self-service type aren't supported for AX 2012 upgrade scenarios, because they don't currently support data upgrade packages.</span></span> <span data-ttu-id="bf0ea-147">Microsoft は、このサポートの追加に取り組んでおり、詳細情報が得られ次第、このトピックを更新します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-147">Microsoft is working to add this support and will update this topic when more information is available.</span></span>

## <a name="clear-the-sandbox-database-of-all-objects"></a><span data-ttu-id="bf0ea-148">すべてのオブジェクトのサンドボックス データベースを消去する</span><span class="sxs-lookup"><span data-stu-id="bf0ea-148">Clear the sandbox database of all objects</span></span>

<span data-ttu-id="bf0ea-149">この手順では、Finance and Operations スキーマを含むサンドボックス データベースをクリーンアップします。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-149">In this step, you will clean out the sandbox database that has a Finance and Operations schema.</span></span> <span data-ttu-id="bf0ea-150">このプロセスにより、ソース AX 2012 スキーマを取り込むことができる空のデータベースが提供されます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-150">This process will provide a blank or empty database that you can bring your source AX 2012 schema from.</span></span> <span data-ttu-id="bf0ea-151">後で、そのデータベースからデータを取り込むこともできます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-151">Later, you will also be able to bring the data from it.</span></span> <span data-ttu-id="bf0ea-152">データのアップグレードに失敗した場合は、いつでもこのステップに戻って最初からやり直すことができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-152">If the data upgrade fails, you can always come back to this step and start over.</span></span>

<span data-ttu-id="bf0ea-153">SSMS を開き、前の手順と同様にサンドボックス データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-153">Open SSMS, and connect to your sandbox database as you did in the previous step.</span></span> <span data-ttu-id="bf0ea-154">データベース名を右クリックして、**スクリプトの生成**を選択します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-154">Right-click the database name, and then select **Generate scripts**.</span></span> <span data-ttu-id="bf0ea-155">**概要**ページで、**次へ**を選択します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-155">On the **Introduction** page, select **Next**.</span></span> <span data-ttu-id="bf0ea-156">**オブジェクトの選択**ページで、**特定のデータベース オブジェクトを選択する**オプションを選択してから、次のチェック ボックスを選択します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-156">On the **Choose Objects** page, select the **Select specific database objects** option, and then select the following check boxes:</span></span>

* <span data-ttu-id="bf0ea-157">テーブル</span><span class="sxs-lookup"><span data-stu-id="bf0ea-157">Tables</span></span>
* <span data-ttu-id="bf0ea-158">ビュー</span><span class="sxs-lookup"><span data-stu-id="bf0ea-158">Views</span></span>
* <span data-ttu-id="bf0ea-159">ストアド プロシージャ</span><span class="sxs-lookup"><span data-stu-id="bf0ea-159">Stored procedures</span></span>
* <span data-ttu-id="bf0ea-160">ユーザー定義の関数</span><span class="sxs-lookup"><span data-stu-id="bf0ea-160">User-defined functions</span></span>
* <span data-ttu-id="bf0ea-161">スキーマ</span><span class="sxs-lookup"><span data-stu-id="bf0ea-161">Schemas</span></span>
* <span data-ttu-id="bf0ea-162">フル テキストのカタログ</span><span class="sxs-lookup"><span data-stu-id="bf0ea-162">Full text catalogs</span></span>
* <span data-ttu-id="bf0ea-163">ユーザー定義のテーブル タイプ</span><span class="sxs-lookup"><span data-stu-id="bf0ea-163">User-defined table types</span></span>

<span data-ttu-id="bf0ea-164">**スクリプティング オプションの設定**ページで、**詳細**を選択してから、**DROP および CREATE のスクリプト**の値を **DROP のスクリプト**に変更します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-164">On the **Set Scripting Options** page, select **Advanced**, and then change the **Script DROP and CREATE** value to **Script DROP**.</span></span> <span data-ttu-id="bf0ea-165">**OK** を選択してから、**新しいクエリ ウィンドウに保存**オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-165">Select **OK**, and then select the **Save to new query window** option.</span></span> <span data-ttu-id="bf0ea-166">**次へ**を選択して概要へ移動します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-166">Select **Next** to move through the summary.</span></span> <span data-ttu-id="bf0ea-167">表示されるクエリ ウィンドウには、オブジェクトをデータベースから削除できるように、すべてのオブジェクトを正しい順序で一覧表示するスクリプトが含まれています。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-167">The query window that appears contains a script that lists all the objects in the correct order so that the objects can be dropped from the database.</span></span>

<span data-ttu-id="bf0ea-168">続行する準備ができたら、サンドボックス環境の AXDB データベースに対して直接生成されたクエリ ウィンドウでスクリプトを実行します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-168">When you're ready to continue, run the script in the query window that was generated directly against the AXDB database of your sandbox environment.</span></span> <span data-ttu-id="bf0ea-169">このスクリプトを実行するには、平均 15 ~ 20 分かかります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-169">This script takes an average of 15 to 20 minutes to run.</span></span>

## <a name="publish-the-schema-from-ax-2012-to-the-sandbox-database"></a><span data-ttu-id="bf0ea-170">スキーマを AX 2012 からサンドボックス データベースに発行する</span><span class="sxs-lookup"><span data-stu-id="bf0ea-170">Publish the schema from AX 2012 to the sandbox database</span></span>

<span data-ttu-id="bf0ea-171">データベースが空になったため、アップグレードされていない 2012 スキーマを発行できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-171">Now that the database is empty, you can publish your non-upgraded 2012 schema.</span></span> <span data-ttu-id="bf0ea-172">このステップでは、最新バージョンの[データベース移動ツールキット](../database/database-movement-toolkit.md) をソース環境にダウンロードする必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-172">For this step, you should download the latest version of the [Database movement toolkit](../database/database-movement-toolkit.md) into your source environment.</span></span>

<span data-ttu-id="bf0ea-173">Windows PowerShell tを使用して、データベース移動ツールキット (たとえば、C:\\dbmovement-toolkit\\) を展開したフォルダーの場所にディレクトリを変更します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-173">Use Windows PowerShell to change the directory to the folder location where you unzipped the Database movement toolkit (for example, C:\\dbmovement-toolkit\\).</span></span> <span data-ttu-id="bf0ea-174">その後、**AX2012SchemaPublish.ps1** スクリプトを実行します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-174">Then run the **AX2012SchemaPublish.ps1** script.</span></span> <span data-ttu-id="bf0ea-175">次のパラメーターを使用します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-175">Use the following parameters:</span></span>

* <span data-ttu-id="bf0ea-176">**SourceServerName** – ソース AX 2012 データベースがホストされる場所。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-176">**SourceServerName** – The location where your source AX 2012 database is hosted.</span></span> <span data-ttu-id="bf0ea-177">この場所は **localhost** にすることができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-177">This location can be **localhost**.</span></span>
* <span data-ttu-id="bf0ea-178">**AX2012DBName** – AX 2012 データベースの名前 (たとえば、**MicrosoftDynamicsAX**)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-178">**AX2012DBName** – The name of your AX 2012 database (for example, **MicrosoftDynamicsAX**).</span></span>
* <span data-ttu-id="bf0ea-179">**TargetServerName** – サンドボックス データベース サーバーのサーバー値 (たとえば、**spartan-srv-12345.database.windows.net**)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-179">**TargetServerName** – The server value of your sandbox database server (for example, **spartan-srv-12345.database.windows.net**).</span></span> <span data-ttu-id="bf0ea-180">前のステップでこの値を取得しています。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-180">You retrieved this value in a previous step.</span></span>
* <span data-ttu-id="bf0ea-181">**TargetDBName** – AXDB データベースの名前 (たとえば、**d365opsprod-12345**)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-181">**TargetDBName** – The name of your AXDB database (for example, **d365opsprod-12345**).</span></span> <span data-ttu-id="bf0ea-182">前のステップでこの値を取得しています。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-182">You retrieved this value in a previous step.</span></span>
* <span data-ttu-id="bf0ea-183">**AxDBAdminPassword** – **axdbadmin** データベース アカウントのパスワード。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-183">**AxDBAdminPassword** – The password for the **axdbadmin** database account.</span></span>

![AX2012SchemaPublish.ps1 スクリプトの実行中](media/upgrade-dacpac-extract.png)

<span data-ttu-id="bf0ea-185">実行中、スクリプトは SqlPackage.exe を使用して、AX 2012 データベースからデータベースとスキーマの定義のみを 2012DBSource.dacpac ファイルとして作業ディレクトリに抽出します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-185">During execution, the script uses SqlPackage.exe to extract only the database and schema definitions from your AX 2012 database as a 2012DBSource.dacpac file in the working directory.</span></span> <span data-ttu-id="bf0ea-186">次に、データベース移動ツールキットに含まれている Profile.publish.xml 発行プロファイルを使用して、このファイルをサンドボックス環境に発行します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-186">Next, it publishes this file to your sandbox environment by using the Profile.publish.xml publishing profile that is included in the Database movement toolkit.</span></span> <span data-ttu-id="bf0ea-187">この発行プロファイルでは、アップグレードに必要のない、SQL ビュー、SQL ユーザー、統計情報などのいくつかのオブジェクトの種類がスキップされます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-187">This publishing profile will skip several object types, such as SQL Views, SQL Users, Statistics, and other objects that aren't required for the upgrade.</span></span>

<span data-ttu-id="bf0ea-188">スクリプトの実行が完了したら、SSMS を開いて、サンドボックス データベースにテーブルが表示されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-188">When the script has finished running, open SSMS, and verify that you can see the tables in the sandbox database.</span></span> <span data-ttu-id="bf0ea-189">また、テーブルが空であり、データがないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-189">Also confirm that the tables are empty and have no data.</span></span>

> [!NOTE]
> <span data-ttu-id="bf0ea-190">エラーのために最初からやり直す必要がある場合は、「[すべてのオブジェクトのサンドボックス データベースを消去する](#clear-the-sandbox-database-of-all-objects)」のステップに戻ります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-190">If you must start over because of an error, go back to the [Clear the sandbox database of all objects](#clear-the-sandbox-database-of-all-objects) step.</span></span>

## <a name="transfer-data-from-ax-2012-to-the-sandbox-database"></a><span data-ttu-id="bf0ea-191">AX 2012 からサンドボックス データベースにデータを転送する</span><span class="sxs-lookup"><span data-stu-id="bf0ea-191">Transfer data from AX 2012 to the sandbox database</span></span>

<span data-ttu-id="bf0ea-192">スキーマの配置が完了したら、データをターゲッ トテーブルに転送する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-192">Now that the schema is in place, you must transfer the data to the target tables.</span></span> <span data-ttu-id="bf0ea-193">この転送には、SQL にリンクされているサーバーが使用されます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-193">A SQL-linked server will be used for this transfer.</span></span> <span data-ttu-id="bf0ea-194">転送では、データベース移動ツールキットに含まれている Windows PowerShell バージョン 7.0 以降のインスタンスで使用可能な並列処理機能も利用されます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-194">The transfer will also take advantage of parallelism features that are available in the instance of Windows PowerShell version 7.0 or later that is included in the Database Movement toolkit.</span></span>

<span data-ttu-id="bf0ea-195">Windows PowerShell tを使用して、データベース移動ツールキット (たとえば、C:\\dbmovement-toolkit\\) を展開したフォルダーの場所にディレクトリを変更します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-195">Use Windows PowerShell to change the directory to the folder location where you unzipped the Database movement toolkit (for example, C:\\dbmovement-toolkit\\).</span></span> <span data-ttu-id="bf0ea-196">その後、**AX2012DataTransfer.ps1** スクリプトを実行します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-196">Then run the **AX2012DataTransfer.ps1** script.</span></span> <span data-ttu-id="bf0ea-197">次のパラメーターを使用します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-197">Use the following parameters:</span></span>

* <span data-ttu-id="bf0ea-198">**SourceServerName** – ソース AX 2012 データベースがホストされる場所。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-198">**SourceServerName** – The location where your source AX 2012 database is hosted.</span></span> <span data-ttu-id="bf0ea-199">この場所は **localhost** にすることができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-199">This location can be **localhost**.</span></span>
* <span data-ttu-id="bf0ea-200">**AX2012DBName** – AX 2012 データベースの名前 (たとえば、**MicrosoftDynamicsAX**)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-200">**AX2012DBName** – The name of your AX 2012 database (for example, **MicrosoftDynamicsAX**).</span></span>
* <span data-ttu-id="bf0ea-201">**TargetServerName** – サンドボックス データベース サーバーのサーバー値 (たとえば、**spartan-srv-12345.database.windows.net**)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-201">**TargetServerName** – The server value of your sandbox database server (for example, **spartan-srv-12345.database.windows.net**).</span></span> <span data-ttu-id="bf0ea-202">前のステップでこの値を取得しています。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-202">You retrieved this value in a previous step.</span></span>
* <span data-ttu-id="bf0ea-203">**TargetDBName** – AXDB データベースの名前 (たとえば、d365opsprod-12345)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-203">**TargetDBName** – The name of your AXDB database (for example, d365opsprod-12345).</span></span> <span data-ttu-id="bf0ea-204">前のステップでこの値を取得しています。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-204">You retrieved this value in a previous step.</span></span>
* <span data-ttu-id="bf0ea-205">**AxDBAdminPassword** – axdbadmin データベース アカウントのパスワード。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-205">**AxDBAdminPassword** – The password for the axdbadmin database account.</span></span>
* <span data-ttu-id="bf0ea-206">**LinkedServerName** – 作成する SQL にリンクされているサーバーの名前 (たとえば、**AX2012Link**)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-206">**LinkedServerName** – The name of the SQL-linked server to create (for example, **AX2012Link**).</span></span>
* <span data-ttu-id="bf0ea-207">**DegreeOfParallelism** – 並列処理する必要があるテーブルの数 (たとえば、**3**)。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-207">**DegreeOfParallelism** – The number of tables that should be processed in parallel (for example, **3**).</span></span> <span data-ttu-id="bf0ea-208">このスクリプトは CPU および RAM に非常に負荷がかかるため、この値はソース環境で使用できるコアの数の半分以下である必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-208">The value should be no more than half of the number of cores that are available in the source environment, because the script is CPU-intensive and RAM-intensive.</span></span>

![AX2012DataTransfer.ps1 スクリプトを実行中](media/upgrade-dacpac-xfer.png)

<span data-ttu-id="bf0ea-210">実行中に、ソース サーバーとサンドボックス サーバー間のリンクされているサーバーがまだ存在していない場合は、スクリプトによって作成されます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-210">During execution, if a linked server between the source server and the sandbox server doesn't already exist, the script creates one.</span></span> <span data-ttu-id="bf0ea-211">次に、すべての AX 2012 テーブルのデータをターゲット データベースにコピーします。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-211">It then copies data from all the AX 2012 tables to the target database.</span></span> <span data-ttu-id="bf0ea-212">**DegreeOfParallelism** パラメーターを使用して、同時複数のテーブルを処理します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-212">It uses the **DegreeOfParallelism** parameter to process multiple tables at the same time.</span></span>

> [!NOTE]
> <span data-ttu-id="bf0ea-213">エラーのために最初からやり直す必要がある場合は、「[すべてのオブジェクトのサンドボックス データベースを消去する](#clear-the-sandbox-database-of-all-objects)」のステップに戻ります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-213">If you must start over because of an error, go back to the [Clear the sandbox database of all objects](#clear-the-sandbox-database-of-all-objects) step.</span></span>

## <a name="apply-the-data-upgrade-package-from-lcs"></a><span data-ttu-id="bf0ea-214">LCS からデータ アップグレード パッケージを適用する</span><span class="sxs-lookup"><span data-stu-id="bf0ea-214">Apply the data upgrade package from LCS</span></span>

<span data-ttu-id="bf0ea-215">スキーマとデータがサンドボックス環境に移動されたので、データ アップグレード プロセスを開始できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-215">Now that the schema and the data have been moved to the sandbox environment, you can start the data upgrade process.</span></span> <span data-ttu-id="bf0ea-216">前提条件として、LCS プロジェクトが AX 2012 アップグレード用に構成されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-216">As a prerequisite, make sure that your LCS project has been configured for AX 2012 upgrade.</span></span> <span data-ttu-id="bf0ea-217">詳細については、「[AX 2012 のアップグレードとしてプロジェクトを認識する](upgrade-overview-2012.md#identify-the-project-as-an-ax-2012-upgrade)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-217">For more information, see [Identify the project as an AX 2012 upgrade](upgrade-overview-2012.md#identify-the-project-as-an-ax-2012-upgrade).</span></span>

<span data-ttu-id="bf0ea-218">環境の環境の詳細ページで、**メンテナンス** \> **更新プログラムの適用**を選択して、読み込まれるパッケージの一覧が表示されるまで待ちます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-218">On the environment details page for your environment, select **Maintain** \> **Apply updates**, and wait for the list of packages to be loaded.</span></span> <span data-ttu-id="bf0ea-219">一覧の一番下までスクロールすると、共有アセット ライブラリから取得されたデータ アップグレード パッケージが一覧に追加されたことを確認できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-219">If you scroll to the bottom of the list, you will see that data upgrade packages are added to it as they are pulled in from the Shared asset library.</span></span> <span data-ttu-id="bf0ea-220">すべての利用可能なアップグレード パッケージが読み込まれるまでにしばらく時間がかかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-220">It might take some time for all the available upgrade packages to be loaded.</span></span>

<span data-ttu-id="bf0ea-221">アップグレード先となるバージョンに一致するアップグレード パッケージを選択します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-221">Select the upgrade package that matches the version that you want to upgrade to.</span></span> <span data-ttu-id="bf0ea-222">たとえば、バージョン 10.0.14 にアップグレードするには、**AX2012DataUpgrade-10-0-14** を選択します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-222">For example, to upgrade to version 10.0.14, select **AX2012DataUpgrade-10-0-14**.</span></span>

### <a name="troubleshooting-data-upgrade-errors"></a><span data-ttu-id="bf0ea-223">データ アップグレードのエラーに関するトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="bf0ea-223">Troubleshooting data upgrade errors</span></span>

<span data-ttu-id="bf0ea-224">データ アップグレードのエラーをトラブルシューティングするには、いくつかの方法があります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-224">There are several ways to troubleshoot data upgrade errors.</span></span> <span data-ttu-id="bf0ea-225">場合によっては、LCS から配置可能パッケージ ログのエラーを表示できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-225">In some cases, you can view the error in the deployable package logs from LCS.</span></span> <span data-ttu-id="bf0ea-226">たとえば、エラーがサービスの開始と停止およびデータベースの同期に関連している場合は、この方法を使用できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-226">For example, you can use this approach when the error is related to starting/stopping services and database synchronization.</span></span>

<span data-ttu-id="bf0ea-227">アップグレード スクリプトの実行中にアップグレードに失敗した場合は、サンドボックス データベースの ReleaseUpdateScriptsErrorLog テーブルにエラーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-227">If the upgrade fails while an upgrade script is running, you can view the errors in the ReleaseUpdateScriptsErrorLog table in the sandbox database.</span></span> <span data-ttu-id="bf0ea-228">このテーブルにアクセスするには、前の手順の情報を使用してサンドボックス データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-228">To access this table, connect to the sandbox database by using the information in previous steps.</span></span>

<span data-ttu-id="bf0ea-229">データを修正できる場合は、LCS からのアップグレードを再開できます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-229">If you can fix the data, you can resume the upgrade from LCS.</span></span> <span data-ttu-id="bf0ea-230">ただし、LCS からは 8 回を超えると再開できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-230">However, note that you can't resume from LCS more than eight times.</span></span> <span data-ttu-id="bf0ea-231">サービス システムではそれ以上の試行が許可されないため、8 回以上再開しようとすると別のエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-231">Any attempt to resume more than eight times will cause another failure, because the servicing systems don't allow more attempts.</span></span> <span data-ttu-id="bf0ea-232">この場合は、**中止**ボタンを使用してアップグレード パッケージをキャンセルし、後でもう一度やり直すことができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-232">In this case, you can use the **Abort** button to cancel the upgrade package and try again later.</span></span>

> [!NOTE]
> <span data-ttu-id="bf0ea-233">エラーのために最初からやり直す必要がある場合は、「[すべてのオブジェクトのサンドボックス データベースを消去する](#clear-the-sandbox-database-of-all-objects)」のステップに戻ります。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-233">If you must start over because of an error, go back to the [Clear the sandbox database of all objects](#clear-the-sandbox-database-of-all-objects) step.</span></span>

## <a name="copy-the-database-to-production-for-mock-go-live-and-actual-go-live"></a><span data-ttu-id="bf0ea-234">モック Go-Live と実際の Go-Live で実稼働環境にデータベースをコピーする</span><span class="sxs-lookup"><span data-stu-id="bf0ea-234">Copy the database to production for mock go-live and actual go-live</span></span>

<span data-ttu-id="bf0ea-235">データのアップグレードが完了したら、サンドボックス環境の同じカスタマイズ パッケージを実稼働環境に適用します。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-235">After the data upgrade is completed, apply the same customization packages from your sandbox environment to your production environment.</span></span> <span data-ttu-id="bf0ea-236">その後、サンドボックス環境の AXDB データベースを実稼働環境にコピーすることができます。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-236">You can then copy your sandbox environment AXDB database to the production environment.</span></span>

<span data-ttu-id="bf0ea-237">コピー操作の実行方法については、「[サンドボックス データベースを実稼働環境にコピーする](../database/dbmovement-scenario-goldenconfig.md#copy-the-sandbox-database-to-production)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="bf0ea-237">For information about how to perform the copy operation, see [Copy the sandbox database to production](../database/dbmovement-scenario-goldenconfig.md#copy-the-sandbox-database-to-production).</span></span>
