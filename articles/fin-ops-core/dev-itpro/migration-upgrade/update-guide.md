---
title: Finance and Operations の更新とカスタム コード ライフサイクルの管理
description: このトピックでは、Finance and Operations の更新とカスタム コード ライフサイクルを管理する方法について説明します。
author: rbadawy
ms.date: 10/22/2020
ms.topic: article
audience: Developer
ms.reviewer: rhaertle
ms.search.region: Global
ms.author: robadawy
ms.search.validFrom: 2020-10-22
ms.dyn365.ops.version: Platform update 10
ms.openlocfilehash: 15a54b0d5fa6ec2d19a70a361ba5580640d5af33
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5743907"
---
# <a name="manage-finance-and-operations-updates-and-your-custom-code-lifecycle"></a>Finance and Operations の更新とカスタム コード ライフサイクルの管理

このトピックでは、Finance and Operations 実装のアプリケーション ライフサイクル ユース ケースについて説明します。 次のシナリオに焦点を当てています。

+ ソースコードの開発分岐の管理
+ Microsoft サービス更新プログラムの次のバージョンの適用
+ カスタム コードの新しいバージョンの適用

このトピックは Microsoft Dynamics 365 Finance、Dynamics 365 Supply Chain Management、Dynamics 365 Commerce、Dynamics 365 Project Operations に適用されます。

主な目的は、次のタスクを完了する方法を示すことです。

+ 独自のカスタマイズのライフサイクルに関係なく、段階的に Finance and Operations アプリ (Dynamics 365 Commerce を含む) の Microsoft サービス更新 (または品質更新プログラム) を最新の状態に保ち管理します。 この方法により、更新プロセスが簡略化され、オールインワン アップグレード プロジェクトに関連付けられているコストと回帰のリスクを軽減できます。
+ カスタム コードのバージョン管理にソース コード分岐を利用します。 バージョン管理を使用することにより、新しい特徴や機能から重要な変更や修正プログラムのロールアウトを切り離すことができます。

このトピックでは、Azure DevOps と Microsoft Dynamics Lifecycle Services (LCS) のさまざまなツールの使用方法については説明していません。 代わりに、プロセスとベスト プラクティスに焦点を当てています。 [Microsoft サービス更新プログラムの次のバージョンの適用](#apply-next-update) セクションと [カスタム コードの新しいバージョンの適用](#apply-new-custom-code) セクションには、フェーズの概要とプロセスの手順の両方が含まれています。

このトピックは次のセクションを含みます:

+ [環境](#environments)

    + [現在のリリースを実行する環境](#current-environments)
    + [カスタム コードの次のバージョンを実行する環境](#next-environments)

+ [ソース コード分岐の管理](#manage-source-code-branches)
+ [Microsoft サービス更新プログラムの次のバージョンを適用する](#apply-next-update)

    + [Microsoft 更新プログラムの下位互換性](#compatibility)

        + [ランタイムの互換性](#runtime-compatibility)
        + [デザイン時の互換性](#design-compatibility)

    + [フェーズ 1: Finance and Operations 実装の更新](#phase-1)

        + [トラック 1: ランタイム環境を更新する](#update-finops-runtime)

            + [テスト 1 を更新する](#update-test-1)
            + [UAT を更新する](#update-uat)
            + [製品を更新する](#update-prod)

        + [トラック 2: 開発環境を更新する](#update-finops-dev)
        + [エラー状況](#error-situations)

            + [ケース 1](#case-1)
            + [ケース 2](#case-2)
            + [ケース 3](#case-3)

    + [フェーズ2: CSU をバージョン 10.0.11 に更新する](#phase-2)

        + [フェーズ 2 の前提条件](#phase2-prerequisites)
        + [トラック 1: CSU ランタイム環境を更新する](#update-csu)

            + [テスト 1 を更新する](#update-test-1-csu)
            + [UAT を更新する](#update-uat-csu)
            + [製品を更新する](#update-prod-csu)

        + [トラック 2: 開発環境を更新する](#update-csu-dev)

    + [フェーズ 3: POS をバージョン 10.0.11 に更新する](#phase-3)

        + [フェーズ 3 の前提条件](#phase3-prerequisites)
        + [Commerce 開発環境を更新する](#update-your-commerce-development-environment)
        + [オプション1: ランタイムの変更のみを含むストア コンポーネントを更新する](#store-runtime-only)
        + [オプション2: ランタイムとカスタムの変更を含むストア コンポーネントを更新する](#store-runtime-custom)
        + [プロセスを更新する](#update-process)

            + [テスト 1 を更新する](#update-test-1)
            + [UAT を更新する](#update-uat)
            + [製品を更新する](#update-prod)

+ [カスタム コードの新しいバージョンを適用する](#apply-new-custom-code)

    + [コードの修正プログラムを作成する](#create-hotfix)
    + [カスタム コードをリリース N からリリース N+1 に更新する](#update-custom-code)

+ [ストア コンポーネントをアップロード、更新、および配置する](#upload-store-components)

## <a name="environments"></a><a id="environments"></a>環境

このセクションでは、このトピックのアプリケーション ライフサイクル管理 (ALM) シナリオが依存する Finance and Operations 環境のコレクションについて説明します。 この構成は、カスタム コード (拡張機能) に依存する実装がある組織では一般的です。 このカスタム コードには、独立系ソフトウェア ベンダー (ISV) によって提供されるカスタマイズが含まれています。

### <a name="environments-that-run-your-current-release"></a><a id="current-environments"></a>現在のリリースを実行する環境

次の環境は、現在のリリースの環境です。

+ **開発 1** – 実稼働環境と同じバージョンの Finance and Operations アプリを実行する開発環境。 開発 1 環境では、カスタム コードのバージョン管理に Azure DevOps を使用します。 これは、カスタム コードの現在のリリース分岐に接続されています。 詳細については、[ソース コード分岐の管理](#manage-source-code-branches) セクションを参照してください。

    - クラウドとオンプレミスの両方の開発環境にはさまざまなオプションがあります。 詳細については、トピック [開発環境の配置とアクセス](../dev-tools/access-instances.md) を参照してください。
    - ビルドの自動化には、新しい Azure DevOps Hosted Agents 機能を使用します。 詳細については、[Microsoft ホステッド エージェントと Azure Pipelines を使用するビルドの自動化](../dev-tools/hosted-build-automation.md) を参照してください。

+ **テスト 1** – 機能テストと構成テストに使用されるレベル 1 テスト環境。 テスト 1 環境は、実稼働環境と同じバージョンの Finance and Operations アプリを実行します。 また、カスタム コード拡張機能の最新のリリースバージョンも実行します。
+ **UAT** – ユーザー受け入れテストに使用される実稼働前の環境。 UAT 環境は、レベル 2 (標準承認テスト) またはそれ以上の環境です。 実稼働環境と同じバージョンの Finance and Operations アプリを実行します。 また、カスタム コード拡張機能の最新のリリースバージョンも実行します。 この環境は通常、運用データベースのコピーに接続されています。
+ **生産** – 運用データベースで実行される実際の実稼動環境。

:::image type="content" source="media/uguide-environments.png" alt-text="現在のリリースを実行する環境":::

### <a name="environments-that-run-the-next-version-of-your-custom-code"></a><a id="next-environments"></a>カスタム コードの次のバージョンを実行する環境

次の環境では、カスタム コードの次のバージョンを実行します。

- **開発 2** – カスタム コード拡張機能の次のバージョンの開発に使用される開発環境。 カスタム コードのバージョン 管理に Azure DevOps を使用します。 これは、カスタム コードの現在の開発分岐 (**メイン** ブランチ) に接続されています。 詳細については、[ソース コード分岐の管理](#manage-source-code-branches) セクションを参照してください。
- **テスト 2** – カスタム コード拡張機能の次のバージョンのテストに使用される機能テスト環境。

:::image type="content" source="media/uguide-next-environments.png" alt-text="カスタム コードの次のバージョンを実行する環境":::

## <a name="manage-source-code-branches"></a>ソース コード分岐の管理

カスタム コード分岐を管理する場合は、ベスト プラクティスに従うことが重要です。 これにより、原価を最小限に抑え、リリースと更新の品質を保証するのに役立ちます。

:::image type="content" source="media/uguide-branches.png" alt-text="ソース コード分岐の管理":::

**メイン** 分岐 (開発分岐) には、コードの次期リリースの最新の機能バージョンが含まれています。

新しい機能で作業する場合は、**メイン** 分岐から新しい機能分岐を作成します。 機能作業が完了したら、機能分岐を **メイン** 分岐に統合します。

リリース分岐には、公式リリースのコード ベースが含まれています。 前の例では、リリース分岐が 1 つしかない、**リリース/2020-April** であることを前提としています。 **2020-April** はビルドではありません。 ソース コード分岐です。 リリースの修正プログラムを作成する可能性があるため、このリリース分岐に変更を加えてビルドを作成します。

- 新しい機能の開発するためにリリース分岐を使用しないでください。 実際の環境で必要な重要な修正や変更についてのみ使用してください。
- リリース分岐に変更を加えた後、分岐を **メイン** 分岐に統合し直します。 このようにして、次のリリースにも修正を含めることができます。
- 先に説明した環境の例の中で、開発 1 環境は、**リリース/2020-April** 分岐に接続されます。

カスタム コードの新しいバージョンをリリースする準備ができたら、**メイン** 分岐に基づく新しいリリース分岐を作成します。 この例では、**メイン** に基づいて **2020-July** という名前の新しいリリース分岐を作成します。

コードの特定の分岐に基づく特定の作業項目で作業しているときに、個々の開発者が作業するプライベート分岐がある場合があります。 作業が完了すると、プライベート分岐は親分岐にマージされます。 詳細については、[Team Foundation バージョン管理 (TFVC) の分岐戦略と効果的な戦略の選択方法について](https://docs.microsoft.com/azure/devops/repos/tfvc/branching-strategies-with-tfvc) を参照してください。

## <a name="apply-the-next-version-of-a-microsoft-service-update"></a><a id="apply-next-update"></a>Microsoft サービス更新プログラムの次のバージョンを適用する

段階的なアプローチを使用することで、サービス更新が行われるときに効率を最大化するのに役立ちます。 各フェーズは、実装の 1 つのコンポーネントを更新します。

1. **フェーズ 1** – Finance and Operations 環境を更新します。

    現在のバージョンの Commerce Scale Unit (CSU) および Point of Sale (POS) は、新しい Finance and Operations 更新プログラムで正常に機能します。 たとえば、CSU のバージョン 10.0.7 は、Finance and Operations アプリのバージョン 10.0.11 と互換性があります。

2. **フェーズ 2** – CSU を更新します。
3. **フェーズ 3** – POS を更新します。

Microsoft 更新プログラムを取得する場合、カスタム コードを次のバージョンに更新する必要はありません。 カスタム コードの更新プログラムとバンドルせずに Microsoft 更新プログラムを取得することにより、更新プロセスを簡略化できます。 また、オールインワン アップグレード プロジェクトに関連付けられている回帰の費用とリスクを軽減することにもなります。

### <a name="backward-compatibility-of-microsoft-updates"></a><a id="compatibility"></a>Microsoft 更新プログラムの下位互換性

このトピックの次のセクションのコンテキストを理解できるように、*サービス更新プログラムの下位互換性* によって、Microsoft の手段を理解することが重要です。 サービスと品質の更新には、*ランタイム* の下位互換性があります。 ただし、常に *デザイン時* (*コンパイル時*) に下位互換性があるとは限りません。

#### <a name="runtime-compatibility"></a><a id="runtime-compatibility"></a>ランタイムの互換性

すべての Microsoft 更新プログラムは、ランタイムの下位互換性を保つことを意図しています。 この互換性はバイナリ互換性と機能互換性の両方を対象にしています。 ランタイム互換性とは、実稼働環境およびサンドボックス環境に存在するカスタマイズが、それらの環境に Microsoft サービス更新プログラムが配置された後も引き続き機能することを意味します。 それらの更新プログラムは、サービス更新と品質更新を含みます。 ランタイムの互換性は、Microsoft 更新プログラムが以前のプラットフォームでコンパイルされたカスタマイズと下位互換性があることも意味します。

バイナリ互換性は、後方向のみです。 古いアプリケーション バージョンとプラットフォーム バージョンでカスタマイズをコンパイルし、それを新しいバージョンを実行している環境に配置できます。 ただし、コードがコンパイルされたバージョンよりも前のバージョンを実行している環境にコードを配置することはできません。

#### <a name="design-time-compatibility"></a><a id="design-compatibility"></a>デザイン時の互換性

デザイン時 (コンパイル時) の下位互換性とは、開発者が開発環境に更新を適用し、変更を加えることなくコードが正常にコンパイルできることを意味します。

Microsoft は、デザイン時の互換性を目指しています。 ただし、一部の更新には、デザイン時には互換性がないが、バイナリ互換性のある変更が含まれている場合があります。 そのため、更新プログラムが適用された後、コードのコンパイル時に新しいエラーまたは警告が発生する可能性があります。 これらの変更の例を次に示します。

+ Microsoft は列挙型を拡張可能にします。
+ Microsoft は API を廃止または内部としてマークします。
+ Microsoft は安全でないコーディング方法を回避するために新しいコンパイラ エラーを導入します。

これらすべての変更はソリューションでの作業が必要な場合があります。 バイナリ互換であるデザイン時の重大な変更は、12 か月の廃止予定の通知を必要としません。 これらの重大な変更は、サービスの更新ごとに文書化されています。 詳細については、[プラットフォーム更新プログラムの新機能と変更された機能](../get-started/whats-new-home-page.md) を参照してください。

### <a name="phase-1-update-the-finance-and-operations-implementation"></a><a id="phase-1"></a>フェーズ 1: Finance and Operations 実装の更新

このセクションでは、Finance and Operations 実装を最新のサービス更新プログラムに更新するために使用するプロセスについて要約します。 バージョン 10.0.7 からバージョン 10.0.11 への更新が例として使用されます。

このフェーズは次の 2 つのトラックに分かれています。 これらのトラックは並列で発生する可能性があります。

- **トラック 1** – ランタイム環境を更新します。
- **トラック 2** – 開発環境を更新します。

トラック 1 を完了すると、[エラーの状況](#error-situations) セクションで説明されているエラー状況のいずれかが発生しない限り、バージョン 10.0.11 で有効になります。

#### <a name="track-1-update-your-runtime-environments"></a><a id="update-finops-runtime"></a>トラック 1: ランタイム環境を更新する

トラック 1 を完成すると、実稼働環境はバージョン 10.0.11 で有効になるため、基本的に Finance and Operations バージョン 10.0.11 への更新が完了します。 このトラックの一部としてカスタム コードを再コンパイルする必要はありません。

##### <a name="update-test-1"></a>更新テスト 1

テスト 1 環境は、カスタム拡張機能の最新のリリース バージョンと共にバージョン 10.0.7 を実行しています。 テスト 1 の更新はこのフローの前提条件ではありませんが、機能検証と予測可能性の別のレベルを追加するため、それをお勧めします。 この更新は、UAT 環境を更新する前に完了する必要があります。 テスト 1 を更新して検証するのが早ければ早いほど、「実際」の更新 (つまり、UAT および製品環境の更新) がより予測可能になります。

1. Finance and Operations アプリのバージョン 10.0.11 をテスト 1 に適用します。
2. 機能シナリオを承認します。 [Regression Suite Automation Tool](../perf-test/rsat/rsat-overview.md) を使用すると、テスト環境および UAT 環境でのユーザー受け入れテストを自動化できます。
3. 回帰が発生した場合は、[エラー状況](#error-situations) セクションを参照してください。

##### <a name="update-uat"></a>UAT の更新

UAT 環境は、カスタム拡張機能のリリース バージョンと共にバージョン 10.0.7 を実行しています。 (UAT 環境は、製品環境と同じです。)

1. Finance and Operations アプリのバージョン 10.0.11 を UAT に適用します。

    UAT 環境は、Microsoft によって自動的に更新されるように構成されている場合があります。 ただし、更新が使用可能になり次第、いつでもプルできます。

2. ユーザー受け入れテストを完了し、サイン オフします。
3. 回帰が発生した場合は、[エラー状況](#error-situations) セクションを参照してください。

##### <a name="update-prod"></a>製品の更新

1. Finance and Operations アプリのバージョン 10.0.11 を製品に適用します。

    製品環境は、Microsoft によって自動的に更新されるように構成されている場合があります。 ただし、更新が使用可能になり次第、いつでもプルできます。

2. サイン オフします。

#### <a name="track-2-update-your-development-environments"></a><a id="update-finops-dev"></a>トラック 2: 開発環境を更新する

トラック 2 の目的は、開発 1 環境をバージョン 10.0.11 に更新することです。 開発 1 は、カスタム コードの現在のリリース ブランチに接続されている **メイン** 開発環境です。 Finance and Operations アプリのバージョン 10.0.7 を実行しています。 トラック 2 を完了することで、開発 1 が最新リリースと共にバージョン 10.0.11 を実行し、コードに必要な将来の修正プログラムの準備が整います。

1. Finance and Operations アプリのバージョン 10.0.11 を開発 1 に適用します。
2. カスタム コードをコンパイルし、テストを行います。
3. カスタム コードに必要な変更を加えます。
4. リリース ブランチへのコードの変更を確認ししてください。
5. 複数の開発環境がある場合は、環境ごとに次の手順を実行します。

    1. Finance and Operations アプリのバージョン 10.0.11 を開発環境に適用します。
    2. ターゲット コード ブランチから、最新のカスタム コードを同期してコンパイルします。

#### <a name="error-situations"></a>エラー状況

##### <a name="case-1"></a>ケース 1

トラック 1 で、Microsoft 品質更新プログラムを必要とするバグが検出されました。 Microsoft が更新プログラムを適切なタイミングでリリースする場合、元のサービス更新プログラムの代わりに新しい Microsoft 更新プログラムを使用して、トラック 1 を完了します。

##### <a name="case-2"></a>ケース 2

トラック 1 で、Microsoft サービス更新プログラムを必要とするバグが検出されました。 ただし、更新を適切なタイミングでリリースすることはできません。

この問題の回避策として、Microsoft はカスタム コードの変更を提案します。

1. 開発 1 (リリース分岐内) のコードを変更し、更新をテストします。
2. リリース ブランチへのコードの変更を確認ししてください。
3. リリース分岐から新しい配置可能なパッケージを作成します。
4. 新しい配置可能なパッケージをテスト 1 および/または UAT に適用します。

> [!NOTE]
> バージョン 10.0.7 でコンパイルされるカスタム コードは、バージョン 10.0.7 以降を実行している任意のランタイム環境に配置できます。 したがって、まだ開発 1 をバージョン 10.0.11 に更新する必要はありません。 ただし、トラック 2 の一部として既にその更新を完了している可能性があります。

##### <a name="case-3"></a>ケース 3

トラック 1 で、カスタム コードの変更が必要なバグが見つかりました。 このバグは、コードまたは ISV コードのいずれかにある可能性があります。

1. 開発 1 (リリース分岐内) のコードを変更し、更新をテストします。
2. リリース ブランチへのコードの変更を確認ししてください。
3. リリース分岐から新しい配置可能なパッケージを作成します。
4. 新しい配置可能なパッケージをテスト 1 および/または UAT に適用します。

### <a name="phase-2-update-csu-to-version-10011"></a><a id="phase-2"></a>フェーズ2: CSU をバージョン 10.0.11 に更新する

このセクションでは、Commerce Scale Unit を最新のサービス更新プログラムに更新するために使用するプロセスについて要約します。 リリース 10.0.7 (Commerce バージョン 9.17) からリリース 10.0.11 (Commerce バージョン 9.21) への更新が例として使用されます。

#### <a name="phase-2-prerequisites"></a><a id="phase2-prerequisites"></a>フェーズ 2 の前提条件

CSU を更新する前に、(アプリ内の) Commerce 本部環境 (Finance and Operations アプリ内) を同じリリースまたはそれ以降のリリースに更新する必要があります。 この例では、10.0.11 がリリースされています。

このフェーズは次の 2 つのトラックに分かれています。 これらのトラックは並列で発生する可能性があります。

- **トラック 1** – CSU ランタイム環境を更新します。
- **トラック 2** – 開発環境を更新します。

トラック 1 を完了すると、フェーズ 1 で説明した [エラーの状況](#error-situations) のいずれかが発生しない限り、バージョン 10.0.11 (Commerce バージョン 9.21) で有効になります。

#### <a name="track-1-update-your-csu-runtime-environments"></a><a id="update-csu"></a>トラック 1: CSU ランタイム環境を更新する

トラック 1 を完成すると、実稼働環境はバージョン 10.0.11 で有効になるため、基本的に CSU のバージョン 10.0.11 への更新が完了します。 このトラックの一部としてカスタム コードを再コンパイルする必要はありません。

##### <a name="update-test-1"></a><a id="update-test-1-csu"></a>テスト 1 を更新する

現在、Commerce のサービス (SaaS) コンポーネントとしてのソフトウェアは、第 1 層環境 (開発/テスト環境) ではサポートされていません。 Retail Server のコピーは各第 1 層環境でローカルに実行され、Retail Server 用の Microsoft コードと小売りのカスタマイズの両方の配置は、アプリケーション バイナリ パッケージと配置可能な小売りパッケージがサービス (IaaS) インスタンスとしてインフラストラクチャに対して適用される前のシステム介して行われます。

###### <a name="update-uat"></a><a id="update-uat-csu"></a>UAT を更新する

UAT 環境では、リリース 10.0.7 に対応する CSU が、実稼働環境で実行されているのと同じバージョンの小売り拡張機能と共に実行されています。

1. Commerce Scale Unit を更新します。 対象バージョンとして、**9.21 (10.0.11)** を選択します。 詳細については、[フェーズ2: CSU をバージョン 10.0.11 に更新する](#phase-2) を参照してください
2. ユーザー受け入れテストを完了し、サイン オフします。
3. 回帰が発生した場合は、[エラー状況](#error-situations) セクションを参照してください。

###### <a name="update-prod"></a><a id="update-prod-csu"></a>製品を更新する

1. Commerce Scale Unit を更新します。 対象バージョンとして、**9.21 (10.0.11)** を選択します。 詳細については、[フェーズ2: CSU をバージョン 10.0.11 に更新する](#phase-2) を参照してください
2. サイン オフします。

#### <a name="track-2-update-your-development-environments"></a><a id="update-csu-dev"></a>トラック 2: 開発環境を更新する

1. Retail ソフトウェア開発キット (SDK) の最新バージョンを入手してください。

    1. リリース 10.0.11 の Finance and Operations サービス更新プログラムを開発 1 に適用します。
    2. **%ServiceDrive%\\RetailSDK\\Update\\\<newest directory\>** から Retail SDK の更新されたバージョンを入手します

2. **メイン** (開発) 分岐で、新しいバージョンの Retail SDK から Retail アーティファクトを更新します。
3. コンパイルします。 新しいバージョンは、下位互換性があり、コードを変更する必要はありません。
4. Retail SDK の更新を含む変更をコミットします。
5. カスタム コードに必要な変更を加えます。
6. ターゲット分岐にコードの変更をコミットします。
7. オプション: 複数の開発環境がある場合は、手順 4 の最新の変更をマージし、最新のカスタムコードをコンパイルします。

### <a name="phase-3-update-pos-to-version-10011"></a><a id="phase-3"></a>フェーズ3: POS をバージョン 10.0.11 に更新する

このセクションでは、Modern POS や Hardware Station などの店舗のコンポーネントを最新のサービス更新プログラムに更新するために使用するプロセスを要約します。 リリース 10.0.7 (Commerce バージョン 9.17) からリリース 10.0.11 (Commerce バージョン 9.21) への更新が例として使用されます。

Commerce 本社 (Finance and Operations アプリ内) および CSU の更新とは異なり、店舗のコンポーネントの更新は同じパッケージで提供されます。 Commerce 本社 と CSU を更新すると、次のオプションがあります。

- **オプション0 (操作は必要ありません)** – バージョンがサポートされており、ポリシーに準拠している場合は、店舗のコンポーネントを以前のリリースままにします。
- **オプション 1** – CSU と同じリリースに一致するように、店舗のコンポーネント ランタイム (Microsoft コード) を更新します。
- **オプション 2** – 店舗コンポーネントのランタイム (Microsoftコード) とカスタマイズを一緒に更新します。

このセクションの残りの部分では、店舗のコンポーネント (オプション 1 またはオプション 2) を更新するか、または更新する必要があることを前提としています。

このフェーズを完了すると、フェーズ 1 で説明されている [エラーの状況](#error-situations) のいずれかが発生しない限り、店舗のコンポーネントのリリース 10.0.11 (Commerce バージョン 9.21) で有効になります。

#### <a name="phase-3-prerequisites"></a><a id="phase3-prerequisites"></a>フェーズ 3 の前提条件

フェーズ 3 には次の前提条件があります。

- Commerce 本社のコンポーネント (Finance and Operations アプリ内) は、CSU が更新される前に、同じリリースまたはそれ以降のリリースに更新されました。 この例では、バージョンは 10.0.11 です。
- CSU は、店舗のコンポーネントと同じリリースまたはそれ以降のリリースに更新されました。 この例では、リリースは 10.0.11 です。

#### <a name="update-your-commerce-development-environment"></a>Commerce 開発環境を更新する

[トラック 2: 開発環境の更新](#update-csu-dev) セクションの手順に従ってください。

#### <a name="option-1-store-component-updates-that-include-only-runtime-changes"></a><a id="store-runtime-only"></a>オプション 1: ランタイムの変更のみを含む店舗のコンポーネントを更新する

このオプションは、店舗のコンポーネントを含む新しい配置可能小売パッケージを生成します。 Microsoft コードからの変更のみが含まれます。

1. 現在、実稼働環境で使用されているコードを含むリリース分岐を、対象リリースと一致する Retail SDK に更新します。 この例では、バージョンは 10.0.11 (9.21) です。 [トラック 2: 開発環境の更新](#update-csu-dev) セクションの手順に従ってください。
2. 配置可能小売パッケージの新しいビルドを生成します。 このビルドには、本稼働環境に現在あるものと同じカスタマイズのセットに加えて、Microsoft コードのバージョン 10.0.11 (9.21) が含まれています。

#### <a name="option-2-store-component-updates-that-include-runtime-and-custom-changes"></a><a id="store-runtime-custom"></a>オプション 2: ランタイムとカスタムの変更を含む店舗のコンポーネントを更新する

このオプションは、店舗のコンポーネントを含む新しい配置可能小売パッケージを生成します。 Microsoft コードとカスタマイズ両方からの変更が含まれます。

1. 現在、実稼働環境で使用されているコードを含むリリース分岐を、対象リリースと一致する Retail SDK に更新します。 この例では、バージョンは 10.0.11 (9.21) です。 [トラック 2: 開発環境の更新](#update-csu-dev) セクションの手順に従ってください。
2. 変更をコミットします。
3. 店舗のコンポーネントのカスタム コードを更新するか、ISV 更新されたコンポーネントへの参照を更新します。
4. 配置可能小売パッケージの新しいビルドを生成します。 このビルドには、更新されたカスタム コードに加えて、Microsoft コードのバージョン 10.0.11 (9.21) が含まれます。

#### <a name="update-process"></a>更新プロセス

##### <a name="update-test-1"></a>テスト 1 の更新

Commerce の SaaS コンポーネントは現在、開発またはテストのワンボックス環境ではサポートされていません。 Retail Server のコピーは、各開発またはテストのワンボックス環境でローカルに実行され、Retail Server 用の Microsoft コードと小売りのカスタマイズの両方の配置は、アプリケーション バイナリ パッケージと配置可能な小売りパッケージが IaaS インスタンスに対して適用される前のシステム介して行われます。

テスト 1 環境では、Commerce 本社のバージョン 10.0.11 と前のフェーズの CSU のローカル バージョンが実行されています。 このフローでは、テスト 1 の更新は前提条件ではありません。 この環境には CSU がないため、この手順は主に検証用です。

1. 店舗のコンポーネントをアップロード、更新、および配置します。 詳細については、[店舗のコンポーネントのアップロード、更新、および配置](#upload-store-components) を参照してください。
2. 機能シナリオを承認します。
3. 回帰が発生した場合は、[エラー状況](#error-situations) セクションを参照してください。

##### <a name="update-uat"></a>UAT の更新

UAT 環境を指すクライアントは、リリース 10.0.7 (実稼働環境で現在実行されているのと同じバージョン) のアプリケーション (たとえば、Modern POS) を実行しています。

1. 店舗のコンポーネントをアップロード、更新、および配置します。 詳細については、[店舗のコンポーネントのアップロード、更新、および配置](#upload-store-components) を参照してください。
2. 機能シナリオを承認します。
3. 回帰が発生した場合は、[エラー状況](#error-situations) セクションを参照してください。

##### <a name="update-prod"></a>製品の更新

1. 店舗のコンポーネントをアップロード、更新、および配置します。
2. サイン オフします。

## <a name="apply-a-new-version-of-your-custom-code"></a>カスタム コードの新しいバージョンを適用する<a id="apply-new-custom-code"></a>

このセクションでは、カスタム拡張機能の新しいビルドで UAT または製品環境を更新する必要がある 2 つのユース ケースの推奨されるフローについて説明します。

### <a name="create-a-hotfix-of-your-code"></a>コードの修正プログラムを作成する<a id="create-hotfix"></a>

UAT または製品環境で重大なバグが見つかった場合は、リリース分岐 (**メイン** 分岐または開発分岐にはない) のバグを修正し、標準プロセスを使用して配置可能なパッケージを UAT と製品に適用します。

:::image type="content" source="media/uguide-hotfix.png" alt-text="修正プログラムのプロセス":::

1. 開発 1 では、リリース分岐でコードの修正を行います。 必要な修正が ISV コードにある場合は、ソリューションの次のバージョンではなく、現在のリリースの新しいビルドを ISV に送信するよう依頼します。
2. コンパイルしてテストします。
3. リリース分岐から新しい配置可能なパッケージを作成します。
4. テスト 1 に配置し、サインオフが必要な場合はサインオフします。
5. 標準プロセスを使用して、カスタム コードを最初に UAT に配置し、次に製品に配置します。
6. コード修正を **メイン** コード分岐と統合します。

### <a name="update-your-custom-code-from-release-n-to-release-n1"></a><a id="update-custom-code"></a>カスタム コードをリリース N からリリース N+1 に更新する

カスタム コードの次のバージョンをリリースする準備ができたら、次のプロセスを使用して新しいリリースを作成および配置します。

:::image type="content" source="media/uguide-custom-code.png" alt-text="カスタム コードを N から N+1 に更新する":::

1. 開発 2 環境、または **メイン** 分岐に接続されている別の環境では、**メイン** 分岐で開発を完了します。
2. テスト 2 に配置してテストします。
3. 新しいバージョンが承認されるまで手順 1 ～ 2 を繰り返します。
4. **新しい** リリース分岐を作成します。
5. **新しい** リリース分岐から新しい配置可能なパッケージを作成します。
6. 標準プロセスを使用して、カスタム コードを最初に UAT に配置し、次に製品に配置します。
7. 古いリリース分岐を破棄します。

## <a name="upload-update-and-deploy-store-components"></a><a id="upload-store-components"></a>店舗のコンポーネントをアップロード、更新、および配置する

1. 配置可能小売パッケージを LCS にアップロードします。
2. Application Object Server (AOS) を最新のクライアントで更新します。
3. 配置可能小売パッケージを資産ライブラリにアップロードします。

    + **以前の配置 (バージョン 10.0.11 より前):** ソフトウェア配置可能パッケージ
    + **新しい配置 (バージョン10.0.11 以降):** Retail セルフサービスのインストーラー

4. 店舗のコンポーネント用の新しいセルフサービス インストーラーで Commerce 本社を更新します。

    + **以前の配置 (バージョン 10.0.11 より前):** LCS を介して配置可能小売パッケージを Commerce 本社に配置します。
    + **新しい配置 (バージョン10.0.11 以降):** Commerce 本社の **Commerce パラメーター** フォームの **チャネル配置** タブで **パッケージの更新の確認** を選択します。 この更新では、LCS 資産ライブラリの **Retail セルフサービス パッケージ** タブで使用できるパッケージが導入されます。

5. クライアント バージョンをデバイスに割り当てます。
6. 目的のクライアント タイプとデバイスのインストーラーをダウンロードします。
7. 対象のデバイスにインストールします。
8. テストして検証します。


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]