---
title: Microsoft Dynamics AX 2012 から Dynamics 365 Finance + Operations にアップグレードするためにソース データをクリーンアップする
description: この記事では、Microsoft Dynamics AX 2012 から Dynamics 365 Finance + Operations (on-premises) へのアップグレードの一環としてソース データをクリーンアップする方法について説明します。
author: ttreen
ms.date: 10/06/2022
ms.topic: article
audience: Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: ttreen
ms.search.validFrom: ''
ms.search.form: 2022-04-08
ms.openlocfilehash: 8af77e9bb6cac72b80917235948fc5afd84ac5ed
ms.sourcegitcommit: 98231ff810f41f9fcdc6b536d87e453028aa6db8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/07/2022
ms.locfileid: "9640719"
---
# <a name="clean-up-source-data-for-upgrade-from-microsoft-dynamics-ax-2012-to-dynamics-365-finance--operations"></a>Microsoft Dynamics AX 2012 から Dynamics 365 Finance + Operations にアップグレードするためにソース データをクリーンアップする

[!include [banner](../includes/banner.md)]

この記事では、Microsoft Dynamics AX 2012 から Dynamics 365 Finance + Operations (on-premises) へのアップグレードの一環としてソース データをクリーンアップする方法について説明します。

> [!IMPORTANT]
> どのクリーンアップ ルーチンも、実行するのは、業務に関する詳細な分析が終了し、データが不要になったことを確認した後のみにしてください。
>
> 各クリーンアップ ルーチンは、運用環境で実行する前に必ずテスト環境でテストしてください。

## <a name="background"></a>背景

時間の経過と共に、Dynamics AX 2012 データベースはサイズが増大することがあります。 アップグレードの前に、データを削除またはアーカイブすることで、データベースのサイズを小さくすることができます。 これにより、データ アップグレードの完了までに要する時間を削減できます。

データのクリーンアップには、以下のいくつかのツールおよびプロセスを使用できます。

- [Dynamics AX インテリジェント データ管理フレームワーク ツール](#dynamics-ax-intelligent-data-management-framework-tool)
- [Microsoft Dynamics AX 2012 のクリーンアップ ルーチン](#cleanup-routines-in-microsoft-dynamics-ax-2012)
- [手動クリーンアップ](#manual-cleanup)

## <a name="dynamics-ax-intelligent-data-management-framework-tool"></a>Dynamics AX インテリジェント データ管理フレームワーク ツール

Dynamics AX Intelligent Data Management Framework (IDMF) ツールは現在更新されていませんが、Dynamics AX 2012 データベースのデータをアーカイブまたは削除するために使用できます。 詳細については、[Dynamics AX Intelligent Data Management Framework](/dynamicsax-2012/appuser-itpro/microsoft-dynamics-ax-intelligent-data-management-framework-idmf) を参照してください。

## <a name="cleanup-routines-in-microsoft-dynamics-ax-2012"></a>Microsoft Dynamics AX 2012 のクリーンアップ ルーチン

Dynamics AX 2012 の クリーンアップ ルーチンは、さまざまなモジュールで使用できます。 次の情報は、アップグレードの前にデータをクリーンアップするのに役立つ、現在利用できるルーチンの概要を示します。 この情報は、モジュール別にまとめられています。

### <a name="system-administration"></a>システム管理

| パス | Description |
|------|-------------|
| システム管理 \> 定期的なタスク \> 通知のクリーンアップ | <p>このクリーンアップ ルーチンは、EventInbox および EventInboxData テーブルから定期的にレコードを削除します。</p><p>**推奨:** 警告機能を使用しない場合は、バッチ ジョブからの警告をオフにします。</p> |
| システム管理 \> 照会 \> データベース \> データベース ログ \> クリーンアップ ログ | <p>このクリーンアップ ルーチンを使用すると、必要に応じてデータベース ログを削除できます。 特定のテーブルのログを削除したり、特定のタイプのデータベース ログを削除するなど、作成された日時に基づいてログを削除したりすることができます。</p><p>**注:** 電子署名されたレコードは、ログから削除できません。</p> |

### <a name="data-import-export-framework"></a>データのインポート/エクスポート フレームワーク

| パス | Description |
|------|-------------|
| データ インポート/エクスポート フレームワーク \>定期処理 \>ステージング クリーンアップ | このクリーンアップ ルーチンは、エンティティ、処理グループ、またはジョブ ID に基づいてステージング データをクリーンアップします。 |

### <a name="general-ledger"></a>一般会計

| パス | Description |
|------|-------------|
| 一般会計 \> 定期的なタスク \> 仕分元帳のクリーンアップ | <p>このクリーンアップ ルーチンでは、転記されている一般会計、売掛金勘定仕訳帳、および買掛金勘定仕訳帳を削除できます。 転記済の仕訳元帳を削除すると、元のトランザクションに関連付けられたすべての情報が削除されます。</p><p>**注:** 仕訳元帳トランザクションを取り消す必要がない場合にのみ、この情報を削除することができます。</p><p>主要記事: [転記済仕訳元帳の削除](/dynamicsax-2012/appuser-itpro/delete-posted-ledger-journals)</p> |

### <a name="sales-and-marketing"></a>販売とマーケティング

| パス | Description |
|------|-------------|
| 販売とマーケティング \> 定期処理タスク \> クリーンアップ \> 注文の削除 | このクリーンアップ ルーチンは、選択された販売注文を削除します。 |
| 販売とマーケティング \> 定期的なタスク \> クリーンアップ \> 見積書の削除 | このクリーンアップ ルーチンは、選択された見積書を削除します。 |
| 販売とマーケティング \> 定期的なタスク \> クリーンアップ \> 返品注文の削除 | このクリーンアップ ルーチンは、選択された返品注文を削除します。 |
| 販売とマーケティング \> 定期的なタスク \> クリーンアップ \> 販売更新履歴のクリーンアップ | <p>このクリーンアップ ルーチンは、古い更新履歴トランザクションを削除します。 確認書、ピッキング リスト、梱包明細、請求書のすべての更新は、更新履歴トランザクションを生成します。 これらのトランザクションは、**更新の履歴** ページで表示できます。</p><p>主要記事: [発注書または販売注文の更新履歴の削除](/dynamicsax-2012/appuser-itpro/delete-the-update-history-of-purchase-or-sales-orders)</p>|

### <a name="procurement-and-sourcing"></a>調達

| パス | Description |
|------|-------------|
| 調達 \> 定期的なタスク \> クリーンアップ \> 購入更新履歴のクリーンアップ | <p>このクリーンアップ ルーチンは、更新履歴トランザクションを生成した確認書、ピッキング リスト、製品受領書、請求書のすべての更新を削除します。 </p><p>主要記事: [発注書または販売注文の更新履歴の削除](/dynamicsax-2012/appuser-itpro/delete-the-update-history-of-purchase-or-sales-orders)</p> |
| 調達 \> 定期的なタスク \> クリーンアップ \> 見積依頼の削除 | このクリーンアップ ルーチンは、見積依頼 (RFQ) と RFQ の返信を削除します。 対応する RFQ 仕訳帳は削除されず、システム内に残ります。 |

### <a name="warehouse-management"></a>倉庫管理

| パス | Description |
|------|-------------|
| 倉庫管理 \> 定期処理タスク \> クリーンアップ \> 作業作成履歴の消去 | このクリーンアップ ルーチンは、WHSWorkCreateHistorytable テーブルから作業作成履歴レコードを削除します。 このダイアログ ボックスでは、履歴を保持する日数を指定します。 |
| 倉庫管理 \> 定期処理タスク \> クリーンアップ \> コンテナー詰め履歴の消去 | このクリーンアップ ルーチンは、WHSContainerizationHistory テーブルからコンテナー詰め履歴を削除します。 このダイアログ ボックスでは、履歴を保持する日数を指定します。 |
| 倉庫管理 \> 定期処理タスク \> クリーンアップ \> ウェーブ バッチのクリーンアップ | このクリーンアップ ルーチンは、ウェーブ処理バッチ グループに関連するバッチ ジョブ履歴レコードをクリーンアップします。 |
| 倉庫管理 \> 定期処理タスク \> クリーンアップ \> 循環棚卸計画のクリーンアップ | このクリーンアップ ルーチンは、循環棚卸計画の構成に関連するバッチ ジョブ履歴レコードをクリーンアップします。 |
| 倉庫管理 \> 定期処理タスク \> クリーンアップ \> モバイル デバイスの活動ログのクリーンアップ | このクリーンアップ ルーチンは、WHSMobileDeviceActivityLog テーブルからモバイル デバイスの活動ログ レコードを削除します。 このダイアログ ボックスでは、履歴を保持する日数を指定します。 |
| 倉庫管理 \> 定期的なタスク \> クリーンアップ \> 作業ユーザー セッション ログのクリーンアップ | このクリーンアップ ルーチンは、WHSWorkUserSessionLog テーブルから作業ユーザー セッション レコードを削除します。 このダイアログ ボックスでは、履歴を保持する時間数を指定します。 |

### <a name="inventory-management"></a>在庫管理

| パス | Description |
|------|-------------|
| 在庫管理 \> 定期処理タスク \> クリーンアップ \> 負荷調整の合計 | WMSLocationLoad テーブルは、品目およびパレットの重量および容積を追跡します。 WMSLocationLoad テーブルのレコード数を減らすために、**負荷調整の合計** ジョブを実行して、パフォーマンスを向上させることができます。 |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 在庫仕訳帳のクリーンアップ | <p>このクリーンアップ ルーチンは、転記済の在庫仕訳帳を削除します。</p><p>主要記事: [転記済在庫仕訳帳の削除](/dynamicsax-2012/appuser-itpro/delete-posted-inventory-journals)</p> |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 在庫決済のクリーンアップ | <p>このクリーンアップ ルーチンは、決算済在庫トランザクションをグループ化するか、または取消済在庫決済を削除します。 決算済在庫決済または削除済在庫決済のクリーンアップを行うと、システム リソースを解放することができます。</p><p>現在の日付や会計年度に近すぎる在庫決済をグループ化または削除しないでください。決済用のトランザクション情報の一部が失われる可能性があります。</p><p>決算済在庫トランザクションがグループ化された後は、決済のトランザクション情報が失われるので、変更することができなくなります。</p><p>キャンセルされた在庫決済を削除した場合、財務トランザクションで調整することはできません。</p> |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 在庫分析コードのクリーンアップ | <p>このクリーンアップ ルーチンは、InventDim テーブルを管理します。 バッチ処理では、現在の会社で定義されているが使用されていない既存のすべての在庫分析コードは削除されます。 使用されないすべての在庫分析コードは完全に削除されます。 このプロセス中に警告またはデータベース ログは作成されません。</p><p>このクリーンアップ ルーチンは、各 InventDim レコードが発注書明細行や 販売注文明細行だけでなく、在庫トランザクションまたは手持在庫レコードでも使用されているかを確認します。 InventDim への参照は、存在する場合は確認されます。 使用されていない場合は削除されます。 後で分析コードの同じ組み合わせを使用する場合、Dynamics 365 Finance と Dynamics 365 Supply Chain Management は、新しい **InventDimId** 値を持つ新しい InventDim レコードを作成し、代わりにそのレコードを使用します。</p> |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 在庫分析コードの不整合のクリーンアップ | <p>このクリーンアップ ルーチンは、財務的に更新と決済が完了した在庫トランザクションの分析コードの不整合を解決します。 アップグレード プロセスの前か最中にマルチサイト機能が有効になると、不整合が発生する場合があります。</p><p>このルーチンは、マルチサイト機能が有効になる前に決済されたトランザクションをクリーンアップする場合のみ使用します。</p><p>**注:** このルーティンを定期的に使用しないでください。</p> |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 手持在庫のエントリのクリーンアップ | <p>このクリーンアップ ルーチンは、一つ以上の追跡用分析コードに割り当てられる手持在庫の決算済および未使用のエントリを削除します。 決算済トランザクションはすべての数量および原価価値に **0** (ゼロ) の値を含み、決済済としてマークされます。 これらのトランザクションを削除すると、手持在庫に対するクエリのパフォーマンスを向上できます。 トランザクションは、追跡用分析コードに割り当てられていない手持在庫を削除しません。</p><p>主要記事: [終了した未使用の手持在庫トランザクションのクリーンアップ](/dynamicsax-2012/appuser-itpro/clean-up-closed-and-unused-on-hand-inventory-transactions)</p> |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 倉庫管理手持在庫エントリのクリーンアップ | このクリーンアップ ルーチンは、InventSum テーブルと WHSInventReserve テーブルのレコードを削除します。 これらのテーブルには、倉庫管理処理が有効になっている品目 (WHS 品目) の手持在庫情報が格納されます。 これらのレコードをクリーンアップすることにより、手持在庫計算を大幅に向上させることができます。 |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 財務分析コードによる手持在庫エントリの集約 | <p>このクリーンアップ ルーチンは、数量が 0 (ゼロ) である InventSum 行を集約するためのツールとして使用します。 このルーチンは、基本的には前述のルーチンを拡張するもので、**決済済** フィールドが **True** に設定されているレコードもクリーンアップします。</p><p>このルーチンは基本的に、在庫分析コードの組み合わせに対して、InventSum テーブル上の数量はなくなったものの、値はまだ存在するシナリオを処理するために必要です。 場合によっては、これらの値は削除されますが、現在の仕様では値が残ることがあります。</p><p>たとえば、バッチ番号を使用する場合、各バッチ番号 (および結合されたサイト、倉庫など) は、InventSum テーブルに新しいレコードを作成します。 そのバッチ番号が売れると、数量フィールドは **0** (ゼロ) に設定されます。 ほとんどの場合、**財務費用金額** フィールド、および **現物原価金額** フィールドも、**0** (ゼロ) に設定されます。 しかし、標準原価の再評価やその他のシナリオでは、フィールドに金額が表示される場合があります。 これは正しい動作であり、Finance および Supply Chain Management が財務在庫レベル (サイト レベルなど) で原価を処理する方法を反映しています。</p><p>Finance および Supply Chain Management では、在庫金額は InventSum テーブルのレコードによって決定されます。 過去の在庫金額が報告されるときに、在庫金額が在庫トランザクション (InventTrans テーブル) によって決定される場合もあります。 したがって、前に説明したシナリオでは、在庫金額のレポートを実行するときに、Finance および Supply Chain Management は、まず InventSum テーブルを確認し、すべてのレコードをサイト レベルで集計して、サイトごとの品目の値を報告します。</p><p>個々のレコードのデータがバッチ番号レベルで使用されることはありません。 したがって、このルーチンは、すべての InventSum レコードを調べて数量がなくなったレコードを検出します (つまり、**オープン数量なし** フィールドが **True** に設定されます)。 これらのレコードを保持する理由はないため、Finance および Supply Chain Management は、同じサイトで同じ品目の InventSum レコードを検索し、その値をバッチ番号レベルからサイト レベルにコピーしてから、レコードを削除します。 その後、在庫金額レポートを実行する場合でも、Finance および Supply Chain Management は同じ正しい値を検出します。 したがって、このルーチンは、場合によっては InventSum レコードの数を大幅に削減し、そのテーブルを照会するすべての機能でパフォーマンスを向上させることができます。</p> |
| 在庫管理 \> 定期的なタスク \> クリーンアップ \> 原価計算の詳細 | このクリーンアップ ルーチンは、原価計算の詳細をクリーンアップします。 |

### <a name="production-control"></a>生産管理

| パス | Description |
|------|-------------|
| 生産管理 \> 定期的なタスク \> クリーンアップ \> 登録データのクリーンアップ | <p>登録データを定期的にクリーンアップすることをお勧めします。 このクリーンアップ ルーチンは、処理されたデータのみを削除します。</p><p>**注:** 後に文書作成のために必要になる可能性がある登録データは削除しないように注意してください。</p> |
| 生産管理 \> 定期的なタスク \> クリーンアップ \> 計画登録をアーカイブに保存 | このクリーンアップ ルーチンは、作業登録テーブルから計画登録を削除します。 |
| 生産管理 \> 定期的なタスク \> クリーンアップ \> 生産仕訳帳のクリーンアップ | このクリーンアップ ルーチンは、使用されていない仕訳帳を削除します。 |
| 生産管理 \> 定期的なタスク \> クリーンアップ \> 製造オーダーのクリーンアップ | このクリーンアップ ルーチンは、終了した製造オーダーを削除します。 |

### <a name="master-planning"></a>マスター プラン

| パス | Description |
|------|-------------|
| マスター プラン \> 定期処理 \> 計画 \> 計画の削除 | **計画の削除** プロセスを使用して、選択した計画から現在のスケジューリングの結果を削除します。 データ (要求および計画オーダー) だけが削除され、計画そのものや計画のコンフィギュレーションは削除されません。 |

## <a name="manual-cleanup"></a>手動クリーンアップ

SQL スクリプトまたはカスタム x++ コードを使用して、データベース内のデータを直接クリーンアップできます。 これらのスクリプトは、顧客ごとに開発してテストする必要があります。

### <a name="clean-up-batch-job-history-tables-manual-cleanup"></a>バッチ ジョブ履歴テーブルのクリーンアップ (手動クリーンアップ)

次の表は、完全または部分的にクリーンアップできます。 これらの表にすぐに使用できるクリーンアップ スクリプトはありません。

- BatchJobHistory
- BatchHistory
- BatchConstraintsHistory
