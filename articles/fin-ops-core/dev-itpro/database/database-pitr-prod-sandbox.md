---
title: サンドボックス環境への生産データベースのポイントインタイム復元
description: このトピックでは、Microsoft Dynamics Lifecycle Services を使用して生産データベースのポイントインタイム復元を実行する方法について説明します。
author: LaneSwenka
ms.date: 12/15/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: IT Pro, Developer
ms.reviewer: sericks
ms.search.region: Global
ms.author: laswenka
ms.search.validFrom: 2020-02-29
ms.dyn365.ops.version: Platform update 33
ms.openlocfilehash: ef0198d694c971af9a93019e51aa7a0bd2a090e3
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5749327"
---
# <a name="point-in-time-restore-of-the-production-database-to-a-sandbox-environment"></a><span data-ttu-id="e831d-103">サンドボックス環境への生産データベースのポイントインタイム復元</span><span class="sxs-lookup"><span data-stu-id="e831d-103">Point-in-time restore of the production database to a sandbox environment</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="e831d-104">Microsoft Dynamics Lifecycle Services (LCS) を使用すると、ユーザー受け入れテスト(UAT)のサンドボックス環境に対して、本番データベースのポイント イン タイム復元(PITR)を実行できます。</span><span class="sxs-lookup"><span data-stu-id="e831d-104">You can use Microsoft Dynamics Lifecycle Services (LCS) to do a point-in-time restore (PITR) of the production database to a user acceptance testing (UAT) sandbox environment.</span></span> <span data-ttu-id="e831d-105">Microsoft は、業務および財務報告用のデータベースの[自動バックアップ](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups)を、実稼働環境の場合は 28 日間、サンドボックス環境の場合は 7 日間維持します。</span><span class="sxs-lookup"><span data-stu-id="e831d-105">Microsoft maintains [automated backups](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups) of the business and financial reporting databases for 28 days for Production environments and 7 days for Sandbox environments.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e831d-106">Microsoft は、実稼働レポートを目的とした実稼働データのサンドボックス環境へのコピーには対応していません。</span><span class="sxs-lookup"><span data-stu-id="e831d-106">Microsoft doesn't support copying production data to a sandbox environment for the purpose of production reporting.</span></span>

## <a name="self-service-point-in-time-restore-production-to-sandbox"></a><span data-ttu-id="e831d-107">セルフ サービスによる実稼働環境からサンドボックスへのポイント イン タイム復元</span><span class="sxs-lookup"><span data-stu-id="e831d-107">Self-service point-in-time restore Production to Sandbox</span></span>

<span data-ttu-id="e831d-108">Lifecycle Services チームは、手動または手動のプロセスに依存しないデータ アプリケーション ライフサイクル 管理 (DataALM) 機能を顧客に提供するために、データベースの自動更新アクションを導入しました。</span><span class="sxs-lookup"><span data-stu-id="e831d-108">To provide customers with data application lifecycle management (DataALM) capabilities that don't rely on human or manual processes, the Lifecycle Services team has introduced an automated refresh database action.</span></span> <span data-ttu-id="e831d-109">セルフ サービス データベースの更新‎を実行するプロセスの概要を次に示します。</span><span class="sxs-lookup"><span data-stu-id="e831d-109">Here is an overview of the process for doing a self-service database refresh.</span></span>

1. <span data-ttu-id="e831d-110">対象とするサンドボックスの **環境詳細** ページに移動し、 **管理** \> **データベースの移動** ボタンを選択します。</span><span class="sxs-lookup"><span data-stu-id="e831d-110">Go to the **Environment Details** page for your target Sandbox, and select **Maintain** \> **Move database** button.</span></span>
2. <span data-ttu-id="e831d-111">**実稼働環境からサンドボックス環境へのポイント イン タイム復元** オプションを選択し、対象とする時点を選択します。</span><span class="sxs-lookup"><span data-stu-id="e831d-111">Select the **Point-in-time restore Prod to Sandbox** option, and then select the desired point in time.</span></span>
3. <span data-ttu-id="e831d-112">警告に注意し、元の環境の前の時点からコピーされていないデータ要素のリストを確認します。</span><span class="sxs-lookup"><span data-stu-id="e831d-112">Make a note of the warnings, and review the list of data elements that aren't copied from the source environment's previous point in time.</span></span>
4. <span data-ttu-id="e831d-113">復元操作がすぐに開始されます。</span><span class="sxs-lookup"><span data-stu-id="e831d-113">The restore operation begins immediately.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e831d-114">セルフ サービスのポイントインタイム復元 (PITR) は、異なる地域にある環境間ではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="e831d-114">Self-service point in time restore (PITR) is not supported between environments that are on different regions.</span></span> <span data-ttu-id="e831d-115">詳細については、このトピックで後述する「既知の問題」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-115">For more details, refer to the "Known issues" section later in this topic.</span></span>

### <a name="restore-operation-failure"></a><span data-ttu-id="e831d-116">失敗した操作の復元</span><span class="sxs-lookup"><span data-stu-id="e831d-116">Restore operation failure</span></span>

<span data-ttu-id="e831d-117">復元操作が正常に行われない場合は、ロールバックできます。</span><span class="sxs-lookup"><span data-stu-id="e831d-117">If the restore operation isn't successful, you can do a rollback.</span></span> <span data-ttu-id="e831d-118">操作の最初の失敗をした後に **ロールバック** オプションを選択すると、対象となるサンドボックス環境がインポートの開始前の状態に戻されます。</span><span class="sxs-lookup"><span data-stu-id="e831d-118">If you select the **Rollback** option after the operation originally fails, your target sandbox environment is restored to the state that it was in before the refresh began.</span></span> <span data-ttu-id="e831d-119">ロールバックは Azure SQL Database の PITR 機能によって実現しています。</span><span class="sxs-lookup"><span data-stu-id="e831d-119">Rollbacks are made available by the PITR capability of Azure SQL Database.</span></span> <span data-ttu-id="e831d-120">対象とするサンドボックス環境に存在するカスタマイズが、新たに更新されたデータでデータベースの同期を完了できない場合に、これらが必要になります。</span><span class="sxs-lookup"><span data-stu-id="e831d-120">They are typically required if a customization that is present in the target sandbox environment can't complete a database synchronization with the newly refreshed data.</span></span>

<span data-ttu-id="e831d-121">失敗の根本原因を特定するには、ロールバック操作を開始する前に、使用可能なボタンを使用して Runbook ログをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="e831d-121">To determine the root cause of the failure, use the available buttons to download the runbook logs before you start the rollback operation.</span></span>

### <a name="data-elements-that-arent-copied-during-restore-copy"></a><span data-ttu-id="e831d-122">復元のコピー処理の過程でコピーされなかったデータ要素</span><span class="sxs-lookup"><span data-stu-id="e831d-122">Data elements that aren't copied during restore copy</span></span>

<span data-ttu-id="e831d-123">実稼働環境をサンドボックス環境に、またはサンドボックス環境を別のサンドボックス環境に更新する際に、対象の環境にコピーされない特定のデータベース要素が存在します。</span><span class="sxs-lookup"><span data-stu-id="e831d-123">When you refresh a production environment to a sandbox environment, or a sandbox environment to another sandbox environment, some elements of the database aren't copied over to the target environment.</span></span> <span data-ttu-id="e831d-124">次にいくつか例を挙げます。</span><span class="sxs-lookup"><span data-stu-id="e831d-124">Here are some examples:</span></span>

* <span data-ttu-id="e831d-125">LogisticsElectronicAddress テーブル内の電子メール アドレス。</span><span class="sxs-lookup"><span data-stu-id="e831d-125">Email addresses in the LogisticsElectronicAddress table.</span></span>
* <span data-ttu-id="e831d-126">BatchJobHistory、BatchHistory、および BatchConstraintHistory テーブルのバッチ ジョブ履歴。</span><span class="sxs-lookup"><span data-stu-id="e831d-126">Batch job history in the BatchJobHistory, BatchHistory, and BatchConstraintHistory tables.</span></span>
* <span data-ttu-id="e831d-127">SysEmailParameters テーブルの シンプル メール トランスファー プロトコル (SMTP) リレーサーバー。</span><span class="sxs-lookup"><span data-stu-id="e831d-127">Simple Mail Transfer Protocol (SMTP) Relay server in the SysEmailParameters table.</span></span>
* <span data-ttu-id="e831d-128">PrintMgmtSettings と PrintMgmtDocInstance テーブルの印刷管理設定。</span><span class="sxs-lookup"><span data-stu-id="e831d-128">Print Management settings in the PrintMgmtSettings and PrintMgmtDocInstance tables.</span></span>
* <span data-ttu-id="e831d-129">SysServerConfig、SysServerSessions、SysCorpNetPrinters、SysClientSessions、BatchServerConfig、および BatchServerGroup テーブル内の環境固有のレコード。</span><span class="sxs-lookup"><span data-stu-id="e831d-129">Environment-specific records in the SysServerConfig, SysServerSessions, SysCorpNetPrinters, SysClientSessions, BatchServerConfig, and BatchServerGroup tables.</span></span>
* <span data-ttu-id="e831d-130">DocuValue テーブル内のドキュメント添付ファイル。</span><span class="sxs-lookup"><span data-stu-id="e831d-130">Document attachments in the DocuValue table.</span></span> <span data-ttu-id="e831d-131">これらの添付ファイルには、ソース環境で上書きされたすべての Microsoft Office テンプレートが含まれます。</span><span class="sxs-lookup"><span data-stu-id="e831d-131">These attachments include any Microsoft Office templates that were overwritten in the source environment.</span></span>
* <span data-ttu-id="e831d-132">管理者以外のすべてのユーザーは **無効** のステータスに設定されます。</span><span class="sxs-lookup"><span data-stu-id="e831d-132">All users except the admin will be set to **Disabled** status.</span></span>
* <span data-ttu-id="e831d-133">すべてのバッチ ジョブは、 **保留** 状態に設定されます。</span><span class="sxs-lookup"><span data-stu-id="e831d-133">All batch jobs will be set to **Withhold** status.</span></span>
* <span data-ttu-id="e831d-134">すべてのユーザーのパーティション値は "初期" パーティション レコード ID にリセットされます。</span><span class="sxs-lookup"><span data-stu-id="e831d-134">All users will have their partition value reset to the "initial" partition record ID.</span></span>
* <span data-ttu-id="e831d-135">別のデータベースサーバーでは解読できないため、すべての Microsoft 暗号化フィールドはクリアされます。</span><span class="sxs-lookup"><span data-stu-id="e831d-135">All Microsoft-encrypted fields will be cleared, because they can't be decrypted on a different database server.</span></span> <span data-ttu-id="e831d-136">次の例は、sysemailsmtppasswordテーブルの **パスワード** フィールドです。</span><span class="sxs-lookup"><span data-stu-id="e831d-136">An example is the **Password** field in the SysEmailSMTPPassword table.</span></span>

<span data-ttu-id="e831d-137">これらの要素は、環境固有のものであるためコピーされません。</span><span class="sxs-lookup"><span data-stu-id="e831d-137">Some of these elements aren't copied because they are environment-specific.</span></span> <span data-ttu-id="e831d-138">この例には、BatchServerConfigおよびSysCorpNetPrintersの各レコードが含まれます。</span><span class="sxs-lookup"><span data-stu-id="e831d-138">Examples include BatchServerConfig and SysCorpNetPrinters records.</span></span> <span data-ttu-id="e831d-139">その他の要素は、サポート チケットのデータ量が多くなる懸念があるためコピーされません。</span><span class="sxs-lookup"><span data-stu-id="e831d-139">Other elements aren't copied because of the volume of support tickets.</span></span> <span data-ttu-id="e831d-140">たとえば、簡易メール転送プロトコル (SMTP) は UAT 環境でも有効になっているため、重複する電子メールが送信されてしまう可能性があります。また、バッチ ジョブも有効になっており、無効な統合メッセージが送信されてしまう可能性もあるため、管理者が更新後クリーンアップを行う前にユーザーが有効化してしまう可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-140">For example, duplicate emails might be sent because SMTP is still turned on in the UAT environment, invalid integration messages might be sent because batch jobs are still enabled, and users might be enabled before admins can perform post-refresh cleanup activities.</span></span>

### <a name="environment-administrator"></a><span data-ttu-id="e831d-141">環境管理者</span><span class="sxs-lookup"><span data-stu-id="e831d-141">Environment administrator</span></span>

<span data-ttu-id="e831d-142">対象の環境のシステム管理者アカウント (**Admin** の **UserId** 値を持つアカウント) が、対象の環境に存在する web.config ファイルで検出された値にリセットされます。</span><span class="sxs-lookup"><span data-stu-id="e831d-142">The system administrator account in the target environment (that is, the account that has a **UserId** value of **Admin**) is reset to the value that is found in the web.config file in the target environment.</span></span> <span data-ttu-id="e831d-143">この値は、LCS の管理者アカウントの値と一致している必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-143">This value should match the value of the administrator account in LCS.</span></span> <span data-ttu-id="e831d-144">このアカウントをプレビューするには、LCS で対象とするサンドボックス環境の **環境の詳細**  ページに移動します。</span><span class="sxs-lookup"><span data-stu-id="e831d-144">To preview this account, go to the **Environment Details** page for your target sandbox environment in LCS.</span></span> <span data-ttu-id="e831d-145">環境が最初に展開されたときに選択された **環境管理者** フィールドの値は、トランザクション データベースのシステム管理者アカウントと一致するように更新されます。</span><span class="sxs-lookup"><span data-stu-id="e831d-145">The value that was selected in the **Environment Administrator** field when the environment was first deployed is updated so that it matches the system administrator account in the transactional database.</span></span> <span data-ttu-id="e831d-146">したがって、環境のテナントは、環境管理者のテナントにもなります。</span><span class="sxs-lookup"><span data-stu-id="e831d-146">Therefore, the tenant of the environment will also be the tenant of the environment administrator.</span></span>

<span data-ttu-id="e831d-147">環境で管理者ユーザー プロビジョニング ツールを使用して、web.config ファイルの値を変更した場合、この値は LCS の値と一致しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-147">If you've used the Admin User Provisioning Tool on your environment to change the value in the web.config file, that value might not match the value in LCS.</span></span> <span data-ttu-id="e831d-148">別のアカウントを使用する必要がある場合は、対象のサンドボックス環境の割り当てを解除して削除し、再度展開して別のアカウントを選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-148">If you require that a different account be used, you must deallocate and delete the target sandbox environment, and then redeploy it and select another account.</span></span> <span data-ttu-id="e831d-149">その後、別のデータベース更新アクションを実行してデータを復元できます。</span><span class="sxs-lookup"><span data-stu-id="e831d-149">You can then perform another refresh database action to restore the data.</span></span>

<span data-ttu-id="e831d-150">あるテナントから別のテナントに環境を更新することはできません。</span><span class="sxs-lookup"><span data-stu-id="e831d-150">An environment can't be refreshed from one tenant to another.</span></span> <span data-ttu-id="e831d-151">この制限は、onmicrosoft.com テナントにも適用されます。</span><span class="sxs-lookup"><span data-stu-id="e831d-151">This restriction applies even to .onmicrosoft.com tenants.</span></span> <span data-ttu-id="e831d-152">ソース環境とターゲット環境の管理者アカウントが、同じテナント ドメインからのものであることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-152">You should make sure that the admin accounts in the source and target environments are from the same tenant domain.</span></span>

### <a name="conditions-for-doing-a-pitr-copy-of-a-production-environment-to-a-sandbox-environment"></a><span data-ttu-id="e831d-153">運用環境の PITR コピーをサンドボックス環境にコピーする条件</span><span class="sxs-lookup"><span data-stu-id="e831d-153">Conditions for doing a PITR copy of a production environment to a sandbox environment</span></span>

<span data-ttu-id="e831d-154">データベース更新の操作の要件および条件の一覧を次に示します。</span><span class="sxs-lookup"><span data-stu-id="e831d-154">Here is the list of requirements and conditions of operation for a database refresh:</span></span>

- <span data-ttu-id="e831d-155">更新処理では、実行対象のデータベースで削除が実行されます。</span><span class="sxs-lookup"><span data-stu-id="e831d-155">A refresh performs a delete operation on the original target database.</span></span>
- <span data-ttu-id="e831d-156">ターゲット環境は、データベースのコピーがターゲット サーバーに達するまで使用可能です。</span><span class="sxs-lookup"><span data-stu-id="e831d-156">The target environment will be available until the database copy has reached the target server.</span></span> <span data-ttu-id="e831d-157">その時点以降は、更新プロセスが完了するまで、ターゲット環境はオフラインになります。</span><span class="sxs-lookup"><span data-stu-id="e831d-157">After that point, the environment will be offline until the refresh process is completed.</span></span>
- <span data-ttu-id="e831d-158">リフレッシュは、アプリケーションおよび Financial Reporting データベースにのみ影響します。</span><span class="sxs-lookup"><span data-stu-id="e831d-158">The refresh will affect only the application and Financial Reporting databases.</span></span>
- <span data-ttu-id="e831d-159">Azure blob storage のドキュメントは、環境間でのコピーができません。</span><span class="sxs-lookup"><span data-stu-id="e831d-159">Documents in Azure Blob storage aren't copied from one environment to another.</span></span> <span data-ttu-id="e831d-160">したがって、添付されたドキュメントを処理するドキュメントとテンプレートは変更されず、現在の状態のままとなります。</span><span class="sxs-lookup"><span data-stu-id="e831d-160">Therefore, attached document handling documents and templates won't be changed and will remain in their current state.</span></span>
- <span data-ttu-id="e831d-161">管理者ユーザー、およびその他の内部サービス ユーザー アカウントを除くすべてのユーザーは使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="e831d-161">All users except the Admin user and other internal service user accounts will be unavailable.</span></span> <span data-ttu-id="e831d-162">そのため、管理者ユーザーは他のユーザーがシステムに復帰する前にデータの削除や難読化することができます。</span><span class="sxs-lookup"><span data-stu-id="e831d-162">Therefore, the Admin user can delete or obfuscate data before  other users are allowed back into the system.</span></span>
- <span data-ttu-id="e831d-163">管理者ユーザーは、特定のサービスまたは URL に統合エンドポイントを再接続するなど、必要な構成の変更を加える必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-163">The Admin user must make required configuration changes, such as reconnecting integration endpoints to specific services or URLs.</span></span>
- <span data-ttu-id="e831d-164">定期的なインポートおよびエクスポート ジョブを持つすべてのデータ管理フレームワークは、復元を開始する前に、対象のシステムを完全に処理して停止する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-164">All data management integration jobs that have recurring import and export enabled must be fully processed and stopped in the target system before the restore is started.</span></span> <span data-ttu-id="e831d-165">さらに、すべての定期的なインポートおよびエクスポート ジョブが完全に処理された後に、データベースをソースから選択することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e831d-165">In addition, we recommend that you select the database from the source after all recurring import and export jobs have been fully processed.</span></span> <span data-ttu-id="e831d-166">このようにして、Azure ストレージ内のいずれのシステムからも孤立ファイルがないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-166">In this way, you ensure that there are no orphaned files from either system in Azure storage.</span></span> <span data-ttu-id="e831d-167">対象の環境でデータベースを復元した後は、孤立したファイルを処理できないため、この手順は重要となります。</span><span class="sxs-lookup"><span data-stu-id="e831d-167">This step is important because orphaned files can't be processed after the database is restored in the target environment.</span></span> <span data-ttu-id="e831d-168">復元後、統合ジョブを再開することができます。</span><span class="sxs-lookup"><span data-stu-id="e831d-168">After the restore, the integration jobs can be resumed.</span></span>
- <span data-ttu-id="e831d-169">ビジネス イベントは、同じ終了点が使用されないように、データベースが復元される環境で終了ポイントを削除して再構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-169">Business events end points must be deleted and reconfigured in the environment where the database is restored to ensure the same end points are not used.</span></span> <span data-ttu-id="e831d-170">また、ビジネスイベントを非アクティブにし、環境で構成されていた新しいエンドポイントに対して、再度有効化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-170">This will also require the business events to be deactivated and re-activated to the new end points that were configured in the environment.</span></span>
- <span data-ttu-id="e831d-171">LCSにてプロジェクトの所有者、または環境マネージャの役割を持つすべてのユーザーは、本稼働以外のすべての環境の SQL およびマシンの資格情報にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="e831d-171">Any user who has the Project owner or Environment manager role in LCS will have access to the SQL and machine credentials for all non-production environments.</span></span>
- <span data-ttu-id="e831d-172">データベースが Spartan で管理されていない場合は、データベースを同じ地理上の Azure リージョンでホストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-172">The databases must be hosted in the same Azure geographic region, unless the databases are Spartan-managed.</span></span>  <span data-ttu-id="e831d-173">SQL server の完全修飾アドレスの一部に ' spartan ' が含まれていれば、データベースは Spartan に管理されています。</span><span class="sxs-lookup"><span data-stu-id="e831d-173">Databases are Spartan-managed when you see 'spartan' as part of the fully qualified SQL server address.</span></span>
- <span data-ttu-id="e831d-174">実行元の環境で割り当てられたデータベースの容量は、実行対象の環境のデータベースの最大容量よりも小さくする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-174">The allocated database capacity of the source environment must be less than the maximum database capacity of the target environment.</span></span>

## <a name="steps-to-complete-after-a-restore-is-done-for-environments-that-use-commerce-functionality"></a><span data-ttu-id="e831d-175">コマース機能を使用する環境で復元後に実行する手順</span><span class="sxs-lookup"><span data-stu-id="e831d-175">Steps to complete after a restore is done for environments that use Commerce functionality</span></span>

[!include [environment-reprovision](../includes/environment-reprovision.md)]

## <a name="known-issues"></a><span data-ttu-id="e831d-176">既知の問題</span><span class="sxs-lookup"><span data-stu-id="e831d-176">Known issues</span></span>

### <a name="restore-is-denied-for-environments-that-run-platform-update-20-or-earlier"></a><span data-ttu-id="e831d-177">プラットフォーム 更新プログラム 20 以前が稼働している環境では、復元は拒否されます</span><span class="sxs-lookup"><span data-stu-id="e831d-177">Restore is denied for environments that run Platform update 20 or earlier</span></span>

<span data-ttu-id="e831d-178">現在、環境がプラットフォーム更新プログラム 20 またはそれ以前を実行している場合は、データベースの更新プロセスを完了することはできません。</span><span class="sxs-lookup"><span data-stu-id="e831d-178">The database refresh process can't currently be completed if the environment is running Platform update 20 or earlier.</span></span> <span data-ttu-id="e831d-179">詳細については、[現在サポートされているプラットフォーム更新の一覧](../migration-upgrade/versions-update-policy.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-179">For more information, see the [list of currently supported platform updates](../migration-upgrade/versions-update-policy.md).</span></span>

### <a name="the-source-and-target-environments-have-incompatible-versions-of-financial-reporting"></a><span data-ttu-id="e831d-180">実行元の環境と実行対象の環境に互換性のないバージョンの Financial Reporting が存在します</span><span class="sxs-lookup"><span data-stu-id="e831d-180">The source and target environments have incompatible versions of Financial Reporting</span></span>

<span data-ttu-id="e831d-181">実行対象とする環境の Financial Reporting のバージョンが実行元の環境のバージョンよりも古い場合は、データベースの更新プロセス (セルフ サービスまたはサービス リクエスト経由) が正常に完了できません。</span><span class="sxs-lookup"><span data-stu-id="e831d-181">The database refresh process (self-service or via a service request) can't be successfully completed if the version of Financial Reporting in your target environment is earlier than the version in your source environment.</span></span> <span data-ttu-id="e831d-182">この問題を解決するには、両方の環境で財務報告が最新バージョンとなるように更新を行ってください。</span><span class="sxs-lookup"><span data-stu-id="e831d-182">To resolve this issue, update both environments so that they have the latest version of Financial Reporting.</span></span>

<span data-ttu-id="e831d-183">実行対象と実行元の環境にインストールされているバージョンを確認するには、**環境の詳細** ページの **詳細バージョン情報を表示する** のリンクを確認してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-183">To determine the version that is installed in your source and target environments, select **View detailed version information** on the **Environment Details** page.</span></span> <span data-ttu-id="e831d-184">続いて、**MRApplicationService** を検索し、実行対象の環境のバージョンが実行元の環境のバージョンと同じであるか、高いバージョンであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e831d-184">Then search for **MRApplicationService**, and make sure that the version in the target environment is later than or the same as the version in the source environment.</span></span>

<img src="media/FinancialReporting_Binaries2.png" width="500px" alt="MRApplicationService">

<span data-ttu-id="e831d-185">バージョン 8.1 またはそれ以降を使用しているお客様は、次の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-185">Customers that are using version 8.1 or later should follow these steps.</span></span>

1. <span data-ttu-id="e831d-186">**更新** のタイルメニューを開き、UAT環境を更新します。</span><span class="sxs-lookup"><span data-stu-id="e831d-186">Go to the **Update** tiles for your UAT environment.</span></span> <span data-ttu-id="e831d-187">更新内容をプロジェクトの資産ライブラリに保存します。</span><span class="sxs-lookup"><span data-stu-id="e831d-187">Save the updates to your Project asset library.</span></span>
2. <span data-ttu-id="e831d-188">パッケージを UAT 環境に適用します。</span><span class="sxs-lookup"><span data-stu-id="e831d-188">Apply the package to your UAT environment.</span></span>
3. <span data-ttu-id="e831d-189">エラーが解決されたことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-189">Verify that the error has been resolved.</span></span>

<span data-ttu-id="e831d-190">バージョン 8.0 またはそれ以前を使用しているお客様は、次の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-190">Customers that are using version 8.0 or earlier should follow these steps.</span></span>

1. <span data-ttu-id="e831d-191">実行元の環境の環境履歴を確認してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-191">Review the environment history of your source environment.</span></span> <span data-ttu-id="e831d-192">具体的には、「プラットフォームおよびアプリケーションのバイナリ パッケージ」のいずれかが実行元の環境に展開されていることを確認します。実行対象の環境ではありませんのでご注意ください。</span><span class="sxs-lookup"><span data-stu-id="e831d-192">Specifically, look for any "Platform and application binary package" package that has been deployed to the source environment but not to the target environment.</span></span>
2. <span data-ttu-id="e831d-193">バイナリ パッケージを実行対象の環境に適用します。</span><span class="sxs-lookup"><span data-stu-id="e831d-193">Apply the binary package to your target environment.</span></span>
3. <span data-ttu-id="e831d-194">エラーが解決されたことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-194">Verify that the error has been resolved.</span></span>

### <a name="the-source-and-target-environments-have-incompatible-application-versions"></a><span data-ttu-id="e831d-195">実行元の環境と実行対象の環境間での互換性のないアプリケーション バージョンが存在します</span><span class="sxs-lookup"><span data-stu-id="e831d-195">The source and target environments have incompatible application versions</span></span>

<span data-ttu-id="e831d-196">実行元の環境のアプリケーション リリースと実行対象の環境のアプリケーション リリースが異なる場合は、データベースの更新プロセス (セルフ サービスまたはサービスリクエスト経由) を完了できません。</span><span class="sxs-lookup"><span data-stu-id="e831d-196">The database refresh process (self-service or via service request) can't be completed if the application release of your source environment and the application release of your target environment aren't the same.</span></span> <span data-ttu-id="e831d-197">これは、データの更新プロセスが、更新などのデータベースの移動操作によって実行されず、データ損失が発生する可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="e831d-197">Because the data upgrade process isn't run by using database movement operations such as refresh, data loss can occur.</span></span>

<span data-ttu-id="e831d-198">新しいアプリケーション バージョンにサンドボックス UAT 環境をアップグレードする場合は (たとえば、7.3 から 8.1 など)、必ずアップグレードを開始する前にデータベースの更新アクションを実行してください。</span><span class="sxs-lookup"><span data-stu-id="e831d-198">If you're upgrading your sandbox UAT environment to a newer application version (for example, from 7.3 to 8.1), be sure to perform the database refresh action before you start the upgrade.</span></span> <span data-ttu-id="e831d-199">サンドボックス環境が新しいバージョンにアップグレードされた後は、サンドボックス UAT 環境に古い実稼働環境データベースを復元することはできません。</span><span class="sxs-lookup"><span data-stu-id="e831d-199">After your sandbox environment is upgraded to the newer version, you can't restore an older production environment database to the sandbox UAT environment.</span></span>

<span data-ttu-id="e831d-200">逆に、実稼働環境が実行対象のサンドボックス環境よりも新しい場合は、更新前に対象のサンドボックス環境をアップグレードするか、更新の実行前に環境の割り当て解除、削除、および再展開をする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e831d-200">Conversely, if your production environment is newer than your target sandbox environment, you must either upgrade the target sandbox environment before the refresh, or just deallocate, delete, and redeploy the environment before you do the refresh.</span></span>

### <a name="the-source-and-target-are-on-different-infrastructure-microsoft-managed-vs-self-service"></a><span data-ttu-id="e831d-201">異なるインフラストラクチャ (Microsoft による管理対セルフ サービス) 上にあるソースおよびターゲット</span><span class="sxs-lookup"><span data-stu-id="e831d-201">The source and target are on different infrastructure (Microsoft-managed vs. self-Service)</span></span>

<span data-ttu-id="e831d-202">PITR プロセスは、異なる地域間の Microsoft による管理およびセルフ サービス環境間でサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="e831d-202">The PITR process is not supported between Microsoft-managed and self-service environments across different regions.</span></span> <span data-ttu-id="e831d-203">たとえば、実稼働環境が Microsoft によって管理されており、米国東部 2 で、セルフ サービスのサンドボックス環境に PITR が必要な場合、米国東部では PITR はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="e831d-203">For example, if the production environment is Microsoft-managed and in East US2 and a PITR is needed to the sandbox environment, which is self-service and in East US, PITR is not supported.</span></span> <span data-ttu-id="e831d-204">代わりに、実稼働環境をセルフ サービスに移動するか、定期的なデータベース更新を選択することもできます。</span><span class="sxs-lookup"><span data-stu-id="e831d-204">The alternative is to move the production environment to self-service or opt for a regular database refresh instead.</span></span>

### <a name="point-in-time-restore-between-source-and-target-that-are-both-on-self-service-in-different-regions"></a><span data-ttu-id="e831d-205">異なる地域で、両方ともセルフ サービスにあるソースとターゲット間のポイントインタイム復元</span><span class="sxs-lookup"><span data-stu-id="e831d-205">Point in time restore between source and target that are both on self-Service, in different regions</span></span>
<span data-ttu-id="e831d-206">PITR プロセスは、異なる地域間のセルフ サービス環境間ではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="e831d-206">The PITR process is not supported between self-service environments across different regions.</span></span> <span data-ttu-id="e831d-207">たとえば、実稼働環境が米国東部にあり、セルフ サービスのサンドボックス環境に PITR が必要な場合、西ヨーロッパでは PITR はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="e831d-207">For example, if the production environment is in East US and a PITR is needed for the sandbox environment, which is self-service and in West Europe, PITR is not supported.</span></span> <span data-ttu-id="e831d-208">代わりに、環境を両方とも同じ地域にするか、定期的なデータベース更新を選択することもできます。</span><span class="sxs-lookup"><span data-stu-id="e831d-208">The alternative is to get both the environments in the same region or opt for a regular database refresh instead.</span></span>



[!INCLUDE[footer-include](../../../includes/footer-banner.md)]