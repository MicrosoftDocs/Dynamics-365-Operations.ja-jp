---
title: 勘定科目の組み合せ
description: このトピックでは、分析コードフレームワークにおける勘定科目の組み合わせに関する情報を提供します。
author: jasonsto
ms.date: 05/01/2019
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Developer
ms.reviewer: rhaertle
ms.custom: 11314
ms.assetid: 20e6b97e-30ed-48d4-b63c-a073f80300b2
ms.search.region: Global
ms.author: rbrow
ms.search.validFrom: 2019-01-16
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: 3c6778764ee4f81f4b9a27dd2170c8bda4af66a8
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5753926"
---
# <a name="ledger-account-combinations"></a><span data-ttu-id="ac76d-103">勘定科目の組み合せ</span><span class="sxs-lookup"><span data-stu-id="ac76d-103">Ledger account combinations</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="ac76d-104">はじめに</span><span class="sxs-lookup"><span data-stu-id="ac76d-104">Introduction</span></span>

<span data-ttu-id="ac76d-105">Microsoft Dynamics AX 2009では、分析コードの数が最小で3、最大10に制限されていました。</span><span class="sxs-lookup"><span data-stu-id="ac76d-105">In Microsoft Dynamics AX 2009, the number of dimensions was limited to a minimum of three and a maximum of ten.</span></span> <span data-ttu-id="ac76d-106">また、分析コードは固定された順序で入力されていました。</span><span class="sxs-lookup"><span data-stu-id="ac76d-106">Additionally, the dimensions were entered in a fixed order.</span></span> <span data-ttu-id="ac76d-107">そのため、コードのカスタマイズとデータベースの同期は、追加されたすべての分析コードに対して必要でした。</span><span class="sxs-lookup"><span data-stu-id="ac76d-107">Therefore, code customization and database synchronization were required for every dimension that was added.</span></span> <span data-ttu-id="ac76d-108">その後、Microsoft Dynamics AX 2012 では、分析コードのフレームワークが拡張され、最大 50 まで分析コード数を増やすことができるようになりました (テーブルの合計列数の SQL データベース制限による)。</span><span class="sxs-lookup"><span data-stu-id="ac76d-108">Then, in Microsoft Dynamics AX 2012, the dimension framework was expanded to allow for a greater number of dimensions - up to ~50 (due to SQL database limits on total column counts in our tables).</span></span> <span data-ttu-id="ac76d-109">ユーザーは動的に分析コードを作成し、任意の順序で入力することもできます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-109">The user could also dynamically create dimensions and enter them in any order.</span></span> <span data-ttu-id="ac76d-110">Finance and Operations は AX 2012の動作を引き継いでいます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-110">Finance and Operations keeps the behavior from AX 2012.</span></span> <span data-ttu-id="ac76d-111">当モデルでは制限が取り払われており、リレーショナルデータベースの設計によるメリットと、パフォーマンス要件の最適化によって、従来と比べて複雑なデータモデルを構成することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-111">The unlimited nature of the model, the advantages that come from relational database design, and optimization for performance requirements have led to a data model that is more complex than any earlier data model.</span></span>

## <a name="part-1-what-happens-when-i-create-a-ledger-account-combination"></a><span data-ttu-id="ac76d-112">第1部:勘定科目の組み合わせを作成することで何が起こるか</span><span class="sxs-lookup"><span data-stu-id="ac76d-112">Part 1: "What happens when I create a ledger account combination?"</span></span>

<span data-ttu-id="ac76d-113">このトピックでは、分析コードフレームワークを構成するさまざまな領域と、それらがどのように連携するかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-113">This part of the topic describes the various areas of the dimension framework and how they work together.</span></span> <span data-ttu-id="ac76d-114">この情報を参照することで、勘定科目の組み合わせによってできることがより分かりやすくなります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-114">This information will help you better understand what happens when you create a combination of ledger accounts.</span></span>

<span data-ttu-id="ac76d-115">以下の図は、分析コードフレームワークを構成するさまざまな領域を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-115">The following illustration shows a model of the various areas of the dimension framework.</span></span>

<span data-ttu-id="ac76d-116">[![フレームワーク分析コード](./media/DimensionsFrameworkGraph.png)](./media/DimensionsFrameworkGraph.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-116">[![Dimension framework](./media/DimensionsFrameworkGraph.png)](./media/DimensionsFrameworkGraph.png)</span></span>

<span data-ttu-id="ac76d-117">このトピックでは、上記の図で黄色で強調表示されている箇所 [分析コード]、[分析コード値]、[分類]、 [補助要素] について説明します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-117">This part of the topic covers the "Dimensions," "Dimension Values," "Categorizations," and "Backing Entities" regions that are highlighted in yellow in the preceding illustration.</span></span>

### <a name="dimension-attributes"></a><span data-ttu-id="ac76d-118">分析コードの属性</span><span class="sxs-lookup"><span data-stu-id="ac76d-118">Dimension attributes</span></span>

<span data-ttu-id="ac76d-119">分析コード属性は、単に分析コードとも称され、勘定科目の組み合わせと関連付ける情報を分類する追加要素を意味します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-119">A dimension attribute, which will be referred to as just a dimension, represents an additional piece of classifying information that a user wants to associate with a ledger account combination.</span></span> <span data-ttu-id="ac76d-120">これは具体的なインスタンスではなく、要素の種類を意味します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-120">It represents classes of things, not specific instances.</span></span> <span data-ttu-id="ac76d-121">分析コードの作成に使用できる要素は、システム上に存在するエンティティクラス (部門、原価部門、経費の目的、顧客、仕入先、品目など)、または、特定のインストールに特化したカスタムエンティティ (ライセンスプレート番号、イベント名、およびチケット番号など) のいずれかです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-121">All the things that can be used to create a dimension are either classes of entities that already exist in the system (for example, department, cost center, expense purpose, customer, vendor, and item) or custom entities that are specific to a particular installation (for example, license plate number, event name, and ticket number).</span></span>

<span data-ttu-id="ac76d-122">分析コードが作成されると、ユーザーは値の取得元を選択できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-122">When a dimension is created, the user can choose where its values come from.</span></span> <span data-ttu-id="ac76d-123">分析コード値は、顧客または部門エンティティなどのシステム上に存在するエンティティやユーザーが作成したカスタムリストから取得できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-123">Dimension values can come from an existing entity in the system, such as Customer or Department entities, or from a custom list that the user creates.</span></span> <span data-ttu-id="ac76d-124">定義された各分析コードについて、分析コードフレームワークはシステム内のテーブルへの参照を追跡します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-124">For each dimension that is defined, the dimension framework keeps track of a reference to a table in the system.</span></span> <span data-ttu-id="ac76d-125">たとえば、既存の顧客エンティティについては、CustTable テーブルへの参照が使用されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-125">For example, for the existing Customer entity, a reference to the CustTable table is used.</span></span> <span data-ttu-id="ac76d-126">ユーザーが定義したカスタムエンティティの場合は、DimensionFinancialTagテーブルへの参照が使用されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-126">For custom entities that are defined by the user, a reference to the DimensionFinancialTag table is used.</span></span> <span data-ttu-id="ac76d-127">DimensionAttributeテーブルには、各分析コードを表すメタデータが格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-127">The metadata about what each dimension represents is stored in the DimensionAttribute table.</span></span>

<span data-ttu-id="ac76d-128">以下の図では、 **財務分析コード** ページに2つの分析コードが表示されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-128">In the example in the following illustration, there are two dimensions on the **Financial dimensions** page.</span></span> <span data-ttu-id="ac76d-129">顧客分析コードには、アプリケーションに既に存在する顧客が表示され、LicensePlate分析コードは新しいカスタムリストが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-129">The Customer dimension represents customers that already exist in the application, and the LicensePlate dimension represents a new custom list.</span></span>

<span data-ttu-id="ac76d-130">[![財務分析コード](./media/FinancialDimensions.png)](./media/FinancialDimensions.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-130">[![Financial dimensions page](./media/FinancialDimensions.png)](./media/FinancialDimensions.png)</span></span>

<span data-ttu-id="ac76d-131">それぞれの分析コードは、DimensionAttributeテーブルに格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-131">The data about each dimension is stored in the DimensionAttribute table.</span></span> <span data-ttu-id="ac76d-132">下図のSQLクエリは、各分析コードに関連付けられている基本情報の一部を表示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-132">The SQL query in the following illustration shows some of the basic information that is associated with each dimension.</span></span>

<span data-ttu-id="ac76d-133">[![DimensionAttribute テーブルのクエリ結果](./media/FinancialDimensionSQL.png)](./media/FinancialDimensionSQL.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-133">[![Query results for DimensionAttribute storage](./media/FinancialDimensionSQL.png)](./media/FinancialDimensionSQL.png)</span></span>

<span data-ttu-id="ac76d-134">**Type** の値は、分析コードがシステム上に存在しているエンティティと結びついているのか、もしくはカスタムリストと結びついているのかを表しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-134">The **Type** value indicates whether the dimension is backed by an existing entity in the system or a custom list.</span></span> <span data-ttu-id="ac76d-135">ただし、分析コード フレームワークは、CustTable のような既存エンティティのバッキング テーブルに対する直接参照は行いません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-135">The dimension framework doesn't directly reference the backing table for an existing entity, such as CustTable.</span></span> <span data-ttu-id="ac76d-136">その代わりに、システム上でエンティティを使用できるようにカスタムビューが作成されるため、それを分析コードフレームワークで使用できるるようになります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-136">Instead, a custom view is created to make an entity available in the system, so that it can be used in the dimension framework.</span></span> <span data-ttu-id="ac76d-137">初期設定では、36 の既存エンティティを分析コードとして使用できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-137">By default, 36 existing entities can be used as dimensions.</span></span>

<span data-ttu-id="ac76d-138">同じエンティティから複数の分析コードを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-138">More than one dimension can be created based on the same entity.</span></span> <span data-ttu-id="ac76d-139">トランザクションアクティビティがシステム内で分類される場合は、classifiedシステム内のエンティティが複数の目的に使用されることがあります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-139">Sometimes, an entity in the system might be used for multiple purposes when transaction activity is classified in the system.</span></span> <span data-ttu-id="ac76d-140">この場合、1つのエンティティに対して複数の分析コードを定義できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-140">In this case, multiple dimensions can be defined for the entity, one for each purpose.</span></span> <span data-ttu-id="ac76d-141">代表的な例としては、原価部門のバッキングエンティティは、主原価部門 (販売など) と売買が行われる原価部門 (購買など) の両方を表します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-141">A typical example is a cost center backing entity that is used to represent both the primary cost center (for example, selling) and the cost center that the transaction is being traded against (for example, purchasing).</span></span>

<span data-ttu-id="ac76d-142">内部的には、分析コード フレームワークの主要な機能に対応できるように自動的に作成される特殊な分析コードが存在します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-142">Internally, special dimensions exist that are automatically created to support key functionality of the dimension framework.</span></span> <span data-ttu-id="ac76d-143">MainAccount 分析コードが主要な例です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-143">A primary example is the MainAccount dimension.</span></span> <span data-ttu-id="ac76d-144">この機能により、分析コードフレームワークが主勘定を分析コードとして扱うことができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-144">This functionality lets the dimension framework treat a main account as a dimension.</span></span> <span data-ttu-id="ac76d-145">ただし、ユーザーが主勘定を使用して分析コードを作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-145">However, it also prevents users from using a main account to create a dimension.</span></span> <span data-ttu-id="ac76d-146">その他のタイプの特殊分析コードは、システムによって生成される分析コードです。これは分析コードフレームワークが内部使用する目的で生成されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-146">The other types of special dimensions are system-generated dimensions that the dimension framework uses for internal purposes.</span></span>

### <a name="dimension-attribute-values"></a><span data-ttu-id="ac76d-147">分析コードの属性値</span><span class="sxs-lookup"><span data-stu-id="ac76d-147">Dimension attribute values</span></span>

<span data-ttu-id="ac76d-148">分析コードの属性値は、分析コードの中でも特殊なインスタンスで、分析コードフレームワークで使用されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-148">A dimension attribute value is a specific instance of a dimension that is used in the dimension framework.</span></span> <span data-ttu-id="ac76d-149">分析コードの値は、DimensionAttribute レコードにて指定されている **ViewName** プロパティによって決定されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-149">The values for a dimension are determined by the **ViewName** property that is specified on the DimensionAttribute record.</span></span> <span data-ttu-id="ac76d-150">CustTable などの既存エンティティの場合、値はそのテーブル内のレコードで構成されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-150">For an existing entity, such as CustTable, values consist of the records in that table.</span></span> <span data-ttu-id="ac76d-151">カスタム リストの場合、値は DimensionFinancialTag テーブルの特定のレコード セットで構成されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-151">For a custom list, values consist of a specific set of records in the DimensionFinancialTag table.</span></span> <span data-ttu-id="ac76d-152">特定の分析コードに使用可能となる値を参照するには、 **財務分析コード** ページ内の **財務分析コード値** ボタンを選択します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-152">You can view the values that are available for a specific dimension by selecting the **Financial dimension values** button on the **Financial dimensions** page.</span></span>

<span data-ttu-id="ac76d-153">エンティティが複数の値が提示した場合、ユーザーは **財務分析** ページから値を編集することはできません。CustTableなどがこれに該当します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-153">If the list of values is provided by an existing entity, such as CustTable, the user can't edit it from the **Financial dimensions** page.</span></span> <span data-ttu-id="ac76d-154">顧客 メニューで使用する新しい分析コード値を作成するには、 **顧客** ページに直接移動して、新しい顧客を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-154">To create a new dimension value for Customer, the user must go directly to the **Customer** page and create a new customer.</span></span> <span data-ttu-id="ac76d-155">新しい顧客を作成すると、分析コードフレームワークで使用できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-155">After the new customer is created, it can be used in the dimension framework.</span></span> <span data-ttu-id="ac76d-156">ユーザーが作成したカスタムリストが複数の値が提示した場合、 **財務分析** ページにて直接値を編集することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-156">If the list of values is provided by the user as a custom list, the user can edit the list directly on the **Financial dimensions** page.</span></span>

<span data-ttu-id="ac76d-157">以下の図は、CustTableが表示する値の一覧の例を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-157">The following illustration shows an example of a list of values that is provided by CustTable.</span></span> <span data-ttu-id="ac76d-158">以下例では、分析コードフレームワークには値が格納されていません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-158">In this case, no values are stored in the dimension framework.</span></span>

<span data-ttu-id="ac76d-159">[![財務分析コード値ページ (既存のリスト)](./media/FinancialDimensionValuesForm.png)](./media/FinancialDimensionValuesForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-159">[![Financial dimensions values page (existing list)](./media/FinancialDimensionValuesForm.png)](./media/FinancialDimensionValuesForm.png)</span></span>

<span data-ttu-id="ac76d-160">以下の図は、カスタムリストが表示する値の一覧の例を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-160">The following illustration shows an example of a list of values that is provided by a custom list.</span></span> <span data-ttu-id="ac76d-161">以下例では、分析コードフレームワークには値が格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-161">In this case, values are stored in the dimension framework.</span></span>

<span data-ttu-id="ac76d-162">[![カスタム リストの財務分析コード (カスタムリスト)](./media/FinancialDimensionValuesFormCustom.png)](./media/FinancialDimensionValuesFormCustom.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-162">[![Financial dimensions page (custom list)](./media/FinancialDimensionValuesFormCustom.png)](./media/FinancialDimensionValuesFormCustom.png)</span></span>

<span data-ttu-id="ac76d-163">次の図は、上記図の分析コード設定テーブルから取得されたクエリの結果を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-163">The following illustration shows the query results from the dimension setup tables for the preceding example.</span></span>

<span data-ttu-id="ac76d-164">[![分析コード設定テーブルのクエリ結果](./media/DimensionSetupDataSQL.png)](./media/DimensionSetupDataSQL.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-164">[![Query results for dimension setup tables](./media/DimensionSetupDataSQL.png)](./media/DimensionSetupDataSQL.png)</span></span> 

<span data-ttu-id="ac76d-165">これらの例で、**財務分析コード値** ページには、エンティティに存在する値が表示されます。分析コード フレームワークで実際に使用された値ではありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-165">In both these examples, the **Financial dimension values** page shows the values that exist for the entity, not the values that have been used in the dimension framework.</span></span> <span data-ttu-id="ac76d-166">これは、フレームワーク上でこれらの値が使用されるまでは分析コード フレームワークの値が作成されないためであり、バッキング値への参照を保持する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-166">Because the representation of these values in the dimension framework isn't created until these values are used in the framework, it must still hold a reference to the backing value.</span></span> <span data-ttu-id="ac76d-167">そのため、まだ使用されていない値は削除できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-167">Therefore, values that haven't yet been used can be deleted.</span></span> <span data-ttu-id="ac76d-168">この仕様により、ストレージサイズとパフォーマンスを最適化できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-168">This behavior allows for optimization of storage size and performance.</span></span>

<span data-ttu-id="ac76d-169">分析コード値を参照した後、分析コードフレームワークが分析コード値を保存できるようにするには、分析コード値がDimensionAttributeValueテーブルに格納されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-169">After a dimension value is referenced, so that it must be saved by the dimension framework, it's stored in the DimensionAttributeValue table.</span></span> <span data-ttu-id="ac76d-170">DimensionAttributeレコードと、ViewNameビュー内の特定の **RecId** 値、DimensionAttributeレコードで参照されるテーブルの接点となります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-170">This table is the link between the DimensionAttribute record and the specific **RecId** value of the record in the ViewName view or table that is referenced on the DimensionAttribute record.</span></span> <span data-ttu-id="ac76d-171">ユーザーが入力した元の値に復元するためには、DimensionAttributeとDimensionAttributeValueの両方のレコードが必要です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-171">Both the DimensionAttribute and DimensionAttributeValue records are required in order to go back to the originating value that the user entered.</span></span>

<span data-ttu-id="ac76d-172">分析コードフレームワークが何も参照していないシステムでは、DimensionAttributeValueテーブルにレコードが作成されません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-172">In a system where nothing has been referenced by the dimension framework, there will be no records in the DimensionAttributeValue table.</span></span>

## <a name="part-2-dimension-enumerations-and-default-dimensions"></a><span data-ttu-id="ac76d-173">第2部: 分析コードの一覧とデフォルトの分析コード</span><span class="sxs-lookup"><span data-stu-id="ac76d-173">Part 2: Dimension enumerations and default dimensions</span></span>

<span data-ttu-id="ac76d-174">このトピックでは、下記の図で黄色で強調表示されている箇所 [分析コード一覧]、[デフォルト分析コード] について説明します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-174">This part of the topic covers the "Dimension Enumerations" and "Default Dimensions" regions that are highlighted in yellow in the following illustration.</span></span>

<span data-ttu-id="ac76d-175">[![フレームワークの組み合わせ](./media/SetsInFramework.png)](./media/SetsInFramework.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-175">[![Sets in the framework](./media/SetsInFramework.png)](./media/SetsInFramework.png)</span></span>

<span data-ttu-id="ac76d-176">分析コード一覧とデフォルト分析コードは、分析コードまたは分析コード値のいずれかへの参照のセットを格納するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-176">Dimension enumerations and default dimensions are two mechanisms that are used to store a set of references to either dimensions or dimension values.</span></span> <span data-ttu-id="ac76d-177">一般的には、両方とも **顧客** (CustTable) や **仕入先** (VendTable) のようなプライマリ データ ページにある **財務分析コード** タブに表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-177">Both are typically exposed on a **Financial dimensions** tab on primary data pages, such as **Customers** (CustTable) or **Vendors** (VendTable).</span></span>

### <a name="dimension-enumerations"></a><span data-ttu-id="ac76d-178">分析コードの一覧</span><span class="sxs-lookup"><span data-stu-id="ac76d-178">Dimension enumerations</span></span>

<span data-ttu-id="ac76d-179">分析コード一覧は、既存の分析コードに対する参照のセットであり、後に使用されることに備えて保存されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-179">A dimension enumeration is a set of references to existing dimensions that are persisted for later use.</span></span> <span data-ttu-id="ac76d-180">これらの分析コードには特に順序の制約がありません。また、分析コードフレームワークは、セット上に表示される分析コードに対する制約を課しません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-180">These dimensions have no particular ordering, and the dimension framework imposes no constraints on the dimensions that appear in the set.</span></span> <span data-ttu-id="ac76d-181">ただし、多くの場合、消費コードは使用中の元帳コードで使用できる分析コードの組み合わせに制約を加えます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-181">However, in most cases, the consuming code constrains the set to the set of dimensions that are available in the current ledger.</span></span> <span data-ttu-id="ac76d-182">分析コードの一覧は、DimensionAttributeSetおよびDimensionAttributeSetItemテーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-182">Dimension enumerations are stored in the DimensionAttributeSet and DimensionAttributeSetItem tables.</span></span>

<span data-ttu-id="ac76d-183">各組み合わせには列挙型を指定します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-183">Each set specifies an enumeration type.</span></span> <span data-ttu-id="ac76d-184">この列挙型は、それぞれの分析コードに関連付けられている列挙値の元を表す、BaseEnum の列挙 ID を指します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-184">This enumeration type is the enumeration ID of the BaseEnum that represents the source of enumeration values that are associated with each dimension.</span></span> <span data-ttu-id="ac76d-185">列挙番号を確認するには、 **enumnum ()** メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-185">You can find the enumeration number by using the **enumNum()** method.</span></span> <span data-ttu-id="ac76d-186">これはバッキング エンティティを元とするユーザーが入力した値のリストではなく、開発者によって定義された列挙値の一覧です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-186">Therefore, it isn't a list of user-entered values from backing entities but a list of enumeration values that are defined by the developer.</span></span> <span data-ttu-id="ac76d-187">例としては、それぞれの主勘定に関連付けられ、固定 (**固定値** とラベル)、または固定されていない (**非固定** とラベル) 分析コードリストの格納です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-187">An example is the storage of a list of dimensions that are associated with each main account, and that are either fixed (labeled **Fixed value**) or not fixed (**Not fixed**).</span></span>

<span data-ttu-id="ac76d-188">以下の図は、ページ内における分析コード一覧の表示例を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-188">The following illustration shows an example of dimension enumerations on a page.</span></span>

<span data-ttu-id="ac76d-189">[![ページ内の分析コードの一覧](./media/DimensionEnumerationsOnForm.png)](./media/DimensionEnumerationsOnForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-189">[![Dimension enumerations on a page](./media/DimensionEnumerationsOnForm.png)](./media/DimensionEnumerationsOnForm.png)</span></span> 

<span data-ttu-id="ac76d-190">上記例では、 **dimensionfixed** 一覧を使用して、ドロップダウンリストの値のリストを制約しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-190">For the preceding example, the **DimensionFixed** enumeration is used to constrain the list of values in the drop-down list.</span></span>

<span data-ttu-id="ac76d-191">[![ディメンジョン一覧BaseEnum](./media/DImensionEnumerationBaseEnum.png)](./media/DImensionEnumerationBaseEnum.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-191">[![Dimension enumeration BaseEnum](./media/DImensionEnumerationBaseEnum.png)](./media/DImensionEnumerationBaseEnum.png)</span></span> 

<span data-ttu-id="ac76d-192">選択された値は **EnumerationValue** (= **DimensionFixed::Fixed**) にて **1** と表示され、その他の値は **EnumerationValue** (= **DimensionFixed::NotFixed**) にて初期値 **0** として表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-192">The value that is selected represents one item by using a value of **1** for **EnumerationValue** (= **DimensionFixed::Fixed**) and the other item by using the default value of **0** for **EnumerationValue** (= **DimensionFixed::NotFixed**).</span></span> <span data-ttu-id="ac76d-193">以下の図は、DimensionAttributeSetレコードがどのように格納されているかを示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-193">The following illustration shows how the DimensionAttributeSet record is stored.</span></span>

<span data-ttu-id="ac76d-194">[![格納された dimension enumeration クエリ結果](./media/DimensionENumerationSQL.png)](./media/DimensionENumerationSQL.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-194">[![Query results for dimension enumeration storage](./media/DimensionENumerationSQL.png)](./media/DimensionENumerationSQL.png)</span></span> 

<span data-ttu-id="ac76d-195">MainAccountLegalEntity のレコードは、 **FixedDimensions** 列を使用して fielddimensionattributeset のレコードを参照しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-195">The MainAccountLegalEntity record references the DimensionAttributeSet record by using its **FixedDimensions** field.</span></span> <span data-ttu-id="ac76d-196">DimensionAttributeSet に格納されているレコードは、列挙型の分析コードの組み合わせを表しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-196">The DimensionAttributeSet record represents the combination of dimensions for the enumeration type.</span></span> <span data-ttu-id="ac76d-197">DimensionAttributeSetItem のレコードは、分析コードに結びつくデータの組み合わせと、関連する列挙値を表します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-197">The DimensionAttributeSetItem records represent each pair of a dimension and an enumeration value in the set.</span></span> <span data-ttu-id="ac76d-198">列挙値は、整数値で表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-198">The enumeration value is represented by its integer value.</span></span>

### <a name="default-dimensions"></a><span data-ttu-id="ac76d-199">既定の分析コード</span><span class="sxs-lookup"><span data-stu-id="ac76d-199">Default dimensions</span></span>

<span data-ttu-id="ac76d-200">分析コード一覧は、列挙値と関連付けられている分析コードの組み合わせを保持しているため、初期設定では一定の分析コード値を持つ一連の分析コードを保持しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-200">As dimension enumerations hold a set of dimensions that have associated enumeration values, a default dimension holds a set of dimensions that have specific dimension values.</span></span> <span data-ttu-id="ac76d-201">*既定の分析コード* という用語は、ここに含まれるデータがトランザクションを介さず直接マスタデータレコードに入力され、それらが勘定科目の組み合わせに既定値として入力されることに由来します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-201">The term *default dimensions* comes from the fact that these sets are typically entered on master data records, not directly on transactions, and they are used to enter default values in a ledger account combination.</span></span> <span data-ttu-id="ac76d-202">分析コードの一覧に関しては、初期設定の分析コードに一連の構造が関連付けられていないため、多くの場合、消費コードは使用中の元帳で使用できる分析コードの組み合わせに制約を加えます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-202">As for dimension enumerations, no specific structure is associated with default dimensions, and in most instances, the consuming code constrains the set to the dimensions that are available for the current ledger.</span></span> <span data-ttu-id="ac76d-203">既定の分析コードは、DimensionAttributeValueSet および DimensionAttributeValueSetItem テーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-203">Default dimensions are stored in the DimensionAttributeValueSet and DimensionAttributeValueSetItem tables.</span></span>

<span data-ttu-id="ac76d-204">以下の図は、ページ内における既定の分析コード例を表示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-204">The following illustration shows an example of default dimensions on a page.</span></span>

<span data-ttu-id="ac76d-205">[![ページ内に表示される既定の分析コード](./media/DefaultDimensionsOnForm.png)](./media/DefaultDimensionsOnForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-205">[![Default dimensions on a page](./media/DefaultDimensionsOnForm.png)](./media/DefaultDimensionsOnForm.png)</span></span>

<span data-ttu-id="ac76d-206">上記の例では、ユーザーは分析コード値を選択し、それぞれの分析コードに関連付けています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-206">In the preceding example, the user has selected a dimension value to associate with each dimension.</span></span> <span data-ttu-id="ac76d-207">以下の図は、これらの値がDimensionAttributeValueSetとDimensionAttributeValueSetItem テーブルにどのように格納されているかを示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-207">The following illustration shows how these values are stored in the DimensionAttributeValueSet and DimensionAttributeValueSetItem tables.</span></span>

<span data-ttu-id="ac76d-208">[![分析コード値テーブルのクエリ結果](./media/DImensionValueTablesSQL.png)](./media/DImensionValueTablesSQL.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-208">[![Query results for dimension value tables](./media/DImensionValueTablesSQL.png)](./media/DImensionValueTablesSQL.png)</span></span>

<span data-ttu-id="ac76d-209">MainAccountLegalEntity のレコードは、入力された値の組み合わせを表す DimensionAttributeValueSet テーブルへの外部キー参照を保持します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-209">The MainAccountLegalEntity record holds a foreign key reference to the DimensionAttributeValueSet table that represents the combination of entered values.</span></span> <span data-ttu-id="ac76d-210">具体的には、このテーブルは DimensionAttributeValueSetItemテーブルに格納されている分析コード値の一連の組み合わせを保持しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-210">Specifically, this table represents the set of pairs of dimensions values that are stored in the DimensionAttributeValueSetItem table.</span></span>

<span data-ttu-id="ac76d-211">DimensionAttributeValueSetItem テーブルは、入力された分析コード値にそれぞれに対して1つのレコードを保持しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-211">The DimensionAttributeValueSetItem table holds one record for each dimension value that is entered.</span></span> <span data-ttu-id="ac76d-212">このレコードは、DimensionAttributeValue を参照しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-212">The record references a DimensionAttributeValue.</span></span> <span data-ttu-id="ac76d-213">入力されていない分析コード (空白のままになっているレコード) は保存されません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-213">No records are stored for dimensions that haven't been entered (that is, records that have been left blank).</span></span> <span data-ttu-id="ac76d-214">既定の分析コードを入力すると、分析コードの値が分析コードフレームワークで使用されるようにるため、DimensionAttributeValueテーブルに2つのレコードが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-214">When a default dimension is entered, two records are created in the DimensionAttributeValue table, because the dimension value has now been used in the dimension framework.</span></span> <span data-ttu-id="ac76d-215">このように、分析コードのフレームワーク値は、バッキングエンティティと連係されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-215">In this way, the dimension framework values are linked with the backing entities.</span></span> <span data-ttu-id="ac76d-216">パフォーマンス上の理由から、分析コード値のナチュラルキー (表示される値) は、DimensionAttributeValueSetItemテーブルに格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-216">For performance reasons, the natural key (display value) of a dimension value is stored on the DimensionAttributeValueSetItem table.</span></span>

<span data-ttu-id="ac76d-217">値のソースを確認するには、DimensionAttributeValueテーブルの **EntityInstance** 列に格納されているリンクと、 **DimensionAttribute** テーブルの **ViewName** 列を参照し、CustTable (DimAttributeCustTable ビュー経由) の元となっているテーブルのレコードと DimensionFinancialTag を検索します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-217">To get to the source of the values, you can follow the link that is stored in the **EntityInstance** field on the DimensionAttributeValue table, together with the associated **ViewName** field on the **DimensionAttribute** table, to find the record in the originating tables of CustTable (via the DimAttributeCustTable view) and DimensionFinancialTag.</span></span>

## <a name="part-3-structures-and-constraints"></a><span data-ttu-id="ac76d-218">第3部: 構造と制約</span><span class="sxs-lookup"><span data-stu-id="ac76d-218">Part 3: Structures and constraints</span></span>

<span data-ttu-id="ac76d-219">このトピックでは、下記の図で黄色で強調表示されている箇所 [構造] と [制約] について説明します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-219">This part of the topic covers the "Structures" and "Constraints" regions that are highlighted in yellow in the following illustration.</span></span>

<span data-ttu-id="ac76d-220">[![フレームワークの構造と制約](./media/StructuresAndConstraintsInFramework.png)](./media/StructuresAndConstraintsInFramework.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-220">[![Structures and constraints in the framework](./media/StructuresAndConstraintsInFramework.png)](./media/StructuresAndConstraintsInFramework.png)</span></span>

<span data-ttu-id="ac76d-221">前述のとおり、分析コード フレームワークでは、分析コードの数に制限がありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-221">As was previously stated, the dimension framework allows for an unlimited number of dimensions.</span></span> <span data-ttu-id="ac76d-222">さらに、ユーザーが勘定科目の組み合わせを入力する際に、組み込む分析コードとその順序を指定できます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-222">Additionally, when users enter a ledger account combination, they can specify which dimensions to include, and in which order.</span></span> <span data-ttu-id="ac76d-223">また、その勘定科目の組み合わせの各区分に対する入力値に制約を加えることも可能です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-223">They can also constrain the values that can be entered for each segment in that ledger account combination.</span></span>

### <a name="account-structures"></a><span data-ttu-id="ac76d-224">勘定構造</span><span class="sxs-lookup"><span data-stu-id="ac76d-224">Account structures</span></span>

<span data-ttu-id="ac76d-225">以下の図は、勘定の構造例を示します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-225">The following illustration shows an example of an account structure.</span></span>

<span data-ttu-id="ac76d-226">[![勘定構造ページ](./media/AccountStructureConfigurationForm.png)](./media/AccountStructureConfigurationForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-226">[![Account structures page](./media/AccountStructureConfigurationForm.png)](./media/AccountStructureConfigurationForm.png)</span></span>

<span data-ttu-id="ac76d-227">以下の図が示すように、この勘定構造は、データベースの DimensionHierarchy テーブルに格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-227">As the following illustration shows, this account structure is stored in the DimensionHierarchy table in the database.</span></span> <span data-ttu-id="ac76d-228">ここでは、勘定科目の組み合わせの最初の入力区分として主勘定を入力し、続いて顧客およびライセンスプレート番号を入力するように設定されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-228">It's set up to require that a main account be entered as the first segment of a ledger account combination, and that a customer and license plate number be entered as subsequent segments.</span></span> <span data-ttu-id="ac76d-229">この設定では、階層の順位を定義します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-229">This setup is the hierarchical order definition.</span></span> <span data-ttu-id="ac76d-230">この設定はデータベースの DimensionHierarchyLevel テーブルに格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-230">It's stored in the DimensionHierarchyLevel table in the database.</span></span>

<span data-ttu-id="ac76d-231">[![勘定構造のクエリ結果](./media/StructureSQL.png)](./media/StructureSQL.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-231">[![Query results for account structures](./media/StructureSQL.png)](./media/StructureSQL.png)</span></span>

<span data-ttu-id="ac76d-232">順位の設定に加えて、制約を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-232">In addition to the order, the constraints must be set up.</span></span> <span data-ttu-id="ac76d-233">制約とは、有効な値の組み合わせを定義する条件を意味します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-233">Constraints are the criteria that define the valid combinations of values.</span></span> <span data-ttu-id="ac76d-234">この例では、すべてのセグメントにて組み合わせの値を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-234">In this example, all segments must have a value for the combination.</span></span> <span data-ttu-id="ac76d-235">この設定を行わない限り、有効とみなされません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-235">Otherwise, they aren't considered valid.</span></span> <span data-ttu-id="ac76d-236">既に存在する値 (つまり、バッキングエンティティに存在するすべての値) を入力でき、有効となる値の組み合わせについて特に制限はありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-236">Any existing value (that is, any value that already exists in the backing entity) can be entered, and there are no specific restrictions on the combinations of values that are valid.</span></span> <span data-ttu-id="ac76d-237">この条件は、DimensionConstraintTree、DimensionConstraintNode、DimensionConstraintNodeCriteria の各テーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-237">This criterion is stored in the DimensionConstraintTree, DimensionConstraintNode, and DimensionConstraintNodeCriteria tables.</span></span>

<span data-ttu-id="ac76d-238">[![簡単な制約のクエリ結果](./media/SimpleConstraintsQueryResults.png)](./media/SimpleConstraintsQueryResults.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-238">[![Query results for simple constraints](./media/SimpleConstraintsQueryResults.png)](./media/SimpleConstraintsQueryResults.png)</span></span>

<span data-ttu-id="ac76d-239">上記図の例では、必要最低限の制約ツリーが示されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-239">The example in the preceding illustration shows the most basic constraint tree.</span></span> <span data-ttu-id="ac76d-240">アスタリスク (\*) のついている制約条件は、3つの制約ノードにそれぞれ関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-240">An asterisk (\*) constraint criterion is associated with each of the three constraint nodes.</span></span> <span data-ttu-id="ac76d-241">この制約条件は、存在するすべての値を意味します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-241">This constraint criterion represents any existing value.</span></span> <span data-ttu-id="ac76d-242">データベースではパーセント記号 (%) で保存されており、UI では \<all values\> として表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-242">It's stored as a percent sign (%) in the database and is shown as "\<all values\>" in the UI.</span></span> <span data-ttu-id="ac76d-243">これらの制約は、ルックアップを介して各セグメントに入力できる値を表示したり、セグメントに入力された値を検証するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-243">These constraints are used both to show the values that can be entered for each segment via a lookup and to validate values that are entered in the segment.</span></span> <span data-ttu-id="ac76d-244">こうした設定の結果、勘定科目の組み合わせに対して誤った値が入力された場合は、制約が検証エラーを返します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-244">Eventually, if incorrect values are entered for a ledger account combination, these constraints will produce validation errors.</span></span>

<span data-ttu-id="ac76d-245">Dimension frameworkでは、より複雑な制約ツリーを設定することが可能となり、最初のセグメントに入力された値によって次の区分に入力可能な値を判断することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-245">The dimension framework allows for much more complex constraint trees, where the value that is entered in one segment drives the valid values that can be entered in the next segment.</span></span> <span data-ttu-id="ac76d-246">以下の図は、この多機能性の一例を表しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-246">The following illustration shows an example of the versatility.</span></span>

<span data-ttu-id="ac76d-247">[![勘定構造 ページの制約ビルダー](./media/ConstraintbuilderonConfigureAccountStructureForm.png)](./media/ConstraintbuilderonConfigureAccountStructureForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-247">[![Constraint builder on the Account structures page](./media/ConstraintbuilderonConfigureAccountStructureForm.png)](./media/ConstraintbuilderonConfigureAccountStructureForm.png)</span></span>

<span data-ttu-id="ac76d-248">以下の図では、より複雑な制約ツリーを表しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-248">The following illustration shows a more complex constraint tree.</span></span>

<span data-ttu-id="ac76d-249">[![ページ上で展開された高度な制約ツリー](./media/AdvancedConstraintTreeExpandedOnForm.png)](./media/AdvancedConstraintTreeExpandedOnForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-249">[![Advanced constraint tree expanded on a page](./media/AdvancedConstraintTreeExpandedOnForm.png)](./media/AdvancedConstraintTreeExpandedOnForm.png)</span></span>

<span data-ttu-id="ac76d-250">以下の図は、制約定義のクエリ結果を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-250">The following illustration shows the resulting constraint definition.</span></span>

<span data-ttu-id="ac76d-251">[![高度な制約ツリーのクエリ結果](./media/AdvancedConstraintTreeSQL.png)](./media/AdvancedConstraintTreeSQL.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-251">[![Query results for advanced constraint trees](./media/AdvancedConstraintTreeSQL.png)](./media/AdvancedConstraintTreeSQL.png)</span></span>

<span data-ttu-id="ac76d-252">ユーザーが主勘定と顧客に **150-B** と入力した場合は、特定のライセンス プレート番号を入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-252">If a user enters **150-B** for a main account and customer, a specific license plate number must also be entered.</span></span> <span data-ttu-id="ac76d-253">一方で、 **150-W** と入力した場合は、ライセンスプレート番号は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-253">However, if the user enters **150-W**, no license plate number is required.</span></span> <span data-ttu-id="ac76d-254">どちらの場合も、勘定科目の組み合わせでは常に3つのセグメントが表示されます。このいずれかが空白のままであっても。</span><span class="sxs-lookup"><span data-stu-id="ac76d-254">In both cases, the user will always see three segments in the ledger account combination, even if one of those segments is left blank.</span></span> <span data-ttu-id="ac76d-255">勘定科目分析コードが入力された際に、構造、区分、制約が与える影響については、このトピックの [第5部](#part-5-ledger-dimensions) の 勘定科目の入力と保存についての説明を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac76d-255">For examples of the effects that these structures, segments, and constraints have when ledger dimension accounts are entered, see the [part 5](#part-5-ledger-dimensions) section of this topic section of this topic that discusses the entry and storage of ledger account combinations.</span></span>

<span data-ttu-id="ac76d-256">入力必須となっている後続のセグメントのみを表示するには、詳細ルールと勘定構造の組み合わせることで、さらに柔軟な設定を実現することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-256">If a user wants to show trailing segments only when they must be entered, advanced rules can be combined with the account structure to provide the additional versatility.</span></span>

## <a name="part-4-advanced-rules"></a><span data-ttu-id="ac76d-257">第4部: 高度なルール</span><span class="sxs-lookup"><span data-stu-id="ac76d-257">Part 4: Advanced rules</span></span>

<span data-ttu-id="ac76d-258">このトピックでは、以下の図で黄色で強調表示されている箇所 [高度なルール] について説明します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-258">This part of the topic covers the "Advanced Rules" region that is highlighted in yellow in the following illustration.</span></span>

<span data-ttu-id="ac76d-259">[![フレームワークの高度なルール](./media/AdvancedRulesGraph.png)](./media/AdvancedRulesGraph.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-259">[![Advanced rules in framework](./media/AdvancedRulesGraph.png)](./media/AdvancedRulesGraph.png)</span></span>

<span data-ttu-id="ac76d-260">勘定構造と制約を使用することで、簡単なものから複雑なものまで有効な組み合わせのツリーを構築することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-260">Account structures and constraints let users build simple to complex trees of valid combinations.</span></span> <span data-ttu-id="ac76d-261">しかし、常に有効な分析コードの値を制約するのではなく、一定時間のみ勘定科目の組み合わせの一部として分析コードを表示するという業務上の要件があるかもしれません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-261">However, there is sometimes a business requirement to show a dimension as a segment in a ledger account combination only at specific times, instead of just constraining the valid values that are allowed and showing the dimension all the time.</span></span> <span data-ttu-id="ac76d-262">高度なルールを使えば、こうした要件にも対応可能です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-262">Advanced rules support this requirement.</span></span>

### <a name="advanced-rules"></a><span data-ttu-id="ac76d-263">詳細ルール</span><span class="sxs-lookup"><span data-stu-id="ac76d-263">Advanced rules</span></span>

<span data-ttu-id="ac76d-264">高度なルールは、勘定構造とその制約に追加することが可能です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-264">Advanced rules can be added to an account structure and its constraints.</span></span> <span data-ttu-id="ac76d-265">高度なルールには汎用性がありますが、使用するタイミングを判断し、最適なユーザビリティ、パフォーマンス、理解を発揮するには、以下のガイドラインを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ac76d-265">Although advanced rules are versatile, to help guarantee the best usability, performance, and understanding, be sure to follow these guidelines about when they should and should not be used:</span></span>

- <span data-ttu-id="ac76d-266">ルールによって勘定構造を置き換えることはできません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-266">Rules can't replace the account structure.</span></span> <span data-ttu-id="ac76d-267">構造は常に存在する必要があり、主勘定区分は必須項目です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-267">A structure must always exist, and it must have at least a main account segment.</span></span>
- <span data-ttu-id="ac76d-268">勘定構造に既に存在する他のセグメントの前に分析コードを追加することはできません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-268">Rules can't add dimensions before other segments that are already in the account structure.</span></span>
- <span data-ttu-id="ac76d-269">主勘定に関係なく、常に必要とされる追加分析コードの勘定科目構造の制約をルールで置き換えることはできません</span><span class="sxs-lookup"><span data-stu-id="ac76d-269">Rules should not be used to replace constraints in the account structure for additional dimensions that are always required, regardless of the main account.</span></span>
- <span data-ttu-id="ac76d-270">ルールは勘定構造内に既に存在するセグメントを複製したり、他のルールを複製したりすることはできません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-270">Rules should not be used to replicate segments that already exist in the account structure, or to replicate other rules.</span></span>
- <span data-ttu-id="ac76d-271">重複のあるルールは自動的に結合され、最も制限の厳しい制約が使用されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-271">Any duplication automatically joins and uses the most restrictive constraint.</span></span>
- <span data-ttu-id="ac76d-272">セグメント内に重複したルールがある場合については、同セグメント内の最初に記述された箇所のみに表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-272">The location of the duplicated segment appears only in the first occurrence of the segment.</span></span>

<span data-ttu-id="ac76d-273">高度なルールを設定するには、勘定科目の組み合わせにセグメントを追加するタイミングを制御するフィルタを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-273">To set up an advanced rule, you must define a filter that controls when additional segments are added to a ledger account combination.</span></span> <span data-ttu-id="ac76d-274">次に、追加の必要がある追加セグメント、階層内の順位、およびそれらを制約するルール構造を結びつける必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-274">You must then link rule structures that specify the additional segments that must be added, their order in the hierarchy, and any constraints between them.</span></span> <span data-ttu-id="ac76d-275">(ルールの構造は勘定構造と類似した特徴があります)。</span><span class="sxs-lookup"><span data-stu-id="ac76d-275">(Rule structures resemble account structures.)</span></span>

<span data-ttu-id="ac76d-276">たとえば、以下の勘定構造が設定されているとします。</span><span class="sxs-lookup"><span data-stu-id="ac76d-276">For example, the following account structure is set up.</span></span>

![2 つの勘定の基本的な構造と制約](./media/BasicStructureAndConstraint.png)

<span data-ttu-id="ac76d-278">以下の高度なルールでは、ユーザーが主勘定に 145 を入力し、かつ顧客に G ~ Qを 入力した場合にのみ、1つから2つ以上のセグメントを追加する設定です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-278">You configure the following advanced rule to optionally add one or more segments only if the user enters main account 145 and customers G through Q.</span></span>

<span data-ttu-id="ac76d-279">[![詳細ルールのページ](./media/AdvancedRuleForm.png)](./media/AdvancedRuleForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-279">[![Advanced rule page](./media/AdvancedRuleForm.png)](./media/AdvancedRuleForm.png)</span></span>

<span data-ttu-id="ac76d-280">ルールを設定した後で、構造と制約定義を作成して、勘定科目の組み合わせにどのようなセグメントを追加するかの定義を加える必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-280">After the rule is configured, you must create a structure and constraint definition to define what segments should be added to the ledger account combination.</span></span> <span data-ttu-id="ac76d-281">この手順を完成させるには、以下のルール構造を作成します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-281">To complete this step, you create the following rule structure.</span></span> <span data-ttu-id="ac76d-282">ルール構造を作成するプロセスは、勘定構造を作成するプロセスと共通しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-282">The process for creating a rule structure resembles the process for creating an account structure.</span></span> <span data-ttu-id="ac76d-283">これらの構造には、ただちにルールの適用がされません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-283">These structures aren't immediately bound to the rule.</span></span> <span data-ttu-id="ac76d-284">したがって、これらのルールを必要に応じて複数のルール間で共有することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-284">Therefore, they can be shared across multiple rules as you require.</span></span>

<span data-ttu-id="ac76d-285">[![詳細なルール構造ページ](./media/AdvancedRuleStructureForm.png)](./media/AdvancedRuleStructureForm.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-285">[![Advanced rule structure page](./media/AdvancedRuleStructureForm.png)](./media/AdvancedRuleStructureForm.png)</span></span>

<span data-ttu-id="ac76d-286">ルール構造を作成した後、分析コードのルールへと追加します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-286">After the structure is created, you add it to the dimension rule.</span></span> <span data-ttu-id="ac76d-287">そうすると、勘定構造がルールと共に有効化されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-287">The account structure is then activated, together with the rule.</span></span>

<span data-ttu-id="ac76d-288">[![詳細ルール構造の追加](./media/AddedAdvancedRuleStructureToRule.png)](./media/AddedAdvancedRuleStructureToRule.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-288">[![Added advanced rule structure to rule](./media/AddedAdvancedRuleStructureToRule.png)](./media/AddedAdvancedRuleStructureToRule.png)</span></span>

<span data-ttu-id="ac76d-289">このデータが保存される場所は、勘定構造の保存場所と共通のテーブルが使用されます ( [第3部](#part-3-structures-and-constraints)を参照)。</span><span class="sxs-lookup"><span data-stu-id="ac76d-289">The storage of this data uses some of the same tables as the storage of the account structures (see [part 3](#part-3-structures-and-constraints)).</span></span> <span data-ttu-id="ac76d-290">DimensionRule、DimensionRuleAppliedHierarchy、DimensionRuleCriteria の各テーブルには、ルールの定義に特化したデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-290">The DimensionRule, DimensionRuleAppliedHierarchy, and DimensionRuleCriteria tables hold the data that is specific to the definition of the rule.</span></span> <span data-ttu-id="ac76d-291">ここにはルール構造の定義へのリンクも保持しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-291">They also hold the link to the definition of the rule structures.</span></span> <span data-ttu-id="ac76d-292">そのほか残りのテーブルは、勘定構造の定義と共有されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-292">The remaining tables are shared with the account structure definition.</span></span>

<span data-ttu-id="ac76d-293">[![統合された構造、ルール、およびすべての制約に関するクエリの結果](./media/CombinesStructureRuleandAllConstraintsSQL.png)](./media/CombinesStructureRuleandAllConstraintsSQL.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-293">[![Query results for the combined structure, rule, and all constraints](./media/CombinesStructureRuleandAllConstraintsSQL.png)](./media/CombinesStructureRuleandAllConstraintsSQL.png)</span></span>

## <a name="part-5-ledger-dimensions"></a><span data-ttu-id="ac76d-294">第5部: 勘定分析コード</span><span class="sxs-lookup"><span data-stu-id="ac76d-294">Part 5: Ledger dimensions</span></span>

<span data-ttu-id="ac76d-295">このトピックでは、以下の図で黄色で強調表示されている箇所 [勘定分析コード] について説明します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-295">This part of the topic covers the "Ledger Dimensions" region that is highlighted in yellow in the following illustration.</span></span>

<span data-ttu-id="ac76d-296">[![フレームワークにおける勘定科目の分析コードのストレージ](./media/LedgerDimensionStorageInFramework.png)](./media/LedgerDimensionStorageInFramework.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-296">[![Ledger dimension storage in framework](./media/LedgerDimensionStorageInFramework.png)](./media/LedgerDimensionStorageInFramework.png)</span></span>

<span data-ttu-id="ac76d-297">すべての設定データを完了すると、勘定科目の組み合わせを追加、検証、継続使用することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-297">After all the configuration data is set up, ledger account combinations can be entered, validated, and persisted.</span></span> <span data-ttu-id="ac76d-298">この分析コードフレームワーク領域は、主にアプリケーションが使用しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-298">The primary consumption of the dimension framework occurs when the application uses this area.</span></span>

### <a name="ledger-dimension-storage-without-rules"></a><span data-ttu-id="ac76d-299">ルールが適用されていない元帳分析コードストレージ</span><span class="sxs-lookup"><span data-stu-id="ac76d-299">Ledger dimension storage without rules</span></span>

<span data-ttu-id="ac76d-300">元帳分析コードを理解するには、ユーザーがどのように勘定科目の組み合わせを入力しているかを理解する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-300">To understand ledger dimensions, you must understand how users enter ledger account combinations.</span></span>

<span data-ttu-id="ac76d-301">このセクションでは、このトピックの [第4部](#part-4-advanced-rules) にある勘定構造とルールの設定を使用し、勘定が入力された場合の勘定項目の制御についての操作方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-301">This section uses the account structure and rule setup from [part 4](#part-4-advanced-rules) of this topic, and explains the user interaction with the account entry control when an account is entered.</span></span> <span data-ttu-id="ac76d-302">勘定構造は以下のようになります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-302">Here is the account structure, as a reminder.</span></span>

![基本の構造と制約では、自分の勘定構造が取得されます](./media/BasicStructureAndConstraintForm.png)

<span data-ttu-id="ac76d-304">1つの勘定ルールが勘定構造に関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-304">A single account rule is associated with the account structure.</span></span>

<span data-ttu-id="ac76d-305">[![1つのルールの追加](./media/SingleRuleAdded.png)](./media/SingleRuleAdded.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-305">[![Single rule added](./media/SingleRuleAdded.png)](./media/SingleRuleAdded.png)</span></span>

<span data-ttu-id="ac76d-306">以下の図は、追加された構造を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-306">The following illustration shows the structure that was added.</span></span>

<span data-ttu-id="ac76d-307">[![1つの構造の追加](./media/SingleStructureAdded.png)](./media/SingleStructureAdded.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-307">[![Single structure added](./media/SingleStructureAdded.png)](./media/SingleStructureAdded.png)</span></span>

<span data-ttu-id="ac76d-308">以下の図は、ユーザーが最初にページで表示したときに、フォーカスを持たない勘定科目フィールドがどのように表示されるかを示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-308">The following illustration shows what a ledger account field looks like when a user first sees it on a page, and it doesn't have the focus.</span></span>

<span data-ttu-id="ac76d-309">[![空白の元帳勘定フィールド (フォーカスなし)](./media/EmptyLedgerAccountField.png)](./media/EmptyLedgerAccountField.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-309">[![Empty ledger account field (without focus)](./media/EmptyLedgerAccountField.png)](./media/EmptyLedgerAccountField.png)</span></span>

<span data-ttu-id="ac76d-310">このフィールドをクリックしても、何も変更されません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-310">When the user clicks in the field, nothing changes.</span></span> <span data-ttu-id="ac76d-311">ドロップダウンの矢印を選択すると、ルックアップが表示され、使用可能なセグメントが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-311">However, if the user selects the drop-down arrow, the lookup appears and shows the possible segments.</span></span> <span data-ttu-id="ac76d-312">以下の図では、2つのセグメント候補が表示されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-312">In the following illustration, there are two possible segments.</span></span>

<span data-ttu-id="ac76d-313">[![勘定科目フィールドでルックアップを編集する](./media/InEditLedgerAccountFieldWithLookup.png)](./media/InEditLedgerAccountFieldWithLookup.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-313">[![In-edit ledger account field with lookup](./media/InEditLedgerAccountFieldWithLookup.png)](./media/InEditLedgerAccountFieldWithLookup.png)</span></span>

<span data-ttu-id="ac76d-314">以下の例では、 **150-A** の組み合わせが入力されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-314">For this example, the user enters the combination **150-A**.</span></span>

![値 150-A が入力された元帳勘定フィールド](./media/CompletedLedgerAccountField.png)

<span data-ttu-id="ac76d-316">2番目のセグメントが入力し、 **Tab** を押下して入力欄を移動するとただちに、分析コードフレームワークが制約に基づいた検証を行い、その組み合わせが保存されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-316">As soon as the second segment is entered, and the user presses **Tab** to move out of the control, the dimension framework saves the combination and then validates it, based on the constraints.</span></span> <span data-ttu-id="ac76d-317">この例では、入力された組み合わせは有効とみなされています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-317">In this example, the combination is valid.</span></span> <span data-ttu-id="ac76d-318">ユーザーは、文字を入力するか、あるいはルックアップを使用してセグメントに入力することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-318">The user can enter segments either as a string or by using the lookup.</span></span>

<span data-ttu-id="ac76d-319">この例では、組み合わせについて以下の情報がわかっています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-319">For this example, the following information is known about the combination:</span></span>

- <span data-ttu-id="ac76d-320">勘定構造は、 **myaccountstructure** という名称です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-320">The account structure is named **MyAccountStructure**.</span></span>
- <span data-ttu-id="ac76d-321">最初のセグメントは、MainAccount分析コードです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-321">The first segment is the MainAccount dimension.</span></span> <span data-ttu-id="ac76d-322">コード値は **150** です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-322">It has a value of **150**.</span></span>
- <span data-ttu-id="ac76d-323">2番目のセグメントは、顧客分析コードです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-323">The second segment is the Customer dimension.</span></span> <span data-ttu-id="ac76d-324">コード値は **A** です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-324">It has a value of **A**.</span></span>
- <span data-ttu-id="ac76d-325">値がこの勘定構造に関連付けられている詳細ルールと一致しなかったため、区分が追加されませんでした。</span><span class="sxs-lookup"><span data-stu-id="ac76d-325">No additional segments were added, because the values didn't match any advanced rules that are associated with this account structure.</span></span>

<span data-ttu-id="ac76d-326">結果として、以下の図に示すように、2つのセグメントの値が4つのテーブルにまたがって格納されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-326">Therefore, the two segment values are stored across the four tables, as shown in the following illustration.</span></span>

![4 つのテーブルにまたがる勘定科目分析コード ストレージのクエリ結果](./media/LedgerDimensionStorageSQL.png)<span data-ttu-id="ac76d-328">]</span><span class="sxs-lookup"><span data-stu-id="ac76d-328">]</span></span>

<span data-ttu-id="ac76d-329">1番目のテーブルは **DimensionAttributeValueCombination**.です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-329">The first table is named **DimensionAttributeValueCombination**.</span></span> <span data-ttu-id="ac76d-330">すべてのマルチセグメントアカウントの組み合わせと、その組み合わせに関する非正規化された情報が格納されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-330">It stores a full multisegment account combination, together with some denormalized information about the combination.</span></span> <span data-ttu-id="ac76d-331">このテーブルに格納されている情報の例としては、連結されたセグメントをひとつの文字列として格納し、勘定構造への外部キー参照を格納し、使用された主勘定 (150) に対する外部キーが格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-331">For example, it stores the concatenated segments as a single string, a foreign key reference to the account structure, and a foreign key to the main account that was used (150).</span></span>

<span data-ttu-id="ac76d-332">2番目のテーブルは **DimensionAttributeValueGroupCombination** です。詳細は後述します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-332">The second table is named **DimensionAttributeValueGroupCombination** and will be explained later.</span></span>

<span data-ttu-id="ac76d-333">3番目のテーブルは、 **DimensionAttributeValueGroup** です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-333">The third table is named **DimensionAttributeValueGroup**.</span></span> <span data-ttu-id="ac76d-334">組み合わせに含まれる各構造に関連付けられた、セグメントのグループが格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-334">It stores each related group of segments that is associated with each structure that is present in the combination.</span></span> <span data-ttu-id="ac76d-335">この図では、構造が1つ (勘定構造) しか存在しないため、レコードは1つしか存在しません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-335">In this case, because there is only one structure (the account structure), there is only one record.</span></span>

<span data-ttu-id="ac76d-336">4番目のテーブルは、 **DimensionAttributeLevelValue** です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-336">The fourth table is named **DimensionAttributeLevelValue**.</span></span> <span data-ttu-id="ac76d-337">関連するグループまたは構造に存在するセグメントの値がそれぞれ格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-337">It stores the individual segment values for each segment in the associated group or structure.</span></span> <span data-ttu-id="ac76d-338">入力されたセグメントごとに1つのレコードが存在します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-338">One record exists for each segment that is entered.</span></span> <span data-ttu-id="ac76d-339">セグメントが空の場合は、値が格納されません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-339">If a segment is empty, no values are stored for it.</span></span> <span data-ttu-id="ac76d-340">各レコードは対応する DimensionAttributeValue レコードを参照します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-340">Each record references the corresponding DimensionAttributeValue record.</span></span> <span data-ttu-id="ac76d-341">値に対応するレコードが DimensionAttributeValue にて見つかった場合は、そのレコードが参照されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-341">If an existing DimensionAttributeValue record is found for the value, it's referenced.</span></span> <span data-ttu-id="ac76d-342">値に対応するレコードが DimensionAttributeValue にて見つからなかった場合は、そのレコードが生成されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-342">If an existing DimensionAttributeValue record is not found for the value, one is created.</span></span> <span data-ttu-id="ac76d-343">このデータは、DimensionAttribute を実際のバッキング エンティティ レコードに連係します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-343">This data links the DimensionAttribute to the real backing entity record.</span></span> <span data-ttu-id="ac76d-344">この例でDimensionAttributeLevelValue には２つのレコードが表示されており、ひとつは 150 というIDを持つ MainAccount レコードと、もう一方は A というIDを持つ CustTable レコードを表示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-344">In this case, one DimensionAttributeLevelValue is for the MainAccount record that has an ID of 150, and one DimensionAttributeLevelValue is for the CustTable record that has an ID of A.</span></span>

<span data-ttu-id="ac76d-345">勘定構造の値とセグメントの値のグループを DimensionAttributeValueCombination のメインレコードに連係するには、2番目のテーブルである Dimensionattributevaluegroup にレコードが挿入されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-345">To link the group of account structure values and segment values to the main record in the DimensionAttributeValueCombination table, a record is inserted into the second table, DimensionAttributeValueGroupCombination.</span></span>

<span data-ttu-id="ac76d-346">1つのセグメントを新しい組み合わせで保存するには、最低でも1つのレコードがこれらの4つのテーブルに作成されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-346">To save a single segment in a new combination, at least one record is inserted into each of these four tables.</span></span> <span data-ttu-id="ac76d-347">入力された追加セグメントごとに、DimensionAttributeLevelValue テーブルにレコードが追加挿入されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-347">For each additional segment that is entered, an additional record is inserted into the DimensionAttributeLevelValue table.</span></span> <span data-ttu-id="ac76d-348">これら4つのテーブルは、勘定分析コードと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-348">Abstractly, these four tables are referred to as a Ledger Dimension.</span></span> <span data-ttu-id="ac76d-349">元帳分析コードは、DimensionAttributeValueCombination テーブルの **RecId** 値を参照する外部キーとして表されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-349">A Ledger Dimension is expressed as a foreign key that references the **RecId** value in the DimensionAttributeValueCombination table.</span></span>

### <a name="ledger-dimension-storage-with-rules"></a><span data-ttu-id="ac76d-350">ルールが適用された元帳分析コードストレージ</span><span class="sxs-lookup"><span data-stu-id="ac76d-350">Ledger dimension storage with rules</span></span>

<span data-ttu-id="ac76d-351">このセクションで扱う内容は、前のセクションでの勘定分析コードストレージ例に基づいています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-351">This section builds on the ledger dimension storage example that was started in the previous section.</span></span> <span data-ttu-id="ac76d-352">ここでは、値を **150-A** から **145-Q** に変更します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-352">Here, the user changes the values from **150-A** to **145-Q**.</span></span> <span data-ttu-id="ac76d-353">前段で説明した高度なルールで述べたように、この変更により3番目のセグメントが勘定構造に追加されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-353">As you know from the advanced rules that were previously set up, this change will cause a third segment to be added to the account structure.</span></span>

<span data-ttu-id="ac76d-354">[![元帳勘定区分 (タブが押下される前)](./media/LedgerAccountSegmentBeforeTab.png)](./media/LedgerAccountSegmentBeforeTab.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-354">[![In-edit ledger account segment (before Tab is pressed)](./media/LedgerAccountSegmentBeforeTab.png)](./media/LedgerAccountSegmentBeforeTab.png)</span></span>

<span data-ttu-id="ac76d-355">2番目のセグメントの後にハイフン (-) を入力すると、3番目のセグメントがコントロールに追加され、フォーカスが移ります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-355">When the user types a hyphen (–) after the second segment, a third segment is added to the control, and it receives the focus.</span></span>

<span data-ttu-id="ac76d-356">[![元帳勘定区分 (タブが押下された後)](./media/LedgerAccountSegmentAfterTab.png)](./media/LedgerAccountSegmentAfterTab.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-356">[![In-edit ledger account segment (after Tab is pressed)](./media/LedgerAccountSegmentAfterTab.png)](./media/LedgerAccountSegmentAfterTab.png)</span></span>

<span data-ttu-id="ac76d-357">3番目のセグメントにフォーカスがあるときにルックアップを開くと、3番目のセグメントに対応する値が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-357">If the user opens the lookup while the third segment has the focus, the possible valid values for the third segment are shown.</span></span>

<span data-ttu-id="ac76d-358">[![新しいセグメントにフォーカスがある場合のルックアップ](./media/LookupInSegment.png)](./media/LookupInSegment.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-358">[![Lookup while the focus is in the new segment](./media/LookupInSegment.png)](./media/LookupInSegment.png)</span></span>

<span data-ttu-id="ac76d-359">この段階でライセンス番号が入力可能となります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-359">The user can now enter a license number.</span></span>

![ライセンス番号が入力された元帳勘定フィールド](./media/CompletedLedgerAccountFieldWithAllRules.png)

<span data-ttu-id="ac76d-361">3番目のフィールドに値を入力し、 **Tab** を押下してコントロールを移動すると、入力された組み合わせの検証が行われます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-361">As soon as a value is entered in the third field, and the user presses **Tab** to move out of the control, the combination is validated.</span></span> <span data-ttu-id="ac76d-362">入力された組み合わせが有効な場合は、勘定分析コードとして保存されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-362">If the combination is valid, it's saved as a Ledger Dimension.</span></span>

<span data-ttu-id="ac76d-363">この例では、新規で入力された組み合わせについて以下の情報がわかっています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-363">For this example, the following information is known about the new combination:</span></span>

- <span data-ttu-id="ac76d-364">勘定構造は、 **myaccountstructure** という名称です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-364">The account structure is named **MyAccountStructure**.</span></span>
- <span data-ttu-id="ac76d-365">最初のセグメントは、MainAccount分析コードです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-365">The first segment is the MainAccount dimension.</span></span> <span data-ttu-id="ac76d-366">コード値は **145** です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-366">It has a value of **145**.</span></span>
- <span data-ttu-id="ac76d-367">2番目のセグメントは、顧客分析コードです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-367">The second segment is the Customer dimension.</span></span> <span data-ttu-id="ac76d-368">コード値は **Q** です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-368">It has a value of **Q**.</span></span>
- <span data-ttu-id="ac76d-369">この値は最初の2つのセグメントのルールと一致するため、 **MyRuleStructure1** という名前の勘定科目のルール構造が追加されました。</span><span class="sxs-lookup"><span data-stu-id="ac76d-369">Because the values match the rule for the first two segments, an account rule structure that is named **MyRuleStructure1** was added.</span></span> <span data-ttu-id="ac76d-370">この結果、1つのセグメントが追加されました。</span><span class="sxs-lookup"><span data-stu-id="ac76d-370">Therefore, one additional segment was added.</span></span>
- <span data-ttu-id="ac76d-371">3番目のセグメントは、LicensePlate 分析コードです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-371">The third segment is the LicensePlate dimension.</span></span> <span data-ttu-id="ac76d-372">コード値は **AAA 111** です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-372">It has a value of **AAA 111**.</span></span>

![値 AAA 111 の勘定分析コード ストレージのクエリ結果](./media/LedgerDimensionValuesStorageSQL.png)<span data-ttu-id="ac76d-374">]</span><span class="sxs-lookup"><span data-stu-id="ac76d-374">]</span></span>

<span data-ttu-id="ac76d-375">この組み合わせでは、勘定分析コードを格納する4つのテーブルに合計8個の行が挿入されました。</span><span class="sxs-lookup"><span data-stu-id="ac76d-375">For this combination, a total of eight rows was inserted across the four tables that store the ledger dimension.</span></span> <span data-ttu-id="ac76d-376">前段 ([第4部](#part-4-advanced-rules)) で述べた最初の勘定科目の組み合わせと、この勘定科目の組み合わせとの違いは、この勘定科目を構成する分析コードを活用するために複数の構造が使用される点です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-376">The difference between the first ledger account combination that was discussed in the previous post([part 4](#part-4-advanced-rules)) and this ledger account combination is that multiple structures are used to drive the dimensions that make up this ledger account combination.</span></span> <span data-ttu-id="ac76d-377">2つの分析コードは、DimensionAttributeValueGroupCombination および DimensionAttributeValueGroup テーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-377">Two records are stored in the DimensionAttributeValueGroupCombination and DimensionAttributeValueGroup tables.</span></span> <span data-ttu-id="ac76d-378">それぞれのレコードは、完全な組み合わせに使用、または結合される構造を表します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-378">Each record represents a structure that is used and joined to the full combination.</span></span>

<span data-ttu-id="ac76d-379">各レコードに新しい **RecId** 値が割り当てられていることに留意してください。</span><span class="sxs-lookup"><span data-stu-id="ac76d-379">Notice that a new **RecId** value is assigned to each record.</span></span> <span data-ttu-id="ac76d-380">古い値の組み合わせについては更新されません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-380">The combination of the previous values isn't updated.</span></span> <span data-ttu-id="ac76d-381">代わりに、新しい組み合わせが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-381">Instead, a new combination is created.</span></span> <span data-ttu-id="ac76d-382">結果として、組み合わせの使用に対して参照カウントが保持されなくなるため、元帳分析コードは変更不可能となります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-382">Therefore, the Ledger Dimensions are made immutable, because no reference counting is maintained for the use of the combination.</span></span> <span data-ttu-id="ac76d-383">ユーザーがインスタンスを **145-Q-AAA 111** へと変更する前に、 **150-Q** と同じ組み合わせがアプリケーション内で複数のテーブルから参照される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-383">The same **150-Q** combination that was originally entered might have been referenced from multiple tables in the application before the user decided to change an instance to **145-Q-AAA 111**.</span></span> <span data-ttu-id="ac76d-384">そのため、新しい組み合わせを作成する必要があります。勘定科目の組み合わせが変更されたテーブルから、その新規組み合わせに対する参照を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-384">Therefore, a new combination must be created, and the reference to it must be changed only from the table that the ledger account combination is changed on.</span></span>

<span data-ttu-id="ac76d-385">セグメントの値を追加する、削除するなどレコードの組み合わせを変更すると、新たな勘定分析コードが作成されるので、参照がなく孤立した元帳分析コードとなってしまいます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-385">Because a new Ledger Dimension is created when a user changes the combination on a record by adding or removing segment values, you might end up with unreferenced or orphaned Ledger Dimensions.</span></span> <span data-ttu-id="ac76d-386">孤立した組み合わせを許可することにより、組み合わせを変更するたびに対象テーブルのレコードの削除の確認をする必要がなくなるため、分析コードフレームワーク全体のパフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-386">By allowing orphaned combinations, you can help improve performance of the overall dimension framework to not deletes records across the tables in question each time a combination is changed.</span></span> <span data-ttu-id="ac76d-387">一度使用された組み合わせは、再利用されることがあります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-387">After a combination is used one time, it's likely to be reused.</span></span> <span data-ttu-id="ac76d-388">したがって、最後に残っていた参照が削除された場合でも、再作成されることがあります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-388">Therefore, if it's immediately removed when the last reference is removed, it might be re-created.</span></span> <span data-ttu-id="ac76d-389">元帳分析コードは孤立した状態であっても構造的には有効であり、構造とルールに関連した値の組み合わせが再度入力された場合は再利用することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-389">Orphaned Ledger Dimensions are still structurally valid and can be reused later if the combination of values in relation to the structures and rules is entered again.</span></span> <span data-ttu-id="ac76d-390">この組み合わせが別の時点で入力された場合、レコードは挿入されず、既存の参照が再利用されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-390">If a combination is ever entered another time, no records are inserted, and the existing reference is reused.</span></span> <span data-ttu-id="ac76d-391">結果として、パフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-391">Therefore, performance is improved.</span></span>

<span data-ttu-id="ac76d-392">高度なルールを使用する場合は、記憶領域のサイズやデータ挿入のコストに対しても最適化処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-392">When advanced rules are used, optimizations are also made for the storage size and insertion cost.</span></span> <span data-ttu-id="ac76d-393">たとえば、以下の図では、新しい勘定の組み合わせが入力されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-393">For example, in the following illustration, a new account combination is entered.</span></span>

<span data-ttu-id="ac76d-394">[![変更された勘定科目フィールド](./media/ChangedLedgerAccountField.png)](./media/ChangedLedgerAccountField.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-394">[![Changed ledger account field](./media/ChangedLedgerAccountField.png)](./media/ChangedLedgerAccountField.png)</span></span>

<span data-ttu-id="ac76d-395">この場合、新しい組み合わせと古い組み合わせとの違いは、高度なルール が指定する ライセンスプレート の番号が変更されたことです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-395">In this case, the only difference between the new combination and the previous combination is that the license plate number that was provided by the advanced rule was changed.</span></span> <span data-ttu-id="ac76d-396">以下の図は、この組み合わせのデータがどのように格納されているかを示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-396">The following illustration shows how the data storage of the combination will look.</span></span> <span data-ttu-id="ac76d-397">新しいレコードは白で強調表示されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-397">New records are highlighted in white.</span></span>

<span data-ttu-id="ac76d-398">[![追加された勘定分析コードのクエリ結果](./media/AdditionalLedgerDimensionStorageQueryResults.png)](./media/AdditionalLedgerDimensionStorageQueryResults.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-398">[![Query results for additional ledger dimension storage](./media/AdditionalLedgerDimensionStorageQueryResults.png)](./media/AdditionalLedgerDimensionStorageQueryResults.png)</span></span>

<span data-ttu-id="ac76d-399">新しい組み合わせが作成されると、以下5つのレコードが挿入されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-399">When the new combination is created, the following five records are inserted.</span></span> <span data-ttu-id="ac76d-400">(これらのレコードは、上記の図にて白で強調表示されています)。</span><span class="sxs-lookup"><span data-stu-id="ac76d-400">(These records are the records that are highlighted in white in the preceding illustration.)</span></span>

- <span data-ttu-id="ac76d-401">DimensionAttributeValueCombination テーブルに格納されている1つのレコード</span><span class="sxs-lookup"><span data-stu-id="ac76d-401">One record in DimensionAttributeValueCombination</span></span>
- <span data-ttu-id="ac76d-402">DimensionAttributeValueGroupCombination テーブルに格納されている2つのレコード</span><span class="sxs-lookup"><span data-stu-id="ac76d-402">Two records in DimensionAttributeValueGroupCombination</span></span>
- <span data-ttu-id="ac76d-403">DimensionAttributeValueGroup テーブルに格納されている 1つのレコード</span><span class="sxs-lookup"><span data-stu-id="ac76d-403">One record (instead of two) in DimensionAttributeValueGroup</span></span>
- <span data-ttu-id="ac76d-404">DimensionAttributeLevelValue テーブルに格納されている 1つのレコード</span><span class="sxs-lookup"><span data-stu-id="ac76d-404">One record (instead of three) in DimensionAttributeLevelValue</span></span>

<span data-ttu-id="ac76d-405">この挙動は勘定構造 グループ の一部として保管されている値が、以前の組み合わせ (DAVC2) と今回の組み合わせ (DAVC3) で同じであるために発生します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-405">This behavior occurs because the values that are stored as part of the account structure "group" are the same in the previous combination (DAVC2) and this combination (DAVC3).</span></span> <span data-ttu-id="ac76d-406">DimensionAttributeValueGroup テーブルと DimensionAttributeLevelValue テーブルのレコードは再作成の必要がありませんでした。</span><span class="sxs-lookup"><span data-stu-id="ac76d-406">Those DimensionAttributeValueGroup and DimensionAttributeLevelValue records didn't have to be re-created.</span></span> <span data-ttu-id="ac76d-407">代わりに3つのレコードを再利用し、挿入処理のコストを節約することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-407">Instead, three records could be reused, and their insertion cost could be saved.</span></span>

<span data-ttu-id="ac76d-408">勘定科目のルールに関連付けられている構造で、ライセンスプレート番号に空白の値を許可されており、 **145-Q** の組み合わせだけが作成された場合は、2つの新規レコードのみが挿入されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-408">Alternatively, if the structure that is associated with the account rule allows blank values for the license plate number, and a combination of just **145-Q** is created, only two new records are inserted:</span></span>

- <span data-ttu-id="ac76d-409">DimensionAttributeValueCombination テーブルに格納されている1つのレコード</span><span class="sxs-lookup"><span data-stu-id="ac76d-409">One record in DimensionAttributeValueCombination</span></span>
- <span data-ttu-id="ac76d-410">DimensionAttributeValueGroupCombination テーブルに格納されている1つのレコード</span><span class="sxs-lookup"><span data-stu-id="ac76d-410">One record in DimensionAttributeValueGroupCombination</span></span>
- <span data-ttu-id="ac76d-411">DimensionAttributeValueGroup テーブルには該当するレコードがありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-411">Zero records in DimensionAttributeValueGroup</span></span>
- <span data-ttu-id="ac76d-412">DimensionAttributeLevelValue テーブルには該当するレコードがありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-412">Zero records in DimensionAttributeLevelValue</span></span>

<span data-ttu-id="ac76d-413">この挙動の仕組みとしては、 DimensionAttributeValueGroup テーブルと DimensionAttributeLevelValue テーブルのすべてのレコードが既に存在しており、新しい組み合わせにて完全に再利用できるためです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-413">This behavior occurs because all the DimensionAttributeValueGroup and DimensionAttributeLevelValue records already exist and can be fully reused on the new combination.</span></span> <span data-ttu-id="ac76d-414">こうした挙動が考えられるため、勘定分析コードのストレージテーブル上でデータを直接変更することは避けてください。</span><span class="sxs-lookup"><span data-stu-id="ac76d-414">Primarily for this reason, data should never be modified directly in the Ledger Dimension storage tables.</span></span> <span data-ttu-id="ac76d-415">1つのレコードに対する変更は、元帳分析コードに対するすべての参照に影響するだけでなく、その他の複数の勘定分析コードと参照に影響する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-415">A change to a single record might affect not only all references to that ledger dimension, but also one or more other ledger dimensions and references to them.</span></span>

<span data-ttu-id="ac76d-416">このセクションで説明した例では部分的に表示しきれていませんが、DimensionAttributeValueCombination テーブルと DimensionAttributeValueGroup テーブルには ハッシュコードが割り当てられています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-416">Although it's partially collapsed in the examples shown in this part of the topic, a hash code is assigned to the DimensionAttributeValueCombination and DimensionAttributeValueGroup tables.</span></span>

## <a name="part-6-advanced-topics"></a><span data-ttu-id="ac76d-417">パート6: 高度なトピック</span><span class="sxs-lookup"><span data-stu-id="ac76d-417">Part 6: Advanced topics</span></span>

<span data-ttu-id="ac76d-418">このパートでは、分析コードフレームワークの機能を強化するにあたって、より詳細な設計および実装の意思決定を行う上で役立つ高度なトピックを扱います。</span><span class="sxs-lookup"><span data-stu-id="ac76d-418">To conclude this topic, this part discusses some advanced topics to explain some of the deeper design and implementation decisions that drive the way that the dimension framework works.</span></span>

<span data-ttu-id="ac76d-419">以下の図では、分析コードフレームワークを構成するさまざまな領域を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-419">The model in the following illustration shows the various areas in the dimension framework.</span></span>

<span data-ttu-id="ac76d-420">[![全体的なフレームワーク](./media/OverallFramework.png)](./media/OverallFramework.png)</span><span class="sxs-lookup"><span data-stu-id="ac76d-420">[![Overall framework](./media/OverallFramework.png)](./media/OverallFramework.png)</span></span>

### <a name="hashes"></a><span data-ttu-id="ac76d-421">ハッシュ</span><span class="sxs-lookup"><span data-stu-id="ac76d-421">Hashes</span></span>

<span data-ttu-id="ac76d-422">分析コード フレームワークにおけるデータベース ストレージは、次の機能を目的として設計されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-422">The design of the database storage in the dimension framework is intended for the following functionality:</span></span>

- <span data-ttu-id="ac76d-423">データが挿入されるだけで、更新も削除もしない不変データに対応しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-423">Support immutable data, where data is only inserted, never updated or deleted.</span></span>
- <span data-ttu-id="ac76d-424">作成済みの組み合わせを再利用して、挿入処理のコストを削減します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-424">Reuse previously created combinations to lower insertion costs.</span></span>
- <span data-ttu-id="ac76d-425">参照カウントの実行と管理の必要性をなくします。</span><span class="sxs-lookup"><span data-stu-id="ac76d-425">Avoid reference counting and maintenance of it.</span></span>
- <span data-ttu-id="ac76d-426">再利用可能な既存の組み合わせを検索するにあたって、パフォーマンスの向上が図れます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-426">Provide fast performance to find an existing combination that can be reused.</span></span>

<span data-ttu-id="ac76d-427">勘定科目の組み合わせでは、分析コードの数は無制限で、構造体の数に制限はありません。そのため、1つの大きなクエリまたは複数の小さなクエリを作成して、既存のセットまたは組み合わせを検索することは現実的ではありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-427">Because the dimension framework allows for an unlimited number of dimensions and an unlimited number of structures on a ledger account combination, it's difficult to create a single large query or multiple smaller queries to find an existing set or combination.</span></span> <span data-ttu-id="ac76d-428">レコードの数と順序は、組み合わせごとに異なる可能性があるため、ハッシュ ベースのソリューションが実装されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-428">Because the number of records and the order of those records might differ for every combination, a hash-based solution was implemented.</span></span>

<span data-ttu-id="ac76d-429">ハッシュとは、関連付けられているテーブルのレコードに含まれる固有の情報を意味し、問い合わせ処理の高速化を可能にします。</span><span class="sxs-lookup"><span data-stu-id="ac76d-429">This hash represents the unique information that the records of the associated tables contain, and it allows for fast querying.</span></span> <span data-ttu-id="ac76d-430">データの組み合わせに含まれるするデータを一意に識別するために、単一のバイナリコンテナフィールド (160ビット、20バイトのハッシュ列) が保存されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-430">A single binary container field (160-bit, 20-byte hash column) is stored to uniquely identify the data that the set or combination contains.</span></span>

<span data-ttu-id="ac76d-431">分析コードフレームワークはハッシュを使用して、以下テーブルのデータを一意に識別します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-431">The dimension framework uses hashes to uniquely identify data in the following tables:</span></span>

- <span data-ttu-id="ac76d-432">**Dimensionattributevaluecom** このテーブルは、DimensionAttributeValueGroup テーブルと DimensionAttributeLevelValue テーブルから連係されたすべてのデータで構成されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-432">**DimensionAttributeValueCombination** – This table consists of data from all the linked records in the DimensionAttributeValueGroup and DimensionAttributeLevelValue tables.</span></span>
- <span data-ttu-id="ac76d-433">**DimensionAttributeValueGroup** このテーブルは、DimensionAttributeLevelValue テーブルから連係されたすべてのデータで構成されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-433">**DimensionAttributeValueGroup** – This table consists of data from the linked records in the DimensionAttributeLevelValue table.</span></span>
- <span data-ttu-id="ac76d-434">**DimensionAttributeSet** –このテーブルは、DimensionAttributeSetItem テーブルのレコードと関連付けられているデータで構成されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-434">**DimensionAttributeSet** – This table consists of data from the associated DimensionAttributeSetItem records.</span></span>
- <span data-ttu-id="ac76d-435">**DimensionAttributeSet** –このテーブルは、DimensionAttributeSetItem テーブルのレコードと関連付けられているデータで構成されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-435">**DimensionAttributeValueSet** – This table consists of data from the associated DimensionAttributeValueSetItem records.</span></span>

### <a name="hash-messages"></a><span data-ttu-id="ac76d-436">ハッシュ メッセージ</span><span class="sxs-lookup"><span data-stu-id="ac76d-436">Hash messages</span></span>

<span data-ttu-id="ac76d-437">ハッシュを生成するにあたって、セットまたは組み合わせの内容に関する個々の順序付けられた情報を持つメッセージが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-437">To produce a hash, a message is created that contains individual pieces of ordered information about the contents of the set or combination.</span></span> <span data-ttu-id="ac76d-438">生成されたハッシュによってメッセージは異なりますが、ハッシュメッセージに基本的に含まれているのは、分析コード、値、構造に関する情報と、組み合わせ内における順序が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-438">Although this message varies, depending on the hash that is being generated, the hash message basically includes information about the dimensions, values, and structures, and the order within the set or combination, if applicable.</span></span> <span data-ttu-id="ac76d-439">この情報は、所定の方法で内部的に計算され、ハッシュルーチンに渡されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-439">This information is internally calculated in a prescribed manner and passed on to a hashing routine.</span></span> <span data-ttu-id="ac76d-440">ハッシュ ルーティンは、バイナリ コンテナーを使用してハッシュ キー生成するハッシュを生成します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-440">This hashing routing then generates a hash to generate a hash key by using a binary container.</span></span> <span data-ttu-id="ac76d-441">これらのメッセージの正確な順序と内容は、分析コード フレームワークのストレージサポートクラスのメソッドによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-441">The exact order and contents of these messages are provided by the methods in the storage supporting classes of the dimension framework.</span></span> <span data-ttu-id="ac76d-442">これらのクラスには、 **DimensionAttributeSetStorage**、 **DimensionAttributeValueSetStorage**、 **DimensionStorage** が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-442">These classes include **DimensionAttributeSetStorage**, **DimensionAttributeValueSetStorage**, and **DimensionStorage**.</span></span>

> [!NOTE]
> <span data-ttu-id="ac76d-443">内部ハッシュ関数が Dynamics 365 Finance で更新されました。</span><span class="sxs-lookup"><span data-stu-id="ac76d-443">The internal hash function has been updated in Dynamics 365 Finance.</span></span> <span data-ttu-id="ac76d-444">詳細については、[Dynamics 365 Finance 2020 リリース ウェーブ 2 への更新後にハッシュ関数の変更を確認する](https://cloudblogs.microsoft.com/dynamics365/it/2020/08/03/verify-hash-function-changes-after-update-to-dynamics-365-finance-2020-release-wave-2/)を参照してください</span><span class="sxs-lookup"><span data-stu-id="ac76d-444">For more information, see [Verify hash function changes after update to Dynamics 365 Finance 2020 release wave 2](https://cloudblogs.microsoft.com/dynamics365/it/2020/08/03/verify-hash-function-changes-after-update-to-dynamics-365-finance-2020-release-wave-2/)</span></span>



### <a name="hash-keys"></a><span data-ttu-id="ac76d-445">ハッシュ キー</span><span class="sxs-lookup"><span data-stu-id="ac76d-445">Hash keys</span></span>

<span data-ttu-id="ac76d-446">ハッシュ メッセージを生成するには、分析コード 、値、組み合わせを構成する構造のそれぞれを一意に識別する要素が必要となります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-446">Generation of a hash message requires something that uniquely identifies each dimension, value, and structure that makes up the combination.</span></span> <span data-ttu-id="ac76d-447">**RecId** 値は、一意の識別子として機能しますが、これはサロゲートとして見なされます。これはたとえば、レコードをエクスポートしてから別のシステムまたはパーティションにインポートすると変わる可能性があるため、不変の値とはみなされません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-447">Although a **RecId** value can serve as a unique identifier, it's considered only a surrogate, because it isn't immutable and can change if, for example, the record is exported and then imported into a different system or partition.</span></span> <span data-ttu-id="ac76d-448">**RecId** 値は、インポートプロセス中に再割り当てすることができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-448">The **RecId** value can be reassigned during the import process.</span></span> <span data-ttu-id="ac76d-449">もし **RecId** 値を使用したハッシュメッセージでハッシュが作成された場合は、そのハッシュは作成されたシステムあるいはパーティションの分析コードフレームワークの組み合わせを識別するために使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-449">If a hash is created with a hash message that uses a **RecId** value, it can no longer be used to identify a combination in the dimension framework for that new system or partition.</span></span> <span data-ttu-id="ac76d-450">代わりに、GUID を使用します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-450">Instead, a GUID is used.</span></span> <span data-ttu-id="ac76d-451">GUIDは、DimensionAttribute、DimensionAttributeValue、Dimensionattribute の各テーブルに存在し、 **hashkey** 列に格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-451">This GUID resides on the DimensionAttribute, DimensionAttributeValue, and DimensionHierarchy tables, and is stored in the **HashKey** column.</span></span> <span data-ttu-id="ac76d-452">新しいレコードが作成されるたびにGUIDが割り当てられるため、レコードを一意に識別することができます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-452">Every time that a new record is created, a GUID is assigned and remains with that record to uniquely identify it.</span></span>

### <a name="risks-of-changing-data-directly"></a><span data-ttu-id="ac76d-453">データを直接変更するリスクについて</span><span class="sxs-lookup"><span data-stu-id="ac76d-453">Risks of changing data directly</span></span>

<span data-ttu-id="ac76d-454">アプリケーション フレームワーク (Microsoft SQL Server Management Studio など) の外部でデータを直接変更することは避けてください。</span><span class="sxs-lookup"><span data-stu-id="ac76d-454">It's important that no data be directly modified outside the application framework (for example, in Microsoft SQL Server Management Studio).</span></span> <span data-ttu-id="ac76d-455">このガイドラインは、テーブルに存在する *すべて* の列が対象となります。本トピックで扱う列のみを対象にしているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-455">This guideline applies to the modification of data in *any* column of the table, not just the columns that have been discussed in this topic.</span></span> <span data-ttu-id="ac76d-456">これはさらに、1つの行から別の行へのデータのレプリケーションにも適用され、分析コードフレームワーク ストレージクラスの外部で "新しい" セットまたは組み合わせを作成する処理も対象となります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-456">It also applies to the replication of data from one row to another, and to attempts to create "new" sets or combinations outside the dimension framework storage classes.</span></span>

<span data-ttu-id="ac76d-457">データのバックアップと部分的な復元を検討している場合は、参照とハッシュの整合性に影響を与える可能性のあるこのガイドラインを理解しておくことが重要です。</span><span class="sxs-lookup"><span data-stu-id="ac76d-457">It's important that you understand this guideline when you're considering backups and partial restorations of data that might affect referential and hash integrity.</span></span> <span data-ttu-id="ac76d-458">たとえば、勘定分析コードに関連するレコードのみをバックアップし、それを別の区分にインポートした場合、すべてのバッキングエンティティレコードに加えて、分析コードフレームワーク内の他のすべてのレコードをインポートしない限り、問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-458">For example, if you back up only the Ledger Dimension related records and import them into another partition, you might cause issues unless you also import all the other records in the dimension framework, in addition to all the backing entity records, such as records from the CustTable table or other table that were used to create any combinations.</span></span> <span data-ttu-id="ac76d-459">こうしたテーブルのデータの変更をしたり、GUIDやハッシュを合成することが、データの破損を引き起こし、結果として複雑で時間のかかる原因調査や修復をすることになります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-459">Any attempt to modify the data in these tables, or to synthesize GUIDs or hashes, will cause data to become corrupted, and will require complex, time-consuming analysis to find the source of the corruption and try to fix it.</span></span>

### <a name="apparent-duplicate-combinations"></a><span data-ttu-id="ac76d-460">組み合わせの重複</span><span class="sxs-lookup"><span data-stu-id="ac76d-460">Apparent duplicate combinations</span></span>

<span data-ttu-id="ac76d-461">分析コードフレームワークのテーブルを参照して、保存されているレコードの **DisplayValue** フィールドのみを表示すると、組み合わせが重複しているように見える場合があります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-461">When you browse the tables of the dimension framework and view only the **DisplayValue** field that is stored on the records, it might appear that combinations are duplicated.</span></span> <span data-ttu-id="ac76d-462">しかし、 **displayvalue** の内容が同じで見かけ上は重複していても、ハッシュまたは結合テーブルのデータが異なることがわかります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-462">However, this apparent duplication just indicates that data in the hash or joined tables differs, even though the **DisplayValue** strings appear the same.</span></span> <span data-ttu-id="ac76d-463">**Displayvalue** 文字列は、パフォーマンスの向上を目的として格納されているのであって、レコードを一意に識別するために使用されるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-463">The **DisplayValue** strings are stored on the records to improve performance for some scenarios, but they aren't used to uniquely identify the record.</span></span>

<span data-ttu-id="ac76d-464">たとえば、ある会社の勘定構造に **MainAccount-Department** があり、別の会社の勘定構造に **MainAccount-CostCenter** があるとします。</span><span class="sxs-lookup"><span data-stu-id="ac76d-464">For example, an account structure has **MainAccount-Department** in one company and another account structure has **MainAccount-CostCenter** in a different company.</span></span> <span data-ttu-id="ac76d-465">このシナリオでは、勘定構造ごとに1つずつ、2つの組み合わせの **DisplayValue** 文字列が **145-A** と表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-465">In this scenario, the **DisplayValue** string of two combinations, one for each account structure, can appear as **145-A**.</span></span> <span data-ttu-id="ac76d-466">最初の勘定構造では、 **A** が最初の会社の部門を表します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-466">For the first account structure, **A** represents a department in the first company.</span></span> <span data-ttu-id="ac76d-467">しかし、2番目の勘定構造では、2番目の会社の原価部門を表します。</span><span class="sxs-lookup"><span data-stu-id="ac76d-467">However, for the second account structure, it represents a cost center in the second company.</span></span> <span data-ttu-id="ac76d-468">DimensionAttributeValueCombination テーブルには、複数の種類の元帳分析コードが格納されています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-468">Additionally, multiple types of a Ledger Dimension are stored in the DimensionAttributeValueCombination table.</span></span> <span data-ttu-id="ac76d-469">たとえば、 **DisplayValue** のフィールドを確認すると、予算に関する特別なタイプは他の組み合わせのタイプと同じに見えることがあります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-469">For example, special types for budgeting might appear the same to have the types as other combinations when you examine the **DisplayValue** fields.</span></span> <span data-ttu-id="ac76d-470">しかし、内部的には異なる情報を保持し、それぞれ異なる一意のハッシュ値を保持しているのです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-470">However, they hold different information internally and hold uniquely different hash values.</span></span>

### <a name="versioningdate-effective-data"></a><span data-ttu-id="ac76d-471">バージョン管理/有効日付データ</span><span class="sxs-lookup"><span data-stu-id="ac76d-471">Versioning/date-effective data</span></span>

<span data-ttu-id="ac76d-472">分析コードフレームワークでは、バージョン管理データまたは日付効率データに直接対応していません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-472">The dimension framework doesn't directly support versioning or date-effective data.</span></span> <span data-ttu-id="ac76d-473">分析コードフレームワークが参照するバッキングエンティティがバージョン管理されており、バージョンが異なる同一テーブル内で **RecId** の値が新たに更新されている場合は、フレームワークが dimensionattributevalue のレコードを使用して該当のバージョンへと正しく連係を行います。</span><span class="sxs-lookup"><span data-stu-id="ac76d-473">If any backing entities that the dimension framework references are versioned, and a new **RecId** value is assigned to newer versions in the same table, the framework will correctly link to the correct version through the DimensionAttributeValue record.</span></span> <span data-ttu-id="ac76d-474">同じバッキング エンティティ レコードが使用されていて、別のテーブルが所有しているモジュール内の改訂情報を追跡している場合は、分析コードフレームワークではこのバージョン間の差異を特定できません。これはバッキングエンティティに存在する **RecId** の値が異なるバージョン間であっても同一であるためです。</span><span class="sxs-lookup"><span data-stu-id="ac76d-474">If the same backing entity record is used, and another table tracks revisions to it in the owning module, the dimension framework won't be able to determine the difference, because the **RecId** value of the backing entity won't differ between versions.</span></span> <span data-ttu-id="ac76d-475">分析コードフレームワーク のテーブル は (分析コード、構造、ルール、制約など)、いすれもバージョン管理情報を内部に保持していません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-475">None of the dimension framework tables (such as dimensions, structures, rules, and constraints) support versioning internally.</span></span> <span data-ttu-id="ac76d-476">古いバージョンは新たなバージョンに置き換えられ、履歴は保持されていません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-476">The previous versions are replaced with a new version, and no history is maintained.</span></span>

<span data-ttu-id="ac76d-477">構造またはルールが変更された場合、勘定科目の組み合わせが未転記トランザクションに対して保存されていると、分析コードフレームワークが新しい組み合わせが作成し、未転記のトランザクションテーブルの外部キー参照がすべて更新されます。</span><span class="sxs-lookup"><span data-stu-id="ac76d-477">When a structure or rule is changed, if ledger account combinations have been saved on unposted transactions, the dimension framework creates new combinations and updates any foreign key references to them on unposted transaction tables.</span></span> <span data-ttu-id="ac76d-478">転記されたトランザクションから参照されている場合があるため、元の組み合わせは変更されません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-478">It doesn't change the original combinations, because those combinations might be referenced from posted transactions.</span></span> <span data-ttu-id="ac76d-479">この2つの組み合わせは、連係されることがありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-479">The two combinations aren't linked in any way.</span></span> <span data-ttu-id="ac76d-480">変更前の構造とルールがどのようなものであったかを判別する方法はありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-480">There is no way to determine what a structure and its rules looked like before the change.</span></span> <span data-ttu-id="ac76d-481">一部の情報は、格納されている組み合わせによって判別できる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="ac76d-481">Some information can be determined by the data that is stored in the combination.</span></span> <span data-ttu-id="ac76d-482">ただし、空白の値は保存されておらず、不完全なデータとみなされるため、古いバージョンの再構築に使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-482">However, because blank values aren't stored, this data is incomplete and can't be used to reconstruct a previous version.</span></span>

<span data-ttu-id="ac76d-483">分析コードフレームワークでは、分析コード値レベルでの "有効な開始日付" と "有効な終了日付" の両方に対応しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-483">The dimension framework supports "valid from" and "valid to" dates at the level of a dimension value.</span></span> <span data-ttu-id="ac76d-484">これらの日付は、値が "有効" なものであると見なされた時点の日付を示しています。</span><span class="sxs-lookup"><span data-stu-id="ac76d-484">These dates indicate when the value is considered "valid."</span></span> <span data-ttu-id="ac76d-485">これらは有効日付データと同様で、値の過去の状態を意味するものではありません。</span><span class="sxs-lookup"><span data-stu-id="ac76d-485">They don't represent the historical state of the value in the same way that date-effective data does.</span></span>


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]