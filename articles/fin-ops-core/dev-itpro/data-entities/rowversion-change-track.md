---
title: テーブルおよびデータ エンティティに対する行バージョン変更追跡の許可
description: この記事では、財務および運用アプリのデータ エンティティおよびテーブルについて行バージョン変更追跡を有効にする方法について説明します。
author: peakerbl
ms.date: 09/28/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: ''
ms.search.region: Global
ms.author: peakerbl
ms.search.validFrom: 2022-10-10
ms.dyn365.ops.version: 10.0.31
ms.openlocfilehash: 8a58bf40c997081c5a62a55bf37bf85f2553acd4
ms.sourcegitcommit: 40c80a617b903c2b26e44b41147e0021c5cb680d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/18/2022
ms.locfileid: "9691012"
---
# <a name="allow-row-version-change-tracking-for-tables-and-data-entities"></a>テーブルおよびデータ エンティティに対する行バージョン変更追跡の許可

[!include[banner](../includes/banner.md)]
[!include [preview banner](../includes/preview-banner.md)]

財務および運用アプリに新しい変更追跡オプションが追加されました。 このオプションを使用すると、データの差分同期化に Microsoft Dataverse を使用できます。 変更追跡は、データ アーカイブ、Synapse Analytics 統合、モバイル オフライン、関連検索など、複数の機能に対する前提条件です。 最終目標は、Dataverse 同期サービスに基づいて、既存する財務と運用のデータ同期フレームワークすべてを一つに統合することです。

行バージョン変更追跡でデータ エンティティを使用できるよう、データ エンティティを作成または更新する前に、それらのエンティティのデータ ソースとして使用され、すべてのテーブルが行バージョン変更追跡を許可確認します。

新しいエンティティの作成方法のその他の詳細については、[データ エンティティの構築と使用](/dev-itpro/data-entities/build-consuming-data-entities.md) を参照してください。

## <a name="enable-row-version-change-tracking-for-tables"></a>テーブルに対して行バージョンの変更追跡を有効化する

テーブルのメタデータ プロパティを **はい** に設定することで、**行バージョン変更追跡を許可** オプションを有効にできます。 データ エンティティのデータ ソースとして使用して、そのエンティティの行バージョン変更追跡を有効にするには、このプロパティを **はい** に設定する必要があります。 ビルド操作時に、**rowversion** データ型の **SysRowVersionNumber** 列がテーブルに追加されます。

**SysRowVersionNumber** 列 は、テーブル行のバージョン スタンプを実行します。 SQL Server では、挿入操作または更新操作のごとに増分するデータベース レベルのカウンターが管理されます。 テーブル行への変更を検出するには、**SysRowVersionNumber** 列の現在の値を前の値と比較します。

> [!NOTE]
> SQL Server では、**SysRowVersionNumber** 列 (**rowversion** 列とも呼ばれる) は読み取り専用です。 したがって、次の例のような直接 SQL 更新ステートメントは、この列を作成または更新しようとする場合に破損します。
>
> ```SQL
> INSERT INTO table2
> SELECT * FROM table1
> ```

## <a name="enable-row-version-change-tracking-for-data-entities"></a>データ エンティティに対して行バージョンの変更追跡を有効化する

データ エンティティのメタデータ プロパティを **はい** に設定することで、**行バージョン変更追跡を許可** オプションを有効にできます。 すべての既存のデータ エンティティが行バージョン変更追跡をサポートするように構成されているわけではありません。 主な制限要素は、エンティティの複雑さです。 データ エンティティで **行バージョン変更追跡を許可** が **はい** に設定されている場合、検証ルールがビルド時に評価されます。 ただし、エンティティを作成または更新する際は、引き続きこれらのルールを確認し、事前に適用することをお勧めします。

次の表では、データ エンティティ検証ルールについて説明します。

| ルール | コメント | エラー メッセージ |
|------|----------|---------------|
| カスタム変更追跡クエリを持つデータ エンティティはサポートされていません。 | | F&O エンティティ %1 がカスタム クエリを使用しているため、変更追跡を有効化できません。 |
| 範囲フィルターを使用するデータ エンティティはサポートされていません。 | <p>範囲フィルターを使用すると、レコードがビューから除外される場合があります。 この場合、変更は削除として追跡されません。</p>[![データ エンティティの範囲のスクリーン ショット。](./media/DERanges.jpg)](./media/DERanges.jpg) | F&O エンティティ %1 が範囲を含むため、変更追跡を有効化できません。 |
| データ ソースに条件別のグループが設定されているデータ エンティティはサポートされていません。 | [![データ エンティティ Group By のスクリーン ショット。](./media/DataSourceGroupBy.jpg)](./media/DataSourceGroupBy.jpg) | F&O エンティティ %2 のデータ ソース %1 が Group By 条件を含むため、変更追跡を有効化できません。 |
| データ エンティティのデータ ソース数がしきい値を下回る必要があります。 | しきい値が 10 を超え、5 を超えた場合に警告が表示されます。 この数は、最大 10 まで構成できます。 この制限は、パフォーマンスの向上に役立ちます。 | F&O エンティティ %1 が %2 を超えるデータ ソースを含むため、変更追跡を有効化できません。  |
| データ ソースに範囲フィルターが設定されているデータ エンティティはサポートされていません。 | [![データ ソース範囲のスクリーン ショット。](./media/DataSourceRangesjpg.jpg)](./media/DataSourceRangesjpg.jpg) | F&O エンティティ %2 のデータ ソース %1 が範囲を含むため、変更追跡を有効化できません。  |
| テーブル以外のデータ ソースを持つデータ エンティティはサポートされていません。 | データ ソースとしてビューを含む入れ子になったデータ エンティティまたはデータ エンティティはサポートされていません。 | F&O エンティティ %1 のデータ ソース %2 がテーブルでないため、変更追跡を有効化できません。   |
| データ エンティティのすべてのテーブルは、行バージョン変更追跡を許可する必要があります。 | [![行バージョンの変更追跡を許可するのスクリーン ショット。](./media/AllowRowVersionChangeTracking.jpg)](./media/AllowRowVersionChangeTracking.jpg) | F&O エンティティ %1 のデータ ソース %2 に関連するテーブルが含む **行バージョンの変更追跡を許可する** プロパティを **はい** に設定していないため、変更追跡を有効化できません。 |
| データ エンティティのデータ ソースは、外部結合を使用して結合する必要があります。 | <p>内部結合および存在結合はサポートされていません。 非外部結合を使用すると、レコードがビューから除外される場合があります。 この場合、変更は削除として追跡されません。</p>[![データ ソース結合モードのスクリーン ショット。](./media/OuterJoinMode.jpg)](./media/OuterJoinMode.jpg) | F&O エンティティ %3 が含むデータ ソース %1 と %2 の結合モードが %4 でないため、変更追跡を有効化できません。   | 
| データ ソース間の関係は、多対 1 である必要があります。 | 1 対多の関係はサポートされていません。 1 対多の関係により、重複する仮想テーブル **entityid** 値が生成されます。 | F&O エンティティ %4 が含むデータ ソース %2 と %3 のリレーション %1 が 1 対多でないため、変更追跡を有効化できません。  |
| データ エンティティのデータ ソースでは、通常の関係制約のみがサポートされます。 | [![データ ソース関係制約のスクリーン ショット。](./media/DataSourceRelations.jpg)](./media/DataSourceRelations.jpg) | F&O エンティティ %4 が含むデータ ソース %2 と %3 のリレーション %1 を通常に設定していないため、変更追跡を有効化できません。  |
| 時間の状態に対応するテーブルを持つデータ エンティティを検証します。 | **適用日** フィルターがサポートされていないルート テーブルは、レコードが消失する可能性があるためにサポートされていません。 時間状態テーブルは、レコードの消失や一対多の関係の原因になる可能性があるため、関連するデータ ソースに対してサポートされていません。 | F&O エンティティ %1 のデータ ソース %3 は時間状態が有効なテーブル %2 を含むため、変更の追跡を有効化できません。 |

データ エンティティで **行バージョン変更の追跡を許可** が **はい** に設定されている場合、プライマリ テーブルの **SysRowVersionNumber** 列がデータ エンティティ ビューに追加されます。

## <a name="track-deletions-and-cleanup"></a>削除とクリーンアップの追跡

データ エンティティの行の削除は、**AifChangeTrackingDeletedObject** テーブルを使用して追跡されます。

**削除追跡履歴のクリーンアップ** という名前のシステム バッチ ジョブは、保管期間を過ごした **AifChangeTrackingDeletedObject** テーブル内のレコードをクリーンアップします。 レコードは、タイムアウト基準に到達するまでバッチで削除されます。 既定では、毎日午前 1:00 にジョブが実行されます。 ただし、**システム管理 \> バッチ ジョブ** でジョブの繰り返しとジョブの頻度を構成できます。 現在、保管期間は 10 日です。

## <a name="retrieve-row-version-entity-changes"></a>行バージョン エンティティの変更の取得

この変更追跡機能は Dataverse 変更追跡と完全に互換性があります。ただし、違いもいくつかあります。 たとえば、Dataverse テーブルに対して使用される 90 日の値ではなく最後のトークンが既定値 10 日以内にある場合、財務およびオペレーション アプリに対する変更が返されます。 詳細については、[変更追跡を使用した外部システムとのデータの同期](/power-apps/developer/data-platform/use-change-tracking-synchronize-data-external-systems.md) を参照してください。 

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
