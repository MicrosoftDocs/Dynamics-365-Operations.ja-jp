---
title: データ移行のエンティティの開発
description: このチュートリアルでは、Microsoft Visual Studio でデータ エンティティを開発し、データ移行に使用する方法を示します。
author: Sunil-Garg
manager: AnnBe
ms.date: 06/20/2017
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer
ms.reviewer: sericks
ms.search.scope: Operations
ms.custom: 83692
ms.assetid: ebe9c79a-029d-4f03-9bd8-d17e805baa89
ms.search.region: Global
ms.author: sunilg
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: 284ffe0a48aef1c5c282ec9d974ca616ea707832
ms.sourcegitcommit: 3ba95d50b8262fa0f43d4faad76adac4d05eb3ea
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "2191539"
---
# <a name="develop-entities-for-data-migration"></a>データ移行のエンティティの開発

[!include [banner](../includes/banner.md)]

このチュートリアルでは、Microsoft Visual Studio でデータ エンティティを開発し、データ移行に使用する方法を示します。

このチュートリアルは、2 つのセクションと 4 つの演習に分かれています。 最初のセクションでは、Visual Studio で**プロジェクト カテゴリ** エンティティを構築します。 次に、このエンティティを使用して、データをエクスポートします。 2 番目のセクションで、新しいデータのインポート/エクスポート フレームワークを使用することで、**顧客グループ**および**顧客**エンティティを使用して複数のセットのファイルをインポートします。

> [!NOTE]
> このチュートリアルは、[データ エンティティの構築と消費](build-consuming-data-entities.md)よりもさらに少し難しく設計されています。 ステップ バイ ステップのガイドを提供するのではなく、シナリオ練習を設けて、期待される結果を示します。 エンティティをすでに理解していることを前提としています。

## <a name="prerequisites"></a>前提条件
このチュートリアルでは、リモート デスクトップを使用して環境にアクセスする必要があります。 インスタンスに管理者としてプロビジョニングする必要があります。

## <a name="base-url"></a>基準 URL
このチュートリアルでは、「ベース URL」はインスタンスのベース URL を指します。

- クラウド環境では、ベース URL は Microsoft Dynamics Lifecycle Services (LCS) から取得されます。
- ローカル仮想マシン (VM) の、基準 URL は https://usnconeboxax1aos.cloud.onebox.dynamics.com です。

## <a name="developing-an-entity-in-visual-studio-and-enabling-it-for-data-export"></a>Visual Studio でエンティティを開発し、データをエクスポートできるようにする
### <a name="business-problem"></a>ビジネスの問題

プロジェクト モジュールの新しいソリューションを開発しています。 実装の一環として、このデータをシステムにインポートするか、システムからエクスポートできるようにプロジェクト カテゴリのデータを表す必要があります。 この目標を達成するには、まずプロジェクト カテゴリのエンティティを作成し、エクスポート機能を使用してデータ抽出をテストします。

### <a name="exercise-1-build-a-project-category-entity"></a>手順 1: プロジェクト カテゴリのエンティティを構築

この練習では、**プロジェクト カテゴリ**というエンティティを構築し、ProjCategory テーブルをプライマリ データ ソースとして使用します。 このエンティティには、次のプロパティがあります。

| プロパティ               | 先頭値                 |
|------------------------|-----------------------|
| エンティティ AOT の名前        | ProjectCategoryEntity |
| ラベル                  | プロジェクト カテゴリ    |
| エンティティ カテゴリ        | 参照             |
| パブリック名            | ProjectCategory       |
| グループ名        | ProjectCategories     |
| パブリック API の有効化      | 有                   |
| データ管理の有効化 | 有                   |

エンティティには、次のフィールドもあります。

- ActiveInJournals
- CategoryGroup
- カテゴリ
- TransactionType
- CategoryName
- ワーカー
- CustomerPaymentRetention
- IndirectCostComponent
- ItemSalesTaxGroup
- ServiceCode
- 休暇

#### <a name="steps"></a>ステップ

1. Visual Studio で、新しいアプリケーション プロジェクトを作成します。
2. ソリューション エクスプローラーで、プロジェクトを選択してから**プロパティ**を右クリックします。
3. 次のプロジェクト プロパティを指定し、**OK** をクリックします。

    | プロパティ                      | 先頭値             |
    |-------------------------------|-------------------|
    | モデル                         | Application Suite |
    | 法人                       | USSI              |
    | ビルド上にデータベースを同期 | はい              |

4. プロジェクトから、**追加** &gt; **新しい品目**を右クリックします。
5. **データ モデル** &gt; **データ エンティティ** を新しい項目として選択します。
6. 名前を入力し、次に**追加**をクリックすると**データ** **エンティティ**ウィザードが開始されます。
7. ウィザードの最初のページで、この練習の前の表を使用して、エンティティのプロパティのセットを指定します。 **次へ** をクリックします。

    [![プロパティ ページの指定](./media/specifyproperties_devoentity.png)](./media/specifyproperties_devoentity.png)

8. 次のページで、プライマリ データ ソースからフィールドを追加します。 フィールド名ごとに、パブリック契約が反映されていることを確認します (この練習では前の表を参照してください)。 フィールドのラベルをフィールド名として使用するには、**ラベルをフィールド名に変換** オプションを選択します。 エンティティに必須ではないフィールドのオプションをクリアします。
9. ウィザードを完了し、エンティティとそのコンポーネントをプロジェクトに追加するには、**完了**をクリックします。
10. エンティティの使用を開始できるように、プロジェクトをビルドします。

#### <a name="expected-outcome"></a>予想される結果

- Visual Studio で、**データ エンティティ** ウィザードを完了すると、次のコンポーネントがプロジェクトに表示されます。

    [![新規プロジェクト コンポーネント](./media/testappsuite_devoentity.png)](./media/testappsuite_devoentity.png)

- データ エンティティを右クリックし、**テーブル ブラウザーを開く** を選択します。

    > [!NOTE]
    > 会社が **USSI** に設定されていることを確認してください。

### <a name="exercise-2-export-a-limited-set-of-data-by-using-a-sample-file-mapping-and-filters"></a>手順 2: サンプル ファイル マッピングおよびフィルターを使用して限られたデータ セットをエクスポート

この練習では、データをエクスポートするために構築した**プロジェクト カテゴリ** エンティティを使用します。 データのサブセットのみをエクスポートするには、サンプル ファイルのマッピングとフィルターを使用します。 エクスポートされたデータは XML 形式です。

#### <a name="steps"></a>ステップ

1. **プロジェクト カテゴリ** エンティティを作成した後、クライアントを開始します。
2. 会社を **USSI** に変更します。
3. **データ管理**ワークスペースで、**エクスポート**をクリックしてデータの抽出を開始します。
4. エンティティ名およびターゲット データ形式などのエクスポートの詳細を入力します。

    [![エクスポートの詳細の入力](./media/exportprojectcategory_devoentity.png)](./media/exportprojectcategory_devoentity.png)

    XML のサンプル ファイル形式として、[ProjectCategoryExport\_Sample](https://go.microsoft.com/fwlink/?linkid=845209) ファイルを使用します。

    テキスト エディタでこのファイルを開き、XML ファイルとして保存します。 サンプル ファイル マッピングが無効の場合、エンティティに不適切なフィールド名があります。 続行するため、エンティティまたはサンプル ファイルのいずれかを修正します。

5. **フィルター**をクリックし、フィルター条件として**プロジェクト**を指定すると、限定されたデータのみがエクスポートされます。

    [![プロジェクトによるフィルター処理](./media/inquiry_devoentity.png)](./media/inquiry_devoentity.png)

6. **エクスポート** ダイアログ ボックスで、**OK** をクリックします。

#### <a name="expected-outcome"></a>予想される結果

- 15 のレコードは正常にエクスポートされます。
- 出力は次のファイルに似ています。[ProjectCategoryExport\_Output](https://go.microsoft.com/fwlink/?linkid=845210)。 (この結果を確認するにはテキスト エディタでファイルを開きます。)

## <a name="migrating-data-in-multiple-files-by-using-the-data-importexport-framework"></a>データのインポート/エクスポート フレームワークを使用した複数のファイルのデータの移行
### <a name="business-problem"></a>ビジネスの問題

新しい環境を実装しています。 この実装の一環として、レガシ顧客データを移行する必要があります。 データは 2 つのファイル セットに含まれ、各ファイルには**顧客**および**顧客顧客グループ**のエンティティのデータが含まれています。 データ ファイルの一部の列がエンティティに直接マップされないため、この移行はやや複雑です。 また、ファイルには、インポート処理中に修正する必要がある検証エラーがあります。

### <a name="exercise-3-create-a-data-project-and-import-multiple-files"></a>手順 3: データ プロジェクトを作成し、複数のファイルをインポート

この練習では、新しいデータのインポート/エクスポート フレームワークを使用して、2 つのファイルを **USRT** という会社にインポートします。 これらのファイルは、単一のデータ プロジェクトを使用して順番にインポートする必要があります。 **顧客** エンティティには、**顧客グループ** エンティティへの参照があります。 Customers1 ファイルが**顧客**エンティティに正しくマップされないため、ファイルをアップロードするときにエラーが表示されます。 したがって、インポート プロセスを完了するには、**Customers** エンティティに正しい列マッピングを提供する必要があります。

#### <a name="steps"></a>ステップ

1. Microsoft Excel で以下のファイルを開いて、ローカル ディレクトリ内に CSV ファイルとして保存する:

    - [Customers1](https://go.microsoft.com/fwlink/?linkid=845211)
    - [CustomerGroups1](https://go.microsoft.com/fwlink/?linkid=845212)

2. クライアントで、会社を **USRT** に変更します。
3. **ユーザー**ダッシュ ボードから、**データ管理**ワークスペースを開きます。
4. 新しいデータ プロジェクトを設定するには、**インポート**をクリックします。
5. 名前およびファイルの形式などのプロジェクト詳細を入力します。
6. 各ファイルについては、エンティティを選択し、次にデータ ファイルをアップロードします。
7. Customer1.csv ファイルが**顧客**エンティティに正しくマップされないため、ファイルをアップロードするときにエラーが表示されます。 ファイルがアップロードされた後、**マッピングの表示**をクリックし、**顧客**エンティティ列のマッピングを修正します。

    > [!TIP]
    > **CustomerAccount** はインポート中にエンティティで必要です。 ソース ファイルで **AccountNum** からマップされます。 住所フィールドは、インポートのオプションです。

8. 完了したら、ブラウザの **戻る** ボタンをクリックして、データ プロジェクトに戻ります。
9. **データ プロジェクト**ページで、**今すぐインポート**をクリックします。

#### <a name="expected-outcome"></a>予想される結果

4 つの更新および 23 の挿入が正常にインポートされ、**実行の要約**ページが結果を表示します。

### <a name="exercise-4-re-import-by-using-an-existing-data-project-and-manage-data-in-staging"></a>手順 4: 既存のデータ プロジェクトを使い再インポートし、ステージングでデータを管理

この練習では、新しいファイルのセットを使用して、既存のデータ プロジェクトからデータをインポートします。 Customers2 は**顧客**エンティティの新規および更新されたデータを含みます。 CustomerGroups2 は**顧客グループ** エンティティの更新されたデータを含みます。 Customers2 には、いくつかのエラー レコードが含まれています。 ステージングでのこれらのエラーを修正し、データを検証し、それをターゲットに送って、インポートを実行します。

#### <a name="steps"></a>ステップ

1. **データ管理**ワークスペースで、既存のデータ プロジェクトを選択し、**再インポート**をクリックします。 再インポート機能を使用することにより、データ プロジェクトの以前の設定を保持し、インポートに新しいファイルを使用することができます。 ただし、**データ プロジェクトの再読み込み**をクリックし、代わりに新しいファイルをアップロードする場合、以前のマッピングが上書きされます。
2. Excel で以下のファイルを開いて、ローカル ディレクトリ内の CSV ファイルとして保存する:

    - [Customers2](https://go.microsoft.com/fwlink/?linkid=845213)
    - [CustomerGroups2](https://go.microsoft.com/fwlink/?linkid=845214)

3. 各エンティティの新しいファイルをアップロードし、**今すぐインポート** をクリックします。
4. **ステータス**ページで、**実行ログの表示**をクリックしてエラーを調査します。
5. **ステータス**ページで、**ステージングの表示**をクリックして、ステージング テーブルのデータを表示します。 このビューには、エラーのあるレコードも表示されます。
6. エラーが発生したレコードを修正するには、**編集**をクリックします。 (DM10221 および DM1022 レコードの**顧客グループ**値は無効です。)
7. 修正したレコードを選択し、**検証** をクリックします。 ページを更新し、レコードのステータスが **検証済み** であることを確認します。
8. **データをターゲットにコピー**をクリックします。
9. **実行するジョブ ID の選択**ダイアログ ボックスの**実行**フィールドで**基準**を選択して、**ユーザーによって選択された行**を**はい**に設定します。 **OK** をクリックします。

    [![実行するジョブの選択](./media/selectjob_devoentity.png)](./media/selectjob_devoentity.png)

10. **ターゲット データ実行**ページで、**実行**をクリックします。
11. 実行が完了したら、ページを更新して、最新のステージングの状態を確認します。

#### <a name="expected-outcome"></a>予想される結果

- 最初の試行で、**顧客グループ**エンティティのインポートが成功し、**顧客**エンティティでは部分的に成功します。
- **実行の概要** ページには、5 つのレコードが作成され、3 つのレコードが更新され、2 つのレコードにエラーがあることが表示されます。
- ステージング ビューでは、2 つのレコードにエラーがあります。
- レコードを修正し再度インポートを実行すると、ステージング ビューにすべてのレコードが完了したことが表示されます。
