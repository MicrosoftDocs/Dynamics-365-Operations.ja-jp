---
title: 企業または法人エンティティ間で行う設定データのコピーの概要
description: このトピックでは、データ プロジェクトとデータ テンプレートを使用して、アプリのインスタンス間で企業または法人のコンフィギュレーション データを移動する方法について説明します。
author: mikefalkner
ms.date: 07/25/2019
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.custom: 77523
ms.search.region: Global
ms.author: sericks
ms.search.validFrom: 2017-07-31
ms.dyn365.ops.version: Platform update 7
ms.openlocfilehash: 5c110d1d1468def66a1b6cb7e20083441a809e81
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5752314"
---
# <a name="copy-configuration-data-between-companies-or-legal-entities-overview"></a>企業または法人エンティティ間で行う設定データのコピーの概要

[!include [banner](../includes/banner.md)]

Finance and Operations では、コンフィギュレーション データをコピーするために 2 つのオプションがあります。

- インスタンス間でデータを移動するには、最初にある会社からデータをエクスポートしてから、別の会社にインポートする必要があります。
- データを同一インスタンス内のある法人から別の法人に移動するには、**法人にコピー** 機能を使用します。

## <a name="export-a-configuration"></a>コンフィギュレーションのエクスポート

**データ管理** ワークスペースは、コンフィギュレーション データ プロジェクトを管理してデータ パッケージをエクスポートするためのハブとなります。 構成をビルドするには、データ プロジェクトを定義し、エンティティによって表される情報をエクスポートする必要があります。

エクスポート構成データ プロジェクトを作成するには、次の手順を実行します。

1. **データ管理** ワークスペースを開きます。 標準のビューを使用している場合は、**強化されたビュー** を選択します。
2. **エクスポート** タイルを選択します。
3. **新規** を選択してエクスポート コンフィギュレーション データ プロジェクトを作成し、コンフィギュレーションの ID と名前を入力します。
4. データ プロジェクトの操作タイプを **エクスポート** に設定し、プロジェクト カテゴリを **コンフィギュレーション** に設定します。
5. エクスポートする情報を表すエンティティを追加します。 次のいくつかのメソッドを使用してエンティティを追加することができます。

    - **1 つのエンティティを追加** - ルックアップに表示されるまで、エンティティの名前の最初の部分を入力します。
    - **複数のエンティティを追加** - エンティティ名の一部を入力、モジュールのルックアップを使用、タグの名前の一部を入力、またはエンティティ カテゴリのルックアップを使用して、エンティティの一覧を表示します。 Tab キーを押してフォーカスを **参照** フィールドの外に移動し、フィルターをアクティブにします。 グリッドで、追加するエンティティを選択します。
    - **ファイルを追加** - エンティティ名に一致する名前とデータ ソースにあるファイル名拡張子と一致するファイル名拡張子を含むファイルを参照します。
    - **テンプレートを追加する** - インスタンスでロードされたテンプレートの一覧から選択します。

6. ターゲット データ形式を選択します。 選択した最後のデータ形式が保存されます。 または、ファイルを選択する場合、ファイル名拡張子に一致するデータ ソースにシステムは自動的にデータ形式を設定します。

    > [!NOTE]
    > 複合エンティティには、XML 形式が必要です。

7. **追加** を選択します。 テンプレートを読み込み、そのテンプレート内のエンティティに一致するエンティティがプロジェクトにすでに含まれている場合、プロジェクト内のエンティティはテンプレート内のエンティティに置き換えられます。 一部のテンプレートは非常に大規模であり、読み込むのに数秒かかる場合があります。
8. **エンティティの削除** を選択し、選択したエンティティを 1 つ以上削除します。
9. コンフィギュレーションが完了したら、**エクスポート** を選択してエクスポートを開始します。 表示される **実行の要約** ページで結果を監視することができます。

コンフィギュレーションをエクスポートする前に、エクスポート プロセスの管理に役立ついくつかの追加機能を使用できます。

- 一覧を整理するには、**並べ替え** ボタンを使用して、単位、レベル、シーケンスでエンティティの順序を変更します。
- いずれかのエンティティの実行順序を変更するには、ユニット、レベル、またはシーケンスを手動で編集します。 または、**再シーケンス** ボタンを使用して選択したすべてのエンティティを更新できます。 **再シーケンス** ボタンは、複数のエンティティを選択する場合にのみ表示されます。 単位、レベル、およびシーケンスを個別に変更することができます。 または、複数の変更を有効にして同時に変更することができます。 シーケンスの複数の部分を変更したときにユニット、レベル、シーケンスを変更しない場合は、増分値を **0** (zero) に設定します。
- エンティティにフィルターを追加するには、**フィルター** ボタンを使用します。 フィルターを追加する場合、**フィルター** ボタンが **編集** ボタンに変更されます。 データはエクスポートする前にフィルタ処理されます。 テンプレートを追加して、そのテンプレートにフィルターが含まれる場合、それらのフィルターはプロジェクトに追加されます。 ただし、必要に応じて変更または削除できます。
- エンティティ マッピングを変更する必要がある場合、**マップの表示** ボタンを使用します。 テンプレートを追加して、そのテンプレートにマッピングの変更が含まれる場合、それらの変更はプロジェクトに適用されます。 ただし、必要に応じて変更できます。
- データ プロジェクトをエクスポートするときにエンティティが一時的に使用されないようにするには、**無効化** 列のチェックボックスを使用します。
- Microsoft Excel ブックでグリッドの内容を開くには、**Excel で開く** ボタンを使用します。 必要に応じてエンティティを変更してから、**公開** ボタンを使用して変更をアップロードします。

エクスポートが完了したら、次の作業を行います。

- **エクスポート** ページの **ダウンロード** ボタンを使用して、構成をダウンロードします。
- **データ管理** ワークスペースまたは **実行の概要** ページの **パッケージのダウンロード** ボタンを使用して、エクスポートされた構成設定とデータをダウンロードします。

## <a name="setup-considerations-for-some-entities-that-are-used-to-export-configurations"></a>コンフィギュレーションのエクスポートに使用される一部のエンティティの設定に関する考慮事項

現在、複数のエンティティは、ビルド構成を行う際に追加の手順が必要です。 コンフィギュレーションを構築する際は、これらの推奨事項に従ってください。

> [!IMPORTANT]
> このリストは、コピー構成機能が改善されるにつれて更新されます。

### <a name="using-special-purpose-entities"></a>専用のエンティティの使用

次のエンティティは、設定で使用されるときに特別な処理が必要です。

| 面 | エンティティ | アクション |
|------|--------|--------|
| システム設定 | グローバル アドレス帳 | エンティティは、会社の作成時に自動的に作成されるレコードをエクスポートしなくなりました。 インポートでは、プラットフォーム 9 リリース以降、これらのレコードも受け入れなくなりました。 |
| GL 共有 | 勘定構造の有効なグループ | この複合エンティティは、アクティブな勘定構造のみをエクスポートおよびインポートします。 他の勘定構造エンティティを使用している場合、有効な勘定構造のステータスは **ドラフト** に変更されるため、使用可能になる前に有効化する必要があります。 |
| | 詳細ルール構造の有効なグループ | この複合エンティティは、勘定構造アクティブ グループ エンティティと組み合わせて使用されます。 有効な詳細ルール構造のみをエクスポートおよびインポートします。 他の詳細なルール構造エンティティを使用している場合、詳細なルール構造のステータスは **ドラフト** に変更されるため、使用可能になる前に有効化する必要があります。 |
| | 財務分析コード値 | すべての分析コード値がエクスポートされるには、基準となるシステム定義のエンティティはプロジェクトまたは顧客のような値になります。 インポートする前に、システム定義の値を削除します。 システム定義の値をパッケージに残したままにする場合は、インポートしません。 ただし、システム定義の分析コードをバックアップするデータをインポートする際、それらが満たされます。 |
| ワークフロー | ワークフロー バージョン | ワークフロー内のユーザーが既にインポートされている場合を除き、パッケージ データのすべてのレコードの所有者を **管理者** に変更します。 |
| | ワークフロー式 | ワークフロー式には、Excel セルには長すぎるものがあります。 エクスポート形式として、Excel ではなく XML を使用します。 |
| 税申告 | 消費税パラメーター | 基準金額計算方法の既定値は、売上税パラメーターの **合計** です。 総勘定元帳パラメーター エンティティは、その値を設定しません。 ただし、一部の税コードが使用する基準金額 **ライン** は、検証に失敗します。 消費税パラメーターの事前設定エンティティという名前の新しいエンティティが作成されるため、基準金額の計算方法を最初にインポートできます。 税コードをインポートすることができます。 | 
| 売掛金 | 顧客 | 顧客エンティティは、OData シナリオに使用するように設計されています。 コンフィギュレーションでは、顧客の定義エンティティおよび顧客の詳細エンティティを使用します。 顧客定義エンティティを使用すると、顧客に関する基本的な情報をインポートできます。 この方法で、インポート処理で顧客がより早く情報を入手する必要があるエンティティを有効にします。 顧客詳細エンティティには、パラメーターと参照データが設定された後に追加できる顧客に関する追加情報が含まれます。 |
| 在庫管理 | 倉庫の場所 | いくつかの倉庫の場所には、場所のプロファイル ID が必要です。 場所プロファイル ID には、場所の形式が必要です。 現在、場所の形式情報は倉庫の場所の前に手動で入力する必要があります。 場所の形式と場所プロファイルのエンティティが、バージョン 7.2.3 で追加されました (2017 年 7 月のリリースの App Update 3)。 | 
| 製品情報管理 | 製品 | 製品とリリース済み製品エンティティは、構成に使用する必要があります。 OData シナリオでは、製品マスターおよびリリース済み製品マスター エンティティを使用する必要があります。 |
| | 製品ドキュメントの添付ファイル | 製品ドキュメントのリリース済製品のドキュメントの添付については、追加の手順がステージング環境で実行されるため、ステージングを決してスキップしないでください。 エクスポート ファイルには添付ファイルの入ったリソース フォルダが必要なため、エクスポートとインポート用にデータ パッケージを使用する必要があります。 エンティティは、画像、ドキュメント、メモ、およびリンクをサポートします。 エクスポートするとき、グローバル一意識別子 (GUID) のような名前を持つ画像ファイルが表示されます。 このファイルは、インポートを完了するために必要となる有効なデータ パッケージです。 |
| | 製品属性値 | 製品属性値は、ユーザーが **製品詳細** ページから **属性値** ページを開いたときにのみ割り当てられます。 現在、ゴールデン ビルドでこのステップが実行されていない限り、値をインポートすることはできません。 |
| 調達 | 仕入先カタログ | Supply Chain Management ブログで、[Dynamics AX の仕入先カタログ](https://blogs.msdn.microsoft.com/dynamicsaxscm/2016/05/25/vendor-catalogs-in-dynamics-ax/)の「仕入先のカタログをインポート」を参照してください。 |
| プロジェクト | 共有カテゴリ | 共有カテゴリ エンティティは、フィールド **CATEGORYID**、**CATEGORYNAME**、**EXPENSETYPE**、**USINEXPENSE**、**USINPRODUCTION**、**USEINPROJECT** を公開するようになりました。 **USEINEXPENSE** フィールドの値を **はい** に変更すると、**EXPENSETYPE** を **共有カテゴリ** ページの **経費タイプ** フィールドで使用できる有効な値のいずれかに設定する必要があります。 |

### <a name="remove-the-mapping-and-apply-filters-for-specific-entity-fields"></a>マッピングを削除して、特定のエンティティ フィールドにフィルターを適用

ゴールデン ビルドでは、顧客固有のフィールドを設定できません。 インポートが正しく動作するようにするためには、これらのフィールドのマッピングを解除する必要があります。 たとえば、作業者が多数のテーブルに格納されていても、ゴールデン ビルドで設定されていない可能性があります。 フィルターが、エンティティ内の一部のフィールドに必要な場合もあります。

次のエンティティは、マップされていないかフィルター処理されている必要があります。

| 面 | エンティティ | アクション |
|------|--------|--------|
| システム設定 | 作業単位 | 作業者がインポートされていない場合は、マネージャーの従業員番号のマップを解除します。 |
| | ユーザー情報 | **ID** が **管理者** と等しくないフィルターを適用します。氏名をマップ解除し、ユーザーと個人の関係エンティティを使用してシステム ユーザをディレクトリ ユーザーにマップします。 |
| 買掛金 | 仕入先 | 設定されていない場合、購買サイト (DefaultPurchaseSite) と倉庫 (DefaultProcurementWarehouseID) のマップを解除します。 仕入先の銀行口座 ID をマップ解除します。 仕入先の銀行口座エンティティをインポートすると、銀行口座へのリンクが設定されます。 |
| 売掛金 | 顧客の詳細 | 作業者がインポートされていない場合は、従業員の担当番号のマップを解除します。 作業者とその連絡先情報がインポートされていない場合は、コレクションの連絡担当者 (CollectionsContactPersonID) のマップを解除します。 既にインポートされている場合を除き、サイト (SiteID) と倉庫 (WarehouseID) のマップを解除します。 |
| 在庫管理 | 倉庫の現在の住所 | コマース情報がインポートされていない場合、店舗エリアのピッキングをマップ解除し、店舗エリアを入力します。 | 
| 製品情報管理 | 製品 | データ管理プロジェクトに輸送管理テンプレートを追加しない場合は、NMFCCode と STCCCode のマップを解除します。 |
| | リリースされた製品 | プロジェクト カテゴリ、製品の既定の色、既定の構成、製品の既定のサイズ、および製品の既定のスタイルのマップを解除します。 このエンティティは自己参照型であり、これらのフィールドを単一のパスでロードするようにはまだ更新されていません。 |
| | 期間テンプレート | 期間テンプレート エンティティは、共有エンティティです。 法人によってフィルタリングすることはできますが、期間テンプレート行のエンティティには **法人** フィールドはありません。 単一の法人をインポートするには、期間テンプレートをフィルター処理します。 ただし、現在、その法人に関連していない期間テンプレートの行を削除する必要があります。 |
| | 品目補充グループ | 期間テンプレート ID がすでに手動で追加されている場合を除き、そのマップを解除します。 |
| 調達 | 仕入先 | 設定されていない場合、購買サイト (DefaultPurchaseSite) と倉庫 (DefaultProcurementWarehouseID) のマップを解除します。 仕入先の銀行口座 ID をマップ解除します。 仕入先の銀行口座エンティティをインポートすると、銀行口座へのリンクが設定されます。 |
| 販売とマーケティング | 潜在顧客 | 作業者がインポートされていない場合は、LeadOpeningPersonnelNumber、LeadClosingPersonnelNumber、および LeadResponsiblePersonnelNumber のマップを解除します。 |
| | 販売タイプ ドキュメントのエントリ ポリシー | IsAtpGenrallyIncludingPlannedOrders のマップを解除します。 法人の作成時に、すべての計画プロセスを無効にするために、マスター プランの既定が「はい」に変更されました。 |
| プロジェクト管理 | プロジェクト | 作業者がインポートされていない場合は、WorkerArchitectPersonelNumber、WorkerRespFinancialPersonelNumber、WorkerResponsiblePersonnelNumber、および WorkerRespSalesPersonelNumber のマップを解除します。 |
| Retail | POS 視覚プロファイル | 現時点ではエンティティが存在しないため、パレットのマップを解除します。 POS ビジュアル プロファイル エンティティは、バージョン 7.2.3 の Retail テンプレート (2017 年 7 月リリースのアプリケーション更新プログラム 3) に追加されました。 |
| | 小売チャネル | この時点でエンティティが利用できないため、チャネル プロファイル名 (ChannelProfileName) とライブ データベース接続プロファイル名 (LiveDatabaseConnectionProfileName) のマップを解除します。 Retail チャネル エンティティは、バージョン 7.2.3 の Retail テンプレート (2017 年 7 月リリースのアプリケーション更新プログラム 3) に追加されました。 |

### <a name="golden-builds-that-have-multiple-legal-entities"></a>複数の法人を持つゴールデン ビルド

テンプレートを使用して、ゴールデン ビルド内の任意の会社のデータをエクスポートできます。 共有データと会社データの両方をエクスポートするときは、テンプレートはすべての法人の共有データを最初にエクスポートします。 次に、現在使用している法人のデータをエクスポートします。 共有エンティティを含まないプロジェクトを使用して、会社を切り替え、追加の法人のために会社データをエクスポートすることができます。

複数の法人組織を含むゴールデン ビルドからエクスポートする場合、それらの法人組織の中から 1 つのみのデータをインポートする場合は、法人組織フィールドにフィルターを適用すると、その法人から必要なデータのみがエクスポートされます。 このフィルターは、必要な法人を除くすべての法人のデータを削除する必要があります。 場合によっては、エクスポートされたデータをクリーンアップする追加の手順を完了する必要があります。

次の表に記載されている変更のほとんどが、**システム設定** および **総勘定元帳** の領域で発生します。 1 つの法人を使用するゴールド ビルドをエクスポートする場合は、これらのフィルターを必要ありません。

次のエンティティは、データをエクスポートするときにフィルター処理または特別な処理が必要です。

| 面 | エンティティ | アクション |
|------|--------|--------|
| システム設定 | 法人 | 会社にフィルターを適用します。 |
| | 番号順序コード | 番号順序コードは共有することも、法人に固有のものとすることもできます。 すべての番号シーケンスをインポートするには、特定の法人向けに保存されている番号シーケンスに法人を設定する必要があります。 共有番号シーケンスだけが必要な場合は、フィルターを適用し、法人固有の番号シーケンスを削除します。 特定の法人の番号列のみを必要とする場合は、Company にフィルターを適用します。<p>番号順序にはスコープも設定できます。 次の条件が満たされた場合に、番号順序を削除する必要があります。</p><ul><li>**SCOPETYPE** 値は **DataArea** であり、**SCOPEVALUE** 値は法人と等しくないか空白になります。</li><li>**SCOPETYPE** 値は **LegalEntity** であり、**SCOPEVALUE** 値は法人と等しくありません。</li><li>**SCOPETYPE** 値は **DataAreaFiscalCalendar** であり、**SCOPEVALUE** 値は法人と等しくありません。</li></ul> |
| | 番号順序の参照 | 番号順序の参照にはスコープも設定できます。 次の条件が満たされた場合に、番号シーケンスの参照を削除する必要があります。<ul><li>**SCOPETYPE** .値は **DataArea**、**DataAreaFiscalCalendar**、または **LegalEntity** と等しくなります。</li><li>**SCOPETYPE** 値はデータに含める法人と等しくないか、空白になります。</li></ul> |
| | 組織階層 | 法人フィルターはありません。 インポートしていない他の法人への参照を手動で削除します。 たとえば、集中支払を設定しても、1 つの法人のみを読み込んでいる場合、集中支払階層をインポートしないでください。 |
| グローバル アドレス帳 | 複数のエンティティ | グローバル アドレス帳には、すべての法人のデータが含まれています。 データをインポートする場合、使用しない法人エンティティのデータを削除しない限りすべての法人エンティティが作成されます。 他の法人が作成されないようにするには、そうした他の法人のすべてのレコードを削除します。 または、法人エンティティ データ エリアに (&lt;&gt; 空白) フィルターの適用をします。 他の法人で使用されるグローバル アドレス帳レコードを削除することも必要です。 |
| | 関係者の配送先 | インポートする法人以外の法人の住所レコードは、インポートする前に手動で削除する必要があります。 |
| | 関係者の連絡先 | インポートする法人以外の法人の連絡先レコードは、インポートする前に手動で削除する必要があります。 |
| | ワークフロー | DataAreaID にフィルターを適用します。 ワークフロー エンティティの多くは、法人のフィルター処理ができません。 したがって、望ましくない法人組織に関連するすべてのワークフロー エンティティのデータを削除しないと、インポート エラーが発生する可能性があります。 このシナリオのワークフローを手動で設定することをお勧めします。 |
| 一般会計 | Ledger | 会社にフィルターを適用します。 |
| | 元帳の会計暦年 | 元帳名にフィルターを適用します。 |
| | 元帳の会計カレンダー期間 | 元帳名にフィルターを適用します。 |
| | 主勘定法人の上書き | 会社にフィルターを適用します。 |
| | 財務分析コード値法人 | 法人にフィルターを適用します。 |
| | 財務分析コード値 | 法人にフィルターを適用します。 ただし、システム定義の分析コード値をフィルター処理することはできません。 そのため、それらを削除する必要があります。 これらのシステム定義の値は、システム定義の分析コードを戻すテーブルのデータをインポートするときにリストアされます。 |
| | 仕訳帳名 | 伝票シリーズの会社 ID にフィルターを適用します。 |
| | 元帳配賦基準の入力元 | 法人にフィルターを適用します。 |
| | 元帳配賦ルールの出力先 | 会社にフィルターを適用します。 |
| 売掛金 | 顧客損金処理理由コード | 会社にフィルターを適用します。 |
| 予算 | 予算管理コンフィギュレーション | 法人にフィルターを適用します。 |
| | 予算管理コンフィギュレーションの有効化 | 法人にフィルターを適用します。 |
| | 予算管理サイクル モデル | 法人にフィルターを適用します。 |
| | 予算管理分析コード属性 | 法人にフィルターを適用します。 |
| | 予算管理のドキュメントと仕訳帳 | 法人にフィルターを適用します。 |
| | 予算管理グループ | 法人にフィルターを適用します。 |
| | 予算管理グループの基準 | 法人にフィルターを適用します。 |
| | 予算管理メッセージ レベル | 法人にフィルターを適用します。 |
| | 予算超過の許可の予算管理 | 法人にフィルターを適用します。 |
| | 予算管理ルール | 法人にフィルターを適用します。 |
| | 予算管理ルールの基準 | 法人にフィルターを適用します。 |
| | 予算原価要素 | 原価要素データ領域 ID にフィルターを適用します。 |
| | 予算分析コード | 法人にフィルターを適用します。 |
| | 予算計画の配賦スケジュール | 元帳にフィルターを適用します。 |
| | 予算計画プロセス | 元帳にフィルターを適用します。 |
| | 予算計画ステージ ルール | 予算計画プロセスにフィルターを適用する場合は、ステージのルールをインポートするときにエラーが発生する場合があります。 エンティティには現在フィルター処理できる元帳名が含まれていないため、すべての会社が含まれます。 |
| | 予算計画優先順位の制約 | 予算計画ステージ ルール エンティティについて記載されている同じ問題が生じます。 |
| | 予算計画プロセス管理 | 予算計画ステージ ルール エンティティについて記載されている同じ問題が生じます。 |
| | 予算振替ルール | 法人にフィルターを適用します。 |
| 在庫管理 | 倉庫の現在の住所 | 会社にフィルターを適用します。 |
| | サイトの現在の住所 | 会社にフィルターを適用します。 |
| | 追跡番号グループ | エンティティは、法人によって番号順序スコープ データ領域を自動的にフィルター処理します。 したがって、フィルターは必要ありません。 ただし、法人を変更する必要がある場合、法人はテーブルに格納されます。 |
| Retail | POS レジスター | 法人にフィルターを適用します。 このエンティティは、Retail テンプレート バージョン 7.2.3 (2017 年 7 月リリースのアプリ更新プログラム 3) に追加されました。 | 
| | 小売店舗アドレス帳 | このエンティティには法人フィルターが存在しないため、エクスポートにはすべての法人のレコードが含まれます。 このエンティティは、バージョン 7.2.3 の Retail テンプレート (2017 年 7 月リリースのアプリケーション更新プログラム 3) に追加されました。 |
| | 小売ロケーター グループのメンバー | このエンティティには法人フィルターが存在しないため、エクスポートにはすべての法人のレコードが含まれます。 このエンティティは、バージョン 7.2.3 の Retail テンプレート (2017 年 7 月リリースのアプリケーション更新プログラム 3) に追加されました。 |
| | 小売ロケーター グループの所有者 | このエンティティには法人フィルターが存在しないため、エクスポートにはすべての法人のレコードが含まれます。 このエンティティは、バージョン 7.2.3 の Retail テンプレート (2017 年 7 月リリースのアプリケーション更新プログラム 3) に追加されました。 |
| | 小売り用デバイス | このエンティティには法人フィルターが存在しないため、エクスポートにはすべての法人のレコードが含まれます。 このエンティティは、バージョン 7.2.3 の Retail テンプレート (2017 年 7 月リリースのアプリケーション更新プログラム 3) に追加されました。 |

### <a name="changing-the-legal-entity-value-before-import"></a>インポート前に法人の値を変更する

法人 ID を別の値に変更する場合は、以前記載したフィールドに似ているすべてのフィールドの値を、新しい法人組織の値に変更する必要があります。 たとえば、法人に対して、会社をエクスポートされた値からエクスポート済ファイルの新しい値に変更します。

法人 ID は多くの場所に格納されます。 したがって、この変更を行うことは難しく、試してみるとエラーが発生する可能性があります。

> [!NOTE]
> 法人にコピーするデータ プロジェクトを設定すると、ソース法人の法人フィルターが、法人フィールドであると決定されているエンティティ フィールドに自動的に追加されます。

### <a name="selecting-a-single-legal-entity-for-export"></a>エクスポートする 1 つの法人を選択

単一の法人をエクスポートするには、法人エンティティ データ プロジェクトにコピーを作成し、元の法人としてコピーする法人を指定することができます。 エンティティを追加するとき、またはテンプレートを読み込むとき、そのプロジェクト タイプによって法人フィルターを自動的に追加されます。 パッケージをダウンロード、または **テンプレート** ページ上でそれからテンプレートを作成することができます。 パッケージまたはテンプレートは、エクスポート プロジェクトに追加して、法人をエクスポートするために使用できます。

## <a name="import-a-configuration"></a>コンフィギュレーションのインポート

**データ管理** ワークスペースは、コンフィギュレーション データ プロジェクトをインポートするためのハブともなります。 エクスポートした既存のデータ プロジェクトから、構成プロジェクトをビルドすることができます。 また、インポートのために正しく書式設定されているデータを含む個々のファイルからコンフィギュレーション プロジェクトを構築することもできます。

構成をインポートするには、次の手順を実行します。

1. **データ管理** ワークスペースを開きます。 標準のビューを使用している場合は、**強化されたビュー** を選択します。
2. **インポート** タイルを選択します。
3. **新規** を選択してコンフィギュレーション データ プロジェクトを作成し、コンフィギュレーションの ID と名前を入力します。
4. データ プロジェクトの操作タイプを **インポート** に設定し、プロジェクト カテゴリを **コンフィギュレーション** に設定します。
5. コピーする情報を表すエンティティを追加します。 次のいくつかのメソッドを使用してエンティティを追加することができます。

    - **1 つのエンティティを追加** - ルックアップに表示されるまで、エンティティの名前の最初の部分を入力します。
    - **複数のエンティティを追加** - エンティティ名の一部を入力、モジュールのルックアップを使用、タグの名前の一部を入力、またはエンティティ カテゴリのルックアップを使用して、エンティティの一覧を表示します。 Tab キーを押してフォーカスを **参照** フィールドの外に移動し、フィルターをアクティブにします。 グリッドで、追加するエンティティを選択します。
    - **ファイルを追加** - エンティティ名に一致する名前とデータ ソースにあるファイル名拡張子と一致するファイル名拡張子を含むファイルを参照し、ソース データ形式が自動的に設定されます。 既定のファイル名拡張子を設定していない場合は、ファイルを選択する前に、ソース データの形式を選択する必要があります。
    - **テンプレートを追加する** - インスタンスでロードされたテンプレートの一覧から選択します。

    パッケージをロードするとき、**インポート** ページはまずパッケージからエンティティの一覧を表示します。 進行状況インジケーターは、パッケージのどれくらいが読み込まれたかを表示します。 エンティティのリストが読み込まれた後、**インポート** ページがパッケージ内のデータ読み込みを開始します。 このプロセスには少し時間がかかる場合があります。

6. **エンティティの削除** を選択し、必要に応じて選択したエンティティを削除します。
7. コンフィギュレーションが完了した後は、**インポート** を選択しインポートを開始します。 表示される **実行の詳細** ページで結果を監視することができます。

コンフィギュレーションをインポートする前に、インポート プロセスの管理に役立ついくつかの追加機能を使用できます。

- 一覧を整理するには、**並べ替え** ボタンを使用して、単位、レベル、またはシーケンスでエンティティの順序を変更します。
- いずれかのエンティティの実行順序を変更するには、ユニット、レベル、またはシーケンスを手動で編集します。 または、**再シーケンス** ボタンを使用して選択したすべてのエンティティを更新できます。
- エンティティ マッピングを変更する必要がある場合、**マップの表示** ボタンを使用します。
- データ プロジェクトをエクスポートするときにエンティティが一時的に使用されないようにするには、**無効化** 列のチェックボックスを使用します。

## <a name="copy-into-a-legal-entity"></a>法人へのコピー

**データ管理** ワークスペースは、法人間でコンフィギュレーション情報をコピーためのハブともなります。 このプロセスは、1 ステップで発生するエクスポートおよびインポートと共通点があります。 インポートと同様に、ソース法人に存在する情報が相手方法人に存在しない場合、プロセスのコピーが追加されます。 情報が既に相手方の法人に存在する場合、コピー処理により更新されます。

同じインスタンス内である法人から別の法人に構成をコピーするには、次の手順を実行します。

1. **データ管理** ワークスペースを開きます。 標準のビューを使用している場合は、**強化されたビュー** を選択します。
2. **法人にコピー** タイルを選択します。
3. **新規** を選択してコンフィギュレーション データ プロジェクトを作成し、コンフィギュレーションの ID と名前を入力します。
4. データ プロジェクトの操作タイプを **法人にコピー** に設定し、プロジェクト カテゴリを **コンフィギュレーション** に設定します。
5. コピーするデータのソースとする必要がある法人を選択します。 既定では、現在使用している法人が選択されています。
6. **法人** クイック タブで、宛先として既存の法人を選択することも、新しい法人を作成することもできます。

    - **選択** – リストの中から 1 つ以上の法人を選択し、**選択対象の追加** を選択します。 法人は宛先の法人のリストに追加されます。
    - **作成** - 法人 ID、法人の名前、および法人が属する地域を入力します。 **法人を作成する** を選択します。 法人が作成され、宛先の法人のリストに追加されます。

    > [!NOTE]
    > 宛先の法人を作成する機能は、Finance and Operations 7.2.3 で利用可能です。

7. 出力先の法人を追加した後、番号の順序をコピーする場合 **はい** を選択します。 番号順序コードと番号順序参照をコピーするために必要なエンティティがプロジェクトに追加されます。 これらのエンティティの実行単位、レベル、および順序番号は、既定のシステム テンプレートと共有テンプレートの数値に設定されます。 既定のテンプレートを使用していない場合は、エンティティ順序を調整しリストの最初にくるようにします。
8. 番号順序に対して **はい** を選択した場合は、これらの番号シーケンスを最小値にリセットするかどうかを指定するには、**はい** または **いいえ** を選択します。
9. コピーする情報を表すエンティティを追加します。 次のいくつかのメソッドを使用してエンティティを追加することができます。

    - **1 つのエンティティを追加** - ルックアップに表示されるまで、エンティティの名前の最初の部分を入力します。
    - **複数のエンティティを追加** - エンティティ名の一部を入力、モジュールのルックアップを使用、タグの名前の一部を入力、またはエンティティ カテゴリのルックアップを使用して、エンティティの一覧を表示します。 Tab キーを押してフォーカスを **参照** フィールドの外に移動し、フィルターをアクティブにします。 グリッドで、追加するエンティティを選択します。
    - **ファイルを追加** - エンティティ名に一致する名前とデータ ソースにあるファイル名拡張子と一致するファイル名拡張子を含むファイルを参照します。
    - **テンプレートを追加する** - インスタンスでロードされたテンプレートの一覧から選択します。

    正しい順序が保たれるように、既定のテンプレートを使用することをお勧めします。 次に、コピーするデータと一致するエンティティを追加して削除します。 コピーしないエンティティを削除することができます。

    > [!NOTE]
    > - エンティティに法人を表すフィールドがある場合、ソースの法人のデータのみが含まれように、フィルターにはそのエンティティが適用されます。 そのフィールドの値は、宛先の法人組織に変更されます。
    > - 法人にコピーする場合、ドキュメント、トランザクション、および複合エンティティは使用できません。

10. **エンティティの削除** を選択し、必要に応じて選択したエンティティを削除します。
11. コンフィギュレーションが完了した後は、**法人へのコピー** を選択しインポートを開始します。 コピー プロセスは、ソースの法人から送信先の法人組織にデータをエクスポートします。 各相手方の法人には、独自のインポート データ プロジェクトがあります。 表示される **実行の要約** ページで結果を監視することができます。 法人プロジェクトへのコピーに関連付けられているすべてのインポート プロジェクトはページの左側の一覧に表示されます。

インポート プロジェクトの場合と同様に、発生したエラーは **実行の要約** ページ上に表示されます。 ステージング テーブルでエラーを編集して、各データ プロジェクトのために値を再送信することができます。

### <a name="special-considerations-when-you-copy-into-a-legal-entity"></a>法人にコピーする際の特別な注意事項

法人にコピーするときは、ファイルをインポートするときに発生する同じ検証を使用する必要があります。 障害の原因となる依存関係を識別できるように、テスト環境でのコピーをテストすることが重要です。 依存情報は、コピーするエンティティの一覧に含まれていない場合は、エンティティでは、法人にコピーするときにエラーが表示されます。 たとえば、顧客が既定のサイトまたは倉庫を持っている場合、これらのアプローチのいずれかを使用する必要があります。

- コピーの一部として、サイトおよび倉庫をインポートします。
- 法人をコピーする前に、サイトおよび倉庫を手動で読み込みます。
- 情報をコピーする前に、サイトと倉庫のフィールドをマップ解除します。

1 つの領域から別の領域へコピーする場合、インポート エラーが発生する可能性もあります。 たとえば、米国地域の法人に 1099 フィールドがあります。 ただし、ドイツ地域で法人にそれらの値をインポートしようとする場合、インポートのエラーが表示されます。 ロードしたテンプレートには、地域において間違ったエンティティがある場合は、間違ったエンティティが読み込まれていることを示すエラー メッセージが表示されます。 ただし、テンプレートの残りは、引き続きロードされます。 送付先地域に適した情報のみをコピーする必要があります。

次のエンティティは、法人へのコピーに使用される場合、特別な取り扱いが必要です。

| 面 | エンティティ | アクション |
|------|--------|--------|
| システム設定 | 番号順序 | パラメーター フォームで仕入先および顧客に番号シーケンスを使用し、顧客および仕入先をコピーする場合は、番号シーケンスで「数字の小さいユーザーに変更を許可する」設定が「はい」になっていることを確認する必要があります。 「いいえ」設定の場合、インポートで仕入先および顧客番号が拒否されます。それらの番号が、次の使用可能な番号順序よりも低い番号を使用する前に作成されるためです。 最小の機能にリセットする機能を使用する場合は、仕入先番号と顧客番号が次に使用可能な番号の順序よりも高いため、「ユーザーをより高い番号に変更することを許可する」を変更する必要があります。 |
| システム設定 | ワークフロー | ワークフローはコピーする前に追加の変更が必要です。 ワークフローのコピーは現時点ではサポートされていません。 |
| 買掛金 | 仕入先 | 仕入先には、他のエンティティからの値に依存する多くの設定があります。 たとえば、スリーウェイ マッチングを要求するようマッチングの設定を更新しても、ツーウェイ マッチングに設定した仕入先がある場合、仕入先は検証に失敗します。 新しい仕入先に対して自動の優先順位を使用する場合は、法人にコピーを実行する前に、仕入先勘定のマップを解除する必要があります。 さらに、自動で順序付けられた仕入先に請求先/元 ID がある場合は、その仕入先勘定は変換されず、失敗する可能性があります。 転記勘定の仕入先および製品ごとの承認済仕入先リストなどの他の領域で類似の問題を確認する場合があります。 |
| 売掛金 | 顧客 | 顧客には、他のエンティティからの値に依存する多くの設定があります。 たとえば、顧客用の既定の倉庫とサイトがある場合、サイトおよび倉庫を最初に追加する必要があり、または顧客は検証に失敗します。 新しい会社で連絡先が利用できない場合は、コレクションの連絡先も利用できません。 新しい顧客に対して自動の優先順位を使用する場合は、法人にコピーを実行する前に、顧客勘定のマップを解除する必要があります。 さらに、自動で順序付けられた顧客に請求先/元 ID がある場合は、その請求先/元 ID は変換されず、失敗する可能性があります。 転記勘定の顧客などの他の領域で類似の問題を確認する場合があります。|
| 予算 | 予算原価要素| 予算額の要素をインポートする際、年間金額を使用しているときに、[利益基準] タブに予算原価要素があると問題が発生します。この問題は、今後のリリースで対処される予定です。|
| 固定資産 | 固定資産減価償却プロファイル手動スケジュール| 固定資産減価償却プロファイルを最初に処理する必要があります。 固定資産の減価償却プロファイルのデータ プロジェクトの順序を15 (10ではなく) に変更します。 月 1 回のアプリケーション リリース 4 の既定のテンプレートをこの値に更新します。|
| 一般会計 | 会社間会計 | 法人へのコピー機能は、現時点では会社間会計をサポートしていません。 この問題は、今後のリリースで対処される予定です。|
| 一般会計 | 仕訳帳名| ソース法人の仕訳帳名のみ相手方の会社にコピーされます。 仕訳帳名フォームのルックアップを選択した場合は、その法人に対して利用可能な番号シーケンスのみが表示されます。 ただし、手動でそのリストにない番号順序を入力するよう選択する場合、それはコピー処理には含まれません。|
| 一般会計 | 元帳配賦ルールの出力先| バージョン 7.3 以前ののバージョンを実行し、会社間の配賦ルールがある場合は、ソースの法人とは一致しない法人の相手方のルールは表示されません。 法人へのコピー機能は、送信先がソースと等しい場合にのみ送信先レコードをコピーします。 この問題はバージョン 7.3 で解決されました。|
| 一般会計 | 元帳の会計カレンダー年/期間| このプロセスは、現在は、ソースの法人だけではなく、すべての法人をエクスポートします。 コピー処理は正しく動作します。 この問題はバージョン 7.3 で解決されました。|
| 一般会計 | 元帳パラメーター | 連続する番号順序を確認しますが、仕訳帳名で使用されている番号順序があり、それが継続的ではない場合、インポートが失敗します。 元帳パラメーターの設定を一時的にオフにする必要があります。 さらに、元帳のパラメーターを最初に処理する必要があります。 元帳パラメーターのデータ プロジェクトの順序を 15 (40 ではなく) に変更します。 月 1 回のアプリケーション リリース 3 の既定のテンプレートをこの値に更新します。 |
| 在庫管理 | 在庫分析コード パラメーター | インポート時にエラーが表示されるが、正しい数のパラメーターがインポートされるという問題があります。 この問題は、今後のリリースで対処される予定です。|
| 在庫管理 | 倉庫の場所 | いくつかの倉庫の場所には、場所のプロファイル ID が必要です。 場所プロファイル ID には、場所の形式が必要です。 現在、場所の形式情報は倉庫の場所の前に手動で入力する必要があります。 場所の形式と場所プロファイルのエンティティが、バージョン 7.2.3 で追加されました (2017 年 7 月のリリースの App Update 3)。 |
| マスター プラン | 会社間マスター プランのアソシエーション | 法人へのコピー機能は、現時点では会社間マスター プランのアソシエーションをサポートしていません。 この問題は、今後のリリースで対処される予定です。|
| Retail | POS レジスター | このエンティティはグローバルであり、別の法人にコピーすることはできません。|
| Retail | 小売チャネル | このエンティティはグローバルであり、別の法人にコピーすることはできません。|
| Retail | 小売店舗アドレス帳 | このエンティティは、Retail チャネルに依存するため、使用できません。|
| 販売とマーケティング | 会社間取引相手 | 法人へのコピー機能は、現時点では会社間取引相手をサポートしていません。 この問題は、今後のリリースで対処される予定です。|

### <a name="rules"></a>ルール

法人へのコピー機能では、ステージング テーブルに追加される前にデータの変更を許可するルールがサポートされています。 たとえば、対象法人を宛先法人に変更するルールを使用し、番号順序を変更します。 ルールを拡張することができます。

ルールの拡張機能には、次の 3 つの変更が必要です。

1. 拡張可能 **DMFRulesType** の列挙 (列挙) へルールの名前を追加します。
2. 各プロジェクト定義グループに対して、作成したばかりの列挙 (たとえば、**DMFRulesType::NewRule**) を DMFRules テーブルに挿入します。 ソースの法人、ルールの種類、および定義グループの名前を使用します。 ルールにさまざまなオプションなど、さらにデータを格納することが必要な場合は、独自のテーブルを作成し、DMFRules テーブルを拡張できます。
3. ルールが動作するデータを処理する、独自のクラスを作成します。 DMFRules フレームワークでルールをインスタンス化するには、**\[DMFRulesBaseFactoryAttribute(DMFRulesType::NewRule)\]** 属性でクラスを修飾する必要があります。

クラスは、**DMFRulesBase** クラスも拡張する必要があります。 この拡張は、**DMFRulesBase.runRule(Common\_staging)** メソッドの実装が必要になります。 \_staging レコードは、ルールが適用されるステージング レコードのバッファーになります。

## <a name="additional-information-about-entities"></a>エンティティに関する追加情報

### <a name="obsolete-entities"></a>古いエンティティ

アプリケーションが更新されると、エンティティの機能を更新する必要があります。 さまざまな名前を持つ新しいエンティティが作成される場合があります。 この場合、元のエンティティは古いものとしてマークされます。 新しいデータ プロジェクトまたはテンプレートに古い形式のエンティティを追加することがなくなりました。

廃止されたエンティティを含むデータ パッケージを読み込むと、廃止されたエンティティの存在に関する警告が表示されます。 ただし、データをインポートすることができます。 古いエンティティは、**古い形式** 列を選択して **はい** をフィルタリングすることにより見つけることができます。

### <a name="self-referencing-entities"></a>自己参照エンティティ

一部のエンティティは、自身を参照するテーブルを表します。 たとえば、現金割引を作成するときに、階層化された割引計算を作成する、関連付けられた現金割引を参照できます。 データをインポートするには、**次の現金割引** フィールドで参照される現金割引がその現金割引を使用する現金割引の前にインポートされるようにデータを順序付けする必要があります。

新しい **DMFImportExportSequencer** クラスによって自己参照エンティティのデータが配列され、データを 1 つのパスに読み込むことが可能になります。 現金割引エンティティ (CashDiscountEntity) では、エンティティを更新するために必要なコードを表示できます。

クラスはいくつかの自己参照エンティティに追加されています。 必要に応じてさらに多くのエンティティに追加されます。 自己参照エンティティの他の例を次に示します。

- 顧客
- 顧客の定義
- 顧客の詳細
- 税コード
- 予算管理グループ
- プロジェクト
- 製品カテゴリ
- 倉庫
- 予算計画ワークフロー ステージ
- 販売単位

### <a name="adding-entities-in-the-appropriate-countryregion-context"></a>適切な国/地域のコンテキストでのエンティティの追加

エンティティを追加するとき、マッピングが、現在アクティブな会社の国または地域のコンテキストで作成されます。 マッピングで問題がある場合は、**マップの表示** 列に赤い *X* が表示されます。 赤色の *X* を選択し、必要に応じてマッピングを修復します。

> [!NOTE]
> 既定では、DAT 会社は国/地域のコンテキストを持っていません。 トランザクション コードおよび 1099 フィールドに使用されるエンティティなどの一部のエンティティは、国/地域コンテキストが必要なため、DAT 会社のデータ プロジェクトに追加された場合は正しくマッピングされません。


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]