---
title: Azure Data Lake の変更データ
description: このトピックでは、Data Lake 内の変更データに関する情報を提供し、それを使用して何ができるかを説明します。
author: MilindaV2
ms.date: 06/10/2021
ms.topic: article
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.region: Global
ms.author: milindav
ms.search.validFrom: 2021-06-10
ms.openlocfilehash: a45234ba97b9bf59e71a933fcf16198b2257ccb8
ms.sourcegitcommit: 7b319d32cb4285bb7cea43280c3e2f5c0b4e8d57
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/18/2021
ms.locfileid: "6274282"
---
# <a name="change-data-in-azure-data-lake"></a><span data-ttu-id="a9372-103">Azure Data Lake の変更データ</span><span class="sxs-lookup"><span data-stu-id="a9372-103">Change data in Azure Data Lake</span></span>

[!include [banner](../includes/banner.md)]

> [!NOTE]
> <span data-ttu-id="a9372-104">**Data Lake へのエクスポート** 機能は、米国、カナダ、英国、ヨーロッパ、南アジア、東アジア、オーストラリア、および日本の地域でパブリック プレビューで表示されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-104">The **Export to Data Lake** feature is in public preview in the United States, Canada, United Kingdom, Europe, South East Asia, East Asia, Australia, and Japan regions.</span></span> <span data-ttu-id="a9372-105">Finance and Operations 環境がそれらの地域にある場合は、Microsoft Dynamics Lifecycle Services (LCS) を使用して、環境でこの機能を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="a9372-105">If your Finance and Operations environment is in any of those regions, you can enable this feature in your environment by using Microsoft Dynamics Lifecycle Services (LCS).</span></span> <span data-ttu-id="a9372-106">この機能を使用するには、[Azure Data Lake へのエクスポートを構成](configure-export-data-lake.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a9372-106">Before you can use this feature, see [Configure export to Azure Data Lake](configure-export-data-lake.md).</span></span>

<span data-ttu-id="a9372-107">Data Lake のデータ変更により、Finance and Operationsアプリのデータ変更に反応するほぼリアルタイムのデータ パイプラインを構築できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-107">Change data in a data lake lets you build near-real-time data pipelines that react to data changes in Finance and Operations apps.</span></span> <span data-ttu-id="a9372-108">Data Lake の **変更フィード** フォルダには、Finance and Operations アプリケーションでデータを変更するごとに格納されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-108">The **Change feed** folder in the data lake contains every data change in Finance and Operations apps.</span></span> <span data-ttu-id="a9372-109">このフォルダは、**Data Lake へのエクスポート** 機能で作成されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-109">This folder is automatically created by the **Export to Data Lake** feature.</span></span>

## <a name="why-do-you-need-change-data-in-a-data-lake"></a><span data-ttu-id="a9372-110">Data Lake のデータを変更する必要があるのはなぜですか?</span><span class="sxs-lookup"><span data-stu-id="a9372-110">Why do you need change data in a data lake?</span></span>

<span data-ttu-id="a9372-111">Data Lake のデータは、レポートの目的でよく使用されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-111">Data in a data lake is often used for reporting purposes.</span></span> <span data-ttu-id="a9372-112">Data Lake のテーブル データを使用してレポートを作成できますが、データの追加コピーを作成してレポートを改善することもできます。</span><span class="sxs-lookup"><span data-stu-id="a9372-112">Although you can use the table data in the data lake to create reports, you can also create additional copies of the data to improve your reporting.</span></span> <span data-ttu-id="a9372-113">たとえば、パワーユーザーを有効にするように設計されたデータ マートがあるとします。</span><span class="sxs-lookup"><span data-stu-id="a9372-113">For example, you might have a data mart that is designed to enable your power users.</span></span> <span data-ttu-id="a9372-114">このデータ マートでは、簡略化された、多くの場合集約されたファクト テーブルと分析コード テーブルを使用している可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-114">In this data mart, you might have simplified, often aggregated, fact tables and dimension tables.</span></span>

<span data-ttu-id="a9372-115">Data Lake のテーブル データが更新される場合は、対応するファクト テーブルおよび分析コード テーブルを更新した Data Lake に保持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-115">As table data in the data lake is updated, you must keep the corresponding fact tables and dimension tables in the data lake updated.</span></span> <span data-ttu-id="a9372-116">それ以外の場合、レポートには最新のデータが反映されません。</span><span class="sxs-lookup"><span data-stu-id="a9372-116">Otherwise, your reports won't reflect the latest data.</span></span>

<span data-ttu-id="a9372-117">ファクト テーブルと分析コード テーブルを更新する最も簡単な方法は、テーブルを使用して完全なコピーを定期的に作成することです。</span><span class="sxs-lookup"><span data-stu-id="a9372-117">The easiest way to update fact tables and dimension tables is to periodically create a full copy by using tables.</span></span> <span data-ttu-id="a9372-118">ただし、この方法は非効率的です。</span><span class="sxs-lookup"><span data-stu-id="a9372-118">However, this approach can be inefficient.</span></span> <span data-ttu-id="a9372-119">テーブルが大きい場合 (たとえば、数千万や数千万の行がある場合) は、完全なコピーを作成してファクト テーブルを更新するプロセスには数時間かかり、大量の計算リソースが消費される場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-119">If your tables are large (for example, if they have tens of millions or hundreds of millions of rows), the process of updating a fact table by making a full copy might take hours and consume lots of compute resources.</span></span> <span data-ttu-id="a9372-120">したがって、ユーザーが時間内にレポートを作成していない場合があります (つまり、レポートの最新データを表示するために数時間待たなければならない場合があります)。</span><span class="sxs-lookup"><span data-stu-id="a9372-120">Therefore, your users might not have the reports in time (that is, they might have to wait hours to see the latest data in reports).</span></span> <span data-ttu-id="a9372-121">さらに、データが再処理されるたびに計算リソースが消費されるため、消費したサービスからより大きな請求書を受け取る場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-121">Additionally, because compute resources are consumed every time that data is reprocessed, you might receive a larger bill from the services that you've consumed.</span></span>

<span data-ttu-id="a9372-122">ファクト テーブルと分析コード テーブルの差分更新は、両方の問題 (時間の消費と計算リソースの消費) に対する答えを提供します。</span><span class="sxs-lookup"><span data-stu-id="a9372-122">Incremental update of your fact tables and dimension tables provides the answer to both problems (time consumption and compute resource consumption).</span></span> <span data-ttu-id="a9372-123">差分更新では、変更されたレコードのみをソース テーブルから選択し、対応するファクト テーブルおよび分析コード テーブルで更新します。</span><span class="sxs-lookup"><span data-stu-id="a9372-123">In an incremental update, you select only the changed records from source tables, and update them in corresponding fact tables and dimension tables.</span></span>

<span data-ttu-id="a9372-124">差分更新は、Azure Data Factory などの多くのデータ変換ツール の標準機能です。</span><span class="sxs-lookup"><span data-stu-id="a9372-124">Incremental update is a standard capability in most data transformation tools, such as Azure Data Factory.</span></span> <span data-ttu-id="a9372-125">ただし、差分更新機能を使用するには、ソース テーブルで変更されたレコードを識別する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-125">However, for the incremental update feature to work, you must identify the records that changed in source tables.</span></span>

<span data-ttu-id="a9372-126">**変更フィード** フォルダーには、Data Lake内のテーブル データ変更の履歴が表示されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-126">The **Change feed** folder provides a history of table data changes in the data lake.</span></span> <span data-ttu-id="a9372-127">この履歴は、差分更新を使用するデータ パイプラインに使用できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-127">This history can be used for data pipelines that use incremental update.</span></span>

## <a name="the-change-feed-folder"></a><span data-ttu-id="a9372-128">変更フィード フォルダー</span><span class="sxs-lookup"><span data-stu-id="a9372-128">The Change feed folder</span></span>

<span data-ttu-id="a9372-129">変更フィード機能は、変更データ キャプチャ (CDC) という名前の SQL Server 機能に依存します。</span><span class="sxs-lookup"><span data-stu-id="a9372-129">The Change feed feature relies on a SQL Server feature that is named Change Data Capture (CDC).</span></span> <span data-ttu-id="a9372-130">CDC は、Finance and Operations アプリケーションの背後にあるデータ ストアである SQL Server データベースの変更データをキャプチャするネイティブな方法です。</span><span class="sxs-lookup"><span data-stu-id="a9372-130">CDC is the native approach to capturing change data in a SQL Server database, which is the data store behind Finance and Operations apps.</span></span> <span data-ttu-id="a9372-131">変更フィード機能を使用すると、Data Lake の CDC 変更ログにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="a9372-131">The Change feed feature lets you access the CDC change log in your data lake.</span></span>

<span data-ttu-id="a9372-132">次の図は、Finance and Operations アプリケーションでの変更フィードの機能を示しています。</span><span class="sxs-lookup"><span data-stu-id="a9372-132">The following illustration shows how change feeds work in Finance and Operations apps.</span></span>

![Finance and Operations アプリケーションでの変更フィードがどのように機能するか](media/Change-feed-overview-picture.png)

1. <span data-ttu-id="a9372-134">Finance and Operations アプリケーションでデータが変更されるたびに、基になるデータベース (AXDB) が更新されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-134">Whenever a data change occurs in Finance and Operations apps, the underlying database (AXDB) is updated.</span></span> <span data-ttu-id="a9372-135">CDC 機能は、更新がデータベースに反映されることを保証します。</span><span class="sxs-lookup"><span data-stu-id="a9372-135">The CDC feature ensures that the update is reflected in the database.</span></span> <span data-ttu-id="a9372-136">CDC は、論理シーケンス番号 (**LSN** 値)、日付/タイム スタンプ (**日時変更** 値)、および変更されたデータを識別する **ペイロード変更** 値とともに、ログ (変更ログ) に変更をキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="a9372-136">CDC captures the changes in a log (the change log), together with a logical sequence number (**LSN** value), a date/time stamp (**Change Date-Time** value), and a **Change Payload** value that identifies the data that changed.</span></span>
2. <span data-ttu-id="a9372-137">**Data Lake へのエクスポート** マイクロサービスはデータベース内の変更をキャプチャし、変更ログを顧客の Data Lake に書き込みます。</span><span class="sxs-lookup"><span data-stu-id="a9372-137">**Export to Data Lake** microservices capture the changes in the database and write the change log to the customer's data lake.</span></span> <span data-ttu-id="a9372-138">Data Lake 内の変更フィード フォルダーには、フォルダーに編成された変更ログが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a9372-138">Change feed folders in the data lake contain the change log, which is organized into folders.</span></span>
3. <span data-ttu-id="a9372-139">さらに、**テーブル** フォルダー、変更された各行にはいくつかの新しいフィールドも含まれます。</span><span class="sxs-lookup"><span data-stu-id="a9372-139">In addition, in the **Tables** folder, each row that changed also contains several new fields.</span></span> <span data-ttu-id="a9372-140">各行には、対応する変更レコードの **LSN** 値と **日時変更** 値が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a9372-140">Each row contains the **LSN** value of the corresponding change record and the **Change Date-Time** value.</span></span> <span data-ttu-id="a9372-141">テーブル フォルダーの **LSN** フィールドと **日時変更** フィールドを使用して、行が変更されたかどうかを識別できますが、最新の変更のみが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a9372-141">Although you can use the **LSN** and **Change Date-Time** fields in the table folders to identify whether a row changed, they contain only the latest change.</span></span> <span data-ttu-id="a9372-142">同じ行が複数回変更された場合は、最新の変更だけが **テーブル** フォルダーに表示されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-142">If the same row changed multiple times, only the latest change is shown in the **Tables** folder.</span></span>

<span data-ttu-id="a9372-143">Data Lake 内の特定の変更フィード フォルダーと、対応するテーブル フォルダー内の変更されたフィールドは一貫しています。</span><span class="sxs-lookup"><span data-stu-id="a9372-143">A given change feed folder in the data lake and the changed fields in the corresponding table folders are consistent.</span></span> <span data-ttu-id="a9372-144">したがって、単一のマイクロサービスが、変更フィード フォルダーと Data Lake 内の対応するテーブルの両方を同時に更新します。</span><span class="sxs-lookup"><span data-stu-id="a9372-144">Therefore, a single microservice updates both the change feed folder and the corresponding table in the data lake at the same time.</span></span>

## <a name="exploring-the-change-feed-folder-in-your-data-lake"></a><span data-ttu-id="a9372-145">Data Lake 内の変更フィード フォルダを検索</span><span class="sxs-lookup"><span data-stu-id="a9372-145">Exploring the Change feed folder in your data lake</span></span>

<span data-ttu-id="a9372-146">Data Lake にテーブルを追加すると、変更フィードが自動的に有効になります。</span><span class="sxs-lookup"><span data-stu-id="a9372-146">Change feeds are automatically enabled when you add tables to a data lake.</span></span>

<span data-ttu-id="a9372-147">Data Lake にテーブルを追加する場合、または非アクティブ化されたテーブルをアクティブ化すると、システムは Data Lake 内のデータの初期コピーを作成します。</span><span class="sxs-lookup"><span data-stu-id="a9372-147">When you add a table to a data lake, or when you activate a table that has been inactivated, the system makes an initial copy of the data in the data lake.</span></span> <span data-ttu-id="a9372-148">この時点で、テーブルの状態は **初期化** と表示されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-148">At this point, the table's status is shown as **Initializing**.</span></span> <span data-ttu-id="a9372-149">初期コピーが完了すると、状態が **実行中** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-149">When the initial copy is completed, the system changes the status to **Running**.</span></span> <span data-ttu-id="a9372-150">テーブルの **実行中** 状態の場合は、Finance and Operations データベース内の変更が Data Lake に反映され、変更フィードが追加されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-150">When the table is in **Running** status, changes in the Finance and Operations database are reflected in the data lake, and change feeds are added.</span></span>

<span data-ttu-id="a9372-151">変更フォルダーにアクセスするには、Azure ポータルを開き、Finance and Operations 環境に関連付けられているストレージ アカウントを見つけて選択します。</span><span class="sxs-lookup"><span data-stu-id="a9372-151">To access change folders, open the Azure portal, and find and select the storage account that is associated with your Finance and Operations environment.</span></span> <span data-ttu-id="a9372-152">Data Lake 構造内の **変更フィード** フォルダーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-152">You should see the **Change feed** folder in the data lake folder structure.</span></span> <span data-ttu-id="a9372-153">次の図は、例を示します。</span><span class="sxs-lookup"><span data-stu-id="a9372-153">The following illustration shows an example.</span></span>

![Data Lake フォルダー構造内の変更フィード フォルダー](media/Change-feed-folders-rootfolder-top-level.png)

<span data-ttu-id="a9372-155">**変更フィード** フォルダーを開くと、Data Lake に追加したテーブルに対応するフォルダーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-155">When you open the **Change feed** folder, you should see folders that correspond to the tables that you've added to the data lake.</span></span> <span data-ttu-id="a9372-156">変更フォルダー データを説明する CDM メタデータ ファイルも表示されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-156">You should also see CDM metadata files that describe the change folder data.</span></span> <span data-ttu-id="a9372-157">次の図は、例を示します。</span><span class="sxs-lookup"><span data-stu-id="a9372-157">The following illustration shows an example.</span></span>

![変更フィード フォルダー内のフォルダーと CDM メタデータ ファイル](media/Change-feed-folders-table-level-with-metadata.png)

<span data-ttu-id="a9372-159">CDM メタデータ ファイルは、フォルダーに含まれる変更フィード データの構造を記述します。</span><span class="sxs-lookup"><span data-stu-id="a9372-159">CDM metadata files describe the structure of change feed data that is contained in folders.</span></span> <span data-ttu-id="a9372-160">CDM メタデータ ファイルや Data Factory などのデータ変換ツールを使用すると、生のカンマ区切り値 (CSV) ファイルを読み取ることなく、変更フィード データを読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="a9372-160">You can use the CDM metadata files and data transformation tools such as Data Factory to read change feed data without having to read raw comma-separated values (CSV) files.</span></span> <span data-ttu-id="a9372-161">メタデータを調べるには、メタデータ ファイルを選択し、テキスト エディターで開きます。</span><span class="sxs-lookup"><span data-stu-id="a9372-161">To examine the metadata, select a metadata file, and then open it in a text editor.</span></span>

![テキスト エディターで開いた CDM メタデータ ファイル](media/Change-feed-folders-examine-metadata.png)

<span data-ttu-id="a9372-163">メタデータ定義から通知されるので、**変更フィード** フォルダーには、追加のフィールドとともに CDC 変更ログの詳細が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a9372-163">As you should notice from the metadata definitions, the **Change feed** folder contains the CDC change log details, together with additional fields.</span></span> <span data-ttu-id="a9372-164">次の図と表は、変更フォルダーの変更の形式に関する詳細を示しています。</span><span class="sxs-lookup"><span data-stu-id="a9372-164">The following illustration and table provide details about the format of changes in change folders.</span></span>

![変更フォルダの変更の形式](media/Change-feed-folders-change-data-format2.png)

| <span data-ttu-id="a9372-166">フィールド名</span><span class="sxs-lookup"><span data-stu-id="a9372-166">Field name</span></span>                    | <span data-ttu-id="a9372-167">コンテンツ</span><span class="sxs-lookup"><span data-stu-id="a9372-167">Contents</span></span> |
|-------------------------------|----------|
| <span data-ttu-id="a9372-168">Start\_LSN</span><span class="sxs-lookup"><span data-stu-id="a9372-168">Start\_LSN</span></span>                    | <p><span data-ttu-id="a9372-169">このフィールドは、Finance and Operations データベースのソース データを変更したトランザクションの LSN を識別します。</span><span class="sxs-lookup"><span data-stu-id="a9372-169">This field identifies the LSN of the transaction that changed source data in the Finance and Operations database.</span></span></p><p><span data-ttu-id="a9372-170">**注:** **Start\_LSN** 値は、CSV ファイルでは二重引用符で囲まれて **いません**。</span><span class="sxs-lookup"><span data-stu-id="a9372-170">**Note:** The **Start\_LSN** value is **not** enclosed in double quotation marks in CSV files.</span></span> <span data-ttu-id="a9372-171">これは、SQL Server データベースに示されている 16 進値です。</span><span class="sxs-lookup"><span data-stu-id="a9372-171">It's a hexadecimal value, as represented in the SQL Server database.</span></span> <span data-ttu-id="a9372-172">サンプル値を次に示します: **0X00011E9F00000FB00001**。</span><span class="sxs-lookup"><span data-stu-id="a9372-172">Here is a sample value: **0X00011E9F00000FB00001**.</span></span></p> |
| <span data-ttu-id="a9372-173">End\_LSN</span><span class="sxs-lookup"><span data-stu-id="a9372-173">End\_LSN</span></span>                      | <span data-ttu-id="a9372-174">このフィールドは使用されません。</span><span class="sxs-lookup"><span data-stu-id="a9372-174">This field isn't used.</span></span> |
| <span data-ttu-id="a9372-175">DML\_Action</span><span class="sxs-lookup"><span data-stu-id="a9372-175">DML\_Action</span></span>                   | <p><span data-ttu-id="a9372-176">各変更は個別のレコードとして格納されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-176">Each change is stored as a separate record.</span></span> <span data-ttu-id="a9372-177">**DML\_Action** フィールドは、レコードに対する変更を識別します。</span><span class="sxs-lookup"><span data-stu-id="a9372-177">The **DML\_Action** field identifies the change that was made to the record.</span></span></p><ul><li><span data-ttu-id="a9372-178">1: DELETE</span><span class="sxs-lookup"><span data-stu-id="a9372-178">1: DELETE</span></span></li><li><span data-ttu-id="a9372-179">2: INSERT</span><span class="sxs-lookup"><span data-stu-id="a9372-179">2: INSERT</span></span></li><li><span data-ttu-id="a9372-180">3: BEFORE\_UPDATE</span><span class="sxs-lookup"><span data-stu-id="a9372-180">3: BEFORE\_UPDATE</span></span></li><li><span data-ttu-id="a9372-181">4: AFTER\_UPDATE</span><span class="sxs-lookup"><span data-stu-id="a9372-181">4: AFTER\_UPDATE</span></span></li></ul><p><span data-ttu-id="a9372-182">**注:** システムは **BEFORE\_UPDATE** レコードを変更フィードに追加されません。</span><span class="sxs-lookup"><span data-stu-id="a9372-182">**Note:** The system doesn't add a **BEFORE\_UPDATE** record to change feeds.</span></span></p> |
| <span data-ttu-id="a9372-183">Seq\_Val</span><span class="sxs-lookup"><span data-stu-id="a9372-183">Seq\_Val</span></span>                      | <p><span data-ttu-id="a9372-184">このフィールドは、ソースのデータを変更した LSN 内のシーケンス番号を識別します。</span><span class="sxs-lookup"><span data-stu-id="a9372-184">This field identifies the sequence number within the LSN that changed data in the source.</span></span> <span data-ttu-id="a9372-185">トランザクションは Finance and Operations データベース内の複数のテーブルを更新する可能性があるため、**Seq\_Val** フィールドは CDC がテーブルに割り当てたシーケンス番号を示します。</span><span class="sxs-lookup"><span data-stu-id="a9372-185">Because a transaction might update more than one table in the Finance and Operations database, the **Seq\_Val** field indicates the sequence number that CDC assigned to the table.</span></span></p><p><span data-ttu-id="a9372-186">変更レコードは、トランザクションのテーブルに対して行われたすべての変更に対して追加されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-186">A change record is added for every change that is made to a table in a transaction.</span></span> <span data-ttu-id="a9372-187">同じレコードが 1 つのトランザクションで複数回更新された場合、個別のシーケンス番号を持つ複数の変更レコードが見つかります。</span><span class="sxs-lookup"><span data-stu-id="a9372-187">If the same record was updated multiple times in a single transaction, you will find multiple change records that have a separate sequence number.</span></span> <span data-ttu-id="a9372-188">将来、極端な場合 (たとえば、1 つのトランザクションで同じレコードに数千の更新がある場合)、システムは最新の更新レコードを格納する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-188">In the future, in extreme cases (for example, when there are thousands of updates to the same record in a single transaction), the system might store the latest update record.</span></span></p> |
| <span data-ttu-id="a9372-189">Update\_Mask</span><span class="sxs-lookup"><span data-stu-id="a9372-189">Update\_Mask</span></span>                  | <span data-ttu-id="a9372-190">変更されたフィールドを識別するビットマップ。</span><span class="sxs-lookup"><span data-stu-id="a9372-190">A bitmap that identifies the fields that changed.</span></span> <span data-ttu-id="a9372-191">このビットマップは、変更追跡の更新マスクに似ています。</span><span class="sxs-lookup"><span data-stu-id="a9372-191">This bitmap resembles the update mask in Change tracking.</span></span> <span data-ttu-id="a9372-192">ただし、ビットマップを調べることで、変更したフィールドを識別できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-192">However, by examining the bitmap, you can identify the fields that changed.</span></span> |
| <span data-ttu-id="a9372-193">フィールドおよび値の一覧</span><span class="sxs-lookup"><span data-stu-id="a9372-193">List of fields and values</span></span>    | <span data-ttu-id="a9372-194">残りの列は、値とともに、テーブルに存在するフィールドのリストを提供します。</span><span class="sxs-lookup"><span data-stu-id="a9372-194">The remaining columns provide a list of fields that are present in the table, together with the values.</span></span> <span data-ttu-id="a9372-195">トランザクションの一部として変更されたフィールドを識別するには、更新マスクを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-195">You should use the update mask to identify fields that changed as part of the transaction.</span></span> |
| <span data-ttu-id="a9372-196">LastProcessedChange\_DateTime</span><span class="sxs-lookup"><span data-stu-id="a9372-196">LastProcessedChange\_DateTime</span></span> | <p><span data-ttu-id="a9372-197">このフィールドは、Finance and Operations データベースの CDC **日時変更** フィールドの値を提供します。</span><span class="sxs-lookup"><span data-stu-id="a9372-197">This field provides the value of the CDC **Change Date-Time** field from the Finance and Operations database.</span></span> <span data-ttu-id="a9372-198">日付/時刻は、ISO 8601 あたりの協定世界時 (UTC) で表されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-198">The date/time is expressed in Coordinated Universal Time (UTC), per ISO 8601.</span></span></p><p><span data-ttu-id="a9372-199">サンプル値を次に示します: **"2020-08-24T05:26:03.8622647Z"**。</span><span class="sxs-lookup"><span data-stu-id="a9372-199">Here is a sample value: **"2020-08-24T05:26:03.8622647Z"**.</span></span> <span data-ttu-id="a9372-200">この値は二重引用符で囲まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a9372-200">Notice that this value is enclosed in double quotation marks.</span></span> <span data-ttu-id="a9372-201">さらに、2 番目の値の後の既定の 7 桁の精度と、UTC を表す *Z* が含まれます。</span><span class="sxs-lookup"><span data-stu-id="a9372-201">Additionally, it includes the default seven digits of precision after the second value, and a *Z* that signifies UTC.</span></span></p> |
| <span data-ttu-id="a9372-202">DataLakeModified\_DateTime</span><span class="sxs-lookup"><span data-stu-id="a9372-202">DataLakeModified\_DateTime</span></span>    | <p><span data-ttu-id="a9372-203">このフィールドは、Data Lake への書き込みの日時を提供します。</span><span class="sxs-lookup"><span data-stu-id="a9372-203">This field provides the date and time of writing to the data lake.</span></span> <span data-ttu-id="a9372-204">日付/時刻は、ISO 8601 あたりの UTC で表されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-204">The date/time is expressed in UTC, per ISO 8601.</span></span></p><p><span data-ttu-id="a9372-205">サンプル値を次に示します: **"2020-08-24T05:26:03.8622647Z"**。</span><span class="sxs-lookup"><span data-stu-id="a9372-205">Here is a sample value: **"2020-08-24T05:26:03.8622647Z"**.</span></span> <span data-ttu-id="a9372-206">この値は二重引用符で囲まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a9372-206">Notice that this value is enclosed in double quotation marks.</span></span> <span data-ttu-id="a9372-207">さらに、2 番目の値の後の既定の 7 桁の精度と、UTC を表す *Z* が含まれます。</span><span class="sxs-lookup"><span data-stu-id="a9372-207">Additionally, it includes the default seven digits of precision after the second value, and a *Z* that signifies UTC.</span></span></p> |

## <a name="best-practices-when-change-feeds-are-used"></a><span data-ttu-id="a9372-208">変更フィードを使用する場合のベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="a9372-208">Best practices when change feeds are used</span></span>

<span data-ttu-id="a9372-209">変更フィードは、Finance and Operations アプリの **Data Lake へのエクスポート** 機能によって有効になる強力な機能です。</span><span class="sxs-lookup"><span data-stu-id="a9372-209">Change feeds are a powerful feature that is enabled by the **Export to Data Lake** feature in Finance and Operations apps.</span></span> <span data-ttu-id="a9372-210">このセクションでは、変更フィードを使用するときに従う必要のあるいくつかのベスト プラクティスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="a9372-210">This section examines some best practices that you should follow when change feeds are used.</span></span>

### <a name="updating-near-real-time-data-marts"></a><span data-ttu-id="a9372-211">ほぼリアルタイムのデータ マートの更新</span><span class="sxs-lookup"><span data-stu-id="a9372-211">Updating near-real-time data marts</span></span>

<span data-ttu-id="a9372-212">データ ウェアハウスまたはデータ マートをほぼリアルタイムで更新する必要がある場合 (つまり、Finance and Operations アプリでデータが変更されてから数分以内に更新する必要がある場合)、変更フィードを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-212">If you require that your data warehouse or data marts be updated in near-real time (in other words, if they must be updated within minutes of a data change in Finance and Operations apps), you should use change feeds.</span></span>

<span data-ttu-id="a9372-213">ただし、理解する必要のある重要な概念がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="a9372-213">However, there are several important concepts that must be understood:</span></span>

- <span data-ttu-id="a9372-214">変更レコードは、サイズが約 4 メガバイト (MB) または 8 MB のファイルにグループ化されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-214">Change records are grouped into files that are around 4 megabytes (MB) or 8 MB in size.</span></span> <span data-ttu-id="a9372-215">Microsoft は、ファイルが Synapse SQL Serverless によってクエリされるときに最適なクエリ応答時間を提供するように、ファイル サイズを最適化しました。</span><span class="sxs-lookup"><span data-stu-id="a9372-215">Microsoft has optimized file sizes so that they provide optimum query response times when the files are queried by Synapse SQL Serverless.</span></span> <span data-ttu-id="a9372-216">最適化されたファイル サイズ (およびバッチ書き込み) により、Data Lake の更新時に発生する可能性のある Azure の料金も削減されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-216">Optimized file sizes (and batched writes) also reduce the Azure charges that you might incur as the data lake is updated.</span></span> <span data-ttu-id="a9372-217">変更レコードは追加されるだけです。</span><span class="sxs-lookup"><span data-stu-id="a9372-217">Change records are only appended.</span></span> <span data-ttu-id="a9372-218">つまり、更新されることはありません。</span><span class="sxs-lookup"><span data-stu-id="a9372-218">In other words, they are never updated.</span></span> <span data-ttu-id="a9372-219">ただし、**変更フィード** フォルダー内のファイルが更新される場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-219">However, files in the **Change feed** folder might occasionally be updated.</span></span> <span data-ttu-id="a9372-220">たとえば、4 MB のサイズに一致するように小さいレコードがいっぱいになる場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-220">For example, smaller records might be filled up so that they match the 4 MB size.</span></span> <span data-ttu-id="a9372-221">変更を識別するために、CSV ファイルの日付/タイム スタンプに依存しません。</span><span class="sxs-lookup"><span data-stu-id="a9372-221">You should not rely on the date/time stamp of CSV files to identify changes.</span></span> <span data-ttu-id="a9372-222">代わりに、変更レコードの LSN またはタイム スタンプに依存する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-222">Instead, you should rely on the LSN or the time stamps in the change record.</span></span>
- <span data-ttu-id="a9372-223">変更フィードは、Data Lake 常に更新されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-223">Change feeds are constantly updated in the data lake.</span></span> <span data-ttu-id="a9372-224">更新は、データを 1 分おきに更新する小規模なバッチで発生する場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-224">Updates might occur in small batches that update the data every minute.</span></span> <span data-ttu-id="a9372-225">これらの更新は、頻繁に更新されるテーブルの場合、1 分に複数回発生する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="a9372-225">These updates might even occur more than one time per minute in the case of tables that are frequently updated.</span></span> <span data-ttu-id="a9372-226">**変更フィード** フォルダー (またはファイルのタイム スタンプ) を監視して下流のジョブをトリガーすることはできますが、ファイルに過去に使用した既存の変更レコードが含まれている可能性を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-226">Although you can observe the **Change feed** folder (or time stamps of files) to trigger downstream jobs, you should consider the possibility that a file might have existing change records that you consumed in the past.</span></span>
- <span data-ttu-id="a9372-227">下流のジョブは定期的に調整でき、ファイルやフォルダーへの変更を監視する代わりに、マイクロバッチとしてトリガーできます。</span><span class="sxs-lookup"><span data-stu-id="a9372-227">Your downstream jobs can be orchestrated on a periodic basis, and they can be triggered as microbatches instead of observing changes to files or folders.</span></span>
- <span data-ttu-id="a9372-228">下流のデータ パイプラインには、「最後に処理された」マーカー (透かしとも呼ばれる) が必要です。</span><span class="sxs-lookup"><span data-stu-id="a9372-228">Your downstream data pipelines must have a "last processed" marker (also known as a watermark).</span></span> <span data-ttu-id="a9372-229">可能な限り、透かしとして LSN を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-229">Whenever you can, you should rely on the LSN as the watermark.</span></span> <span data-ttu-id="a9372-230">ただし、**日時変更** 値を透かしとして使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="a9372-230">However, you can also use the **Change Date-Time** value as the watermark.</span></span> <span data-ttu-id="a9372-231">LSN に依存することにより、Finance and Operations データベースで確定されたのと同じ順序で変更を確実に消費することができます。</span><span class="sxs-lookup"><span data-stu-id="a9372-231">By relying on the LSN, you will ensure that you consume the changes in the same sequence in which they were committed in the Finance and Operations database.</span></span>
- <span data-ttu-id="a9372-232">Finance and Operations でテーブルを再有効化する場合、**変更フィード** フォルダーがクリアされ、システムは次に使用可能な変更から変更フィードを開始します。</span><span class="sxs-lookup"><span data-stu-id="a9372-232">When you reactivate a table in Finance and Operations, the **Change feed** folder is cleared, and the system starts change feeds from the next available change.</span></span> <span data-ttu-id="a9372-233">この動作によって、変更は **テーブル** フォルダーと一貫しています。</span><span class="sxs-lookup"><span data-stu-id="a9372-233">This behavior ensures that the changes are consistent with the **Tables** folder.</span></span> <span data-ttu-id="a9372-234">テーブルが再有効化された場合、下流のデータ パイプラインに対する完全な更新をトリガーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-234">When tables are reactivated, you should consider triggering a full refresh of the downstream data pipeline.</span></span>

<span data-ttu-id="a9372-235">[サンプルの Synapse テンプレート](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/tree/master/Analytics/SynapseToSQL_ADF) は使用可能です。</span><span class="sxs-lookup"><span data-stu-id="a9372-235">A [sample Synapse template](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/tree/master/Analytics/SynapseToSQL_ADF) is available.</span></span> <span data-ttu-id="a9372-236">これを使用して、SQL ベースのデータ ウェアハウスにデータを段階的に取り込むことができます。</span><span class="sxs-lookup"><span data-stu-id="a9372-236">You can use it to incrementally ingest data into a SQL-based data warehouse.</span></span>

### <a name="simplifying-byod-based-etl-pipelines"></a><span data-ttu-id="a9372-237">BYOD ベースの ETL パイプラインの簡略化</span><span class="sxs-lookup"><span data-stu-id="a9372-237">Simplifying BYOD-based ETL pipelines</span></span>

<span data-ttu-id="a9372-238">現在[自分のデータベースの持ち込み (BYOD)](../analytics/export-entities-to-your-own-database.md) 機能を使用している場合は、データ管理フレームワーク (DMF) のシステム テーブルまたはバッチ テーブルに基づくエンティティのエクスポートに依存できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-238">If you're currently using the [bring your own database (BYOD)](../analytics/export-entities-to-your-own-database.md) feature, you can rely on exports of entities that are based on Data management framework (DMF) system tables or batch tables.</span></span> <span data-ttu-id="a9372-239">DMF システム テーブルのエクスポート ジョブ実行データを使用して、エクスポート ジョブの期間を特定している可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-239">You might be using export job execution data in DMF system tables to identify the time periods of export jobs.</span></span> <span data-ttu-id="a9372-240">下流のジョブは、ジョブの実行状態および、DMF テーブルから取得された詳細を介してトリガーされる場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-240">Your downstream jobs might be triggered through job execution status and details that are obtained from DMF tables.</span></span>

<span data-ttu-id="a9372-241">変更フィードを消費することで、オーケストレーション パイプラインを簡略化できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-241">You can simplify the orchestration pipeline by consuming change feeds.</span></span>

### <a name="using-the-tables-folder-if-your-data-marts-must-be-updated-daily-or-several-times-per-day"></a><span data-ttu-id="a9372-242">データ マートを毎日または 1 日に何度か更新する必要がある場合にテーブル フォルダーを使用する</span><span class="sxs-lookup"><span data-stu-id="a9372-242">Using the Tables folder if your data marts must be updated daily or several times per day</span></span>

<span data-ttu-id="a9372-243">変更フィードは強力な機能ですが、ほぼリアルタイムのデータ パイプラインを構築および管理するプロセスは複雑です。</span><span class="sxs-lookup"><span data-stu-id="a9372-243">Change feeds are a powerful feature, but the process of constructing and maintaining a near-real-time data pipeline is complex.</span></span> <span data-ttu-id="a9372-244">最新のデータ変換ツールと既製のテンプレートはこのプロセスを簡素化するのに役立ちますが、パイプラインの構築と実行に投資する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-244">Although modern data transformation tools and ready-made templates can help simplify this process, you might still have to invest in building and running your pipeline.</span></span>

<span data-ttu-id="a9372-245">ユーザーがデータ マートを毎日または 1 日に数回更新することを期待している場合、特にデータの量が少ないか中程度の場合は、完全な更新をトリガーすることが経済的な代替になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a9372-245">If your users expect to data marts to be updated daily or several times per day, triggering a full refresh might be an economical alternative, especially if the volume of data is low or moderate.</span></span>

### <a name="changing-feeds-to-audit-and-verify-master-data-updates"></a><span data-ttu-id="a9372-246">マスター データの更新を監査および検証するための変更フィード</span><span class="sxs-lookup"><span data-stu-id="a9372-246">Changing feeds to audit and verify master data updates</span></span>

<span data-ttu-id="a9372-247">**変更フィード** フォルダーは、Finance and Operations データベースによって管理される CDC 変更ログの完全な複製です。</span><span class="sxs-lookup"><span data-stu-id="a9372-247">The **Change feed** folder is an exact replica of the CDC change logs that are maintained by the Finance and Operations database.</span></span> <span data-ttu-id="a9372-248">Finance and Operations アプリケーションのマスター データに加えた変更は CDC に反映されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-248">Changes that are made to master data in Finance and Operations apps are reflected in CDC.</span></span> <span data-ttu-id="a9372-249">したがって、拡張機能として、Data Lake の変更フィード フォルダーにも反映されます。</span><span class="sxs-lookup"><span data-stu-id="a9372-249">Therefore, by extension, they are also reflected in change feed folders in your data lake.</span></span>

<span data-ttu-id="a9372-250">**変更フィード** フォルダー上に構築されたレポートを使用して、システム内のマスター データの変更を監査および検証できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-250">You can use reports that are built over the **Change feed** folder to audit and verify master data changes in the system.</span></span>

### <a name="periodically-purging-the-change-feed-folder"></a><span data-ttu-id="a9372-251">変更フィード フォルダーを定期的に削除する</span><span class="sxs-lookup"><span data-stu-id="a9372-251">Periodically purging the Change feed folder</span></span>

<span data-ttu-id="a9372-252">**変更フィード** フォルダーは、エラーから回復するためにデータを再初期化しない限り、**Data Lake へのエクスポート** プロセスによって削除されません。</span><span class="sxs-lookup"><span data-stu-id="a9372-252">The **Change feed** folder isn't deleted by the **Export to Data Lake** process unless you reinitialize the data to recover from an error.</span></span>

<span data-ttu-id="a9372-253">テーブルは **実行** 状態の間、変更を追加し続けるため、変更フィード フォルダーは Data Lake 内で拡大し続けます。</span><span class="sxs-lookup"><span data-stu-id="a9372-253">Because tables continue to add changes while they are in **Running** status, change feed folders will continue to grow in the data lake.</span></span> <span data-ttu-id="a9372-254">(ただし、Data Lake にデータを保持するためのコストは、SQL データベースのコストのほんの一部であることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a9372-254">(However, note that the cost of retaining data in the data lake is a fraction of the cost of a SQL database.</span></span> <span data-ttu-id="a9372-255">したがって、データの拡大のコストは大きな問題ではない可能性があります。)</span><span class="sxs-lookup"><span data-stu-id="a9372-255">Therefore, the cost of growing data might not be a major concern.)</span></span>

<span data-ttu-id="a9372-256">Data Lake に格納されるデータの量を減らしたい場合は、Data Lake から変更ログを定期的に削除できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-256">If you want to reduce the amount of data that is stored in your data lake, you can periodically delete the change log from the data lake.</span></span> <span data-ttu-id="a9372-257">たとえば、90 日または 180 日間変更されていない変更ログ ファイルを削除するジョブを実行できます。</span><span class="sxs-lookup"><span data-stu-id="a9372-257">For example, you can run a job that deletes change log files that haven't been modified for 90 days or 180 days.</span></span>

<span data-ttu-id="a9372-258">変更ログを定期的に削除しても、**テーブル** フォルダー内のデータには影響しません。</span><span class="sxs-lookup"><span data-stu-id="a9372-258">Periodic deletion of the change log has no impact on data in the **Tables** folder.</span></span> <span data-ttu-id="a9372-259">ただし、このトピックで前述されているように、整合性チェックを実行する場合は、それらのチェックを容易にするために、変更ログをより長く保持することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a9372-259">However, if you run consistency checks, as described earlier in this topic, you might want to keep the change log longer to facilitate those checks.</span></span>
