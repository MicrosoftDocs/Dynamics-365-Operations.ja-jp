---
title: バッチ処理とバッチ サーバー
description: このトピックでは、バッチ処理とバッチ サーバー、およびその使用を計画する方法について説明します。
author: Peakerbl
manager: AnnBe
ms.date: 01/22/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: IT Pro
ms.reviewer: sericks
ms.custom: 57201
ms.assetid: 22a56b7d-4e07-4161-8416-0cac4a0b65a2
ms.search.region: Global
ms.author: peakerbl
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: 3723e6f881567882f842a124c9f0cac15e42a11f
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2020
ms.locfileid: "4686323"
---
# <a name="batch-processing-and-batch-servers"></a>バッチ処理とバッチ サーバー

[!include [banner](../includes/banner.md)]

このトピックでは、バッチ処理とバッチ サーバー、およびその使用を計画する方法について説明します。

バッチ フレームワークは、Application Object Server (AOS) の複数のインスタンスにわたるタスクを処理できるサーバー ベースの非同期バッチ処理環境を提供します。 

バッチ フレームワークの次のような側面について、よく理解しておく必要があります。

-   **バッチ ジョブ** は、特定の目標を達成するために使用されるプロセスです。 バッチ ジョブは、1 つまたは複数のバッチ タスクで構成されます。
-   **バッチ タスク** は、バッチ ジョブによって実行される活動です。 複数の種類の依存関係を持つバッチ タスクをバッチ ジョブに追加することができます。 また、それぞれがタスクを実行する、複数のスレッドを実行するように AOS インスタンスを構成することができます。 実行を待機しているすべてのバッチ タスクはバッチ サーバーとしてコンフィギュレーションされている使用可能なすべての AOS インスタンスによって実行できます。 スループットを向上させ、全体の実行時間を短縮するには、バッチ ジョブを多数のタスクとして定義し、バッチ サーバーを使用して使用可能なすべての AOS インスタンスに対してタスクを実行します。
-   **バッチ グループ** は、バッチ タスクの属性です。 バッチ グループは、管理者がタスクを実行する AOS インスタンスを決定または指定することを可能にします。 新しいタスクを作成するとき、そのタスクは既定のバッチ グループに配置されます。 すべてのバッチ サーバーは、任意のジョブから既定のバッチ グループおよび待機中のタスクをプロセスするためにコンフィギュレーションされています。 また、名前付きバッチ グループを作成して、そのバッチ グループと特定の AOS インスタンスの間のアフィニティを設定できます。 アフィニティを作成した後は、指定された AOS インスタンスのみが名前付きバッチ グループのタスクを処理することができ、 AOS インスタンスは指定された名前付きバッチ グループからのみタスクを処理することができます。 また、バッチ グループが必要な場合、既定のバッチ グループを構成済みサーバーに追加することができます。

## <a name="batch-server-topology-planning"></a>バッチ サーバーのトポロジ計画
バッチ サーバーの能力は、AOS インスタンスで同時に実行できるスレッドの最大数に基づいています。 各スレッドは、1 つのバッチ タスクを実行します。 タスク間またはタスク内に複雑な依存関係を追加することができます。 これらのタスクは、ビジネス ロジックおよび要件に基づき、シリアル ステップまたはパラレル ステップで実行することができます。 依存関係を持っていないすべてのタスクは並列タスクと見なされます。 バッチ サーバーとしてコンフィギュレーションされている AOS インスタンスは、処理を待機しているタスクを定期的に確認します。 バッチ サーバーは、各並列タスクをスレッドに割り当て、そのスレッドの処理を開始します。 

複数の AOS インスタンス間で複数のスレッドを実行することができます。 各 AOS インスタンスは、構成設定で定義されているキャパシティに応じて、複数のスレッドを自動的に実行します。 したがって、ジョブからの並列タスクは、複数の AOS インスタンスにわたって複数のスレッドで実行できます。

バッチ サーバーは、1 分間に 1 回使用可能なスレッドをチェックします。 したがって、待機中のタスクが使用可能なスレッドで処理されるのを確認するまで、少し待たなければならない場合があります。

## <a name="batch-server-management-planning"></a>バッチ サーバーの管理計画
すべてのバッチ サーバーは単一の場所から管理することができます。 

バッチ サーバーの 1 つの一般的な使用方法は、複数のサーバー間でジョブの負荷分散を行うことです。 バッチ サーバーが処理するスレッド数をセットすることができます。 

バッチ サーバーは、クライアントおよびその他の関連付けられたコンポーネントからサービスが要求する有効な AOS インスタンスでもあるため、AOS インスタンスがバッチ処理に利用できるようにする場合は慎重に決定する必要があります。 


## <a name="walkthroughs"></a>チュートリアル
次のチュートリアルでは、タスクの処理方法と、バッチ グループを使用してバッチ ジョブをバッチ ・サーバーに関連付ける方法について説明します。

### <a name="batch-processing-of-dependent-tasks"></a>従属タスクのバッチ処理

この例では、ジョブ 1 と呼ばれるジョブを作成しました。 次の図に示すように、職務には 7 つのタスクがあります。タスク 1、タスク 2、タスク 3、タスク 4、タスク 5、タスク 6、およびタスク 7 です。 

![依存タスクのジョブ](./media/batch_framework_programmability.gif) 

タスクには次の依存関係があります。

-   タスク 1 は、最初のタスクです。
-   タスク 2 は、タスク 1 が完了すると実行されます (タスク 1 が成功したか失敗したかに関係ありません)。
-   タスク 3 は、タスク 2 が正常に行われた場合に実行されます。
-   タスク 4 は、タスク 2 が正常に行われた場合に実行されます。
-   タスク 5 は、タスク 2 が失敗したときに実行されます。
-   タスク 6 は、タスク 3 が失敗したときに実行されます。
-   タスク 7 は、タスク 3 とタスク 4 の両方が正常に行われたときに実行されます。

2 つのバッチ・サーバー、Batch1 と Batch2 が構成されています。 各サーバーには、1 つのスレッドの容量があります。 

Batch1 が待機中のタスクをチェックし、そのスレッドにタスク 1 を割り当て、タスク 1 の実行を開始するとします。 Batch2 とその単一スレッドも使用可能ですが、タスク 2 はタスク 1 が完了するまで待機し続けます。 

タスク 1 が完了するとすぐに、タスク 2 は実行する準備ができています。 ここでは、Batch2 が待機中のタスクをチェックし、そのスレッドにタスク 2 を割り当て、タスク 2 の実行を開始するものとします。 

タスク 2 が正常に行われた場合は、タスク 3 およびタスク 4 の実行準備が整います。 ここでは、Batch2 が待機中のタスクをチェックし、そのスレッドにタスク 3 を割り当て、タスク 3 の実行を開始するものとします。 Batch1 も待機中のタスクをチェックし、そのスレッドにタスク 4 を割り当て、タスク 4 の実行を開始します。 

タスク 3 とタスク 4 が成功した場合は、バッチ サーバーのいずれかがタスク 7 を実行します。 

タスク 2 が失敗すると、バッチ サーバーのいずれかがタスク 5 を実行します。 

タスク 3 が失敗すると、利用可能なバッチ サーバーのいずれかがタスク 6 を実行します。 

**注記:** このチュートリアルでは、概念を説明するために Batch1 と Batch2 を使用します。 使用可能なスレッドを持つすべてのバッチ サーバーは、待機中のタスクの実行を開始します。 サーバー上で実行するバッチ ジョブを決定または指定するには、バッチ グループを作成する必要があります。

### <a name="batch-processing-that-uses-batch-groups"></a>バッチ グループを使用するバッチ処理

この例は、特定のバッチ サーバーでバッチ ジョブを処理する方法を示しています。 

次の 3 つのバッチ サーバー、AOS1、AOS2、および AOS3 があります。 既定では、すべてのバッチ サーバーは使用可能なスレッドの数に応じて、すべてのバッチ ジョブのタスクを処理します。 

名前付きバッチ グループ、BG1 を作成し、AOS2 および AOS3 で実行するように構成します。 したがって、BG1 のジョブからのタスクは、使用可能なスレッドの数に応じて、AOS2 または AOS3 でのみ実行されます。 AOS1 は、BG1 のジョブのタスクを処理しません。 同様に、AOS2 および AOS3 は BG1 からのみタスクを処理します。 

AOS2 および AOS3 を構成して他のバッチ グループからタスクを処理することができます。 これらのバッチ グループには、既定のバッチ グループが含まれています。

### <a name="batch-excessive-tasks-configuration-batch-throttling"></a>過剰なタスク コンフィギュレーションのバッチ (バッチ調整)

バッチ調整では、特定のバッチ クラスの 1 分あたりの平均実行回数を制限することにより過剰のタスクを防ぐことができます。 既定の上限は 1 分あたり 60 のタスクです。 その後、バッチ フレームワークは、問題のあるクラスの実行をもう 1 分中断して、その特定のクラスがシステム リソースを独占するのを防ぎます。

> [!NOTE]
> バッチ フレームワークでは、いつでもスケジュールおよび実行するように調整されていないタスクがない場合に、インスタンスを検出できます。 この場合、バッチはリソースがアイドル状態になるのを防ぐため、調整されたクラス キューからバッチ タスクをフェッチします。
