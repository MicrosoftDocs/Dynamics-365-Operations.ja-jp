---
title: 優先順位に基づくバッチスケジューリング
description: このトピックでは、優先順位に基づくバッチスケジューリングの機能について説明します。
author: peakerbl
manager: AnnBe
ms.date: 12/05/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: IT Pro
ms.reviewer: kfend
ms.custom: 62333
ms.assetid: ''
ms.search.region: Global
ms.author: peakerbl
ms.search.validFrom: 2019-10-29
ms.dyn365.ops.version: Platform Update31
ms.openlocfilehash: 1240bd7f953bdfab4c0e08655e28ddbecf289fb2
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2020
ms.locfileid: "4682523"
---
# <a name="priority-based-batch-scheduling"></a>優先順位に基づくバッチスケジューリング 

[!include [banner](../includes/banner.md)]

プラットフォーム アップデート 31 では、[機能管理](../../fin-ops/get-started/feature-management/feature-management-overview.md) の **バッチ優先順位に基づくスケジューリング** 機能を有効にすることができます。 優先順位に基づくスケジューリングでは、バッチグループをバッチサーバーから切り離します。 代わりに、使用可能なバッチサーバー間でタスクが実行される順序を決定するために、相対的なスケジューリング優先順位が使用されます。

> [!IMPORTANT]
> この機能は、プラットフォーム アップデート 31 の一部として、制限されたプレビューでのみ使用できます。

スケジューリング優先順位はバッチ グループに対して定義されますが、特定のバッチ ジョブに対して上書きすることができます。 スケジュール設定の優先順位の分類は、相対的な優先順位を宣言し、ジョブとビジネスプロセスの処理順序の決定に使用されます。 スケジューリング優先順位に使用できる値は、**低**、**通常**、**高**、**重大**、**予約済みキャパシティ** です。 **標準** は規定の値です。これが有効化されると、すべての既存のバッチグループに適用されます。 **予約済キャパシティ** は、最も高い優先順位を表します。 プラットフォーム更新プログラム 32 または それ以降のバージョンでは、これをジョブ専用のキャパシティとして使用できます。 詳細については、 このトピック後半の <a name="reserved">バッチ専用のキャパシティを設定する</a> セクションを参照してください。

> [!NOTE]
> この機能を有効にすると、すべての既存のバッチグループに対するスケジュールの優先度が **標準** に設定されています。それぞれのバッチグループに対してスケジュールの優先度を設定することは、業務要件に応じたバッチジョブと業務プロセスの優先度を表すことにもなります。

プラットフォーム更新プログラム 32 には、既存のバッチジョブに対する更新サポートが含まれています。 詳細については、 このトピック後半の <a name="#automatic">バッチジョブ を バッチグループ へと自動移行する</a> セクションを参照してください。

優先順位に基づくバッチ スケジューリングでは、機能管理での **バッチ フレームワークの競合軽減** 機能を有効にする必要があります。

次の手順では、**優先順位に基づくバッチ スケジューリング** 機能が有効になっている場合に、バッチ グループ、ジョブ、およびタスクと作業する方法について説明します。

## <a name="batch-groups"></a>バッチ グループ

バッチ グループは、ジョブを論理的にグループ化し、既定のスケジューリング優先順位を設定するためにのみ使用されるようになりました。 バッチ グループの例を次に示します:

- 特定の業務プロセスに属するジョブ
- 同じ実行の繰り返しが設定されているジョブ (たとえば、毎晩、毎週、毎月など)
- 優先順位が同じジョブ

### <a name="create-a-batch-group"></a>バッチ グループの作成

1. **システム管理** \> **設定** \> **バッチ グループ** の順に移動します。
2. **新規** を選択して、新しいバッチ グループを作成します。
3. **グループ** フィールドで、そのバッチ グループに対して固有の名前を入力します。
4. **説明** フィールドで値を入力します。
5.  **スケジューリング優先順位** フィールドで、バッチ グループ内のバッチ ジョブの既定のスケジューリング優先順位を選択します。
6. **保存** を選択します。

## <a name="batch-jobs"></a>バッチ ジョブ

バッチ ジョブは、自動処理のために送信されるタスクのグループです。 バッチ ジョブは、**実行者** フィールドで選択されたユーザーのセキュリティ資格情報を使用して実行されます。 バッチ ジョブを作成するには、次の手順に従います。

### <a name="create-a-batch-job"></a>バッチ ジョブの作成

1. **システム管理** \> **照会** \> **バッチ ジョブ** の順に移動します。
2. **新規** を選択して、新しいバッチ ジョブを作成します。
3. **職務明細書** フィールドに値を入力します。
4. **開始予定日時** フィールドに、日時を入力します。
5. **実行者** フィールドで、バッチジョブの実行時に使用するセキュリティ資格情報を持つユーザーを選択します。 詳細については、[バッチ管理者のセキュリティ ロール](runby.md) を参照してください。
6. オプション: **監視カテゴリ** フィールドで、監視中にジョブのタイプを容易に識別できるように値を選択します。
7. オプション: **重要なジョブ**　オプションを **はい** に設定します。 詳細については、[ユーザーを一括でインポートする](tasks/import-bulk-users.md) または [重大としてバッチ ジョブを処理するときのワークフロー メッセージを構成する](../../fin-ops/organization-administration/workflow-batch-job-critical.md) を参照してください。
8. **バッチ グループ** フィールドで、ジョブのバッチ グループを選択します。
9. オプション: **スケジューリング優性順位が上書きされました** オプションを **はい** に設定し、**ジョブのスケジューリング優先順位** フィールドを使用可能にします。
10. オプション: **ジョブのスケジューリング優先順位** フィールドで、バッチ グループに対して定義されている既定の優先順位とは異なる既定の優先順位を選択します。
11. オプション: **有効な期間** フィールドで、バッチ ジョブを実行できる時間の範囲を選択します。 詳細については、[有効なバッチ期間](activeperiod.md) を参照してください。
12. **保存** を選択します。

### <a name="add-a-task-to-a-batch-job"></a>バッチ ジョブへのタスクの追加

1. **バッチ ジョブ** ページの **バッチ タスク** セクションで、**新規** を選択します。
2. **タスク明細書** フィールドに値を入力します。
3. **会社アカウント** フィールドで、タスクが実行される会社を選択します。
4. **クラス名** フィールドで、実行するプロセスを選択します。 **CanGoBatchJournal** プロパティが有効化されていると、クラスがリスト表示されます。
5. **保存** を選択します。
6. **バッチ タスクの詳細** クイックタブを展開して、バッチ タスクの設定をさらに追加するか、制約を追加します。
7. **全般** タブで、**タスクの失敗を無視する** オプションを **はい** に設定して、タスクの失敗によってジョブが失敗しないように指定します。
8. **最大再試行回数** フィールドで、試行が何回失敗した場合にタスクが失敗したと見なされるかを指定します。
9. そのジョブを作成したユーザーのみがタスクを実行する場合は、**プライベート** オプションを **はい** に設定します。 このオプションは、クライアントタスクにのみ適用されます。
10. 選択したタスクの実行がそのジョブの先行タスクのステータスに依存すべき場合は、**制約** タブで、**新規** を選択します。
11. **タスク ID** フィールドで、先行タスクを選択します。
12. **予定されたステータス** フィールドで、現在のタスクを実行する前に先行タスクが到達する必要があるステータスを選択します。
13. **保存** を選択します。

    > [!NOTE]
    > 複数の条件 / 制約を入力した場合、依存タスクが実行できる前にすべての条件が満たされている必要がある場合は、条件タイプとして **すべて** を選択します。 いずれかの条件が満たされた後で依存タスクを実行できる場合は、条件タイプとして **任意** を選択します。

14. バッチ タスクが入力パラメーターに対応している場合は、 **パラメーター** を選択し、続いてタスク固有のパラメーターを設定します。
15. **OK** を選択してから、**保存** を選択します。

## <a name=""></a><a name="reserved">バッチに特化したキャパシティ レベルの設定</a>

1. **システム管理** \> **設定** \> **システム パラメーター** に移動します。
2. **バッチ グローバル 設定** タブの **バッチ専用のキャパシティ レベル** フィールドで、 **専用キャパシティ** の優先度を持つバッチジョブ 専用のキャパシティ レベルを選択します。

    - **専用キャパシティなし** – この値が既定の値となります。
    - **専用キャパシティ低** – 累積するバッチ スレッドの 10パーセントがバッチ処理に割り当てられます。
    - **専用キャパシティ中** – 累積するバッチスレッドの 15パーセントがバッチ処理に割り当てられます。
    - **専用キャパシティ高** – 累積するバッチスレッドの 25パーセントがバッチ処理に割り当てられます。

    > [!NOTE]
    > サンプルの値は、わかりやすい事例を示しています。 実際に割り当てられるキャパシティは、バッチサーバの設定と、任意時点で使用可能となるバッチスレッドの数によって異なります。

3. **保存** を選択します。

> [!NOTE]
> 専用キャパシティは、 **専用キャパシティ** 優先度を持つバッチジョブのみに特化しています。 専用キャパシティは、未使用の専用キャパシティがあった場合でも、その他の 優先度が割り当てられているバッチジョブには利用できません。

**期限切れのバッチレコードを削除するシステムジョブ** は、新規の内部システム向けのバッチジョブで、新たな BatchHeartbeatTable テーブルを削除します。 このバッチジョブのクラス名は、 **SysCleanupBatchHeartbeatTable** です。 BatchHeartbeatTable は 内部を監視するテーブルで、使用中のノードのスレッドのキャパシティを決定、設定や分配します。

## <a name=""></a><a name="automatic">バッチジョブをバッチグループへ自動移行する</a>

この機能が有効化されると、タスクのバッチ グループ情報は、使用されるジョブへと複製されます。 ジョブのバッチグループへの割り当ては、ジョブのタスクで最も使用されるバッチグループを基準に決定されます。

新規のバッチジョブ、 **バッチ グループの関連付けをバッチ ジョブに設定するシステム ジョブ** が移行の管理をします。 このバッチジョブのクラス名は、 **SysMigrateBatchGroupsForPriorityBasedScheduling** です。

このバッチジョブは毎日 1:00 AM に起動し、 **スケジュール設定に基づいたバッチ処理優先度** 機能が無効となっていても起動します。 最終実行時以降の、適用可能となるバッチ ジョブの差分を移行します。

この機能を有効にすると、バッチジョブが実行され、最終実行時以降のバッチジョブが移行されます。 この機能を有効にしたユーザーには、移行バッチ ジョブの ID への参照を含む通知が送信されます。

この機能を有効化して移行が完了したら、自動バッチグループへの割り当てを確認することを推奨します。 この確認作業を容易にする目的で、タスクの **バッチグループ** フィールドは読み取り専用になっています。 下位互換性に対応するため、このフィールドの値は、新たなバッチタスクが追加された際にジョブから反映されます。
