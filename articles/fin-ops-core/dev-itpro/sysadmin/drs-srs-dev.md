---
title: 開発者向け間データ共有
description: この記事では、開発者向け会社間データ共有について説明します。 これは、展開において、参照およびグループ データを会社間で共有するためのメカニズムです。
author: ramasri
ms.date: 02/16/2022
ms.topic: article
ms.technology: ''
ms.search.form: SysDataSharingConfiguration
audience: IT Pro
ms.reviewer: tfehr
ms.custom: 89071
ms.assetid: 0bbe7453-624f-4551-a1d0-842484067311
ms.search.region: Global
ms.author: ramasri
ms.search.validFrom: 2022-01-27
ms.dyn365.ops.version: Platform update 1
ms.openlocfilehash: bf7b07d287588d4e03029ac9b3cf6e3e92b6bedf
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/03/2022
ms.locfileid: "8854575"
---
# <a name="cross-company-data-sharing-for-developers"></a>開発者向け間データ共有

[!include [banner](../includes/banner.md)]

この記事では、開発者向け会社間データ共有について説明します。 会社間データ共有は、展開において、参照およびグループ データを会社間で共有するためのメカニズムです。

## <a name="enable-a-table-for-cross-company-data-sharing"></a>会社間データ共有のテーブルを有効にする 

データ共有用のテーブルを有効にするには 2 つのステップがあり、テーブルのメタデータ プロパティの更新が必要になります。 会社間データ共有のカスタム テーブルを有効にするには、以下の手順を実行します。 

1.  テーブルのプロパティを開き、**データ共有タイプ** プロパティを **単一** または **重複** に設定します。 **単一** は、単一レコード共有 (SRS) を意味し、**重複** は、重複レコード共有 (DRS) を意味します。

2.  テーブルの各フィールドについて、**単一データの共有タイプ** のメタデータ プロパティを確認する必要があります。 **常時** は既定値であり、フィールドが常に共有されることを意味します。 **なし** は、フィールドが共有されないことを意味します。 現在、関連するロジックがないので、**オプション** は選択しないでください。

> [!NOTE]
> -   テーブルが **重複** に設定されている場合、DRS と SRS の両方のポリシーに参加できます。
> - テーブルが **単一** に設定されている場合、SRS ポリシーにのみ参加できます。
> - テーブル プロパティを **重複** に設定した場合、**単一** に変更することはできません。 テーブルを使用する DRS ポリシーが有効ではなくなるため、これは重大な変更と見なされます。
> - SRS を使用する場合、**なし** に設定されているフィールドは、すべての子会社のフィールド タイプの既定値を取得します。 子会社のこれらのフィールドが別の値を含むように更新することはできません。 たとえば、整数/実数は 0 の値を含み、文字列は空になり、列挙型は拡張可能かどうかに基づいて未確定になります。

## <a name="how-does-it-work"></a>どのような仕組みですか?

テーブルがデータ共有に対して有効になっている場合、カーネル ロジックは、"\<tablename\>_SharingView" という名前のビューを自動的に作成します。 このビューは、共有データへの非カーネル ベースのアクセスに使用する必要があります。

次の例では、**CustGroup** テーブルがデータ共有に対して有効であり、**USMF** がマスター会社として、**CH1** および **CH2** が子会社として選択されています。
CustGroup (物理的) および CustGroup_SharingView からレコードを読み取る場合、出力は次のようになります。 (*ビュー* はカーネル ロジックを示しますが、非カーネル ベースのシナリオに対してのみ使用されます)

![単一レコード共有の例。](media/SRS-image3.png)

## <a name="guidelines-to-enable-data-sharing-on-tables"></a>テーブルでのデータ共有を有効にするためのガイドライン
DRS または SRS の設定を定義または変更する機能は、現在のモデルによって提供される基本テーブルに対して適用されます。 たとえば、拡張子を使用する既存のデータ共有テーブルまたはフィールドのプロパティを変更することはできません。

会社固有のテーブルにおいて、**データ共有タイプ = 単一** の場合は、既に SRS に対して評価されていることを意味します。 **重複** または **なし** に戻すことはできません。

会社固有のテーブルにおいて、**データ共有タイプ = 重複** の場合は、既に DRS に対して評価されていることを意味します。 SRS に対して有効にする場合、プロパティを **単一** に変更する前に、その機能の適格性を評価する必要があります。

会社固有のカスタム テーブルにおいて **データ共有タイプ = なし** であるが、データ共有タイプを有効にする場合の推奨事項は、可能であれば DRS に対して有効にすることです。 DRS テーブルは、DRS および SRS の両方のポリシーに参加することができるので、共有タイプを DRS にできない場合があります。 適切な設定を決定するには、次の情報を使用します。

+ 会社固有のテーブルに一意なインデックスまたは代替キーがある場合、DRS を適用します。
    +   テーブルに外部キー フィールドがあり、対応するテーブルが **データ共有タイプ = なし** に設定されている場合、そのフィールドの **単一データの共有タイプ** プロパティを **なし** に設定します。
    +   テーブルに代理外部キー フィールドがある場合、そのフィールドの **単一データの共有タイプ** プロパティを **いいえ** に設定します。
    +   テーブル フィールドが制限セクションの下にあるテーブルのいずれかを参照している場合、**単一データ共有タイプ** プロパティを **なし** に設定します。

+ 会社固有のテーブルに一意なインデックスまたは代替キーがない場合、SRS を適用します。
    +   テーブルに外部キー フィールドがあり、対応するテーブルが **データ共有タイプ = なし** に設定されている場合、そのキー フィールドの **単一データの共有タイプ** プロパティを **なし** に設定します。
    +   テーブルに代理外部キー フィールドがある場合、そのフィールドの **単一データの共有タイプ** プロパティを **いいえ** に設定します。
    +   テーブル フィールドが制限セクションの下にあるテーブルのいずれかを参照している場合、**単一データ共有タイプ** プロパティを **なし** に設定します。

> [!NOTE]
> 会社間共有ポリシー シミュレーターは、各フィールドに関連付けられたテーブル参照と共に、テーブルとそのフィールドの適格性を検出します。

データ共有メタデータ プロパティを変更した後、DB の完全な同期を行って、_SharingView の作成または更新を行う必要があります。

**会社ごとにデータを保存** プロパティが **はい** に設定されているテーブルでは、データ共有が適用されます。 **会社ごとにデータを保存** が **いいえ** に設定されたテーブルはグローバルであり、追加の共有コンフィギュレーションの必要はありません。

開発の観点からは、テーブルの主キーおよび代替キーを参照して共有タイプを決定するのは十分ではありません。 データの問題を引き起こさずに共有を有効にするには、追加の作業が必要となることがあります。


<table>
<thead>
<tr class="header">
<th>メソッド/メタデータ</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="1">
<td>リレーションシップ
<ul>
<li>代替キー</li>
<li>国外</li>
<li>共有タイプ (テーブルおよびフィールド)</li>
<li>DeleteActions (制限付き/カスケード)</li>
</ul>
</td>
<td><ul>テーブルとフィールドを共有する必要がある場合にチェックします。 また、テーブルとフィールドの SRS 共有に対して DRS の影響があるかどうかを決定します。</ul>
</td>
</tr>
<tr class="2">
<td>メソッドの検証
<ul>
<li>validateDelete</li>
<li>validateInsert</li>
<li>validateWrite</li>
<li>validateField</li>
<li>validateFieldValue</li>
</ul>
</td>
<td><ul>ロジックは、トランザクションのように共有されていないテーブルを参照する場合があるので、会社間でロジックを処理するにはリファクタリングが必要です。</ul>
</td>
</tr>
<tr class="3">
<td>既定
<ul>
<li>initValue</li>
<li>defaultField</li>
</ul>
</td>
<td><ul>既定で実行されるロジックを確認します。多くの場所の値は、非共有テーブルから初期化され、作成された会社レコードに応じてレコードが別の方法で初期化されます。 </ul>

<ul>テーブル間で共有され、検証に使用されるフィールドなど、モデル化されていないデータの依存関係があるのか。 ProjCategory と ProjCategoryGroup には、CategoryType フィールドがあります。 プロジェクト カテゴリと割り当てられたグループの値が同じというコード レベルの検証があります。 フィールドがポリシー更新に含まれていない場合、プロジェクト カテゴリは検証チェックが原因で失敗します。</ul>
</td>
</tr>
<tr class="4">
<td>CRUD メソッド
<ul>
<li>削除</li>
<li>insert</li>
<li>更新</li>
<li>write</li>
</ul>
</td>
<td><ul>データの依存関係がモデル化されていないか?
データ モデルの決定のため、テーブル メタデータの、日付の保存の会社のプロパティがいいえに設定されることがあります。
<li>これらのテーブルはデータ共有テーブルにどのように関連しているのか?</li>
<li>テーブルには、代替フィールドとして DataAreaId が含まれています。
(例: InventItemGroupItem > InventItemGroup)</li>
<li>コードは、この会社間のようにテーブル入力を処理するにはコードが必要です。</li>
 </ul>
</td>
</tr>
<tr class="5">
<td>オーバーロードのフィールド値を使用したデザイン パターン。</td>
<td><ul>一部のテーブルでは、関係を示す 2 つの対になるフィールドのパターンが存在します。 最も一般的な使用は、転記プロファイルです。 列挙型フィールドが表示され、次に参照テーブルの代替キーを表すフィールドが表示されます。 たとえば、ProjPosting テーブルには、列挙型の TableGroupAll から派生した ProjCode フィールドと、ProjTable、ProjGroup からのナチュラル キーを保存する関連フィールドの ProjRelationship があるか、空になります。 このパターンを持つテーブルは共有可能である場合がありますが、ポリシーに含める必要があるすべての関連テーブルおよびフィールドについて、明確なドキュメントを用意する必要があります。</ul>
</td>
</tr>
    <tr class="6">
<td>LedgerDimensionDefaultAccount</td>
<td><ul>これを使用するテーブルは、通常、主勘定の値への参照が格納されます。 これらは共有できません。</ul>
</td>
</tr>
    <tr class="7">
<td>番号順序</td>
<td><ul>通常、番号順序は会社ごとに設定されます。 それらを使用する既定のロジック フィールドは、コード変更なしでは動作しない可能性があります。</ul>
</td>
</tr>
</tbody>
</table>

**SysDataSharingPolicy** テーブルの **SysDataSharingCrossCompanyValidator** クラス、**SysDataSharingCrossCompanyValidatorQueryBuilder** クラス、およびメソッドは、テーブルがデータ共有ポリシーで使用されているかどうかを判断するために使用できます。 通常、これらは、テーブルの依存関係を処理するために、CRUD およびロジックの既定のメソッドで使用されます。
