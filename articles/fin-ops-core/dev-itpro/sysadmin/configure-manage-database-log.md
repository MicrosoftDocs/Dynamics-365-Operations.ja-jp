---
title: データベース ログの構成
description: このトピックでは、データベース ログの設定方法、セキュリティとパフォーマンスの管理方法、およびデータベース ログのクリーンアップ方法について説明します。
author: hasaid
manager: AnnBe
ms.date: 03/11/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: IT Pro
ms.reviewer: kfend
ms.custom: 57201
ms.assetid: 22a56b7d-4e07-4161-8416-0cac4a0b65a2
ms.search.region: Global
ms.author: peakerbl
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: df1c7c0c8b9a09d75a7617967db1c7ab55253c18
ms.sourcegitcommit: f8bac7ca2803913fd236adbc3806259a17a110f4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2021
ms.locfileid: "5128553"
---
# <a name="configure-database-logging"></a>データベース ログの構成

[!include [banner](../includes/banner.md)]

データベース ログを使用すると、Finance and Operations アプリで、テーブルとフィールドに対する特定のタイプの変更を追跡できます。 追跡可能な変更には、挿入、更新、削除、名前変更の各キー操作が含まれます。 テーブルまたはフィールドのログを設定すると、そのテーブルまたはフィールドに対するすべての変更のレコードが、環境データベースのデータベース ログ テーブル **sysdatabaselog** に格納されます。

データベース ログは、次の目的で使用することができます。

- 機密情報を含む特定のテーブルへの変更を監査可能な形で生成します。
- 電子署名の使用を監視します。 既定では、電子署名を使用して署名されたすべての取引が記録されます。

データベース ログは、個々の取引を追跡することを目的としています。 バッチ ジョブが実行する、自動化された取引を追跡するためのものではありません。

## <a name="security-for-database-logging"></a>データベース ログのセキュリティ

データベース ログには機密データが含まれている場合があります。 既定では、データベースへのアクセス権を持つユーザーは、X ++ やは警告を使用するか、データベースを直接照会することにより、データベース ログのテーブルは、 (**sysdatabaselog**) を照会できます。 データを保護するには、オンプレミス配置で使用する **sysdatabaselog** テーブルのアクセス権限を制限する必要があります。

## <a name="database-logging-and-performance"></a>データベース ログとパフォーマンス

データベースのログは業務の観点から見ると便利ですが、リソースの使用と管理に関しては費用がかさむ場合があります。 ここでは、データベース ログのパフォーマンスにがおよぼす影響について説明します。

- データベース ログのテーブルは、データ量が増大するペースが速く、データベースのサイズが増大する場合があります。 増加の程度は、保持するログに記録されたデータ量によって異なります。
- 取引タイプのログの記録がオンになっている場合、当該取引タイプの各インスタンスが Microsoft SQL Server のトランザクション ログファイルに複数のレコードを書き込みます。 具体的には、最初の取引に対して 1 つのレコードを書き込み、また別のレコードがデータベース ログのテーブルに取引を記録します。 したがって、取引のログ ファイルはより速く増大し、追加の保守作業が必要となる場合があります。
- データベースのログは、在庫の原価計算、部品表 (BOMs)、マスタープラン、長期にわたるデータ インポートなどの時間がかかる自動化プロセスに悪影響を与える可能性があります。
- テーブルのログがオンになっている場合、すべてのセットベースのデータベース操作は、行ベースの操作へとダウン グレードされます。 たとえば、テーブルへの挿入処理のログを記録している場合、各挿入は行ベースの挿入として実行されます。

ここでは、マイクロソフトが推奨するいくつかの方法を示します。

- ログに記録されたデータを保持する期間、およびデータをアーカイブまたは削除方法に関する計画を作成します。
- ログのエントリを制限し、パフォーマンスを改善するには、テーブル全体ではなく、ログを記録するフィールドを個別に選択します。

    > [!NOTE]
    > 個々のフィールドでは、更新処理のログのみを記録できます。

- データベース ログの構成後は、SQL Server の取引ログのバックアップ頻度を増やすことを検討してください。

    > [!NOTE]
    > この推奨事項は、SQL Server のローカル インスタンスを持つオンプレミス型の展開にのみ適用されます。

## <a name="set-up-database-logging"></a>データベース ログの設定

**ログ データベースの変更** ウィザードを使用して、データベースのログを設定できます。 このウィザードを使用すると、テーブルやフィールドのログを柔軟に設定することができます。

1. **システム管理** \> **設定** \> **データベース ログ** \> **データベース ログの設定** に移動します。
2. **新規** を選択して、**ログ データベースの変更** ウィザードを開きます。
3. ウィザードの操作を完了します。

## <a name="clean-up-database-logs"></a>データベース ログのクリーン アップ

データベース ログは必要に応じて削除できます。 特定のテーブルのログを削除したり、特定のタイプのデータベース ログを削除するなど、作成された日時に基づいてログを削除したりすることができます。

> [!NOTE]
> 電子署名されたレコードは、ログから削除できません。

1. **システム管理** \> **問い合わせ** \> **設定** \> **データベース ログ** に移動します。
2. **ログのクリーンアップ** を選択します。
3. 削除するログを選択するにあたって使用するメソッドを選択します。 ログの参照先のテーブル ID、ログのタイプ、作成日時を入力します。
4. **データベース ログのクリーンアップ** タブを使用して、ログのクリーンアップ タスクを実行するタイミングを指定します。

## <a name="consistency-check-for-database-log-triggers"></a>データベース ログ トリガーの整合性チェック

プラットフォーム更新プログラム 34 では、整合性チェックをする機能が追加されました。 整合性チェックは、**データベースログ** ウィザードの一環として実行されます。 **完了** を選択した後、**データベース ログの設定** ページの **整合性チェック** を選択した後に実行されます。

整合性チェックでは、不足しているデータベース ログのトリガーが再作成されます。 また、対応する構成が見つからない孤立したデータベース ログのトリガーも削除されます。 整合性チェックでは、このように現在の構成と、ログ機能の実装に使用するデータベース トリガーとの間に不整合がある場合は、ただちにそれを検出して修正します。

1. **システム管理** \> **問い合わせ** \> **設定** \> **データベース ログ** に移動します。
2. **データベース ログ** のページで、 **整合性チェック** を選択します。
