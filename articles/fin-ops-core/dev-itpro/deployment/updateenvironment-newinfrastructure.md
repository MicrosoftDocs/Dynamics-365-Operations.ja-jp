---
title: 環境の更新
description: このトピックでは、セルフ サービス配置エクスペリエンスを使用して配置された環境を、更新する方法について説明します。
author: laneswenka
ms.date: 06/08/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Developer
ms.reviewer: sericks
ms.custom: ''
ms.search.region: Global
ms.author: laswenka
ms.search.validFrom: 2018-12-31
ms.dyn365.ops.version: 8.1.1
ms.openlocfilehash: 69f0d69f95f311af83f3b25d5707a8071c72a1a5d85584f1f5d51334e777abb6
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/05/2021
ms.locfileid: "6763502"
---
# <a name="update-an-environment"></a>環境の更新

[!include [banner](../includes/banner.md)]
[!include [banner](../includes/limited-availability.md)]

このトピックでは、[セルフサービス配置](infrastructure-stack.md) エクスペリエンスを使用して配置した環境に、更新を適用するプロセスについて説明します。

> [!IMPORTANT]
> 次世代のインフラストラクチャでは、現在のフローで適用されるものとは異なる方法で更新が適用されます。 *パッケージに含まれているものはすべて環境に適用され、既に環境に存在するものはすべて **上書き** されます。* つまり、ビルド環境からのすべてのカスタマイズおよび独立系ソフトウェア ベンダー (ISV) ソリューションを含む 1 つの配置可能パッケージを作成する **必要があります**。 環境内のモデルの一覧がパッケージ内のモデルの一覧と異なる場合は、更新が適用される前に警告が表示されます。 単一のパッケージを作成する方法については、[ソース コントロールを使用することでサード パーティ モデルとランタイム パッケージを管理する](../dev-tools/manage-runtime-packages.md)を参照してください。

## <a name="supported-package-types"></a>サポートされているパッケージの種類

[セルフサービス配置](infrastructure-stack.md) エクスペリエンスを使用して配置される環境は、バージョン8.1 (2018 年 10 月) 以降のバージョンで実行されるため、次のパッケージ タイプがサポートされます。

- **AOT の配置可能パッケージ** - アプリケーション メタデータおよびソース コードから生成される配置可能なパッケージ。 このタイプの展開可能なパッケージは、**ビルド** 環境で作成されます。
- **バイナリ更新プログラム パッケージ** - ダイナミック リンク ライブラリ (DLL) と、プラットフォームとアプリケーションが依存するその他のバイナリとメタデータを含む配置可能パッケージ。 このタイプのパッケージは、Microsoft によってリリースされています。

## <a name="development-application-lifecycle-management-alm-flow"></a>開発アプリケーション ライフ サイクル管理 (ALM) フロー

コード カスタマイズをサンドボックスおよび製造環境に適用するには、ビルド環境から配置可能なコード パッケージを作成する必要があります。 詳細については、[配置可能パッケージの作成](create-apply-deployable-package.md)を参照してください。

## <a name="microsoft-updates"></a>Microsoft の更新プログラム

Microsoft の更新プログラムへのアクセスを取得するには、 Microsoft Dynamics Lifecycle Services (LCS) 環境の環境詳細ページに移動します。 すべてのアプリケーションとプラットフォーム修正の累積的なバイナリ更新を示す **1 つのタイル** が表示されます。 この更新プログラムを適用するには、パッケージを選択して、 **パッケージの保存** を選択し、プロジェクト アセット ライブラリに Microsoft の更新プログラムを保存します。

## <a name="apply-updates"></a>更新プログラムの適用

### <a name="tier-1-sandboxdevelop-and-testdemobuild-environments"></a>レベル 1 サンドボックス/開発およびテスト/デモ/ビルド環境

Lifecycle Services (LCS) を通じて配置されたレベル 1 サンドボックス/開発およびテスト/デモ/ビルド環境に更新を適用するには、[クラウド環境に更新を適用する](apply-deployable-package-system.md)の手順に従います。

### <a name="tier-2-and-above-standard-acceptance-testsandbox-environments"></a>レベル 2 以上のスタンダード承認テスト/サンドボックス環境

> [!IMPORTANT]
> パッケージ アプリケーションは、システムのダウンタイムを引き起こします。 すべて関連するサービスを停止、およびパッケージを適用中のときには環境を使用できなくなります。

開始する前に、配置可能パッケージが LCS のプロジェクト アセット ライブラリにアップロードされており、検証が成功したことを確認してください。

パッケージが、プロジェクト アセット ライブラリに入ったら、以下の手順に従って、環境を更新します。

1. パッケージを適用する環境の環境の詳細ページを開きます。
2. **メンテナンス \> 更新プログラムの適用** を選択し、更新プログラムを適用します。
3. 更新プログラムに対して **一意の名前** を入力します。 この名前は、実稼働環境に移動する更新を識別するために使用します。
4. パッケージを選択して適用します。 上部にあるフィルターを使用してパッケージを探します。 このリストには、アセット ライブラリから検証に合格したアプリケーションおよびプラットフォーム バイナリ パッケージと、アプリケーション配置可能パッケージが含まれます。
5. **適用** を選択します。

    環境詳細ページの右上隅にあるステータスが、 **キュー** から **サービス** に変わります。 その後、パッケージ アプリケーションが完了すると、ステータスが **配置済み** に変更されます。

6. パッケージ アプリケーションが完了すると、環境履歴が更新されます。 環境履歴を表示するには、環境の詳細ページで **履歴 \> 環境の変更** を選択します。
7. 環境履歴ページからログをダウンロードすることもできます。
8. 検証が完了すると、 **サインオフ** または **払出サイン オフ** のいずれかを選択して、環境の履歴ページから更新プログラムをサインオフできます。

### <a name="production-environment"></a>実稼働環境
運用環境に適用される更新プログラムの信頼性を向上させるために、サンドボックス環境で実行される特定の更新プログラムを **リリース候補** として指定 ("マーク") し、実稼働環境に移動します。 この更新プログラムには、基本製品 (リリース 10.0.19 のような) とカスタマイズの両方が含まれています。 したがって、選択した更新プログラムを実稼働環境に適用したときに、両方が移動します。 この動作は、Microsoft 管理環境の動作とは異なります。 セルフサービス配置環境では、サンドボックス環境でリリース候補としてマークされている更新によって、基本製品バージョンが **変わる場合があります**。 セルフサービス環境での **リリース候補** はその時点でのサンドボックス環境を構成するすべてのコードのスナップショットであり、その後実稼働環境に移動します。

> [!IMPORTANT]
> パッケージ アプリケーションは、システムのダウンタイムを引き起こします。 すべて関連するサービスを停止、およびパッケージを適用中のときには環境を使用できなくなります。

サンドボックス環境での更新プログラムの適用が成功し、更新プログラムを実稼働環境に移行する準備ができたら、次の手順に従って、更新をリリース候補としてマークします。

1. 環境履歴ページを開くには、環境の詳細ページで **履歴 \> 環境の変更** を選択します。
2. 実稼働環境に移動するため更新プログラムを選択します。
3. 更新プログラムの詳細で、 **リリース候補としてマーク** を選択します。

    **リリース候補** オプションが **はい** に設定されています。

更新プログラムをリリース候補としてマークしたら、次の手順に従って環境を更新します。

1. 実稼働環境の環境の詳細ページを開きます。
2. **メンテナンス \> 更新プログラムの環境** を選択し、更新プログラムを適用します。
3. **使用可能なサンドボックス** の一覧で、更新プログラムが適用され、検証されて、リリース候補としてマークされているソースサンドボックス環境を選択します。
4. グリッドで、実稼働環境に適用する更新プログラムを選択します。 このグリッドには、リリース候補としてマークされている更新プログラムのみが表示されます。
5. **ダウンタイム開始** フィールドで、日付と時刻を入力します。 環境は、指定された日の指定された時間に停止されます。 **ダウンタイム終了** は、予定された期間に基づいて自動的に計算されます。

    この更新プログラムにはリードタイムは必要ありません。

6. **スケジュール** を選択します。 LCSは、選択された更新プログラムが環境に適用可能であることを確認する検証を実行します。 環境のダウングレードを回避するために、更新プログラムは、そのアプリケーションのバージョンが現在の環境のバージョンよりも低い場合は許可されません。 また、更新プログラムを続行するかどうかを確認するメッセージが表示されます。

    更新プログラムが **正常に** スケジュールされると、すべてのプロジェクト関係者に電子メール通知が送信されます。

    環境詳細ページの右上隅にあるステータスが、 **キュー** から **サービス** に変わります。 その後、更新プログラムが完了すると、ステータスが **配置済み** に変更されます。

    すべての関係者に、工程の進捗状況が通知されます。

7. 更新プログラムが完了すると、環境履歴が更新されます。 環境履歴を表示するには、環境の詳細ページで **履歴 \> 環境の変更** を選択します。
8. 環境履歴ページからログをダウンロードすることもできます。
9. 検証が完了すると、 **サインオフ** または **払出サイン オフ** のいずれかを選択して、環境の履歴ページから更新プログラムをサインオフできます。

> [!NOTE]
> 環境内で進行中の操作がある場合、または環境が同じバージョンまたはそれ以降のバージョンで既に実行されている場合、スケジュールされた更新は取り消されます。 予定された更新プログラムがキャンセルされると、すべてのプロジェクト関係者に電子メール通知が送信されます。 また、環境の詳細 ページで **キャンセル** を選択することにより、更新プログラムを取り消すこともできます。 顧客が更新を再スケジューリングしたり変更したりする場合は、現在の工程をキャンセルして、新しい更新をスケジュールすることができます。

> 最新のインフラストラクチャ スタックに配置されている環境では、サービスが失敗した場合、その環境は自動的にロールバックされます。 工程が失敗した理由については、環境履歴ページからログをダウンロードできます。


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
