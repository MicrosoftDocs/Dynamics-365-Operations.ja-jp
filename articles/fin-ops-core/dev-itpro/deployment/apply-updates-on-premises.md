---
title: オンプレミス配置への更新プログラムの適用
description: このトピックは、Dynamics 365 Finance + Operations (オンプレミス) 用にサポートされる更新を適用する方法を説明します。
author: manalidongre
manager: AnnBe
ms.date: 09/20/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.scope: Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: sarvanis
ms.search.validFrom: 2017-06-30
ms.dyn365.ops.version: Platform update 12
ms.openlocfilehash: 9cd1132136f94d500eaceaf9198086a8d5173796
ms.sourcegitcommit: fbc106af09bdadb860677f590464fb93223cbf65
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/06/2019
ms.locfileid: "2769623"
---
# <a name="apply-updates-to-on-premises-deployments"></a><span data-ttu-id="9cc12-103">オンプレミス配置への更新プログラムの適用</span><span class="sxs-lookup"><span data-stu-id="9cc12-103">Apply updates to on-premises deployments</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="9cc12-104">このトピックは、Dynamics 365 Finance + Operations (オンプレミス) 用にサポートされる更新を適用する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-104">This topic explains how to apply supported updates to Dynamics 365 Finance + Operations (on-premises).</span></span> <span data-ttu-id="9cc12-105">設置型環境でのすべての更新は Microsoft Dynamics Lifecycle Services (LCS) を通じて行われます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-105">All updates to on-premises environments are done through Microsoft Dynamics Lifecycle Services (LCS).</span></span>

## <a name="search-for-and-download-updates"></a><span data-ttu-id="9cc12-106">更新プログラムの検索とダウンロード</span><span class="sxs-lookup"><span data-stu-id="9cc12-106">Search for and download updates</span></span>
<span data-ttu-id="9cc12-107">オンプレミス環境に適用できる更新プログラムを検索する方法の詳細については、[Lifecycle Services (LCS) での問題検索](../lifecycle-services/issue-search-lcs.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-107">For more information about how to find the updates that you can apply to your on-premises environment, see [Issue search in Lifecycle Services (LCS)](../lifecycle-services/issue-search-lcs.md).</span></span> <span data-ttu-id="9cc12-108">LCS の**環境の詳細**ページの**更新**セクションで、タイルから更新プログラムをダウンロードする方法の詳細については、[Lifecycle Services (LCS) から更新プログラムをダウンロード](../migration-upgrade/download-hotfix-lcs.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-108">For information about how to download updates from the tiles in the **Updates** section of the **Environment details** page in LCS, see [Download updates from Lifecycle Services (LCS)](../migration-upgrade/download-hotfix-lcs.md).</span></span>
   
> [!NOTE]
> <span data-ttu-id="9cc12-109">オンプレミス環境を更新するときは、常に**環境** 詳細ページの更新タイルから更新プログラムを選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-109">When you are updating an on-premises environment, always select updates from the update tiles on the **Environment** details page.</span></span> <span data-ttu-id="9cc12-110">別の場所からの更新を選択した場合、更新が機能しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-110">If you select updates from another location, the updates might not work.</span></span> 

## <a name="update-an-on-premises-deployment"></a><span data-ttu-id="9cc12-111">オンプレミス配置の更新</span><span class="sxs-lookup"><span data-stu-id="9cc12-111">Update an on-premises deployment</span></span>
<span data-ttu-id="9cc12-112">展開中または展開の完了後のいずれかのオンプレミス環境に対して、更新プログラムを適用することができます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-112">You can apply updates to an on-premises environment either during deployment or after the deployment is completed.</span></span>

<span data-ttu-id="9cc12-113">オンプレミス環境が展開されているときは、カスタム パッケージの展開を **詳細** 設定で選択することができます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-113">While an on-premises environment is being deployed, you can select to deploy a custom package in the **Advanced** settings.</span></span> <span data-ttu-id="9cc12-114">カスタマイズまたはアプリケーション X++ の更新を適用する方法の詳細については、[カスタム モデルの開発とオンプレミス環境への配置](develop-deploy-custom-models-on-premises.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-114">For more information about how to apply customizations or application X++ updates, see [Develop and deploy custom models to on-premises environments](develop-deploy-custom-models-on-premises.md).</span></span>

<span data-ttu-id="9cc12-115">オンプレミス環境の展開後にオンプレミス環境に更新を適用するには、環境の **環境の詳細** ページにある **管理** で **更新プログラムを適用** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-115">To apply updates to an on-premises environment after it has been deployed, in LCS, on the **Environment details** page for the environment, under **Maintain**, select **Apply updates**.</span></span>

> [!NOTE]
> <span data-ttu-id="9cc12-116">Finance and Operations 用プラットフォーム更新プログラム 12 以降の環境でのみ、展開後に更新プログラムを適用することができます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-116">You can apply updates after deployment only on environments that have Platform update 12 for Finance and Operations or later.</span></span> <span data-ttu-id="9cc12-117">環境には、LCS で使用可能なローカル エージェントの最新バージョンも必要です。</span><span class="sxs-lookup"><span data-stu-id="9cc12-117">The environment must also have the latest version of the local agent available in LCS.</span></span> <span data-ttu-id="9cc12-118">詳細については、「[ローカル エージェントの更新](../lifecycle-services/update-local-agent.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-118">For more information, see [Update the local agent](../lifecycle-services/update-local-agent.md).</span></span> <span data-ttu-id="9cc12-119">プラットフォーム更新プログラム 12 よりも古いプラットフォームのバージョンを使用している場合は、すでに展開されている環境を再構成して、カスタマイズを更新したり、最新のプラットフォーム リリースに更新したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-119">If you're on a platform version that is older than Platform update 12, you can reconfigure an environment that is already deployed to update the customizations or update to the latest platform release.</span></span> <span data-ttu-id="9cc12-120">環境を再配置する方法の詳細については、 [オンプレミス環境の再配置](redeploy-on-prem.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-120">For more information about how to redeploy an environment, see [Redeploy on-premises environments](redeploy-on-prem.md).</span></span>

## <a name="apply-application-or-binary-updates-through-lcs"></a><span data-ttu-id="9cc12-121">アプリケーションまたは LCS を通じてバイナリ更新プログラムを適用します</span><span class="sxs-lookup"><span data-stu-id="9cc12-121">Apply application or binary updates through LCS</span></span>
<span data-ttu-id="9cc12-122">次の手順を使用して、X++、すべてのバイナリ、またはプラットフォーム バイナリの更新プログラムを適用できます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-122">The following steps can be used to apply X++, All Binary, or Platform bianry updates.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="9cc12-123">更新のアプリケーションには、環境のダウンタイムが必要です。</span><span class="sxs-lookup"><span data-stu-id="9cc12-123">The application of updates requires downtime for your environment.</span></span> <span data-ttu-id="9cc12-124">したがって、更新中に環境内でビジネス トランザクションを実行することはできません。</span><span class="sxs-lookup"><span data-stu-id="9cc12-124">Therefore, no business transactions can be performed in the environment during the update.</span></span> <span data-ttu-id="9cc12-125">次の手順を完了したら、システムが使用されていないことと、公式ダウンタイム通知システムがすべてのシステム ユーザーに通知済みであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-125">When you complete the following steps, verify that the system isn't being used, and that an official downtime notice has been communicated to all system users.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9cc12-126">最新のプラットフォームに移動するには、常に、**環境**詳細ページの**プラットフォーム バイナリ更新プログラム**タイルからプラットフォーム更新プログラムを選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-126">To move to the latest platform, always select the platform update from the **Platform Binary Updates** tile on the **Environment** details page.</span></span> <span data-ttu-id="9cc12-127">別の場所からの更新を選択した場合、更新が機能しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-127">If you select updates from another location, the updates might not work.</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="9cc12-128">前提条件</span><span class="sxs-lookup"><span data-stu-id="9cc12-128">Prerequisites</span></span>
- <span data-ttu-id="9cc12-129">開始する前に、Management Reporter (MR)、Microsoft Dynamics AX、および Microsoft SQL Server Reporting Services (SSRS データベース) の完全バックアップを完了してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-129">Before you begin, complete a full backup of the Management Reporter (MR), Microsoft Dynamics AX, and Microsoft SQL Server Reporting Services (SSRS databases).</span></span> <span data-ttu-id="9cc12-130">コードは LCS を通じて復元されますが、データが失われないよう保証するためにデータベースを手動で復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-130">Although the code is restored through LCS, the database must be manually restored to help guarantee that there is no data loss.</span></span>
- <span data-ttu-id="9cc12-131">環境をプラットフォーム更新プログラム 12 の最新ビルドに更新します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-131">Update your environment to the latest build of Platform update 12.</span></span>
- <span data-ttu-id="9cc12-132">ローカル エージェントを最新バージョンに更新します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-132">Update the local agent to the latest version.</span></span> <span data-ttu-id="9cc12-133">詳細については、「[ローカル エージェントの更新](../lifecycle-services/update-local-agent.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-133">For more information, see [Update the local agent](../lifecycle-services/update-local-agent.md).</span></span>
- <span data-ttu-id="9cc12-134">更新のタイプに応じて、以下の手順を実行して配置可能パッケージを生成します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-134">Depending on the type of update, complete the following steps to generate a deployable package:</span></span>

    - <span data-ttu-id="9cc12-135">**プラットフォーム バイナリ更新プログラム** – [Lifecycle Services (LCS) から更新プログラムをダウンロード](../migration-upgrade/download-hotfix-lcs.md) の手順に従って、LCS のアセット ライブラリに直接更新プログラムをダウンロードまたは保存します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-135">**Platform binary updates** – Download or save the update directly to the Asset library in LCS by following the steps in [Download updates from Lifecycle Services (LCS)](../migration-upgrade/download-hotfix-lcs.md).</span></span>
    - <span data-ttu-id="9cc12-136">**アプリケーション バイナリ更新プログラム** – [Lifecycle Services (LCS) から更新プログラムをダウンロード](../migration-upgrade/download-hotfix-lcs.md) の手順に従って、LCS のアセット ライブラリに直接更新プログラムをダウンロードまたは保存します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-136">**Application binary updates** – Download or save the update directly to the Asset library in LCS by following the steps in [Download updates from Lifecycle Services (LCS)](../migration-upgrade/download-hotfix-lcs.md).</span></span>
    - <span data-ttu-id="9cc12-137">**アプリケーションの X++ 更新** – 開発環境に必要な修正プログラムをダウンロードし、[配置可能なモデル パッケージの作成](create-apply-deployable-package.md) の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="9cc12-137">**Application X++ updates** – Download the required hotfix to your development environment, and then follow the steps in [Create deployable packages of models](create-apply-deployable-package.md).</span></span>
    - <span data-ttu-id="9cc12-138">**カスタマイズ** – [カスタム モデルの開発とオンプレミス環境への配置](develop-deploy-custom-models-on-premises.md) の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="9cc12-138">**Customizations** – Follow the steps in [Develop and deploy custom models to on-premises environments](develop-deploy-custom-models-on-premises.md).</span></span>

### <a name="update-a-sandbox-environment"></a><span data-ttu-id="9cc12-139">サンドボックス環境の更新</span><span class="sxs-lookup"><span data-stu-id="9cc12-139">Update a sandbox environment</span></span>
1. <span data-ttu-id="9cc12-140">LCS アセット ライブラリで、このトピックの「前提条件」のセクションで生成された配置可能パッケージを、 **ソフトウェア配置可能パッケージ**  タブにアップロードします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-140">In the LCS Asset library, upload the deployable package that was generated in the "Prerequisites" section of this topic to the **Software deployable packages** tab.</span></span>
2. <span data-ttu-id="9cc12-141">LCS で、オンプレミスの実装プロジェクト開き、更新する環境の**環境の詳細**ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-141">In LCS, open the on-premises implementation project, and then open the **Environment details** page of the environment to update.</span></span>
3. <span data-ttu-id="9cc12-142">**管理** で、**更新プログラムを適用** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-142">Under **Maintain**, select **Apply updates**.</span></span> <span data-ttu-id="9cc12-143">スライダーでは、アセット ライブラリにアップロードされた更新を表示します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-143">A slider shows the updates that were uploaded to the Asset library.</span></span> <span data-ttu-id="9cc12-144">アセット ライブラリで**有効**としてマークされているパッケージのみが表示されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-144">Note that only packages that are marked as **Valid** in the Asset library appear.</span></span>

<span data-ttu-id="9cc12-145">**ローカル エージェントのバージョン 2.1.0 以上を使用している場合は、以下の手順を実行する必要があります。**</span><span class="sxs-lookup"><span data-stu-id="9cc12-145">**If you are on local agent version 2.1.0 and higher, complete the following steps.**</span></span>
1. <span data-ttu-id="9cc12-146">更新プログラムを選択し、**準備**をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-146">Select the update, and then click **Prepare**.</span></span> <span data-ttu-id="9cc12-147">**準備**をクリックすると、サービスのオンプレミス環境を準備します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-147">Clicking on **Prepare** will prepare your on-premises environment for servicing.</span></span> 

    >[!NOTE]
    > <span data-ttu-id="9cc12-148">準備中、環境の状態は**配置済み**になりますが、配置ステータス フィールドは、準備の進行状況を表示します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-148">During preparation, the environment state will be **Deployed** but the Deployment status field will show the progress of Preparation.</span></span> <span data-ttu-id="9cc12-149">パッケージを書式設定しパッケージをダウンロードするなどの手順は、準備中に実行されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-149">Steps such formatting the package and downloading the package are executed during preparation.</span></span> <span data-ttu-id="9cc12-150">環境は準備中に直接触れられないため、準備フェーズ中にダウンタイムは発生しません。</span><span class="sxs-lookup"><span data-stu-id="9cc12-150">The environment is not directly touched during preparation and hence there is no downtime during the preparation phase.</span></span> <span data-ttu-id="9cc12-151">ユーザーは、準備時にシステムをそのまま使用できます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-151">Users can continue to use the system during preparation.</span></span> 

2. <span data-ttu-id="9cc12-152">準備が完了すると、**中止**および**環境の更新**ボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-152">After the preparation is complete, you will see **Abort** and **Update Environment** buttons.</span></span> <span data-ttu-id="9cc12-153">更新プログラムの適用を開始するには、**更新の環境**をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-153">To start applying the update, click **Update Environment**.</span></span> <span data-ttu-id="9cc12-154">準備が失敗した場合は、このトピックの後半にある「失敗した更新アプリケーションを解決する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-154">If preparation fails, see the "Resolve a failed update application" section later in this topic.</span></span>
3. <span data-ttu-id="9cc12-155">確認メッセージで**はい**を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-155">In the confirmation message, select **Yes**.</span></span> <span data-ttu-id="9cc12-156">この環境でサービス操作が開始されました。</span><span class="sxs-lookup"><span data-stu-id="9cc12-156">The servicing operation has started on this environment.</span></span> <span data-ttu-id="9cc12-157">これは環境のダウンタイムの先頭です。</span><span class="sxs-lookup"><span data-stu-id="9cc12-157">This is the start of the downtime on your environment.</span></span> 
4. <span data-ttu-id="9cc12-158">環境の状態は、**配置済み**から**配置中**に変更されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-158">The environment state is changed from **Deployed** to **Deploying**.</span></span> 
5. <span data-ttu-id="9cc12-159">更新が完了すると、環境状態は**展開**に戻されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-159">After the update is completed, the environment state is changed back to **Deployed**.</span></span> <span data-ttu-id="9cc12-160">更新プログラムの適用に失敗したとき、環境状態は **失敗** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-160">If application of the update fails, the environment state is changed to **Failed**.</span></span> <span data-ttu-id="9cc12-161">パッケージ アプリケーションが失敗する場合に行う操作の詳細については、このトピックで後述の「更新が失敗したアプリケーションを解決する」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-161">For information about what to do if package application fails, see the "Resolve a failed update application" section later in this topic.</span></span>
6. <span data-ttu-id="9cc12-162">環境で実行された操作を表示するには、**履歴**および**環境の詳細**ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-162">Open the **History** and **Environment details** pages to view the operations that were performed on the environment.</span></span> <span data-ttu-id="9cc12-163">展開、サービス、およびロールバックなど、環境で実行された主要なアクションのレコードを表示することもできます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-163">You can also view a record of major actions that were performed on the environment, such as deployments, servicing, and rollbacks.</span></span>

<span data-ttu-id="9cc12-164">**ローカル エージェントのバージョン 2.1.0 未満を使用している場合は、以下の手順を実行する必要があります。**</span><span class="sxs-lookup"><span data-stu-id="9cc12-164">**If you are on local agent version lower than 2.1.0, complete the following steps.**</span></span>
1. <span data-ttu-id="9cc12-165">更新プログラムを選択し、**適用**をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-165">Select the update, and then click **Apply**.</span></span>
2. <span data-ttu-id="9cc12-166">確認メッセージで**はい**を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-166">In the confirmation message, select **Yes**.</span></span> <span data-ttu-id="9cc12-167">この環境でサービス操作が開始されました。</span><span class="sxs-lookup"><span data-stu-id="9cc12-167">The servicing operation has started on this environment.</span></span> <span data-ttu-id="9cc12-168">これは環境のダウンタイムの先頭です。</span><span class="sxs-lookup"><span data-stu-id="9cc12-168">This is the start of the downtime on your environment.</span></span> 
3. <span data-ttu-id="9cc12-169">環境の状態が**配置済み**から**準備**に変更します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-169">Environment state changes from **Deployed** to **Preparing**.</span></span> 

    >[!NOTE]
    > <span data-ttu-id="9cc12-170">準備中、パッケージを書式設定しパッケージをダウンロードするなどの手順は、準備中に実行されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-170">During preparation, steps such formatting the package and downloading the package are executed during preparation.</span></span> <span data-ttu-id="9cc12-171">環境は準備中に直接触れられないため、準備フェーズ中にダウンタイムは発生しません。</span><span class="sxs-lookup"><span data-stu-id="9cc12-171">The environment is not directly touched during preparation and hence there is no downtime during the preparation phase.</span></span> <span data-ttu-id="9cc12-172">ユーザーは、準備時にシステムをそのまま使用できます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-172">Users can continue to use the system during preparation.</span></span> <span data-ttu-id="9cc12-173">ただし、環境が準備状態になったときに、ダウンタイムが開始されることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-173">However, we recommend that the downtime starts when the environment enters the Preparing state.</span></span>
 
4. <span data-ttu-id="9cc12-174">準備が完了したら、環境の状態は**準備中**から**配置中**に変更されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-174">After preparation is complete, the environment state is changed from **Preparing** to **Deploying**.</span></span> 
5. <span data-ttu-id="9cc12-175">更新が完了すると、環境状態は**展開**に戻されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-175">After the update is completed, the environment state is changed back to **Deployed**.</span></span> <span data-ttu-id="9cc12-176">更新プログラムの適用に失敗したとき、環境状態は **失敗** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-176">If application of the update fails, the environment state is changed to **Failed**.</span></span> <span data-ttu-id="9cc12-177">パッケージ アプリケーションが失敗する場合に行う操作の詳細については、このトピックで後述の「更新が失敗したアプリケーションを解決する」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-177">For information about what to do if package application fails, see the "Resolve a failed update application" section later in this topic.</span></span>
6. <span data-ttu-id="9cc12-178">環境で実行された操作を表示するには、**履歴**および**環境の詳細**ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-178">Open the **History** and **Environment details** pages to view the operations that were performed on the environment.</span></span> <span data-ttu-id="9cc12-179">展開、サービス、およびロールバックなど、環境で実行された主要なアクションのレコードを表示することもできます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-179">You can also view a record of major actions that were performed on the environment, such as deployments, servicing, and rollbacks.</span></span>

### <a name="update-a-production-environment"></a><span data-ttu-id="9cc12-180">実稼動環境の更新</span><span class="sxs-lookup"><span data-stu-id="9cc12-180">Update a production environment</span></span>
<span data-ttu-id="9cc12-181">実稼働環境を更新する前に、サンドボックス環境でパッケージ アプリケーションの更新を正常に完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-181">Before you update a production environment, you must successfully complete the package application update on a sandbox environment.</span></span>

1. <span data-ttu-id="9cc12-182">パッケージを適用しているサンドボックス環境のプロジェクトで、アセット ライブラリを開いてから、**ソフトウェア配置可能パッケージ** タブでパッケージを選択し、**リリース候補**としてマークします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-182">In the project for the sandbox environment that you applied the package to, open the Asset library, and then, on the **Software deployable packages** tab, select the package, and mark it as a **Release candidate**.</span></span>
2. <span data-ttu-id="9cc12-183">**環境の詳細**ページで、**メンテナンス**の下にある、**更新プログラムの適用**を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-183">On the **Environment details** page, under **Maintain**, select **Apply updates**.</span></span> <span data-ttu-id="9cc12-184">ダイアログ ボックスでは、**リリース候補**としてマークされたパッケージのみ表示されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-184">In the dialog box, only packages that are marked as a **Release candidate** are shown.</span></span>
3. <span data-ttu-id="9cc12-185">実稼働環境に適用されるリリース候補パッケージを選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-185">Select the Release candidate package to be applied to the Production environment.</span></span> 
4. <span data-ttu-id="9cc12-186">更新フローの残りの部分は、サンドボックス環境と同じです。</span><span class="sxs-lookup"><span data-stu-id="9cc12-186">The rest of the Update flow is the same as that of a sandbox environment.</span></span> <span data-ttu-id="9cc12-187">更新エクスペリエンスは、使用している環境で実行されているローカル エージェントのバージョンによって異なります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-187">Your update experience will differ based on the version of the local agent running on your environment.</span></span> <span data-ttu-id="9cc12-188">常に最新バージョンで実行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-188">We recommend that you always run with the latest version.</span></span>

## <a name="resolve-a-failed-update-application"></a><span data-ttu-id="9cc12-189">更新が失敗したアプリケーションを解決</span><span class="sxs-lookup"><span data-stu-id="9cc12-189">Resolve a failed update application</span></span>
<span data-ttu-id="9cc12-190">準備が失敗すると、環境状態は**配置済み**になります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-190">When preparation fails, the envrironment state is **Deployed**.</span></span> <span data-ttu-id="9cc12-191">更新プログラムの適用に失敗したとき、環境状態は**失敗**です。</span><span class="sxs-lookup"><span data-stu-id="9cc12-191">When the application of an update fails, the environment state is **Failed**.</span></span> <span data-ttu-id="9cc12-192">最初の手順でエラーが発生した理由を特定します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-192">The first step is to determine why there is a failure.</span></span> <span data-ttu-id="9cc12-193">ログの場所は、エラーが発生したステージによって異なります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-193">The location of the logs varies, depending on the stage where the failure occurred:</span></span>

- <span data-ttu-id="9cc12-194">**準備段階:** **準備**段階で操作が失敗すると、ログが LCS にアップロードされます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-194">**Preparation stage:** If the operation fails during the **Preparation** stage, the logs are uploaded to LCS.</span></span> <span data-ttu-id="9cc12-195">ログ ファイルで、**ログをダウンロード**を選択してログ ファイルをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-195">In the log files, select **Download logs** to download the log files.</span></span> <span data-ttu-id="9cc12-196">パッケージに結合の問題があった場合、エラーがログ ファイルに含まれます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-196">If the package has any merge issues, the error is included in the log file.</span></span>
- <span data-ttu-id="9cc12-197">**配置ステージ:** **配置**ステージで操作が失敗すると、ログはオンプレミス環境にあります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-197">**Deploying stage:** If the operation fails during the **Deploying** stage, the logs are located in the on-premises environment.</span></span> <span data-ttu-id="9cc12-198">この環境にサインインした後、ログとイベント ビューアーにアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-198">You must sign in to the environment, and then access the logs and event viewer.</span></span>

<span data-ttu-id="9cc12-199">トラブルシューティング ログの使用方法の詳細については、[オンプレミスの配置のトラブルシューティング](troubleshoot-on-prem.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-199">For more information about how to use the troubleshooting logs, see [Troubleshoot on-premises deployments](troubleshoot-on-prem.md).</span></span>

<span data-ttu-id="9cc12-200">ログを確認しエラーの原因を特定すると、次のいずれかの操作を実行して環境を正常な状態に復元します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-200">After you review the logs and determine the cause of the failure, complete one of the following operations to restore the environment to a healthy state.</span></span> <span data-ttu-id="9cc12-201">**失敗**状態の環境で実行できるアクションはありません。</span><span class="sxs-lookup"><span data-stu-id="9cc12-201">No actions can be performed on an environment that is in a **Failed** state.</span></span> <span data-ttu-id="9cc12-202">まず、環境を正常な状態に戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-202">The environment must first be restored to a healthy state.</span></span>

- <span data-ttu-id="9cc12-203">**失敗した操作の再試行** – アプリケーションの更新に失敗した場合は、**再試行** を選択し、失敗した操作から復旧させます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-203">**Retry failed operation** – If update application fails, select **Retry** to recover from the failed operation.</span></span>
- <span data-ttu-id="9cc12-204">**失敗した操作の中止** – オンプレミス環境に変更がないため、準備が失敗した場合、操作をキャンセルするオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-204">**Abort failed operation** – Because there is no change made to the on-premises environment, if the preparation fails, you have the option to cancel the operation.</span></span> <span data-ttu-id="9cc12-205">**中止**を選択して準備をキャンセルします。</span><span class="sxs-lookup"><span data-stu-id="9cc12-205">Select **Abort** to cancel the preparation.</span></span>
- <span data-ttu-id="9cc12-206">**更新をロールバック** – 失敗した更新をロールバックするには、**ロールバック**を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-206">**Roll back the update** – To roll back the update that failed, select **Rollback**.</span></span> <span data-ttu-id="9cc12-207">ロールバックを開始する前に、最新の問題のない状態にデータベースを復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-207">Before you start the rollback, you must restore the database to the last known good state.</span></span> <span data-ttu-id="9cc12-208">**ロールバック** を選択すると、環境は最後の正常な状態に復元されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-208">When you select **Rollback**, the environment is restored to the last known good state.</span></span> <span data-ttu-id="9cc12-209">環境の状態は、**準備** に変更され、次に **配置中** に変更され、次に **配置済み** または **失敗** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-209">The environment state is then changed to **Preparation**, then to **Deploying**, and then to either **Deployed** or **Failed**.</span></span>

    >[!NOTE]
    > <span data-ttu-id="9cc12-210">**ロールバック** ボタンは、データベースをロールバックしません。</span><span class="sxs-lookup"><span data-stu-id="9cc12-210">The **Rollback** button doesn't roll back the database.</span></span> <span data-ttu-id="9cc12-211">ユーザーは、更新プログラムの適用の前に行ったと分かっている最後のバックアップに、データベースを復元する責任があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-211">You're responsible for restoring the database to the last known backup that was made before update application.</span></span> <span data-ttu-id="9cc12-212">このステップは、データの損失がないことを保証するために重要です。</span><span class="sxs-lookup"><span data-stu-id="9cc12-212">This step is critical to help guarantee that there is no data loss.</span></span>

- <span data-ttu-id="9cc12-213">**状態の更新** – **準備**段階で更新アプリケーションが失敗すると、障害は LCS 側にあり、更新アプリケーションはまだ起動していません。</span><span class="sxs-lookup"><span data-stu-id="9cc12-213">**Refresh the state** – If update application fails during the **Preparation** stage, the failure is on the LCS side, and update application hasn't yet started.</span></span> <span data-ttu-id="9cc12-214">したがって、オンプレミス環境は良好な状態です。</span><span class="sxs-lookup"><span data-stu-id="9cc12-214">Therefore, the on-premises environment is in a good state.</span></span> <span data-ttu-id="9cc12-215">LCS 環境の状態を **Deployed** に戻すには、プロジェクト ダッシュボード ページで **更新** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-215">To restore the LCS environment state to **Deployed**, on the project dashboard page, select **Refresh**.</span></span>
- <span data-ttu-id="9cc12-216">**環境の削除と再配置** - 再試行とロールバックのオプションが機能しない場合は、環境を削除して再配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-216">**Delete and redeploy an environment** – If the retry and rollback options don't work, you must delete and redeploy the environment.</span></span> <span data-ttu-id="9cc12-217">環境を削除するには、[プロジェクト ダッシュボード] ページで **削除** を選択します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-217">To delete the environment, on the project dashboard page, select **Delete**.</span></span> <span data-ttu-id="9cc12-218">次に、環境を構成するオプションを表示します。</span><span class="sxs-lookup"><span data-stu-id="9cc12-218">You then see the option to configure the environment.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="9cc12-219">このオプションは実稼働環境では使用**しない**でください。</span><span class="sxs-lookup"><span data-stu-id="9cc12-219">This option should **not** be used on a production environment.</span></span> <span data-ttu-id="9cc12-220">ただし、環境を正常な状態に復元するサンドボックス環境で使用できます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-220">However, it can be used on a sandbox deployment to restore the environment to a healthy state.</span></span> 
    
    > <span data-ttu-id="9cc12-221">このオプションは環境を新規に配置することを必要とするため、以前に適用された更新は失われます。</span><span class="sxs-lookup"><span data-stu-id="9cc12-221">Because this option requires that you do a fresh deployment of the environment, you lose any updates that were previously applied.</span></span> <span data-ttu-id="9cc12-222">カスタマイズおよびバイナリ更新プログラムは、環境に再適用される必要があります。</span><span class="sxs-lookup"><span data-stu-id="9cc12-222">Any customizations and binary updates must be reapplied to the environment.</span></span>
