---
title: 仮想エンティティの概要
description: このトピックでは、Finance and Operations アプリの仮想エンティティに関する一般情報を提供します。
author: RamaKrishnamoorthy
ms.date: 05/14/2021
ms.topic: article
audience: IT Pro
ms.reviewer: sericks
ms.search.region: Global
ms.author: ramasri
ms.search.validFrom: 2021-05-31
ms.openlocfilehash: 09793e0e3212449a44116fa34f724cb9be8c5409
ms.sourcegitcommit: 17cee26b03f7b5afe8a089a0a9b2380e8d377d70
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/15/2021
ms.locfileid: "6048934"
---
# <a name="virtual-entities-overview"></a><span data-ttu-id="ad85b-103">仮想エンティティの概要</span><span class="sxs-lookup"><span data-stu-id="ad85b-103">Virtual entities overview</span></span>

[!include[banner](../includes/banner.md)]

> [!IMPORTANT]
> <span data-ttu-id="ad85b-104">この機能には、バージョン 10.0.12 の Finance and Operations アプリ、および Microsoft Dataverse のサービス更新プログラム 189 が必要です。</span><span class="sxs-lookup"><span data-stu-id="ad85b-104">This functionality requires version 10.0.12 of Finance and Operations apps, and service update 189 of Microsoft Dataverse.</span></span> <span data-ttu-id="ad85b-105">Dataverse のリリース情報は、[最新バージョンの利用可能性](/business-applications-release-notes/dynamics/released-versions/dynamics-365ce#all-version-availability)ページに発行されています。</span><span class="sxs-lookup"><span data-stu-id="ad85b-105">The release information for Dataverse is published on the [latest version availability page](/business-applications-release-notes/dynamics/released-versions/dynamics-365ce#all-version-availability).</span></span>

## <a name="virtual-entities-for-finance-and-operations-apps"></a><span data-ttu-id="ad85b-106">Finance and Operations アプリの仮想エンティティ</span><span class="sxs-lookup"><span data-stu-id="ad85b-106">Virtual entities for Finance and Operations apps</span></span>

<span data-ttu-id="ad85b-107">Finance and Operations アプリは、Dataverse の仮想データ ソースであり、Dataverse および Microsoft Power Platform からの完全な作成、読み取り、更新、削除 (CRUD) 操作を可能にし ます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-107">Finance and Operations apps are a virtual data source in Dataverse, and enable full create, read, update, and delete (CRUD) operations from Dataverse and Microsoft Power Platform.</span></span> <span data-ttu-id="ad85b-108">定義上、仮想エンティティのデータは、Dataverse には存在しません。</span><span class="sxs-lookup"><span data-stu-id="ad85b-108">By definition, the data for virtual entities doesn't reside in Dataverse.</span></span> <span data-ttu-id="ad85b-109">その代わりに、属しているアプリで引き続き存在します。</span><span class="sxs-lookup"><span data-stu-id="ad85b-109">Instead, it continues to reside in the app where it belongs.</span></span> <span data-ttu-id="ad85b-110">Dataverse から Finance and Operations エンティティに対して CRUD 操作を実行する前に 、エンティティを Dataverse の仮想エンティティとして使用できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ad85b-110">Before CRUD operations can be performed on Finance and Operations entities from Dataverse, the entities must be made available as virtual entities in Dataverse.</span></span> <span data-ttu-id="ad85b-111">これにより、Finance and Operations アプリに存在するデータに対して、Dataverse と Microsoft Power Platform から CRUD 処理を実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="ad85b-111">CRUD operations can then be performed from Dataverse and Microsoft Power Platform on data that resides in Finance and Operations apps.</span></span>

<span data-ttu-id="ad85b-112">Finance and Operations アプリ内のすべての Open Data Protocol (OData) エンティティは、Dataverse の仮想エンティティとして使用でき、したがって Microsoft Power Platform でも使用できます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-112">All Open Data Protocol (OData) entities in Finance and Operations apps are available as virtual entities in Dataverse, and therefore also in Microsoft Power Platform.</span></span> <span data-ttu-id="ad85b-113">これで、作成者は Finance and Operations アプリからデータを直接使用して、Cuntomer Engagement アプリでエクスペリエンスを構築できます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-113">Makers can now use data directly from Finance and Operations apps to build experiences in customer engagement apps.</span></span> <span data-ttu-id="ad85b-114">これらのエクスペリエンスは完全な CRUD 機能をオファーしており、Dataverse へのコピーを要求しません。</span><span class="sxs-lookup"><span data-stu-id="ad85b-114">These experiences offer full CRUD capability and don't require copying to Dataverse.</span></span> <span data-ttu-id="ad85b-115">Power Apps ポータルは、Finance and Operations アプリで業務プロセスのコラボレーション シナリオを可能にする外部向けの Web サイトを構築するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-115">Power Apps portals can be used to build external-facing websites that enable collaboration scenarios for business processes in Finance and Operations apps.</span></span>

## <a name="virtual-entities-for-core-human-resources"></a><span data-ttu-id="ad85b-116">Core Human Resources の仮想エンティティ</span><span class="sxs-lookup"><span data-stu-id="ad85b-116">Virtual entities for core Human Resources</span></span>

<span data-ttu-id="ad85b-117">Core Human Resources エンティティは、Finance and Operations エンティティが行うのと同じように仮想化することもできます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-117">Core Human Resources entities can also be virtualized, just as Finance and Operations entities can.</span></span> <span data-ttu-id="ad85b-118">詳細については、[Core HR の仮想エンティティ](/human-resources/hr-admin-integration-common-data-service-virtual-entities)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ad85b-118">For more information, see [Core HR virtual entities](/human-resources/hr-admin-integration-common-data-service-virtual-entities).</span></span>

## <a name="architecture"></a><span data-ttu-id="ad85b-119">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="ad85b-119">Architecture</span></span>

<span data-ttu-id="ad85b-120">仮想エンティティは、Finance and Operations アプリ以外にも有用な Dataverse の概念です。</span><span class="sxs-lookup"><span data-stu-id="ad85b-120">Virtual entities are a Dataverse concept that is useful beyond Finance and Operations apps.</span></span> <span data-ttu-id="ad85b-121">次の図は、仮想エンティティの Finance and Operations プロバイダーを実装する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="ad85b-121">The following illustration shows how the Finance and Operations provider for virtual entities is implemented.</span></span> <span data-ttu-id="ad85b-122">6 つの主要メソッドがプロバイダーによって実装されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-122">The provider implements six primary methods.</span></span> <span data-ttu-id="ad85b-123">最初の 5 つのメソッドは、**Create**、**Update**、**Delete**、**Retrieve**、**RetrieveMultiple** という標準的な CRUD 操作です。</span><span class="sxs-lookup"><span data-stu-id="ad85b-123">The first five methods are the standard CRUD operations: **Create**, **Update**, **Delete**, **Retrieve**, and **RetrieveMultiple**.</span></span> <span data-ttu-id="ad85b-124">最後のメソッドである **PerformAction** は、このトピックで後述するように OData アクションを呼び出すために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-124">The last method, **PerformAction**, is used to call OData actions, as described later in this topic.</span></span> <span data-ttu-id="ad85b-125">Finance and Operations 仮想エンティティ データ プロバイダー (図では 「仮想エンティティ プラグイン」 と表示) を呼び出すと、Finance and Operations アプリの CDSVirtualEntityService Web API エンドポイントに対して Secure Sockets Layer (SSL)/トランスポート層セキュリティ (TLS) 1.2 セキュア Web 呼び出しが行われます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-125">Calls to the Finance and Operations virtual entity data provider (shown as "virtual entities plug-in" in the illustration) will cause a Secure Sockets Layer (SSL)/Transport Layer Security (TLS) 1.2 secure web call to the CDSVirtualEntityService web API endpoint of Finance and Operations apps.</span></span> <span data-ttu-id="ad85b-126">その後、この Web サービスは、クエリを Finance and Operations アプリ内の関連する物理エンティティへの呼び出しに変換し、それらのエンティティで CRUD 操作または OData 操作を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="ad85b-126">This web service then converts the queries into calls to the associated physical entities in Finance and Operations apps, and invokes CRUD or OData operations on those entities.</span></span> <span data-ttu-id="ad85b-127">Finance and Operations エンティティはすべての操作で直接呼び出されるため、エンティティまたはバッキング テーブルのビジネス ロジックも呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-127">Because a Finance and Operations entity is directly invoked in all operations, any business logic on the entity or its backing tables is also invoked.</span></span>

![Finance and Operations アプリの仮想エンティティのアーキテクチャ](media/image1.png)

<span data-ttu-id="ad85b-129">呼び出し時、Dataverse から Finance and Operations アプリまで 2 つの変換点があります。</span><span class="sxs-lookup"><span data-stu-id="ad85b-129">During calls, there are two points of translation from Dataverse to Finance and Operations apps.</span></span> <span data-ttu-id="ad85b-130">変換の最初のポイントは、エンティティの物理名などの概念を Finance and Operations エンティティ名に変換する VE プラグインにあります。</span><span class="sxs-lookup"><span data-stu-id="ad85b-130">The first point of translation occurs in the VE Plugin, which translates concepts such as entity physical names into Finance and Operations entity names.</span></span> <span data-ttu-id="ad85b-131">また、会社の参照などの既知の概念も変換されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-131">It also converts some well-known concepts, such as Company references.</span></span> <span data-ttu-id="ad85b-132">Web サービス呼び出しでは、引き続き EntityCollection、Entity、および QueryExpression オブジェクトを使用して、実行される操作が表されます。このとき、VE プラグインから変換されたエンティティ名と概念が使用されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-132">The web service call still uses the EntityCollection, Entity, and QueryExpression objects to express the operations that are performed, by using the translated entity names and concepts from the VE Plugin.</span></span> <span data-ttu-id="ad85b-133">最後に、Finance and Operations アプリの CDSVirtualEntityAdapterService Web API によって、QueryExpression から QueryBuildDataSource およびその他の内部 Finance and Operations 言語構成要素への変換が完了します。</span><span class="sxs-lookup"><span data-stu-id="ad85b-133">Finally, the CDSVirtualEntityAdapterService web API in Finance and Operations apps completes the translation from QueryExpression to QueryBuildDataSource and other internal Finance and Operations language constructs.</span></span>

<span data-ttu-id="ad85b-134">仮想エンティティの一部としての Dataverse および Finance and Operations アプリ間での呼び出しはすべて、コンフィギュレーションで指定されている Azure Active Directory (Azure AD) アプリケーションを使用して、サービス間 (S2S) 呼び出しとして実行されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-134">All calls between Dataverse and Finance and Operations apps as part of virtual entities are done as service-to-service (S2S) calls, by using the Azure Active Directory (Azure AD) application that is specified in the configuration.</span></span> <span data-ttu-id="ad85b-135">このアプリケーションのユーザーは、CDSVirtualEntityAdapterService Web API とカタログ エンティティ CDSVirtualEntityListEntity に **のみ** アクセスできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ad85b-135">The user of this application should have access **only** to the CDSVirtualEntityAdapterService web API and the catalog entity, CDSVirtualEntityListEntity.</span></span> <span data-ttu-id="ad85b-136">これらの特権は、CDSVirtualEntityApplication という名前の、標準のセキュリティ ロールに含まれています。</span><span class="sxs-lookup"><span data-stu-id="ad85b-136">These privileges are included in the out-of-box security role that is named CDSVirtualEntityApplication.</span></span> <span data-ttu-id="ad85b-137">S2S 呼び出し中に、アクションを呼び出す Dataverse のユーザーの ID が Dataverse により提供されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-137">During the S2S calls, Dataverse provides the identity of the user in Dataverse who is invoking the action.</span></span> <span data-ttu-id="ad85b-138">CDSVirtualEntityAdapterService Web API は、Finance and Operations アプリで関連したユーザーを検索し、そのユーザーのコンテキストでクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="ad85b-138">The CDSVirtualEntityAdapterService web API looks up the associated user in Finance and Operations apps and runs the query in the context of that user.</span></span> <span data-ttu-id="ad85b-139">したがって、S2S 呼び出しでは、すべての Finance and Operations エンティティに明示的にアクセスする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="ad85b-139">Therefore, the S2S call doesn't have to have explicit access to all the Finance and Operations entities.</span></span> <span data-ttu-id="ad85b-140">代わりに、データ アクセスを決定するには、アクションを呼び出すユーザーの特権が必要な場合があります。</span><span class="sxs-lookup"><span data-stu-id="ad85b-140">Instead, it can rely on the privileges of the user who is invoking the action to determine data access.</span></span>

> [!NOTE]
> <span data-ttu-id="ad85b-141">仮想エンティティの呼び出しの待機時間を最適化するために、同じ Azure リージョンに Finance and Operations アプリと Dataverse の両方を同一配置することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ad85b-141">We always recommend that you have both Finance and Operations apps and Dataverse co-located in the same Azure region, to ensure optimal latency in virtual entity calls.</span></span> <span data-ttu-id="ad85b-142">Finance and Operations アプリと Dataverse を同一配置する場合、仮想エンティティの間接費は 1 回の呼び出しあたり 30 ミリ秒 (ms) 未満である予定です。</span><span class="sxs-lookup"><span data-stu-id="ad85b-142">When Finance and Operations apps and Dataverse are co-located, the virtual entity overhead is expected to be less than 30 milliseconds (ms) per call.</span></span>

<span data-ttu-id="ad85b-143">Power Apps ポータルでは、仮想エンティティにもアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-143">Power Apps Portal can also access virtual entities.</span></span> <span data-ttu-id="ad85b-144">Power Apps ポータル認証は連絡先レコードに基づいているため、連絡先レコードと Finance and Operations ユーザーの間のマッピングは Dataverse での dyn\_externalportalusermapping テーブルで管理されます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-144">Because Power Apps Portal authorization is based on contact records, a mapping between contact records and Finance and Operations users is maintained in the dyn\_externalportalusermapping table in Dataverse.</span></span> <span data-ttu-id="ad85b-145">このテーブルは、Dataverse の高度な特権を持つユーザーのみが編集でき、このユーザーは、Finance and Operations 仮想エンティティに対してポータル ユーザーが持つセキュリティ アクセスを制御する権限を持っています。</span><span class="sxs-lookup"><span data-stu-id="ad85b-145">This table should be editable only by highly privileged users in Dataverse who have the rights to control the security access that portal users have to Finance and Operations virtual entities.</span></span> <span data-ttu-id="ad85b-146">Power Apps ポータル アクセス用に設定されたすべての Finance and Operations ユーザーには、CDSVirtualEntityAuthorizedPortalUser セキュリティ ロールが割り当てられている必要があります。また、システム管理者またはセキュリティ管理者ロールを割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="ad85b-146">Any Finance and Operations user who is set up for Power Apps portal access must have the CDSVirtualEntityAuthorizedPortalUser security role assigned, and can't have the system administrator or security administrator role assigned.</span></span> <span data-ttu-id="ad85b-147">仮想エンティティに適用される Power Apps ポータル セキュリティ設定に関係なく、Finance and Operations アプリへの結果のクエリは常に関連付けられた Finance and Operations ユーザーとして実行され、そのユーザーのエンティティと行のセキュリティ設定に従います。</span><span class="sxs-lookup"><span data-stu-id="ad85b-147">Regardless of the Power Apps portal security setting that is applied to virtual entities, the resulting query to Finance and Operations apps is always run as the associated Finance and Operations user, and is subject to that user's entity and row security settings.</span></span> <span data-ttu-id="ad85b-148">匿名ポータルのアクセスもサポートされます。</span><span class="sxs-lookup"><span data-stu-id="ad85b-148">Anonymous portal access is also supported.</span></span> <span data-ttu-id="ad85b-149">このタイプのアクセスとその実行方法については、[Power Apps ポータル参照](power-portal-reference.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ad85b-149">For information about this type of access and how it can be done, see [Power Apps Portal reference](power-portal-reference.md).</span></span>
