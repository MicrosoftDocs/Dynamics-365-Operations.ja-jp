---
title: エンティティ モデリング
description: このトピックでは、Finance and Operations エンティティの仮想エンティティを使用したリレーショナル モデリングの概念について説明します。
author: Sunil-Garg
ms.date: 07/21/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.region: Global
ms.author: sunilg
ms.search.validFrom: 2020-05-31
ms.dyn365.ops.version: 10.0.12
ms.openlocfilehash: e397218df532a08c6091e42d772d874c1d975b87
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5745131"
---
# <a name="entity-modeling"></a><span data-ttu-id="41846-103">エンティティ モデリング</span><span class="sxs-lookup"><span data-stu-id="41846-103">Entity modeling</span></span>

[!include[banner](../includes/banner.md)]

[!include [rename-banner](~/includes/cc-data-platform-banner.md)]

> [!IMPORTANT]
> <span data-ttu-id="41846-104">この機能を使用するには、Finance and Operations アプリのバージョン 10.0.12 が必要ですが、Dataverse にはサービス更新 189 が必要です。</span><span class="sxs-lookup"><span data-stu-id="41846-104">This functionality requires version 10.0.12 for Finance and Operations apps, while service update 189 is required for Dataverse.</span></span> <span data-ttu-id="41846-105">Dataverse のリリース情報は、[最新バージョンの利用可能性](https://docs.microsoft.com/business-applications-release-notes/dynamics/released-versions/dynamics-365ce#all-version-availability)ページに発行されています。</span><span class="sxs-lookup"><span data-stu-id="41846-105">The release information for Dataverse is published on the [latest version availability page](https://docs.microsoft.com/business-applications-release-notes/dynamics/released-versions/dynamics-365ce#all-version-availability).</span></span>

> <span data-ttu-id="41846-106">Finance and Operations 仮想エンティティの Dataverse メタデータで公開されるパブリック エンティティ名は、Finance and Operations エンティティの物理名を使用します。</span><span class="sxs-lookup"><span data-stu-id="41846-106">The public entity name that is exposed in Dataverse metadata for the Finance and Operations virtual entity uses the physical name of the Finance and Operations entity.</span></span> <span data-ttu-id="41846-107">これは、Finance and Operations アプリの OData メタデータによって公開されるエンティティのパブリック名とは異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="41846-107">This could be different from the public name of the entity as exposed by the OData metadata in Finance and Operations apps.</span></span>

<span data-ttu-id="41846-108">アプリを作成するには、アプリで使用されているエンティティの間でリレーショナル モデリングを実行する機能が必要です。</span><span class="sxs-lookup"><span data-stu-id="41846-108">Building an app requires capabilities to perform relational modeling between entities that are being used in the app.</span></span> <span data-ttu-id="41846-109">仮想エンティティのコンテキストでは、Dataverse の仮想エンティティとネイティブ エンティティが連携して、目的のユーザー エクスペリエンスを実現する必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-109">In the context of virtual entities, there will be scenarios where virtual entities and native entities in Dataverse must work together to enable the desired user experience.</span></span> <span data-ttu-id="41846-110">このトピックでは、Finance and Operations の仮想エンティティを使用して実装できるリレーショナル モデリングの概念について説明します。</span><span class="sxs-lookup"><span data-stu-id="41846-110">This topic explains concepts of relational modeling that can be implemented using virtual entities for Finance and Operations.</span></span>

## <a name="generating-virtual-entities"></a><span data-ttu-id="41846-111">仮想エンティティの生成</span><span class="sxs-lookup"><span data-stu-id="41846-111">Generating virtual entities</span></span>

<span data-ttu-id="41846-112">既定では、Finance and Operations アプリの仮想エンティティは Dataverse に存在しません。</span><span class="sxs-lookup"><span data-stu-id="41846-112">By default, virtual entities for Finance and Operations apps don't exist in Dataverse.</span></span> <span data-ttu-id="41846-113">ユーザーは、Finance and Operations のリンクされたインスタンスで使用可能なエンティティを表示するために、カタログ エンティティを照会する必要があり ます。</span><span class="sxs-lookup"><span data-stu-id="41846-113">A user must query the catalog entity to view the entities that are available in the linked instance of Finance and Operations.</span></span> <span data-ttu-id="41846-114">カタログから、ユーザーは 1 つ以上のエンティティを選択し、Dataverse が仮想エンティティを生成するように要求できます。</span><span class="sxs-lookup"><span data-stu-id="41846-114">From the catalog, the user can select one or more entities, and then request that Dataverse generate the virtual entities.</span></span> <span data-ttu-id="41846-115">この手順については、後のセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="41846-115">This procedure is explained in later sections.</span></span>

## <a name="entity-fields"></a><span data-ttu-id="41846-116">エンティティ フィールド</span><span class="sxs-lookup"><span data-stu-id="41846-116">Entity fields</span></span>

<span data-ttu-id="41846-117">Finance and Operations エンティティに対して仮想エンティティが生成されると、システムによって Dataverse の対応する仮想エンティティの Finance and Operations エンティティに各フィールドが作成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-117">When a virtual entity is generated for a Finance and Operations entity, the system tries to create each field in the Finance and Operations entity in the corresponding virtual entity in Dataverse.</span></span> <span data-ttu-id="41846-118">理想的なケースでは、Finance and Operations と Dataverse の間でサポートされるデータ型が一致していない場合、両方のエンティティで同じフィールドの総数が同じになり ます。</span><span class="sxs-lookup"><span data-stu-id="41846-118">In an ideal case, the total number of fields will be the same in both entities, unless there is a mismatch in supported data types between Finance and Operations and Dataverse.</span></span> <span data-ttu-id="41846-119">サポートされているデータ型については、Finance and Operations のプロパティに基づいて Dataverse のフィールド プロパティが設定されます。</span><span class="sxs-lookup"><span data-stu-id="41846-119">For data types that are supported, the field properties in Dataverse are set based on the properties in Finance and Operations.</span></span>

<span data-ttu-id="41846-120">このセクションの残りの部分では、サポートされるデータ型とサポートされていないデータ型について説明します。</span><span class="sxs-lookup"><span data-stu-id="41846-120">This rest of this section describes supported and unsupported data types.</span></span> <span data-ttu-id="41846-121">Dataverse にあるフィールドの詳細については、[フィールドの概要](https://docs.microsoft.com/powerapps/maker/common-data-service/fields-overview)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="41846-121">For more information about fields in Dataverse, see [Fields overview](https://docs.microsoft.com/powerapps/maker/common-data-service/fields-overview).</span></span>

| <span data-ttu-id="41846-122">Finance and Operations のデータ型</span><span class="sxs-lookup"><span data-stu-id="41846-122">Data type in Finance and Operations</span></span> | <span data-ttu-id="41846-123">Dataverse のモデル化されたデータ型</span><span class="sxs-lookup"><span data-stu-id="41846-123">Modeled data type in Dataverse</span></span> |
|-------------------------------------|------------------------------------------|
| <span data-ttu-id="41846-124">実績</span><span class="sxs-lookup"><span data-stu-id="41846-124">Real</span></span>                                | <span data-ttu-id="41846-125">実数</span><span class="sxs-lookup"><span data-stu-id="41846-125">Decimal</span></span><br><br><span data-ttu-id="41846-126">考えられる不一致の詳細については、次の表を参照してください。</span><span class="sxs-lookup"><span data-stu-id="41846-126">For information about the possible mismatch, see the next table.</span></span></p> |
| <span data-ttu-id="41846-127">長い</span><span class="sxs-lookup"><span data-stu-id="41846-127">Long</span></span>                                | <span data-ttu-id="41846-128">精度が 0 (ゼロ) に等しい 10 進数</span><span class="sxs-lookup"><span data-stu-id="41846-128">Decimal, where the precision equals 0 (zero)</span></span> |
| <span data-ttu-id="41846-129">Int</span><span class="sxs-lookup"><span data-stu-id="41846-129">Int</span></span>                                 | <span data-ttu-id="41846-130">整数</span><span class="sxs-lookup"><span data-stu-id="41846-130">Integer</span></span> |
| <span data-ttu-id="41846-131">文字列 (memo 以外), 文字列 (memo)</span><span class="sxs-lookup"><span data-stu-id="41846-131">String (non-memo), String (memo)</span></span>    | <span data-ttu-id="41846-132">文字列 – 1 行のテキスト、文字列 – 複数行テキスト</span><span class="sxs-lookup"><span data-stu-id="41846-132">String – single line of text, String – multiple lines of text</span></span> |
| <span data-ttu-id="41846-133">UtcDateTime</span><span class="sxs-lookup"><span data-stu-id="41846-133">UtcDateTime</span></span>                         | <span data-ttu-id="41846-134">DateTime (DateTimeFormat.DateAndTime, DateTimeBehavior.TimeZoneIndependent)</span><span class="sxs-lookup"><span data-stu-id="41846-134">DateTime (DateTimeFormat.DateAndTime, DateTimeBehavior.TimeZoneIndependent)</span></span><br><br><span data-ttu-id="41846-135">Finance and Operations における空の日付 (1900 年 1 月 1 日) は、Dataverse では null 値として表されます。</span><span class="sxs-lookup"><span data-stu-id="41846-135">An empty date (January 1, 1900) in Finance and Operations is surfaced as a null value in Dataverse.</span></span> |
| <span data-ttu-id="41846-136">日</span><span class="sxs-lookup"><span data-stu-id="41846-136">Date</span></span>                                | <span data-ttu-id="41846-137">DateTime - (DateTimeFormat.DateOnly, DateTimeBehavior.TimeZoneIndependent)</span><span class="sxs-lookup"><span data-stu-id="41846-137">DateTime - (DateTimeFormat.DateOnly, DateTimeBehavior.TimeZoneIndependent)</span></span><br><br><span data-ttu-id="41846-138">Finance and Operations における空の日付 (1900 年 1 月 1 日) は、Dataverse では空の値として表されます。</span><span class="sxs-lookup"><span data-stu-id="41846-138">An empty date (January 1, 1900) in Finance and Operations is surfaced as an empty value in Dataverse.</span></span> |
| <span data-ttu-id="41846-139">Enum</span><span class="sxs-lookup"><span data-stu-id="41846-139">Enum</span></span>                                | <span data-ttu-id="41846-140">候補リスト</span><span class="sxs-lookup"><span data-stu-id="41846-140">Picklist</span></span><br><br><span data-ttu-id="41846-141">Finance and Operations 列挙 (列挙型) は、Dataverse ではグローバル OptionSet として生成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-141">Finance and Operations enumerations (enums) are generated as global OptionSets in Dataverse.</span></span> <span data-ttu-id="41846-142">システム間のマッチングは、値の **外部名** プロパティを使用して行われます。</span><span class="sxs-lookup"><span data-stu-id="41846-142">Matching between the systems is done by using the **External Name** property of values.</span></span> <span data-ttu-id="41846-143">Dataverse における列挙型整数値は、システム間で固定されているとは限りません。</span><span class="sxs-lookup"><span data-stu-id="41846-143">Enum integer values in Dataverse aren't guaranteed to be stable between the systems.</span></span> <span data-ttu-id="41846-144">したがって、これらの列挙型にも固定 ID が含まれていないので、依存することは避けてください (特に Finance and Operations の拡張可能な列挙型の場合)。</span><span class="sxs-lookup"><span data-stu-id="41846-144">Therefore, you should not rely on them, especially in the case of extensible enums in Finance and Operations, because these enums don't have a stable ID either.</span></span> <span data-ttu-id="41846-145">OptionSet を使用するエンティティが更新されると、OptionSet メタデータが更新されます。</span><span class="sxs-lookup"><span data-stu-id="41846-145">OptionSet metadata is updated when an entity that uses the OptionSet is updated.</span></span> |

<span data-ttu-id="41846-146">Finance and Operations における *real* および *long* データ型のフィールドは、Dataverse で *decimal* データ型としてモデル化されます。</span><span class="sxs-lookup"><span data-stu-id="41846-146">Fields of the *real* and *long* data types in Finance and Operations are modeled as the *decimal* data type in Dataverse.</span></span> <span data-ttu-id="41846-147">2 つのデータ型の間では、精度と小数点部桁数の不一致があるため、次の動作を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-147">Because of the mismatch in precision and scale between the two data types, the following behavior must be considered.</span></span>

| <span data-ttu-id="41846-148">ユース ケース</span><span class="sxs-lookup"><span data-stu-id="41846-148">Use case</span></span>                                     | <span data-ttu-id="41846-149">結果の動作</span><span class="sxs-lookup"><span data-stu-id="41846-149">Resulting behavior</span></span> |
|----------------------------------------------|--------------------|
| <span data-ttu-id="41846-150">Dataverse のほうが精度が高くなります。</span><span class="sxs-lookup"><span data-stu-id="41846-150">Dataverse has higher precision.</span></span>    | <span data-ttu-id="41846-151">メタデータが同期していない場合、このユース ケースは発生しません。</span><span class="sxs-lookup"><span data-stu-id="41846-151">This use case should never occur unless the metadata is out of sync.</span></span> |
| <span data-ttu-id="41846-152">Finance and Operations のほうが精度が高くなります。</span><span class="sxs-lookup"><span data-stu-id="41846-152">Finance and Operations has higher precision.</span></span> | <span data-ttu-id="41846-153">読み取り操作時は、Dataverse では、値が最も近い精度値に丸められます。</span><span class="sxs-lookup"><span data-stu-id="41846-153">During a read operation, the value is rounded to the closest precision value in Dataverse.</span></span> <span data-ttu-id="41846-154">値が Dataverse で編集された場合、Finance and Operations では、値が最も近い精度値に丸められます。</span><span class="sxs-lookup"><span data-stu-id="41846-154">If the value is edited in Dataverse, it's rounded to the closest precision value in Finance and Operations.</span></span> <span data-ttu-id="41846-155">書き込み操作中は、Dataverse で指定された値が書き込まれます。これは、Finance and Operations がより高い精度をサポートするためです。</span><span class="sxs-lookup"><span data-stu-id="41846-155">During a write operation, the value that is specified in Dataverse is written, because Finance and Operations supports higher precision.</span></span> |
| <span data-ttu-id="41846-156">Dataverse のほうがスケールが大きくなります。</span><span class="sxs-lookup"><span data-stu-id="41846-156">Dataverse has higher scale.</span></span>        | <span data-ttu-id="41846-157">該当なし</span><span class="sxs-lookup"><span data-stu-id="41846-157">Not applicable</span></span> |
| <span data-ttu-id="41846-158">Finance and Operations のほうがスケールが大きくなります。</span><span class="sxs-lookup"><span data-stu-id="41846-158">Finance and Operations has higher scale.</span></span>     | <span data-ttu-id="41846-159">Dataverse には Finance and Operations 値が表示されます (1000 億を超える場合でも)。</span><span class="sxs-lookup"><span data-stu-id="41846-159">Dataverse shows the Finance and Operations value, even if it exceeds 100 billion.</span></span> <span data-ttu-id="41846-160">ただし、精度は低下します。</span><span class="sxs-lookup"><span data-stu-id="41846-160">However, there will be a loss of precision.</span></span> <span data-ttu-id="41846-161">たとえば、987,654,100,000,000,000 は Dataverse では "987,654,099,999,999,900" として表示されます。</span><span class="sxs-lookup"><span data-stu-id="41846-161">For example, 987,654,100,000,000,000 is shown in Dataverse as "987,654,099,999,999,900".</span></span> <span data-ttu-id="41846-162">このフィールドの値を Dataverse で編集した場合、Dataverse 検証により、値が最大値を超えてから値が Finance and Operations に送信されるというエラーがスローされます。</span><span class="sxs-lookup"><span data-stu-id="41846-162">If the value of this field is edited in Dataverse, Dataverse validation throws an error that the value exceeds the maximum value before that value is sent to Finance and Operations.</span></span> |

<span data-ttu-id="41846-163">Dataverse では、以下の Finance and Operations のデータ型はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="41846-163">The following data types in Finance and Operations aren't supported in Dataverse.</span></span> <span data-ttu-id="41846-164">Finance and Operations エンティティのこれらのデータ型のフィールドは、Dataverse の対応する仮想エンティティで使用できるようになりません。</span><span class="sxs-lookup"><span data-stu-id="41846-164">Fields of these data types in Finance and Operations entities won't be made available in the corresponding virtual entities in Dataverse.</span></span> <span data-ttu-id="41846-165">これらのデータ型のフィールドを Open Data Protocol (OData) アクションのパラメーターとして使用した場合は、それらのアクションを対応する仮想エンティティで使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="41846-165">If fields of these data types are used as parameters in Open Data Protocol (OData) actions, those actions won't be available for use in the corresponding virtual entities.</span></span> <span data-ttu-id="41846-166">OData アクションの詳細については、このトピックで後述する [OData アクション](#odata-actions)のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="41846-166">For more information about OData actions, see the [OData actions](#odata-actions) section later in this topic.</span></span>

- <span data-ttu-id="41846-167">AnyType</span><span class="sxs-lookup"><span data-stu-id="41846-167">AnyType</span></span>
- <span data-ttu-id="41846-168">BLOB</span><span class="sxs-lookup"><span data-stu-id="41846-168">BLOB</span></span>
- <span data-ttu-id="41846-169">クラス</span><span class="sxs-lookup"><span data-stu-id="41846-169">Class</span></span>
- <span data-ttu-id="41846-170">コンテナー</span><span class="sxs-lookup"><span data-stu-id="41846-170">Container</span></span>
- <span data-ttu-id="41846-171">Guid</span><span class="sxs-lookup"><span data-stu-id="41846-171">Guid</span></span>
- <span data-ttu-id="41846-172">レコード</span><span class="sxs-lookup"><span data-stu-id="41846-172">Record</span></span>
- <span data-ttu-id="41846-173">時刻</span><span class="sxs-lookup"><span data-stu-id="41846-173">Time</span></span>
- <span data-ttu-id="41846-174">UserType</span><span class="sxs-lookup"><span data-stu-id="41846-174">UserType</span></span>
- <span data-ttu-id="41846-175">VarArg</span><span class="sxs-lookup"><span data-stu-id="41846-175">VarArg</span></span>
- <span data-ttu-id="41846-176">Void (OData アクションの Void 戻り値の型はサポートされています)。</span><span class="sxs-lookup"><span data-stu-id="41846-176">Void (Void return types on OData actions are supported.)</span></span>

<span data-ttu-id="41846-177">Dataverse でサポートされているが、Finance and Operations ではサポートされていないデータ型は、Finance and Operations の仮想エンティティではサポートされません。</span><span class="sxs-lookup"><span data-stu-id="41846-177">Data types that are supported in Dataverse but not in Finance and Operations aren't supported in virtual entities for Finance and Operations.</span></span>

## <a name="entity-keyprimary-key"></a><span data-ttu-id="41846-178">エンティティ キー/主キー</span><span class="sxs-lookup"><span data-stu-id="41846-178">Entity key/primary key</span></span>

<span data-ttu-id="41846-179">Finance and Operations では、エンティティはエンティティ キーとしてさまざまなデータ型の 1 つ以上のフィールドを持つことができます。</span><span class="sxs-lookup"><span data-stu-id="41846-179">In Finance and Operations, entities can have one or more fields of various data types as the entity key.</span></span> <span data-ttu-id="41846-180">エンティティ キーは、Finance and Operations エンティティのレコードを一意に識別します。</span><span class="sxs-lookup"><span data-stu-id="41846-180">An entity key uniquely identifies a record in a Finance and Operations entity.</span></span> <span data-ttu-id="41846-181">さらに、エンティティのレコードは、Int64 型のレコード ID 主キーによって一意に識別できます。</span><span class="sxs-lookup"><span data-stu-id="41846-181">Additionally, a record in an entity can be uniquely identified by a record ID primary key of the Int64 type.</span></span>

<span data-ttu-id="41846-182">Dataverse では、主キーは常にグローバル一意識別子 (GUID) になります。</span><span class="sxs-lookup"><span data-stu-id="41846-182">In Dataverse, the primary key is always a globally unique identifier (GUID).</span></span> <span data-ttu-id="41846-183">GUID ベースの主キーを使用すると、Dataverse 内のエンティティ内のレコードを一意に識別できます。</span><span class="sxs-lookup"><span data-stu-id="41846-183">The GUID-based primary key enables a record in an entity in Dataverse to be uniquely identified.</span></span>

<span data-ttu-id="41846-184">Finance and Operations と Dataverse の間のインプリメンテーション ギャップを埋めるため、Finance and Operations の仮想エンティティの主キーは GUID です (Dataverse に準拠するため)。</span><span class="sxs-lookup"><span data-stu-id="41846-184">To bridge the implementation gap between Finance and Operations and Dataverse, the primary key of a virtual entity for Finance and Operations is a GUID (to comply with Dataverse).</span></span> <span data-ttu-id="41846-185">この GUID は、最初の 4 バイトのデータ エンティティ ID と、最後の 8 バイトとしてエンティティ内のルート データ ソースのレコード ID で構成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-185">This GUID consists of the data entity ID in the first 4 bytes, and the record ID of the root data source in the entity as the last 8 bytes.</span></span> <span data-ttu-id="41846-186">この設計では、GUID をエンティティ キーとして使用するという Dataverse の要件が満たされています。</span><span class="sxs-lookup"><span data-stu-id="41846-186">This design satisfies Dataverse's requirement that a GUID be used as the entity key.</span></span> <span data-ttu-id="41846-187">また、テーブル ID とレコード ID を使用して、Finance and Operations のエンティティ レコードを一意に識別することもできます。</span><span class="sxs-lookup"><span data-stu-id="41846-187">It also enables the table ID and record ID to be used to uniquely identify the entity record in Finance and Operations.</span></span>

<span data-ttu-id="41846-188">Finance and Operations でエンティティを使用する場合、ルート データ ソースには常に一意の RecID があることを確認します。</span><span class="sxs-lookup"><span data-stu-id="41846-188">When using entities in Finance and Operations, you need to ensure that the root data source will always have a unique RecID.</span></span> <span data-ttu-id="41846-189">このデザインに違反すると、Dataverse には対応する仮想エンティティに対して重複するGUID が表示されます。</span><span class="sxs-lookup"><span data-stu-id="41846-189">If this design is violated, duplicate GUID's will show up in Dataverse for the corresponding virtual entity.</span></span> <span data-ttu-id="41846-190">集計ビューには一意の RecID がない可能性があるという同じ理由で、集計ビューは仮想エンティティ経由ではサポートされません。</span><span class="sxs-lookup"><span data-stu-id="41846-190">Aggregate views are not supported via virtual entities for the same reason because these views may not have unique RecIDs.</span></span>

## <a name="primary-field"></a><span data-ttu-id="41846-191">基本フィールド</span><span class="sxs-lookup"><span data-stu-id="41846-191">Primary field</span></span>

<span data-ttu-id="41846-192">Dataverse では、各エンティティに基本フィールドが必要です。</span><span class="sxs-lookup"><span data-stu-id="41846-192">In Dataverse, each entity must have a primary field.</span></span> <span data-ttu-id="41846-193">このフィールドには、文字列型の単一のフィールドを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-193">This field must be a single field of the string type.</span></span> <span data-ttu-id="41846-194">基本フィールドは、次の場合に Dataverse で使用されます。</span><span class="sxs-lookup"><span data-stu-id="41846-194">The primary field is used in Dataverse in the following scenarios:</span></span>

- <span data-ttu-id="41846-195">エンティティに対して作成される既定のビューには、基本フィールドがあります。</span><span class="sxs-lookup"><span data-stu-id="41846-195">The default views that are created for an entity include the primary field.</span></span>
- <span data-ttu-id="41846-196">エンティティのクイック ビュー フォームには、基本フィールドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="41846-196">The quick view form for an entity includes the primary field.</span></span>
- <span data-ttu-id="41846-197">別のエンティティへのルックアップがページに追加され、基本フィールドのデータが表示されます。</span><span class="sxs-lookup"><span data-stu-id="41846-197">A lookup to another entity is added to a page and shows the data from the primary field.</span></span>

<span data-ttu-id="41846-198">Dataverse の基本フィールドの使用に基づき、Finance and Operations の仮想エンティティの基本フィールドは、Finance and Operations の対応するエンティティのエンティティ キーを使用するように設計されてい ます。</span><span class="sxs-lookup"><span data-stu-id="41846-198">Based on this use of the primary field in Dataverse, the primary field for a virtual entity for Finance and Operations is designed to use the entity key of the corresponding entity in Finance and Operations.</span></span>

<span data-ttu-id="41846-199">Dataverse の基本フィールドには文字列型のフィールドが 1 つしかないことが想定されているのに対し、Finance and Operations ではさまざまなデータ型の複数のフィールドを持つことができます。</span><span class="sxs-lookup"><span data-stu-id="41846-199">Because the primary field in Dataverse is expected to have only one field of the string type, whereas the entity key in Finance and Operations can have multiple fields of various data types, the entity key fields are converted to strings.</span></span> <span data-ttu-id="41846-200">文字列は、連結され、パイプ (\|) によって区切られており、最大 255 文字です。</span><span class="sxs-lookup"><span data-stu-id="41846-200">The strings are concatenated and separated by a pipe (\|), to a maximum length of 255 characters.</span></span> <span data-ttu-id="41846-201">255 文字を超える値はすべて切り捨てられます。</span><span class="sxs-lookup"><span data-stu-id="41846-201">Any value that exceeds 255 is truncated.</span></span> <span data-ttu-id="41846-202">基本フィールドを表すこの仮想エンティティ フィールドの名前は、**mserp\_primaryfield** になります。</span><span class="sxs-lookup"><span data-stu-id="41846-202">This virtual entity field that represents the primary field is named **mserp\_primaryfield**.</span></span>

## <a name="relations"></a><span data-ttu-id="41846-203">リレーション</span><span class="sxs-lookup"><span data-stu-id="41846-203">Relations</span></span>

> [!IMPORTANT]
> <span data-ttu-id="41846-204">仮想エンティティとネイティブ エンティティを横断する書き込みトランザクションには対応していません。</span><span class="sxs-lookup"><span data-stu-id="41846-204">A write transaction that spans a virtual entity and a native entity is not supported.</span></span> <span data-ttu-id="41846-205">整合性の確保を保証する方法がないため、この形式のトランザクションは使用しないことを推奨します。</span><span class="sxs-lookup"><span data-stu-id="41846-205">We do not recommend using this form of transaction, as there is no way to ensure consistency.</span></span>

<span data-ttu-id="41846-206">Finance and Operations エンティティのリレーションは、1 対多 (1: n) または多対 1 (n:1) のリレーションとしてモデル化されます。</span><span class="sxs-lookup"><span data-stu-id="41846-206">Relations in Finance and Operations entities are modeled as one-to-many (1:n) or many-to-one (n:1) relations.</span></span> <span data-ttu-id="41846-207">これらのリレーションは、Dataverse の仮想エンティティのリレーションシップとしてモデル化されています。</span><span class="sxs-lookup"><span data-stu-id="41846-207">These relations are modeled as relationships in the virtual entity in Dataverse.</span></span> <span data-ttu-id="41846-208">多対多 (n:n) のリレーションは、Finance and Operations ではサポートされていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="41846-208">Note that many-to-many (n:n) relations aren't supported in Finance and Operations.</span></span>

<span data-ttu-id="41846-209">たとえば、Finance and Operations では、エンティティ A がエンティティ B への外部キーを持っている場合、このリレーションは、Dataverse の仮想エンティティ A で n:1 のリレーションシップとしてモデル化されます。</span><span class="sxs-lookup"><span data-stu-id="41846-209">For example, in Finance and Operations, if Entity A has a foreign key to Entity B, this relation will be modeled as an n:1 relationship in virtual entity Entity A in Dataverse.</span></span> <span data-ttu-id="41846-210">Dataverse でのこのリレーションシップのスキーマ名は、名前付け規則 **mserp\_FK\_\<source entity name\>\_\<relation name\>** を使用します。</span><span class="sxs-lookup"><span data-stu-id="41846-210">The schema name of this relationship in Dataverse uses the naming convention **mserp\_FK\_\<source entity name\>\_\<relation name\>**.</span></span> <span data-ttu-id="41846-211">この名前付け規則では、最大文字列長が 92 文字になっています。</span><span class="sxs-lookup"><span data-stu-id="41846-211">This naming convention has a maximum string length of 92 characters.</span></span> <span data-ttu-id="41846-212">スキーマ名が 92 文字を超える名前を生成するリレーションは、Dataverse の仮想エンティティで生成されません。</span><span class="sxs-lookup"><span data-stu-id="41846-212">Any relation where the schema name will produce a name that exceeds 92 characters won't be generated in the virtual entity in Dataverse.</span></span>

<span data-ttu-id="41846-213">このリレーションシップの外部名は、名前付け規則 **FK\_\<relation name\>** を使用します。</span><span class="sxs-lookup"><span data-stu-id="41846-213">The external name of this relationship uses the naming convention **FK\_\<relation name\>**.</span></span> <span data-ttu-id="41846-214">外部名は、Finance and Operations に送信されるクエリが作成されるときの Finance and Operations におけるリレーションを決定するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="41846-214">The external name is used to determine the relation in Finance and Operations when the query that is sent to Finance and Operations is built.</span></span>

<span data-ttu-id="41846-215">Dataverse の仮想エンティティに対してリレーションシップが生成されると、そのルックアップタイプの新しいフィールドがソース エンティティにも追加されます。</span><span class="sxs-lookup"><span data-stu-id="41846-215">When a relationship is generated for a virtual entity in Dataverse, a new field of the lookup type is also added to the source entity.</span></span> <span data-ttu-id="41846-216">前の例では、リレーションシップが作成されると、名前付け規則 **mserp\_fk\_\<target\_entity\>\_id** を使用した新しい検索フィールドがソース エンティティ A に追加されます。Finance and Operations のエンティティに複数のリレーションが存在する可能性があるため 、ソース仮想エンティティには、同じ数のルックアップ フィールド (関連エンティティごとに1つ) が作成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-216">In the preceding example, when the relationship is created, a new lookup field that uses the naming convention **mserp\_fk\_\<target\_entity\>\_id** is added to source entity Entity A. Because there can be several relations in an entity in Finance and Operations, the same number of lookup fields (one per related entity) will be created in the source virtual entity.</span></span> <span data-ttu-id="41846-217">このルックアップ フィールドがページまたはビューに追加されると、関連するエンティティの基本フィールドの値が表示されます。</span><span class="sxs-lookup"><span data-stu-id="41846-217">When this lookup field is added to a page or a view, it will show the primary field value from the related entity.</span></span>

<span data-ttu-id="41846-218">Dataverse の仮想エンティティ内のリレーションシップは、Dataverse の仮想エンティティとしてに既にリレーション内の関連エンティティが存在する場合にのみ生成され ます。</span><span class="sxs-lookup"><span data-stu-id="41846-218">A relationship in the virtual entity in Dataverse will be generated only if the related entity in the relation already exists as a virtual entity in Dataverse.</span></span> <span data-ttu-id="41846-219">前の例では、エンティティ B が Dataverse の仮想エンティティとしてに存在しない場合、エンティティ A が仮想エンティティとして生成されたときに、エンティティ B へのリレーションがエンティティ A に作成されません。</span><span class="sxs-lookup"><span data-stu-id="41846-219">In the preceding example, if Entity B doesn't exist as a virtual entity in Dataverse, the relation to Entity B won't be created in Entity A when Entity A is generated as a virtual entity.</span></span> <span data-ttu-id="41846-220">このリレーションは、エンティティ B が仮想エンティティとして生成された場合にのみエンティティ A に追加されます。</span><span class="sxs-lookup"><span data-stu-id="41846-220">This relation will be added to Entity A only when Entity B is generated as a virtual entity.</span></span> <span data-ttu-id="41846-221">したがって、Finance and Operations の仮想エンティティが生成されると、検証が行われ、生成される仮想エンティティに完全な機能と機能できるリレーションシップのみが生成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-221">Therefore, when a virtual entity is generated for Finance and Operations, validations are done to ensure that only relationships that can be complete and functional are generated in the virtual entity that is being generated.</span></span>

<span data-ttu-id="41846-222">要約すると、次のいずれかの理由により、別の Finance and Operations 仮想エンティティとのリレーションシップが仮想エンティティに存在しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="41846-222">In summary, a relationship to another Finance and Operations virtual entity might not exist in the virtual entity for either of the following reasons:</span></span>

- <span data-ttu-id="41846-223">リレーションシップに参加している Finance and Operations エンティティは、仮想エンティティとして存在しません。</span><span class="sxs-lookup"><span data-stu-id="41846-223">The Finance and Operations entity that is participating in the relationship doesn't exist as a virtual entity.</span></span>
- <span data-ttu-id="41846-224">リレーションシップの名前の長さは、92 文字を超えています。</span><span class="sxs-lookup"><span data-stu-id="41846-224">The length of the name of the relationship exceeds 92 characters.</span></span>

<span data-ttu-id="41846-225">Finance and Operations 仮想エンティティの一部が Dataverse で生成されたときにエラーが発生した場合 、仮想エンティティはまったく作成されません。</span><span class="sxs-lookup"><span data-stu-id="41846-225">Note that if an error is encountered when any part of a Finance and Operations virtual entity is generated in Dataverse, the virtual entity won't be created at all.</span></span> <span data-ttu-id="41846-226">上記のいずれかの理由でリレーションシップが存在しない場合は、エラーとは見なされません。</span><span class="sxs-lookup"><span data-stu-id="41846-226">If relationships don't exist for either of the preceding reasons, the situation isn't considered an error.</span></span>

### <a name="native-entitytonative-entity-relationships"></a><span data-ttu-id="41846-227">ネイティブ エンティティ - ネイティブ エンティティ リレーションシップ</span><span class="sxs-lookup"><span data-stu-id="41846-227">Native entity–to–native entity relationships</span></span>

<span data-ttu-id="41846-228">ネイティブ エンティティ - ネイティブ エンティティ リレーションシップは、関連するエンティティの GUID を使用してリレーションシップを解決する Dataverse の標準機能です。</span><span class="sxs-lookup"><span data-stu-id="41846-228">Native entity–to–native entity relationships are the standard Dataverse functionality, where relationships are resolved by using the GUID of the related entity.</span></span> <span data-ttu-id="41846-229">(この GUID はエンティティ キーです)。GUID によって、関連するエンティティの固有のエンティティ レコードが識別されます。</span><span class="sxs-lookup"><span data-stu-id="41846-229">(This GUID is the entity key.) The GUID identifies the unique entity record in the related entity.</span></span>

### <a name="virtual-tabletovirtual-table-relationships"></a><span data-ttu-id="41846-230">仮想テーブル - 仮想テーブル リレーションシップ</span><span class="sxs-lookup"><span data-stu-id="41846-230">Virtual table–to–virtual table relationships</span></span>

<span data-ttu-id="41846-231">2 つの Finance and Operations 仮想エンティティ間のリレーションシップは、Finance and Operations エンティティの関連メタデータによって駆動されます。</span><span class="sxs-lookup"><span data-stu-id="41846-231">The relationships between two Finance and Operations virtual entities are driven by the relation metadata in the Finance and Operations entities.</span></span> <span data-ttu-id="41846-232">前に説明したように、これらのリレーションは、仮想エンティティが生成されたときに Dataverse でリレーションシップとして生成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-232">As was explained earlier, these relations are generated as relationships in Dataverse when the virtual entity is generated.</span></span> <span data-ttu-id="41846-233">Dataverse のネイティブ エンティティの場合と同様、これらのリレーションシップでは GUID を使用して Finance and Operations のエンティティの固有レコードを識別します。</span><span class="sxs-lookup"><span data-stu-id="41846-233">As in the behavior for native entities in Dataverse, these relationships use the GUID to identify the unique record of the entity in Finance and Operations.</span></span> <span data-ttu-id="41846-234">意味的には、Finance and Operations 仮想エンティティの GUID は、ネイティブ Dataverse テーブル上で GUID と同じように動作します。</span><span class="sxs-lookup"><span data-stu-id="41846-234">Semantically, the GUID on the Finance and Operations virtual entity behaves like the GUID on the native Dataverse table.</span></span> <span data-ttu-id="41846-235">Finance and Operations 仮想エンティティの GUID の実装に関する情報については、このトピックで前述した[エンティティ キー/主キー](entity-modeling.md#entity-keyprimary-key)セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="41846-235">For information about the implementation of the GUID in Finance and Operations virtual entities, see the [Entity key/primary key](entity-modeling.md#entity-keyprimary-key) section earlier in this topic.</span></span>

<span data-ttu-id="41846-236">前の例では、関連するエンティティの GUID はエンティティ B のエンティティ キーであり、Finance and Operation でレコードを識別するクエリを作成するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="41846-236">In the preceding example, the GUID of the related entity is the entity key of Entity B and will be used to build queries to identify a record in Finance and Operation.</span></span> <span data-ttu-id="41846-237">エンティティ A とエンティティ B のリレーションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="41846-237">The relation that Entity A has to Entity B will be used.</span></span>

<span data-ttu-id="41846-238">したがって、実質的に、エンティティ名は、Finance and Operations から取得されるリレーションで使用される唯一の情報です。</span><span class="sxs-lookup"><span data-stu-id="41846-238">Therefore, in effect, the entity name is the only information that is used in a relation that comes from Finance and Operations.</span></span> <span data-ttu-id="41846-239">エンティティ名によって、関連エンティティの基本フィールドにアクセスできるようになり、ルックアップにそのエンティティを表示できるようになります。</span><span class="sxs-lookup"><span data-stu-id="41846-239">The entity name gives access to the primary field in the related entity, so that it can be shown in the lookup.</span></span> <span data-ttu-id="41846-240">また、関連するエンティティの GUID にアクセスできるため、前に説明したように、他のクエリで使用することができます。</span><span class="sxs-lookup"><span data-stu-id="41846-240">It also gives access to the GUID of the related entity, so that it can be used in other queries, as was explained earlier.</span></span> <span data-ttu-id="41846-241">リレーションが Finance and Operations エンティティで構築される実際のフィールドは、まったく使用されません。</span><span class="sxs-lookup"><span data-stu-id="41846-241">The actual field that the relation is built on in the Finance and Operations entity isn't used at all.</span></span>

### <a name="virtual-tabletonative-table-relationship"></a><span data-ttu-id="41846-242">仮想テーブル - ネイティブ テーブル リレーションシップ</span><span class="sxs-lookup"><span data-stu-id="41846-242">Virtual table–to–native table relationship</span></span>

<span data-ttu-id="41846-243">前に説明したように、GUID は、ネイティブ Dataverse テーブル (ネイティブ エンティティ - ネイティブ エンティティ リレーションシップ) または Finance and Operations 仮想エンティティ (仮想エンティティ - 仮想エンティティ リレーションシップ) 内のレコードを一意に識別するために使用される唯一の情報です。</span><span class="sxs-lookup"><span data-stu-id="41846-243">As was explained earlier, the GUID is the only information that is used to uniquely identify a record in a native Dataverse table (including in native entity–to–native entity relationships) or in a Finance and Operations virtual entity (including in virtual entity–to–virtual entity relationships).</span></span> <span data-ttu-id="41846-244">ただし、Dataverse のアカウント A の販売注文を Finance and Operations から表示する例について考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="41846-244">However, consider an example where you want to show sales orders from Finance and Operations for Account A in Dataverse.</span></span> <span data-ttu-id="41846-245">Dataverse では特定のアカウントに対して販売注文をフィルター処理する必要があるので、このリレーションシップにおいて Finance and Operations に送信されるクエリには、Dataverse のネイティブ アカウント エンティティの GUID に対する WHERE 句が含まれます。</span><span class="sxs-lookup"><span data-stu-id="41846-245">The query that is sent to Finance and Operations for this relationship will have a WHERE clause on the GUID of the entity key of the native accounts entity in Dataverse, because the sales orders must be filtered for a specific account in Dataverse.</span></span> <span data-ttu-id="41846-246">ただし、Finance and Operations には Dataverse のエンティティの GUID に関する情報が含まれていないため、クエリから販売注文が返されることはありません。</span><span class="sxs-lookup"><span data-stu-id="41846-246">However, because Finance and Operations doesn't have any information about the GUID of the entity in Dataverse, the query won't return any sales orders.</span></span> <span data-ttu-id="41846-247">クエリが成功するのは、Finance and Operations が理解するフィールドに基づく条件を WHERE 句に指定している場合のみです。</span><span class="sxs-lookup"><span data-stu-id="41846-247">The query will be successful only if the WHERE clause has conditions that are based on the fields that Finance and Operations understands.</span></span>

<span data-ttu-id="41846-248">したがって、Dataverse のアカウント エンティティの GUID を Finance and Operations 内のフィールドに置き換えることで、Finance and Operations に送信されるクエリが販売注文の正しい一覧を返すようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="41846-248">Therefore, how can the GUID of the accounts entity in Dataverse be replaced with fields that are in Finance and Operations, in such a way that the query that is sent to Finance and Operations will return the correct list of sales orders?</span></span>

<span data-ttu-id="41846-249">この問題を解決して、仮想エンティティ - ネイティブ エンティティのリレーションシップが許可される豊富なシナリオ セットを実現するには、このタイプのエンティティにリレーションシップを追加します。</span><span class="sxs-lookup"><span data-stu-id="41846-249">To solve this issue and enable a rich set of scenarios that allows for virtual entity–to–native entity relationships, relationships can be added to this type of entity.</span></span> <span data-ttu-id="41846-250">このリレーションは、仮想エンティティが同期されるときにリレーションシップとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="41846-250">The relation will appear as a relationship when the virtual entity is synced.</span></span>

<span data-ttu-id="41846-251">上の例では、SalesOrderHeader 仮想エンティティとアカウント ネイティブエンティティの間のリレーションシップは、アカウント番号と会社フィールドに基づいている必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-251">In the above example, the relationship between the SalesOrderHeader virtual entity and the Account native entity should be based on the Account Number and Company fields.</span></span> <span data-ttu-id="41846-252">既定では、Dataverse のネイティブ アカウント エンティティには会社フィールドがありません。</span><span class="sxs-lookup"><span data-stu-id="41846-252">By default, the native account entity in Dataverse does not have a company field.</span></span> <span data-ttu-id="41846-253">この例では、new_testcompany という会社ルックアップ フィールドを、ネイティブ アカウント エンティティに追加します。</span><span class="sxs-lookup"><span data-stu-id="41846-253">For this example, we will add a company lookup field named new_testcompany to the native Account entity.</span></span>

<span data-ttu-id="41846-254">次に、new_accountcompanyidx という名前の新しいキーを追加します。このキーは、accountnumber (new_testcompany) と Dataverse におけるそのアカウント エンティティの固有の行を表します。</span><span class="sxs-lookup"><span data-stu-id="41846-254">Next, we add a new key named new_accountcompanyidx, which specifies that (accountnumber, new_testcompany) together represent a unique row in the account entity in Dataverse.</span></span>

<span data-ttu-id="41846-255">次の手順では、X++ でこのリレーションシップを定義します。</span><span class="sxs-lookup"><span data-stu-id="41846-255">The next step is to define this relationship in X++.</span></span> <span data-ttu-id="41846-256">次の例は、サンプル X++ コードを示しています。</span><span class="sxs-lookup"><span data-stu-id="41846-256">The following example shows sample X++ code.</span></span> <span data-ttu-id="41846-257">フィールド、インデックス、およびマッピングの情報の名前は、Dataverse で作成されたフィールドとインデックスの名前と一致している必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-257">The names of the fields, index, and mapping information should match the names of the fields and indexes created in Dataverse.</span></span> <span data-ttu-id="41846-258">この例では、"synthaccount" という名前のリレーションシップが、仮想 SalesorderHeader エンティティと Dataverse 内のネイティブ アカウント エンティティの間に作成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-258">In this example, a relationship named “synthaccount” will be created between the virtual SalesorderHeader entity and the native account entity in Dataverse.</span></span> <span data-ttu-id="41846-259">マップされたフィールドは、new_accountcompanyidx インデックスを構成します。</span><span class="sxs-lookup"><span data-stu-id="41846-259">The mapped fields make up the new_accountcompanyidx index.</span></span> <span data-ttu-id="41846-260">リレーションシップの表示名は @SYS11307 になります。</span><span class="sxs-lookup"><span data-stu-id="41846-260">The display name for the relationship will be @SYS11307.</span></span> <span data-ttu-id="41846-261">表示名の先頭に円記号があることを確認します。</span><span class="sxs-lookup"><span data-stu-id="41846-261">Note the backslash at the start of the display name.</span></span> <span data-ttu-id="41846-262">これにより、ラベルがリレーションシップを定義して適切に変換されるようになります。</span><span class="sxs-lookup"><span data-stu-id="41846-262">This ensures that the label defines the relationship, so that it is appropriately translated.</span></span>

<span data-ttu-id="41846-263">フィールド マッピングは、仮想エンティティのフィールドが、ネイティブ エンティティのフィールドにマップされていることを示します。</span><span class="sxs-lookup"><span data-stu-id="41846-263">The field mapping indicates which field on the virtual entity maps to the field on the native entity.</span></span> <span data-ttu-id="41846-264">フィールド マッピングでは、キーが仮想エンティティ フィールドである、値がネイティブ エンティティ フィールドです。</span><span class="sxs-lookup"><span data-stu-id="41846-264">In the field mapping, the key is the virtual entity field, and the value is the native entity field.</span></span>

```x++
[CDSVirtualEntitySyntheticRelationshipAttribute('synthaccount', 'account', 'accountcompanyidx', '\@SYS11307')]
    public static Map syntheticAccountRelationship()
    {
        Map fieldMapping = new Map(Types::String, Types::String);

        // Assumes the Dataverse account entity has a key on [msdyn_accountnumber, msdyn_companyid]
        // Also assumes that the Dataverse cdm_Company entity has a key on [msdyn_companycode]
        fieldMapping.insert(fieldStr(CDSVirtualEntityTestEntity, StringField), 'msdyn_accountnumber');
        fieldMapping.insert(fieldStr(CDSVirtualEntityTestEntity, DataAreaId), 'msdyn_companyid');

        return fieldMapping;
    }
```
<span data-ttu-id="41846-265">次の手順では、仮想エンティティを生成または更新して、新しいリレーションシップを取得します。</span><span class="sxs-lookup"><span data-stu-id="41846-265">The next step is to generate or refresh the virtual entity to get the new relationship.</span></span> <span data-ttu-id="41846-266">仮想エンティティとネイティブ エンティティ間のリレーションシップは、作成された後 Dataverse では更新できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="41846-266">Note that relationships between a virtual entity and a native entity cannot be updated in Dataverse once it is created.</span></span> <span data-ttu-id="41846-267">更新を行う唯一の方法は、リレーションシップを物理的に削除し、エンティティを更新した後、問題を解決するためにそのエンティティを再度追加して再関連付けする方法です。</span><span class="sxs-lookup"><span data-stu-id="41846-267">The only way to make an update is to physically remove the relationship, refresh the entity, and then physically re-add the relationship in order to resolve the issue.</span></span>

<span data-ttu-id="41846-268">このリレーションシップは一般的な GUID ベースのリレーションシップに似ていますが、リレーションシップのクエリ フィルターをバッキング フィールドの制限に変換するための追加のメタデータがあります。</span><span class="sxs-lookup"><span data-stu-id="41846-268">This relationship looks like a typical GUID-based relationship, but has extra metadata to translate query filters on the relationship into restrictions on the backing fields.</span></span> <span data-ttu-id="41846-269">これで生成されたクエリには、Finance and Operations アプリが認識するフィールドに基づく WHERE 句が割り当てられ ます。</span><span class="sxs-lookup"><span data-stu-id="41846-269">The query that is now generated will have a WHERE clause that is based on the fields that Finance and Operations apps recognize.</span></span> <span data-ttu-id="41846-270">その後、クエリによって、フィルター処理された販売注文の一覧が正常に返されます。</span><span class="sxs-lookup"><span data-stu-id="41846-270">That query will then return the filtered list of sales orders, as expected.</span></span>

### <a name="native-entitytovirtual-entity-relationships"></a><span data-ttu-id="41846-271">ネイティブ エンティティ - 仮想エンティティ リレーションシップ</span><span class="sxs-lookup"><span data-stu-id="41846-271">Native entity–to–virtual entity relationships</span></span>

<!--HERE--><span data-ttu-id="41846-272">ネイティブ エンティティ - 仮想エンティティ リレーションシップは、ネイティブ エンティティ - ネイティブ エンティティ リレーションシップと同じように機能します。</span><span class="sxs-lookup"><span data-stu-id="41846-272">Native entity–to–virtual entity relationships works much like native entity–to–native entity relationships.</span></span> <span data-ttu-id="41846-273">ユーザーが Finance and Operations の仮想レコードにネイティブ レコードを関連付けると、その仮想エンティティの GUID がネイティブ エンティティ レコードに保存されます。</span><span class="sxs-lookup"><span data-stu-id="41846-273">Users associate native records with virtual records in Finance and Operations, and the GUID of the virtual entity is saved on the native entity record.</span></span> <span data-ttu-id="41846-274">既に説明したように、リレーションシップに参加するエンティティには、関連するエンティティの GUID フィールドが含まれます。</span><span class="sxs-lookup"><span data-stu-id="41846-274">As was explained earlier, the entities that participate in a relationship will have the GUID field of the related entity on them.</span></span> <span data-ttu-id="41846-275">したがって、Dataverse の見積が Finance and Operations 仮想エンティティ内の顧客に関連付けられている場合は、顧客の仮想エンティティの GUID が見積エンティティに保存されます。</span><span class="sxs-lookup"><span data-stu-id="41846-275">Therefore, when a quotation in Dataverse is associated with a customer in a Finance and Operations virtual entity, the GUID of the customer virtual entity will be saved in the quotation entity.</span></span> <span data-ttu-id="41846-276">この動作により、標準の Dataverse 機能を使用してレコードを予想どおりに取得できます。</span><span class="sxs-lookup"><span data-stu-id="41846-276">This behavior enables records to be retrieved as expected, by using standard Dataverse functionality.</span></span>

## <a name="enums"></a><span data-ttu-id="41846-277">列挙</span><span class="sxs-lookup"><span data-stu-id="41846-277">Enums</span></span>

<span data-ttu-id="41846-278">Finance and Operations の列挙型は、Dataverse の OptionSet としてモデル化されています。</span><span class="sxs-lookup"><span data-stu-id="41846-278">Enums in Finance and Operations are modeled as OptionSets in Dataverse.</span></span> <span data-ttu-id="41846-279">Finance and Operations の仮想エンティティが生成されると、必要な列挙は OptionSet として生成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-279">When a virtual entity for Finance and Operations is generated, the required enums are generated as OptionSets.</span></span> <span data-ttu-id="41846-280">OptionSet が既に存在する場合は、代わりに使用されます。</span><span class="sxs-lookup"><span data-stu-id="41846-280">If an OptionSet already exists, it's used instead.</span></span>

## <a name="company"></a><span data-ttu-id="41846-281">法人</span><span class="sxs-lookup"><span data-stu-id="41846-281">Company</span></span>

<span data-ttu-id="41846-282">Finance and Operations のエンティティは、会社にバインドすることも、グローバルにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="41846-282">An entity in Finance and Operations can be bound to a company, or it can be global.</span></span> <span data-ttu-id="41846-283">会社にバインドされている Finance and Operations エンティティの仮想エンティティは、Dataverse の cdm\_company エンティティとのリレーションシップを持ちます。</span><span class="sxs-lookup"><span data-stu-id="41846-283">The virtual entity for a Finance and Operations entity that is bound to a company will have a relationship to the cdm\_company entity in Dataverse.</span></span> <span data-ttu-id="41846-284">cdm\_company エンティティは、Dataverse におけるネイティブ エンティティで あり、Dynamics365Company ソリューションの一部です。</span><span class="sxs-lookup"><span data-stu-id="41846-284">The cdm\_company entity is a native entity in Dataverse and is part of the Dynamics365Company solution.</span></span> <span data-ttu-id="41846-285">通常と同様、リレーションシップが作成されると、関連するエンティティ (この場合は cdm\_company) の仮想エンティティにも検索フィールドが作成されます。</span><span class="sxs-lookup"><span data-stu-id="41846-285">As always, when a relationship is created, a lookup field is also created in the virtual entity for the related entity (cdm\_company in this case).</span></span> <span data-ttu-id="41846-286">このルックアップ フィールドは **会社** という名前であり、ユーザーがリストの値を選択したり、関連するレコードの詳細に移動したりできるように、最適なユーザー エクスペリエンスを提供するために使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-286">This lookup field is named **Company**, and it must be used to provide an optimal user experience where users can select a value in a list or go to the details of the related record.</span></span> <span data-ttu-id="41846-287">**会社コード** と呼ばれるフィールドは、仮想エンティティにも追加されます。</span><span class="sxs-lookup"><span data-stu-id="41846-287">A field that is named **Company Code** is also added in the virtual entity.</span></span> <span data-ttu-id="41846-288">この値は 4 文字の文字列です。</span><span class="sxs-lookup"><span data-stu-id="41846-288">The value is a four-character string.</span></span> <span data-ttu-id="41846-289">このフィールドは、プログラミングで使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-289">This field must be used in programming.</span></span>

## <a name="attachments"></a><span data-ttu-id="41846-290">アタッチメント</span><span class="sxs-lookup"><span data-stu-id="41846-290">Attachments</span></span>

<span data-ttu-id="41846-291">Finance and Operations エンティティの添付ファイルは、エンティティごとにサポートされます。</span><span class="sxs-lookup"><span data-stu-id="41846-291">Attachments in Finance and Operations entities are supported on a per-entity basis.</span></span> <span data-ttu-id="41846-292">たとえば、請求書ヘッダー エンティティは、[エンティティを通じて添付ファイルを有効](../../fin-ops/organization-administration/configure-document-management.md#how-can-attachments-be-extracted-from-the-system)にするために、請求書に関連する添付ファイル エンティティを実装します。</span><span class="sxs-lookup"><span data-stu-id="41846-292">For example, an invoice header entity will implement an invoice-related attachments entity to [enable attachments via entities](../../fin-ops/organization-administration/configure-document-management.md#how-can-attachments-be-extracted-from-the-system).</span></span>

<span data-ttu-id="41846-293">このタイプのエンティティは、Finance and Operations の対応する添付ファイル エンティティとのリレーションを持ちます。</span><span class="sxs-lookup"><span data-stu-id="41846-293">Entities of this type will have relations with the corresponding attachments entity in Finance and Operations.</span></span> <span data-ttu-id="41846-294">したがって、これらは前に説明した他の関係と同じパターンに従います。</span><span class="sxs-lookup"><span data-stu-id="41846-294">Therefore, they will follow the same pattern as the other relations that were discussed earlier.</span></span> <span data-ttu-id="41846-295">つまり、添付ファイル機能が実装されている Finance and Operations エンティティは、仮想エンティティを使用して添付ファイルを使用できるようにします。</span><span class="sxs-lookup"><span data-stu-id="41846-295">In other words, Finance and Operations entities that have implemented attachments functionality will also make attachments available by using virtual entities.</span></span> <span data-ttu-id="41846-296">添付ファイルをサポートしていない Finance and Operations エンティティは、Dataverse で仮想化された添付ファイルもサポートしません。</span><span class="sxs-lookup"><span data-stu-id="41846-296">Finance and Operations entities that don't support attachments also won't support attachments when they are virtualized in Dataverse.</span></span>

<span data-ttu-id="41846-297">Finance and Operations 仮想エンティティでサポートされるのは、添付ファイルの読み取りだけであることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="41846-297">Note that Finance and Operations virtual entities support only the reading of attachments.</span></span> <span data-ttu-id="41846-298">現在、仮想エンティティを使用した添付ファイルの作成、更新、または削除はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="41846-298">They don't currently support the creation, update, or deletion of attachments by using virtual entities.</span></span>

## <a name="odata-actions"></a><span data-ttu-id="41846-299">OData アクション</span><span class="sxs-lookup"><span data-stu-id="41846-299">OData actions</span></span>

<span data-ttu-id="41846-300">Finance and Operations エンティティの OData アクションは、Dataverse のカスタム アクションとして使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="41846-300">OData actions in the Finance and Operations entities are made available as custom actions in Dataverse.</span></span> <span data-ttu-id="41846-301">カスタム アクションと Dataverse での使用方法の詳細については、[カスタム アクション](https://docs.microsoft.com/powerapps/developer/common-data-service/custom-actions)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="41846-301">For more information about custom actions and what they enable in Dataverse, see [Custom actions](https://docs.microsoft.com/powerapps/developer/common-data-service/custom-actions).</span></span>

<span data-ttu-id="41846-302">次のタイプの入力パラメーターと出力パラメーターがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="41846-302">Input and output parameters of the following types are supported.</span></span> <span data-ttu-id="41846-303">入力または出力パラメーターのタイプが異なる場合、OData アクションは Dataverse の SDK メッセージとして表示されません。</span><span class="sxs-lookup"><span data-stu-id="41846-303">If an input or output parameter is of a different type, the OData action doesn't appear as the SDK message in Dataverse.</span></span>

- <span data-ttu-id="41846-304">整数</span><span class="sxs-lookup"><span data-stu-id="41846-304">Integer</span></span>
- <span data-ttu-id="41846-305">文字列</span><span class="sxs-lookup"><span data-stu-id="41846-305">String</span></span>
- <span data-ttu-id="41846-306">Guid</span><span class="sxs-lookup"><span data-stu-id="41846-306">Guid</span></span>
- <span data-ttu-id="41846-307">ブール値</span><span class="sxs-lookup"><span data-stu-id="41846-307">Boolean</span></span>
- <span data-ttu-id="41846-308">Date/Datetime</span><span class="sxs-lookup"><span data-stu-id="41846-308">Date/Datetime</span></span>

<span data-ttu-id="41846-309">以下は、Finance and Operations エンティティでサポートされる OData アクションの例ですが、Dataverse の対応する仮想エンティティではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="41846-309">Here are some examples of OData actions that are supported in Finance and Operations entities, but that aren't supported in the corresponding virtual entities in Dataverse:</span></span>

- <span data-ttu-id="41846-310">RetailStoreTenderTypeTable.queryDistinctTenderTypeIdAndName (RetailStoreTenderTypeTable エンティティのコレクション)</span><span class="sxs-lookup"><span data-stu-id="41846-310">RetailStoreTenderTypeTable.queryDistinctTenderTypeIdAndName (a collection of RetailStoreTenderTypeTable entity)</span></span>
- <span data-ttu-id="41846-311">DocumentRoutingClientApp.syncPrinters (DocumentRoutingClientApp エンティティ)</span><span class="sxs-lookup"><span data-stu-id="41846-311">DocumentRoutingClientApp.syncPrinters (DocumentRoutingClientApp entity)</span></span>
- <span data-ttu-id="41846-312">DocumentRoutingClientApp.updateJobStatus (DocumentRoutingJobStatus 列挙)</span><span class="sxs-lookup"><span data-stu-id="41846-312">DocumentRoutingClientApp.updateJobStatus (DocumentRoutingJobStatus enum)</span></span>
- <span data-ttu-id="41846-313">DimensionCombination.getCombinationDisplayValue (LedgerJournalACType 列挙)</span><span class="sxs-lookup"><span data-stu-id="41846-313">DimensionCombination.getCombinationDisplayValue (LedgerJournalACType enum)</span></span>

## <a name="labels-and-localization"></a><span data-ttu-id="41846-314">ラベルとローカライズ</span><span class="sxs-lookup"><span data-stu-id="41846-314">Labels and localization</span></span>

<span data-ttu-id="41846-315">Finance and Operations のエンティティ名やフィールド名など、メタデータに定義されているラベルは、Dataverse で仮想エンティティが生成されたときに取得されます。</span><span class="sxs-lookup"><span data-stu-id="41846-315">Labels that are defined on metadata, such as entity names and field names in Finance and Operations, are retrieved when virtual entities are generated in Dataverse.</span></span> <span data-ttu-id="41846-316">ラベルは、Dataverse にインストールされている言語ロケールの一覧を渡すことによって取得されます。</span><span class="sxs-lookup"><span data-stu-id="41846-316">The labels are retrieved by passing the list of language locales that are installed in Dataverse.</span></span> <span data-ttu-id="41846-317">Finance and Operations は、Dataverse でラベル インスタンスを構築するために使用される、ロケール/値セットの一覧として各ラベルを返します。</span><span class="sxs-lookup"><span data-stu-id="41846-317">Finance and Operations returns each label as a list of locale/value sets that are then used to construct a label instance in Dataverse.</span></span> <span data-ttu-id="41846-318">エンティティの生成または更新時に存在する言語パックのみが含まれます。</span><span class="sxs-lookup"><span data-stu-id="41846-318">Only the language packs that exist at the time of entity generation or update are included.</span></span> <span data-ttu-id="41846-319">また、Finance and Operations には翻訳が提供されたラベルのみが含まれます。</span><span class="sxs-lookup"><span data-stu-id="41846-319">Additionally, only labels that Finance and Operations has provided a translation for are included.</span></span> <span data-ttu-id="41846-320">欠落している翻訳がある場合、ラベル ID に戻されます (**\@SYS:DataEntity** など)。</span><span class="sxs-lookup"><span data-stu-id="41846-320">Any missing translations revert to the label ID, such as **\@SYS:DataEntity**.</span></span> <span data-ttu-id="41846-321">Dataverse に新しい言語パックをインストールした後、その言語のラベルが Finance and Operations に存在する場合は、新しいラベル情報を取得するように既存のエンティティを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="41846-321">After a new language pack is installed in Dataverse, existing entities must be updated to pick up the new label information, if labels in that language exist in Finance and Operations.</span></span>

<span data-ttu-id="41846-322">ランタイム ラベルは、現在のユーザー コンテキストの言語で返されます。</span><span class="sxs-lookup"><span data-stu-id="41846-322">Any runtime labels are returned in the language of the current user context.</span></span> <span data-ttu-id="41846-323">つまり、Finance and Operations でそのユーザーの UserInfo レコードに指定されている言語で返されます。</span><span class="sxs-lookup"><span data-stu-id="41846-323">In other words, they are returned in the language that is specified on that user's UserInfo record in Finance and Operations.</span></span> <span data-ttu-id="41846-324">この動作は、エラー メッセージにも適用されます。</span><span class="sxs-lookup"><span data-stu-id="41846-324">This behavior also applies to error messages.</span></span>

## <a name="error-handling"></a><span data-ttu-id="41846-325">エラー処理</span><span class="sxs-lookup"><span data-stu-id="41846-325">Error handling</span></span>

<span data-ttu-id="41846-326">Dataverse の仮想エンティティを介してが呼び出されたときに、エンティティに対するビジネス ロジックの作成、読み取り、更新、および削除 (CRUD) を Finance and Operations が行い、バッキング テーブルが実行されます。</span><span class="sxs-lookup"><span data-stu-id="41846-326">Finance and Operations create, read, update, and delete (CRUD) business logic on entities and backing tables is run when it's called through the virtual entity in Dataverse.</span></span> <span data-ttu-id="41846-327">いずれかの例外が Finance and Operations 側でスローされた場合は、エラー ログの最後のメッセージが Dataverse に戻され、Finance and Operations からのメッセージを含む InvalidPluginExecutionException 例外としてスローされます。</span><span class="sxs-lookup"><span data-stu-id="41846-327">If any exception is thrown on the Finance and Operations side, the last message in the error log is returned to Dataverse and is thrown as an InvalidPluginExecutionException exception that contains the message from Finance and Operations.</span></span> <span data-ttu-id="41846-328">Finance and Operations コードはユーザーのコンテキストで実行されるため、エラー メッセージの言語は、Finance and Operations の UserInfo レコードで指定されている言語に基づきます。</span><span class="sxs-lookup"><span data-stu-id="41846-328">Because the Finance and Operations code runs in the context of the user, the language of the error message is based on the language that is specified on the UserInfo record in Finance and Operations.</span></span> <span data-ttu-id="41846-329">Finance and Operations で情報ログに書き込まれたメッセージに対して例外が発生しなかった場合、Dataverse には表示されません。</span><span class="sxs-lookup"><span data-stu-id="41846-329">If any messages that are written to the info log in Finance and Operations don't result in an exception, they aren't shown in Dataverse.</span></span>

## <a name="calculatedunmapped-fields"></a><span data-ttu-id="41846-330">計算済み/マップ解除済みフィールド</span><span class="sxs-lookup"><span data-stu-id="41846-330">Calculated/unmapped fields</span></span>

<span data-ttu-id="41846-331">Finance and Operations エンティティの計算されたフィールドとマップされていないフィールドは、Dataverse の対応する仮想エンティティでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="41846-331">Calculated and unmapped fields in Finance and Operations entities are also available in the corresponding virtual entities in Dataverse.</span></span>


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]