---
title: ER テンプレートのバックアップストレージ
description: このトピックでは、テンプレートの復旧に電子申告 (ER) バックアップストレージを使用する方法について説明します。
author: NickSelin
ms.date: 04/29/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ERWorkspace, ERSolutionTable
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 27621
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2019-08-13
ms.dyn365.ops.version: 10.0.5
ms.openlocfilehash: b41760bb58cbef66146b3f1af6f30c6a35a18727
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5743850"
---
# <a name="backup-storage-of-er-templates"></a>ER テンプレートのバックアップストレージ

[!include [banner](../includes/banner.md)]

[電子申告 (ER) の概要](general-electronic-reporting.md) を使用して、ビジネス ユーザーはさまざまな国/地域の法的要件に従って発信ドキュメントの形式を構成できます。 構成された ER 形式では、定義済みのテンプレートを使用して Microsoft Excel、workbooks、Microsoft Word ドキュメント、PDF ドキュメントなど、さまざまな形式で送信ドキュメントを生成できます。 テンプレートには、生成されたドキュメントに対して構成されたデータフローに必要なデータが入力されます。

ER ソリューションの一部として、構成された各形式を公開できます。 各 ER ソリューションは、Finance and Operations の 1 つのインスタンスからエクスポートして、別のインスタンスにインポートできます。

ER フレームワークでは、[ドキュメント管理の構成](../../fin-ops/organization-administration/configure-document-management.md) を使用して、現在の Finance and Operations インスタンスに必要なテンプレートを保持します。 ER フレームワークの設定に応じて、Microsoft Azure Blob ストレージまたは Microsoft SharePoint フォルダをテンプレートの物理的なプライマリ ストレージの場所として選択できます。 (詳細については、[電子申告 (ER) フレームワークの構成](electronic-reporting-er-configure-parameters.md) を参照してください。) DocuValue テーブルには、各テンプレートの個々のレコードが保持されます。 各レコードの **AccessInformation** フィールドには、構成されている保管場所にあるテンプレートファイルのパスが格納されます。

Finance and Operations インスタンスを管理する場合、現在のインスタンスを別の場所に移行する必要性が発生する場合があります。 たとえば、本番インスタンスを新しいサンドボックス環境に移行するかもしれません。 テンプレートを Blob ストレージに保存するように ER フレームワークを構成した場合、新しいサンドボックス環境の DocuValue テーブルは、本番環境の Blob ストレージのインスタンスを参照します。 ただし、移行プロセスでは、Blob ストレージ内のアーティファクトの移行をサポートしていないため、このインスタンスにサンドボックス環境からアクセスすることはできません。 したがって、テンプレートを使用して ER 形式を実行してビジネスドキュメントを生成すると、例外が発生し、テンプレートが欠落していることについて通知されます。 また、ER クリーンアップ ツールを使用して、テンプレートを含む ER 形式の構成を削除してから再インポートする方法も紹介しています。 ER 形式の構成が複数存在する場合があるため、このプロセスには時間がかかる場合があります。

ER テンプレート機能のバックアップ ストレージを使用すると、テンプレートを使用して、常にビジネス ドキュメントを生成するためのテンプレートを作成できます。

> [!NOTE]
> この機能は、ER テンプレートの物理的な保管場所として Blob ストレージが選択されている場合にのみ使用できます。

## <a name="automated-recovery-and-notification"></a>自動回復と通知

この機能では、次のイベントが発生すると、現在の環境の新しい ER 形式の構成のすべてのテンプレートが、テンプレートのバックアップ保存場所 (ERDocuDatabaseStorage データベース テーブル) に自動的に保存されます。

- テンプレートを含む新しい ER 形式構成をインポートします。
- テンプレートを含む ER 形式構成の下書きバージョンを完了します。

テンプレートのバックアップ コピーは、アプリケーション データベースの一部として Finance and Operations の新しいインスタンスに移行されます。

たとえば、支払通知やコントロール レポートを生成する場合など、発信ドキュメントの生成に ER 形式のテンプレートが必要だが、基本の保管場所に必要なテンプレートが見つからない場合は、次のイベントが発生します。

- バックアップの保存場所でテンプレートが使用できる場合は、自動的にバックアップの保存場所から取得され、主な保管場所に復元され、現在の実行に使用されます。
- **電子申告開発者** または **システム管理者** のロールに割り当てられているすべてのユーザーには、アクション センターによって不足しているテンプレートの問題が通知されます。 表示されるメッセージは、**破損したテンプレートをバッチで復元する手順を自動的に実行する** パラメーターの値によって異なります。

    - このパラメーターが **Off** に設定されている場合、メッセージはバッチ処理を開始して、他の ER 形式の構成テンプレートの類似した問題を自動的に修正することを推奨します。 このメッセージには、バッチ処理を開始するために使用できるリンクが含まれています。
    - このパラメーターを **On** に設定すると、不足しているテンプレートの問題が検出されたことと、新しいバッチ処理、**破損したテンプレートの内部データベースバックアップからの復元** が自動的にスケジュールされたことを知らせるメッセージが通知されます。 このバッチ処理によって、他のテンプレートの同様の問題が自動的に修正されます。

**破損したテンプレートをバッチで復元する手順を自動的に実行する** パラメーターを設定するには、次の手順を実行します:

1. Finance and Operations で、 **組織管理  \> 電子申告 \> 構成ページ** を開きます。
2. **構成** ページ、アクション ウィンドウ、**構成** タブ、**詳細設定** グループで、**ユーザー パラメーター** を選択します。
3. **ユーザー パラメーター** ダイアログ ボックスで、**破損したテンプレートをバッチで復元する手順を自動的に実行する** パラメーターに必要な値を設定します。

> [!NOTE]
> このパラメーターは、アプリケーションユーザーとして定義され、会社に固有のログに記録されます。

![ER コンフィギュレーション ページ](./media/GER-BackupTemplates-1.png)

次の図は、**破損したテンプレートをバッチで復元する手順を自動的に実行する** パラメーターが **On** に設定されている場合に表示されるメッセージの例を示しています。

![仕入先支払仕訳帳明細ページ](./media/GER-BackupTemplates-2.png)

次の図は、**バッチ ジョブ** ページの **破損したテンプレートの内部データベース バックアップからの復元** バッチ処理を示しています。

![バッチ ジョブのページ](./media/GER-BackupTemplates-3.png)

完了した **破損したテンプレートの内部データベース バックアップからの復元** バッチ処理の実行ログには、バックアップの保存場所からプライマリ ストレージの場所に復元されたテンプレートに関する情報が含まれます。

![バッチ ジョブ履歴ページ](./media/GER-BackupTemplates-4.png)

既定では、ER 形式の構成に存在するテンプレートのバックアップ コピーを自動的に作成するプロセスが有効になっています。 テンプレートのバックアップ コピーを停止するには、**電子申告のパラメーター** ページの **添付** タブで、**テンプレートのバックアップ コピーの作成を停止する** オプションを **はい** に設定します。 **電子申告** ワークスペースから、このページを開くことができます。

**テンプレートのバックアップ コピーの作成を停止する** オプションを **はい** に設定したが、以前にテンプレートで作成したバックアップ コピーを保持しないように設定する場合は、**電子申告のパラメーター** ページで **バックアップ ストレージのクリーンアップ** を選択します。

環境を Finance and Operations  バージョン 10.0.5 (2019 年 10 月) にアップグレードして、実行可能な ER 形式の構成を含む新しい環境に移行する場合は、移行をする前に **電子申告のパラメーター** ページで **バックアップ ストレージに入力する** を選択します。 このボタンをクリックすると、使用可能なすべてのテンプレートのバックアップ コピーを作成するプロセスが開始され、テンプレートの ER バックアップ保存場所に保存できるようになります。

![電子申告のパラメーター ページ](./media/GER-BackupTemplates-5.png)

## <a name="manual-recovery"></a>手動による回復

**組織管理** \> **電子レポート** \> **破損したテンプレートの復元** に移動し、バックアップ ストレージの場所からプライマリ ストレージの場所に ER のテンプレートを復元するプロセスを手動で開始します。 このプロセスを開始する前に、**破損したテンプレートの復元** ページで同プロセスを対話的に実行するか、バッチプロセスをスケジュールするかを指定できます。

## <a name="supported-deployments"></a>サポートされている配置

Finance and Operations バージョン 10.0.5 では、ER テンプレートのバックアップ保存機能はクラウド配置でのみ使用できます。

## <a name="additional-resources"></a>追加リソース

[電子申告 (ER) の概要](general-electronic-reporting.md)

[電子申告 (ER) フレームワークの構成](electronic-reporting-er-configure-parameters.md)


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]