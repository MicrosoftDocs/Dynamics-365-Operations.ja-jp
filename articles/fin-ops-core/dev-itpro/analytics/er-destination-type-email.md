---
title: ER 電子メール送信先のタイプ
description: このトピックでは、電子申告 (ER) 形式の各フォルダーまたはファイル コンポーネントに対して電子メール送信先を構成する方法について説明します。
author: NickSelin
ms.date: 08/03/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: DocuType, ERSolutionTable, ERFormatDestinationTable
audience: Application User
ms.reviewer: kfend
ms.custom: 97423
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-05-31
ms.dyn365.ops.version: AX 7.0.1
ms.openlocfilehash: 2248b8a35b076eb778a50bbbc67d083380ceee62
ms.sourcegitcommit: d5d6b81bd8b08de20cc018c2251436065982489e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/17/2022
ms.locfileid: "8324011"
---
# <a name="email-er-destination-type"></a>ER 電子メール送信先のタイプ

[!include [banner](../includes/banner.md)]

電子申告 (ER) 形式を実行すると、1 つ以上の発信ドキュメントを生成できます。 **フォルダー** または **ファイル** 形式コンポーネントは、送信ドキュメントの構造を指定するために ER フォーマットで使用されます。 これらのタイプのコンポーネントの電子メールの送信先を構成して、送信ドキュメントを電子メールの添付ファイルとして送信できます。

ER 形式の **フォルダー** または **ファイル** コンポーネントごとに電子メールの送信先を構成できます。 この場合、**各送信ドキュメントは個別に電子メールで送信されます**。 この送信先の設定に基づいて、生成されたドキュメントは電子メールの添付ファイルとして送信されます。 

> [!NOTE]
> ドキュメントが生成されない場合は、関連する **ファイル** コンポーネントの **Enabled** 式が **False** のブール値を返すように構成されているため、電子メールの送信先がコンポーネントに構成されて有効になっていても、電子メールは送信されません。

複数の **フォルダ** コンポーネントまたは **ファイル** コンポーネントをまとめて [グループ化](#grouping) し、グループ内のすべてのコンポーネントに電子メールの送信先を構成することもできます。 この場合、グループに属するコンポーネントによって生成されるすべての発信ドキュメントは、**1 つの電子メールの複数の添付ファイルとして送信されます**。 この送信先の設定に基づいて、各生成されたドキュメントは、1 つの電子メールの添付ファイルとして送信されます。

> [!NOTE]
> 少なくとも 1 つのドキュメントが、コンポーネントのグループの **ファイル** コンポーネントで生成されると、電子メールが送信されます。 ドキュメントが、グループ化されたコンポーネントによって生成されない場合は、各 **ファイル** コンポーネントの **Enabled** 式が **False** のブール値を返すように構成されているため、電子メールの送信先が、そのコンポーネントのグループに構成されて有効になっていても、電子メールは送信されません。
>
> **電子メール** は、コンポーネントのグループに対して構成できる唯一の送信先です。 グループの電子メールの送信先設定に基づいて、電子メールでドキュメントを送信するには、送信先レコードをもう 1 つ追加し、必要なコンポーネントを選択して、このレコードの別の送信先を構成します。

1 つの ER 形式構成に対して、複数のコンポーネント グループを構成できます。 このようにして、コンポーネントのグループごとに電子メールの送信先を構成し、コンポーネントごとに電子メールの送信先を構成できます。

## <a name="enable-an-email-destination"></a>電子メール送信先の有効化

1 つ以上の出力ファイルを電子メールで送信するには、次の手順に従います。

1. **電子申告の送信先** ページの **ファイルの送信先** クイックタブで、グリッド内のコンポーネントまたはコンポーネントのグループを選択します。
2. **設定** を選択し、表示される **送信先設定** ダイアログ ボックスの **電子メール** タブで、**有効** オプションを **はい** に設定します。

[![電子メールの送信先に対して有効オプションをはいに設定する。](./media/ER_Destinations-EnableSingleDestination.png)](./media/ER_Destinations-EnableSingleDestination.png)

## <a name="configure-an-email-destination"></a>電子メール送信先の構成

### <a name="email-content"></a>電子メールの内容

電子メール メッセージの件名および本文を編集できます。

**件名** フィールドに、実行時に生成される電子メール メッセージの件名フィールドに表示されるメールの件名のテキストを入力します。 **本文** フィールドに、電子メール メッセージの本文フィールドに表示されるメールの本文のテキストを入力します。 電子メールの件名および本文の定型文を設定したり、ER [フォーミュラ](er-formula-language.md) を使用して実行時に電子メールのテキストを動的に作成したりできます。 構成済みのフォーミュラは、[文字列](er-formula-supported-data-types-primitive.md#string) 型の値を返す必要があります。

電子メールの本文は、電子メール クライアントに応じてテキスト形式または HTML 形式で構成されます。 HTML およびインライン カスケードスタイルシート (CSS) で使用できる任意のレイアウト、スタイル、ブランディングを使用できます。

> [!NOTE]
> 電子メール クライアントにはレイアウトやスタイルの制限があり、メッセージ本文に使用するHTMLや CSS の調整が必要となる場合があります。 人気の高い電子メール クライアントによってサポートされている HTML を作成するためのベスト プラクティスについて理解しておくことをお勧めします。
>
> 本文の形式に応じて、正しいエンコードを使用してキャリッジ リターンを実装します。 詳細については、[文字列](er-formula-supported-data-types-primitive.md#string) データ型の説明を参照してください。

### <a name="email-addresses"></a>電子メール アドレス

そこで、電子メールの送信者と受信者を指定できます。 既定では、現在のユーザーに代わって電子メールが送信されます。 別の電子メールの送信者を指定するには、**送信者** フィールドを構成する必要があります。

> [!NOTE]
> 電子メールの出力先が構成されている場合は、`ERFormatDestinationSenderEmailConfigure` セキュリティ特権を持つユーザーだけが **送信者** フィールドを表示し、**ER 形式の出力先に対して送信者の電子メール アドレスを構成します**。
>
> 電子メールの宛先が [実行時](electronic-reporting-destinations.md#security-considerations)に変更のために提供される場合、**差出人** フィールドは、`ERFormatDestinationSenderEmailMaintain` セキュリティ特権を持つユーザーにのみ表示されます。**ER 形式の宛先の送信者の電子メール アドレスを維持します**。
>
> **差出人** フィールドが現在のユーザー以外のメール アドレスを使用するように構成されている場合は、**送信者** または **代理送信** のいずれかのアクセス許可を事前に正しく[設定](/microsoft-365/solutions/allow-members-to-send-as-or-send-on-behalf-of-group)する必要があります。 それ以外の場合は、実行時に次の例外がスローされます。「\<current user account\> アカウントから \<from email account\> として電子メールを送信できません。\<from email account\> からの「送信」権限を確認してください。」

**送信元** フィールドで複数のメール アドレスを返す場合に使用できます。 この場合、リストの最初のアドレスが電子メールの送信者アドレスとして使用されます。

電子メールの受信者を指定するには、**宛先** フィールドと **CC** (オプション) フィールドを構成する必要があります。

2 つの方法で ER の電子メール アドレスを構成できます。 構成は、印刷管理機能と同じ方法で完了することができます。または、フォーミュラで ER 構成への直接参照を使用してメール アドレスを解決することもできます。

## <a name="email-address-types"></a>電子メール アドレス タイプ

**宛先設定** ダイアログ ボックスの **差出人**、**宛先**、または **CC** フィールドの横にある **編集** を選択すると、適切な **メールの差出人**、**メールの宛先**、または **メールの CC** ダイアログ ボックスが表示されます。 そこで、電子メールの送信者と受信者を構成できます。 **追加** を選択して、使用するメール アドレスのタイプを選択します。 現在、次の 2 つのタイプがサポートされています: **印刷管理メール** および **構成メール**。

[![メール アドレスのタイプの選択。](./media/ER_Destinations-EmailSelectAddressType.png)](./media/ER_Destinations-EmailSelectAddressType.png)

### <a name="print-management-email"></a>管理電子メールの印刷

メール アドレス タイプとして **印刷管理メール** を選択した場合は、次のフィールドを設定して、**メールの差出人**、**メールの宛先** または **メールの CC** ダイアログ ボックスに固定のメール アドレスを入力できます。

- **電子メールの送信元** フィールドで、**なし** を選択します。
- **";" で区切られた追加のメール アドレス** に、固定のメール アドレスを入力します。

または、送信ドキュメントを生成する関係者の連絡先の詳細からメール アドレスを取得することもできます。 固定していないメール アドレスを使用するには、**電子メールの送信元** フィールドで、ファイルの送信先となる関係者の [ロール](../../fin-ops/organization-administration/overview-global-address-book.md#party-roles) を選択します。 サポートされているロールは、次のとおりです:

- 顧客
- 仕入先
- 見込顧客
- 連絡
- 競合他社
- ワーカー
- 申請者
- 見込み仕入先
- 不許可仕入先
- 個法

たとえば、仕入先支払の処理に使用される ER 形式の電子メールの送信先を構成するには、**仕入先** ロールを選択します。

目的のロールを選択したら、**電子メールの送信元アカウント** フィールドの横にある **バインド** ボタン (チェーン記号) を選択して、[フォーミュラ デザイナー](general-electronic-reporting-formula-designer.md) ページを開きます。 その後、このページを使用して、実行時に、構成されたロールに割り当てられた関係者のアカウント番号を、処理されたドキュメントから電子メールの送信先に返すフォーミュラを構成できます。

> [!NOTE]
> フォーミュラは ER コンフィギュレーションに固有です。

**フォーミュラ デザイナー** ページの **フォーミュラ** フィールドに、サポートされているロールへのドキュメント固有の参照を入力します。 参照を入力する代わりに、**データ ソース** ペインで、構成されたロールのアカウントを表すデータ ソース ノードを検索して選択し、**データ ソースの追加** を選択して、フォーミュラを更新します。 たとえば、仕入先の支払処理に使用する **ISO 20022 の口座振替** 構成の電子メールの送信先を構成する場合、仕入先アカウントを表すノードは `'$PaymentsForCoveringLetter'.Creditor.Identification.SourceID` です。

![電子メールの送信元アカウントの構成。](./media/er_destinations-emaildefineaddresssource.gif)

構成されたロールのアカウント番号が、Microsoft Dynamics 365 Finance のインスタンス全体に対して一意である場合、**電子メールの送信先** ダイアログ ボックスの **電子メールの送信元の会社** フィールドは、空白のままにできます。

または、[グローバルアドレス帳](../../fin-ops/organization-administration/overview-global-address-book.md) のさまざまな関係者が、異なる会社 ([法人](../../fin-ops/organization-administration/organizations-organizational-hierarchies.md#legal-entities)) に登録されているために、すべて同じアカウント番号を使用して、構成されたロールを満たしている場合もあります。 この場合、構成されたロールのアカウント番号は、Finance インスタンス全体で一意ではありません。 したがって、明示的に関係者を選択する場合は、アカウント番号のみを指定することはできません。 また、構成されたロールを果たすために、関係者の範囲内に登録されている会社を指定する必要もあります。 **電子メールの送信先** ダイアログ ボックスの **電子メールの送信元の会社** フィールドの横にある **バインド** ボタン (チェーン記号) を選択して、[フォーミュラ デザイナー](general-electronic-reporting-formula-designer.md) ページを開きます。 その後、このページを使用して、実行時に目的の送信元が、範囲内にある必要がある会社コードを返すフォーミュラを構成できます。

> [!TIP]
> 会社コードを使用して ER 形式を実行する必要があるが、ER 形式では会社コードを取得できるデータ ソースが提供されていない場合は、組み込みの [GETCURRENTCOMPANY](er-functions-other-getcurrentcompany.md) ER 関数を使用して、`GetCurrentCompany()` フォーミュラを構成します。

> [!NOTE]
> フォーミュラは ER コンフィギュレーションに固有です。

実行時に使用するメール アドレスのタイプを指定するには、**電子メールの送信先** ダイアログ ボックスで、**To** フィールドの横にある **編集** を選択して、**メール アドレスの割り当て** ドロップダウン ダイアログ ボックスを開きます。 その後、次のフィールドを設定します:

- **目的** フィールドで、希望の目的を選択します。 検出された関係者の連絡先から、選択した目的のメール アドレスのみが使用されます。
- **基本連絡先** オプションを **はい** に設定して、検出された関係者用に構成したメール アドレスを基本メール アドレスとして使用します。

> [!NOTE]
> **目的** フィールドで目的が選択され、**基本連絡先** オプションが同時に **はい** に設定されている場合は、少なくとも 1 つの構成された条件を満たす、すべての電子メールが、実行時に使用されます。

### <a name="configuration-email"></a>コンフィギュレーション電子メール

使用する構成が、1 つのメール アドレスまたはセミコロン (;) で区切られた複数のメール アドレスを返すデータ ソース内のノードを持つ場合は、**構成メール** をメール アドレス タイプとして選択します。 フォーミュラ デザイナーの データ ソース と [関数](er-formula-language.md#Functions) を使用して、正しく書式設定されたメール アドレス、または、セミコロンで区切られた正しく書式設定されたメール アドレスを取得できます。 たとえば、**ISO 20022 の口座振替** の構成を使用する場合は、送付状の送付先となる仕入先の連絡先情報から仕入先の基本メール アドレスを表すノードは `'$PaymentsForCoveringLetter'.Creditor.ContactDetails.Email` です。

[![メール アドレスの送信元の構成。](./media/ER_Destinations-EmailDefineAddressSource2.png)](./media/ER_Destinations-EmailDefineAddressSource2.png)

## <a name="group-format-components"></a><a id="grouping"></a>形式コンポーネントのグループ化

形式コンポーネントをグループ化するには、**電子申告の送信先** ページの **ファイルの送信先** クイック タブで、グリッド内のコンポーネントを選択し、**グループ** を選択します。

**電子メール** は、選択したコンポーネントでまだ使用可能な、以前に構成された送信先のみです。 以前に構成された他の送信先は、コンポーネントのグループではサポートされていないと見なされるため、使用できません。 必要に応じて、これらの変更について通知されます。

以前に追加したレコードは、作成されたグループのヘッダーと見なされます。 このヘッダー レコードは、グループの電子メール送信先設定を保存します。 他のレコードは、グループのヘッダーレコードの電子メール送信先設定を使用するグループ メンバーです。

形式コンポーネントのグループを解除するには、**ファイルの送信先** クイック タブで、グループに属するレコードを選択し、**グループ化解除** を選択します。

- ヘッダー レコードを選択すると、グループ全体のグループ化が解除されます。
- メンバー レコードを選択し、それがグループ内の最後のメンバー レコードである場合は、グループ全体がグループ解除されます。
- グループ内の最後のメンバー レコードではないメンバー レコードを選択した場合、そのレコードは現在のグループから除外されます。

次の図は、督促状と適切な顧客の請求書を PDF 形式で含む、zip 形式の送信ファイルを生成するように構成された ER 形式の構造を示しています。

[![送信ドキュメントを生成する ER 形式の構造。](./media/ER_Destinations-Email-Grouping1.png)](./media/ER_Destinations-Email-Grouping1.png)

次の図は、このトピックで説明されているように、個々のコンポーネントをグループ化し、新しいグループの **電子メール** の送信先を有効にして、適切な顧客の請求書と共に督促状が電子メールの添付ファイルとして送信されるプロセスを示しています。

[![個々のコンポーネントのグループ化と電子メールの送信先の有効化。](./media/ER_Destinations-Email-Grouping2.gif)](./media/ER_Destinations-Email-Grouping2.gif)

## <a name="additional-resources"></a>追加リソース

- [電子申告 (ER) の概要](general-electronic-reporting.md)
- [電子申告 (ER) の送信先](electronic-reporting-destinations.md)
- [電子申告 (ER) のフォーミュラ デザイナー](general-electronic-reporting-formula-designer.md)


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
