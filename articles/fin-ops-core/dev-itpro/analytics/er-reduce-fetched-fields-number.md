---
title: 実行時にフェッチされるテーブル フィールドの数を減らすことで、ER ソリューションのパフォーマンスを向上させる
description: この記事では、実行時にフェッチされるテーブル フィールドの数を減らすことで、ER ソリューションのパフォーマンスを向上させる方法について説明します。
author: kfend
ms.date: 05/12/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.region: Global
ms.author: filatovm
ms.search.validFrom: ''
ms.dyn365.ops.version: 10.0.28
ms.custom: ''
ms.assetid: ''
ms.search.form: ERModelMappingDesigner, EROperationDesigner
ms.openlocfilehash: 5c9481f1021a5dba6e1d4020bbf85a10bd551ac0
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2022
ms.locfileid: "9278829"
---
# <a name="improve-performance-of-er-solutions-by-reducing-the-number-of-table-fields-that-are-fetched-at-runtime"></a>実行時にフェッチされるテーブル フィールドの数を減らすことで、ER ソリューションのパフォーマンスを向上させる

[!include[banner](../includes/banner.md)]

さまざまな形式で送信ドキュメントを生成する [電子報告](general-electronic-reporting.md) (ER) [形式](er-overview-components.md#format-components-for-outgoing-electronic-documents) をデザインできます。 ドキュメントを生成する際、ER 形式は、対応する ER [モデル マッピング](er-overview-components.md#model-mapping-component) で構成されたデータ ソースを呼び出します。 レコード取得用にアプリケーション テーブルへのアクセスを構成するため、*テーブル レコード* タイプの ER データ ソースを使用できます。 既定では、*テーブル レコード* タイプのデータ ソース は、要求されたレコードのすべてのフィールドの値を取得します。 ただし、このタイプのデータ ソースは、実行している ER 形式に必要なフィールド値のみをフェッチできるように構成できます。 この構成により、データ取得およびレコード キャッシュの詳細を実行するアプリケーション サーバーのメモリ消費を減らすことができます。

*テーブル レコード* タイプのデータ ソースのフェッチフィールドの一覧を制限する方法の詳細については、この記事の例を参照してください。

## <a name="example-reduce-the-number-of-table-fields-that-are-fetched-at-runtime"></a>例 : 実行時にフェッチされるテーブル フィールドの数を減らす

次の手順では、システム管理者または電子レポート開発者ロールのユーザーが、ER 形式の実行に必要なフィールドだけをフェッチしてアプリケーション サーバー メモリの消費を減らすために、ER モデル マッピングを構成する方法を示します。

Microsoft Dynamics 365 Finance で **USMF** 社を例に使用して、これらの手順について解説します。 コーディングは必要ありません。

この例を完了するには、次のいずれかのロールの **USMF** 会社にアクセスできる必要があります。

- 電子申告機能コンサルタント
- システム管理者

この例では、サンプル会社 **Litware, Inc.** に提供された ER [構成](general-electronic-reporting.md#Configuration) を使用します。 **Litware, Inc.** (`http://www.litware.com`) サンプル会社の構成プロバイダーが ER フレームワークにリストされており、**有効** アクティブとマークされていることを確認します。 この構成プロバイダーがリストに表示されない場合、または **有効** としてマークされていない場合、[構成プロバイダーの作成および有効としてマーク付け](tasks/er-configuration-provider-mark-it-active-2016-11.md) の手順に従ってください。

### <a name="configure-the-er-framework"></a>ER フレームワークを構成する

[ER フレームワークの構成](er-quick-start2-customize-report.md#ConfigureFramework)に記載の手順に従って、 ER パラメーターの最小限のセットを構成します。 ER フレームワークを使用して提供された ER ソリューションのデータ ソースの修正を始める前に、この設定を完了する必要があります。

### <a name="import-the-sample-er-configurations"></a>サンプル ER のコンフィギュレーションのインポート

[カスタム レポートを印刷する新しい ER ソリューションを設計する](er-quick-start1-new-solution.md) 記事で、この例をまだ完了していない場合は、提供されている ER ソリューションの次の構成用の XML ファイルをダウンロードしてローカルに保存してください。

| コンテンツの説明            | ファイル名 |
|--------------------------------|-----------|
| ER データ モデル構成    | [Questionnaires model.version.1.xml](https://download.microsoft.com/download/b/6/3/b633bd34-d200-4422-96d9-8f62eb5218f8/Questionnaires_model.version.1.xml) |
| ER モデル マッピング コンフィギュレーション | [Questionnaires mapping.version.1.1.xml](https://download.microsoft.com/download/7/b/2/7b258e4e-4bd5-46a4-8114-27419ae4acd8/Questionnaires_mapping.version.1.1.xml) |
| ER フォーマット構成        | [Questionnaires format.version.1.1.xml](https://download.microsoft.com/download/1/b/a/1ba39ec2-257a-44d8-972f-25bf7d18fb41/Questionnaires_format.version.1.1.xml) |

次に、提供されている ER ソリューションの構成を Finance インスタンスにアップロードするには、次の手順に従います。

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **コンフィギュレーションをレポートする** を選択します。
3. **構成** ページで、ER データ モデル構成をインポートします。

    1. **交換** を選択し、**XML ファイルから読み込む** を選択します。
    2. **参照** を選択し、**Questionnaires model.version.1.xml** ファイルを検索して、**OK** を選択します。

4. ER モデル マッピングの構成をインポートします。

    1. **交換** を選択し、**XML ファイルから読み込む** を選択します。
    2. **参照** を選択し、**Questionnaires mapping.1.1.xml** ファイルを検索して、**OK** を選択します。

5. ER 形式構成をインポートします。

    1. **交換** を選択し、**XML ファイルから読み込む** を選択します。
    2. **参照** を選択し、**Questionnaires format.1.1.xml** ファイルを検索して、**OK** を選択します。

6. 構成ツリーで、**アンケート モデル** を展開します。
7. コンフィギュレーション ツリーでインポートされた ER コンフィギュレーションのリストを確認します。

    ![構成ページでインポートされた ER 構成を確認します。](./media/er-reduce-fetched-fields-number-configurations.png)

### <a name="review-the-provided-er-model-mapping"></a>提供された ER モデル マッピングを確認する

1. **構成** ページで、**アンケート マッピング** を選択します。
2. アクション ウィンドウで、**デザイナー** を選択します。
3. **モデルからデータソースへのマッピング** ページで、**実行** を選択します。
4. **モデル マッピング デザイナー** ページのアクション ペインで、**グループ ビュー** を選択して、**グループ** ビューを選択します。
5. **データ モデル** ウィンドウで、**アンケート** を選択します。

    **アンケート** データソースが `KMCollection` アプリケーション テーブルにアクセスするように構成されていることにご注意ください。

6. **データ ソース** ペインで、**テーブル レコード** \> **アンケート** \> **フィールド** を展開します。

    `KMCollection` アプリケーション テーブルからの多くのフィールドが *テーブル レコード* タイプの **アンケート** データ ソースによって公開される数に注意してください。

    ![[グループ ビュー] が有効な場合に、モデル マッピング デザイナー ページで指定されたモデル マッピングを確認します。](./media/er-reduce-fetched-fields-number-mapping1.png)

7. アクション ウィンドウで、**グループ ビュー** を再度選択して **グループ** ビューをオフにし、**すべて表示** \> **マッピングされたもののみ表示** を選択します。

    ER データ モデルの **アンケート** レコード一覧に入力するには、`KMCollection` アプリケーション テーブルのいくつかのフィールドが使用されます。

    - `Active`
    - `Description`
    - `questionMode`
    - `kmCollectionId`

    ![[グループ ビュー] が有効な場合に、モデル マッピング デザイナー ページで指定されたモデル マッピングをオフにします。](./media/er-reduce-fetched-fields-number-mapping2.png)

### <a name="turn-on-the-er-performance-trace"></a>ER パフォーマンス追跡を有効にする

[ER パフォーマンス追跡を有効にする](trace-execution-er-troubleshoot-perf.md#turn-on-the-er-performance-trace) の手順に従って、ER コンポーネントの実行を追跡できる ER ユーザー パラメータを設定します。

### <a name="run-the-provided-er-format-by-using-the-provided-model-mapping"></a>指定されたモデル マッピングを使用して指定された ER 形式を実行する

**構成** ページの 1 つのアンケートに対して提供されている ER 形式を実行するには、[ER のデザインされた形式を実行する](er-quick-start1-new-solution.md#RunFormatFromER) の手順に従います。

### <a name="review-the-execution-trace-of-the-first-run"></a>最初の実行の実行追跡を確認する

1. **組織管理** \> **電子報告 \> 構成** に移動します。
2. **構成** ページで、**アンケート モデル** を展開し、**アンケート マッピング** を選択します。

    > [!NOTE]
    > **バージョン** クイック タブの詳細は、**アンケート マッピング** 構成のドラフト バージョンを 選択した場合に表示されます。 そのため、このモデル マッピングの内容を変更できます。

3. アクション ウィンドウで、**デザイナー** を選択します。
4. **モデルからデータソースへのマッピング** ページで、**実行** を選択します。
5. **モデル マッピング デザイナー** ページの、アクション ウィンドウで、**パフォーマンス追跡** を選択します。
6. **パフォーマンス追跡結果の設定** ダイアログ ボックスで、最後の形式の実行時に生成された追跡を選択します。

    ![パフォーマンス追跡結果の設定ダイアログ ボックスで、追跡を選択します。](./media/er-reduce-fetched-fields-number-select-trace-1.png)

7.  **OK** を選択します。 
8. **詳細** クイック タブで、**アンケート** データ ソースをポイントする **アンケート** パスにフィルター処理を実行します。
9. **アンケート** データ ソースが呼び出されたときに生成されたデータベース クエリの詳細を確認します。

    **アンケート** データ ソースが呼び出された時点で、`KMCollection` アプリケーション テーブルのすべてのフィールドが実行時にフェッチされたのに注意してください。

    ![モデル マッピング デザイナー ページでデータベース クエリの詳細を確認する。](./media/er-reduce-fetched-fields-number-query1.png)

### <a name="modify-the-provided-er-model-mapping"></a>提供された ER モデル マッピングを修正する

1. **モデル マッピング デザイナー** ページの、**データ ソース** ウィンドウで、**アンケート** データ ソースを選択します。
2. **データ ソース** ウィンドウで **編集** を選択します。
3. **データ ソース プロパティ** ダイアログ ボックスで、**フィールドを選択** を選択して、編集可能な **アンケート** データ ソースが呼び出された場合に実行時にフェッチされる、参照する `KMCollection` アプリケーション テーブルのフィールドの一覧を指定します。

    ![データ ソース プロパティ ダイアログ ボックスで、[フィールドを選択] を選択して、編集可能なデータ ソースを使用してアプリケーション テーブルからフェッチされる、フィールド一覧の構成を始めます。](./media/er-reduce-fetched-fields-number-select-fields1.png)

4. **フィールドの選択** ページで、**自動入力** を選択します。

    **選択したフィールド** 一覧は、モデル マッピングの構成済の商品に基づいて自動的に入力されます。 モデル マッピングのバインド、式、またはデータ ソースに記載されている参照テーブルのすべてのフィールドおよび関係が一覧に追加されます。

    ![[フィールドの選択] ページでアプリケーション テーブルからフェッチされるフィールドの一覧を構成します。](./media/er-reduce-fetched-fields-number-select-fields2.png)

5. **保存** を選択し、**フィールドの選択** ページを閉じます。
6. **OK** を選択して、データ ソースの設定に加えた変更を保存します。
7. アクション ウィンドウで、**詳細の表示** を選択します。

    **アンケート** データ ソースに テキスト **\<Fields are filtered\>** が表示されます。 このテキストは、データ ソースが、参照するアプリケーション テーブルから一部のフィールドをフェッチするように構成されていることを示します。

    ![モデル マッピング デザイナー ページで更新されたモデル マッピングを確認します。](./media/er-reduce-fetched-fields-number-mapping3.png)

8. **保存** を選択して、編集可能なモデル マッピングに加えた変更を保存します。

    > [!NOTE]
    > 実行時に、ER は追加の関係を分析し、そのフィールドがフェッチされたフィールドがデザイン時にフェッチされたフィールドの一覧に明示的に追加されていない場合でも、関連付けで使用されているフィールドすべてのフィールドをデータベース クエリに追加します。

### <a name="run-the-provided-er-format-by-using-the-updated-model-mapping"></a>更新されたモデル マッピングを使用して指定された ER 形式を実行する

**構成** ページの 1 つのアンケートに対して提供されている ER 形式を実行するには、[ER のデザインされた形式を実行する](er-quick-start1-new-solution.md#RunFormatFromER) の手順に従います。

### <a name="review-the-execution-trace-of-the-second-run"></a>二番目の実行の実行追跡を確認する

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページで、**アンケート モデル** を展開し、**アンケート マッピング** を選択します。
3. アクション ウィンドウで、**デザイナー** を選択します。
4. **モデルからデータソースへのマッピング** ページで、**実行** を選択します。
5. **モデル マッピング デザイナー** ページの、アクション ウィンドウで、**パフォーマンス追跡** を選択します。
6. **パフォーマンス追跡結果の設定** ダイアログ ボックスで、最後の形式の実行時に生成された追跡を選択します。
7.  **OK** を選択します。
8. **詳細** クイック タブで、**アンケート** データ ソースをポイントする **アンケート** パスにフィルター処理を実行します。
9. **アンケート** データ ソースが呼び出されたときに生成されたデータベース クエリの詳細を確認します。

    **アンケート** のデータ ソースが呼び出された際に、データ ソースを入力するために必要なフィールドだけが、実行時に `KMCollection` アプリケーション テーブルからフェッチされたのに注意してください。

    > [!NOTE]
    > Finance アプリケーションのデータ管理フレームワークにより、パーティション ID、データ領域 ID、レコード ID などの一部のフィールドが自動的に追加されます。

    ![モデル マッピング デザイナー ページで更新されたモデル マッピングのデータベース クエリの詳細を確認します。](./media/er-reduce-fetched-fields-number-query2.png)

この技術を使用すると、ER モデル マッピングと ER 形式を実行することでメモリ消費を減らす必要がある場合に、フェッチ されるレコードの数を減らすることができます。

## <a name="limitations"></a>制限

*テーブル レコード* タイプのデータ ソースのフェッチフィールドの数を制限すると、そのデータ ソースが参照するアプリケーション テーブルのメソッドを使用することはできません。これらのメソッドを呼び出す必要があるテーブル フィールドに関する情報はアプリケーション メタデータに提供されません。

## <a name="usage-notes"></a>使用上の注意

**自動入力** コマンドではフィールドは自動的に追加されませんが、編集可能なモデル マッピングのバインド、式、データ ソースで使用されなくなった場合でも、以前に追加したフィールドは自動的に削除されません。

**自動入力** を選択すると、ER は編集可能なモデル マッピングを編集用に開いた際に含があったバインド、式、データ ソースを分析します。 編集可能なモデル マッピングのバインド、フォーミュラ、およびデータ ソースを変更する場合に、**自動入力** コマンドを使用し、モデル マッピング デザイナーを閉じ、それを開いてモデル マッピングを編集します。 

## <a name="additional-resources"></a>追加リソース

- [電子申告形式の実行をトレースしてパフォーマンスの問題をトラブルシューティング](trace-execution-er-troubleshoot-perf.md)
- [ER 構成で起こるトラブルシューティング パフォーマンスの問題](er-troubleshoot-perf-issues-in-configurations.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
