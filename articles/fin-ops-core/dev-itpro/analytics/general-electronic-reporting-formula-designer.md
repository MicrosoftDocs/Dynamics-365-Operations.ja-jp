---
title: 電子申告 (ER) のフォーミュラ デザイナー
description: このトピックでは、電子申告 (ER) でフォーミュラ デザイナーを使用する方法を説明します。
author: NickSelin
manager: kfend
ms.date: 12/05/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
ms.search.form: ERDataModelDesigner, ERExpressionDesignerFormula, ERMappedFormatDesigner, ERModelMappingDesigner
audience: Application User, IT Pro
ms.reviewer: kfend
ms.custom: 58771
ms.assetid: 24223e13-727a-4be6-a22d-4d427f504ac9
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: d96fe041fd0ffb292909c1e724068efebe0184b9
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2020
ms.locfileid: "4682652"
---
# <a name="formula-designer-in-electronic-reporting-er"></a><span data-ttu-id="f83e9-103">電子申告 (ER) のフォーミュラ デザイナー</span><span class="sxs-lookup"><span data-stu-id="f83e9-103">Formula designer in Electronic reporting (ER)</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="f83e9-104">このトピックでは、電子申告 (ER) でのフォーミュラ デザイナーの使用方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-104">This topic explains how to use the formula designer in Electronic reporting (ER).</span></span> <span data-ttu-id="f83e9-105">ER の特定の電子ドキュメントの形式を設計する場合、データを変換する式を使用して、ドキュメントのフルフィルメントおよび書式設定の要件を満たすことができます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-105">When you design a format for a specific electronic document in ER, you can use formulas to transform data so that it meets the requirements for the document's fulfillment and formatting.</span></span> <span data-ttu-id="f83e9-106">これらの式は、Microsoft Excel の式と類似しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-106">These formulas resemble formulas in Microsoft Excel.</span></span> <span data-ttu-id="f83e9-107">計算式では、テキスト、日時、数学、論理式、詳細、データ種類の変換関数、および他のビジネス ドメイン固有の関数など、さまざまなタイプの関数がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-107">Various types of functions are supported in the formulas: text, date and time, mathematical, logical, information, and data type conversion functions, and also other, business domain–specific functions.</span></span>

## <a name="formula-designer-overview"></a><span data-ttu-id="f83e9-108">フォーミュラ デザイナーの概要</span><span class="sxs-lookup"><span data-stu-id="f83e9-108">Formula designer overview</span></span>

<span data-ttu-id="f83e9-109">ER はフォーミュラ デザイナーをサポートします。</span><span class="sxs-lookup"><span data-stu-id="f83e9-109">ER supports the formula designer.</span></span> <span data-ttu-id="f83e9-110">したがって、設計時に次のタスクに使用できる式を実行時にコンフィギュレーションできます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-110">Therefore, at design time, you can configure expressions that can be used for the following tasks at runtime:</span></span>

- <span data-ttu-id="f83e9-111">アプリケーション データベースから受信し、ER 形式のデータ ソースとして設計された ER データ モデルに入力する必要があるデータを変換します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-111">Transform data that is received from an application database and that should be entered in an ER data model that is designed to be a data source for ER formats.</span></span> <span data-ttu-id="f83e9-112">(たとえば、これらの変換にはフィルタ処理、グループ化、およびデータ型の変換が含まれる可能性があります。)</span><span class="sxs-lookup"><span data-stu-id="f83e9-112">(For example, these transformations might include filtering, grouping, and data type conversion.)</span></span>
- <span data-ttu-id="f83e9-113">特定の ER フォーマットのレイアウトや条件に従って電子ドキュメントを生成するため、フォーマット データを送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f83e9-113">Format data that must be sent to a generating electronic document in accordance with the layout and conditions of a specific ER format.</span></span> <span data-ttu-id="f83e9-114">(たとえば、書式設定は、要求された言語またはカルチャ、またはエンコードに従って行われる可能性があります)。</span><span class="sxs-lookup"><span data-stu-id="f83e9-114">(For example, the formatting might be done in accordance with the requested language or culture, or the encoding).</span></span>
- <span data-ttu-id="f83e9-115">電子ドキュメントを作成するプロセスを制御します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-115">Control the process of creating electronic documents.</span></span> <span data-ttu-id="f83e9-116">(たとえば、式は、実行しているデータによってフォーマットの特定の要素の出力を有効または無効にできます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-116">(For example, the expressions can enable or disable the output of specific elements of the format, depending on processing data.</span></span> <span data-ttu-id="f83e9-117">これらはドキュメントの作成プロセスを中断したり、またはユーザーにメッセージをスローすることもできます。)</span><span class="sxs-lookup"><span data-stu-id="f83e9-117">They can also interrupt the document creation process or throw messages to users.)</span></span>

<span data-ttu-id="f83e9-118">次のいずれかのアクションを実行する際 **フォーミュラ デザイナー** ページを開くことができます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-118">You can open the **Formula designer** page when you perform any of the following actions:</span></span>

- <span data-ttu-id="f83e9-119">データ モデルのコンポーネントへのデータ ソース項目のバインド。</span><span class="sxs-lookup"><span data-stu-id="f83e9-119">Bind data source items to data model components.</span></span>
- <span data-ttu-id="f83e9-120">形式コンポーネントへのデータ ソース項目のバインド。</span><span class="sxs-lookup"><span data-stu-id="f83e9-120">Bind data source items to format components.</span></span>
- <span data-ttu-id="f83e9-121">データ ソースの一部である計算済フィールドのメンテナンス完了。</span><span class="sxs-lookup"><span data-stu-id="f83e9-121">Complete maintenance of calculated fields that are part of data sources.</span></span>
- <span data-ttu-id="f83e9-122">ユーザー入力パラメーターの表示条件の定義。</span><span class="sxs-lookup"><span data-stu-id="f83e9-122">Define the visibility conditions for user input parameters.</span></span>
- <span data-ttu-id="f83e9-123">形式の変換の設計。</span><span class="sxs-lookup"><span data-stu-id="f83e9-123">Design a format's transformations.</span></span>
- <span data-ttu-id="f83e9-124">形式のコンポーネントに有効にする条件の定義。</span><span class="sxs-lookup"><span data-stu-id="f83e9-124">Define the enabling conditions for the format's components.</span></span>
- <span data-ttu-id="f83e9-125">形式のファイル コンポーネントに対するファイル名の定義。</span><span class="sxs-lookup"><span data-stu-id="f83e9-125">Define the file names for the format's FILE components.</span></span>
- <span data-ttu-id="f83e9-126">プロセス制御検証の条件の定義。</span><span class="sxs-lookup"><span data-stu-id="f83e9-126">Define the conditions for process control validations.</span></span>
- <span data-ttu-id="f83e9-127">プロセス制御検証のメッセージ テキストの定義。</span><span class="sxs-lookup"><span data-stu-id="f83e9-127">Define the message text for process control validations.</span></span>

## <a name="data-binding"></a><a name="Binding"></a><span data-ttu-id="f83e9-128">データ バインディング</span><span class="sxs-lookup"><span data-stu-id="f83e9-128">Data binding</span></span>

<span data-ttu-id="f83e9-129">ER フォーミュラ デザイナーを使用して、データ ソースから受信したデータを変換する式を定義し、実行時に次の方法でデータ コンシューマーにデータを入力できるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-129">The ER formula designer can be used to define an expression that transforms data that is received from data sources, so that the data can be entered in the data consumer in the following ways at runtime:</span></span>

- <span data-ttu-id="f83e9-130">アプリケーション データ ソースとランタイム パラメーターから ER データ モデルへ</span><span class="sxs-lookup"><span data-stu-id="f83e9-130">From application data sources and runtime parameters to an ER data model</span></span>
- <span data-ttu-id="f83e9-131">ER データ モデルから ER 形式へ</span><span class="sxs-lookup"><span data-stu-id="f83e9-131">From an ER data model to an ER format</span></span>
- <span data-ttu-id="f83e9-132">アプリケーション データ ソースとランタイム パラメーターから ER 形式へ</span><span class="sxs-lookup"><span data-stu-id="f83e9-132">From application data sources and runtime parameters to an ER format</span></span>

<span data-ttu-id="f83e9-133">次の図は、このタイプの式の設計を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-133">The following illustration shows the design of an expression of this type.</span></span> <span data-ttu-id="f83e9-134">この例では、式はイントラスタット テーブルの **Intrastat.AmountMST** フィールドの値を小数点以下 2 桁に丸め、丸めた値を返します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-134">In this example, the expression rounds the value of the **Intrastat.AmountMST** field in the Intrastat table to two decimal places and then returns the rounded value.</span></span>

<span data-ttu-id="f83e9-135">[![データ バインド式](./media/picture-expression-binding.jpg)](./media/picture-expression-binding.jpg)</span><span class="sxs-lookup"><span data-stu-id="f83e9-135">[![Data binding expression](./media/picture-expression-binding.jpg)](./media/picture-expression-binding.jpg)</span></span>

<span data-ttu-id="f83e9-136">次の図は、このタイプの式を使用できる方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-136">The following illustration shows how an expression of this type can be used.</span></span> <span data-ttu-id="f83e9-137">この例では、入力された式の結果が、**税申告モデル** データ モデルの **Transaction.InvoicedAmount** コンポーネントに反映されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-137">In this example, the result of the designed expression is entered in the **Transaction.InvoicedAmount** component of the **Tax reporting model** data model.</span></span>

<span data-ttu-id="f83e9-138">[![使用されているデータ バインド式](./media/picture-expression-binding2.jpg)](./media/picture-expression-binding2.jpg)</span><span class="sxs-lookup"><span data-stu-id="f83e9-138">[![Data binding expression being used](./media/picture-expression-binding2.jpg)](./media/picture-expression-binding2.jpg)</span></span>

<span data-ttu-id="f83e9-139">実行時に、デザインされた計算式 `ROUND (Intrastat.AmountMST, 2)` は、イントラスタット テーブルの各レコードの **AmountMST** フィールドの値を小数点以下 2 桁に丸めます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-139">At runtime, the designed formula, `ROUND (Intrastat.AmountMST, 2)`, rounds the value of the **AmountMST** field for each record in the Intrastat table to two decimal places.</span></span> <span data-ttu-id="f83e9-140">**税レポート** データ モデルの **Transaction.InvoicedAmount** コンポーネントで丸めの値を入力します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-140">It then enters the rounded value in the **Transaction.InvoicedAmount** component of the **Tax reporting** data model.</span></span>

## <a name="data-formatting"></a><a name="Transformation"></a><span data-ttu-id="f83e9-141">データの書式設定</span><span class="sxs-lookup"><span data-stu-id="f83e9-141">Data formatting</span></span>

<span data-ttu-id="f83e9-142">ER フォーミュラ デザイナーは、電子ドキュメント生成の一部として送信できるよう、データ ソースから受信されたデータを書式設定する式を定義するのに使用できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-142">The ER formula designer can be used to define an expression that formats data that is received from data sources, so that the data can be sent as part of the generating electronic document.</span></span> <span data-ttu-id="f83e9-143">フォーマットに対して再使用すべき、標準的なルールとして適用されるはずの書式設定があります。</span><span class="sxs-lookup"><span data-stu-id="f83e9-143">You might have formatting that must be applied as a typical rule that should be reused for a format.</span></span> <span data-ttu-id="f83e9-144">この場合、フォーマット式を持つ名前付きの変換として、書式設定のコンフィギュレーションで 1 度の書式設定を導入することができます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-144">In this case, you can introduce that formatting one time in the format configuration, as a named transformation that has a formatting expression.</span></span> <span data-ttu-id="f83e9-145">この名前付き変換は、作成したフォーマット式に従って出力を書式設定する必要がある多くの形式コンポーネントに後でリンクできます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-145">This named transformation can then be linked to many format components where the output must be formatted according to the formatting expression that you created.</span></span>

<span data-ttu-id="f83e9-146">次の図は、このタイプの変換の設計を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-146">The following illustration shows the design of a transformation of this type.</span></span> <span data-ttu-id="f83e9-147">この例では、**TrimmedString** 変換は、先頭および末尾にあるスペースを削除することにより *文字列* データ型の受信データを切り詰めます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-147">In this example, the **TrimmedString** transformation truncates incoming data of the *String* data type by removing leading and trailing spaces.</span></span> <span data-ttu-id="f83e9-148">その後、切り詰めた文字列を返します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-148">It then returns the truncated string value.</span></span>

<span data-ttu-id="f83e9-149">[![変換](./media/picture-transformation-design.jpg)](./media/picture-transformation-design.jpg)</span><span class="sxs-lookup"><span data-stu-id="f83e9-149">[![Transformation](./media/picture-transformation-design.jpg)](./media/picture-transformation-design.jpg)</span></span>

<span data-ttu-id="f83e9-150">次の図は、このタイプの変換を使用できる方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-150">The following illustration shows how a transformation of this type can be used.</span></span> <span data-ttu-id="f83e9-151">この例では、いくつかの形式のコンポーネントは、実行時に生成する電子ドキュメントにテキストを出力として送信します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-151">In this example, several format components send text as output to the generating electronic document at runtime.</span></span> <span data-ttu-id="f83e9-152">これらすべての形式のコンポーネントは、名前で **TrimmedString** 変換へと参照します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-152">All these format components refer to the **TrimmedString** transformation by name.</span></span>

<span data-ttu-id="f83e9-153">[![使用されている変換](./media/picture-transformation-usage.jpg)](./media/picture-transformation-usage.jpg)</span><span class="sxs-lookup"><span data-stu-id="f83e9-153">[![Transformation being used](./media/picture-transformation-usage.jpg)](./media/picture-transformation-usage.jpg)</span></span>

<span data-ttu-id="f83e9-154">前の図の **partyName** コンポーネントなどの形式コンポーネントが **TrimmedString** 変換を参照する場合、変換は生成する電子ドキュメントへの出力としてテキストを送信します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-154">When format components, such as the **partyName** component in the preceding illustration, refer to the **TrimmedString** transformation, the transformation sends text as output to the generating electronic document.</span></span> <span data-ttu-id="f83e9-155">このテキストには、先頭および末尾にあるスペースは含まれません。</span><span class="sxs-lookup"><span data-stu-id="f83e9-155">This text doesn't include leading and trailing spaces.</span></span>

<span data-ttu-id="f83e9-156">個別に適用する必要のある形式の場合、特定形式コンポーネントのバインディングの個別の式として導入できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-156">If you have formatting that must be applied individually, you can introduce that formatting as an individual expression of a binding of a specific format component.</span></span> <span data-ttu-id="f83e9-157">次の図は、このタイプの式を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-157">The following illustration shows an expression of this type.</span></span> <span data-ttu-id="f83e9-158">この例では、**partyType** の形式コンポーネントは、データ ソースの **Model.Company.RegistrationType** フィールドからの受信データを大文字テキストに変換する式を介してデータ ソースにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-158">In this example, the **partyType** format component is bound to the data source via an expression that converts incoming data from the **Model.Company.RegistrationType** field in the data source to uppercase text.</span></span> <span data-ttu-id="f83e9-159">式は、そのテキストを出力として、電子ドキュメントに送信します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-159">The expression then sends that text as output to the electronic document.</span></span>

<span data-ttu-id="f83e9-160">[![個々のコンポーネントに書式設定を適用](./media/picture-binding-with-formula.jpg)](./media/picture-binding-with-formula.jpg)</span><span class="sxs-lookup"><span data-stu-id="f83e9-160">[![Applying formatting to an individual component](./media/picture-binding-with-formula.jpg)](./media/picture-binding-with-formula.jpg)</span></span>

## <a name="process-flow-control"></a><a name="Validation"></a><span data-ttu-id="f83e9-161">プロセス フローの制御</span><span class="sxs-lookup"><span data-stu-id="f83e9-161">Process flow control</span></span>

<span data-ttu-id="f83e9-162">ER フォーミュラ デザイナーは、電子ドキュメントを生成するプロセス フローを制御する式を定義するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-162">The ER formula designer can be used to define expressions that control the process flow of generating electronic documents.</span></span> <span data-ttu-id="f83e9-163">実行できるタスクは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="f83e9-163">You can perform the following tasks:</span></span>

- <span data-ttu-id="f83e9-164">ドキュメント作成のプロセスを停止する必要がある場合を判断する条件を定義します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-164">Define conditions that determine when a document creation process must be stopped.</span></span>
- <span data-ttu-id="f83e9-165">停止したプロセスに対してユーザーにメッセージを作成する式を指定するか、または報告書作成のプロセスに関する実行ログ メッセージをスローする式を指定します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-165">Specify expressions that either create messages for the user about stopped processes or throw execution log messages about the continuing process of report generation.</span></span>
- <span data-ttu-id="f83e9-166">電子ドキュメント生成のファイル名と作成の管理条件を指定します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-166">Specify the file names of generating electronic documents, and control the conditions of their creation.</span></span>

<span data-ttu-id="f83e9-167">プロセス フロー制御の各ルールは、個々の検証として設計されています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-167">Each rule of the process flow control is designed as an individual validation.</span></span> <span data-ttu-id="f83e9-168">次の図は、このタイプの検証を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-168">The following illustration shows a validation of this type.</span></span> <span data-ttu-id="f83e9-169">この例のコンフィギュレーションの説明を次に示します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-169">Here is an explanation of the configuration in this example:</span></span>

- <span data-ttu-id="f83e9-170">検証は、XML ファイルの生成中に **INSTAT** ノードが作成されたときに評価されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-170">The validation is evaluated when the **INSTAT** node is created during generation of the XML file.</span></span>
- <span data-ttu-id="f83e9-171">トランザクションのリストが空である場合、検証の実行プロセスを停止し、**FALSE** を返します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-171">If the list of transactions is empty, the validation stops the execution process and returns **FALSE**.</span></span>
- <span data-ttu-id="f83e9-172">検証では、ユーザーの優先的に使用する言語でラベル SYS70894 のテキストを含むエラー メッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-172">The validation returns an error message that includes the text of label SYS70894 in the user's preferred language.</span></span>

<span data-ttu-id="f83e9-173">[![妥当性確認](./media/picture-validation.jpg)](./media/picture-validation.jpg)</span><span class="sxs-lookup"><span data-stu-id="f83e9-173">[![Validation](./media/picture-validation.jpg)](./media/picture-validation.jpg)</span></span>

<span data-ttu-id="f83e9-174">ER フォーミュラ デザイナーを使用して、生成する電子ドキュメントのファイル名を生成し、ファイル作成プロセスを制御することもできます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-174">The ER formula designer can also be used to generate a file name for a generating electronic document and to control the file creation process.</span></span> <span data-ttu-id="f83e9-175">次の図は、このタイプのプロセス フロー制御の設計を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-175">The following illustration shows the design of a process flow control of this type.</span></span> <span data-ttu-id="f83e9-176">この例のコンフィギュレーションの説明を次に示します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-176">Here is an explanation of the configuration in this example:</span></span>

- <span data-ttu-id="f83e9-177">**model.Intrastat** データ ソースからのレコードの一覧はバッチに分かれています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-177">The list of records from the **model.Intrastat** data source is divided into batches.</span></span> <span data-ttu-id="f83e9-178">バッチごとに、最大1,000 レコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-178">Each batch contains up to 1,000 records.</span></span>
- <span data-ttu-id="f83e9-179">出力は、作成されたバッチごとに XML 形式のファイル 1 つを含む zip ファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-179">The output creates a zip file that contains one file in XML format for every batch that was created.</span></span>
- <span data-ttu-id="f83e9-180">式はファイル名とファイル名拡張子を連結して、生成する電子ドキュメントにファイル名を返します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-180">An expression returns a file name for generating electronic documents by concatenating the file name and the file name extension.</span></span> <span data-ttu-id="f83e9-181">2 番目のバッチ以降すべてのバッチには、ファイル名の接尾語としてバッチ ID が表示されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-181">For the second batch and all subsequent batches, the file name contains the batch ID as a suffix.</span></span>
- <span data-ttu-id="f83e9-182">式は、(**TRUE** を返すことで) 少なくともレコードを 1 つ含むバッチのファイル作成プロセスを有効にします。</span><span class="sxs-lookup"><span data-stu-id="f83e9-182">An expression enables (by returning **TRUE**) the file creation process for batches that contain at least one record.</span></span>

<span data-ttu-id="f83e9-183">[![プロセス フローの制御](./media/picture-file-control.jpg)](./media/picture-file-control.jpg)</span><span class="sxs-lookup"><span data-stu-id="f83e9-183">[![Process flow control](./media/picture-file-control.jpg)](./media/picture-file-control.jpg)</span></span>

## <a name="document-content-control"></a><a name="Enabled"></a><span data-ttu-id="f83e9-184">ドキュメント コンテンツ コントロール</span><span class="sxs-lookup"><span data-stu-id="f83e9-184">Document content control</span></span>

<span data-ttu-id="f83e9-185">ER フォーミュラ デザイナーを使用して、実行時に生成される電子ドキュメントに入れるデータを制御する式を構成できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-185">The ER formula designer can be used to configure expressions that control what data will be put into generated electronic documents at runtime.</span></span> <span data-ttu-id="f83e9-186">式は、実行しているデータおよび構成されたロジックに応じて、フォーマットの特定の要素の出力を有効または無効にできます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-186">The expressions can enable or disable the output of specific elements of the format, depending on processing data and configured logic.</span></span> <span data-ttu-id="f83e9-187">これらの式は、**操作デザイナー** ページの **マッピング** タブの **有効** フィールドで、単一のフォーマット要素に対して入力できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-187">These expressions can be entered for a single format element in the **Enabled** field on the **Mapping** tab of the **Operations designer** page.</span></span> <span data-ttu-id="f83e9-188">*ブール* 値を返すロジック条件として式を入力できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-188">You can enter the expressions as a logic condition that returns a *Boolean* value:</span></span>

- <span data-ttu-id="f83e9-189">条件が **True** を返す場合、現在のフォーマット要素が実行されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-189">If the condition returns **True**, the current format element is run.</span></span>
- <span data-ttu-id="f83e9-190">条件が **False** を返す場合、現在のフォーマット要素はスキップされます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-190">If the condition returns **False**, the current format element is skipped.</span></span>

<span data-ttu-id="f83e9-191">次の図は、このタイプの式を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-191">The following illustration shows expressions of this type.</span></span> <span data-ttu-id="f83e9-192">(Microsoft が提供する **ISO20022 口座振替 (NO)** バージョン 11.12.11例として使用されます。) **XMLHeader** 形式コンポーネントは、ISO 20022 XML のメッセージ標準に従って、口座振替メッセージの構造を記述するように構成されています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-192">(Version 11.12.11 of the **ISO20022 Credit transfer (NO)** format configuration that is provided by Microsoft is used as an example.) The **XMLHeader** format component is configured to describe the structure of the credit transfer message according to the ISO 20022 XML message standards.</span></span> <span data-ttu-id="f83e9-193">**XMLHeader/Document/CstmrCdtTrfInitn/PmtInf/CdtTrfTxInf/RmtInf/Ustrd** 形式コンポーネントは、生成されたメッセージに **Ustrd** XML 要素を追加し、送金情報を非構造化形式で次の XML 要素のテキストとして配置するように構成されています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-193">The **XMLHeader/Document/CstmrCdtTrfInitn/PmtInf/CdtTrfTxInf/RmtInf/Ustrd** format component is configured to add the **Ustrd** XML element to the generated message and to put the remittance information in an unstructured format as text of the following XML elements:</span></span>

- <span data-ttu-id="f83e9-194">**PaymentNotes** コンポーネントは、支払票のテキストを生成するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-194">The **PaymentNotes** component is used to generate the text of payment notes.</span></span>
- <span data-ttu-id="f83e9-195">**DelimitedSequence** コンポーネントは、現在の口座振替の決済に使用されるコンマ区切りの請求書番号を生成します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-195">The **DelimitedSequence** component generates comma-separated invoice numbers that are used to settle the current credit transfer.</span></span>

<span data-ttu-id="f83e9-196">[![PaymentNotes および DelimitedSequence コンポーネント](./media/GER-FormulaEditor-ControlContent-1.png)](./media/GER-FormulaEditor-ControlContent-1.png)</span><span class="sxs-lookup"><span data-stu-id="f83e9-196">[![PaymentNotes and DelimitedSequence components](./media/GER-FormulaEditor-ControlContent-1.png)](./media/GER-FormulaEditor-ControlContent-1.png)</span></span>

> [!NOTE]
> <span data-ttu-id="f83e9-197">**PaymentNotes** および **DelimitedSequence** コンポーネントは疑問符を使用してラベル付けされます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-197">The **PaymentNotes** and **DelimitedSequence** components are labeled by using a question mark.</span></span> <span data-ttu-id="f83e9-198">疑問符は、コンポーネントの使用が条件付きであることを示します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-198">A question mark indicates that the use of a component is conditional.</span></span> <span data-ttu-id="f83e9-199">この場合、コンポーネントの使用は次の条件に基づいています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-199">In this case, use of the components is based on the following criteria:</span></span>
>
> - <span data-ttu-id="f83e9-200">**PaymentNotes** コンポーネントに定義されている `@.PaymentsNotes <> ""` 式は、(**TRUE** を返すことにより) そのテキストが現在の口座振替に対して空白でない場合、**Ustrd** XML 要素に支払票のテキストを入力することができます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-200">The `@.PaymentsNotes <> ""` expression that is defined for the **PaymentNotes** component enables (by returning **TRUE**) the **Ustrd** XML element to be filled with the text of payment notes, if that text isn't blank for the current credit transfer.</span></span>
>
>    <span data-ttu-id="f83e9-201">[![PaymentNotes コンポーネントの式](./media/GER-FormulaEditor-ControlContent-2.png)](./media/GER-FormulaEditor-ControlContent-2.png)</span><span class="sxs-lookup"><span data-stu-id="f83e9-201">[![Expression for the PaymentNotes component](./media/GER-FormulaEditor-ControlContent-2.png)](./media/GER-FormulaEditor-ControlContent-2.png)</span></span>
>
> - <span data-ttu-id="f83e9-202">**DelimitedSequence** コンポーネント用に定義された `@.PaymentsNotes = ""` 式により、(**TRUE** を返すことにより) その口座振替の支払票のテキストが空白の場合、現在の口座振替の決済に使用される請求書番号のコンマ区切りリストを **Ustrd** XML 要素に入力することができます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-202">The `@.PaymentsNotes = ""` expression that is defined for the **DelimitedSequence** component enables (by returning **TRUE**) the **Ustrd** XML element to be filled with a comma-separated list of the invoice numbers that are used to settle the current credit transfer, if the text of payment notes for that credit transfer is blank.</span></span>
>
>    <span data-ttu-id="f83e9-203">[![DelimitedSequence コンポーネントの式](./media/GER-FormulaEditor-ControlContent-3.png)](./media/GER-FormulaEditor-ControlContent-3.png)</span><span class="sxs-lookup"><span data-stu-id="f83e9-203">[![Expression for the DelimitedSequence component](./media/GER-FormulaEditor-ControlContent-3.png)](./media/GER-FormulaEditor-ControlContent-3.png)</span></span>
> 
> <span data-ttu-id="f83e9-204">この設定に基づいて、各債務者の支払いに対して生成されるメッセージ **Ustrd** XML 要素には、支払票のテキスト、またはそのテキストが空白の場合は、支払い決済に使用される請求書番号のコンマ区切りのリストが含まれます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-204">Based on this setup, the message that is generated for each debtor payment, the **Ustrd** XML element, will contain either the text of payment notes or, when that text is blank, a comma-separated list of the invoice numbers that are used to settle the payment.</span></span>

## <a name="validation-of-configured-formulas"></a><a name="TestFormula"></a><span data-ttu-id="f83e9-205">構成された式の検証</span><span class="sxs-lookup"><span data-stu-id="f83e9-205">Validation of configured formulas</span></span>

<span data-ttu-id="f83e9-206">**フォーミュラ デザイナー** ページで,  **テスト** を選択して、構成された式の動作を検証します。</span><span class="sxs-lookup"><span data-stu-id="f83e9-206">On the **Formula designer** page, select **Test** to validate how the configured formula works.</span></span>

<span data-ttu-id="f83e9-207">[![テストを選択して式を検証する](./media/ER-FormulaTest-Start.png)](./media/ER-FormulaTest-Start.png)</span><span class="sxs-lookup"><span data-stu-id="f83e9-207">[![Selecting Test to validate a forumula](./media/ER-FormulaTest-Start.png)](./media/ER-FormulaTest-Start.png)</span></span>

<span data-ttu-id="f83e9-208">式の引数の値が必要な場合、**フォーミュラ デザイナー** ページから **テスト式** ダイアログ ボックスを開くことができます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-208">When the values of formula arguments are required, you can open the **Test expression** dialog box from the **Formula designer** page.</span></span> <span data-ttu-id="f83e9-209">ほとんどの場合、構成されたバインドは設計時に実行されないため、これらの引数は手動で定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f83e9-209">In most cases, these arguments must be manually defined, because the configured bindings aren't run at design time.</span></span> <span data-ttu-id="f83e9-210">**フォーミュラ デザイナー** ページで,  **テスト結果** タブには、構成された式の実行結果が表示されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-210">The **Test result** tab on the **Formula designer** page shows the result from execution of the configured formula.</span></span>

<span data-ttu-id="f83e9-211">次の例は、対外貿易ドメイン用に構成された式をテストして、イントラスタット商品コードに数字のみが含まれていることを確認する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="f83e9-211">The following example shows how you can test the formula that is configured for the foreign trade domain to make sure that the Intrastat commodity code contains only digits.</span></span>

<span data-ttu-id="f83e9-212">この式をテストする場合、**テスト式** ダイアログ ボックスを使用して、テスト用のイントラスタット商品コードの値を指定できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-212">When you test this formula, you can use the **Test expression** dialog box to specify the value of the Intrastat commodity code for testing.</span></span>

<span data-ttu-id="f83e9-213">[![テスト用のイントラスタット商品コードを指定する](./media/ER-FormulaTest-Start-EnterArguments.png)](./media/ER-FormulaTest-Start-EnterArguments.png)</span><span class="sxs-lookup"><span data-stu-id="f83e9-213">[![Specifying the Intrastat commodity code for testing](./media/ER-FormulaTest-Start-EnterArguments.png)](./media/ER-FormulaTest-Start-EnterArguments.png)</span></span>

<span data-ttu-id="f83e9-214">イントラスタット商品コードを指定して **OK** を選択すると、**フォーミュラ デザイナー** ページの **テスト結果** タブには、構成された式の実行結果が表示されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-214">After you specify the Intrastat commodity code and select **OK**, the **Test result** tab on the **Formula designer** page shows the result of execution of the configured formula.</span></span> <span data-ttu-id="f83e9-215">その後、結果が受け入れられるかどうかを評価できます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-215">You can then evaluate whether the result is acceptable.</span></span> <span data-ttu-id="f83e9-216">結果が受け入れられない場合は、式を更新して再度テストできます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-216">If the result isn't acceptable, you can update the formula and test it again.</span></span>

<span data-ttu-id="f83e9-217">[![テスト結果](./media/ER-FormulaTest-Result.png)](./media/ER-FormulaTest-Result.png)</span><span class="sxs-lookup"><span data-stu-id="f83e9-217">[![Test result](./media/ER-FormulaTest-Result.png)](./media/ER-FormulaTest-Result.png)</span></span>

<span data-ttu-id="f83e9-218">一部の数式は設計時にテストできません。</span><span class="sxs-lookup"><span data-stu-id="f83e9-218">Some formulas can't be tested at design time.</span></span> <span data-ttu-id="f83e9-219">たとえば、式は、**テスト結果** タブに表示できないデータ種類の結果を返す場合があります。この場合、式をテストできないことを示すエラー メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f83e9-219">For example, a formula might return a result of a data type that can't be shown on the **Test result** tab. In this case, you receive an error message that states that the formula can't be tested.</span></span>

<span data-ttu-id="f83e9-220">[![エラー メッセージ](./media/ER-FormulaTest-Error.png)](./media/ER-FormulaTest-Error.png)</span><span class="sxs-lookup"><span data-stu-id="f83e9-220">[![Error message](./media/ER-FormulaTest-Error.png)](./media/ER-FormulaTest-Error.png)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="f83e9-221">追加リソース</span><span class="sxs-lookup"><span data-stu-id="f83e9-221">Additional resources</span></span>

- [<span data-ttu-id="f83e9-222">電子申告の概要</span><span class="sxs-lookup"><span data-stu-id="f83e9-222">Electronic Reporting overview</span></span>](general-electronic-reporting.md)
- [<span data-ttu-id="f83e9-223">電子報告のフォーミュラ言語</span><span class="sxs-lookup"><span data-stu-id="f83e9-223">Electronic reporting formula language</span></span>](er-formula-language.md)
