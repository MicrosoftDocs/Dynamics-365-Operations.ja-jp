---
title: バーコードのイメージを生成するためにバーコード データソースを使用する
description: このトピックでは、バーコードのイメージを生成するためのバーコード データ ソースの使用方法について説明します。
author: NickSelin
manager: AnnBe
ms.date: 10/21/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
ms.search.form: ERWorkspace, ERSolutionTable, ERModelMappingDesigner, EROperationDesigner
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 220314
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2020-05-01
ms.dyn365.ops.version: Version 10.0.13
ms.openlocfilehash: 3fb754267de1120bc3c086d49cb7c63028183bda
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2020
ms.locfileid: "4681427"
---
# <a name="use-barcode-data-sources-to-generate-bar-code-images"></a>バーコードのイメージを生成するためにバーコード データソースを使用する

[!include[banner](../includes/banner.md)]

[電子レポート (ER)](general-electronic-reporting.md) フレームワークを使用すると、必要な電子形式または印刷可能な送信ドキュメントを生成するために実行できる [ER 形式コンポーネント](general-electronic-reporting.md#FormatComponentOutbound) をデザインできます。 Microsoft Office 形式でで送信ドキュメントを生成するには、Microsoft Excel ドキュメントまたはレポート テンプレートとしての Microsoft Word ドキュメントのいずれかを使用することで、レポートのレイアウトを指定する必要があります。 [ER 操作デザイナー](general-electronic-reporting.md#building-a-format-that-uses-a-data-model-as-a-base) を使用すると、レポートのテンプレートとして Excel または Word ドキュメントを添付できます。 以下の添付されたテンプレートの名前付き要素は、次の構成済みの形式コンポーネントの要素に関連付けられます。

- Word のコンテンツ コントロール
- Excel の名前指定シート、範囲、セル、図形、およびイメージ

これらの名前指定要素は、ER 形式を実行したときに生成されるドキュメントに入力されるデータのプレース ホルダーとして使用されます。 ER 形式要素は、データ ソースにバインドされます。 これらのデータ ソースは、実行時に生成されるドキュメントに入力されるデータを指定します。 詳細については、[ER を使用して生成されるドキュメントへの画像や図形の埋め込み](electronic-reporting-embed-images-shapes.md) を参照してください。

ER は **バーコード** データ ソースの種類をサポートするようになりました。 したがって、指定されたテキストのバーコードを表すイメージを生成できるようになりました。 ER 形式を構成する場合は、**バーコード** の種類のイメージを生成するためのバーコードの種類のデータ ソースを指定できます。 その後、これらのイメージを、注文、請求書、梱包明細、領収書などの生成したビジネス ドキュメントに追加できます。 また、製品ラベルや棚ラベル、梱包や出荷ラベルなど、さまざまな種類のラベルに追加することもできます。

次のプレースホルダーは、レポート テンプレートでバーコードのイメージを入力するために使用できます。

- Wordの [画像](https://docs.microsoft.com/office/client-developer/word/content-controls-in-word) コンテンツ コントロール
- Excel の [画像](https://support.office.com/article/insert-pictures-3c51edf4-22e1-460a-b372-9329a8724344) オブジェクト

**バーコード** タイプのデータ ソースを使用すると、次の形式でバーコードを生成できます。

- 1 次元バーコード。

    - Codabar
    - Code 39
    - Code 93
    - Code 128
    - EAN-8
    - EAN-13
    - ITF-14
    - Intelligent Mail
    - MSI
    - Plessey
    - PDF417
    - UPC-A
    - UPC-E

- 2 次元バーコード。

    - Aztec
    - Data Matrix
    - QR コード

**バーコード** データソースを構成する場合、イメージの生成に使用される特定のレンダリング パラメータを定義できます。

- **幅** - バーコードの幅をピクセル単位で指定します。 **0** (ゼロ) の値は、既定の幅が使用されていることを示します。 この意味は、形式によって異なる場合があります。
- **高さ** - バーコードの高さをピクセル単位で指定します。 **0** (ゼロ) の値は、既定の高さが使用されていることを示します。 この意味は、形式によって異なる場合があります。
- **余白** - バーコードの余白のサイズをピクセル単位で指定します。 この余白は、バーコードの両側の領域で、明確に保管する必要があります (quiet 領域)。 **0** (ゼロ) の値は、既定の余白が使用されていることを示します。 この意味は、形式によって異なる場合があります。
- **出力コンテンツ** - この値を **はい** に設定すると、エンコードされた情報をテキストとして含むバーコードのイメージが生成されます。 既定値は **いいえ** です。
- **エンコーディング** - 生成されるバーコードのイメージでエンコードされる文字のタイプを指定します。 既定では、**UTF-8** エンコードが使用されます。

> [!IMPORTANT]
> 新しい **バーコード** データソースを追加する場合は、入れ子になった要素として別の項目 (コンテナー) の下に配置する必要があります。
>
> **バーコード** データソースを形式のセル要素にバインドし、セル要素が Word コンテンツ コントロールまたは Excel ピクチャを表す場合、データソースは文字列型の 1 つのパラメーターを持つ **関数** としてバインドされます。 このパラメータを使用して、バーコードのイメージに変換するテキストを指定し、生成されたバーコードをスキャンしたときに読み取るテキストを指定する必要があります。

この機能の詳細を知るには、このトピックの例を実行します。

## <a name="example-generate-a-payment-check-that-contains-a-bar-code-that-encodes-the-payable-amount"></a>例: 未払金額をエンコードするバーコードを含む支払小切手を生成する

この例では、**システム管理者** または **電子レポート機能コンサルタント** のロールのユーザーが、バーコードが含まれる送信ドキュメントを Excel 形式で生成するために使用されるテンプレートを含む ER 形式を構成する方法を示します。 ここでは、関連する手順の概要を示します。

1. [前提条件を満たします](#ExamplePrerequisites)。
2. [構成プロバイダーをアクティブにします](#ExampleProvider)。
3. [指定された ER ソリューションを確認します](#ExampleImportSolution)。
4. [支払小切手を生成します](#ExampleGenerateCheque)。
5. [生成した支払い小切手をレビューします](#ExampleReviewGeneratedCheque)。
6. [提供されている ER ソリューションの形式を変更します](#ExampleModifyFormat)。

    1. [新しい小切手テンプレートを適用します](#ExampleModifyFormatApplyTemplate)。
    2. [新しいバーコード データ ソースを追加する](#ExampleModifyFormatAddDataSource)。
    3. [新しい形式要素をバインドする](#ExampleModifyFormatBindFormatElement)。
    4. [変更したバージョンをテストの実行に使用できるようにする](#ExampleModifyFormatMakeVersionAvailable)。

        1. [変更した形式のバージョンを完了します](#CompleteToRun)。
        2. [下書きバージョンを使用できるようにする](#MarkToRun)。

7. [支払ファイルを生成します](#ExampleGenerateCheque2)。
8. [生成した小切手を PDF に変換します](#ExampleConvertToPDF)。

この例では、支払チェックを生成するように構成されている、提供される ER ソリューションを使用します。 このソリューションでは、支払額が数字とテキストの両方で書き込まれている支払小切手が生成されます。 この ER ソリューションを変更して、支払金額がエンコードされ、バーコード スキャナーを使用して読み取ることができる、生成されたバーコードも確認できるようにします。

これらのステップは、Microsoft Dynamics 365 Finance の **USMF** 会社で完了できます。

### <a name="complete-the-prerequisites"></a><a name="ExamplePrerequisites"></a>前提条件を満たす

この例を完了するには、次のいずれかのロール用の Finance の USMF 会社にアクセスできる必要があります。

- 電子申告機能コンサルタント
- システム管理者

[ER を使用して生成したドキュメントの埋め込まれたイメージと形状](electronic-reporting-embed-images-shapes.md) のトピックにある例をまだ完了していない場合は、次のサンプル ER の構成をダウンロードしてください。

| コンテンツの説明         | ファイル名                   |
|-----------------------------|-----------------------------|
| ER データ モデル構成 | cheques.xml 用のモデル       |
| ER フォーマット構成     | format.xml を印刷する小切手 |

さらに、提供されている ER ソリューション用に変更されたテンプレートを含む次の Excel ファイルをダウンロードします。

| コンテンツの説明 | ファイル名                 |
|---------------------|---------------------------|
| レポート テンプレート     | テンプレート Excel .xlsx をチェックする |

### <a name="activate-a-configuration-provider"></a><a name="ExampleProvider"></a>コンフィギュレーション プロバイダーの有効化

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成プロバイダー** セクションで、**Litware, Inc.** サンプル会社の [構成プロバイダー](general-electronic-reporting.md#Provider) がリストされ、アクティブとしてマークされていることを確認します。 この構成プロバイダーがリストに表示されない場合、またはアクティブとしてマークされていない場合、[構成プロバイダーの作成およびアクティブなプロバイダーとしてのマークする](tasks/er-configuration-provider-mark-it-active-2016-11.md) トピックの手順に従ってください。

![ローカライズ構成ページで、サンプル会社をアクティブにする設定](./media/er-barcode-data-source-active-provider.png)

### <a name="import-the-provided-er-solution"></a><a name="ExampleImportSolution"></a>指定された ER ソリューションをインポートする

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成** セクションで、**レポート構成** タイルを選択します。
3. **構成** ページで、**小切手のモデル** 構成が構成ツリーで使用できない場合、ER データ モデル構成をインポートするためにこれらのステップに従います。

    1. 操作ウィンドウで、**交換** \> **XML ファイルからロード** を選択します。
    2. ダイアログ ボックスで、**参照** を選択して、**cheques.xml のモデル** ファイルを見つけて選択し、**OK** を選択します。

4. **小切手の印刷形式** 構成は構成ツリーで使用できない場合、これらのステップに従って ER 形式の構成をインポートします。

    1. 操作ウィンドウで、**交換** \> **XML ファイルからロード** を選択します。
    2. ダイアログ ボックスで、**参照** を選択して、**小切手印刷のformat.xml** ファイルを見つけて選択して、**OK** を選択します。

5. 構成ツリーで、**小切手のモデル** を展開します。
6. コンフィギュレーション ツリーでインポートされた ER コンフィギュレーションのリストを確認します。

### <a name="generate-a-payment-check"></a><a name="ExampleGenerateCheque"></a>支払小切手を生成する

1. **現金および銀行管理** \> **銀行口座** \> **銀行口座** に移動します。
2. **銀行口座** ページで、**USMF OPER** アカウントを選択します。
3. [銀行口座の詳細] ページの操作ウィンドウで、**セットアップ** タブの **レイアウト** グループで、**小切手** を選択します。
4. **小切手のレイアウト** ページで、**編集** を選択します。
5. **一般** のクイック タブで、**一般的な電子エクスポート形式** のオプションを **はい** に設定します。
6. **エクスポート形式の構成** フィールドで、前にインポートした **小切手印刷形式の** ER形式を選択します。
7. 操作ウィンドウで、**印刷テスト** を選択します。
8. ダイアログ ボックスで、**流通小切手形式** オプションを **はい** に設定し、**OK** を選択します。

    ![レイアウトの確認 - 印刷テストのダイアログ ボックス](./media/er-barcode-data-source-check-layout.png)

### <a name="review-the-generated-payment-check"></a><a name="ExampleReviewGeneratedCheque"></a>生成された支払い小切手をレビューする

- 生成された小切手を Excel で開きます。
2. 生成した小切手をレビューします。

    ![生成された支払い小切手を Excel で開く](./media/er-barcode-data-source-cheque1.png)

### <a name="modify-the-format-of-the-provided-er-solution"></a><a name="ExampleModifyFormat"></a>提供されている ER ソリューションの形式を変更する

#### <a name="apply-a-new-check-template"></a><a name="ExampleModifyFormatApplyTemplate"></a>新しい小切手テンプレートを適用する

Excel デスクトップ アプリケーションを使用して、前にインポートした **小切手テンプレートのExcel .xlsx** ファイルを開きます。 このテンプレートは、提供されている ER ソリューションで支払チェックを生成するために使用したテンプレートとは異なることに注意してください。 さらに、バーコード イメージの **AmountBarcode** 要素も含まれます。

![Excel テンプレートの AmountBarcode 要素](./media/er-barcode-data-source-cheque2.png)

ER ソリューションを変更してから、変更したテンプレートを[再度適用](modify-electronic-reporting-format-reapply-excel-template.md) する必要があります。

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成** セクションで、**レポートの構成** タイルを選択します。
3. **構成** ページの構成ツリーで、**小切手のモデル** を展開して、**小切手の印刷形式** を選択します。
4. アクション ウィンドウで、**デザイナー** を選択します。
5. ER 運営デザイナーで、**マッピング** タブを選択し、左側の形式ツリー ウィンドウで **展開/折りたたみ** を選択します。
6. すべてのセル形式要素が適切なデータソースにバインドされていることに注意してください。

    ![ER 操作デザイナーにおけるセル形式要素のデータソースへのバインド](./media/er-barcode-data-source-cells-bound.png)

7. ページの右側にあるバーで、**フォーマット** を選択します。
8. 操作ウィンドウで、省略記号 (**...**) を選択し、**インポート** を選択します。
9. **インポート** グループで、**Excelから更新** を選択し、**テンプレートの更新** を選択します。
10. このダイアログ ボックスで、コンピュータに保存されている **小切手テンプレートの Excel .xlsx** ファイルを参照して選択し、**OK** を選択して、選択したテンプレートが適用されることを確認します。
11. ページの右側にある **マッピング** タブを選択し、左側の形式ツリー ウィンドウで **展開/折りたたみ** を選択します。
12. **AmountBarcode** セル要素が形式に追加されていることを確認します。 この要素は、変更された Excel テンプレートにバーコードの画像のプレースホルダーとして追加された **AmountBarcode** 要素に関連付けられています。

    ![ER 操作デザイナーの形式に追加された AmountBarcode セル要素](./media/er-barcode-data-source-cell-added.png)

#### <a name="add-a-new-barcode-data-source"></a><a name="ExampleModifyFormatAddDataSource"></a>新しいバーコード データ ソースを追加する

次に、**バーコード** タイプの新しいデータソースを追加する必要があります。

1. ER 運営デザイナーで、ページの右側にある **マッピング** タブで、データソースの **印刷** を選択します。
2. **追加** をクリックし、**機能** グループで、**バーコード** データソース タイプを選択します。

    ![バーコード データソース タイプの選択](./media/er-barcode-data-source-add.png)

3. ダイアログボックスで、**名前** フィールドに **バーコード** と入力します。
4. **バーコード形式** で、**Code 128** を選択します。
5. **幅** フィールドに、**500** と入力します。
6. **OK** を選択します。

    ![データ ソース プロパティ ダイアログ ボックス](./media/er-barcode-data-source-add2.png)

#### <a name="bind-a-new-format-element"></a><a name="ExampleModifyFormatBindFormatElement"></a>新規形式要素をバインドする

次に、追加したデータ ソースに新しい形式要素をバインドする必要があります。

1. ER 運営デザイナーで、ページの右側にある **マッピング** タブで、**印刷\\バーコード** データ ソースを選択します。
2. 左にある書式ツリー ウィンドウで、**AmountBarcode** セル要素を選択して、**バインド** を選択します。
3. 操作ウィンドウで、**詳細の表示** を選択します。
4. **バーコード** データソースは、バインドでは 1 つのパラメータを含む関数として表されているため、バインド形式の要素の名前は、そのパラメータの引数として自動的に取得されます。

    ![ER オペレーション デザイナーのバーコード データソースの詳細](./media/er-barcode-data-source-bind1.png)

5. **フォーミュラの編集** を選択してバインドを調整します。

    セル要素の名前を返さないようにします。 したがって、現在の小切手の未払金額を含むテキストを返す式を構成する必要があります。 親 **ChequeLines** の範囲は **model.cheques** データソースにバインドされているため 、現在の小切手の未払金額は **実際の** でデータ型の **model.cheques.attributes.amount** フィールドで使用できます。

6. **式** フィールドに、**print.barcode(NUMBERFORMAT(@.attributes.amount, "F2"))** と入力します。
7. **保存** を選択して、[ER 式デザイナー](general-electronic-reporting-formula-designer.md) を閉じます。
8. バインドが調整されていることを確認します。

    ![ER 操作デザイナーで調整されたバインド](./media/er-barcode-data-source-bind2.png)

9. **保存** を選択して、ER 操作デザイナー を閉じます。

#### <a name="make-the-modified-version-available-for-test-runs"></a><a name="ExampleModifyFormatMakeVersionAvailable"></a>変更したバージョンをテストの実行に使用できるようにする

既定では、ステータスが **完了済** および **共有** のバージョンのみが、ER 形式を実行したときに使用されます。

変更が完了している場合は、現在の下書きバージョンを使用して作業を完了し、変更を使用できるようにしておくことができます。 手順については、この後の [変更された形式のバージョンの詳細](#CompleteToRun) を参照してください。

現在のドラフト バージョンで作業を続行するが、小切手を生成するために使用する必要がある場合は、実行するために下書きバージョンの形式を使用するように明示的に指定する必要があります。 手順については、[ドラフト バージョンを使用できるようにする](#MarkToRun) セクションを参照してください。

##### <a name="complete-the-modified-format-version"></a><a name="CompleteToRun"></a>変更した形式のバージョンを完了する

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成** セクションで、**レポートの構成** タイルを選択します。
3. **構成** ページの構成ツリーで、**小切手のモデル** を展開して、**小切手の印刷形式** を選択します。
4. **バージョン** クイック タブで、ステータスが **ドラフト** のレコードを選択します。
5. **ステータスの変更** を選択し、**完了** を選択します。
6. ダイアログ ボックスで、**OK** を選択します。

現在のバージョンのステータスが、**下書き** から **完了** に変更され、**ドラフト** のステータスを持つ新しいバージョンが作成されます。 この新しい下書きバージョンを使用して、追加の変更を適用できます。

##### <a name="make-the-draft-version-available-for-use"></a><a name="MarkToRun"></a>下書きバージョンを使用できるようにする

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成** セクションで、**レポートの構成** タイルを選択します。
3. **構成** ページの、操作ウィンドウ、**構成** タブ、**詳細設定** グループで、**ユーザー パラメーター** を選択します。
4. ダイアログ ボックスで、**実行設定** オプションを **はい** に設定し、**OK** を選択します。
5. 構成ツリーで、**小切手のモデル** を展開して、**小切手の印刷形式** を選択します。
6. **実行ドラフト** オプションを **はい** に設定します。
7. **保存** を選択します。

選択した形式を実行すると、選択した形式の下書きバージョンが使用可能としてマークされます。

### <a name="generate-a-payment-check"></a><a name="ExampleGenerateCheque2"></a>支払小切手を生成する

1. **現金および銀行管理** \> **銀行口座** \> **銀行口座** に移動します。
2. **銀行口座** ページで、**USMF OPER** アカウントを選択します。
3. [銀行口座の詳細] ページの操作ウィンドウで、**セットアップ** タブの **レイアウト** グループで、**小切手** を選択します。
4. **小切手のレイアウト** ページの操作ウィンドウで、**テストの印刷** を選択し ます。
5. ダイアログ ボックスで、**流通小切手形式** オプションを **はい** に選択します。
6. **OK** を選択します。
7. 生成した小切手をレビューします。 小切手の未払金額をエンコードするためのバーコードが生成されていることに注意してください。

    ![Excel のバーコードで生成された支払小切手](./media/er-barcode-data-source-cheque3.png)

> [!IMPORTANT]
> **バーコード** データ ソースに固有の適切な要件に、バーコード データ ソースの引数が準拠していない場合は、例外がスローされます。 たとえば、**バーコード** データ ソースが、指定されたテキストに [EAN 8](https://wikipedia.org/wiki/EAN-8) バーコードを生成するために呼び出された場合、テキストの長さが 7 文字を超えると例外がスローされます。

### <a name="convert-the-generated-check-to-a-pdf"></a><a name="ExampleConvertToPDF"></a>生成された小切手を PDF に変換する

[印刷可能な FTI 形式の生成](er-generate-printable-fti-forms.md#finland) に関するトピックで説明しているように、特殊フォントを使用して、生成されたドキュメントのバーコードを生成できます。 この場合、生成されたドキュメントの変換を追加すると、変換環境でそのフォントが使用できるかどうかによって異なる場合があります。 たとえば、ドキュメントを PDF 形式に変換しようとしたり、フォントが欠落している環境でプレビューしたりすると、バーコードは正しく表示されません。

ただし、**バーコード** データ ソースを使用してバーコードを作成する場合、これらのバーコードのレンダリングはフォントに依存しません。 したがって、バーコードが含まれているドキュメントを PDF 形式に簡単に変換できます。 次の図は、構成済みの ER [出力先](electronic-reporting-destinations.md) の設定に基づいて、PDFに [変換された](electronic-reporting-destinations.md#OutputConversionToPDF) 、生成された支払小切手のプレビューを示しています。

![支払小切手の PDF のプレビュー](./media/er-barcode-data-source-cheque4.png)

## <a name="limitations"></a>制限

> [!NOTE]
> 生成されるバーコードのタイプによっては、固定の縦横比が使用されている場合があります。 この動作は、**電子レポート フレームワーク機能で EPPlus ライブラリの使用を有効にする** 機能をオンにして、ER の Excel ドキュメントを操作している場合に理にかなっています。 この場合、縦横比がロックされたプレースホルダーにイメージが入力されます。 したがって、テンプレート内のプレースホルダーの寸法が入力された画像の比率に対応する場合、生成されたドキュメントの実際の画像は、必要な縦横比を維持するようにサイズ変更される場合があります。 画像がサイズ変更されないようにするには、必要な縦横比のプレースホルダーを使用します。

## <a name="additional-resources"></a>追加リソース

- [電子申告の概要](general-electronic-reporting.md)
- [電子レポートの出力先](electronic-reporting-destinations.md)
- [電子報告のフォーミュラ言語](er-formula-language.md)
- [NUMBERFORMAT 機能](er-functions-text-numberformat.md)


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]