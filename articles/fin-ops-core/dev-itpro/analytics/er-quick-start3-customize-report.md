---
title: 電子レポートのカスタマイズを構成して電子ドキュメントを生成する
description: このトピックでは、Microsoft が提供する電子レポート (ER) の構成をカスタマイズして、カスタム電子ドキュメントを生成する方法について説明します。
author: NickSelin
manager: AnnBe
ms.date: 10/21/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ERWorkspace, ERSolutionTable, ERParameters, ERDataModelDesigner, ERModelMappingTable, ERModelMappingDesigner, EROperationDesigner, ERVendorTable
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 220314
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.openlocfilehash: 2a0cc308e2e3c7f42295a6170c4f709a835c5c84
ms.sourcegitcommit: 6cb174d1ec8b55946dca4db03d6a3c3f4c6fa2df
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/09/2021
ms.locfileid: "5566129"
---
# <a name="customize-electronic-reporting-configurations-to-generate-an-electronic-document"></a>電子レポートのカスタマイズを構成して電子ドキュメントを生成する

[!include[banner](../includes/banner.md)]

[電子レポート (ER) フレームワーク](general-electronic-reporting.md)を使用すると 、が Microsoft Dynamics 365 Finance のインスタンスで提供している ER の[構成](general-electronic-reporting.md#Configuration)をアップロードでき ます。 このように、Microsoft が提供する構成は ER ソリューションとして機能し、電子顧客請求書 (電子インボイス) の生成に使用することができます。 この ER ソリューションを使用すると、ソースコードを編集することなく、カスタム データベースのフィールドにアクセスし、特定の要件に準拠した電子インボイスを生成するカスタム ER ソリューションを構成することができます。

## <a name="overview"></a>概要

このトピックの例では、電子請求書を発行するすべての顧客の新しいカスタム属性として連邦税の ID コードを指定する必要があります。 そのため、現在使用している請求書の構造をカスタマイズするには、生成される電子請求書のすべてに対して税コードの記入を必須かした項目を新たに追加する必要があります。

このトピックの手順では、システム管理者、電子レポート開発者、電子レポート機能コンサルタントのロールを持つユーザーが財務インスタンスで以下のタスクを実行する方法について説明します :

- [ER フレームワークを使い始めるにあたって必要となる ER パラメーターの最小限のセットを構成する](#ConfigureER)。
- [電子インボイスの生成に向けて提供されている標準的な ER 構成の最初のバージョンをインポートする](#ImportERConfigurations1)。
- [売掛金勘定パラメーターを構成して、標準的な ER の構成を使用する](#ConfigureAR1)。
- [法人のパラメーターを構成して、顧客に請求書を発行する](#ConfigureLE)。
- [電子請求書で使用する顧客レコードを準備する](#ConfigureCustomer1)。
- [標準的な ER の構成を使用して、顧客請求書を追加、転記、送信する ](#ProcessInvoice1)。
- [カスタマイズしたデータベース フィールドを追加して、顧客の連邦税 ID コードを管理する](#AddCustomField)。
- [ER のメタデータを更新して、ER モデル マッピング デザイナのデータベース変更を有効にする](#RefreshERMetadata)。
- [カスタマイズした ER 構成を設計して、新しい税コードを含む電子インボイスを生成する](#DesignCustomERConfigurations)。
- [売掛金勘定パラメーターを構成して、カスタマイズした ER の構成を使用する](#ConfigureAR2)。
- [電子請求書で使用する顧客レコードを更新する](#ConfigureCustomer2)。
- [カスタマイズした ER の構成を使用して、顧客請求書を追加、転記、送信する ](#ProcessInvoice2)。
- [電子インボイスの生成に向けて提供されている標準的な ER 構成の新しいバージョンをインポートする](#ImportERConfigurations2)。
- [カスタマイズした ER の構成に新しいバージョンの標準的な ER の構成に変更を適用する](#RebaseCustomERConfigurations)。
- [新しいバージョンの ER の構成を使用して、顧客請求書を追加、転記、送信する ](#ProcessInvoice3)。

**DEMF** 社を例に使用して、これらの手順について解説します。

## <a name="configure-the-er-framework"></a><a name="ConfigureER"></a> ER フレームワークを構成する

電子レポート機能コンサルタントや電子レポート開発者ロールを持つユーザーは、ER パラメーターの最小限のセットを構成する必要があります。 この手順を完了した後は、ER フレームワークを使用して、電子インボイスの生成に使用する ER ソリューションの標準的な構成のカスタマイズ版を設計することができます。

### <a name="configure-er-parameters"></a>ER パラメーターの構成

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**関連リンク** セクションで、**電子申告パラメーター** を選択します。
3. **電子申告パラメーター** ページの、**一般** タブで、**デザイン モードの有効化** オプションを **はい** に設定します。
4. **添付** タブの **構成** フィールドで、**ファイル** を選択します。
5. **ジョブ アーカイブ**、**一時的**、**ベースライン**、および **その他** フィールドで、**ファイル** タイプを選択します。

ER パラメーターについては、[ER フレームワークのコンフィギュレーション](electronic-reporting-er-configure-parameters.md) を参照してください。

### <a name="activate-an-er-configuration-provider"></a> ER 構成プロバイダーをアクティブにする

追加されたすべての ER 構成は、ER 構成プロバイダーによって所有されているものとしてマークされます。 **電子申告** ワークスペースで有効化された ER 構成プロバイダーは、この目的に使用されます。 したがって、ER 構成に追加または編集する前に、**電子申告** ワークスペースの ER 構成プロバイダーを有効化する必要があります。

> [!NOTE]
> ER 構成の所有者のみが編集できます。 したがって、ER 構成を編集する前に、適切な ER 構成 プロバイダーは **電子申告** ワークスペースで有効化する必要があります。

#### <a name="review-the-list-of-er-configuration-providers"></a> ER 構成 プロバイダーの一覧をレビュー

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**関連リンク** セクションで、**構成プロバイダー** を選択します。
3. **構成プロバイダー テーブル** ページでは、各プロバイダー レコードの名前と URL が一意になります。 このページの内容をレビューします。 **Litware, Inc.** (`https://www.litware.com`) のレコードが既に存在する場合は、次の手順をスキップし、[新しい ER 構成プロバイダーを追加](#AddProvider) します。

#### <a name="add-a-new-er-configuration-provider"></a><a id="AddProvider"></a> 新しい ER 構成プロバイダーを追加

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**関連リンク** セクションで、**構成プロバイダー** を選択します。
3. **構成プロバイダー** ページで、**新規** を選択します。
4. **名前** フィールドに、**Litware, Inc.** と入力
5. **インターネット アドレス** フィールドで、`https://www.litware.com` を入力します。
6. **保存** を選択します。

#### <a name="activate-an-er-configuration-provider"></a> ER 構成 プロバイダーをアクティブにする

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの **構成プロバイダー** セクションで、**Litware, Inc.** を選び、**有効に設定** を選択します。

ER 構成 プロバイダーについては、[構成 プロバイダーを作成し有効としてマークする](tasks/er-configuration-provider-mark-it-active-2016-11.md) を参照してください。

## <a name="import-the-initial-versions-of-standard-er-configurations"></a><a name="ImportERConfigurations1"></a>標準的な ER 構成の初期バージョンをインポートする

現在の財務インスタンスに標準的な ER の構成を追加するには、そのインスタンスに設定されている ER [リポジトリ](general-electronic-reporting.md#Repository)からインポートする必要があります。

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ コンフィグレーション** ページの **コンフィギュレーション プロバイダー** セクションで、**Microsoft** タイルを選択し、**リポジトリ** を選択して Microsoft プロバイダーのリポジトリの一覧を表示します。
3. **コンフィギュレーション リポジトリ** ページで、**グローバル** タイプのリポジトリを選択し、**開く** を選択します。 Regulatory Configuration Service に接続するために承認を求める場合は、その承認の指示に従います。
4. **構成リポジトリ** ページにて、ウィンドウの左側の構成ツリーで、**Peppol 売上請求書** 形式の構成を選択します。
5. **バージョン** FastTab で、バージョン **11.2.2** を選択します。
6. **インポート** を選択して、グローバル リポジトリから選択したバージョンをダウンロードします。

![レポジトリ ページの構成](./media/er-quick-start3-import-solution1.png)

> [!TIP]
> [グローバル リポジトリ](er-download-configurations-global-repo.md) へのアクセスに問題がある場合は、Microsoft Dynamics Lifecycle Services (LCS) から[構成をダウンロード](download-electronic-reporting-configuration-lcs.md) ができます。

### <a name="review-the-imported-er-configurations"></a> インポートされた ER 構成のレビュー

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成** セクションで、**レポート構成** タイルを選択します。
3. **構成** ページで、**構成コンポーネント** クイックタブを展開します。
4. 左ウィンドウの構成ツリーで、**請求書モデル** を展開し、 **UBL 売上請求書** を展開します。

選択した **Peppol 売上請求書** ER 形式に加えて、その他の必要な ER の構成がインポートされたことに注意してください。 新しいバージョンの ER の構成は、新しい要件に準拠するソリューションを維持するためにグローバル リポジトリと LCS に常に公開されているため、必要な [データ モデル](general-electronic-reporting.md#data-model-and-model-mapping-components)構成の最新バージョンとその [モデル マッピング](general-electronic-reporting.md#data-model-and-model-mapping-components)の構成がインポートされます。

![構成ページ](./media/er-quick-start3-imported-solution1a.png)

過去に **Peppol 売上請求書** の ER 形式のバージョン **11.2.2** をインポートした場合 (例えば 2019 年 8 月 7 日) に、現在の財務インスタンスの ER 構成がどのような状態になるかをシミュレーションするには、以下の手順に従います。

- アクション ペインで、**削除** を選択して、2019 年 8 月 7 日より後に発行されたすべての ER 構成を削除します。 **請求書モデル**、**請求書モデルのマッピング** (初期状態の名称は **顧客請求書モデル マッピング** です)、**UBL の売上請求書** および **Peppol の売上請求書** の売上請求書の構成のみを指定する必要があります。
- 変更されていない場合の構成については、**バージョン** クイックタブの **削除** を選択して、2019 年 8 月 7 日より後に発行されたすべてのバージョンの ER 構成を削除します。

構成ツリーで以下の構成が利用可能であることを確認してください :

- **請求書モデル** ER データモデルの構成 (初期状態の名称は **顧客請求書モデル** です) :

    - バージョン 11 には、請求書発行ビジネス ドメインのデータ構造を表す[データモデル](general-electronic-reporting.md#data-model-and-model-mapping-components) ER コンポーネントのバージョン 10 が含まれています。 この ER 構成は、インポート対象として選択された **Peppol 売り上げ請求書** の ER 形式の原型としてインポートされました。
    - バージョン 50 には、データモデル ER コンポーネントのバージョン31 が含まれています。 この ER 構成は、2019 年 8 月 7 日版の **請求書モデル マッピング**  ER モデル マッピング構成の原型としてインポートされています。

    ![構成ページの請求書 モデル ER データモデルの設定](./media/er-quick-start3-imported-solution1b1.png)

    > [!TIP]
    > このデータ モデルのバージョン 50 が表示されない場合は、グローバル リポジトリを開き、**請求書マッピング** ER 構成のバージョン 50.19 をインポートし ます。

- **請求書モデル マッピング** ER モデル マッピングの構成 (初期状態の名称は **顧客請求書モデル マッピング** です) :

    - バージョン 50.19 は、**請求モデル** ER のデータモデル構成の最新の50バージョンでの実装としてインポートされました。 これには、実行時にデータモデルがどのようにアプリケーションデータで格納されるかを記述した、 2 つの[モデル マッピング](general-electronic-reporting.md#data-model-and-model-mapping-components)ERコンポーネントが含まれています。

    ![構成ページにおける請求書モデル マッピング ER モデル マッピングの設定](./media/er-quick-start3-imported-solution1b2.png)

    > [!TIP]
    > このモデル マッピングのバージョン 50.19 が表示されない場合は、グローバル リポジトリを開き、**請求書マッピング** ER 構成のバージョン 50.19 をインポートします。

- **UBL 売上請求書** ER 形式の構成 :

    - バージョン 11.2 には、[形式](general-electronic-reporting.md#FormatComponentOutbound)と形式マッピング ER コンポーネントが含まれています。 形式コンポーネントは、レポートのレイアウトを指定します。 形式マッピング コンポーネントは、モデル データ ソースが含まれており、このデータ ソースが実行時にレポート レイアウトを埋めるためにどのように使用されるかを指定します。 この ER 形式は、電子インボイスを汎用ビジネス言語 (UBL) 形式で生成するように構成されています。 この ER 構成は、インポート対象として選択された **Peppol 売り上げ請求書** の ER 形式の親としてインポートされました。

- **Peppol 売上請求書** ER 形式の構成 :

    - バージョン 11.2.2 には、汎欧州オンライン公的調達 (PEPPOL)フォーマットで電子インボイスを生成するように構成された形式と形式マッピング ER コンポーネントが含まれています。

    ![構成ページの Peppol 売上請求書 ER 形式の設定](./media/er-quick-start3-imported-solution1b3.png)

## <a name="configure-the-accounts-receivable-parameters"></a><a name="ConfigureAR1"></a>売掛金のパラメーターを設定する

1. **売掛金勘定** \> **設定** \> **売掛金勘定パラメーター** に移動します。
2. **電子ドキュメント** タブの **電子報告書** クイックタブで、**売上と自由書式の請求書** フィールドの **Peppol 売上請求書** を選択します。
3. **保存** を選択します。

![売掛金パラメーター ページの電子ドキュメント タブ](./media/er-quick-start3-configure-ar1.png)

## <a name="configure-the-legal-entity-parameters"></a><a name="ConfigureLE"></a>法人パラメーターの構成

1. **組織管理** \> **組織** \> **法人** の順に移動します。
2. 選択した **DEMF** 社の、**銀行口座情報** クイックタブの **ルーティング番号** フィールドに、**1234** と入力します。
3. **保存** を選択します。
4. **法人** ページを閉じます。

## <a name="prepare-a-customer-record"></a><a name="ConfigureCustomer1"></a>顧客レコードを準備する

1. **売掛金勘定** \> **顧客** \> **すべての顧客** の順に移動します。
2. **すべての顧客** ページで、顧客アカウント リンクに **DE-014** を選択します。

### <a name="add-a-customer-contact"></a>顧客連絡先の追加

1. **売掛金勘定** \> **顧客** \> **すべての顧客** の順に移動します。
2. アクション ペインで、**顧客** タブの **アカウント** グループで、**連絡先** を選択します。
3. **連絡先の追加** を選択します。
4. **連絡先** ページの **名前** フィールドで検索を開き、**Adam Carter** を選択して、 **選択** を選択して検索を終了します。
5. **保存** を選択します。
6. **連絡先** ページを閉じます。

### <a name="define-a-primary-contact"></a>基本連絡先を定義する

1. **売掛金勘定** \> **顧客** \> **すべての顧客** の順に移動します。
2. **顧客情報** クイックタブの **基本連絡先** フィールドで、**Adam Carter** を選択します。

### <a name="set-the-e-invoicing-option"></a>電子請求書のオプションの設定

1. **売掛金勘定** \> **顧客** \> **すべての顧客** の順に移動します。
2. **請求と出荷** クイックタブで、**eInvoice** オプションを **はい** に設定します。
3. **保存** を選択します。
4. **すべての顧客** ページを閉じます。

## <a name="process-a-customer-invoice-by-using-the-standard-er-configurations"></a><a name="ProcessInvoice1"></a>標準的な ER の構成を使用して、顧客請求書を処理する

以上で、インポートした標準の ER 構成を使用して、自由書式の請求書を顧客に電子的に送信できるようになりました。

### <a name="add-a-new-invoice"></a>新しい請求書の追加

1. **売掛金勘定** \> **請求書** \> **すべての自由書式の請求書** に移動します。
2. **自由書式の請求書** ページで、**新規** を選択します。
3. **自由書式の請求書ヘッダー** クイックタブの **顧客アカウント** フィールドで、**DE-014** を選択します。
4. **請求明細行** クイックタブで、請求書の明細行が自動的に追加されます。 この明細行で、次の値を設定します :

    - **説明** フィールドで **ノートブック** を入力します。
    - **主勘定** フィールドで、 **401100** を選択します。
    - **単価フィールド** に **1000** と入力します。

5. **保存** を選択します。

![自由書式の請求書のページ](./media/er-quick-start3-add-invoice.png)

詳細については、[自由書式の請求書](../../../finance/accounts-receivable/create-free-text-invoice-new.md)を参照してください。

### <a name="post-a-new-invoice"></a>新しい請求書を転記する

1. **売掛金勘定** \> **請求書** \> **すべての自由書式の請求書** に移動します。
2. **自由書式の請求書** ページのアクション ペインで、**転記** を選択します。
3. **自由書式の請求書の転記**  ダイアログ ボックスで、**OK** を選択し ます。

![自由書式の請求書の詳細ページ](./media/er-quick-start3-post-invoice.png)

### <a name="send-a-posted-invoice"></a>転記された請求書を送信する

1. **売掛金勘定** \> **請求書** \> **すべての自由書式の請求書** に移動します。
2. **自由書式の請求書** ページのアクション ペイン **ドキュメント** グループで、 **送信** \> **原本** を選択し ます。

    ![原本の請求書のプレビュー](./media/er-quick-start3-send-invoice.png)

3. **自由書式の請求書**  ページを閉じます。

### <a name="analyze-a-generated-e-invoice"></a>生成された電子請求書の分析

1. **組織管理** \> **電子申告** \> **電子申告ジョブ** の順に選択します。
2. **電子申告** ジョブ ページで、タスクの説明に **eInvoice XML を送信する** がある初期レコードを選択します。
3. **ファイルの表示** を選択 すると、生成されたファイルの一覧にアクセスできます。

    ![電子申告ジョブ ページ](./media/er-quick-start3-jobs-list.png)

4. **開く** を選択して、生成された電子請求書の XML ファイルをダウンロードします。
5. 電子請求書の XML ファイルを分析します。 顧客税スキーマは現在、**schemeID** と **schemeAgencyID** の XML 属性で表されていることを確認してください。 また、**cbc: CustomizationID** XML 要素には次のテキストが現在含まれていることに注意してください :  `urn:www.cenbii.eu:transaction:biicoretrdm010:ver1.0:# urn:www.peppol.eu:bis:peppol5a:ver1.0` 。

    ![生成された電子請求書の XML ファイルのプレビュー](./media/er-quick-start3-e-invoice1.png)

## <a name="add-a-custom-database-field"></a><a name="AddCustomField"></a>カスタム データベース フィールドの追加

[カスタム フィールド](../../fin-ops/get-started/user-defined-fields.md)機能を使用すると、現在の財務インスタンスで次のようなカスタマイズを実行できます :

- 顧客ごとに連邦税の識別コードを格納するカスタム データベース フィールドを新たに追加して、データベースの構造をカスタマイズします。
- 新しいカスタムデータベースのフィールドに税コードの値を入力するために使用できる新しいデータ入力フィールドを追加して、**顧客ページ** をカスタマイズします。

これらの手順に従ってカスタマイズを行います。

1. **売掛金勘定** \> **顧客** \> **すべての顧客** の順に移動します。
2. **すべての顧客** ページで、顧客アカウント リンクに **DE-014** を選択します。
3. **全般** クイックタブで、**言語**  フィールドの下の空白領域を右クリックし、**個人設定 : UpperGroup** をクリックします。

    **一般** クイックタブの内容が強調表示され、**個人用** メニューが表示されます。

4. **個人設定** メニューで、**フィールドの追加** を選択し ます。
5. **新しい列の追加** ダイアログ ボックスで、 **新規フィールドの作成** を選択します。
6. **新しいフィールドの作成** ダイアログ ボックスの **テーブル名** フィールドで、**顧客** を選択します。
7. **名前の接頭辞** フィールドに、**FederalTaxID** を入力します。

    > [!NOTE]
    > フィールド名全体が自動的に **FederalTaxID\_Custom** と定義されています。

8. **ラベル** フィールドで、**連邦税 ID** と入力します。
9. **タイプ** フィールドで、**テキスト** を選択します。
10. **長さ** フィールドに **20** を入力します。
11. **保存** を選択します。
12. 表示されたメッセージボックスで、**はい** を選択し、**顧客** テーブルに対して新しい **FederalTaxID** フィールド エントリを作成することを確認します。
13. **挿入** を選択して <a name="insert_custom_field"></a> **FederalTaxID\_Custom** フィールドを現在のページに追加します。

    ![すべての顧客のページ](./media/er-quick-start3-create-new-field.gif)

14. **すべての顧客** ページを閉じます。

## <a name="refresh-the-er-metadata"></a><a name="RefreshERMetadata"></a>ER メタデータの更新

追加したカスタム フィールドを ER モデル マッピング デザイナーで[表示する](electronic-reporting-er-configure-parameters.md#frequently-asked-questions)には、ER のメタデータを更新する必要があります。

1. **組織管理** \> **電子申告** \> **テーブル参照のリビルド** の順に移動します。
2. **データ モデルの更新** ダイアログ ボックスで、**OK** を選択し ます。

## <a name="design-the-custom-er-configurations"></a><a name="DesignCustomERConfigurations"></a>カスタム ER 構成の設計

Microsoft が提供する ER 構成を使用して、カスタム ER 構成を設計し、新しい税コードを含む電子インボイスを生成することができます。

### <a name="customize-the-data-model-configuration"></a>データ モデルの構成をカスタマイズする

電子レポート機能コンサルタントのロールを持つユーザーは、カスタム ER データ モデルを設計することができます。

#### <a name="add-a-custom-data-model-configuration"></a>カスタム ER データ モデルの構成を追加する

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページで、ペインの左側の構成ツリーで、**顧客請求書モデル** を選択します。
3. アクション ウィンドウで、**構成の作成** を選択します。
4. ドロップダウン ダイアログ ボックスの **新規** フィールドで、 **名前から派生 : 顧客請求書モデル、Microsoft** を選択し、新しいカスタム ER データ モデルの構成が ER データ モデルの構成に基づくものであることを明示します。
5. **名前** フィールドに、**請求書モデル (Litware)** と入力します。
6. **構成の作成** を選択して、新しい ER の構成を追加します。

これで、ER データ モデル デザイナーを使用して、**請求モデル (Litware)** の ER 構成のバージョン 50.1 を **ドラフト** の[状態](general-electronic-reporting.md#component-versioning)で編集できるようになります。

![構成ページの ER の構成 バージョン 50.1](./media/er-quick-start3-added-custom-model.png)

#### <a name="configure-a-custom-data-model"></a>カスタム データ モデルの構成

連邦税 ID コードの値を提供する新たなフィールドを追加して、カスタム データ モデルを変更する必要があります。 このコードは、このデータ モデルをデータ ソースとして使用するすべての ER 形式の顧客データの一部となります。

1. **構成** ページの、左側のペインの構成ツリーで、**請求書モデル (Litware)** を選択します。
2. **バージョン**  クイック タブで、**ドラフト** の状態となっている、選択した ER データ モデルの構成バージョン **50.1** を選択します。
3. アクション ペインで、選択した構成バージョンの  **デザイナー** を選択します。
4. **データ モデル デザイナー** ページのデータ モデル ツリーで、**顧客情報 (顧客)** を選択します。
5. **新規** を選択します。
6. ドロップダウン ダイアログ ボックスの **新しいノード** フィールドで、**アクティブなノードの子** の既定値をそのまま使用します。
7. **名前** フィールドに、**FederalTaxID\_Litware** を入力します。
8. **品目タイプ** フィールドで、既定値の **文字列** をそのまま使用します。
9. **追加** を選択してから、**保存** を選択します。

    ![データ モデル デザイナーのページ](./media/er-quick-start3-add-data-model-field.png)

    > [!NOTE]
    > **ラベル** フィールドと **説明** フィールドには、新しいフィールドの目的が示されます。 これらのフィールドは、複数の言語で入力できます。 詳細については、[電子申告で複数言語のレポートを設計する](er-design-multilingual-reports.md) を参照してください。

10. **データ モデル デザイナー** ページを閉じます。

#### <a name="complete-a-custom-data-model-configuration"></a>カスタム データ モデルの構成を完了する

他のカスタム ER の構成を追加できるように、カスタム ER データ モデル構成のバージョン 50.1 を使用して作業を[完了](general-electronic-reporting.md#component-versioning)する必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、**請求書モデル** を展開し、**請求書モデル (Litware)** を選択します。
3. **バージョン** クイックタブで、**ステータスの変更** \> **完了済**、そして **OK** を選択します。

バージョン 50.1 のステータスは、**ドラフト** から **完了済** に変更され、バージョンは読み取り専用になります。 新しい編集可能なバージョン 50.2 が追加され、状態が **ドラフト** になります。 このバージョンを使用すると、カスタム ER データ モデルの構成にさらに変更を加えることができます。

![構成ページで完了したバージョン 50.1](./media/er-quick-start3-completed-custom-model1.png)

### <a name="customize-the-model-mapping-configuration"></a>モデル マッピングの構成をカスタマイズする

電子レポート機能の開発者のロールを持つユーザーは、カスタム ER モデル マッピングを設計することができます。

#### <a name="add-a-custom-model-mapping-configuration"></a>カスタム モデル マッピングの構成を追加する

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、**顧客請求書モデル** を展開し、**顧客請求書モデル マッピング** を選択します。
3. アクション ウィンドウで、**構成の作成** を選択します。
4. ドロップダウン ダイアログ ボックスの **新規** フィールドで、 **名前から派生 : 顧客請求書モデル マッピング、Microsoft** を選択し、新しいカスタム ER モデル マッピングの構成が ER モデル マッピングの構成に基づくものであることを明示します。
5. **名前** フィールドに、**請求書モデル マッピング (Litware)** と入力します。
6. **ターゲット モデル** フィールドで、**請求書モデル (Litware)** を選択します。

    > [!IMPORTANT]
    > この手順は非常に重要です。 これを省略すると、構成済のモデル マッピングでカスタム データ モデルを使用できなくなります。

7. **構成の作成** を選択して、新しい ER の構成を追加します。

![構成ページにおけるカスタム モデル マッピング構成の追加](./media/er-quick-start3-adding-custom-mapping.png)

#### <a name="configure-a-custom-model-mapping"></a>カスタム モデル マッピングの構成

カスタム モデルのマッピングを修正し、カスタム データ モデルのカスタム **FederalTaxID\_Litware** フィールドを実行時にアプリケーション データでどのように入力するかを指定する必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、 **顧客請求書モデル** \> **顧客請求書モデル マッピング** を展開し、**請求書モデル マッピング (Litware)** を選択します。
3. アクション ウィンドウで、**デザイナー** を選択します。
4. **モデルからデータ ソースへのマッピング** ページで、**顧客請求書** マッピングを選択します。

    ![モデルからデータ ソースへのマッピング ページ](./media/er-quick-start3-select-customer-mapping.png)

5. **デザイナー** をクリックします。
6. **モデル マッピング デザイナ** ページの **データ ソース** ペインで、**CustInvoiceJour** アプリケーション テーブルを表す **CustInvoiceJour** データソースを展開します。
7. **CustInvoiceJour** 配下の **関係** を展開して、**CustInvoiceJour** テーブルの多対一 (N:1) タイプの関係の一覧を確認します。
8. **CustInvoiceJour** \> **関係** 配下で、**顧客 (CustTable)** を展開して、**Customers (CustTable)** テーブルのフィールドと関係にアクセスします。
9. [前述の手順](#insert_custom_field)で実装した **FederalTaxID\_カスタム** データ ソース フィールドを選択します。
10. **データモデル** ペインで、**顧客情報 (顧客)** を展開 し、**FederalTaxID\_Litware** データ モデル フィールドを選択します。
11. **バインド** を選択します。

    ![モデル マッピング デザイナーのページ](./media/er-quick-start3-customize-model-mapping.gif)

12. **保存** を選択します。
13. **モデル マッピング デザイナー** ページを閉じます。
14. **モデルからデータ ソースへのマッピング** ページを閉じます。

#### <a name="complete-a-custom-model-mapping-configuration"></a>カスタム モデルの構成を完了する

カスタム ER モデル マッピング構成のバージョン 50.19.1 を使用できるようにするには、作業を[完了](general-electronic-reporting.md#component-versioning)させる必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、 **顧客請求書モデル** \> **顧客請求書モデル マッピング** を展開し、**請求書モデル マッピング (Litware)** を選択します。
3. **バージョン** クイックタブで、**ステータスの変更** \> **完了済**、そして **OK** を選択します。

バージョン 50.19.1 のステータスは、**ドラフト** から **完了済** に変更され、バージョンは読み取り専用になります。 新しい編集可能なバージョン 50.19.2 が追加され、状態が **ドラフト** になります。 このバージョンを使用すると、カスタム ER モデル マッピングの構成にさらに変更を加えることができます。

![構成ページで完了したバージョン 50.19.1](./media/er-quick-start3-completed-custom-mapping1.png)

> [!NOTE]
> サポートされている構成[ライフサイクル](general-electronic-reporting-manage-configuration-lifecycle.md) は、データベースの変更のライフサイクルをカバーしていません。 現在の財務インスタンスから **請求書モデルマッピング (Litware)** 構成のバージョン 50.19.1 をエクスポートして、**CustTable** テーブルのカスタム **FederalTaxID\_Custom** フィールドを含まない別のインスタンスにインポートしようとすると、例外が発生します。 この例外は、インポートした ER の構成がターゲットの財務インスタンスのメタデータと互換性がないことを示しています。

### <a name="customize-the-format-configuration"></a>形式の構成をカスタマイズする

電子レポート機能コンサルタントのロールを持つユーザーは、カスタム ER の形式を設計することができます。

#### <a name="add-a-custom-format-configuration"></a>カスタム ER 形式の構成を追加する

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成**  ページの左側ペインの構成ツリーで、**顧客請求書モデル** \> **UBL 売上請求書** を展開し、**Peppol 売上請求書** を選択します。
3. アクション ウィンドウで、**構成の作成** を選択します。
4. ドロップダウン ダイアログ ボックスの **新規** フィールドで、 **名前から派生 : Peppol 売上請求書、Microsoft** を選択し、カスタム ER 形式の構成が ER 形式の構成に基づくものであることを明示します。
5. **名前** フィールドに、**Peppol 売上請求書 (Litware)** と入力します。
6. **データ モデル** フィールドで、**請求書モデル (Litware)** を選択してカスタム データ モデルとモデル マッピング コンポーネントを使用します。

    > [!NOTE]
    > この手順は非常に重要です。 これを省略すると、構成済の形式でカスタム データ モデルを使用できなくなります。

7. **データ モデル** フィールドで、**InvoiceCustomer** のルート定義を選択します。
8. **構成の作成** を選択して、新しい ER の構成を追加します。

![構成ページにおけるカスタム形式構成の追加](./media/er-quick-start3-adding-custom-format.png)

これで、ER オペレーション デザイナーを使用して、**Peppol 売上請求書 (Litware)** の ER 構成のバージョン 11.2.2.1 を **ドラフト** の[状態](general-electronic-reporting.md#component-versioning)で編集できるようになります。

![構成ページの ER の構成 バージョン 11.2.2.1](./media/er-quick-start3-added-custom-format.png)

#### <a name="configure-a-custom-format"></a>カスタム形式の構成

請求書を発行した顧客の連邦税 ID コードの値を記入する新しい形式要素を追加して、カスタム フォーマットを修正する必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、**顧客請求書モデル** \> **UBL 売上請求書** \> **Peppol 売上請求書** を展開し、**Peppol 売上請求書 (Litware)** を選択します。
3. アクション ウィンドウで、**デザイナー** を選択します。
4. 形式のツリーで、**XMLHeader** \> **請求書** \> **cac:AccountingCustomerParty** \> **cac:Party** \> **cac:PartyTaxScheme** \> **cac:TaxScheme** を展開し、**cbc:ID** を選択します。
5. **追加** を選択し、**XML** \> **属性** を選択します。
6. **コンポーネント プロパティ** ダイアログ ボックスの、**名前** フィールドで、**FederalTaxID** を入力してください。
7. **OK** を選択して新しい形式要素を追加し、新たな **FederalTaxID** XML 属性を生成した XML ファイルに作成します。
8. 形式のツリーで、 **XMLHeader** \> **請求書** \> **cac:AccountingCustomerParty** \> **cac:Party** \> **cac:PartyTaxScheme** \> **cac:TaxScheme** \> **cbc:ID** 配下で、**FederalTaxID** を選択します。
9. **上へ移動** を選択します。

![形式デザイナー ページにおける新しい形式要素](./media/er-quick-start3-customized-format.png)

#### <a name="configure-a-custom-format-mapping"></a>カスタム形式マッピングの構成

1. **形式デザイナー** ページの **マッピング** タブで、**モデル** タイプの **請求書** データ ソースを展開します。
2. **請求書** 配下で  **顧客情報 (顧客)** を展開し、**FederalTaxID\_Litware** を選択します。
3. **バインド** を選択します。

    ![形式デザイナーのページ](./media/er-quick-start3-customized-format-mapping.png)

4. **モデル** タイプの **請求書** データ ソースを選択し、**編集** を選択します。
5. **バージョン** フィールドで、カスタム データモデルのバージョン **1** を選択し、**OK** を選択します。
6. **保存** を選択します。
7. **形式デザイナー** ページを閉じます。

#### <a name="complete-a-custom-format-configuration"></a>カスタム形式の構成を完了する

カスタム ER 形式の構成バージョン 11.2.2.1 を使用できるようにするには、作業を[完了](general-electronic-reporting.md#component-versioning)させる必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、**顧客請求書モデル** \> **UBL 売上請求書** \> **Peppol 売上請求書** を展開し、**Peppol 売上請求書 (Litware)** を選択します。
3. **バージョン** クイックタブで、**ステータスの変更** \> **完了済**、そして **OK** を選択します。

バージョン 11.2.2.1 のステータスは、**ドラフト** から **完了済** に変更され、バージョンは読み取り専用になります。 新しい編集可能なバージョン 11.2.2.2 が追加され、状態が **ドラフト** になります。 このバージョンを使用すると、カスタム ER 形式の構成に追加の変更を加えることができます。

![構成ページで完了したバージョン 11.2.2.1](./media/er-quick-start3-completed-custom-format1.png)

## <a name="configure-the-accounts-receivable-parameters-to-start-to-use-custom-er-configurations"></a><a name="ConfigureAR2"></a>売掛金勘定パラメーターを構成して、カスタマイズした ER の構成を使用する

1. **売掛金勘定** \> **設定** \> **売掛金勘定パラメーター** に移動します。
2. **電子ドキュメント** タブの **電子報告書** クイックタブで、**売上と自由書式の請求書** フィールドの **Peppol 売上請求書 (Litware)** を選択します。
3. **保存** を選択します。

![売掛金パラメーター ページの、電子ドキュメント タブ、電子報告書 クイックタブ](./media/er-quick-start3-configure-ar2.png)

## <a name="update-a-customer-record-by-adding-a-federal-tax-identification-code"></a><a name="ConfigureCustomer2"></a>連邦税 ID コードを追加して顧客記録を更新する

1. **売掛金勘定** \> **顧客** \> **すべての顧客** の順に移動します。
2. **すべての顧客** ページで、顧客アカウント リンクに **DE-014** を選択します。
3. **全般** クイックタブの **連邦税 ID** フィールドに、**LITWARE-6789** と入力します。
4. **保存** を選択します。

    ![DE-014 顧客の詳細 ページ](./media/er-quick-start3-added-tax-id-value.png)

5. **すべての顧客** ページを閉じます。

## <a name="process-a-customer-invoice-by-using-custom-er-configurations"></a><a name="ProcessInvoice2"></a>カスタマイズした ER の構成を使用して、顧客請求書を処理する

### <a name="select-and-send-a-posted-invoice"></a>転記された請求書を選択して送信する

1. **売掛金勘定** \> **請求書** \> **すべての自由書式の請求書** に移動します。
2. **自由書式の請求書** ページで、前述の手順で追加して転記した請求書を選択します。
3. アクション ペインの **ドキュメント** グループで、**送信** \> **原本** を選択します。
4. **自由書式の請求書**  ページを閉じます。

### <a name="analyze-a-generated-e-invoice"></a>生成された電子請求書の分析

1. **組織管理** \> **電子申告** \> **電子申告ジョブ** の順に選択します。
2. **電子申告ジョブ** ページで、タスクの説明に **eInvoice XML を送信する** がある最新のレコードを選択します。
3. **ファイルの表示** を選択 すると、生成されたファイルの一覧にアクセスできます。
4. **開く** を選択して、生成された電子請求書の XML ファイルをダウンロードします。
5. 電子請求書の XML ファイルを分析します。 カスタマイズに従って、顧客税スキーマには、**schemeID** と **schemeAgencyID** の XML 属性に加えて、カスタマイズした **FederalTaxID** XML属性が含まれていることに注意してください。 この新しい XML 属性の値は、請求先に入力された 連邦税ID **LITWARE-6789** によって指定されます。

    ![カスタマイズして生成された e-インボイス XMLファイルのプレビュー](./media/er-quick-start3-e-invoice2.png)

## <a name="import-the-latest-versions-of-standard-er-configurations"></a><a name="ImportERConfigurations2"></a>標準的な ER 構成の最新のバージョンをインポートする

標準の ER 設定のセットを財務インスタンスを[最新](general-electronic-reporting-manage-configuration-lifecycle.md)に保持するには、そのインスタンスに設定されたER [リポジトリ](general-electronic-reporting.md#Repository)で利用できるようになるたびに、新しいバージョンをインポートする必要があります。

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ コンフィグレーション** ページの **コンフィギュレーション プロバイダー** セクションで、**Microsoft** タイルを選択し、**リポジトリ** を選択して Microsoft プロバイダーのリポジトリの一覧を表示します。
3. **コンフィギュレーション リポジトリ** ページで、**グローバル** タイプのリポジトリを選択し、**開く** を選択します。 Regulatory Configuration Service に接続するために承認を求める場合は、その承認の指示に従います。
4. **構成リポジトリ** ページにて、ウィンドウの左側の構成ツリーで、**Peppol 売上請求書** 形式の構成を選択します。
5. **バージョン** クイックタブで、PEPPOL BIS 3形式の顧客電子請求書をサポートするためにリリースされた ER 形式構成のバージョン **32.6.7** を選択します。 詳細については、[KB4490320](https://support.microsoft.com/help/4490320/an-update-for-european-union-to-support-export-of-customers-electronic) を参照してください。
6. **インポート** を選択して、グローバル リポジトリから現在の Finance インスタンスに選択したバージョンをダウンロードします。

![構成リポジトリ ページにおける、選択されたバージョン 32.6.7](./media/er-quick-start3-import-solution2.png)

このプロセスを自動化する方法の詳細については、[ER 構成の更新されたバージョンをインポートする](er-download-updated-versions-global-repo.md)を参照してください。

### <a name="review-the-imported-er-configurations"></a> インポートされた ER コンフィギュレーションのレビュー

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成** セクションで、**レポート構成** タイルを選択します。
3. **コンポーネントの構成** クイック タブを展開します。
4. ウィンドウの左側にある構成ツリーで、**請求書モデル** を展開します。 インポートされた ER データモデル構成のいずれかが、**顧客請求書モデル** の名前が **請求書モデル** に変更されていることに確認します。
5. ウィンドウの左側にある構成ツリーで、**請求書モデル マッピング** を展開します。 インポートされた ER モデル構成のいずれかで、**顧客請求書モデル マッピング** の名前が **請求書モデル マッピング** に変更されていることに確認します。
6. **UBL 売上請求書** \> **Peppol 売上請求書** を展開します。

選択した **Peppol 売上請求書** ER 形式に加えて、その他の必要な ER 構成の最新バージョンがインポートされたことを確認してください。 新しいバージョンの ER の構成は、新しい要件に準拠する ER ソリューションを維持するためにグローバル リポジトリと LCS に常に公開されているため、必要な データ モデル構成の最新バージョンとその モデル マッピングの構成がインポートされます。

構成ツリーで、最終的に以下の ER 構成が利用可能となるように設定をしてください :

- **請求書モデル** ER データ モデルの構成 :

    - バージョン 206 (またはそれ以降) には、請求書発行ビジネス ドメインのデータ構造を表すデータモデル ER コンポーネントのバージョン 24 (またはそれ以降) が含まれています。 この ER 構成は、最新版の **請求書モデル マッピング**  ER モデル マッピング構成の原型としてインポートされています。

    ![構成ページにおけるバージョン 206](./media/er-quick-start3-imported-solution2b1.png)

- **請求書 モデル マッピング** ER モデル マッピングの構成 :

    - **請求書モデル** ER データ モデルの構成バージョン 206 の最新実装として、バージョン206.132 (またはそれ以降) がインポートされています。 これには、実行時にデータモデルがどのようにアプリケーションデータで格納されるかを記述した、複数のモデル マッピングERコンポーネントが含まれています。

    ![構成ページにおけるバージョン 206.132](./media/er-quick-start3-imported-solution2b2.png)

- **UBL 売上請求書** ER 形式の構成 :

    - バージョン 32.6 には、形式と形式マッピング ER のコンポーネントが含まれています。 形式コンポーネントは、レポートのレイアウトを指定します。 形式マッピング コンポーネントは、モデル データ ソースが含まれており、このデータ ソースが実行時にレポート レイアウトを埋めるためにどのように使用されるかを指定します。 この ER 形式は、電子インボイスを UBL 形式で生成するように構成されています。 この ER 構成は、インポート対象として選択された **Peppol 売り上げ請求書** の ER 形式の親としてインポートされました。

- **Peppol 売上請求書** ER 形式の構成 :

    - バージョン 32.6.7 には、PEPPOL フォーマットで電子インボイスを生成するように構成された形式と形式マッピング ER コンポーネントが含まれています。

    ![構成ページにおけるバージョン 32.6.7](./media/er-quick-start3-imported-solution2b3.png)

## <a name="adopt-the-changes-to-the-new-standard-er-configurations-in-your-custom-er-configurations"></a><a name="RebaseCustomERConfigurations"></a>カスタマイズした ER の構成に新しいバージョンの標準的な ER の構成に変更を適用する

### <a name="adopt-your-custom-er-data-model"></a>カスタム ER データモデルの採用

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、**請求書モデル** を展開し、**請求書モデル (Litware)** を選択します。
3. **バージョン**  クイック タブで、選択されたデータモデル構成のドラフトバージョン **50.2** に対して **リベース** を選択します。
4. **ターゲット バージョン** フィールドで、基本 ER デー タモデル構成のバージョン **206** が選択されていることを確認し、**OK** を選択します。

    カスタム ER データ モデル構成のドラフト版の番号が **50.2** から **206.2** に変更され、基本 ER データ モデル構成の最新バージョン (206) の変更とマージされたカスタマイズが含まれていることを示しています。

    > [!NOTE]
    > リベース アクションを元に戻すことができます。 このリベースをキャンセルするには、**バージョン** クイックタブで **請求書モデル (Litware)** のバージョン **50.1** を選び、**このバージョンを取得する** を選択します。 バージョン 206.2 は **50.2** に番号が振り直され、バージョン 50.2 のドラフトの内容はバージョン 50.1 の内容と一致します。

5. **バージョン** クイックタブで、**ステータスの変更** \> **完了済**、そして **OK** を選択します。

バージョン 206.2 のステータスは、**ドラフト** から **完了済** に変更され、バージョンは読み取り専用になります。 新しい編集可能なバージョン 206.3 が追加され、状態が **ドラフト** になります。 このバージョンを使用すると、カスタム ER データ モデルの構成にさらに変更を加えることができます。

![構成ページで完了したバージョン 206.2](./media/er-quick-start3-completed-custom-model2.png)

### <a name="adopt-your-custom-er-model-mapping"></a>カスタム ER モデル マッピングの採用

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、 **請求書モデル** \> **請求書モデル マッピング** を展開し、**請求書モデル マッピング (Litware)** を選択します。
3. **バージョン**  クイック タブで、選択されたモデル マッピング構成のドラフトバージョン **50.19.2** に対して **リベース** を選択します。
4. **ターゲット バージョン** フィールドで、基本 ER モデル マッピング構成のバージョン **206.132** が選択されていることを確認し、**OK** を選択します。

    カスタム ER データ モデル マッピング構成のドラフト版の番号が **50.19.2** から **206.132.2** に変更され、基本 ER モデル マッピング構成の最新バージョン (206.132) の変更とマージされたカスタマイズが含まれていることを示しています。

    一部のリベースの競合が検出されたことを確認します。 このような競合は手動で解決する必要があります。

    ![構成ページにおける競合メッセージのリベース](./media/er-quick-start3-rebase-conflicts-model-mapping1.png)

5. アクション ペインで **デザイナ** を選択 し、マッピングの一覧で **顧客請求書** を選択します。
6. それぞれのリベースの競合については、各コンポーネントに対してカスタム データ モデルのバージョン番号を保持する必要があるため、**独自の値を保持する** を選択します。

    ![モデル マッピング デザイナ ページにおける競合をリベースする](./media/er-quick-start3-rebase-conflicts-model-mapping2.png)

7. **保存** を選択し、**モデル マッピング デザイナ** ページを閉じます。
8. マッピングの一覧で、 **プロジェクト請求書** を選択します。
9. それぞれのリベースの競合については、各コンポーネントに対してカスタム データ モデルのバージョン番号を保持する必要があるため、**独自の値を保持する** を選択します。
10. **保存** を選択し、**モデル マッピング** ページを閉じます。

    > [!NOTE]
    > リベース アクションを元に戻すことができます。 このリベースをキャンセルするには、**バージョン** クイックタブで **請求書モデル マッピング (Litware)** のバージョン **50.19.1** を選び、**このバージョンを取得する** を選択します。 バージョン 206.132.2 は **50.19.2** に番号が振り直され、バージョン 50.19.2 のドラフトの内容はバージョン 50.19.1 の内容と一致します。

11. **バージョン** クイックタブで、**ステータスの変更** \> **完了済**、そして **OK** を選択します。

バージョン 206.132.2 のステータスは、**ドラフト** から **完了済** に変更され、バージョンは読み取り専用になります。 新しい編集可能なバージョン 206.132.3 が追加され、状態が **ドラフト** になります。 このバージョンを使用すると、カスタム ER モデル マッピングの構成にさらに変更を加えることができます。

![構成ページで完了したバージョン 206.132.2](./media/er-quick-start3-completed-custom-mapping2.png)

### <a name="adopt-your-custom-er-format"></a>カスタム ER フォーマットの採用

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインの構成ツリーで、**請求書モデル** \> **UBL 売上請求書** \> **Peppol 売上請求書** を展開し、**Peppol 売上請求書 (Litware)** を選択します。
3. **バージョン**  クイック タブで、選択された形式の構成ドラフト バージョン **11.2.2.2** に対して **リベース** を選択します。
4. **ターゲット** バージョン フィールドで、基本 ER 形式の構成のバージョン **32.6.7** が選択されていることを確認し、**OK** を選択します。

    カスタム ER 形式構成のドラフト バージョンの番号が **11.2.2.2** から **32.6.7.2** に変更され、基本 ER 形式構成の最新バージョン (32.6.7) の変更とマージされたカスタマイズが含まれていることを示しています。

    一部のリベースの競合が検出されたことを確認します。 このような競合は手動で解決する必要があります。

5. アクション ウィンドウで、**デザイナー** を選択します。
6. それぞれのリベースの競合については、各コンポーネントに対してカスタム データ モデルのバージョン番号を保持する必要があるため、**独自の値を保持する** を選択します。
7. **保存** を選択します。
8. **マッピング** タブで、**モデル** タイプの **インボイス** データ ソースを選択し、**編集** を選択します。
9. **バージョン** フィールドで、カスタム データモデルのバージョン **2** を選択し、**OK** を選択します。
10. **保存** を選択します。

    > [!NOTE]
    > リベース アクションを元に戻すことができます。 このリベースをキャンセルするには、**バージョン** クイックタブで **Peppol 売上請求書 (Litware)** 形式のバージョン **11.2.2.1** を選び、**このバージョンを取得する** を選択します。 バージョン 32.6.7.2 は **11.2.2.2** に番号が振り直され、バージョン 11.2.2.2 のドラフトの内容はバージョン 11.2.2.1 の内容と一致します。

11. **形式デザイナー** ページを閉じます。
12. **バージョン** クイックタブで、**ステータスの変更** \> **完了済**、そして **OK** を選択します。

バージョン 32.6.7.2 のステータスは、**ドラフト** から **完了済** に変更され、バージョンは読み取り専用になります。 新しい編集可能なバージョン 32.6.7.3 が追加され、状態が **ドラフト** になります。 このバージョンを使用すると、カスタム ER 形式の構成に追加の変更を加えることができます。

![構成ページで完了したバージョン 32.6.7.2](./media/er-quick-start3-completed-custom-format2.png)

## <a name="process-a-customer-invoice-by-using-new-versions-of-the-custom-er-configurations"></a><a name="ProcessInvoice3"></a>新しいバージョンの カスタマイズした ER の構成を使用して、顧客請求書を処理する

### <a name="select-and-send-a-posted-invoice"></a>転記された請求書を選択して送信する

1. **売掛金勘定** \> **請求書** \> **すべての自由書式の請求書** に移動します。
2. **自由書式の請求書** ページで、前述の手順で追加して転記した請求書を選択します。
3. アクション ペインの **ドキュメント** グループで、**送信** \> **原本** を選択します。

    > [!NOTE] 
    > この時点では、**Peppol 売上請求書 (Litware)** ER 形式の設定には 2 つのバージョンがあり、どちらのバージョンにも [有効日](general-electronic-reporting.md#component-date-effectivity) の値がないため、最新のバージョンを使用して電子請求書を作成しています。

4. **自由書式の請求書**  ページを閉じます。

### <a name="analyze-a-generated-e-invoice"></a>生成された電子請求書の分析

1. **組織管理** \> **電子申告** \> **電子申告ジョブ** の順に選択します。
2. **電子申告ジョブ** ページで、タスクの説明に **eInvoice XML を送信する** がある直近のレコードを選択します。
3. **ファイルの表示** を選択 すると、生成されたファイルの一覧にアクセスできます。
4. **開く** を選択して、生成された電子請求書の XML ファイルをダウンロードします。
5. 電子請求書の XML ファイルを分析します。 カスタマイズに従って、顧客税スキーマには、**schemeID** と **schemeAgencyID** の XML 属性に加えて、カスタマイズした **FederalTaxID** XML 属性が含まれていることを確認してください。 また、ベースとなる新しいバージョンの **UBL 売上請求書** 形式の変更点が、カスタマイズしたものにマージされたため、 XML要素 **cbc:CustomizationID** のテキストが `urn:www.cenbii.eu:transaction:biicoretrdm010:ver1.0:# urn:www.peppol.eu:bis:peppol5a:ver1.0` から `urn:cen.eu:en16931:2017#compliant#urn:fdc:peppol.eu:2017:poacc:billing:3.0` に変更されています。

    ![カスタマイズして生成された e-インボイス XML ファイルのプレビュー](./media/er-quick-start3-e-invoice3.png)

## <a name="additional-resources"></a>追加リソース

- [電子申告の概要](general-electronic-reporting.md)
- [ER コンフィギュレーションを Lifecycle Services からダウンロードする](download-electronic-reporting-configuration-lcs.md)
- [ER コンフィギュレーションをコンフィギュレーション サービスのグローバル リポジトリからダウンロードする](er-download-configurations-global-repo.md)
- [自由書式の請求書の作成](https://docs.microsoft.com/dynamics365/finance/accounts-receivable/create-free-text-invoice-new)
- [カスタム フィールドの作成と操作](https://docs.microsoft.com/dynamics365/fin-ops-core/fin-ops/get-started/user-defined-fields)


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]