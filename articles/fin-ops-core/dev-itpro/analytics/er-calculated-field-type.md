---
title: 計算済みフィールド タイプの ER データ ソースの、パラメーター化された呼び出しをサポートする
description: このトピックでは、ER データ ソースに対して計算済みフィールド タイプを使用する方法について説明します。
author: NickSelin
manager: AnnBe
ms.date: 09/09/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.scope: Core, Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: ''
ms.dyn365.ops.version: 10.0.5
ms.openlocfilehash: 86efa927fa97be0d54e965bf33b1a18519025c22
ms.sourcegitcommit: 2460d0da812c45fce67a061386db52e0ae46b0f3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/30/2019
ms.locfileid: "2248680"
---
# <a name="support-parameterized-calls-of-er-data-sources-of-the-calculated-field-type"></a>計算済みフィールド タイプの ER データ ソースの、パラメーター化された呼び出しをサポートする

[!include [banner](../includes/banner.md)]

このトピックでは、**計算済みフィールド** タイプを使用して電子レポート (ER) データ ソースをデザインする方法について説明します。 このデータソースには ER 式が含まれている可能性があり、この式を実行すると、このデータ ソースを呼び出すバインドで構成されているパラメータ引数の値によって制御することができます。 このようなデータ ソースのパラメーター化された呼び出しを構成することにより、1 つのデータ ソースを多数のバインドで再利用できます。これにより、ER モデル マッピングまたは ER フォーマットで構成する必要があるデータ ソースの総数を減らすことができます。 また、構成済みの ER コンポーネントが簡素化され、これにより保守コストおよび他の消費者が使用するコストが削減されます。

## <a name="prerequisites"></a>必要条件
このトピックの例を完了するには、次のアクセスが必要です:

- これらのロールにアクセスします。

    - 電子申告開発者
    - 電子申告機能コンサルタント
    - システム管理者

- 次のいずれかのロールで、Finance and Operations と同じテナントに対してプロビジョニングされている Regulatory Configuration Services (RCS) にアクセスします。

    - 電子申告開発者
    - 電子申告機能コンサルタント
    - システム管理者

[Microsoft ダウンロード センター](https://go.microsoft.com/fwlink/?linkid=874684) から、ZIP (圧縮された) ファイル**をダウンロードし、計算済みフィールド タイプ**の ER データ ソースの、パラメーター化された呼び出しをサポートします。 これには、ローカルに抽出および保存する必要がある次の ER コンフィギュレーションが含まれています。

| **コンテンツ**                           | **ファイル名**                                        |
|---------------------------------------|------------------------------------------------------|
| ER データ モデル構成のサンプル    | パラメーター化された呼び出し version.1.xml を知るためのモデル     |
| ER メタデータ構成のサンプル      | パラメーター化された呼び出し version.1.xml を知るためのメタデータ  |
| ER モデル マッピング構成のサンプル | パラメーター化された呼び出し version.1.1.xml を知るためのマッピング |
| ER フォーマット構成のサンプル        | パラメーター化された呼び出し version.1.1.xml を知るための形式  |

## <a name="sign-in-to-your-rcs-instance"></a>RCS インスタンスにサインインする
この例では、サンプル会社 Litware, Inc. 用に、コンフィギュレーションを作成します。まず、RCS で、手順 [コンフィギュレーション プロバイダーの作成および有効なプロバイダーとしてのマーク付け](tasks/er-configuration-provider-mark-it-active-2016-11.md) にあるステップを完了する必要があります。

1. 既定のダッシュボードで、**電子申告**を選択します。
2. **コンフィギュレーションをレポートする**を選択します。
3. ダウンロードしたコンフィギュレーションを、次の順序で RCS にインポートします。データ モデル、メタデータ、モデル マッピング、フォーマット。 各 ER コンフィギュレーションごとに次の手順を実行します。

    1. **交換**を選択します。
    2. **XML ファイルから読み込む**を選択します。
    3. **参照**を選択してから、必要な ER コンフィギュレーションを XML 形式で選択します。
    4. **OK** を選択します。

## <a name="review-the-provided-er-solution"></a>指定された ER ソリューションを確認する

### <a name="review-model-mapping"></a>モデル マッピングを確認する

1. コンフィギュレーション ツリーで、**モデルのコンテンツを展開しパラメーター化された呼び出し**の項目を表示します。
2. **パラメーター化された呼び出しを知るためのマッピング**を選択します。
3. **デザイナー** をクリックします。
4. **デザイナー** をクリックします。  
   
この ER モデルマッピングは、次のように設計されています。

- **TaxTable** テーブルに存在する税コード (**税**データ ソース) のリストを取得します。
- **TaxTrans** テーブルに存在する税トランザクション (**トランザクション** データ ソース) のリストを取得します。
    
    - 取得したトランザクション (**Gr** データ ソース) のリストを、税コード別にグループ化します。
    - 税コードごとに集計された値に従って、グループ化されたトランザクションを計算します。

        - 税基準値の合計。
        - 税額の合計。
        - 適用される税率の最小値。

このコンフィギュレーションのモデル マッピングは、このモデルに対して作成され Finance and Operations で実行される、すべての ER フォーマットの基本データ モデルを実装します。 その結果、**税**および **Gr** データ ソースの内容は、抽象データ ソースなどの ER フォーマットに対して公開されます。

  ![税および Gr データ ソースを表示するモデル マッピング デザイナー ページ](media/er-calculated-field-type-01.png)

5.  **モデル マッピング デザイナー** ページを閉じます。
6.  **モデル マッピング** ページを閉じます。

### <a name="review-format"></a>形式の確認

1. コンフィギュレーション ツリーで、**モデルのコンテンツを展開しパラメーター化された呼び出し**の項目を表示します。
2. **パラメーター化された呼び出しを知るための形式**を選択します。
3. **デザイナー** をクリックします。 この ER フォーマットは次のように設計されています。

  - 税明細書を XML 形式で生成します。
  - 税明細書に以下の課税レベルを提示します。標準、減額、なし。
  - 各レベルで詳細条件を持つ、各課税レベルにおける複数の詳細を提示します。

  ![形式デザイナーのページ](media/er-calculated-field-type-02.png)

4. **マッピング**を選択します。
5. **モデル**、**データ、** および**集計**項目を展開します。 

   計算済みフィールド **モデル.データ.集計.レベル**は、その**モデル.データ.集計**データ ソースから実行時に取得できるすべての税コードのテキスト値として、(**標準**、**減額**、**なし、** または**その他**) の課税レベル コードを返す式が含まれます。

  ![パラメーター化された呼び出しを知るためのモデルの、データ モデル詳細を表示するフォーマット デザイナー ページ](media/er-calculated-field-type-03.png)

6. **モデル**.**データ 2** 項目を展開します。
7. **モデル**.**データ 2. 集計 2** 項目を展開します。
   
   この**モデル**.**データ2.集計2** データ ソースは、課税レベル (**モデル.データ.集計.レベル** 計算済みフィールドによって返されます) によって**モデル.データ.集計** データ ソース トランザクション の詳細をグループ化し、集計を計算するようにコンフィギュレーションされています。

  ![モデル.データ 2.集計 2 データ ソースの詳細を表示する形式デザイナー ページ](media/er-calculated-field-type-04.png)

8. 計算済みフィールドの**モデル**.**データ 2.レベル 1** 、**モデル**.**データ 2.レベル 2** 、および**モデル**.**データ 2.レベル 3** を確認します。 これらの計算済みフィールドは、**モデル**.**データ 2.集計 2**レコード リストをフィルターするために使用され、特定の課税レベルを表すレコードだけを返します。
9. **形式デザイナー** ページを閉じます。

## <a name="create-a-derived-format"></a>派生形式を作成する
既存の 3 つのフィールドを使用するのではなく、必要な課税レベルをフィルターする 1 つの計算済みフィールドを追加することにより、指定された形式を改善することができます。**モデル**.**データ 2.レベル 1** 、**モデル**.**データ 2.レベル 2 、** および**モデル**.**データ 2.レベル 3** 。 必要な課税レベルは、この新しい計算済みフィールドが呼び出される場所に指定できます。

1. コンフィギュレーション ツリーで、**モデルのコンテンツを展開しパラメーター化された呼び出し**の項目を表示します。
2. **パラメーター化された呼び出しを知るための形式**を選択します。
3. **コンフィギュレーションの作成**を選択します。
4. **名前から派生: パラメーター化された呼び出しを知るための形式、Microsoft** を選択します。
5. **名前**フィールドに、**パラメーター化された呼び出しを知るための形式 (カスタム)** を入力します。
6. **コンフィギュレーションの作成**を選択します。

## <a name="configure-a-parameterized-calculated-field-that-returns-a-list-of-records"></a>レコード一覧を返すパラメーター化された計算済みフィールドを、コンフィギュレーションする

### <a name="start-adding-a-new-calculated-field"></a>新しい計算済みフィールドの追加を開始する

1. **デザイナー** をクリックします。
2. **展開/折りたたみ**を選択し、すべての形式項目を展開します。
3. **マッピング**を選択します。
4. **モデル**項目を展開します。
5. **モデル.データ 2** 項目を選択します。
6. **追加**を選択します。
7. **機能\\計算済みフィールド**を選択します。
8. **名前**フィールドに、**レベル**と入力します。
9. **式の編集**を選択します。

### <a name="define-a-parameter-for-adding-a-calculated-field"></a>計算済みフィールドを追加するためにパラメーターを定義する

1. **パラメーター**を選択します。
2. **新規** を選択します。
3. **名前**フィールドに、**課税レベル**と入力します。
4. **タイプ**フィールドで、**文字列**を選択します。

    パラメーター引数のタイプを指定するために使用できるのは、プリミティブ データ型だけです。 そのため、**レコード リスト**、**レコード**、および**列挙**タイプはこの目的では使用できません。

    1 つの計算済みフィールドに対して指定できるパラメーターの最大数は、8 です。

    ![パラメーター データ ソース リスト](media/er-calculated-field-type-05.png)

5. **OK** を選択します。

このパラメーターを追加することにより、この計算済みフィールドを呼び出すために満たすべき条件が指定されます。 この計算済みフィールドを呼び出す際、**課税レベル** パラメーターの引数を、**文字列**形式の値として指定する必要があります。

   コンテナーに存在する計算済みフィールド (**レコード リスト**、**レコード**、または**コンテナー**) に対してのみ、パラメーターを定義する必要があります。

   コンフィギュレーションされたパラメーターは、この計算済みフィールドのためのデータ ソースのリスト内で使用できます。 **データソースの追加**を選択すると、コンフィギュレーションされた式にパラメーターを追加できます。

   ![データ ソース フィールド](media/er-calculated-field-type-06.png)

### <a name="define-an-expression-for-adding-a-calculated-field"></a>計算済みフィールドを追加するために式を定義する

1. **フォーミュラ** フィールドに入力します。 

    **WHERE(\@.集計 2、 \@.集計 2.グループ化.レベル =**
    
2. データ ソースのリストで、**課税レベル** パラメーターを選択します。
3. **データソースの追加**を選択します。
4. **フォーミュラ** フィールドで、次の式を確定します。  

    **WHERE(\@.集計 2, \@.集計 2.グループ化.レベル = '課税レベル')**

5. **保存** を選択します。

    ![データ ソース フィールドの情報](media/er-calculated-field-type-07.png)

6. **フォーミュラ デザイナー** ページを閉じます。

### <a name="finish-adding-a-new-calculated-field"></a>新しい計算済みフィールドの追加を完了する

- **OK** を選択します。

**フォーマット デザイナー** ページ上で、コンフィギュレーションされパラメーター化された計算済みフィールド **レベル**には、**文字列**引数が必要です。

![計算済みフィールド レベルの展開されたリスト](media/er-calculated-field-type-08.png)

### <a name="use-the-configured-calculated-field-for-binding-format-elements"></a>バインディング フォーマット要素のため、コンフィギュレーションされた計算済みフィールドを使用する

1. **モデル.データ 2.レベル**を選択し、コンフィギュレーションされた計算済みフィールドを選択します。
2. **明細書.課税.標準**形式要素を選択します。
3. **バインド**を選択します。
4. **はい**を選択し、選択された形式要素のすべての入れ子になった形式内で、新しいデータ ソース **レベル**によって、現在使用されているデータ ソース **レベル 1** が置き換えられることを確認します。

    適用したバインディングは、パラメーター化された計算済みフィールドの呼び出しとして作成されました。 既定では、バインド形式要素の名前は、次の条件下で、パラメーター化された計算済みフィールドに対する引数として使用されます。

      - 計算済みフィールドは 1 つのパラメータを使用するようにコンフィギュレーションされています。
      - このパラメータのデータ タイプは、**文字列**として定義されています。

    バインド形式要素の名前が空白の場合、この要素のデータ ソース名は、適用したバインディングで使用されます。

5. **明細書.課税.減額**形式要素を選択します。
6. **バインド**を選択します。
7. **はい**を選択し、選択された形式要素の下にあるすべての入れ子になった形式内で、新しいデータ ソース **レベル**によって、現在使用されているデータ ソース **レベル 2** が置き換えられることを確認します。
8. **明細書.課税.なし**形式要素を選択します。
9. **バインド**を選択します。
10. **はい**を選択し、選択された形式要素の下にあるすべての入れ子になった形式内で、新しいデータ ソース **レベル**によって、現在使用されているデータ ソース **レベル 3** が置き換えられることを確認します。

   課税レベル (たとえば**モデル.データ 2.レベル ("減額")** テキスト値として) を表す XML 要素に対するパラメーター化された計算済みフィールドの引数を指定する場合、入れ子にされた XML 属性に対して同じ操作をする必要はありません。それらのバインドは、親レベル (**モデル.データ 2.レベル.集計された.ベース**、**モデル.データ 2.レベル ("減額")** 集計された.ベースではない) で定義されている引数の値を自動的に継承します。

どのパラメーター化された計算済みフィールドの繰り返し呼び出しも、サポートされません。

**式の編集**を選択して、選択したバインドの中でパラメーター化された計算済みフィールドの既定で適用される引数を変更できます。 この引数が見つからない場合、実行時にエラーが発生する可能性があります。そのような状況は、現在の形式が検証されたときに、ユーザーに通知されます。

![検証時の警告の通知](media/er-calculated-field-type-10.png)

## <a name="configure-a-parameterized-calculated-field-to-return-a-record"></a>パラメーター化された計算済みフィールドをコンフィギュレーションし、レコードを返す
パラメーター化された計算済みフィールドがレコードを返す場合、このレコードの個々のフィールド バインドを形式要素にサポートする必要があります。 そのような場合、パラメーター化された計算済みフィールドを呼び出す、引数の値を含む親バインドがありません。この値は、1 つのレコード フィールドのバインドで定義する必要があります。

### <a name="start-adding-a-new-calculated-field"></a>新しい計算済みフィールドの追加を開始する

1. **モデル.データ 2** 項目を選択します。
2. **追加**を選択します。
3. **機能\\計算済みフィールド**を選択します。
4. **名前**フィールドに、**レベル レコード**と入力します。
5. **式の編集**を選択します。

### <a name="define-a-parameter-for-adding-a-calculated-field"></a>計算済みフィールドを追加するためにパラメーターを定義する

1. **パラメーター**を選択します。
2. **新規** を選択します。
3. **名前**フィールドに、**課税レベル**と入力します。
4. **タイプ**フィールドで、**文字列**を選択します。
5. **OK** を選択します。

### <a name="define-an-expression-for-adding-a-calculated-field"></a>計算済みフィールドを追加するために式を定義する

1. **フォーミュラ** フィールドで、次のように入力します。  
    
    **FIRSTORNULL(\@.レベル(**

2. **課税レベル** パラメーターを選択します。
3. **データソースの追加**を選択します。
4. **フォーミュラ** フィールドで、手順 1 で入力したものに **' 課税レベル '))** を上書きし、式をこのように確定します。  
    
    **FIRSTORNULL(\@.レベル ('課税レベル'))**

5. **保存** を選択します。
6. **フォーミュラ デザイナー** ページを閉じます。

### <a name="finish-adding-a-new-calculated-field"></a>新しい計算済みフィールドの追加を完了する

-   **OK** を選択します。

### <a name="use-the-configured-calculated-field-to-bind-format-elements"></a>形式要素をバインドするため、コンフィギュレーションされた計算済みフィールドを使用する

1. **モデル.データ 2.レベル レコード**を展開し、コンフィギュレーションされた計算済みフィールドを選択します。
2. コンフィギュレーションされた計算済みフィールドの、**モデル.データ 2.レベル レコード.集計**コンテナーを展開します。
3. **モデル.データ 2.レベル レコード.集計された.ベース** フィールドを選択します。
4. **明細書.課税.なし**形式要素を選択します。
5. **バインドの解除**を選択します。
6. **明細書.課税.なし.ベース** 形式要素を選択します。
7. **バインド**を選択します。
8. **式の編集**を選択します。
9. 式を、**モデル.データ 2.レベル レコード (" なし ") 集計された.ベース**に変更します。

![更新された式](media/er-calculated-field-type-11.png)

## <a name="remove-calculated-fields-that-are-not-used"></a>使用されていない計算済みフィールドを削除する

1. **モデル.データ 2.レベル 1** を選択します。
2. **削除**を選択します。
3. **モデル.データ 2.レベル 2** を選択します。
4. **削除**を選択します。
5. **モデル.データ 2.レベル 3** を選択します。
6. **削除**を選択します。
7. **保存** を選択します。

  > [!NOTE]
  > 形式バインドの中で、同じ計算済フィールド **モデル.データ 2.レベル**が複数回再使用されました。 複数の同じようなフィールドに対してするよりも、1 つの計算済みフィールドを使用および管理する方がはるかに簡単です。

8. **形式デザイナー** ページを閉じます。

## <a name="complete-adjusted-version-of-a-derived-format"></a>派生形式の調整したバージョンを完了する。

1. **バージョン** クイック タブで、**ステータスの変更**を選択します。
2. **完了**を選択します。

## <a name="export-completed-version-of-a-derived-format"></a>派生形式の完了したバージョンをエクスポートする

1. コンフィギュレーション ツリーで、**パラメーター化された呼び出しを知るための形式 (カスタム)** 形式を選択します。
2. **バージョン** クイック タブで、完成したバージョン 1.1.1 を選択します。
3. **交換**を選択します。
4. **XML ファイルとしてエクスポートする**を選択します。
5. ダウンロードしたコンフィギュレーションを、XML 形式でローカルに保存します。

## <a name="test-er-formats"></a>ER フォーマットのテスト 
初期のおよび改善されたER フォーマットを実行して、コンフィギュレーションされパラメーター化された計算済みフィールドが正しく動作することを確認できます。

### <a name="import-er-configurations"></a>ER コンフィギュレーションをインポートする
**RCS** タイプの ER レポジトリを使用して、確認済みのコンフィギュレーションを RCS からインポートすることができます。 既に、[規制コンフィギュレーション サービスからの電子申告コンフィギュレーションのインポート](rcs-download-configurations.md) のトピックにある手順を実行している場合は、コンフィギュレーションされた ER リポジトリを使用し、このトピックの前の方で説明したコンフィギュレーションを環境にインポートします。 そうでない場合は、次の手順に従います。

1. 会社 **DEMF** を選択し、既定のダッシュボードで**電子申告**を選択します。
2. **コンフィギュレーションをレポートする**を選択します。
3. Microsoft ダウンロード センターから、コンフィギュレーションを次の順序でインポートします。データ モデル、モデル マッピング、フォーマット。 各 ER コンフィギュレーションごとに次の手順を実行します。

    1. **交換**を選択します。
    2. **XML ファイルから読み込む**を選択します。
    3. **参照**を選択し、必要な ER コンフィギュレーションを XML 形式で選択します。
    4. **OK** を選択します。

4. RCS からエクスポートされた**パラメーター化された呼び出しを知るための形式 (カスタム)** フォーマットの完了したバージョン 1.1.1 をインポートします。

    1. **交換**を選択します。
    2. **XML ファイルから読み込む**を選択します。
    3. **参照**を選択し、XML 形式でローカルに保存されている**パラメーター化された呼び出しを知るための形式 (カスタム)** ファイルを選択します。
    4. **OK** を選択します。

### <a name="run-er-formats"></a>ER フォーマットの実行

1. コンフィギュレーション ツリーで、**モデルのコンテンツを展開しパラメーター化された呼び出し**の項目を表示します。
2. **パラメーター化された呼び出しを知るための形式**を選択します。
3. 最上部のリボンにある**実行**を選択します。
4. ローカルに生成された出力を保存します。
5. **パラメーター化された呼び出しを知るための形式 (カスタム)** 項目を選択します。
6. 最上部のリボンにある**実行**を選択します。
7. 生成された出力をローカルに保存します。 
8. 生成された出力の内容を比較します。

## <a name="additional-resources"></a>追加リソース
[電子申告のフォーミュラ デザイナー](general-electronic-reporting-formula-designer.md)
