---
title: ER フォーマットを設計して、Excel で生成されたドキュメントのページ設定をする
description: この記事では、生成されたドキュメントのページ設定を Microsoft Excel で行う 電子レポート (ER) フォーマットを設計する方法について説明します。
author: kfend
ms.date: 09/14/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.region: Global
ms.author: filatovm
ms.search.validFrom: 2021-08-01
ms.dyn365.ops.version: Version 10.0.22
ms.custom: 220314
ms.assetid: 2685df16-5ec8-4fd7-9495-c0f653e82567
ms.search.form: EROperationDesigner
ms.openlocfilehash: e4a34dffda9e9b95f5d6c7ee382723663817ec6b
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2022
ms.locfileid: "9285004"
---
# <a name="design-an-er-format-to-paginate-generated-documents-in-excel"></a>ER フォーマットを設計して、Excel で生成されたドキュメントのページ設定をする

[!include [banner](../includes/banner.md)]

この記事では、システム管理者または電子報告書機能コンサルタントの役割を持つユーザーが、[電子レポート (ER)](general-electronic-reporting.md) フォーマットを設定して、Microsoft Excel で送信文書を生成し、文書のページ設定を管理する方法について説明します。

この例では、イントラスタット申告が[生成](../../../finance/localizations/tasks/eur-00002-eu-intrastat-declaration.md)されたときにコントロール レポートの印刷に使用される、マイクロソフトが提供する ER フォーマットを変更します。 このレポートでは、報告されたイントラスタット トランザクションを確認することができます。 変更を行った場合、生成される制御レポートのページ番号を管理できます。

この記事の手順は、**DEMF** 会社で完了することができます。 コーディングは必要ありません。 開始する前に、以下のファイルをダウンロードして保存する必要があります。

| 説明       | ファイル名 |
|-------------------|-----------| 
| レポート テンプレート 1 | [ERIntrastatReportDemo1.xlsx](https://download.microsoft.com/download/7/2/a/72ae292a-8bb2-4b9d-8397-9764218f6fa8/ERIntrastatReportDemo1%20.xlsx) |
| レポート テンプレート 2 | [ERIntrastatReportDemo2.xlsx](https://download.microsoft.com/download/7/d/1/7d15858d-6260-4afa-9dda-d8b955e59b1a/ERIntrastatReportDemo2.xlsx) |

## <a name="configure-the-er-framework"></a> ER フレームワークを構成する

[ER フレームワークの構成](er-quick-start2-customize-report.md#ConfigureFramework)に記載の手順に従って、 ER パラメーターの最小限のセットを構成します。 ER フレームワークを使って、標準的な ER フォーマットのカスタム バージョンを設計する前に、この設定を完了しておく必要があります。

## <a name="import-the-standard-er-format-configuration"></a>標準 ER フォーマットの構成をインポートする

[標準的な ER フォーマットの構成をインポートする](er-quick-start2-customize-report.md#ImportERSolution1) に記載の手順に従って、標準的な ER の構成を現在の Dynamics 365 Finance のインスタンスに追加します。 **イントラスタット レポート** フォーマット構成のバージョン **1.9** をインポートします。 基となる **イントラスタット モデル** 構成のベース バージョン 1 が、リポジトリから自動的にインポートされます。

## <a name="customize-the-standard-er-format"></a> 標準 ER 形式のカスタマイズ

### <a name="create-the-custom-er-format"></a>カスタム ER フォーマットの作成

このシナリオでは、あなたは Litware, Inc. の代表者で、同社は現在有効な ER 構成プロバイダとして選択されています。 **イントラスタット レポート** の構成をベースにして、新しい ER フォーマット構成を作成する必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインにある構成ツリーで、**イントラスタット モデル** を展開し、**イントラスタット レポート** を選択します。 Litware, Inc. は、この ER 形式コンフィギュレーションのバージョン 1.9 をカスタム バージョンのベースとして使用します。
3. **コンフィギュレーションの作成** を選択して、ドロップ ダウンのダイアログ ボックスを開きます。 このダイアログ ボックスを使用して、カスタムの支払形式の新しいコンフィギュレーションを作成することができます。
4. **新しい** フィールド グループで、**派生元の名前: イントラスタット レポート、マイクロソフト** オプションを選択します。
5. **名前** フィールドで、**イントラスタット レポート Litware** を入力します。
6. **構成の作成** を選択して、新規フォーマットを作成します。

**イントラスタット レポート Litware** ER 形式コンフィギュレーションのバージョン 1.9.1 が作成されます。 このバージョンは **ドラフト** の状態で、編集することができます。 カスタム ER 形式の現在の内容は、Microsoft が提供する形式の内容と一致しています。

### <a name="make-the-custom-format-runnable"></a>カスタム フォーマットを実行可能な状態にする

カスタム フォーマットの最初のバージョンが作成され、状態が **ドラフト** になったため、テスト用にフォーマットを実行することができます。 レポートを実行するには、カスタム ER 形式を参照する支払方法を使用して、仕入先支払を処理します。 既定では、申請から ER 形式を呼び出すと、**完了済** または **共有** のステータスを持つバージョンのみが考慮されます。 この動作により、未完成の設計を持つ ER 形式が使用されるのを防ぐことができます。 ただし、テストの実行には、**ドラフト** のステータスを持つ ER 形式のバージョンをアプリケーションに強制的に使用させることができます。 これにより、変更が必要な場合は、現在の形式バージョンを調整できます。 詳細については、[適合性](electronic-reporting-destinations.md#applicability) を参照してください。

ER 形式のドラフト バージョンを使用するには、ER 形式を明示的にマークする必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページ、アクション ウィンドウ、**構成** タブ、**詳細設定** グループで、**ユーザー パラメーター** を選択します。
3. **ユーザー パラメーター** ダイアログ ボックスで、**実行設定** オプションを **はい** に設定し、**OK** を選択します。
4. **編集** を選択し、必要に応じて現在のページを編集可能にします。
5. 左ペインの構成ツリーで、**イントラスタット レポート Litware** を選択します。
6. **ドラフトの実行** オプションを **はい** に設定し、**保存** を選択します。

    ![コンフィギュレーション ページのドラフト実行オプション。](./media/er-paginate-excel-reports-derived-format-configuration.png)

## <a name="set-up-foreign-trade-parameters-to-use-the-custom-er-format"></a>カスタム ER フォーマットを使用する対外貿易パラメータの設定

以下の手順で、外国為替取引のパラメーターを設定することで、カスタム フォーマットを使用することができます。

1. **税** \> **設定** \> **対外貿易** \> **対外貿易パラメーター** の順に移動します。
2. **対外貿易パラメーター** ページの、**電子申告** クイック タブの **ファイル形式のマッピング** フィールドで、**イントラスタット レポート Litware** を選択します。
3. **レポート形式のマッピング** フィールドで **イントラスタット レポート Litware** を選択します。
4. **保存** を選択します。

## <a name="configure-the-custom-format-to-use-the-downloaded-report-template"></a>ダウンロードしたレポートのテンプレートを使用するカスタム フォーマットを構成します

### <a name="review-the-first-downloaded-excel-template"></a>最初にダウンロードした Excel テンプレートを確認する

1. Excel デスクトップ アプリケーションで、前述の手順でダウンロードした **ERIntrastatReportDemo1.xlsx** テンプレート ファイルを開きます。
2. テンプレートに、生成されたドキュメントのレポートヘッダー、レポート詳細、およびレポートのフッター セクションを作成する名前付き範囲が含まれていることを確認します。

    ![デスクトップ アプリケーションの Excel テンプレート 1 のレイアウト。](./media/er-paginate-excel-reports-template1.gif)

### <a name="replace-the-current-excel-template-in-the-custom-er-format"></a><a id="replace-template"></a>現在の Excel テンプレートをカスタム ER フォーマットに置き換える

カスタム ER フォーマットに新しい Excel のテンプレートを追加する必要があります。

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページの左側ペインにある構成ツリーで、**イントラスタット モデル** \> **イントラスタット レポート** を展開し、**イントラスタット レポート Litware** の構成を選択します。
3. **デザイナー** をクリックします。
4. **フォーマット デザイナー** ページのアクション ペインで、**詳細の表示** を選択します。
5. **イントラスタット : Excel** ルート フォーマットのコンポーネントが選択されている状態で、アクション ペインの **インポート** タブの **インポート** グループで **Excel から更新する** を選択します。
6. **Excel から更新** ダイアログ ボックスで、**テンプレートの更新** を選択します。
7. **開く** ダイアログ ボックスで、ダウンロード済みの **ERIntrastatReportDemo1.xlsx** ファイルを参照して選択し、**開く** を選択します。
8. **OK** を選択します。
9. **保存** を選択します。

![新たな Excel のテンプレートが追加された後の ER フォーマット デザイナのフォーマットの構造。](./media/er-paginate-excel-reports-format1.png)

## <a name="change-the-data-binding-to-show-the-item-description-on-a-generated-report"></a>生成されたレポートに品目の説明を表示するデータ バインドの変更

1. **フォーマット デザイナー** ページで、**マッピング** タブを選択します。
2. **イントラスタット**\>**レポート明細行** を展開し、**商品コード** のコンポーネントを選択します。
3. **式の編集** を選択します。
4. バインド式を  `@.CommodityCode` から `CONCATENATE(@.CommodityCode, " ", @.ProductName)` に変更します。
5. **保存** を選択します。

![ER フォーマット デザイナで品目の説明を表示する構成がされたバインド。](./media/er-paginate-excel-reports-format1a.png)

## <a name="generate-an-intrastat-declaration-control-report"></a><a id="generate-intrastat-control-report"></a>イントラスタット申告制御レポートの生成

まず、**イントラスタット** ページで報告用のイントラスタット トランザクションを作成 します。

![イントラスタット ページのトランザクション。](./media/er-paginate-excel-reports-transactions1.gif)

その後、カスタム ER フォーマットを使用して、イントラスタット申告の制御レポートを生成します。

1. **税** \> **申告** \> **対外貿易** \> **イントラスタット** の順に移動します。
2. **イントラ スタット** ページのアクション ペインで、**出力** \> **レポート** を選択します。
3. **イントラスタット レポート** ダイアログ ボックスで、次の手順に従ってレポートを実行します:

    1. 特定の イントラスタット トランザクションをレポートに含める期間の **開始日** フィールドと **終了日** フィールドを設定します。
    2. **ファイルの生成** オプションを、**いいえ** に設定します。
    3. **レポートの生成** オプションを、**はい** に設定します。
    4. **OK** を選択します。

4. 生成されたドキュメントをダウンロードして保存します。
5. Excel で ドキュメントを開き、レビューします。

    ![デスクトップ アプリケーションで Excel のドキュメントが生成されます。](./media/er-paginate-excel-reports-document1.png)

## <a name="configure-the-custom-format-to-paginate-generated-documents"></a>ページ設定で生成されたドキュメントに対するカスタム フォーマットの構成

### <a name="review-the-second-downloaded-excel-template"></a>2 番目にダウンロードした Excel テンプレートを確認する

1. Excel で、前述の手順でダウンロードした **ERIntrastatReportDemo2.xlsx** テンプレート ファイルを開きます。
2. このテンプレートを **ERIntrastatReportDemo1.xlsx** テンプレートと比較し、生成されたドキュメントのページ固有のセクションの作成と記入に使用する新しい Excel 名が含まれていることを確認します。

    - **ReportPageHeader** の範囲が追加され、ページのヘッダーが作成できます。
    - **ReportPageFooter** の範囲が追加され、ページのフッターが作成できます。
    - **ReportPagePagePageer\_PageLines** のセルが構成され、ページあたりのトランザクション数を表示できます。
    - **ReportPagePagePageer\_PageAmount** のセルが構成され、ページあたりの合計数量を表示できます。
    - **ReportPagePagePageer\_PageWeight** のセルが構成され、ページあたりの合計金額を表示できます。
    - **ReportPageFooter\_RunningCounterLines** のセルが構成され、レポートの冒頭から現在のページまでのトランザクションの累積カウンターを表示できます。
    - **ReportPageFooter\_RunningTotalAmount** のセルが構成され、レポートの冒頭から現在のページまでのすべてのトランザクションの累積金額を表示します。
    - **ReportPageFooter\_RunningTotalWeight** のセルが構成され、レポートの冒頭から現在のページまでのすべてのトランザクションの重量の累積を表示します。

    ![デスクトップ アプリケーションの Excel テンプレート 2 のレイアウト。](./media/er-paginate-excel-reports-template2a.gif)

    **CommodityCode** のセルは、セル テキストを折り返して表示するように構成されます。 トランザクションの明細行は、自動的に行の高さに合わせて表示されるように設定されているため、**CommodityCode** セルのテキストが折り返されると、行全体の高さが自動的に変更される必要があります。

    ![セル テキストを折り返すするように構成された CommodityCode セル。](./media/er-paginate-excel-reports-template2b.gif)

### <a name="repeat-the-replacement-of-the-current-excel-template-in-the-custom-er-format"></a>現在の Excel テンプレートをカスタム ER フォーマットに置き換える作業を繰り返す

1. この記事の [現在の Excel テンプレートをカスタム ER 形式に置き換える](#replace-template) セクションに記載の手順に従います。 この場合は、手順 7 で **ERIntrastatReportDemo2.xlsx** ファイルを選択します。
2. **フォーマット デザイナー** ページで、**イントラスタット** を展開します。
3. 編集可能な ER フォーマットに追加された[範囲](er-fillable-excel.md#range-component)フォーマットのコンポーネントに名前を付けて、構造を適用された Excel テンプレートの構造と同期します。

    1. Excel の名前 **ReportPageHeader** に関連付けられている **範囲** コンポーネントを選択します。
    2. **フォーマット** タブの **名前** フィールド に、**レポート ページ ヘッダー** と入力します。
    3. Excel の名前 **ReportPageFooter** に関連付けられている **範囲** コンポーネントを選択します。
    4. **フォーマット** タブの **名前** フィールド に、**レポート ページ フッター** と入力します。

4. **保存** を選択します。

![新たな Excel のテンプレートが置換えられた後の ER フォーマット デザイナのフォーマットの構造。](./media/er-paginate-excel-reports-format2.png)

### <a name="change-the-format-structure-to-implement-document-pagination"></a>ドキュメントのページ番号を実装するフォーマット構造の変更

1. **フォーマット デザイナー**  ページの左ペインのフォーマット ツリーで、**イントラスタット** の ルート コンポーネントを選択します。
2. **追加** を選択します。
3. **追加** ダイアログ ボックスで、コンポーネントのグループ [Excel](er-fillable-excel.md#page-component) で、**ページ** コンポーネントを選択します。
4. **コンポーネント プロパティ** ダイアログ ボックスの、**名前** フィールドで、**レポート ページ** を入力してください。 その後、**OK** を選択します。
5. 生成されたすべてのページのヘッダーに **レポート ページ ヘッダー** コンポーネントを使用するには、以下の手順に従います:

    1. **レポート ページヘッダー** のコンポーネントを選択 し、**切り取り** を選択します。
    2. **レポート ページ** コンポーネントを選択 し、**貼り付け** を選択します。
    3. **レポート ページ** を展開します。
    4. **ページ** コンポーネントでこの範囲を強制的にページのヘッダーと [みなす](er-fillable-excel.md#page-component-structure)には、**レポート ページ ヘッダー** を選択し、**フォーマット** タブの **レプリケーションの方向** フィールドで **レプリケーションなし** を選択します。

6. 生成されたドキュメントをページ設定してレポート明細行の内容を考慮するには、次の手順に従います:

    1. **レポート明細行** のコンポーネントを選択 し、**切り取り** を選択します。
    2. **レポート ページ** コンポーネントを選択 し、**貼り付け** を選択します。

7. レポート明細行の後、最終ページのフッターの前にレポート フッターを入れるには、以下の手順に従います:

    1. **レポート フッター** のコンポーネントを選択 し、**切り取り** を選択します。
    2. **レポート ページ** コンポーネントを選択 し、**貼り付け** を選択します。

8. 生成されたすべてのページのフッターに **レポート ページ フッター** コンポーネントを使用するには、以下の手順に従います:

    1. **レポート ページ フッター** のコンポーネントを選択 し、**切り取り** を選択します。
    2. **レポート ページ** コンポーネントを選択 し、**貼り付け** を選択します。
    3. **ページ** コンポーネントでこの範囲を強制的にページのフッターと [みなす](er-fillable-excel.md#page-component-structure)には、**レポート ページ フッター** を選択し、**フォーマット** タブの **レプリケーションの方向** フィールドで **レプリケーションなし** を選択します。

![ドキュメントの改ページ位置の自動修正を実装した後の ER フォーマット デザイナーのフォーマット構造。](./media/er-paginate-excel-reports-format3.png)

### <a name="add-data-sources-to-calculate-page-footer-totals"></a>ページ フッターの合計を計算するデータ ソースの追加

ページ合計、累積カウンター、累積合計値を計算し、ページのフッター セクションに表示するには、新しいデータソースを設定する必要があります。 そのためには、[データ収集](er-data-collection-data-sources.md) のデータソースを利用することをお勧めします。

1. **フォーマット デザイナー** ページで、**マッピング** タブを選択します。
2. **ルートの追加** を選択し、次の手順に従います:

    1. **データ ソースの追加** ダイアログ ボックスの **一般** セクションで、**空のコンテナ** を選択します。
    2. **'空のコンテナ' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**合計** と入力します。
    3. **OK** を選択します。

3. **合計** データ ソースを選択し、**追加** を選択して、次の手順に従います:

    1. **データ ソースの追加** ダイアログ ボックスの **一般** セクションで、**空のコンテナ** を選択します。
    2. **'空のコンテナ' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**ページ** と入力 します。
    3. **OK** を選択します。

4. **追加** を再度選択し、次の手順に従います。

    1. **データ ソースの追加** ダイアログ ボックスの **一般** セクションで、**空のコンテナ** を選択します。
    2. **'空のコンテナ' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**累積** と入力します。
    3. **OK** を選択します。

5. **Total.Page** データ ソースを選択し、**追加** を選択して、次の手順に従います:

    1. **データ ソースの追加** ダイアログ ボックスの **機能** セクションで、**データ収集** を選択します。
    2. **'データ収集' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**金額** と入力します。
    3. **品目タイプ** フィールドで、**実数** を選択します。
    4. **すべての値の収集** オプションを **はい** に設定します。
    5. **OK** を選択します。

6. **追加** を再度選択し、次の手順に従います。

    1. **データ ソースの追加** ダイアログ ボックスの **機能** セクションで、**データ収集** を選択します。
    2. **'データ収集' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**重量** と入力します。
    3. **品目タイプ** フィールドで、**実数** を選択します。
    4. **すべての値の収集** オプションを **はい** に設定します。
    5. **OK** を選択します。

7. **Total.Running** データ ソースを選択し、**追加** を選択して、次の手順に従います:

    1. **データ ソースの追加** ダイアログ ボックスの **機能** セクションで、**データ収集** を選択します。
    2. **'データ収集' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**金額** と入力します。
    3. **品目タイプ** フィールドで、**実数** を選択します。
    4. **すべての値の収集** フィールドを **はい** に設定します。
    5. **OK** を選択します。

8. **追加** を再度選択し、次の手順に従います。

    1. **データ ソースの追加** ダイアログ ボックスの **機能** セクションで、**データ収集** を選択します。
    2. **'データ収集' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**重量** と入力します。
    3. **品目タイプ** フィールドで、**実数** を選択します。
    4. **すべての値の収集** フィールドを **はい** に設定します。
    5. **OK** を選択します。

9. **追加** を再度選択し、次の手順に従います。

    1. **データ ソースの追加** ダイアログ ボックスの **機能** セクションで、**データ収集** を選択します。
    2. **'データ収集' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**明細行** と入力します。
    3. **項目タイプ** フィールドで、**整数** を選択します。
    4. **すべての値の収集** フィールドを **はい** に設定します。
    5. **OK** を選択します。

10. **保存** を選択します。

### <a name="add-data-sources-to-control-page-footer-visibility"></a>ページ フッターの表示を制御するデータ ソースの追加

ページのフッターの可視性を制御し、最終ページにトランザクションが含まれている場合はフッターを含めたくない場合は、必要な累積カウンターを計算するために新しいデータソースを設定します。

1. **フォーマット デザイナー** ページで、**マッピング** タブを選択します。
2. **Total.Running** データ ソースを選択し、**追加** を選択します。
3. **データ ソースの追加** ダイアログ ボックスの **機能** セクションで、**データ収集** を選択します。
4. **'データ収集' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**明細行 2** と入力します。
5. **項目タイプ** フィールドで、**整数** を選択します。
6. **すべての値の収集** オプションを **はい** に設定します。
7. **OK** を選択します。
8. **保存** を選択します。

![ER フォーマット デザイナに追加されたデータ ソース。](./media/er-paginate-excel-reports-format4.png)

### <a name="configure-bindings-to-collect-total-values"></a>合計値を収集するバインドの構成

1. **フォーマット デザイナ** ページのフォーマット ツリーで、**レポート明細行** のコンポーネントを展開し、ネストされた **請求書の値** コンポーネントを選択します。
2. **式の編集** を選択します。
3. バインド式を  `NUMBERVALUE(NUMBERFORMAT(@.InvoiceValue, "F"&TEXT(model.Parameters.IntrastatAmountDecimals)), ".", "")` から `Total.Page.Amount.Collect(NUMBERVALUE(NUMBERFORMAT(@.InvoiceValue, "F"&TEXT(model.Parameters.IntrastatAmountDecimals)), ".", ""))` に変更します。

    > [!NOTE]
    > このバインドでは、繰り返し行われるトランザクションごとに金額の値を Excel のセルに入れるだけでなく、その値をデータコレクションの **Total.Page.Amount** データソースに集めます。

4. ネストされた **重量コンポーネント** を選択します。
5. **式の編集** を選択します。
6. バインド式を  `@.'$RoundedWeight'` から `Total.Page.Weight.Collect(@.'$RoundedWeight')` に変更します。

    > [!NOTE]
    > このバインドでは、繰り返し行われるトランザクションごとに重量の値を Excel のセルに入れるだけでなく、その値をデータコレクションの **Total.Page.Weight** データソースに集めます。

![ER フォーマット デザイナーで合計値を収集するために構成されたバインド。](./media/er-paginate-excel-reports-format5.png)

### <a name="configure-bindings-to-fill-in-page-footer-totals"></a>バインドを構成してページ フッターの合計を入力する

1. **フォーマット デザイナー** ページのフォーマット ツリーで、**レポート ページのフッター** コンポーネントを展開し、Excel の **ReportPageFooter\_PageAmount** セルを参照する入れ子の **範囲** コンポーネントを選択して以下の手順を実行します:

    1. 右側のペインのデータ ソース ツリーで、**Total.Page.Amount.Sum()** 項目を選択します。
    2. **バインド** を選択します。
    3. **式の編集** を選択します。
    4. 式を `Total.Page.Amount.Sum(false)` に更新します。

    > [!NOTE]
    > 現在のページの収集データを保持するには、この関数の引数に **False** を指定する必要があります。このデータは、累積合計額、1 ページあたりの合計行数、累積の行数カウンターの計算に必要となります。

2. フォーマット ツリーで、Excel の **ReportPageFooter\_PageWeight** セルを参照するネストされた **範囲** コンポーネントを選択し、以下の手順を実行します:

    1. 右側のペインのデータ ソース ツリーで、**Total.Page.Weight.Sum()** 項目を選択します。
    2. **バインド** を選択します。
    3. **式の編集** を選択します。
    4. 式を `Total.Page.Weight.Sum(false)` に更新します。

### <a name="configure-bindings-to-fill-in-page-running-totals"></a>バインドを構成してページ フッターの累計合計を入力する

1. **フォーマット デザイナー** ページのフォーマット ツリーで、**レポート ページのフッター** コンポーネントを展開し、Excel の **ReportPageFooter\_RunningTotalAmount** セルを参照する入れ子の **範囲** コンポーネントを選択して以下の手順を実行します:

    1. 右側のペインのデータ ソース ツリーで、**Total.Running.Amount.Collect()** 項目を選択します。
    2. **バインド** を選択します。
    3. **式の編集** を選択します。
    4. 式を `Total.Running.Amount.Sum(false)+Total.Running.Amount.Collect(Total.Page.Amount.Sum(true))` に更新します。

    > [!NOTE]
    > この `Total.Running.Amount.Sum(false)` オペランドは、過去に収集された合計金額を返します。 `Total.Running.Amount.Collect(Total.Page.Amount.Sum(true))` オペランドは、現在のページの合計金額を返します。 2 番目のオペランドのネストされた関数の引数を **True** と指定して、この値が `Total.Running.Amount` の累積合計コレクションに入れられると同時に、`Total.Page.Amount` のデータ コレクションをリセットする必要があります。 指定された引数は、0 (ゼロ) の値から次のページの合計値を収集し始める必要があります。
    >
    > `Total.Running.Amount.Sum(false)` 関数が呼び出され、現在のページの Excel **ReportPageFooter\_RunningTotalAmount** セルに金額の累積合計を入力します。

2. フォーマット ツリーで、Excel の **ReportPageFooter\_RunningTotalWeight** セルを参照するネストされた **範囲** コンポーネントを選択し、以下の手順を実行します:

    1. 右側のペインのデータ ソース ツリーで、**Total.Running.Weight.Collect()** 項目を選択します。
    2. **バインド** を選択します。
    3. **式の編集** を選択します。
    4. 式を `Total.Running.Weight.Sum(false)+Total.Running.Weight.Collect(Total.Page.Weight.Sum(true))` に更新します。

### <a name="configure-bindings-to-fill-in-the-page-running-counter"></a>バインドを構成してページ フッターの累計カウンターを入力する

1. **フォーマット デザイナー** ページのフォーマット ツリーで、**レポート ページのフッター** コンポーネントを展開し、Excel の **ReportPageFooter\_RunningCounterLines** セルを参照する入れ子の **範囲** コンポーネントを選択して以下の手順を実行します:
2. **式の編集** を選択します。
3. 式 `Total.Running.Lines.Collect(COUNT(Total.Page.Amount.Result))` を追加します。

    > [!NOTE]
    > この式は、レポート全体の収集された金額の値の数を返します。 この数字は、現在の時点で繰り返し行われているトランザクションの数に相当します。 同時に、数式は返された値を **Total.Running.Lines** コレクションに収集します。

### <a name="configure-bindings-to-fill-in-the-page-footer-counter"></a>バインドを構成してページ フッターのフッター カウンターを入力する

1. **フォーマット デザイナー** ページのフォーマット ツリーで、**レポート ページのフッター** コンポーネントを展開し、Excel の **ReportPageFooter\_PageLines** セルを参照する入れ子の **範囲** コンポーネントを選択して以下の手順を実行します:
2. **式の編集** を選択します。
3. 式 `COUNT(Total.Page.Amount.Result)-Total.Running.Lines.Sum(false)` を追加します。

    > [!NOTE]
    > この式では、現在のページのトランザクション数を、レポート全体の **Total.Page.Amount.Result** に集められたトランザクション数と、現段階で **Total.Running.Lines.Sum** に格納されているトランザクション数の差として計算します。 現在のページのトランザクション数は、Excel の **ReportPageFooter\_RunningCounterLines** セルを参照する **範囲** コンポーネントのバインドで **Total.Running.Lines** に格納されているため、現在のページの取引数はまだ含まれません。 したがって、この差は現在のページのトランザクション数と等しくなります。

![ER フォーマット デザイナーで、ページ フッターのカウンターを記入するバインドを設定しました。](./media/er-paginate-excel-reports-format6.png)

### <a name="configure-component-visibility"></a>コンポーネントの可視性を構成する

生成されたドキュメントの特定のページのページ ヘッダーとフッターの表示を変更して、以下の要素を非表示にできます:

- 最初のページのページ ヘッダー (レポートのヘッダーにはすでに列のタイトルが含まれているため)
- ページ ヘッダー (最後のページに発生する可能性のあるトランザクションを持たないもの)
- ページ フッター (最後のページに発生する可能性のあるトランザクションを持たないもの)

可視性を変更するには、**レポート ページ ヘッダー**、および **レポート ページ**  フッターコンポーネントの **有効化** プロパティを更新します。

1. **フォーマット デザイナ** ページのフォーマット ツリーで、**レポート ページ** のコンポーネントを展開し、ネストされた **レポート ページ ヘッダー** コンポーネントを選択し、次の手順に従います:

    1. **有効化** フィールドの **編集** を選択します。
    2. **式デザイナー** ページの **式** フィールドに、次の式を入力します:

        `AND(`<br>
        `COUNT(Total.Page.Amount.Result)<>0,`<br>
        `COUNT(Total.Page.Amount.Result)<>COUNT(model.CommodityRecord)`<br>
        `)`

2. 形式ツリーで、ネストされた **レポート ページフッター** コンポーネントを選択し、次の手順に従います:

    1. **有効化** フィールドの **編集** を選択します。
    2. **式デザイナー** ページの **式** フィールドに、次の式を入力します:

        `(`<br>
        `COUNT(Total.Page.Amount.Result)-Total.Running.Lines2.Sum(false)+`<br>
        `0*Total.Running.Lines2.Collect(COUNT(Total.Page.Amount.Result))`<br>
        `)<>0`

    > [!NOTE]
    > 構築 `COUNT(Total.Page.Amount.Result)-Total.Running.Lines2.Sum(false)` は、現在のページのトランザクション数の計算に使用されます。 構成 `0*Total.Running.Lines2.Collect(COUNT(Total.Page.Amount.Result)` は、現在のページのトランザクション数をコレクションに追加し、次のページのフッターの可視性を正しく処理するために使用されます。
    >
    > ベース コンポーネントの **有効化** プロパティは、ネストされたコンポーネントのバインドが処理された **後** に処理されるため、ここでは `Total.Running.Lines` コレクションを再利用できません。 **有効化** プロパティが処理されると、`Total.Running.Lines` コレクションは現在のページのトランザクション数によってすでに増分されます。

3. **保存** を選択します。

## <a name="generate-an-intrastat-declaration-control-report-updated"></a>イントラスタット申告制御レポートの生成 (更新)

1. まず、**イントラスタット** ページで 24 のトランザクションがあることを確認します。 この記事の [イントラスタット申告制御レポートの生成](#generate-intrastat-control-report) に記載の手順を繰り返して、コントロール レポートの生成と確認を行います。

    すべてのトランザクションが最初のページに表示されます。 ページの合計とカウンターは、レポートの合計とカウンターと同じ値です。 レポートのヘッダーにはすでに列のタイトルが含まれているため、1 ページ目ではページ ヘッダーの範囲が非表示になります。 2 ページ目にはトランザクションがないため、ページ ヘッダーとフッターが非表示になります。

    ![デスクトップ アプリケーションで Excel のドキュメントが生成されます。](./media/er-paginate-excel-reports-document2.gif)

2. **イントラスタット** ページで、**品目番号** コードを **D00006** から  **L0010** に変更して、2 つのトランザクションを更新します。 新商品の品名 **アクティブ ステレオ スピーカー ペア** は、元商品の品名 **スタンダードスピーカー** よりも長いことに注意してください。 このような場合は、生成されたドキュメントの対応するセルにテキストが折り返されます。 ドキュメントの改ページ位置の自動修正や、ページに関連する集計やカウントを更新する必要があります。 [イントラスタット申告制御レポートの生成](#generate-intrastat-control-report)セクションに記載の手順を繰り返して、コントロール レポートの生成と確認を行います。

    トランザクションが 2 ページで表示され、ページの合計とカウンターが正しく計算されています。 ページ ヘッダーの範囲は最初のページで正しく非表示にされ、2 ページ目に表示されます。 ページフッターは、両方のページにトランザクションが含まれるため、両方のページに表示されます。

    ![デスクトップ アプリケーションで生成された Excel のドキュメントが更新されます。](./media/er-paginate-excel-reports-document3.gif)

## <a name="frequently-asked-questions"></a>よく寄せられる質問

### <a name="is-there-any-way-to-recognize-when-the-final-page-is-processed-by-the-page-format-component"></a>最終ページがページ フォーマットのコンポーネントで処理されたことを認識する方法はありますか？

**ページ** コンポーネントは、処理されたページの数や、生成されたドキュメントの総ページ数に関する情報を[公開しません](er-fillable-excel.md#page-component-limitations)。 この場合でも、ER の[計算式](er-formula-language.md)を構成することで、最終ページを認識することができます。 次に例を示します。

- **レポート ページ** コンポーネントを使用して、すでに処理されたトランザクションの合計数を計算します。 この計算は、計算式 `COUNT(Total.Page.Amount.Result)` を使用して実現できます。 
- **レポート明細行** コンポーネントに設定されている `model.CommodityRecord` バインドに基づいて、処理する必要があるトランザクションの総数を計算します。 この計算は、計算式 `COUNT(model.CommodityRecord)` を使用して実現できます。
- 2 つの数字を比較して最終ページを認識します。 両方の値が等しい場合は、最終ページが生成されます。

> [!NOTE]
> この方法は、**レポート明細行** コンポーネントの **有効化** プロパティに、バインドされている[レコード リスト](er-formula-supported-data-types-composite.md#record-list)の反復する[レコード](er-formula-supported-data-types-composite.md#record)の実行時に、[False](er-formula-supported-data-types-primitive.md#boolean)を返す可能性のある式が含まれていない場合にのみ使用することをお勧めします。

## <a name="additional-resources"></a>追加リソース

- [ドキュメントを Excel 形式で生成するためのコンフィギュレーションを設計する](er-fillable-excel.md)
- [電子レポート (ER) フォーマットでのデータ収集データ ソースの使用](er-data-collection-data-sources.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
