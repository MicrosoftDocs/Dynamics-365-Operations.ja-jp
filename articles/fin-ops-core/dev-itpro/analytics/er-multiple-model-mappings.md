---
title: 1 つのモデル ルートに対する複数の派生マッピングの管理
description: このトピックでは、1 つのモデル ルートに対して構成された複数の派生マッピングを管理する方法について説明します。
author: NickSelin
ms.date: 01/04/2021
ms.topic: business-process
ms.prod: ''
ms.technology: ''
ms.search.form: ERSolutionTable, ERModelMappingTable
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.openlocfilehash: a774a0edf00a17be674b7a1bb07f6494e90554c3
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5743682"
---
# <a name="manage-several-derived-mappings-for-a-single-model-root"></a>1 つのモデル ルートに対する複数の派生マッピングの管理

[!include [banner](../includes/banner.md)]

[電子申告 (ER)](general-electronic-reporting.md) データ [モデル](general-electronic-reporting.md#data-model-and-model-mapping-components) コンポーネントは、発信ドキュメントを生成するデータ ソースとして、すべての構成済 ER [形式](general-electronic-reporting.md#FormatComponentOutbound) コンポーネントで使用されます。 1 つのビジネス ドメインを記述するには、多数のルート定義を持つデータ モデル コンポーネントを構成します。 

すべてのルート定義では、特定のレポート目的に最も適した方法で、そのドメインのデータを表すことができます。 すべてのルート定義に対して、ER [モデル マッピング](general-electronic-reporting.md#data-model-and-model-mapping-components) コンポーネントを、データ モデルの Microsoft Dynamics 365 Finance 固有の実装として構成できます。 この方法で、実行時にデータ モデルがどのように入力されるのかについて説明します。

ER モデル マッピング コンポーネントは、ER データ モデル [構成](general-electronic-reporting.md#Configuration) および ER モデル マッピング構成内に配置することができます。 1 つの ER 構成には、多数のマッピング コンポーネントを含めることができ、それぞれが 1 つのルート定義用に構成されます。 また、1 つの ER 構成には、1 つのルート定義用に構成されたマッピング コンポーネントを 1 つだけ含めることができます。

多くの構成プロバイダーは、同じ ER データ モデルに対して ER モデル マッピング構成を提供する場合があります。 これらのモデル マッピング構成には、さまざまなルート定義のマッピング コンポーネントが含まれる場合があります。 1 つの [プロバイダー](general-electronic-reporting.md#Provider) が提供する 1 つのルート定義に対してモデル マッピングを使用し、別のプロバイダーが提供する別のルート定義にモデル マッピングを使用できます。

このトピックの手順では、ER データ モデルが同じルート定義に対して構成された異なるモデル マッピング構成を含む場合に、ERデータ モデルの複数の ER モデル マッピング構成を管理する方法について説明します。 

このトピックの手順を実行するには、システム管理者ロールまたは電子申告開発者ロールに割り当てられている必要があります。

次の手順はすべて、USMF 会社で実行できます。 コーディングは必要ありません。

## <a name="configure-the-er-framework"></a> ER フレームワークを構成する

電子申告開発者ロールのユーザーとして、ER フレームワークを使用する前に、ER パラメーターの [最小セットを構成](er-quick-start2-customize-report.md#ConfigureFramework) して、ビジネス ドキュメントを生成します。

## <a name="import-the-standard-er-format-configurations"></a> 標準 ER 形式コンフィギュレーションをインポート

Finance の現在のインスタンスに標準的な ER 構成を追加するには、そのインスタンスに構成された ER リポジトリからインポートする必要があります。 [ER 構成をコンフィギュレーション サービスのグローバル リポジトリからダウンロードする](er-download-configurations-global-repo.md) の手順に従って、次の ER 形式の構成をインポートします:

- **自由書式の請求書 (Excel)**、バージョン 220.106
- **プロジェクト請求書 (Excel)**、バージョン 226.27

## <a name="review-the-imported-er-configurations"></a> インポートされた ER 構成のレビュー

1. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
2. **ローカライズ構成** ページの、**構成** セクションで、**レポート構成** タイルを選択します。
3. **構成** ページにある左ペインの構成ツリーで、**請求書モデル** を展開します。

    ![構成ページでインポートされた構成を確認する](./media/er-multiple-model-mappings-image1.png)

4. **自由書式の請求書 (Excel)** 形式を確認する:

    1. 左ペインの構成ツリーで、**自由書式の請求書 (Excel)** を選択します。
    2. アクション ウィンドウで、**デザイナー** を選択します。
    3. **形式デザイナー** ページの **マッピング** タブにあるデータ ソースの一覧で、**モデル** を選択します。
    4. **表示** を選択します。
    
       現在の ER 形式は、**請求書モデル** の **InvoiceCustomer** ルート定義を使用するように構成されます。 この形式を実行して **モデル** データ ソースが呼び出される場合、**InvoiceCustomer** ルート定義に対して構成されたモデル マッピングを使用して、アプリケーション データにアクセスし、データ モデルに入力します。

        ![形式デザイナー ページでモデル データ ソースを確認する](./media/er-multiple-model-mappings-image2.png)

    6. **形式デザイナー** ページを閉じます。

5. **請求書モデル マッピング** 構成の内容を確認します:

    1. 左ペインの構成ツリーで、**請求書モデル マッピング** を選択します。
    2. アクション ウィンドウで、**デザイナー** を選択します。
    3. **モデルからデータ ソースへのマッピング** ページで、現在の ER モデル マッピング構成に、複数のモデル マッピング コンポーネントが含まれていることを確認します。

        + **顧客請求書** モデル マッピングは、**請求書モデル** の **InvoiceCustomer** ルート定義に対して構成されます。 したがって、**自由書式の請求書 (Excel)** ER 形式を実行するときに、この ER 構成の **顧客請求書** モデル マッピングを選択して、アプリケーション データにアクセスし、データ モデルに入力することができます。
        + **プロジェクト請求書** モデル マッピングは、**請求書モデル** の **InvoiceProject** ルート定義に対して構成されます。 したがって、**プロジェクト請求書 (Excel)** ER 形式を実行するときに、この ER 構成の **プロジェクト請求書** モデル マッピングを選択して、アプリケーション データにアクセスし、データ モデルに入力することができます。

        ![モデルからデータ ソースへのマッピング ページでの請求書 モデル マッピング](./media/er-multiple-model-mappings-image3.png)

    4. **モデルからデータ ソースへのマッピング** ページを閉じます。
    5. **バージョン** クイックタブで、**削除** を選択して、この ER 構成のバージョン 240.175 より後のバージョンをすべて削除します。

6. **プロジェクト請求書モデル マッピング (RDP)** 構成の内容を確認します:

    1. 左ペインの構成ツリーで、**プロジェクト請求書モデル マッピング (RDP)** を選択します。
    2. アクション ウィンドウで、**デザイナー** を選択します。
    3. **モデルからデータ ソースへのマッピング** ページで、現在の ER モデル マッピング構成に **InvoiceProject** モデル マッピングが含まれており、このモデル マッピングが **請求書モデル** の **InvoiceProject** ルート定義に対して構成されていることを確認します。 **プロジェクト請求書 (Excel)** ER 形式を実行するときに、この ER 構成の **InvoiceProject** モデル マッピングを選択して、アプリケーション データにアクセスし、データ モデルに入力します。

        ![モデルからデータ ソースへのマッピング ページでのプロジェクト請求書モデル マッピング](./media/er-multiple-model-mappings-image4.png)

    4. **モデルからデータ ソースへのマッピング** ページを閉じます。
    5. **バージョン** クイックタブで、**削除** を選択して、この ER 構成のバージョン 226.35 より後のバージョンをすべて削除します。

## <a name="customize-the-imported-er-configurations"></a>インポートされた ER 構成のカスタマイズ

このセクションでは、Microsoft によって提供されるモデル マッピングを [カスタマイズ](er-quick-start3-customize-report.md#customize-the-model-mapping-configuration) する方法について説明します。 たとえば、カスタム ロジックを実装したり、不足しているバインドを追加するために、カスタマイズが必要になる場合があります。

### <a name="customize-the-invoice-model-mapping-configuration"></a>請求書モデル マッピング構成のカスタマイズ

1. **構成** ページにある左ペインの構成ツリーで、**請求書モデル マッピング** を選択します。
2. アクション ウィンドウで、**構成の作成** を選択します。
3. **構成の作成** ドロップダウン ダイアログ ボックスの **新規** フィールドで、**名前から取得: 請求書モデル マッピング、Microsoft** を選択します。
4. **名前** フィールドに、**請求書モデル マッピング Litware** と入力します。
5. **構成の作成** を選択します。
6. 派生マッピングの [下書き](general-electronic-reporting.md#component-versioning) バージョンを、実行時に使用可能として [マーク](er-quick-start2-customize-report.md#MarkFormatRunnable) します:

    1. アクション ペインの **構成** タブにある **詳細設定** グループで、**ユーザー パラメーター** を選択します。
    2. **ユーザー パラメーター** ダイアログ ボックスで、**実行設定** オプションを **はい** に設定し、**OK** を選択します。
    3. **編集** を選択し、必要に応じてページを編集可能にします。
    4. 構成ツリーで現在選択されている **請求書モデル マッピング Litware** 構成について、**ドラフトの実行** オプションを **はい** に設定します。

7. アクション ペインで、**デザイナー** を選択して、この構成のモデル マッピングを確認します。

    ![モデルからデータ ソースへのマッピング ページで請求書モデル マッピングを確認する](./media/er-multiple-model-mappings-image5.png)

    > [!TIP]
    > これで、デザイナー内でこの ER 構成の ER モデル マッピング コンポーネントを開き、カスタム ロジックを構成できます。 詳細については、[モデル マッピングの構成をカスタマイズする](er-quick-start3-customize-report.md#customize-the-model-mapping-configuration) を参照してください。

8. **モデルからデータ ソースへのマッピング** ページを閉じます。

これで、**請求書モデル マッピング** と **請求書モデル マッピング Litware** 構成が作成され、各構成には、**InvoiceCustomer** ルート定義用に構成されたモデル マッピングがあります。 **InvoiceCustomer** ルート定義を持つモデル データ ソースを含む **自由書式の請求書 (Excel)** 形式など、任意の ER 形式で使用される既定のモデル マッピングとして、モデル マッピングのいずれかを明示的に割り当てます。 それ以外の場合、ER 形式のいずれかを実行、編集、または検証すると、次の例外がスローされ、既定のモデル マッピングが明示的に割り当てられていないことが通知されます。
 
> 構成 \<configuration names separated by commas\> 内の '\<model name\> (\<root descriptor\>)' データ モデルに複数のモデル マッピングが存在します。 構成の 1 つを既定として設定します。

![構成ページで編集用の形式を開く](./media/er-multiple-model-mappings-image6.gif)

### <a name="customize-the-project-invoice-model-mapping-rdp-configuration"></a>プロジェクト請求書モデル マッピング (RDP) 構成のカスタマイズ

1. **構成** ページにある左ペインの構成ツリーで、**プロジェクト請求書モデル マッピング (RDP)** を選択します。
2. アクション ウィンドウで、**構成の作成** を選択します。
3. **構成の作成** ダイアログ ボックスの **新規** フィールドで、**名前から取得: プロジェクト請求書モデル マッピング (RDP)、Microsoft** を選択します。
4. **名前** フィールドに、**プロジェクト請求書モデル マッピング Litware** と入力します。
5. **構成の作成** を選択します。
6. 構成ツリーで現在選択されている **プロジェクト請求書モデル マッピング Litware** 構成について、**ドラフトの実行** オプションを **はい** に設定します。
7. アクション ペインで、**デザイナー** を選択して、この構成のモデル マッピングを確認します。

    ![モデルからデータ ソースへのマッピング ページでカスタマイズされたプロジェクト請求書モデル マッピングを確認する](./media/er-multiple-model-mappings-image7.png)

8. **モデルからデータ ソースへのマッピング** ページを閉じます。

これで、**請求書モデル マッピング**、**プロジェクト請求書モデル マッピング (RDP)** および **プロジェクト請求書モデル マッピング、Litware** の構成ができました。 これらの各構成には、**InvoiceProject** ルート定義用に構成されたモデル マッピングがあります。 モデル マッピングの 1 つを、任意の ER 形式で使用される既定のモデル マッピングとして明示的に割り当てます。 たとえば、**InvoiceProject** ルート定義を持つモデル データ ソースを含む **プロジェクト請求書 (Excel)** 形式を使用します。 それ以外の場合、ER 形式のいずれかを実行または編集すると、例外がスローされ、既定のモデル マッピングが明示的に割り当てられていないことが通知されます。

## <a name="select-the-derived-invoice-model-mapping-litware-configuration-as-the-configuration-that-contains-default-model-mappings"></a>既定のモデル マッピングを含む構成として、派生した請求書モデル マッピング Litware 構成を選択します

1. **構成** ページにある左ペインの構成ツリーで、**請求書モデル マッピング Litware** を選択します。
2. **モデル マッピングの既定値** オプションを **はい** に設定します。

    ![構成ページでモデル マッピングを既定のモデル マッピングとして設定する](./media/er-multiple-model-mappings-image8.png)

    この設定により、**顧客請求書コピー** モデル マッピングが、**自由書式の請求書 (Excel)** を実行するとき、または編集あるいは検証するときに使用されます。 **請求書モデル マッピング** 構成からの **顧客請求書** モデル マッピングは無視されます。

    これで、形式デザイナーで確認のために **自由書式の請求書 (Excel)** を開くことができます。

## <a name="select-the-derived-project-invoice-model-mapping-litware-configuration-as-the-configuration-that-contains-default-model-mappings"></a>既定のモデル マッピングを含む構成として、派生したプロジェクト請求書モデル マッピング Litware 構成を選択します

1. **構成** ページにある左ペインの構成ツリーで、**プロジェクト請求書モデル マッピング Litware** を選択します。
2. **モデル マッピングの既定値** オプションを **はい** に設定します。

    この場合、前のセクションの **請求書モデル マッピング Litware** 構成で説明した場合とは異なり、**プロジェクト請求書モデル マッピング Litware** 構成から **InvoiceProject コピー** モデル マッピングの使用を開始することはできません。 **InvoiceProject** ルート定義のモデル マッピングを含む 2 つの構成は、現在、既定の構成としてマークされています。 したがって、使用の優先順位は等しくなります。 この問題を解決するには、この手順の残りのステップを実行します。

3. 左ペインの構成ツリーで、**請求書モデル マッピング Litware** を選択します。
4. アクション ウィンドウで、**デザイナー** を選択します。
5. **モデルからデータ ソースへのマッピング** ページで、**編集** を選択して、必要に応じてページを編集可能にします。
6. **プロジェクト請求書コピー** モデル マッピングを選択し、その **削除済** チェック ボックスを選択します。

    ![モデルからデータ ソースへのマッピング ページでモデル マッピングを仮想的に削除するように設定する](./media/er-multiple-model-mappings-image9.png)

    この設定により、**請求書モデル マッピング Litware** 構成は、**InvoiceProject** ルート定義にモデル マッピングを持たないものとして処理されます。 **InvoiceProject コピー** モデル マッピングは既定で発行されます。 このモデル マッピングを含む構成 **プロジェクト請求書モデル マッピング Litware** は、既定の構成としてマークされます。 既定としてマークされているため、**プロジェクト請求書モデル マッピング (RDP)** 構成からの **InvoiceProject** モデル マッピングよりも優先順位が高くなります。

## <a name="other-considerations"></a>その他の考慮事項

**プロジェクト請求書モデル マッピング Litware** 構成の **InvoiceProject コピー** モデル マッピングは、**ReportDataProvider** データ ソースを使用するように設計されています。 データ ソースは、**PsaProjInvoiceDP** アプリケーション クラスを参照する *オブジェクト* タイプの 一部です。 このクラスは、印刷管理フレームワークのプロジェクト請求書 SQL Server レポート サービス (SSRS) レポートのデータ プロバイダーとして実装されます。 ER [統合ポイント](er-apis-app10-0-11.md#api-to-run-a-format-mapping-for-the-generation-of-outbound-documents) としてこのデータ ソースを選択します。 印刷管理レポートに対する現在の ER 実装では、この設定が考慮されます。 詳細については、**ERPrintMgmtDataProviderReport** アプリケーション クラスのソース コードを確認してください。 実行時に、**ReportDataProvider** データ ソースをモデル マッピング統合ポイントとして割り当てると、Finance はこのマッピング コンポーネントを **プロジェクト請求書モデル マッピング (RDP)** 構成からの **InvoiceProject** マッピング コンポーネントよりも高い優先順位で処理します。

## <a name="see-also"></a>参照

- [個別の電子申告コンフィギュレーションで電子申告モデル マッピングを管理する](./tasks/er-manage-model-mapping-configurations-july-2017.md)
- [国のコンテキスト依存電子申告モデル マッピングを構成する](er-country-dependent-model-mapping.md)
- [電子申告のフレームワーク API の変更点](er-apis-app10-0-11.md)


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]