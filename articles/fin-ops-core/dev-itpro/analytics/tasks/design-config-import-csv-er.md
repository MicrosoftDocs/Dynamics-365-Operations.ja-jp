---
title: 外部の CSV ファイルからデータをインポートするための ER コンフィギュレーションの設計
description: この手順を使用して、外部ファイルから CSV 形式で Finance and Operations アプリにデータをインポートできるように電子申告コンフィギュレーションを設計します。
author: NickSelin
manager: AnnBe
ms.date: 12/12/2017
ms.topic: business-process
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.openlocfilehash: 82c3af7d49f725a045b17cbef00b56fdfa0383f3
ms.sourcegitcommit: 6cb174d1ec8b55946dca4db03d6a3c3f4c6fa2df
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/09/2021
ms.locfileid: "5564121"
---
# <a name="design-er-configurations-to-import-data-from-external-csv-files"></a>外部の CSV ファイルからデータをインポートするための ER コンフィギュレーションの設計

[!include [banner](../../includes/banner.md)]

この手順を使用して、外部ファイルから CSV 形式でアプリケーションにデータをインポートできるように電子申告 (ER) コンフィギュレーションを設計します。 この手順では、サンプル会社 Litware, Inc. 用に、必要な ER の構成を作成します。これらのステップを完了するには、まず手順 「ER 構成プロバイダを作成し、アクティブとしてマークする」 に記載のステップを完了する必要があります。

この手順は、「システム管理者」または「電子レポート開発者」ロールが割り当てられているユーザー用に作成されています。 これらのステップは、USMF データ セットを使用して完了することができます。

以下のファイルをローカルにダウンロードして保存する必要もあります: [Dynamics 365 Finance 電子レポートの例](https://go.microsoft.com/fwlink/?linkid=862266): 1099model.xml、1099formatcsv.xml、1099entriescsv.csv。

1. [組織管理] > [ワークスペース] > [電子申告] の順に移動します。
    * アプリケーションのテーブルに、XML、TXT、または CSV 形式の外部ファイルをインポートするプロセスを構成できます。 まず、ビジネス観点から、インポートされたデータを表す抽象データ モデルを作成する必要があります: ER データ モデルの構成が作成されます。 次に、ファイルから抽象データ モデルにデータをポートする方法として、設計されたデータ モデルにマップするインポートされたファイルの構造を定義します: ER 形式の構成が作成されます。 次に、インポートされたファイルのデータと保持されている抽象データ モデルを使用してアプリケーション テーブルまたはデータ エンティティーを更新する方法を記述する、新しいモデル マッピングを使用し、ER データ モデル構成を拡張する必要があります。
    * 以下の手順では、外部から追跡されたベンダーの取引を後で1099のフォームのベンダーの決済で使用する目的で、外部の CSV ファイルからインポートする方法を説明します。
    * サンプル会社 Litware, Inc. のコンフィギュレーション プロバイダーが使用可能であり、アクティブとしてマークされていることを確認します。 この構成プロバイダーが表示されない場合は、「構成プロバイダを作成し、アクティブとしてマークする」 に記載の手順を完了する必要があります。
2. [コンフィギュレーションをレポートする] をクリックします。
3. [1099 Payments model] フィルタを適用します。 手順 「ER 電子レポート用に外部ファイルからデータをインポートするために必要な設定を作成する」 を既に完了しており、 [1099 支払モデル] の構成を構成ツリーで利用できる場合は、次の下位タスクのすべての手順をスキップしてください 。

## <a name="add-a-new-er-model-configuration"></a>新しい ER モデル コンフィギュレーションの追加

1. データのインポートをサポートする新しいモデルを作成する代わりに、既にダウンロードしてある 1099model.xml ファイルをロードします。 このファイルには、仕入先のトランザクションのカスタム データ モデルが含まれています。 このデータ モデルは、必要なデータ コンポーネントに既にマップされています。
2. [交換] をクリックします。
3. [XML ファイルから読み込む] をクリックします。
4. [参照] をクリックし、以前ダウンロードした 1099model.xml ファイルに移動します。
5. [OK] をクリックします。

## <a name="add-a-new-er-format-configuration-that-supports-data-import"></a>データのインポートをサポートする新しい ER 書式のコンフィギュレーションの追加

1. ツリーで、[1099 Payments model] を選択します。
2. [コンフィギュレーションの作成] をクリックすると、ドロップ ダイアログが開きます。
3. [新規] フィールドで、「1099 Payments model のデータ モデルに基づいた書式」と入力します。
4. [データのインポートのサポート] フィールドで [はい] を選択します。
5. ESC キーを押してこのページを閉じます。
    * データのインポートをサポートするために、新しい ER 書式を作成する代わりに既にダウンロードしてあるファイル 1099formatcsv.xml をロードします。 このファイルには、入力される CSV ファイルの構造を定義する必須のERフォーマットと、この構造と仕入先の取引のデータ モデルのマッピングが含まれています。
6. [交換] をクリックします。
7. [XML ファイルから読み込む] をクリックします。
    * [参照] をクリックし、以前ダウンロードした 1099formatcsv.xml ファイルに移動します。
8. [OK] をクリックします。
9. ツリーで、[1099 Payments model] を展開します。
10. ツリーで、[1099 Payments model\For importing vendors' transactions (CSV)] を選択します。

## <a name="review-format-settings"></a>書式設定の確認

1. [デザイナー] をクリックします。
2. [展開] / [折りたたみ] をクリックします。
3. [詳細の表示] をオンに切り替えます。
    * 設計された形式は、CSV 形式の外部ファイルの予想構造を表します。
4. ツリーで、[受取: ファイル\ルート: 順番] を選択します。
    * ルート要素がシーケンス タイプの場合、「特殊文字」 フィールドで 「New line - Windows (CR LF)」 オプションが選択されています。 この設定に基づいて、解析ファイル内の各明細行を別々のレコードとみなす必要があります。
5. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..*` を選択します。
    * ルート\明細行の要素がシーケンス タイプの場合、[多様性] フィールドで 「1 つ、多数」が選択されています。 この設定に基づいて、解析ファイルに少なくとも 1 つの明細行が表示されます。
6. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..* \Types: Case` を選択します。
    * CASE タイプのルート\明細行\タイプ要素は、ルート\明細行順序の入れ子になった要素として追加されていることに注意してください。 この CASE 要素には 3 つの入れ子になった順序要素が含まれているため、この設定では解析ファイルで 3 種類の明細行を満たすと想定しています。
7. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..* \Types: Case\Header: Sequence 1..1` を選択します。
    * 順番タイプのルート\明細行\タイプ\ヘッダー要素には、固定された文字列値として定義されている値の、入れ子になった文字列要素が含まれています。 この順序は、解析ファイルのヘッダー行を解析します。
8. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..* \Types: Case\Record: Sequence 1..1 (,)` を選択します。
    * 順番タイプのルート\明細行\タイプ\レコード要素は、トランザクション明細行を解析するように構成されています。 「区切り記号」の文字オプションにカンマとが設定されていることに注意してください。 つまり、解析ファイル内のこの明細行のタイプでは、フィールド区切り記号としてカンマが使用されることを意味します。
    * 分割されたフィールドとしてト取引の明細行を解析する目的で、異なるデータ タイプの複数の入れ子になった要素が、ルート\明細行\タイプ\レコード要素に追加されていることに注意してください。 「見積申請」のオプションが [なし] として構成されていることに留意してください。 つまり、解析ファイルでは、このタイプのすべてのフィールドには囲まれた文字が含まれていないと見なされます。
9. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..* \Types: Case\Record: Sequence 1..1 (,)\TransactionDate: DateTime` を選択します。
    * たとえば、DATETIME タイプのルート\明細行\タイプ\レコード\TransactionDate 要素は、取引日付と時間の値を M/d/yyyy の形式で解析ファイルから取得するように構成されています。
10. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..* \Types: Case\Record: Sequence 1..1 (,)\CountryCode: String 0..1` を選択します。
    * [ルート\明細行\タイプ\レコード\CountryCode] の文字列タイプの要素は、[多様性] フィールドで 「ゼロ、1 つ」 オプションとして構成されることに注意してください。 この設定では、オプションとして解析明細行で CountryCode フィールドの値が考慮されます。
11. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..* \Types: Case\Record: Sequence 1..1 (,)\Remark: Sequence 1..1 (,)` を選択します。
    * [ルート\明細行\タイプ\レコード\注釈] のシーケンス タイプの要素は、[見積申請] のフィールドに 「すべて」オプション、および [見積マーク] フィールドに二重引用符文字を保持するよう構成されています。 これは、解析ファイル内のこのタイプの行のすべてのフィールド (入れ子になった要素によって説明: 文字列型のテキスト) は二重引用符で囲まれているとみなされることを意味します。
12. ツリーで、`Incoming: File\Root: Sequence\Line: Sequence 1..* \Types: Case\Unparsed: Sequence 1..1` を選択します。
    * 順番タイプのルート\明細行\タイプ\の解析されていない要素は、上記の親 CASE 要素で説明された構造と一致しない構造のトランザクション明細行を解析するために構成されています。

## <a name="review-the-setting-of-the-format-mapping-to-the-data-model"></a>データ モデルに対する書式マッピングの設定の確認

1. [形式をモデルにマップ] をクリックします。
    * モデル マッピング 「CSV 形式からのモデルへのマッピング」 には、受信した CSV ファイルからデータモデルへのデータ転送の流れを記述しています。
2. [デザイナー] をクリックします。
3. ツリーで、「形式」を展開します。
    * 設計された形式が、ここではデータ ソース コンポーネントとして示されていることに注意してください。
4. ツリーで、[形式\収入: ファイル (収入)] を展開します。
5. ツリーで、[形式\受取: ファイル (受取)\ルート: 順番 (ルート)] を展開します。
6. ツリーで、`format\Incoming: File(Incoming)\Root: Sequence(Root)\Line: Sequence 1..* (Line)` を展開します。
7. ツリーで、`format\Incoming: File(Incoming)\Root: Sequence(Root)\Line: Sequence 1..* (Line)\Types: Case(Types)` を展開します。
8. ツリーで、`format\Incoming: File(Incoming)\Root: Sequence(Root)\Line: Sequence 1..* (Line)\Types: Case(Types)\Record: Sequence 1..1 (,)(Record)` を展開します。
9. ツリーで、`format\Incoming: File(Incoming)\Root: Sequence(Root)\Line: Sequence 1..* (Line)\Types: Case(Types)\Record: Sequence 1..1 (,)(Record)\Data` を展開します。
10. ツリーで、`format\Incoming: File(Incoming)\Root: Sequence(Root)\Line: Sequence 1..* (Line)\Types: Case(Types)\Record: Sequence 1..1 (,)(Record)\Data\CountryCode: String 0..1 (CountryCode)` を展開します。
11. ツリーで、`format\Incoming: File(Incoming)\Root: Sequence(Root)\Line: Sequence 1..* (Line)\Types: Case(Types)\Record: Sequence 1..1 (,)(Record)\Data\TransactionDate: DateTime(TransactionDate)` を選択します。
    * TransactionDate や CountryCode などの必須、あるいは任意の書式要素は、定義された 「書式」 データ ソース コンポーネントでは異なって見えることに注意してください。
12. ツリーで、[トランザクション = $both''] を展開します。
    * インポート ファイルの構造を定義する書式の要素が、データ モデルの要素にバインドされることに注意してください。 これらのバインドに基づき、インポートされた CSV ファイルの内容は、実行時に既存のデータ モデル内に格納されます。 CountryRegion 要素のバインディングに注意してください。 国コード値が指定されていない受信ファイルの取引要素については、、既定の国コードである 「USA」 がデータモデルに自動入力されます。
13. [詳細を表示する] をオンに切り替えます。
14. [検証] タブをクリックします。
15. [検索] をクリックします。
16. [検索] フィールドに、「仕入先」を入力します。
17. [次を検索] をクリックします。
    * この書式マッピングには、ビジネス観点からインポートされたデータの正確性を検証する、ユーザー定義のロジックが含まれる場合があります。 例えば、設定に基づいて、インポートファイルの中で、ヘッダー行の構造と取引行の構造が一致しない行については、ファイル内の取引のシーケンス番号を示す警告メッセージが情報ログに生成され、ユーザに通知されます。
18. ページを閉じます。

## <a name="run-the-format-mapping"></a>形式マッピングの実行

テストのために、以前にダウンロードした 1099entriescsv.csv ファイルを使用して形式マッピングを実行します。 生成された出力は選択された CSV ファイルからインポートされ、実際のインポート時にカスタム データ モデルに読み込まれるデータが表示されます。

1. [実行] をクリックします。
    * [参照] をクリックし、以前ダウンロードした 1099entriescsv.csv ファイルに移動します。
2. [OK] をクリックします。
    * 受理できない明細行に関する警告メッセージに注意してください。 7 行目に二重引用符でトランザクション コメント テキストが含まれていないときに、4 行目には許容されない形式で表示される収入値が含まれます。
    * 選択ファイルからインポートされてデータ モデルにポートされたデータを表すXML 書式の出力を確認します。 インポートされた CSV ファイルのすべての 7 つの行が処理されたことに注意してください。 フィールドのタイトル行 1 はスキップされ、4 つの取引は正しく解析され、2 つの取引は無効であると認識されます。
3. ページを閉じます。
4. ページを閉じます。


[!INCLUDE[footer-include](../../../../includes/footer-banner.md)]