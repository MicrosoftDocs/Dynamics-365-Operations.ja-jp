---
title: ER 外部ファイルからデータをインポートするために必要なコンフィギュレーションの作成
description: このトピックでは、外部ファイルから Microsoft Dynamics 365 Finance アプリにデータをインポートできるように電子申告コンフィギュレーションを設計します。
author: NickSelin
ms.date: 03/24/2021
ms.topic: business-process
ms.prod: ''
ms.technology: ''
ms.search.form: DefaultDashboard, ERWorkspace, ERSolutionTable, ERDataModelDesigner, ERSolutionCreateDropDialog, EROperationDesigner, ERModelMappingTable, ERModelMappingDesigner, ERExpressionDesignerFormula, Tax1099Summary, VendSettlementTax1099
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.openlocfilehash: 2194bdc918035bf3aebe9b90ddc8a30f9937bb0c
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/31/2021
ms.locfileid: "5751465"
---
# <a name="er-create-required-configurations-to-import-data-from-an-external-file"></a>ER 外部ファイルからデータをインポートするために必要なコンフィギュレーションの作成

[!include [banner](../../includes/banner.md)]

次の手順では、システム管理者または電子申告開発者の役割のユーザーが、電子申告 (ER) コンフィギュレーションを設計して、外部ファイルからアプリケーションにデータをインポートする方法を説明します。 この例では、サンプル会社 Litware, Inc. に必要となる ER 構成を作成します。これらのステップを完了するには、まずタスク ガイド「ER 構成プロバイダを作成し、アクティブとしてマークする」 に記載の手順を完了する必要があります。 これらのステップは、USMF データ セットを使用して完了することができます。 次のファイルをダウンロードしてローカルに保存する必要もあります。 

| コンテンツの説明                       | ファイル名                                     |
|-------------------------------------------|-----------------------------------------------|
| ER データ モデル構成 - 1099 | [1099model,xml](https://download.microsoft.com/download/b/d/9/bd9e8373-d558-4ab8-aa9b-31981adc97ea/1099model.xml)                  |
| ER フォーマット構成 - 1099    | [1099format.xml](https://download.microsoft.com/download/e/8/7/e87154b0-b53f-431f-8e1e-0b7f7c9805a9/1099format.xml)                  |
| XML 形式の受信ドキュメントのサンプル                          | [1099entries.xml](https://download.microsoft.com/download/4/0/3/403a4958-df24-476a-b8b0-6843a9fa7f89/1099entries.xml)        |
| 受信ドキュメントのデータを管理するブックのサンプル                          | [1099entries.xlsx](https://download.microsoft.com/download/6/0/0/6001abab-a331-48db-a939-41851fb0f5d0/1099entries.xlsx) |

ER は、ビジネス ユーザーに対し、外部データ ファイルを、.XML または .TXT 形式でインポートするプロセスを構成するための機能を提供します。 最初に、インポートするデータを表す、抽象データ モデルと ER データ モデルのコンフィギュレーションを設計する必要があります。 次に、インポートするファイルの構造を定義、およびデータをファイルから抽象データ モデルにポートするために使用する方法を定義する必要があります。 その抽象データ モデルのために、設計されたデータ モデルに配置される ER 形式のコンフィギュレーションを作成する必要があります。 次に、インポート データが抽象データ モデル データとして存在する方法、およびテーブルを更新するための使用方法を説明するマッピングで、データ モデルのコンフィギュレーションを拡張する必要があります。  ER データ モデルの構成には、アプリケーションの送信先に対するデータ モデルのバインドを記述する新しいモデル マッピングを追加する必要があります。  

次のシナリオでは、ER データのインポート機能を示します。 これには、外部で追跡された仕入先の取引が含まれ、その後、1099 の仕入先の決済で報告されるようにインポートされたベンダー取引が含まれます。   

## <a name="add-a-new-er-model-configuration"></a>新しい ER モデル コンフィギュレーションの追加
1. [組織管理] > [ワークスペース] > [電子申告] の順に移動します。

    サンプル会社 'Litware, Inc.' の構成プロバイダーを確認する 使用可能であり、アクティブとしてマークされていることを確認します。 この構成プロバイダーが表示されない場合は、まず 「構成プロバイダを作成し、アクティブとしてマークする」 に記載の手順を完了する必要があります。   

2. [コンフィギュレーションをレポートする] をクリックします。

    データのインポートをサポートするために新しいモデルを作成する代わりに、既にダウンロードしてあるファイル 1099model.xml をロードします。 このファイルには、仕入先のトランザクションのカスタム データ モデルが含まれています。 このデータ モデルは、AOT データ エンティティ内にあるデータ コンポーネントにマッピングされます。   

3. [交換] をクリックします。
4. [XML ファイルから読み込む] をクリックします。

    [参照] をクリックし、以前ダウンロードした 1099model.xml ファイルに移動します。  

5. [OK] をクリックします。
6. ツリーで、[1099 Payments model] を選択します。

## <a name="review-data-model-settings"></a>データ モデルの設定の確認
1. [デザイナー] をクリックします。

    このモデルは、ビジネスの観点から仕入先の取引を表すために設計されたもので、実装とは異なります。   

2. ツリーで、[1099-MISC] を展開します。
3. ツリーで、[1099-MISC\Transactions] を選択します。
4. ツリーで、[1099-MISC\Transactions] を展開します。

    このモデルのトランザクションの要素は、個々のトランザクションを表します。 子要素は、トランザクションごとに、仕入先の口座およびトランザクションの日付などの必須情報を指定するために使用します。   

5. ページを閉じます。

## <a name="add-a-new-er-format-configuration-that-supports-data-import"></a>データのインポートをサポートする新しい ER 書式のコンフィギュレーションの追加
このサブタスクの手順は、外部ファイルからのデータ インポートを管理するために、書式コンフィギュレーションを新規作成する方法を示します。   
1. [コンフィギュレーションの作成] をクリックすると、ドロップ ダイアログが開きます。
2. [新規] フィールドで、「1099 Payments model のデータ モデルに基づいた書式」と入力します。
3. [データのインポートのサポート] フィールドで [はい] を選択します。
4. ESC キーを押してこのページを閉じます。

    データのインポートをサポートするために新しい書式を作成する代わりに、既にダウンロードしてあるファイル 1099format.xml をロードします。 このファイルには、インポートするファイルの定義済み構造と、ベンダーのトランザクションのカスタムデータモデルへの構造のマッピングが含まれます。   
5. [交換] をクリックします。
6. [XML ファイルから読み込む] をクリックします。
    [参照] をクリックし、以前ダウンロードした 1099format.xml ファイルに移動します。  
7. [OK] をクリックします。
8. ツリーで、[1099 Payments model] を展開します。
9. ツリーで、[1099 Payments model\Format for importing vendors' transactions] を選択します。

## <a name="review-format-settings"></a>書式設定の確認
1. [デザイナー] をクリックします。
2. [詳細の表示] をオンに切り替えます。
3. [展開] / [折りたたみ] をクリックします。
4. [展開] / [折りたたみ] をクリックします。

    設計された形式は、外部ファイルの予想構造を表します。 このファイルは XML 形式であり、決済のルート要素を含んでいる必要があります。 各仕入先の取引は、ゼロ対多の多様性を持つように定義されている取引要素で表されます。 つまり、受信ファイルが 0 個から複数のトランザクションの範囲を含む可能性があります。 「取引 」要素のネストされた要素は、単一の取引の属性を表します。 国を除くすべての属性が、必須としてマークされていることに注意してください。これはインポートするファイルに含める必要があることを意味します。   

## <a name="review-the-settings-of-the-format-mapping-to-the-data-model"></a>データ モデルに対する書式マッピングの設定の確認
1. [形式をモデルにマップ] をクリックします。

    マッピング 「仕入れ先の取引をインポートする 」 には、受信する XML ファイルからカスタム データモデルの選択された部分へのデータ転送のルールを含んでおり、1099-MISC の定義を選択することで設定されます。  

2. [デザイナー] をクリックします。
3. [詳細の表示] をオンに切り替えます。
4. ツリーで、[format: Record] を展開します。
5. ツリーで、[format: Record] を選択します。

    設計された形式が、ここではデータ ソース コンポーネントとして示されていることに注意してください。  

6. ツリーで、`format: Record\*settlement: XML Element 1..1 (settlement): Record` を展開します。
7. ツリーで、`format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list` を展開します。
8. ツリーで、`format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list\*vendor: XML Element 1..1 (vendor): Record` を展開します。
9. ツリーで、`format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list\country: XML Element 0..1 (country): Record` を展開します。
10. ツリーで、`format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list\*vendor: XML Element 1..1 (vendor): Record` を選択します。

    事前定義された「フォーマット 」データ ソース 構成では、必須およびオプションのフォーマット要素の表示が異なることに注意してください。  
11. ツリーで、[Transactions: Record list= format.settlement.'$enumerated'] を展開します。

    インポート ファイルの構造を定義する書式の要素が、カスタム データ モデルの要素にバインドされることに注意してください。 これらのバインドに基づき、インポートされた XML ファイルの内容は、実行時に既存のデータ モデル内に格納されます。 国要素のバインディングに注意してください。 このような要素を持たない入力ファイルの取引要素については、既定の国コード 「USA 」 がデータ モデルに取り込まれます。  

12. [検証] タブをクリックします。

    この書式マッピングには、ビジネス観点からインポートされたデータの正確性を検証する、ユーザー定義のロジックが含まれる場合があります。 例えば、設定に基づいて、定義された国コードのないインポート ファイル内の取引については、情報ログで警告メッセージが生成され、ユーザーに通知し、取引のシーケンス番号を示します。  

13. ページを閉じます。

## <a name="run-the-format-mapping-to-the-data-model"></a>データ モデルに対する書式マッピングの実行
テストのため、この書式マッピングを実行します。 以前ダウンロードしたファイル、1099entries.xml を使用します。 このファイルは、仕入先トランザクションを管理するために使用する 1099entries.xlsx ワークブックからエクスポートすることができます。 生成された出力は選択された XML ファイルからインポートされ、実際のインポート時にカスタム データ モデルを設定します。  

1. [実行] をクリックします。

    [参照] をクリックし、以前ダウンロードした 1099entries.xml ファイルに移動します。  

2. [OK] をクリックします。

    インポートされたファイルのトランザクションに国コードが無いことに関する警告メッセージに注意してください。  
    
    選択ファイルからインポートされてデータ モデルにポートされたデータを表す出力を、XML 書式で確認します。   

3. ページを閉じます。
4. ページを閉じます。

## <a name="review-the-settings-for-the-model-mapping-to-the-destinations"></a>出力先に対する書式マッピングの設定の確認
1. ツリーで、[1099 Payments model] を選択します。
2. [デザイナー] をクリックします。
3. [モデルからデータ ソースへのマップ] をクリックします。

    1099 の手動トランザクション インポート用マッピングは、宛先の方向タイプで定義されました。 つまり、データのインポートをサポートするための入力がされ、アプリケーション内のテーブルを更新するために、インポートされた外部ファイルおよび抽象データとして存在するデータが使用されます。  

4. [デザイナー] をクリックします。
5. ツリーで、[model: Data model 1099 Payments model] を展開します。
6. ツリーで、[model: Data model 1099 Payments model\Transactions: Record list] を展開します。

    設計されたモデルが、ここではデータ ソース要素として示されていることに注意してください。 実行時に、外部ファイルからインポートされたデータが格納されます。 システム内でトランザクションの仕入先口座の入力が可能であるか、国および都道府県コードを入力する組合せ等が存在するかどうかなどを含め、インポート データが現在のアプリケーションのデータに準拠するように、複数のテーブルがデータ ソースとして追加されました。  

7. ツリーで、[model: Data model 1099 Payments model\Transactions: Record list\$failed: Calculated field = IF(OR(ISEMPTY(model.Transactions.'$refs'.vendor), ISEMPTY(model.Transactions.'$refs'.vendor1099), ISEMPTY(model.Transactions.'$refs'.box1099), ISEMPTY(model.Transactions.'$refs'.country), ISEMPTY(model.Transactions.'$refs'.state), ISEMPTY(model.Transactions.'$refs'.location)), true, false): Boolean] を選択します。
8. [編集] をクリックします。
9. [式の編集] をクリックします。

    1 つのインポートされた取引に対して少なくとも 1 つの検証が失敗した場合、この取引はデータソース属性 「$failed」 によって失敗したものとしてマークされます。  

10. ページを閉じます。
11. [キャンセル] をクリックします。
12. ツリーで、[tax1099trans: Table 'VendSettlementTax1099' records= model.Validated] を選択します。
13. [宛先の編集] をクリックします。

    インポートされたデータでアプリケーション テーブルが更新される方法を指定するため、この ER 宛先が追加されました。 この場合、データ テーブル VendSettlementTax1099 が選択されました。 レコード アクションの挿入が選択されているため、インポートされたトランザクションは VendSettlementTax1099 テーブルに挿入されます。 単一のモデル マッピングに複数の宛先が含まれる場合があることに注意してください。 つまり、インポートしたデータを使って、複数のアプリケーションのテーブルを一度に更新することができます。 テーブル、ビュー、およびデータ エンティティは、ER 宛先として使用することができます。   

    このアクションのために特別に設計されたアプリケーション (ボタンまたはメニュー項目など) 内の点からマッピングがコールされる場合、ER の宛先は統合点としてマークする必要があります。 この例では、ERTableDestination#VendSettlementTax1099 の点です。  

14. [キャンセル] をクリックします。
15. [すべて表示] をクリックします。
16. [マップ済みのものだけを表示] をクリックします。
17. ツリーで、['tax1099trans: Table 'VendSettlementTax1099' records= model.Validated] を展開します。

    唯一検証されたトランザクションを含むデータ ソース要素が、作成された宛先にバインドされることに注意してください。 インポートした取引をフィルター処理して、アプリケーションのデータと互換性のない取引をスキップできます。  

18. ツリーで、['failed: Table 'VendSettlementTax1099Entity' records= model.Failed] を選択します。
19. [検証] タブをクリックします。

    このモデル マッピングには、既存のアプリケーション データからインポートされたデータの正確性を検証する、ユーザー定義のロジックが含まれる場合があります。 たとえば、現在の設定に応じて、インポート ファイルのトランザクションにシステム内に無い仕入れ先口座が含まれる場合、ユーザーに通知して、不正確な仕入先の口座コードを示す警告メッセージが生成されます。  

    [検証後のアクション] オプションを各検証に使用して、インポート処理を継続するか停止するか、既に実行された挿入や更新を保持するかロールバックするか指定することができることに注意してください。  

20. [マップ済みのものだけを表示] をクリックします。
21. [すべて表示] をクリックします。
22. ページを閉じます。

    このモデル マッピングを実行して、設計された形式およびモデル マッピングをテストします。 1099entries.xml ファイルを使用します。 選択したファイルからのデータはシステムにインポートされます。  

23. [実行] をクリックします。

    ダイアログ ボックス内に、インポートされたファイルをパースしてからデータをデータ モデルにポートするために使用する、書式マッピングに関する追加質問が含まれていないことに注意してください。 これは、このモデルを使用する書式が現在 1 つのみ存在するためです。これはデータ インポートをサポートするために設計されたとマークされています。  
    
    インポートされたトランザクションを、手動で入力済みまたはインポート済みの他のトランザクションと区別するための、伝票 ID を定義します。  

24. [伝票 ID の入力] フィールドで、'IMPORT-001' と入力します。

    '1099entries.xml' ファイルを参照して取得します。  

25. [OK] をクリックします。

    生成された警告の一覧には、不正確な仕入先口座、不正確な税 1099 ボックス コード、不足している国コード等に関する情報が用意されます。この警告の一覧と、実行 XML ファイルに含まれるコンテンツを比較します。  

26. ページを閉じます。
27. ページを閉じます。
28. ページを閉じます。
29. ページを閉じます。
30. [買掛金勘定] > [定期処理のタスク] > [税金 1099] > [1099s の仕入先決済] の順に移動します。

    このフォームでは、インポートされたトランザクションに基づいて作成された Tax1099Summary テーブルに、累積的なトランザクションを表示します。  

31. [開始日] フィールドで、日付を「2000-01-01」に設定します。
32. [手動 1099 トランザクション] をクリックします。

    このフォームには、手動で追加されたトランザクションと、直前にインポートされたトランザクションのリストが含まれています。  

33. [伝票列] フィルターを開きます。
34. [次の値で始まる] フィルター演算子を使用して、[伝票] フィールドに "IMPORT-001" を入力します。

## <a name="review-the-relationship-between-model-and-format-mappings"></a>モデルと書式マッピング間の関係の確認
1. ページを閉じます。
2. ページを閉じます。
3. [組織管理] > [ワークスペース] > [電子申告] の順に移動します。
4. [コンフィギュレーションをレポートする] をクリックします。
5. ツリーで、[1099 Payments model] を選択します。

    同じデータの .TXT ファイル形式でのインポートをサポートすると仮定します。   

6. [コンフィギュレーションの作成] をクリックすると、ダイアログ ボックスが開きます。 
7. [新規] フィールドで、「1099 Payments model のデータ モデルに基づいた書式」と入力します。
8. [名前] フィールドに、「TXT ファイルからデータをインポート」と入力します。
9. [データのインポートのサポート] フィールドで [はい] を選択します。
10. [コンフィギュレーションの作成] をクリックします。
11. [デザイナー] をクリックします。
12. [形式をモデルにマップ] をクリックします。
13. [新規] をクリックします。
14. [定義] フィールドで値を入力または選択します。

    [1099-MISC] オプションを選択します。  

15. [名前] フィールドに、「TXT ファイルからデータをインポート」と入力します。
16. [説明] フィールドに、「TXT ファイルからデータをインポート」と入力します。
17. [保存] をクリックします。
18. ページを閉じます。
19. ページを閉じます。
20. [編集] をクリックします。

    修正プログラム 「KB 4012871 異なるバージョンの Dynamics 365 Finance に展開するための異なる種類の前提条件を指定する機能を備えた、分離された構成でのGERモデル マッピングのサポート」 ([KB 4012871](https://fix.lcs.dynamics.com/Issue/Resolved?kb=4012871)) をインストールした場合、入力したフォーマット設定に対して次の手順 「'モデル マッピングの既定' のフラグをオンにする」 を実行します。 それ以外の場合、次のステップをスキップします。  

21. [モデル マッピング] フィールドの既定値で [はい] を選択します。
22. ツリーで、[1099 Payments model] を選択します。
23. [デザイナー] をクリックします。
24. [モデルからデータ ソースへのマップ] をクリックします。
25. [実行] をクリックします。

    修正プログラム KB 4012871 異なるバージョンで展開するために異なる種類の要件を指定する機能を使用した別個のコンフィギュレーションでの GER モデル マッピングのサポート ([KB 4012871](https://fix.lcs.dynamics.com/Issue/Resolved?kb=4012871)) をインストールした場合、ルックアップ フィールドで目的のモデル マッピングを選択します。 修正プログラムをまだインストールしていない場合、マッピングは既定の書式設定の定義で既に選択されているため、次のステップに進みます。  
    
    修正プログラムの KB 4012871 がインストールされていない場合、インポートするファイルの解析に使用される追加のモデル マッピング質問がダイアログ ボックスに含まれていることに注意してください。 次にデータはダイアログ ボックスからデータ モデルにポートされます。 現時点では、インポートする計画のファイル タイプに応じてどの書式マッピングを使用する必要があるか選択することができます。  
    
    アクション用に特別に設計されたアプリケーション内のポイントからこのモデル マッピングをコールする場合は、ER の出力先および書式マッピングを統合の一部としてマークする必要があります。  

26. [キャンセル] をクリックします。
27. ページを閉じます。
28. ページを閉じます。



[!INCLUDE[footer-include](../../../../includes/footer-banner.md)]
