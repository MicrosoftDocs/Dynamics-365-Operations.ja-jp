---
title: 法人ごとの ER 形式のパラメーターの設定
description: このトピックでは、法人ごとに電子申告 (ER) 形式のパラメーターを設定する方法について説明します。
author: NickSelin
ms.date: 10/22/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ERSolutionTable, EROperationDesigner, ERLookupDesigner, ERComponentLookupStructureEditing
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: Release 8.1.3
ms.openlocfilehash: cb600c55cb2d40129d1b29ab989bc8f7cf3f4686
ms.sourcegitcommit: a5861c2fef4071e130208ad20e26cb3a42a45cf1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/17/2021
ms.locfileid: "7927457"
---
# <a name="set-up-the-parameters-of-an-er-format-per-legal-entity"></a>法人ごとの ER 形式のパラメーターの設定

[!include[banner](../includes/banner.md)]

## <a name="prerequisites"></a>必要条件

これらの手順を完了するには、まず [法人ごとに指定されるパラメーターを使用して ER 形式を構成する](er-app-specific-parameters-configure-format.md) に記載の手順を完了する必要があります。

このトピックの例を完了するには、次のいずれかのロールの Microsoft Dynamics 365 Finance にアクセスできる必要があります。

- 電子申告開発者
- 電子申告機能コンサルタント
- システム管理者

## <a name="import-er-configurations"></a>ER コンフィギュレーションをインポートする
ER の構成をインポートするには、次の手順を実行します: 

1. 環境にサインインします。
2. 既定のダッシュボードで、**電子申告** を選択します。
3. **コンフィギュレーションをレポートする** を選択します。
4. Finance の現在のインスタンスで、[法人ごとに指定されるパラメーターを使用して ER 形式を構成する](er-app-specific-parameters-configure-format.md) に記載の手順を完了している間にRegulatory Configuration Services (RCS) からエクスポートした設定をインポートします。 各[電子申告 (ER) の構成](general-electronic-reporting.md) に関して、データモデル、モデル マッピング、形式の順にこれらの手順を実行します。

    1. **交換 \> XML ファイルから読み込む** を選択します。
    2. **参照** を選択して、必要な ER コンフィギュレーションファイルを XML 形式で選択します。
    3. **OK** を選択します。

    次の図は、完了時に必要なコンフィギュレーションを示します。

    ![ER コンフィギュレーション ページ。](./media/GER-AppSpecParms-ImportedConfigurations.PNG)

## <a name="set-up-parameters-for-the-demf-company"></a>DEMF 会社のパラメーターの設定

ER フレームワークを使用して、ER 形式のアプリケーション固有のパラメーターを設定できます。

1. **DEMF** 法人を選択します。
2. コンフィギュレーション ツリーで、**LE データの参照方法を知るための形式** 形式を選択します。
3. アクション ウィンドウの、**コンフィギュレーション** タブの、**アプリケーション固有パラメーター** グループで、**設定** を選択します。

    ![ER アプリケーション固有のパラメーター ページでパラメーターを設定します。](./media/GER-AppSpecParms-LookupForm.PNG)

    **アプリケーション固有パラメーター** ページで、**LE データの参照方法を知るための形式** 形式の **セレクター** データソースに関するルールをコンフィギュレーションできます。

    基本の ER 形式に **ルックアップ** タイプのデータソースがいくつか含まれている場合は、データ ソースに対する一連のルールのコンフィギュレーションを開始する前に、**ルックアップ** クイック タブで目的のデータ ソースを選択する必要があります。

    データ ソースごとに、選択された ER 形式の各バージョンに対する個別のルールをコンフィギュレーションできます。

    基本の ER 形式の選択したバージョンで使用可能なすべてのルックアップ データ ソースのルール セット全体が、ER 形式のアプリケーション固有のパラメーターになります。

4. ER 形式のバージョン **1.1.1** を選択します。
5. **条件** クイック タブで、**追加** を選択します。
6. 新しいレコードの **コード** フィールドで、ドロップダウン矢印を選択し、ルックアップを開きます。

    ルックアップでは、選択する税コードの一覧が表示されます。 このリストは、基本の ER 形式でコンフィギュレーションされた **Model.Data.Tax** データ ソースにより返されます。 このデータ ソースには **名前** フィールドが含まれているため、各税コードの名前がルックアップに表示されます。

    ![ER アプリケーション固有パラメーター ページ (コード フィールドのルックアップ)。](./media/GER-AppSpecParms-LookupForm-CodeFldPicker.PNG)

7. **VAT19** 税コードを選択します。
8. 新しいレコードの **ルックアップの結果** フィールドで、ドロップダウン矢印を選択し、ルックアップを開きます。 ルックアップにより、選択する TaxationLevel format 形式列挙の値の一覧が表示されます。

    サインインしているユーザーの優先言語としてドイツ語を選択した場合、ベースとなる ER 形式で翻訳されていれば、ルックアップの値のラベルはドイツ語になります。 さらに、ルックアップ データ ソースのラベルが翻訳されている場合、そのラベルは **ルックアップ** タブのユーザーの優先言語で表示されます。

    ![ER アプリケーション固有のパラメーター ページのルックアップ フィールドがドイツ語に翻訳されます。](./media/GER-AppSpecParms-LookupForm-LookupFldPicker.PNG)

9. **通常の課税** 値を選択します。

    このレコードを追加することにより、次のルールを定義します: **セレクター** ルックアップ データ ソースが要求され、税コード "**VAT19**" が引数として渡されるたびに、**通常の課税** が要求された課税レベルとして返されます。

10. **追加** を選択し、次の手順に従います。

    1. **コード** フィールドで、**InVAT19** 税コードを選択します。
    2. **ルックアップの結果** フィールドで、**通常の課税** 値を選択します。

11. **追加** を選択し、次の手順に従います。

    1. **コード** フィールドで、**VAT7** 税コードを選択します。
    2. **ルックアップの結果** フィールドで、**減額課税** 値を選択します。

12. **追加** を選択し、次の手順に従います。

    1. **コード** フィールドで、**InVAT7** 税コードを選択します。
    2. **ルックアップの結果** フィールドで、**減額課税** 値を選択します。

13. **追加** を選択し、次の手順に従います。

    1. **コード** フィールドで、**THIRD** 税コードを選択します。
    2. **ルックアップの結果** フィールドで、**非課税** 値を選択します。

14. **追加** を選択し、次の手順に従います。

    1. **コード** フィールドで、**InVAT0** 税コードを選択します。
    2. **ルックアップの結果** フィールドで、**非課税** 値を選択します。

15. **追加** を選択し、次の手順に従います。

    1. **コード** フィールドで、**\*空白でない\*** オプションを選択します。
    2. **ルックアップの結果** フィールドで、**その他** の値を選択します。

    この最後のレコードを追加することにより、次のルールを定義します: 引数として渡された税コードが前述のルールのいずれも満たさない場合、ルックアップ データ ソースは、要求された課税レベルとして **その他** を返します。

    ![ER アプリケーション固有のパラメーター ページで追加された最後のレコードです。](./media/GER-AppSpecParms-LookupForm-RulesSet.PNG)

16. **ステータス** フィールドで **完了** を選択します。

    **完了** または **共有** のいずれかのステータスがある ER 形式バージョンを実行する場合、この一連のルールは **完了** のステータスである必要があります。 それ以外の場合、**セレクター** ルックアップ データ ソースの実行中に、形式がこの一連のルールからデータを読み込もうとすると、基本の ER 形式の実行が中断されます。

    **ドラフト** のステータスがある ER 形式バージョンを実行すると、基本の ER 形式は、そのステータスに関係なくこの一連のルールにアクセスできます。

17. **保存** を選択します。
18. **アプリケーション固有パラメーター** ページを閉じます。

## <a name="run-the-er-format-in-the-demf-company"></a>DEMF 会社で ER 形式を実行します。
DEMF 社で ER 形式を実行するには、以下の手順で行います: 

1. コンフィギュレーション ツリーで、**LE データの参照方法を知るための形式** 形式を選択します。
2. アクション ウィンドウで、**実行** を選択します。
3. 表示されるダイアログ ボックスで、**OK** を選択します。
4. 生成される明細書をダウンロードし、ローカルに保管します。

    生成された明細書で、税コード "**InVAT7**" の集計が **減額** レベルに、税コード "**VAT19**" と "**InVA19**" の集計が **通常** レベルに設定されていることを確認します。 この動作は、法人に依存する一連のルールのコンフィギュレーションによって決まります。

5. **税 \> 間接税 \> 売上税 \> 売上税コード** の順に移動します。
6. **InVAT7** 税コードを選択します。
7. アクション ウィンドウの、**売上税コード** タブの、**照会** グループで、**転記済売上税** を選択して、税コードごとに適用された税額と税率に関する情報を表示します。

    ![転記済売上税ページ。](./media/GER-AppSpecParms-Statement.PNG)

8. **転記済消費税** のページを閉じます。

## <a name="set-up-parameters-for-the-usmf-company"></a>USMF 会社のパラメーターの設定
USMF 社パラメーターを設定するには、以下の手順を行います: 

1. **USMF** 法人を選択します。
2. **組織管理 \> 電子申告 \> コンフィギュレーション** の順に移動します。
3. コンフィギュレーション ツリーで、**パラメーター化された呼び出しを知るためのモデル** 項目を展開し、**パラメーター化された呼び出しを知るための形式** を展開してから、**LE データの参照方法を知るための形式** 形式を選択します。
4. アクション ウィンドウの、**コンフィギュレーション** タブの、**アプリケーション固有パラメーター** グループで、**設定** を選択します。
5. 選択された ER 形式のバージョン **1.1.1** を選択します。
6. **条件** クイック タブで、**追加** を選択します。
7. 新しいレコードの **コード** フィールドで、ドロップダウン矢印を選択し、ルックアップを開きます。

    このルックアップでは、選択する **USMF** 会社税の税コードの一覧が表示されるようになります。

    ![USMF の法人税の税コードです。](./media/GER-AppSpecParms-LookupForm-CodeFldPicker2.PNG)

8. **EXEMPT** 税コードを選択します。
9. 新しいレコードの **ルックアップの結果** フィールドで、**非課税** 値を選択します。
10. **追加** を選択します。
11. 新しいレコードの **コード** フィールドで、**\*空白でない\*** オプションを選択します。
12. 新しいレコードの **ルックアップの結果** フィールドで、**通常の課税** 値を選択します。
13. **ステータス** フィールドで **完了** を選択します。
14. **保存** を選択します。

    ![ER アプリケーション固有パラメーター ページ。](./media/GER-AppSpecParms-LookupForm-RulesSet2.PNG)

15. **アプリケーション固有パラメーター** ページを閉じます。

## <a name="run-the-er-format-in-the-usmf-company"></a>USMF 会社で ER 形式を実行します。
USMF 社で ER 形式を実行するには、以下の手順を行います:

1. コンフィギュレーション ツリーで、**LE データの参照方法を知るための形式** 形式を選択します。
2. アクション ウィンドウで、**実行** を選択します。
3. 表示されるダイアログ ボックスで、**OK** を選択します。
4. 生成される明細書をダウンロードし、ローカルに保管します。

    生成された明細書で、ER 形式に対する調整なしで、異なる法人に対して同じ ER 形式を再使用したことを確認します。

## <a name="reuse-legal-entitydependent-parameters"></a>法人に依存するパラメーターの再利用

### <a name="duplicate-existing-parameters"></a>既存のパラメーターの複製

#### <a name="export-parameters"></a>パラメーターのエクスポート
パラメーターをエクスポートするには、次の手順を実行します:

1. **組織管理  \> ワークスペース \> 電子申告** の順に移動します。
2. **コンフィギュレーションをレポートする** を選択します。
3. コンフィギュレーション ツリーで、**LE データの参照方法を知るための形式** 形式を選択します。
4. アクション ウィンドウの、**コンフィギュレーション** タブの、**アプリケーション固有パラメーター** グループで、**設定** を選択します。
5. ER 形式のバージョン **1.1.1** を選択します。
6. アクション ウィンドウで、**エクスポート** を選択します。
7. 生成されるファイルをダウンロードし、ローカルに保管します。

    コンフィギュレーションされる一連のアプリケーション固有のパラメーターが、XML ファイルとしてエクスポートされました。

#### <a name="import-parameters"></a>パラメーターのインポート
パラメーターをインポートするには、次の手順を実行します:

1. ER 形式のバージョン **1.1.2** を選択します。
2. アクション ウィンドウで、**インポート** を選択します。
3. **はい** を選択して、この形式バージョンに対する既存のアプリケーション固有のパラメーターを上書きすることを確認します。
4. **参照** を選択して、バージョン **1.1.1** のエクスポートされたアプリケーション固有のパラメーターを含むファイルを検索します。
5. **OK** を選択します。

    ER 形式のバージョン **1.1.2** には、バージョン **1.1.1** に対して最初に設定したものと同じアプリケーション固有のパラメーターがあります。

##### <a name="applicability-considerations"></a>適用上の考慮事項

ER 形式のアプリケーション固有のパラメーターは、法人に依存することに注意してください。 ある法人向けに設定したアプリケーション固有のパラメータを別の法人で再利用するには、最初の法人にサインインした状態でパラメーターをエクスポートする必要があります。 続いて、他の法人にログインした後でそれらをインポートします。

また、このエクスポート/インポートの手法を使って、ある Finance のインスタンスで構成されていた ER 形式に関連するアプリケーション固有のパラメーターを、別の Finance のインスタンスに転送することもできます。

ER 形式の 1 つのバージョンに対してアプリケーション固有のパラメータを設定し、同じ形式のそれより後のバージョンを現在の財務インスタンスにインポートする場合、**ER 形式機能の以前のバージョンからアプリケーション固有のパラメータ** を使用しない限り、既存のアプリケーション固有のパラメータはインポート バージョンには適用されません。 詳細については、このトピックの後半の [既存のパラメーターの再使用](#reuse-existing-parameters) セクションを参照してください。

インポート用のファイルを選択すると、そのファイルに含まれるアプリケーション固有のパラメータの構造が、インポート用に選択された ER 形式の **ルックアップ** タイプの対応するデータソースの構造と比較されます。 既定では、各アプリケーション固有のパラメータの構造が、インポート用に選択された ER 形式の対応するデータソースの構造と一致する場合にのみ、インポートが完了します。 構造が一致しない場合は、インポートが完了しないことを示す警告メッセージが表示されます。 強制的にインポートすると、選択した ER 形式の既存のアプリケーション固有のパラメータが消去されてしまうため、最初から設定する必要があります。


Dynamics 365 Finance のバージョン 10.0.24 以降では、**機能管理** ワークスペースの **ER アプリケーション固有のパラメーターの調整** 機能を有効にすることで、既定の動作を変更し、警告メッセージを表示しないようにすることができます。 この機能を有効にすると、インポートするアプリケーション固有のパラメーターの構造が、インポートに選択されている対象の ER 形式の対応するデータソースの構造と異なる場合、以下のようなケースでインポートが成功します。

- **ルックアップ** タイプの既存のデータソースに新しい条件列を追加することで、対象となる ER 形式の構造が変更されました。 インポートが完了すると、アプリケーション固有のパラメーターが更新されます。 アプリケーション固有のパラメーターのすべてのインポートされたレコードでは、追加されたすべての条件カラムの値は、そのカラムの[データ型](er-formula-supported-data-types-primitive.md)の既定値で初期化されます。
- 対象の ER 形式の構造は、**ルックアップ** タイプの既存のデータソースからいくつかの条件列を削除することで変更されます。 インポートが完了すると、アプリケーション固有のパラメーターが更新されます。 アプリケーション固有のパラメーターのインポートされたすべてのレコードで、削除されたすべての条件欄の値が削除されます。
- **ルックアップ** タイプのデータソースを新たに追加することで、対象となる ER 形式の構造が変更されます。 インポートが完了すると、追加されたルックアップがアプリケーション固有のパラメーターに追加されます。
- 対象の ER 形式の構造は、**ルックアップ** タイプの既存のデータソースの一部を削除することで変更されます。 インポートが完了すると、対象の ER 形式から削除された **ルックアップ** タイプのデータソースに関連するすべてのアーティファクトが、インポートされたアプリケーション固有のパラメーターから削除されます。

インポートが完了すると、前述の変更点に加えて、インポートされたアプリケーション固有のパラメーターの状態が **処理中** に変更されます。 自動的に調整されたアプリケーション固有のパラメーターを手動で編集する必要があることを示す警告メッセージが表示されます。

### <a name="reuse-existing-parameters"></a>既存のパラメーターの再使用

Dynamics 365 Finance バージョン 10.0.23 より、あるバージョンの ER 形式に設定されたアプリケーション固有のパラメーターを、同じフォーマットの上位バージョンを実行する際に再利用できるようになりました。 これを行うには、**機能管理** ワークスペースの **ER 形式の旧バージョンからアプリケーション固有のパラメーターを使用する** 機能を有効にします。 この機能を有効にして、アプリケーション固有のパラメータを読み取ろうとしている ER 形式の 1 つのバージョンを実行すると、ER はこの形式の実行バージョンに設定されているアプリケーション固有のパラメータを探します。 また、それらがない場合には、この形式の最も近い下位バージョンになります。

> [!NOTE]
> アプリケーション固有のパラメータは、現在の法人の範囲内でのみ再利用できます。
>
> 同じ形式の下位バージョンで構成されたアプリケーション固有のパラメータを再利用しようとしている ER 形式の上位バージョンを実行したときに、上位形式のバージョンの **ルックアップ** タイプの少なくとも 1 つのデータソースの構造が変更されていると、実行時にエラーが表示されます。

## <a name="relationship-between-application-specific-parameters-and-an-er-format"></a>アプリケーション固有のパラメーターと ER 形式間の関係

ER 形式とアプリケーション固有のパラメーター間の関係は、ER 形式のインスタンスに依存しない固有の ID コードによって確立されます。 したがって、ER 形式を Finance から削除する場合、ER 形式に対してコンフィギュレーションされるアプリケーション固有のパラメーターは Finance の現在のインスタンスに保持されます。 基本となる ER 形式が Finance のこのインスタンスに再インポートされると、いつでもアクセスできます。

## <a name="access-application-specific-parameters-by-using-the-er-framework"></a>ER フレームワークを使用してアプリケーション固有のパラメーターにアクセスする

前の例では、ER フレームワークを使用して ER 形式のアプリケーション固有のパラメーターにアクセスできました。 この方法では、特定の ER 形式のアプリケーション固有のパラメーターへのアクセスを制限することはできません。 制限を適用する必要がある場合は、次の手順を実行します。 

1. 既存の **ERSolutionAppSpecificParametersDesigner** メニュー項目を再利用するか、または独自の **ERSolutionAppSpecificParametersDesigner** メニュー項目を実装します。

    ![ERSolutionAppSpecificParametersDesigner のメニュー項目表示。](./media/GER-AppSpecParms-LookupForm-Access1.PNG)

2. 次の手順のいずれかを実行します。

    1. 新しいメニュー項目ボタンを作成し、**データ ソース** プロパティを **ERSolutionTable** に設定することにより **ERSolutionTable** テーブルから対応するレコードにリンクします。

        ![新しいメニュー項目の設定が表示されます。](./media/GER-AppSpecParms-LookupForm-Access2.PNG)

    2. 簡易ボタンを作成し、次の例に示すように **クリック済** メソッドを上書きします。

        この方法を使用すると、一意のソリューション ID (**GUID** 値で定義された) を指定して、特定の ER 形式とそれから派生した子孫コピーのみのアプリケーション固有のパラメーターへのアクセスを許可できます。
        
        ```xpp
        public void clicked()
            {
                super();

                ERSolutionTable solutionTableRecord = ERSolutionTable::findByGUID(str2Guid('ADACCB2F-EFD1-4C90-877D-7E1E5D1AEE92'));

                Args args = new Args();
                args.record(solutionTableRecord);
                args.caller(this);

                new MenuFunction(menuItemDisplayStr(ERSolutionAppSpecificParametersDesigner), MenuItemType::Display)
                    .run(args);
            }
        ```

## <a name="additional-resources"></a>追加リソース

[電子申告のフォーミュラ デザイナー](general-electronic-reporting-formula-designer.md)

[法人ごとに指定されたパラメーターを使用するよう ER 形式を構成する](er-app-specific-parameters-configure-format.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
