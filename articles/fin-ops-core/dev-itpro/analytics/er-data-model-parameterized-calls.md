---
title: ER データ モデルのパラメーター化された呼び出しへの対応
description: この記事では、電子レポート (ER) データ モデルのパラメータ化された呼び出しを実装する方法について説明します。
author: kfend
ms.date: 03/14/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.region: Global
ms.author: filatovm
ms.search.validFrom: 2020-10-01
ms.dyn365.ops.version: 10.0.15
ms.custom: ''
ms.assetid: ''
ms.search.form: ERModelMappingDesigner, EROperationDesigner, ERExpressionDesignerFormula, ERDataModelDesigner
ms.openlocfilehash: 5be189c19d963991ec012de189bbf7b721b88fef
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2022
ms.locfileid: "9275991"
---
# <a name="support-parameterized-calls-of-er-data-models"></a>ER データ モデルのパラメーター化された呼び出しへの対応

[!include [banner](../includes/banner.md)]

ビジネス ドキュメントを生成するために、以下の ER コンポーネントを含む [電子レポート (ER)](general-electronic-reporting.md) ソリューションを構成する。

- **[形式](er-overview-components.md#format-component)** - このコンポーネントは、ビジネス ドキュメントの構造を指定します。
- **形式マッピング** - このコンポーネントは、実行時にビジネス ドキュメントがどのように入力されるのを制御します。
- **[モデル マッピング](er-overview-components.md#model-mapping-component)** :- このコンポーネントは、データがアプリケーションから形式マッピングにどのような機能を引き込むかを指定します。
- **[データ モデル :](er-overview-components.md#data-model-component)** このコンポーネントは、個々のコンポーネント間で情報を渡します。

ER 形式を実行すると、ルート形式要素から始まるすべての書式設定要素が実行されます。 実行される形式要素が[データソース](general-electronic-reporting.md#configuring-data-model-mappings-for-outgoing-documents)へのバインドを含む場合は常に、データソースは期待されるデータを配信し、それを使用して形式要素を埋めるために実行されます。 *モデル* タイプのデータソースが呼び出されると、モデル マッピングの設定に基づき、適切なモデル マッピングが呼び出され、アプリケーションからデータが取り出されます。

以前は、これらのモデル マッピングの呼び出しをパラメータ化して、実行されるフォーマットのロジックに依存させることができませんでした。 サポートされたのは、次のデータ フローのみです。

<table>
<tbody>
<tr align="center">
<td>
<b>形式</b><br>
形式&nbsp;要素<br>
&nbsp;
</td>
<td>
<i>バインディング</i><br>
&gt;&nbsp;request&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;&lt;
</td>
<td><b>フォーマット&nbsp;マッピング</b><br>
データ ソース<br>
&nbsp;
</td>
<td>
<i>データ&nbsp;モデル</i><br>
&gt;&nbsp;request&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;&lt;
</td>
<td>
<b>モデル&nbsp;マッピング</b><br>
データ&nbsp;ソース<br>
&nbsp;
</td>
<td>
<i>バインディング</i><br>
&gt;&nbsp;request&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;&lt;
</td>
<td>
<b>テーブル</b><br>
レコード<br>
フィールド
</td>
</tr>
</tbody>
</table>

ただし、バージョン 10.0.15 以降では、設定したパラメータの値が提供されたときのみ呼び出すことができるデータ モデル フィールドを設定することができます。 このようなフィールドが構成され、形式コンポーネントから呼び出される場合、必要なパラメータは，呼び出しの引数として、形式バインドで指定する必要があります。 これらの場合、引数の値は形式固有の値に基づいて指定できます。 したがって、データ モデルの呼び出しに **動的なランタイム パラメトリゼーション** を使用することで、以下のようなデータフローをサポートすることができます。

<table>
<tbody>
<tr align="center">
<td>
<b>形式</b><br>
形式&nbsp;要素&nbsp;1<br>
<br>
形式&nbsp;要素&nbsp;2<br>
&nbsp;<br>
&nbsp;
</td>
<td>
<i>バインディング</i><br>
&gt;&nbsp;申請&nbsp;1&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;1&nbsp;&lt;<br>
&gt;&nbsp;申請&nbsp;2&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;3&nbsp;&lt;<br>
&nbsp;
</td>
<td>
<b>フォーマット&nbsp;マッピング</b><br>
データ&nbsp;ソース&nbsp;1<br>
&nbsp;<br>
<b>value2=Func(value1)</b><br>
&nbsp;<br>
&nbsp;
</td>
<td>
<i>データ&nbsp;モデル</i><br>
&gt;&nbsp;フィールド 1&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;1&nbsp;&lt;<br>
<b>&gt;&nbsp;field2(value2)&nbsp;&gt;</b><br>
&lt;&nbsp;値&nbsp;3&nbsp;&lt;<br>
&nbsp;
</td>
<td>
<b>モデル&nbsp;マッピング</b><br>
データ&nbsp;ソース&nbsp;1<br>
<br>
データ&nbsp;ソース&nbsp;2<br>
&nbsp;<br>
&nbsp;
</td>
<td>
<i>バインディング</i><br>
&gt;&nbsp;申請&nbsp;1&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;1&nbsp;&lt;<br>
&gt;&nbsp;申請&nbsp;2&nbsp;&gt;<br>
&lt;&nbsp;値&nbsp;3&nbsp;&lt;<br>
&nbsp;
</td>
<td>
<b>テーブル&nbsp;1</b><br>
レコード&nbsp;1<br>
フィールド&nbsp;1<br>
<b>テーブル&nbsp;2</b><br>
レコード&nbsp;2<br>
フィールド&nbsp;2
</td>
</tr>
</tbody>
</table>

新機能では、[*レコード*](er-formula-supported-data-types-composite.md#record)または [*レコード リスト*](er-formula-supported-data-types-composite.md#record-list)型の任意のデータ モデル フィールドの呼び出しをパラメトリックにすることができます。 データ モデル フィールドのパラメータは、以下のデータ型をサポートしています。

- [ブール値](er-formula-supported-data-types-primitive.md#boolean)
- [コンテナ](er-formula-supported-data-types-composite.md#container)
- [日](er-formula-supported-data-types-primitive.md#date)
- [DateTime](er-formula-supported-data-types-primitive.md#datetime)
- [GUID](er-formula-supported-data-types-primitive.md#guid)
- [Int64](er-formula-supported-data-types-primitive.md#int64)
- [整数](er-formula-supported-data-types-primitive.md#integer)
- [実績](er-formula-supported-data-types-primitive.md#real)
- [文字列](er-formula-supported-data-types-primitive.md#string)

引数が定義されたデータ型の単一の値として提供できるデータ モデル フィールドのすべてのパラメータと、そのような値の [*リスト*](er-formula-supported-data-types-composite.md#record-list)を指定することができます。

> [!NOTE]
> データ モデル フィールドのパラメータの既定値はサポートされていません。 データ モデルのフィールドにパラメータを追加する場合、そのデータモデルのバージョンがすでにリリースされ公開されている場合は、このデータモデルの変更は下位互換性がないため、対応するすべてのモデルのマッピング形式をこのモデルの新しいバージョンに[リベース](general-electronic-reporting.md#upgrading-a-format-selecting-a-new-version-of-base-format-rebase)する必要があります。

パラメータ化されたデータ モデル フィールドを設定することで、モデル マッピングの呼び出しを形式固有にすることができます。 この方法は、1 つのデータモデルの多くの形式に対して構成する必要があるモデル マッピングの数を減らすのに役立ちます。 また、この手法を用いることで、形式の実行性能を向上させ、ビジネス ドキュメントの生成に要する時間を短縮することができます。 この機能の詳細を知るには、この記事の例を実行します。

## <a name="example-use-parameterized-calls-of-er-data-models"></a>例: ER データ モデルのパラメーター化された呼び出しへの対応

次の手順では、システム管理者または電子レポート開発者ロールのユーザーが、データ モデル、モデル マッピング、および呼び出しの引数 (実行形式の式を使用して実行時に計算された値) を指定してモデル マッピングを形式から呼び出するように構成されたERコンポーネントを含むERソリューションを設計する方法について説明します。 

これらの設定を **DEMF** 社を使用して説明します。 コードを変更する必要はありません。 

この例では、サンプル会社 **Litware, Inc.** に必要な ER [構成](general-electronic-reporting.md#Configuration) を作成します。 **Litware, Inc.** (`http://www.litware.com`) サンプル会社の構成プロバイダーが ER フレームワークにリストされており、**有効** アクティブとマークされていることを確認します。 この構成プロバイダーがリストに表示されない場合、または **有効** としてマークされていない場合、[構成プロバイダーの作成および有効としてマーク付け](tasks/er-configuration-provider-mark-it-active-2016-11.md) の手順に従ってください。

### <a name="business-scenario"></a>ビジネス シナリオ

ER ソリューションには、監査用の電子ドキュメントを作成するための形式が含まれています。 この形式には、販売注文および購買注文に関連する税取引で、取引日や税額などの必要な詳細が含まれています。 新しい会計年度の時点で、このドキュメントの構造は変更されています。 現在、生成されたレポートに取引が表示されるすべての当事者 (顧客および仕入先) の詳細 (名前) を含む拡張ドキュメントを提出する必要があります。 したがって、この新しい要件に準拠したドキュメントを生成するように、ER ソリューションを修正する必要があります。

### <a name="configure-the-er-framework"></a>ER フレームワークを構成する

[ER フレームワークの構成](er-quick-start2-customize-report.md#ConfigureFramework)に記載の手順に従って、 ER パラメーターの最小限のセットを構成します。 新しい ER ソリューションを使用して ER モデル マッピングを設計する前に、この設定を完了する必要があります。

### <a name="design-a-domain-specific-data-model"></a>ドメイン固有のデータ モデルを設計する

必要なデータ モデル コンポーネントを含む新しい ER 構成を作成する必要があります。 このデータ モデルは、後に監査レポートを生成するための ER フォーマットを設計する際に、データ ソースとして使用される。

次の手順に従って、Microsoft が提供する XML ファイルから必要なデータ モデルをインポートします。

1. [サンプル監査 model.version.1.xml](https://download.microsoft.com/download/7/1/9/719b0132-fed7-4c73-8afa-90cac29c2fee/Sample-audit-model.version.1.xml) ファイルをダウンロードし、ご利用のコンピューターに保存してください。
2. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
3. **電子レポート** ワークスペースで、**レポートの構成** を選択します。
4. アクション ウィンドウの **構成** ページで、**交換** \> **XML ファイルを読込む** を選択します。
5. **参照** を選択し、**サンプル監査 model.version.1.xml** ファイルを検索して、選択します。
6. **OK** を選択し、構成をインポートします。

    ![構成ページのインポートされた ER データ モデル構成。](./media/er-data-model-parameterized-calls-imported-model.png)

次の図は、**データ モデル デザイナー** ページで設定されたデータ モデルの編集可能バージョンを示しています。

![データ モデル デザイナー ページ上の ER データ モデルの構造。](./media/er-data-model-parameterized-calls-model1.png)

現状では、必要な明細を持つ税取引のみを公開するモデルとなっています。

### <a name="design-a-model-mapping-for-the-configured-data-model"></a>構成済みのデータモデルで使用するモデル マッピングをデザインする

電子レポート開発者のロールにあるユーザーは、 サンプル倉庫データ モデルの モデル マッピング コンポーネントを含む、新たな ER 構成を作成する必要があります。 このコンポーネントは、Microsoft Dynamics 365 Finance に特化して構成されたデータモデルを実装しています。 構成済みのデータモデルの実行時にアプリケーション データの入力に使用する必要があるアプリケーション オブジェクトを指定するには、モデルマッピング コンポーネントを構成する必要があります。 このタスクを完了するには、財務における税ビジネス ドメインのデータ構造の実装方法について理解しておく必要があります。

次の手順に従って、Microsoft が提供する XML ファイルから必要なデータ モデル マッピングをインポートします。

1. [サンプル監査モデル mapping.version.1.1.xml](https://download.microsoft.com/download/c/0/3/c03a4673-b1b1-4ef8-96d0-bf96518be6e0/Sample-audit-model-mapping.version.1.1.xml) ファイルをダウンロードし、ご利用のコンピューターに保存してください。
2. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
3. **電子レポート** ワークスペースで、**レポートの構成** を選択します。
4. アクション ウィンドウの **構成** ページで、**交換** \> **XML ファイルを読込む** を選択します。
5. **参照する** を選択し、**サンプル監査モデル mapping.version.1.1.xml** ファイルを検索して、選択します。
6. **OK** を選択し、構成をインポートします。

    ![構成ページのインポートされた ER データ モデル構成。](./media/er-data-model-parameterized-calls-imported-mapping.png)

以下の画面は、**モデル マッピング デザイナー** のページ上で構成されたモデル マッピングの編集可能なバージョンを示して います。

![モデル マッピング デザイナー ページ上の ER モデル マッピングの構造。](./media/er-data-model-parameterized-calls-mapping1.png)

現在、モデル マッピングは、必要な詳細を持つ税務トランザクションを公開するように設計されています。 この情報は、設定された `TaxTrans` と `TaxTransFiltered` の ER データソースを使用して `TaxTrans` アプリケーションテーブルから取得されます。

### <a name="design-a-new-format"></a>新しい形式のデザイン

電子レポート機能コンサルタントのロールが付与されているユーザーは、フォーマット コンポーネントを含む新しい ER 構成を作成する必要があります。 生成されたレポートに、必要なすべての詳細が記載された税取引を記入するよう、形式コンポーネントを設定する必要があります。

次の手順に従って、Microsoft が提供する XML ファイルから必要な形式をインポートします。

1. [サンプル監査 format.version.1.1.xml](https://download.microsoft.com/download/e/b/7/eb7e126e-2bb3-4bbb-a735-ffd4c48920b1/Sample-audit-format.version.1.1.xml) ファイルをダウンロードし、ご利用のコンピューターに保存してください。
2. **組織管理** \> **ワークスペース** \> **電子申告** の順に移動します。
3. **電子レポート** ワークスペースで、**レポートの構成** を選択します。
4. アクション ウィンドウの **構成** ページで、**交換** \> **XML ファイルを読込む** を選択します。
5. **参照** を選択し、**サンプル監査 format.version.1.1.xml** ファイルを検索して、選択します。
6. **OK** を選択し、構成をインポートします。

    ![構成ページのインポートされた ER 形式構成。](./media/er-data-model-parameterized-calls-imported-format.png)

以下の画面は、**フォーマット デザイナー** ページ上で構成された形式の編集可能なバージョンを示しています。

![形式デザイナー ページで ER 形式の構造。](./media/er-data-model-parameterized-calls-format1.png)

ER 形式は、コンマ区切り値 (CSV) 形式でテキスト ファイルとしてレポートを生成するように構成されています。

### <a name="run-the-imported-format"></a>インポートされた ER 形式の実行

1. **構成** ページ で、**サンプル監査形式** の構成を選択し、アクション ウィンドウで **実行** を選択します。
2. **電気レポート パラメータ** ダイアログ ボックスの **含めるレコード** タブで、**フィルター** を選択します。
3. **PIV-110000004** 証票と **INV-10000001** 証票の税取引を選択する条件を指定します。
4. **OK** を選択します。
5. **OK** を選択します。
6. 選択した伝票の税金の取引が含まれる生成されたドキュメントを確認します。

    ![税トランザクションを含む生成されたドキュメントのプレビュー。](./media/er-data-model-parameterized-calls-output1.png)

### <a name="adjust-the-imported-er-solution"></a>インポートしたERソリューションの調整

新しい要件に従って、提出しなければならない書類には、取引が含まれる顧客および仕入先の名前が含まれている必要があります。 したがって、この新しい要件に準拠したドキュメントを生成するように、インポートした ER ソリューションを修正する必要があります。

インポートした ER コンポーネントに対して必要な変更をどのように実装するかを決定します。

これは、次のような変更を実装する方法です:

- データ モデルで、*文字列* 型の新しい `Transaction.Party.Name`データ モデル フィールドを 追加します。
- モデルマッピングで、利用可能なテーブル関係を使用して、`DirPartyTable` アプリケーション テーブルの関連レコードにアクセスし、そこから `Name` フィールドの値を取得することで、新しいデータ モデル フィールドのバインドを構成します。

この方法は機能しますが、`TaxTrans` はトランザクション テーブルであるため、大量のレコードを含む可能性があるため、SQL データベースでパフォーマンス上の問題が発生する可能性があります。 この場合、`DirPartyTable` への呼び出し回数が `TaxTrans` テーブルのレコード数と一致する必要があり、パフォーマンス上の問題が生じる可能性があります。

あるいは、以下のような修正を実施することも可能です:

- データ モデルに、新しい `Party` ルートと新しい `Party.Name` フィールドを追加します。
- モデル マッピングで、`TaxTrans` テーブルを起点として `DirPartyTable` アプリケーション テーブルの関連レコードにアクセスするテーブル関係で使用されるテーブルのすべてのレコードを結合する新しいデータ ソースを追加します。

この方法は機能しますが、メモリ消費の問題が発生する可能性があります。 データベースのパフォーマンスの問題を防ぐために、新しい[JOIN](er-join-data-sources.md)データソースをアプリケーションデ ータベースへの単一の SQL リクエストとして実行する場合でも、結果はアプリケーションサーバーのメモリにフェッチされる必要があります。 レコード数やフィールド数が非常に多くなるため、この方法ではメモリの消費が非常に大きくなる可能性があります。 メモリ不足による実行時の例外エラーが発生する可能性もあります。

実行中の形式が、生成されたレポートに表示されるすべての税トランザクションについて、顧客および仕入先の一意の識別コードをメモリ内に収集する場合に、修正を実装することができます。 一意のコードのみを保持すればよいため、最終的なコードのセットはメモリ消費量に影響を与えるほど大きくなりません。 次に、*モデル* タイプのデータ ソースの別の呼び出しの引数として、モデル マッピングにコード セットが渡されます。 この呼び出しに基づいて、モデル マッピングは新しい ER データソースを実行し、アプリケーション データベースに 1 つの SQL リクエストを行い、提供されたコード セットに提示されているコードを持つ当事者のレコードのみを `DirPartyTable` テーブルから取得します。

### <a name="adjust-the-imported-data-model"></a>インポートされたデータ モデルを調整する

1. **組織管理** \> **電子申告** \> **構成** の順に移動します。
2. **構成** ページで、ペインの左側の構成ツリーで、**サンプル監査モデル** を選択します。
3. **バージョン** クイック タブで、状態が **下書き** となっているバージョン **2** を選択します。
4. **コンポーネントのコンフィギュレーション** クイック タブを選択します。
5. **デザイナー** を選択すると、編集用のデータモデルが開きます。
6. **データ モデル** ページで、`Root` フィールドが選択されていることを確認し、**新規** を選択します。
7. ドロップダウン ダイアログ ボックスで、次の手順に従います。

    1. **新規ノードの形式** フィールド グループで、**有効なノードの子** オプションを選択します。
    2. **名前** フィールドに、**当事者** と入力します。
    3. **品目タイプ** フィールドで、**レコード リスト** を選択します。
    4. **追加** を選択して、新しいフィールドの追加を終了します。

8. `Root.Party` フィールドが選択されていることを確認し、**ノード** タブで **パラメーター** を選択します。
9. **パラメーター** ダイアログ ボックスで、以下の手順を実行します:

    1. **パラメーター** タブで、**新規** を選択します。
    2. **名前** フィールドに、**PartyRefRecId** と入力します。
    3. **タイプ** フィールドで、**Int64** を選択します。
    4. **リスト** チェック ボックスをオンにします。
    5. **OK** を選択してパラメーターの入力を完了します。

    > [!NOTE]
    > **PartyRefRecId** パラメーターに値が提供されたときに呼び出されるフィールドとして `Root.Party` データ モデル フィールドを構成しました。 この値は、*Int64* データ型の `Value` フィールドを含むレコードのリスト中に存在する必要があります。

    ![パラメーター - ダイアログ ボックス。](./media/er-data-model-parameterized-calls-model2a.png)

10. `Root.Party` フィールドが選択されたままであることを確認し、 **新規** を選択します。
11. ドロップダウン ダイアログ ボックスで、次の手順に従います。

    1. **新規ノードの形式** フィールド グループで、**有効なノードの子** オプションを選択します。
    2. **名前** フィールドに、**Name** と入力します。
    3. **品目タイプ** フィールドで、**文字列** を選択します。
    4. **追加** を選択して、新しいフィールドの追加を終了します。

12. **保存** を選択し、**データ モデル** ページを閉じます。

    ![データ モデル デザイナー ページ上の調整された ER データ モデルの構造。](./media/er-data-model-parameterized-calls-model2b.png)

13. **バージョン** クイックタブ のバージョン **2** で、**ステータスの変更** \> **完了** を選択します。 その後、**OK** を選択します。

    > [!NOTE]
    > データ モデルの変更は、**サンプル 監査モデル** ER 構成の 2 番目のバージョンにある **サンプル 監査モデル** データ モデル コンポーネントの 2 番目のリビジョンに保存されます。

![構成ページの更新された ER データ モデル構成。](./media/er-data-model-parameterized-calls-updated-model.png)

### <a name="adjust-the-imported-model-mapping"></a>インポートされたモデル マッピングを調整する

1. **構成** ページで、ペインの左側の構成ツリーで、**サンプル監査モデル** を展開します。
2. **監査モデル マッピングのサンプル** を選択し、**バージョン** クイック タブ で、最初のデータモデル バージョン (バージョン **1.2**) に基づく、ステータスが **下書き** である 2 番目のマッピング バージョンを選択します。
3. **リベース** を選択します。
4. **ターゲットバージョン** フィールドは、**サンプル監査モデル** のバージョン **2** のままにしておきます。
5. **OK** を 選択すると、モデルのマッピングが最新のデータ モデル変更に合わせて調整されます。

    編集可能なモデル マッピングのバージョン番号が **1.2** から **2.2** に変更され、2 番目のモデルのバージョンが現在ベースとして使用されていることを示します。

6. **デザイナー** をクリックします。
7. **モデルからデータソースへのマッピング** ページで、現在のモデルのマッピングに **デザイナー** を選択します。
8. 以下の手順に従って、 `DirPartyTable` アプリケーション テーブルにアクセスするための新しいデータ ソースを追加します。

    1. **データ ソース タイプ** ペインで、**Dynamics 365 for Operations \> テーブル レコード** を選択します。
    2. **データ ソース** ペインで、**ルートの追加** を選択します。
    3. **名前** フィールドに、**PartyTable** と入力します。
    4. **テーブル** フィールドに、**DirPartyTable** と入力します。
    5. **OK** を選択し、新しいデータ ソースの追加を終了します。

9. 次の手順に従って、指定されたレコード ID `DirPartyTable`コードの一覧に基づいて、レコードを要求するための新しいデータ ソースを追加します。

    1. **データソース型** ペインで、**全般 \> 空のコンテナ** を選択します。
    2. **データ ソース** ペインで、**ルートの追加** を選択します。
    3. **名前** フィールドに、**Data** と入力します。
    4. **OK** を選択し、新しいデータ ソースの追加を終了します。
    5. **データ ソース** ペインで、**Data** データ ソースを選択します。
    6. **データ ソース型** ペインで、 **Functions \> 計算フィールド** を選択します。
    7. **データ ソース** ペインで、**追加** を選択します。
    8. **名前** フィールドに、**DirParty** と入力します。
    9. **式の編集** を選択します。
    10. **式デザイナー** ページで、**パラメーター** を選択します。
    11. **パラメーター** ダイアログ ボックスで、以下の手順を実行します:

        1. **パラメーター** タブで、**新規** を選択します。
        2. **名前** フィールドに、**DirPartyId** と入力します。
        3. **タイプ** フィールドで、**Int64** を選択します。
        4. **リスト** チェック ボックスをオンにします。
        5. **OK** を選択します。

        > [!NOTE]
        > この計算フィールドは、*Int64* 型の `Value` フィールドを 1 つ持つレコードリストとして構成された 1 つのパラメーターを、実行時に受け入れるように構成されています。

    12. **式** フィールドで、次の式を入力します。

        `FILTER(PartyTable, VALUEINLARGE(PartyTable.RecId, DirPartyId, DirPartyId.Value))`

        > [!NOTE]
        > `DirParty` フィールドの呼び出し時に引数として渡される `DirPartyId` リストにレコード識別コードが含まれている `DirPartyTable` レコードのみを取得するように `DirParty` 計算フィールドを構成しました。

        ![式デザイナー ページで、アプリケーション テーブルからパーティ名を取得するための式です。](./media/er-data-model-parameterized-calls-formula1.png)

    13. **保存** を選択し、**フォーミュラ デザイナー** ページを閉じます。
    14. **保存** を選択し、**OK** を選択して新しいデータ ソースの追加を完了します。

10. 以下の手順に従って、新しいデータ ソースを新しいデータ モデル フィールドにバインドし、データ モデルが当事者名を公開するために使用されるようにします。

    1. **データ モデル** ペインで、`Root.Party` データモデル フィールドを選択します。
    2. **データ モデル** ペインで、**編集** を選択します。
    3. **式デザイナー** ページの **式** フィールドに、式 `Data.DirParty(PartyRefRecId)` を入力します。
    4. **保存** を選択し、**フォーミュラ デザイナー** ページを閉じます。

        > [!NOTE]
        > 構成された `Data.DirParty` データ ソースを呼び出し、`Root.Party` データモデル フィールドが呼び出されたときに形式で指定されるレコード識別コードのリストを提供するようにバインドを構成しました。

    5. **データ モデル** ペインで、`Root.Party.Name` データモデル フィールドを選択します。
    6. **データ モデル** ペインで、**編集** を選択します。
    7. **式デザイナー** ページの **データ ソース** ペインで、**データ \> DirParty** を展開し、**名前** を選択します。
    8. **データソースの追加** を選択します。
    9. **保存** を選択し、**フォーミュラ デザイナー** ページを閉じます。

    ![モデル マッピング デザイナー ページ上の調整された ER モデル マッピングの構造。](./media/er-data-model-parameterized-calls-mapping2.png)

11. **保存** を選択し、**モデル マッピング デザイナー** ページを閉じます。
12. **モデルからデータ ソースへのマッピング** ページを閉じます。
13. **バージョン** クイックタブ のバージョン **2.2** で、**状態の変更 \> 完了** を選択します。 その後、**OK** を選択します。

### <a name="adjust-the-imported-format"></a>インポートされた形式を調整する

1. **構成** ページで、**サンプル監査形式** を選択します。
2. **バージョン** クイック タブで、状態が **下書き** となっているバージョン **1.2** を選択します。
3. **リベース** を選択します。
4. **ターゲットバージョン** フィールドは、**サンプル監査モデル** のバージョン **2** のままにしておきます。
5. **OK** を選択してリベースし、最新のデータモデルの変更に対応した形式に調整します。
6. **デザイナー** をクリックします。
7. **フォーマット デザイナー** ページの左ペインのフォーマット構成ツリーで、**展開/折りたたみ** を選択します。
8. 以下の手順で新しい形式の要素を追加し、生成されたレポートに取引が表示される当事者のレコード識別コードを収集します。

    1. 形式構造ツリーで、**Report.Row.Trans** シーケンス 要素を選択します。
    2. **追加** を選択します。
    3. **追加** ダイアログ ボックスで、**データソース \> 項目** を選択します。
    4. **コンポーネント プロパティ** ダイアログ ボックスの、**名前** フィールドで、**Id** を入力します。
    5. **データ タイプ** フィールドで、**Int64** を選択します。
    6. **OK** を選択します。

    > [!NOTE]
    > **データソース \> 項目** 要素は，実行形式の範囲内でのみ，内部計算やデータ変換を行うことができます。 したがって、この形式要素を追加することで、生成されるドキュメントの内容は変更されません。

9. 生成されるレポートに当事者名を入力するには、次の手順に従って新しい形式要素を追加します:

    1. **Report.Row** のシーケンス要素を選択します。
    2. **追加** を選択します。
    3. **追加** ダイアログ ボックスで、**テキスト \> シーケンス** を選択します。
    4. **コンポーネント プロパティ** ダイアログ ボックスの、**名前** フィールドで、**当事者** を入力します。
    5. **OK** を選択します。
    6. **Report.Row.Party** のシーケンス要素を選択します。
    7. **追加** を選択します。
    8. **追加** ダイアログ ボックスで、**テキスト \> 文字列** を選択します。
    9. **コンポーネント プロパティ** ダイアログ ボックスの、**名前** フィールドで、**Name** を入力します。
    10. **OK** を選択します。

10. 以下の手順に従って、生成されたレポートに取引が表示される当事者のレコード識別コードを収集する新しいデータ ソースを追加します:

    1. **マッピング** タブで、**ルートの追加** を選択します。
    2. **データ ソースの追加** ダイアログ ボックスで、**機能 \> データ収集** を選択します。
    3. **'データ収集' データ ソース プロパティ** のダイアログ ボックスの **名前** フィールドに、**PartyIds** と入力します。
    4. **項目タイプ** フィールドで、**Int64** を選択します。
    5. **OK** を選択します。

11. 以下の手順に従って、生成されたレポートに取引が表示される当事者のレコード識別コードを収集する新しいバインドを追加します:

    1. 形式構造ツリーで、**Report.Row.Trans.Id** データ 項目要素を選択します。
    2. **式の編集** を選択します。
    3. **フォーミュラ デザイナー** のページで、式 `PartyIds.Collect(model.Transaction.Party.RecId)` を入力します。
    4. **保存** を選択し、**フォーミュラ デザイナー** ページを閉じます。

12. 生成されるレポートに当事者名を入力するには、次の手順に従って新しいバインドを追加します:

    1. 形式構造ツリーで、**Report.Party** シーケンス 要素を選択します。
    2. **式の編集** を選択します。
    3. **フォーミュラ デザイナー** のページで、式 `model.Party(PartyIds.Result)` を入力します。
    4. **保存** を選択し、**フォーミュラ デザイナー** ページを閉じます。
    5. 形式構造ツリーで、**Report.Party.Name** シーケンス 要素を選択します。
    6. **マッピング** タブで、`model.Party.Name` データ モデル フィールドを選択します。
    7. **バインド** を選択します。

    ![形式デザイナー ページで調整した ER 形式の構造。](./media/er-data-model-parameterized-calls-format2.png)

13. **保存** を選択し、**形式デザイナー** ページを閉じます。
14. **モデルからデータ ソースへのマッピング** ページを閉じます。
15. **バージョン** クイックタブ のバージョン **2.2** で、**ステータスの変更** \> **完了** を選択します。 その後、**OK** を選択します。

### <a name="run-the-adjusted-format"></a>調整された ER 形式の実行

1. **構成** ページ で、**サンプル監査形式** を選択し、アクション ウィンドウで **実行** を選択します。
2. **電気レポート パラメータ** ダイアログ ボックスの **含めるレコード** タブで、**フィルター** を選択します。
3. **PIV-110000004** 証票と **INV-10000001** 証票の税取引を選択する条件を指定します。
4. **OK** を選択します。
5. **OK** を選択します。
6. 選択した伝票の税取引と、対応する顧客名と業者名を含む生成されたドキュメントを確認します。

    ![税取引や当事者名を含む生成されたドキュメントのプレビュー。](./media/er-data-model-parameterized-calls-output2.png)

7. **買掛金勘定** \> **仕入先** \> **すべての仕入先** に移動し、仕入先名を含む、選択した **PIV-110000004** 証票の詳細を確認します。

    ![すべての仕入先および請求仕訳帳ページで、購買伝票の詳細を確認します。](./media/er-data-model-parameterized-calls-review1.gif)

8. **売掛金勘定** \> **顧客** \> **すべての顧客** に移動し、仕入先名を含む、選択した **INV-10000001** 証票の詳細を確認します。

    ![すべての顧客および転記された売上税ページで販売伝票の詳細を確認します。](./media/er-data-model-parameterized-calls-review2.gif)

ER ソリューションのこの実行の詳細については、ER ビルトイン[パフォーマンス トレース](trace-execution-er-troubleshoot-perf.md) パーサーを使用してください。

## <a name="additional-resources"></a>追加リソース

- [計算済みフィールド タイプの ER データ ソースの、パラメーター化された呼び出しをサポートする](er-calculated-field-type.md)
- [電子申告形式の実行をトレースしてパフォーマンスの問題をトラブルシューティング](trace-execution-er-troubleshoot-perf.md)
- [電子申告形式でのデータ収集データ ソースの使用](er-data-collection-data-sources.md)
- [ValueInLarge ER 関数](er-functions-logical-valueinlarge.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
