---
title: クックブックの照会
description: このトピックでは、LCS の [環境の監視] ページにある [SQL インサイト] タブの下の各クエリの詳細と、パフォーマンスの問題のトラブルシューティングを行うときにそれらを使う方法を示します。
author: meeramahabala
manager: AnnBe
ms.date: 10/02/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.scope: Operations
ms.custom: 267184
ms.assetid: eb056816-ccf4-43a5-aed3-cf72543353de
ms.search.region: Global
ms.author: meeram
ms.search.validFrom: 2016-11-30
ms.dyn365.ops.version: Version 1611
ms.openlocfilehash: a97d73f8e260054042faf6f740035446c4b4265f
ms.sourcegitcommit: 66eae22cd99e53fe8e4c6c94945ad8061b69a442
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2020
ms.locfileid: "3117406"
---
# <a name="query-cookbook"></a><span data-ttu-id="3130a-103">クックブックの照会</span><span class="sxs-lookup"><span data-stu-id="3130a-103">Query cookbook</span></span> 

[!include [banner](../includes/banner.md)]

<span data-ttu-id="3130a-104">このトピックでは、Lifecycle Services (LCS) の **環境の監視** ページにある **SQL インサイト** タブの下の各クエリの詳細と、パフォーマンスの問題のトラブルシューティングを行うときにそれらを使う方法を示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-104">This topic provides details on each query under the **SQL Insights** tab on the **Environment Monitoring** page in Lifecycle Services (LCS) and how they should be used when troubleshooting performance issues.</span></span> <span data-ttu-id="3130a-105">この機能の詳細については、[Lifecycle Services (LCS) でツールを使用したパフォーマンスのトラブルシューティング](performancetroubleshooting.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-105">For details about this feature, see [Performance troubleshooting using tools in Lifecycle Services (LCS)](performancetroubleshooting.md).</span></span>

## <a name="current-blocking"></a><span data-ttu-id="3130a-106">現在のブロック</span><span class="sxs-lookup"><span data-stu-id="3130a-106">Current blocking</span></span>

### <a name="description"></a><span data-ttu-id="3130a-107">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-107">Description</span></span>
<span data-ttu-id="3130a-108">現在ブロックされているクエリ、それらをブロックしている SPID、ブロックされている期間、待機しているリソースをリストします。</span><span class="sxs-lookup"><span data-stu-id="3130a-108">Lists any currently blocked queries, and also the SPID that is blocking them, how long they have been blocked, and what resource they are waiting on.</span></span> <span data-ttu-id="3130a-109">これは、同じ情報の一部のグラフィカルな概要を表示するブロック ツリーを表示するためのクエリと組み合わせて使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-109">This can be used in conjunction with the query to see the blocking tree, which provides a graphical overview of some of the same information.</span></span> <span data-ttu-id="3130a-110">正常なシステムでは単独でブロックするのが通常であり、過剰になったり、営業活動に悪影響を及ぼし始めたときのみ問題となります。</span><span class="sxs-lookup"><span data-stu-id="3130a-110">Blocking by itself is normal in a healthy system and is only a problem when it becomes excessive or starts degrading business activities.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-111">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-111">Next steps</span></span>
- <span data-ttu-id="3130a-112">どのプロセスがブロックされているかを決定し、どのプロセスがブロックしているかとその理由を判別します。</span><span class="sxs-lookup"><span data-stu-id="3130a-112">Determine which process is blocked, and which process is blocking it and why.</span></span>
- <span data-ttu-id="3130a-113">ブロックを解決するには、実行させて自然にクリアさせるか、リード ブロッカー プロセスを終了して作業をロールバックするかの 2 つのオプションのみです。</span><span class="sxs-lookup"><span data-stu-id="3130a-113">To resolve blocking, the only two options are to let it run and clear naturally, or to end the lead blocker process, which will roll back work.</span></span> <span data-ttu-id="3130a-114">一般に、リード ブロッカーは、自然にクリアすると思われない状況 (不適切なクエリ プランの場合など) や、重要なプロセスを実行できないためにすぐに完了する必要があるような状況でのみ終了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-114">Generally, the lead blocker should only end in situations where it is not believed that it will clear naturally (such as a bad query plan), or in situations where a critical process is unable to run and needs to be completed immediately.</span></span>
- <span data-ttu-id="3130a-115">将来同じブロックを避けるため、インデックスまたはプラン ガイドを使用したり、各種レコードでの操作中にプロセスが互いにブロックしている場合はロック エスカレーションおよびページ ロックを無効にできます。</span><span class="sxs-lookup"><span data-stu-id="3130a-115">To avoid the same blocking in the future, you can use indexes or plan guides, or disable lock escalation and page locks if processes are blocking each other while operating on different records.</span></span> <span data-ttu-id="3130a-116">プロセスが同じレコードで動作している場合、ブロックを回避するには、同時に同じレコード上で動作しないように、プロセスをリファクタリングまたは再スケジューリングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-116">If processes are operating on the same records, the only way to avoid blocking is by refactoring or rescheduling the processes so that they do not operate on the same records at the same time.</span></span>

## <a name="current-blocking-tree"></a><span data-ttu-id="3130a-117">現在のブロック ツリー</span><span class="sxs-lookup"><span data-stu-id="3130a-117">Current blocking tree</span></span>

### <a name="description"></a><span data-ttu-id="3130a-118">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-118">Description</span></span>
<span data-ttu-id="3130a-119">現在ブロックしているかブロックされている SPID およびステートメントのグラフィカル表示を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-119">Provides a graphical view of the SPIDs and statements that are currently causing blocking or being blocked.</span></span> <span data-ttu-id="3130a-120">これは、詳細な情報を表示するために現在のブロック クエリと組み合わせて使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-120">This can be used in conjunction with the current blocking query to see more detailed information.</span></span> <span data-ttu-id="3130a-121">正常なシステムでは単独でブロックするのが通常であり、過剰になったり、営業活動に悪影響を及ぼし始めたときのみ問題となります。</span><span class="sxs-lookup"><span data-stu-id="3130a-121">Blocking by itself is normal in a healthy system and is only a problem when it becomes excessive or starts degrading business activities.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-122">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-122">Next steps</span></span>
- <span data-ttu-id="3130a-123">どのプロセスがブロックされているかを決定し、どのプロセスがブロックしているかとその理由を判別します。</span><span class="sxs-lookup"><span data-stu-id="3130a-123">Determine which process is blocked, and which process is blocking it and why.</span></span>
- <span data-ttu-id="3130a-124">ブロックを解決するには、実行させて自然にクリアさせるか、リード ブロッカー プロセスを終了して作業をロールバックするかの 2 つのオプションのみです。</span><span class="sxs-lookup"><span data-stu-id="3130a-124">To resolve blocking, the only two options are to let it run and clear naturally, or to end the lead blocker process, which will roll back work.</span></span> <span data-ttu-id="3130a-125">一般に、リード ブロッカーは、自然にクリアしないと思われる状況 (不適切なクエリ プランの場合など) や、重要なプロセスを実行できないためにすぐに完了する必要があるような状況でのみ終了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-125">Generally, the lead blocker should only end in situations where it is believed that it will not clear naturally (such as a bad query plan), or in situations where a critical process is unable to run and needs to be completed immediately.</span></span>
- <span data-ttu-id="3130a-126">将来同じブロックを避けるため、インデックスまたはプラン ガイドを使用したり、各種レコードでの操作中にプロセスが互いにブロックしている場合はロック エスカレーションおよびページ ロックを無効にできます。</span><span class="sxs-lookup"><span data-stu-id="3130a-126">To avoid the same blocking in the future, you can use indexes or plan guides, or disable lock escalation and page locks, if processes processes are blocking each other while operating on different records.</span></span> <span data-ttu-id="3130a-127">プロセスが同じレコードで動作している場合、ブロックを回避するには、同時に同じレコード上で動作しないように、プロセスをリファクタリングまたは再スケジューリングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-127">If processes are operating on the same records, the only way to avoid blocking is by refactoring or rescheduling the processes so that they do not operate on the same records at the same time.</span></span>

## <a name="current-dtu"></a><span data-ttu-id="3130a-128">現在の DTU</span><span class="sxs-lookup"><span data-stu-id="3130a-128">Current DTU</span></span>

### <a name="description"></a><span data-ttu-id="3130a-129">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-129">Description</span></span>
<span data-ttu-id="3130a-130">コンポーネントごとの現在の DTU の詳細を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-130">Provides a detailed breakdown of the current DTU by component.</span></span> <span data-ttu-id="3130a-131">DTU は、合計 SQL 負荷のパーセンテージ測定であり、いずれかのサブコンポーネントの最大値として報告されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-131">DTU is a percentage measure of total SQL load and is reported as the maximum value of any of the subcomponents.</span></span> <span data-ttu-id="3130a-132">このクエリを使用して、高 DTU の原因となっているサブコンポーネントを決定します。</span><span class="sxs-lookup"><span data-stu-id="3130a-132">Use this query to determine which subcomponent is causing high DTU.</span></span> <span data-ttu-id="3130a-133">高い CPU は、多くの場合不適切なクエリ プランに関連しています。</span><span class="sxs-lookup"><span data-stu-id="3130a-133">High CPU is often related to bad query plans.</span></span> <span data-ttu-id="3130a-134">高いデータ入出力は、多くの場合、大規模なにインポートまたはエクスポートに関連しています。</span><span class="sxs-lookup"><span data-stu-id="3130a-134">High Data I/O is often related to large imports or exports.</span></span> <span data-ttu-id="3130a-135">高いログ書き込み率は、多くの場合、大量の中間レコードを変更するレポートなどのバルク プロセスに関連しています。</span><span class="sxs-lookup"><span data-stu-id="3130a-135">A high Log Write percentage is often related to bulk processes, such as reporting, which make changes to large numbers of intermediate records.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-136">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-136">Next steps</span></span>
- <span data-ttu-id="3130a-137">高い CPU の原因が高い DTU の場合、現在実行中のクエリまたは最後の 1 時間の最も高価なクエリを表示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-137">If high CPU is the cause of high DTU, view the currently running queries or most expensive queries for the last hour.</span></span> <span data-ttu-id="3130a-138">問題に対処するには、インデックスの追加、クエリの変更、または最後の手段としてクエリ プランの追加により、クエリ プランを改善します。</span><span class="sxs-lookup"><span data-stu-id="3130a-138">To address the issue, get better query plans by adding indexes, changing the query, or, as a last resort, adding plan guides.</span></span>
- <span data-ttu-id="3130a-139">多数のデータ入出力の原因が高い DTU の場合、現在実行中のクエリと現在のバッチ ジョブを調べ、何が大量のデータを書き込んでいる可能性があるかを判別してみます。</span><span class="sxs-lookup"><span data-stu-id="3130a-139">If high Data I/O is the cause of high DTU, look at currently running queries and also current batch jobs, and try to determine what might be writing large volumes of data.</span></span> <span data-ttu-id="3130a-140">営業時間外部に実行するようそれらのプロセスのスケジュール設定を検討してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-140">Consider scheduling those processes to run outside of business hours.</span></span>
- <span data-ttu-id="3130a-141">高いログ入出力の原因が高い DTU の場合、現在実行中のクエリと現在のバッチ ジョブを調べ、何が大量の即時処理を行っている可能性があるかを判別します。</span><span class="sxs-lookup"><span data-stu-id="3130a-141">If high Log I/O is the cause of high DTU, look at currently running queries and also current batch jobs to determine what might be doing large amounts of intermediate processing.</span></span> <span data-ttu-id="3130a-142">多くの場合、多数のログ入出力は、レポートなど、処理中に疑似一時テーブルとして実際に完全にログ記録されるテーブルを使用することで発生します。</span><span class="sxs-lookup"><span data-stu-id="3130a-142">Often, high Log I/O is caused by the use of real fully logged tables as pseudo-temp tables during processing, such as in reporting.</span></span> <span data-ttu-id="3130a-143">これらのプロセスを営業時間外に実行するか、プロセスを変更することによりこの問題を解決します。</span><span class="sxs-lookup"><span data-stu-id="3130a-143">Address this by running those processes outside of business hours or by changing the processes.</span></span>

## <a name="currently-running-queries"></a><span data-ttu-id="3130a-144">現在実行中のクエリ</span><span class="sxs-lookup"><span data-stu-id="3130a-144">Currently running queries</span></span>

### <a name="description"></a><span data-ttu-id="3130a-145">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-145">Description</span></span>
<span data-ttu-id="3130a-146">このデータベースで現在実行状態またはブロック状態のすべてのクエリのリストと、各クエリの合計実行および待機時間も提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-146">Provides a list of all queries that are currently in a state of being executed or blocked on this database, and also the total execution and wait times of each query.</span></span> <span data-ttu-id="3130a-147">実行時間が長く待機時間が短いクエリは多くの場合不適切なクエリ プランであることを示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-147">Queries that have high execution time and low wait time are often indicative of bad query plans.</span></span> <span data-ttu-id="3130a-148">待機時間が長くクエリと実行時間が短いクエリはブロックを示しています。</span><span class="sxs-lookup"><span data-stu-id="3130a-148">Queries with high wait time and low execution time are indicative of blocking.</span></span> <span data-ttu-id="3130a-149">比較的高速な操作が何回も実行されている場合、行でこのクエリを複数回実行し、実行時間が短い頻繁に発生するクエリを探すことで見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="3130a-149">If relatively fast operations are being run many times, sometimes they can be found by running this query multiple times in a row and looking for commonly occurring queries with fast execution time.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-150">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-150">Next steps</span></span>
- <span data-ttu-id="3130a-151">高い CPU 時間が見られる場合、クエリのクエリ プランを取得し、このクエリに使用されている他のクエリ プランの方が効率的かどうかも確認します。</span><span class="sxs-lookup"><span data-stu-id="3130a-151">If high CPU time is seen, get the query plan for the query, and also see whether other query plans that have been used for this query are more efficient.</span></span> <span data-ttu-id="3130a-152">新しいクエリ、クエリの変更、または最後の手段としてプラン ガイドを追加することにより、この問題に対処することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-152">Consider addressing the issues with a new index, with a change to the query, or, as a last resort, by adding a plan guide.</span></span>
- <span data-ttu-id="3130a-153">高い待機時間が見られる場合、現在のブロックおよび現在のブロック ツリーを表示してクエリがブロックされている理由を判断します。</span><span class="sxs-lookup"><span data-stu-id="3130a-153">If high wait time is seen, view the current blocking and current blocking tree to determine why the query is blocked.</span></span> <span data-ttu-id="3130a-154">これは、場合によっては、ロック エスカレーションまたはページ ロックを無効にすることで (これがブロックの原因の場合) 対処できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-154">This is occasionally addressed by disabling lock escalation or page locks if that is the cause of the blocking.</span></span> <span data-ttu-id="3130a-155">通常は、2 つのクエリにより同じレコードが同時に処理されないように、実行される作業を分割することにより対処されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-155">More often, it is addressed by segmenting the work that is being performed to ensure that the same record is not processed by two queries at the same time.</span></span>

## <a name="get-fragmentation-details"></a><span data-ttu-id="3130a-156">断片化の詳細の取得</span><span class="sxs-lookup"><span data-stu-id="3130a-156">Get fragmentation details</span></span>

### <a name="description"></a><span data-ttu-id="3130a-157">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-157">Description</span></span>
<span data-ttu-id="3130a-158">断片化は、レコードがページの内部に連続して格納されない場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="3130a-158">Fragmentation is when the records are not stored contiguously inside of the page.</span></span> <span data-ttu-id="3130a-159">テーブルに対して行われたデータ変更や、テーブルで定義されたインデックスにおこなわれたデータ変更を通じて発生した未使用のスペースがページ上のレコード間にある場合、これが SQL インデックスの断片化となります。</span><span class="sxs-lookup"><span data-stu-id="3130a-159">When there is unused space between records on a page, which occurs through data modification that is made against the table and to the indexes defined on the table, this is SQL index fragmentation.</span></span> <span data-ttu-id="3130a-160">Dynamics 365 Finance and Operations アプリでは、SSD によってサポートされている SQL Azure DB プレミアム SKU を使用します。</span><span class="sxs-lookup"><span data-stu-id="3130a-160">Dynamics 365 Finance and Operations apps use SQL Azure DB premium SKUs which are backed by SSDs.</span></span> <span data-ttu-id="3130a-161">これは、断片化により、SCSI ドライブを装備したデータベースと同じ問題は発生しませんが、パフォーマンスは低下する可能性があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="3130a-161">This means that the fragmentation does not cause the same level of issues as on a database that is backed by a SCSI drive, but it still it could cause slower performance.</span></span> <span data-ttu-id="3130a-162">断片化が増えると、この断片化したテーブルやインデックスを使用するクエリのパフォーマンスに影響を与える可能性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="3130a-162">With higher fragmentation, there is a higher chance that it could affect the performance of queries that use this fragmented table/index.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-163">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-163">Next steps</span></span>
- <span data-ttu-id="3130a-164">このクエリは、テーブルのリスト、断片化率を含むインデックス、インデックスの再構築またはインデックスの再編成の推奨事項を表示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-164">This query shows the list of tables, indexes with their fragmentation percentage, and a recommendation to either REBUILD the index or REORG the index.</span></span> <span data-ttu-id="3130a-165">インデックスを再構築または再編成すると、レコードが互いに並べてパッキングされ、その間にすきまが生じないようにされるため、断片化が軽減されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-165">When you rebuild or reorg an index it will pack the records next to each other and avoid gaps in between, thus reducing the fragmentation.</span></span>

## <a name="get-index-details"></a><span data-ttu-id="3130a-166">インデックスの詳細の取得</span><span class="sxs-lookup"><span data-stu-id="3130a-166">Get index details</span></span>

### <a name="description"></a><span data-ttu-id="3130a-167">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-167">Description</span></span>
<span data-ttu-id="3130a-168">特定のテーブルのすべてのインデックスに関する詳細を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-168">Provides details about all indexes on a given table.</span></span> <span data-ttu-id="3130a-169">通常、このクエリは、代わりに変更する必要がある既存のインデックスがないようにするため、新しいインデックスを追加する前に使用されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-169">This query is usually used before adding new indexes, to ensure there are no existing indexes that should be altered instead.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-170">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-170">Next steps</span></span>
- <span data-ttu-id="3130a-171">新しいインデックスを追加する場合は、代わりに調整する必要がある既存のインデックスがないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="3130a-171">If you are adding a new index, verify that there is not an existing index that should just be adjusted instead.</span></span> <span data-ttu-id="3130a-172">新しい各インデックスは、すべての書き込み操作でオーバーヘッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="3130a-172">Each new index adds overhead on all write operations.</span></span> <span data-ttu-id="3130a-173">したがって、新しいインデックスはあまり追加しないでください。</span><span class="sxs-lookup"><span data-stu-id="3130a-173">Therefore, new indexes should be added sparingly.</span></span>
- <span data-ttu-id="3130a-174">ページ ロックがサポートされている場合、既存のインデックスによりブロックが発生することがときどきあり、同時に実行されている大規模なプロセスは、プロセスごとのレコードを含むページをロックしています。</span><span class="sxs-lookup"><span data-stu-id="3130a-174">Existing indexes can occasionally cause blocking if they support page locks, and large processes running at the same time are locking pages that contain records for each process.</span></span> <span data-ttu-id="3130a-175">ページ ロックの無効化はあまり行わないでください。ページ ロックを活用している書き込み操作のパフォーマンスが低下する可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-175">Disabling page locks should also be done sparingly, because it will degrade write operations that would have benefitted from page locks.</span></span>

## <a name="get-lock-details"></a><span data-ttu-id="3130a-176">ロックの詳細の取得</span><span class="sxs-lookup"><span data-stu-id="3130a-176">Get lock details</span></span>

### <a name="description"></a><span data-ttu-id="3130a-177">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-177">Description</span></span>
<span data-ttu-id="3130a-178">特定の SPID によって保持されているすべてのロックの一覧を示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-178">Provides a list of all locks held by a given SPID.</span></span> <span data-ttu-id="3130a-179">これは、SPID がブロック チェーンの一部であることをブロック ツリーが示している場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="3130a-179">This is useful when a blocking tree shows that a SPID is part of a blocking chain.</span></span> <span data-ttu-id="3130a-180">場合によっては、このクエリによって、ページ ロックまたはロック エスカレーションがブロックの原因であることがわかります。</span><span class="sxs-lookup"><span data-stu-id="3130a-180">Sometimes, this query will reveal that page locks or lock escalation are the cause of the blocking.</span></span> <span data-ttu-id="3130a-181">それ以外の場合、このクエリは、保持されている特定のテーブル内のキーロックの数を調べるために便利です。</span><span class="sxs-lookup"><span data-stu-id="3130a-181">Other times this query is useful for seeing how many keylocks in given tables are being held.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-182">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-182">Next steps</span></span>
- <span data-ttu-id="3130a-183">ページ ロックまたはロック エスカレーションが問題の原因となっている場合、それらを無効にできます。</span><span class="sxs-lookup"><span data-stu-id="3130a-183">If page locks or lock escalation are causing issues, they can be disabled.</span></span> <span data-ttu-id="3130a-184">ただし、これは慎重に行う必要があります。高いパフォーマンスのためのロック エスカレーションおよびページ ロックが必要なことがあるためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-184">However, this should be done cautiously, because there are valid cases where lock escalation and page locks are needed for good performance.</span></span>
- <span data-ttu-id="3130a-185">SPID のロックの数が多い場合、1 つのトランザクション範囲内で処理されるデータの量を減らすことで、ロックの数が減るため、ブロックやデッドロックの可能性を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="3130a-185">If a SPID is just holding large numbers of locks, reducing the amount of data processed within one transactional scope can reduce the number of locks and therefore the chances of experiencing blocking and deadlocks.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-186">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-186">Parameters</span></span>
<span data-ttu-id="3130a-187">SPID は、現在実行中のクエリのリストまたは現在ブロック中のクエリのリストから取得できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-187">The SPID can be obtained either from the list of currently running queries or through the list of current blocking queries.</span></span> <span data-ttu-id="3130a-188">SPID に関する履歴情報はありません。SPID ID は、SPID が現在実行中のときのみ有効なためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-188">No historical information about SPIDs is available because the SPID ID is only valid while the SPID is currently being executed.</span></span>

## <a name="list-of-current-plan-guides"></a><span data-ttu-id="3130a-189">現在のプラン ガイドの一覧</span><span class="sxs-lookup"><span data-stu-id="3130a-189">List of current plan guides</span></span>

### <a name="description"></a><span data-ttu-id="3130a-190">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-190">Description</span></span>
<span data-ttu-id="3130a-191">データベースにインストールされているすべてのプラン ガイドの一覧を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-191">Provides a list of all plan guides currently installed in the database.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-192">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-192">Next steps</span></span>
- <span data-ttu-id="3130a-193">クエリ プラン XML で参照することで、クエリ プランがプラン ガイドに基づいて作成されたかどうかを判断することができます。</span><span class="sxs-lookup"><span data-stu-id="3130a-193">You can determine whether a query plan was created based on a plan guide by looking in the query plan XML.</span></span> <span data-ttu-id="3130a-194">プラン ガイドに基づいてプランが生成された場合、プラン ガイド名は XML ファイルで指定されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-194">If the plan was generated based on a plan guide, the plan guide name will be specified in the XML.</span></span>
- <span data-ttu-id="3130a-195">プラン ガイドがインストールされているが使用されていない場合、プラン ガイドの SQL ステートメントのテキスト パラメーター リストが実際のクエリと同じであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="3130a-195">If a plan guide is installed but is not being used, verify that the SQL statement text and parameter list for the plan guide are identical to the actual query.</span></span> <span data-ttu-id="3130a-196">違いがある場合 (空白だけでも)、プラン ガイドの使用が停止されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-196">Any differences, even in whitespace, will stop a plan guide from being used.</span></span>

## <a name="get-list-of-query-id39s"></a><span data-ttu-id="3130a-197">クエリ ID のリストの取得</span><span class="sxs-lookup"><span data-stu-id="3130a-197">Get list of query ID&#39;s</span></span>

### <a name="description"></a><span data-ttu-id="3130a-198">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-198">Description</span></span>
<span data-ttu-id="3130a-199">クエリ テキストが問題の原因となっているがわかっている場合、そのクエリのクエリ ID を検索するためにこのクエリを使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-199">If query text is known to be causing a problem, this query can be used to find the query ID for that query.</span></span> <span data-ttu-id="3130a-200">これは、SQL ステートメントがエラー メッセージ、トレース、またはテレメトリに表示されている場合に発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="3130a-200">This can occur if the SQL statement is showing up in an error message, in tracing, or in telemetry.</span></span> <span data-ttu-id="3130a-201">明細書のクエリ ID が見つかったら、クエリ プランの検索やプラン ガイドの適用などの他の操作で使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-201">After the query ID for the statement is found, it can be used for other operations, such as finding query plans or applying plan guides.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-202">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-202">Next steps</span></span>
- <span data-ttu-id="3130a-203">指定したステートメントのクエリ ID が検出されら、最適化できるようにそのクエリの以前のプランを探すために使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-203">After the query ID for a given statement is found, it can be used to find previous plans for that query so that it can be optimized.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-204">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-204">Parameters</span></span>
- <span data-ttu-id="3130a-205">&quot;%FROM GENERALJOURNALENTRY T1%&quot; など、クエリ ステートメントの部分文字列を指定します。</span><span class="sxs-lookup"><span data-stu-id="3130a-205">Provide a substring of the query statement, such as &quot;%FROM GENERALJOURNALENTRY T1%&quot;.</span></span>

## <a name="get-xml-for-a-given-plan-id"></a><span data-ttu-id="3130a-206">特定のプラン ID の XML の取得</span><span class="sxs-lookup"><span data-stu-id="3130a-206">Get XML for a given plan ID</span></span>

### <a name="description"></a><span data-ttu-id="3130a-207">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-207">Description</span></span>
<span data-ttu-id="3130a-208">これにより、特定のプラン ID の SQL プランが XML 形式で提供されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-208">This provides the SQL plan in XML format for a given plan ID.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-209">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-209">Next steps</span></span>
- <span data-ttu-id="3130a-210">XML を .sqlplan ファイルとして保存し、SQL Server Management Studio または他のプラン閲覧ツールで開きます。</span><span class="sxs-lookup"><span data-stu-id="3130a-210">Save the XML as a .sqlplan file, and open it in SQL Server Management Studio or other plan reading tools.</span></span> <span data-ttu-id="3130a-211">クエリ プランからは、インデックスの追加など、多くの場合に有益な最適化を見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="3130a-211">From the query plan, you can often find optimizations, such as index additions, that will be beneficial.</span></span>
- <span data-ttu-id="3130a-212">プランによりインデックスの推奨がリストされることがありますが、それらのインデックスを適用する場合に注意が必要になります。</span><span class="sxs-lookup"><span data-stu-id="3130a-212">The plan might have an index recommendation listed, but be cautious when applying those indexes.</span></span> <span data-ttu-id="3130a-213">SQL は、多くの場合、1 つのクエリを最適化するための過剰な数の列を持つインデックスを作成することを推奨します。これは、他のクエリまたはシステム全体に影響を及ぼすことがあります。</span><span class="sxs-lookup"><span data-stu-id="3130a-213">SQL will often recommend creating indexes with excessive numbers of columns to optimize a single query, which can have a negative impact on other queries or the system as a whole.</span></span> <span data-ttu-id="3130a-214">これらの推奨インデックスは、直接適用されるものとしてではなく、分析を開始するヒントとして表示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-214">View these recommended indexes as hints to begin analysis, not as something to be directly applied.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-215">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-215">Parameters</span></span>
- <span data-ttu-id="3130a-216">プラン ID は、現在実行中のクエリなど、さまざまなソースから入手できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-216">The plan ID can be obtained from a variety of sources, such as currently running queries.</span></span> <span data-ttu-id="3130a-217">クエリ ID のみ持つ場合、&quot;クエリのクエリ プランの一覧の取得&quot; を使って、クエリの使用されているプラン ID を調べます。</span><span class="sxs-lookup"><span data-stu-id="3130a-217">If you only have a query ID, you can use &quot;get a list of query plans for a query&quot; to figure out which plan IDs have been used for a query.</span></span>

## <a name="get-query-plan-and-execution-stats"></a><span data-ttu-id="3130a-218">クエリ プランと実行統計の取得</span><span class="sxs-lookup"><span data-stu-id="3130a-218">Get query plan and execution stats</span></span>

### <a name="description"></a><span data-ttu-id="3130a-219">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-219">Description</span></span>
<span data-ttu-id="3130a-220">特定のクエリのプランおよび実行統計の一覧を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-220">Provides a list of plans and execution statistics for a given query.</span></span> <span data-ttu-id="3130a-221">これは、クエリが、時間の経過と共にさまざまなパフォーマンスの特性を持つ複数のクエリ プランを取得しているかどうかを判断するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="3130a-221">This is useful for determining whether a query is obtaining multiple query plans with different performance characteristics over time.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-222">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-222">Next steps</span></span>
- <span data-ttu-id="3130a-223">クエリがパフォーマンス特性が大幅に異なる複数のクエリ プランを取得している場合は、何が異なっていて、他のものよりずっとよい理由を調べるために、まずプランを取得して分析します。</span><span class="sxs-lookup"><span data-stu-id="3130a-223">If a query is getting multiple query plans with vastly different performance characteristics, start by retrieving and analyzing the plans to determine what is different and why one is far better than others.</span></span>
- <span data-ttu-id="3130a-224">SQL で優れたクエリ プランを使用するには、最適なソリューションとして、インデックスの変更を行うかコードに直接クエリ ヒントを追加します。</span><span class="sxs-lookup"><span data-stu-id="3130a-224">In order for SQL to use a better query plan, the best solution is to make index changes or add query hints directly in code.</span></span>
- <span data-ttu-id="3130a-225">インデックスとクエリ ヒントが十分でない場合、最後の手段として、優れたプランが強制的に使用されるようにプラン ガイドを追加できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-225">If indexes and query hints are not enough, as a last resort, a plan guide can be added to force the better plans always to be used.</span></span> <span data-ttu-id="3130a-226">クエリ プランを使用するときは注意してください。クエリ プランは、パラメーター値によって高速であったり非常に低速であったりすることがあるためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-226">Be careful when using a plan guide, because sometimes a query plan is fast for some parameter values but overly slow for other parameter values.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-227">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-227">Parameters</span></span>
- <span data-ttu-id="3130a-228">**クエリ ID** は、現在実行中のクエリ、現在ブロック中のクエリ、最も高価なクエリ、およびステートメント テキストによるクエリなど、他の複数の工程から取得できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-228">The **query ID** can be obtained from multiple other operations, such as currently running queries, current blocking queries, most expensive queries, and query by statement text.</span></span>
- <span data-ttu-id="3130a-229">時間数単位の**時間間隔**は、多くの場合、前週のすべてのプランを示すために &quot;168&quot; として、前日のすべてのプランを示すために &quot;24&quot; として指定されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-229">The **time interval** in terms of hours will often be specified as &quot;168&quot; to show all plans for the last week or &quot;24&quot; to show all plans for the last day.</span></span> <span data-ttu-id="3130a-230">多くの場合、プランは 1 週間に複数回変更されますが、数日安定する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-230">Often, plans will change multiple times per week but might be stable for a few days.</span></span> <span data-ttu-id="3130a-231">そのため、ここでそれ以上の間隔を選択と多くの場合有利です。</span><span class="sxs-lookup"><span data-stu-id="3130a-231">Therefore, selecting larger intervals here is often advantageous.</span></span>

## <a name="get-wait-stats"></a><span data-ttu-id="3130a-232">待機統計の取得</span><span class="sxs-lookup"><span data-stu-id="3130a-232">Get wait stats</span></span>

### <a name="description"></a><span data-ttu-id="3130a-233">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-233">Description</span></span>
<span data-ttu-id="3130a-234">指定された時間範囲で待機した特定のクエリ プランについて説明します。</span><span class="sxs-lookup"><span data-stu-id="3130a-234">Provides information about what a given query plan has waited on in a given time range.</span></span> <span data-ttu-id="3130a-235">これは、定期的にクエリに予想より時間がかかり、CPU 時間であるかブロックであるかを判断できない場合に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="3130a-235">This is useful when a query regularly takes longer than it should, and you have been unable to determine whether it is CPU time or blocking.</span></span> <span data-ttu-id="3130a-236">同様に、ブロックが見られるが、その種類がわからない場合、これはその情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-236">Similarly, if you see blocking but need to know what kind it is, this will provide that information.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-237">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-237">Next steps</span></span>
- <span data-ttu-id="3130a-238">プランが主に CPU を待機している場合、プランは非効率的なだけではなく、インデックスまたはヒントを追加するか、クエリを再構築することで修正する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-238">If a plan is primarily waiting on CPU, the plan is just inefficient and needs to be fixed through the addition of indexes or hints, or by restructuring the query.</span></span>
- <span data-ttu-id="3130a-239">ロックを待機している場合、クエリでブロックが発生しています。</span><span class="sxs-lookup"><span data-stu-id="3130a-239">If it is waiting on lock, the query is experiencing blocking.</span></span> <span data-ttu-id="3130a-240">これは、ブロック ツリー クエリを通じてブロックがアクティブに発生していることを確認できるのでなければ、判断するのが困難です。</span><span class="sxs-lookup"><span data-stu-id="3130a-240">This is more difficult to determine unless you can see the blocking happening actively through the blocking tree query.</span></span> <span data-ttu-id="3130a-241">この場合は、次の手順で、編集されるレコードを評価し、同時に同じレコードを編集する他のプロセスを判断することを試みます。</span><span class="sxs-lookup"><span data-stu-id="3130a-241">In this case, the next step is to evaluate the records that are being edited and try to determine what other processes could be editing the same records at the same time.</span></span> <span data-ttu-id="3130a-242">多くの場合、同時に複数のスレッドで実行されている同じクエリが自分自身をブロックします。</span><span class="sxs-lookup"><span data-stu-id="3130a-242">Often, the same query running in multiple threads at the same time will block itself.</span></span>
- <span data-ttu-id="3130a-243">入出力またはラッチを待機している場合、大量のデータが転送されているか、多数の小規模トランザクションが発生していると考えられます。</span><span class="sxs-lookup"><span data-stu-id="3130a-243">If it is waiting on I/O or latch, there are likely either large volumes of data being transferred or large numbers of small transactions.</span></span> <span data-ttu-id="3130a-244">可能であれば、トランザクションごとに 1 つのレコードではなく小規模なバッチでの書き込みを実行します。</span><span class="sxs-lookup"><span data-stu-id="3130a-244">If possible, perform writes in small batches instead of just one record per transaction.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-245">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-245">Parameters</span></span>
- <span data-ttu-id="3130a-246">プラン ID は、さまざまなソース (現在実行中のクエリと最も高価なクエリを含む) から入手できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-246">The plan ID can be obtained from a variety of sources, including currently running queries and the most expensive queries.</span></span> <span data-ttu-id="3130a-247">クエリ ID がある場合、クエリを使ってそのクエリのプランのリストを取得することで、プラン ID を取得できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-247">If you have a query ID, you can get plan IDs by using the query to get a list of plans for that query.</span></span>
- <span data-ttu-id="3130a-248">原則的には、時間の範囲は問題が発生していた特定の時間を対象とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-248">Ideally, the time range should target a specific time when an issue was occurring.</span></span> <span data-ttu-id="3130a-249">たとえば、DTU が 1 時間高かった場合、その実行時間だけを対象にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-249">For instance, if DTU was high for an hour, you should target just that hour of execution.</span></span>

## <a name="list-most-expensive-queries"></a><span data-ttu-id="3130a-250">最も高価なクエリのリスト</span><span class="sxs-lookup"><span data-stu-id="3130a-250">List most expensive queries</span></span>

### <a name="description"></a><span data-ttu-id="3130a-251">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-251">Description</span></span>
<span data-ttu-id="3130a-252">指定された期間内の最も高価なクエリの一覧を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-252">Provides a list of the most expensive queries during the specified period.</span></span> <span data-ttu-id="3130a-253">最も高価なクエリを計算するときに考慮する必要がある属性の決定を提供することもできます。</span><span class="sxs-lookup"><span data-stu-id="3130a-253">The decision about which attribute should be considered when computing most expensive queries can also be provided.</span></span> <span data-ttu-id="3130a-254">これは、ある期間に高い DTU が見られる場合に、どのクエリが高い DTU の原因となっているかを調べるためによく使用されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-254">This is often used when high DTU is seen for a period, to determine which query is causing the high DTU.</span></span> <span data-ttu-id="3130a-255">このクエリを効果的に使用するため、処理されている DTU コンポーネントを決定するために重要です。</span><span class="sxs-lookup"><span data-stu-id="3130a-255">In order to use this query effectively, it is important to determine which DTU component is being addressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-256">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-256">Next steps</span></span>
- <span data-ttu-id="3130a-257">DTU 使用率が高い原因となっているクエリを見つけるため、合計 CPU により最も高価なクエリを表示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-257">View the most expensive queries by total CPU to find queries that are causing high DTU utilization.</span></span> <span data-ttu-id="3130a-258">通常、これらのクエリは、インデックス、クエリの変更、または、最後の手段としてプラン ガイドを通じて修正されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-258">These queries are usually fixed through indexes, query changes, or, as a last resort, plan guides.</span></span>
- <span data-ttu-id="3130a-259">ユーザー エクスペリエンスを遅くする可能性があるクエリを見つけるには、合計期間により最も高価なクエリを表示します。</span><span class="sxs-lookup"><span data-stu-id="3130a-259">View the most expensive queries by total duration to find queries that might be slowing down the user experience.</span></span> <span data-ttu-id="3130a-260">これらのクエリの合計 CPU も高い場合、クエリ プランを修正します。</span><span class="sxs-lookup"><span data-stu-id="3130a-260">If these queries also have high total CPU, fix the query plans.</span></span> <span data-ttu-id="3130a-261">CPU が低い場合、ブロックの結果の可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-261">If they have low CPU, it is likely the result of blocking.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-262">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-262">Parameters</span></span>
- <span data-ttu-id="3130a-263">現在 DTU が高いなど、現在発生している問題を調べている場合、時間数として &quot;0&quot; を指定します。</span><span class="sxs-lookup"><span data-stu-id="3130a-263">For the number of hours, specify &quot;0&quot; if you are looking at currently occurring issues, such as currently high DTU.</span></span> <span data-ttu-id="3130a-264">これは、現在の時間の結果を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-264">This will provide results for the current hour.</span></span> <span data-ttu-id="3130a-265">時間の経過と共に全体的に高い DTU を探している場合、最後の日として &quot;24&quot; を指定するか、最後の週として &quot;168&quot; を指定します。</span><span class="sxs-lookup"><span data-stu-id="3130a-265">If you are looking for generally high DTU over time, specify either &quot;24&quot; for the last day or &quot;168&quot; for the last week.</span></span>
- <span data-ttu-id="3130a-266">定期的なクエリの高い DTU の影響を見つけるには、順序として &quot;合計 CPU&quot; を選択します。</span><span class="sxs-lookup"><span data-stu-id="3130a-266">For the ordering, select &quot;total cpu&quot; to find high DTU impact for recurring queries.</span></span> <span data-ttu-id="3130a-267">頻繁に実行されるわけではないが低速な可能性があるクエリを見つけるには、&quot;平均期間&quot; を選択します。</span><span class="sxs-lookup"><span data-stu-id="3130a-267">Select &quot;average duration&quot; to find queries that are not run often but that might be slow.</span></span> <span data-ttu-id="3130a-268">ユーザーを遅くしている可能性がある定期的なクエリを検索するには、&quot;合計期間&quot; を選択します。</span><span class="sxs-lookup"><span data-stu-id="3130a-268">Select &quot;total duration&quot; to find recurring queries that might be slowing down users.</span></span>

## <a name="create-non-unique-index-on-table"></a><span data-ttu-id="3130a-269">テーブルでの一意ではないインデックスの作成</span><span class="sxs-lookup"><span data-stu-id="3130a-269">Create non-unique index on table</span></span>

### <a name="background"></a><span data-ttu-id="3130a-270">バックグラウンド</span><span class="sxs-lookup"><span data-stu-id="3130a-270">Background</span></span>
<span data-ttu-id="3130a-271">通常、標準メタデータ パッケージとデータベースの同期によって、インデックスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-271">Indexes should generally be created through the standard metadata package and database synchronization.</span></span> <span data-ttu-id="3130a-272">これにより、サンドボックスと PROD、およびその他の環境では、常に共通の定義が共有されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-272">This ensures that Sandbox and PROD, and any other environments, always share a common definition.</span></span> <span data-ttu-id="3130a-273">場合によっては、定期的な展開に時間がかかりすぎる継続的な停止や問題を軽減するために、実行時に新しい非固有のインデックスをインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-273">Occasionally, it is necessary to install a new non-unique index at runtime to mitigate an ongoing outage or issue where a regular deployment would take too long.</span></span> <span data-ttu-id="3130a-274">このアクションは、その非固有インデックスのインストールに使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-274">This action can be used to install that non-unique index.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-275">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-275">Next steps</span></span>
- <span data-ttu-id="3130a-276">作成するインデックスを指定したら、次のステップとして、その同じインデックス定義を次の利用可能な正式メタデータ リリースに移行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-276">After specifying the index to create, the next step should be to migrate that same index definition to the next available official metadata release.</span></span>
- <span data-ttu-id="3130a-277">一般に、重複するインデックスによって大きな問題が発生することはありません。</span><span class="sxs-lookup"><span data-stu-id="3130a-277">Duplicate indexes generally do not cause any noticeable issues.</span></span> <span data-ttu-id="3130a-278">したがって、正式インデックスが完全に展開されるまでは、手動で作成したインデックスをシステムに置いたままにします。</span><span class="sxs-lookup"><span data-stu-id="3130a-278">Therefore, leave the manually created index in the system until after the official index has been completely rolled out.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-279">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-279">Parameters</span></span>
- <span data-ttu-id="3130a-280">インデックス名は、次の表の既存のインデックスにより現在使用されていない任意の一意の文字列です。</span><span class="sxs-lookup"><span data-stu-id="3130a-280">The index name is any unique string not currently in use by an existing index on this table.</span></span> <span data-ttu-id="3130a-281">識別しやすいように、インデックス名が形式 PERF\_IDX\_\&lt;tablename\&gt;\_\&lt;number\&gt; に従うことが推奨されますが、必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="3130a-281">For easy identification, it is recommended but not required that the index name follow the format PERF\_IDX\_\&lt;tablename\&gt;\_\&lt;number\&gt;.</span></span> <span data-ttu-id="3130a-282">たとえば、インデックスの名前は PERF\_IDX\_LEDGERJOURNALTRANS\_1 にしてください。</span><span class="sxs-lookup"><span data-stu-id="3130a-282">For instance, an index might be named PERF\_IDX\_LEDGERJOURNALTRANS\_1.</span></span>
- <span data-ttu-id="3130a-283">列パラメーターは、表示される順序で記載された物理的な列名のコンマ区切り一覧です。</span><span class="sxs-lookup"><span data-stu-id="3130a-283">The columns parameter is a comma-separated list of physical column names in the order that they should appear in.</span></span>
- <span data-ttu-id="3130a-284">含まれる列パラメーターは、表示される順序で記載された物理的な列名のコンマ区切り一覧です。</span><span class="sxs-lookup"><span data-stu-id="3130a-284">The included columns parameter is a comma-separated list of physical column names in the order that they should appear in.</span></span> <span data-ttu-id="3130a-285">含まれている列を指定する必要がない場合、このパラメーターを空白のままにします。</span><span class="sxs-lookup"><span data-stu-id="3130a-285">If no included columns must be specified, leave this parameter blank.</span></span>

## <a name="create-a-plan-guide-to-force-plan-id"></a><span data-ttu-id="3130a-286">プラン ID を強制するプラン ガイドの作成</span><span class="sxs-lookup"><span data-stu-id="3130a-286">Create a plan guide to force Plan ID</span></span>

### <a name="description"></a><span data-ttu-id="3130a-287">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-287">Description</span></span>
<span data-ttu-id="3130a-288">SQL では、統計の更新が実行されたときなど、プラン キャッシュがフラッシュされるたびに、新しいプランを再計算します。</span><span class="sxs-lookup"><span data-stu-id="3130a-288">SQL will recompute a new plan each time the plan cache is flushed, such as when an update of statistics runs.</span></span> <span data-ttu-id="3130a-289">選択されているプランは、そのクエリの最初の実行のパラメーターの &quot;スニッフィング&quot; に基づきます。</span><span class="sxs-lookup"><span data-stu-id="3130a-289">The plan that is chosen is based on &quot;sniffing&quot; the parameters of the first execution of that query.</span></span> <span data-ttu-id="3130a-290">その後、パラメータに関係なく同じプランが使用されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-290">After that, the same plan will be used, regardless of parameters.</span></span> <span data-ttu-id="3130a-291">このため、同じクエリが複数のプランを取得する場合があります。その一部は、特定のデータ配分のプランよりかなり悪くなります。</span><span class="sxs-lookup"><span data-stu-id="3130a-291">For this reason, the same query might sometimes get multiple plans, some of which are far worse than others for given data distributions.</span></span> <span data-ttu-id="3130a-292">このアクションは、スニッフィングされるパラメーターに関係なく、特定のプランを使用するよう SQL を強制するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-292">This action can be used to force SQL to use a specific plan, regardless of which parameters are sniffed.</span></span> <span data-ttu-id="3130a-293">このアクションは、実行されるデータベースにのみ適用されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-293">Note that this action applies only to the database that it is executed on.</span></span> <span data-ttu-id="3130a-294">したがって、開発環境と製造環境間を流れるインデックス、ヒント、またはコード変更の追加後に、最後の手段として使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-294">Therefore, it should be used as a last resort, after the addition of indexes, hints, or code changes that will flow between development and production environments.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-295">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-295">Next steps</span></span>
- <span data-ttu-id="3130a-296">特定のクエリ ID のプラン ID と実行統計のリストが見つかったら、各 ID の SQL プランをダウンロードして分析する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-296">After the list of plan IDs and execution statistics for a specific query ID are found, the SQL plan for each ID should be downloaded and analyzed.</span></span> <span data-ttu-id="3130a-297">最適なプランが決定されたら、パラメーターに関係なく、そのプランの使用を強制するためにこのスクリプトを使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-297">After the best plan is determined, this script can be used to force that plan to be used, regardless of parameters.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-298">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-298">Parameters</span></span>
- <span data-ttu-id="3130a-299">force\_plan\_id パラメーターは、今後使用するプランの ID です。</span><span class="sxs-lookup"><span data-stu-id="3130a-299">The force\_plan\_id parameter is the ID of the plan that should be used going forward.</span></span> <span data-ttu-id="3130a-300">これは、特定のクエリのすべてのプラン ID を取得するクエリから見つかります。</span><span class="sxs-lookup"><span data-stu-id="3130a-300">This can be found from the query to get all plan IDs for a given query.</span></span> <span data-ttu-id="3130a-301">強制するために、プランの XML が適切なプランであることを検証してください。不適切なプランを強制すると負の効果があるためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-301">Be sure to validate that the XML of the plan is a good plan before forcing, because forcing a bad plan can have negative effects.</span></span>
- <span data-ttu-id="3130a-302">名前パラメーターは、既存のプラン ガイドによって現在使用されていない一意の文字列です。</span><span class="sxs-lookup"><span data-stu-id="3130a-302">The name parameter is any unique string not currently used by an existing plan guide.</span></span>
- <span data-ttu-id="3130a-303">ステートメント パラメーターは、強制する SQL ステートメントです。</span><span class="sxs-lookup"><span data-stu-id="3130a-303">The statement parameter is the SQL statement that should be forced.</span></span> <span data-ttu-id="3130a-304">これは、他の多くのクエリ (現在実行中のクエリと最も高価なクエリを含む) から入手できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-304">This can be obtained from many other queries, including currently running queries and most expensive queries.</span></span> <span data-ttu-id="3130a-305">これが正確にコピーされるようにしてください (空白など)。空白に違いが発生すると、プラン ガイドが機能しないためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-305">Ensure that this is copied precisely, including whitespace, because differences in whitespace will cause the plan guide not to work.</span></span> <span data-ttu-id="3130a-306">さらに、このテキストにクエリのパラメーターを含めないでください。別個に指定されるためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-306">Also, do not include the parameters for the query in this text, because they are specified separately.</span></span> <span data-ttu-id="3130a-307">たとえば、選択クエリでは、ステートメントの最初の文字は必ず &quot;SELECT&quot; にしてください。</span><span class="sxs-lookup"><span data-stu-id="3130a-307">For instance, on a select query, the first characters of the statement should always be &quot;SELECT&quot;.</span></span>
- <span data-ttu-id="3130a-308">params パラメーターは、一連の @P1、@P2 などのようなクエリのパラメーターです。</span><span class="sxs-lookup"><span data-stu-id="3130a-308">The params parameter is the set of @P1, @P2, and so on, parameters for the query.</span></span> <span data-ttu-id="3130a-309">これらは、他のクエリ (現在実行中のクエリと最も高価なクエリを含む) から入手できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-309">These can be obtained from other queries, including currently running queries and most expensive queries.</span></span> <span data-ttu-id="3130a-310">パラメーターに貼り付ける場合、外部かっこを削除します。</span><span class="sxs-lookup"><span data-stu-id="3130a-310">When pasting in the parameters, remove the outer parenthesis.</span></span> <span data-ttu-id="3130a-311">たとえば、&quot;@P1 int、@P2 nvarchar(21)&quot; に貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="3130a-311">For instance, paste in &quot;@P1 int,@P2 nvarchar(21)&quot;.</span></span> <span data-ttu-id="3130a-312">クエリのパラメーターがない場合、この値を空白のままにします。</span><span class="sxs-lookup"><span data-stu-id="3130a-312">If there are no parameters for the query, leave this value blank.</span></span>

## <a name="create-a-plan-guide-to-add-table-hints"></a><span data-ttu-id="3130a-313">テーブル ヒントを追加するプラン ガイドの作成</span><span class="sxs-lookup"><span data-stu-id="3130a-313">Create a plan guide to add table hints</span></span>

### <a name="description"></a><span data-ttu-id="3130a-314">説明</span><span class="sxs-lookup"><span data-stu-id="3130a-314">Description</span></span>
<span data-ttu-id="3130a-315">SQL では、統計の更新が実行されたときなど、プラン キャッシュがフラッシュされるたびに、新しいプランを再計算します。</span><span class="sxs-lookup"><span data-stu-id="3130a-315">SQL will recompute a new plan each time the plan cache is flushed, such as when an update of statistics runs.</span></span> <span data-ttu-id="3130a-316">選択されているプランは、そのクエリの最初の実行のパラメーターの &quot;スニッフィング&quot; に基づきます。</span><span class="sxs-lookup"><span data-stu-id="3130a-316">The plan that is chosen is based on &quot;sniffing&quot; the parameters of the first execution of that query.</span></span> <span data-ttu-id="3130a-317">その後、パラメータに関係なく同じプランが使用されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-317">After that, the same plan will be used, regardless of parameters.</span></span> <span data-ttu-id="3130a-318">このため、同じクエリが複数のプランを取得する場合があります。その一部は、特定のデータ配分のプランよりかなり悪くなります。</span><span class="sxs-lookup"><span data-stu-id="3130a-318">For this reason, the same query might sometimes get multiple plans, some of which are far worse than others for given data distributions.</span></span> <span data-ttu-id="3130a-319">このアクションは、特定のヒントをクエリに追加するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-319">This action can be used to add specific hints to the query.</span></span> <span data-ttu-id="3130a-320">これは、プラン ガイドの強制とは異なります。SQL は引き続きパラメーター スニッフィングを実行し、場合によってはさまざまなプランを選択するためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-320">This is different than forcing a plan guide, because SQL will still perform parameter sniffing and occasionally select different plans.</span></span> <span data-ttu-id="3130a-321">ただし、クエリ ヒントはそのプランの計算に適用されます。</span><span class="sxs-lookup"><span data-stu-id="3130a-321">However, the query hints will be applied in those plan computations.</span></span> <span data-ttu-id="3130a-322">このアクションは、実行されるデータベースにのみ適用されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-322">Note that this action applies only to the database that it is executed on.</span></span> <span data-ttu-id="3130a-323">したがって、開発環境と製造環境間を流れるインデックス、ヒント、またはコード変更の追加後に、最後の手段として使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-323">Therefore, it should be used as a last resort, after the addition of indexes, hints, or code changes that will flow between development and production environments.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-324">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-324">Next steps</span></span>
- <span data-ttu-id="3130a-325">通常、特定のクエリの複数の異なるクエリ プランを検索した後クエリ ヒントが決まります。</span><span class="sxs-lookup"><span data-stu-id="3130a-325">Usually, query hints are determined after looking through multiple different query plans for a given query.</span></span> <span data-ttu-id="3130a-326">たとえば、テーブル上のインデックス シークのパフォーマンスが常にスキャンより高い場合、FORCESEEK ヒントを追加すると便利な場合があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-326">For example, if an index seek on a table always outperforms a scan, it might be beneficial to add a FORCESEEK hint.</span></span>
- <span data-ttu-id="3130a-327">ヒントが決定され、ローカルでテストされたら、それらのクエリ ヒントをクエリの将来の実行に追加するプラン ガイドをインストールするためにこのアクションを使用します。</span><span class="sxs-lookup"><span data-stu-id="3130a-327">After hints have been determined and tested locally, use this action to install a plan guide that will add those query hints to future executions of the query.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-328">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-328">Parameters</span></span>
- <span data-ttu-id="3130a-329">名前パラメーターは、既存のプラン ガイドによって現在使用されていない一意の文字列です。</span><span class="sxs-lookup"><span data-stu-id="3130a-329">The name parameter is any unique string not currently used by an existing plan guide.</span></span>
- <span data-ttu-id="3130a-330">ステートメント パラメーターは、強制する SQL ステートメントです。</span><span class="sxs-lookup"><span data-stu-id="3130a-330">The statement parameter is the SQL statement that should be forced.</span></span> <span data-ttu-id="3130a-331">これは、他の多くのクエリ (現在実行中のクエリと最も高価なクエリを含む) から入手できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-331">This can be obtained from many other queries, including currently running queries and most expensive queries.</span></span> <span data-ttu-id="3130a-332">これが正確にコピーされるようにしてください (空白など)。空白に違いが発生すると、プラン ガイドが機能しないためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-332">Ensure that this is copied precisely, including whitespace, because differences in whitespace will cause the plan guide not to work.</span></span> <span data-ttu-id="3130a-333">さらに、このテキストにクエリのパラメーターを含めないでください。別個に指定されるためです。</span><span class="sxs-lookup"><span data-stu-id="3130a-333">Also, do not include the parameters for the query in this text, because they are specified separately.</span></span> <span data-ttu-id="3130a-334">たとえば、選択クエリでは、ステートメントの最初の文字は必ず &quot;SELECT&quot; にしてください。</span><span class="sxs-lookup"><span data-stu-id="3130a-334">For instance, on a select query the first characters of the statement should always be &quot;SELECT&quot;.</span></span>
- <span data-ttu-id="3130a-335">params パラメーターは、一連の @P1、@P2 などのようなクエリのパラメーターです。</span><span class="sxs-lookup"><span data-stu-id="3130a-335">The params parameter is the set of @P1, @P2, and so on, parameters for the query.</span></span> <span data-ttu-id="3130a-336">これらは、他のクエリ (現在実行中のクエリと最も高価なクエリを含む) から入手できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-336">These can be obtained from other queries, including currently running queries and most expensive queries.</span></span> <span data-ttu-id="3130a-337">パラメーターに貼り付ける場合、外部かっこを削除します。</span><span class="sxs-lookup"><span data-stu-id="3130a-337">When pasting in the parameters, remove the outer parenthesis.</span></span> <span data-ttu-id="3130a-338">たとえば、&quot;@P1 int、@P2 nvarchar(21)&quot; に貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="3130a-338">For instance, paste in &quot;@P1 int,@P2 nvarchar(21)&quot;.</span></span> <span data-ttu-id="3130a-339">クエリのパラメーターがない場合、この値を空白のままにします。</span><span class="sxs-lookup"><span data-stu-id="3130a-339">If there are no parameters for the query, leave this value blank.</span></span>
- <span data-ttu-id="3130a-340">適用するヒントは、クエリの末尾に手動で追加することでローカルでテストできます。</span><span class="sxs-lookup"><span data-stu-id="3130a-340">The hints to apply can be tested locally by just manually adding them to the end of a query.</span></span> <span data-ttu-id="3130a-341">テーブル エイリアスを使用している場合、ステートメント テキストのテーブル エイリアスと一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-341">If table aliases are used, they should match the table aliases in the statement text.</span></span>

## <a name="drop-index"></a><span data-ttu-id="3130a-342">インデックスの削除</span><span class="sxs-lookup"><span data-stu-id="3130a-342">Drop index</span></span>

### <a name="background"></a><span data-ttu-id="3130a-343">バックグラウンド</span><span class="sxs-lookup"><span data-stu-id="3130a-343">Background</span></span>
<span data-ttu-id="3130a-344">通常、テーブルに余分なインデックスがあっても、コストが少し増加するだけです。</span><span class="sxs-lookup"><span data-stu-id="3130a-344">Usually, extra indexes on a table only add minor incremental costs.</span></span> <span data-ttu-id="3130a-345">しかし、場合によっては (高スループット テーブルなど)、余分なインデックスの存在により大規模なパフォーマンス低下が生じることがあります。</span><span class="sxs-lookup"><span data-stu-id="3130a-345">But in some situations, such as high-throughput tables, the existence of an extra index can cause large performance degradation.</span></span> <span data-ttu-id="3130a-346">インデックスを削除する適切な方法は、メタデータから削除する方法です。</span><span class="sxs-lookup"><span data-stu-id="3130a-346">The correct way to remove indexes is to remove them from metadata.</span></span> <span data-ttu-id="3130a-347">しかし、継続的な問題を軽減するために積極的に削除する必要がある場合、このアクションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-347">But if they need to be removed more aggressively to mitigate an ongoing issue, this action can be used.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-348">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-348">Next steps</span></span>
- <span data-ttu-id="3130a-349">テーブルのすべてのインデックスを一覧表示するクエリから、削除するインデックス名を決定します。</span><span class="sxs-lookup"><span data-stu-id="3130a-349">From the query to list all indexes for a table, determine the index name to drop.</span></span>
- <span data-ttu-id="3130a-350">このインデックスの削除により悪影響を受ける他のワークロードがないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="3130a-350">Verify that no other workloads will be negatively affected by removing this index.</span></span> <span data-ttu-id="3130a-351">この操作を実行するのは危険であり、他のワークロードが回帰する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-351">This is a dangerous operation to perform and might cause other workloads to regress.</span></span>
- <span data-ttu-id="3130a-352">削除するテーブルとインデックスの名前を提供します。</span><span class="sxs-lookup"><span data-stu-id="3130a-352">Provide the table and the index name to drop.</span></span>
- <span data-ttu-id="3130a-353">原則的には、すべての環境を同期するメタデータのインデックスを削除することで、開発およびサンドボックスなどの他の環境で同じ変更を適用します。</span><span class="sxs-lookup"><span data-stu-id="3130a-353">Apply the same change in other environments, such as DEV and Sandbox, ideally by removing the index in metadata to keep all environments in sync.</span></span>

## <a name="end-sql-process"></a><span data-ttu-id="3130a-354">SQL プロセスの終了</span><span class="sxs-lookup"><span data-stu-id="3130a-354">End SQL process</span></span>

### <a name="background"></a><span data-ttu-id="3130a-355">バックグラウンド</span><span class="sxs-lookup"><span data-stu-id="3130a-355">Background</span></span>
<span data-ttu-id="3130a-356">SPID が非常に多くのリソースを消費して、他のプロセスの工程が低下している場合、は、SPID プロセスを終了すると便利な場合があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-356">If a SPID is consuming too many resources and degrading the operation of other processes, it might be beneficial to end the SPID process.</span></span> <span data-ttu-id="3130a-357">これにより、未処理トランザクションがロールバックします。つまり、データは失われませんが、プロセスの手動での再起動が必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="3130a-357">This will cause the open transaction to roll back, meaning that data should not be lost, but the process might need to be manually restarted.</span></span> <span data-ttu-id="3130a-358">トランザクションが既に多くの作業を実行している場合、ロールバックに時間がかかり、多くのリソースを消費する可能性があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-358">Note that rollback can also take a long time and consume a lot of resources if the transaction has already performed a lot of work.</span></span> <span data-ttu-id="3130a-359">したがって、このアクションは注意して使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-359">Therefore, this action should be used with caution.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-360">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-360">Next steps</span></span>
- <span data-ttu-id="3130a-361">ブロック ツリーやその他のクエリから、SPID が終了するかどうかを判断する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-361">From the blocking tree and other queries, determine which SPID should end.</span></span>
- <span data-ttu-id="3130a-362">継続的な事業運営に悪影響を与えずに、SPID により実行されている処理が終了できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="3130a-362">Verify that the processing that is being performed by the SPID can end without causing harm to ongoing business operations.</span></span>
- <span data-ttu-id="3130a-363">終了する SPID 番号を指定し、その操作をロールバックします。</span><span class="sxs-lookup"><span data-stu-id="3130a-363">Provide the SPID number to end, and roll back that operation.</span></span>

## <a name="disableenable-page-locks-and-lock-escalation"></a><span data-ttu-id="3130a-364">ページ ロックおよびロック エスカレーションの無効化/有効化</span><span class="sxs-lookup"><span data-stu-id="3130a-364">Disable/enable page locks and lock escalation</span></span>

### <a name="background"></a><span data-ttu-id="3130a-365">バックグラウンド</span><span class="sxs-lookup"><span data-stu-id="3130a-365">Background</span></span>
<span data-ttu-id="3130a-366">多くの場合、SQL はページ ロック (ページ全体を一度にロック) を取得するか、テーブル ロック全体 (テーブル全体のロック) にエスカレートします。</span><span class="sxs-lookup"><span data-stu-id="3130a-366">In many situations, SQL will either take page locks (locking a full page at a time) or escalate to entire table locks (locking the whole table).</span></span> <span data-ttu-id="3130a-367">これにより、SQL は大量の行を効率的に編集するアクションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-367">This enables SQL to perform actions that edit a high volume of rows more efficiently.</span></span> <span data-ttu-id="3130a-368">ただし、これにより、特定のワークロードで問題および不要な競合が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="3130a-368">However, this can cause problems and unnecessary contention in certain workloads.</span></span> <span data-ttu-id="3130a-369">2 つの大きな転記ジョブ (それぞれ 10 分を実行されており、偶然同じ物理データ ページに配置されているにさまざまなデータ行を編集している) について考えます。</span><span class="sxs-lookup"><span data-stu-id="3130a-369">Consider two large posting jobs, each running for 10 minutes and editing different rows of data that happen to reside on the same physical data page.</span></span> <span data-ttu-id="3130a-370">これにより、2 つの転記がシリアル化され、競合が原因で 20 分かかる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-370">This might cause the two postings to serialize and to take 20 minutes because of the contention.</span></span> <span data-ttu-id="3130a-371">このクエリは、特定のテーブルのロック エスカレーションやページ ロックの無効化に使用できます。</span><span class="sxs-lookup"><span data-stu-id="3130a-371">This query can be used to disable lock escalation and page locks for a given table.</span></span> <span data-ttu-id="3130a-372">ただし、SQL がページ ロックとロック エスカレーションを使用する有効な理由があるため、慎重に使用してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-372">It should be used cautiously, however, because there are valid reasons for SQL to use page locks and lock escalation.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-373">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-373">Next steps</span></span>
- <span data-ttu-id="3130a-374">ロック エスカレーションまたはページ ロックが原因で不要な競合が特定のテーブルで発生していることを確認したら、これらのオプションを無効にするためにこのクエリを使用します。</span><span class="sxs-lookup"><span data-stu-id="3130a-374">After determining that unnecessary contention is being experienced on a given table because of lock escalation or page locks, use this query to disable those options.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-375">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-375">Parameters</span></span>
- <span data-ttu-id="3130a-376">テーブル名は、テーブルの物理名です。</span><span class="sxs-lookup"><span data-stu-id="3130a-376">The table name is the physical name of the table.</span></span>
- <span data-ttu-id="3130a-377">ロック エスカレーションおよびページ ロックの値は、&quot;ON&quot; または &quot;OFF&quot; です。</span><span class="sxs-lookup"><span data-stu-id="3130a-377">The value of the lock escalation and page locks is either &quot;ON&quot; or &quot;OFF&quot;.</span></span>

## <a name="rebuild-index"></a><span data-ttu-id="3130a-378">インデックスの再構築</span><span class="sxs-lookup"><span data-stu-id="3130a-378">Rebuild index</span></span>

### <a name="background"></a><span data-ttu-id="3130a-379">バックグラウンド</span><span class="sxs-lookup"><span data-stu-id="3130a-379">Background</span></span>
<span data-ttu-id="3130a-380">時間の経過と共に、プロセスは既存のレコードを編集し、テーブルに新しいレコードを作成するため、インデックスが断片化する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-380">Over time, as processes edit existing records and write new records into tables, indexes might become fragmented.</span></span> <span data-ttu-id="3130a-381">これにより、同じ数のレコードの処理に必要な入出力の数が増え、パフォーマンスが低下が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-381">This increases the amount of I/O necessary to process the same number of records, and might cause performance degradation.</span></span> <span data-ttu-id="3130a-382">この操作は、ページの断片化を減らすためにインデックスを再構築します。</span><span class="sxs-lookup"><span data-stu-id="3130a-382">This operation will rebuild indexes to reduce page fragmentation.</span></span> <span data-ttu-id="3130a-383">これはコストの高い操作であり、実行中に競合が発生させることがわかっています。</span><span class="sxs-lookup"><span data-stu-id="3130a-383">This is an expensive operation and has been known to cause contention while running.</span></span> <span data-ttu-id="3130a-384">したがって、この操作の実行中は、環境を監視してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-384">Therefore, the environment should be monitored while this operation is running.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-385">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-385">Next steps</span></span>
- <span data-ttu-id="3130a-386">この操作の実行中、システムでブロックと DTU を監視します。</span><span class="sxs-lookup"><span data-stu-id="3130a-386">Monitor blocking and DTU in the system while this operation is running.</span></span> <span data-ttu-id="3130a-387">システムのパフォーマンスが許容できないほど低下する場合、この操作を終了することを検討します。</span><span class="sxs-lookup"><span data-stu-id="3130a-387">If the system degrades unacceptably, consider ending this operation.</span></span>

## <a name="remove-plan-guide"></a><span data-ttu-id="3130a-388">プラン ガイドの削除</span><span class="sxs-lookup"><span data-stu-id="3130a-388">Remove plan guide</span></span>

### <a name="background"></a><span data-ttu-id="3130a-389">バックグラウンド</span><span class="sxs-lookup"><span data-stu-id="3130a-389">Background</span></span>
<span data-ttu-id="3130a-390">プラン ガイドがインストールされていて、悪影響を与えている、または単に動作していない場合、場合によってはプラン ガイドを削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3130a-390">If plan guides have been installed and are having a negative impact, or if they just are not working, it might be necessary to remove a plan guide.</span></span> <span data-ttu-id="3130a-391">このクエリにより、既存のプラン ガイドの削除が可能になります。</span><span class="sxs-lookup"><span data-stu-id="3130a-391">This query enables removal of an existing plan guide.</span></span> <span data-ttu-id="3130a-392">プラン ガイドの削除が、現在実行中のクエリが次に実行されるまでそのクエリに影響を与えないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="3130a-392">Note that removing a plan guide will not affect any currently running queries until the next time they are executed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-393">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-393">Next steps</span></span>
- <span data-ttu-id="3130a-394">どのプラン ガイドを削除するかを決定したら、プランの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="3130a-394">After determining which plan guide should be removed, specify the name of the plan.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-395">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-395">Parameters</span></span>
- <span data-ttu-id="3130a-396">既存のプラン ガイドおよび関連付けられている名前のリストは、現在のプラン ガイド クエリの一覧から見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="3130a-396">The list of existing plan guides and associated names can be found from the list of current plan guides query.</span></span>

## <a name="update-statistics-on-table"></a><span data-ttu-id="3130a-397">テーブルでの統計の更新</span><span class="sxs-lookup"><span data-stu-id="3130a-397">Update statistics on table</span></span>

### <a name="background"></a><span data-ttu-id="3130a-398">バックグラウンド</span><span class="sxs-lookup"><span data-stu-id="3130a-398">Background</span></span>
<span data-ttu-id="3130a-399">指定されたテーブルでの統計の更新</span><span class="sxs-lookup"><span data-stu-id="3130a-399">Updates statistics on the specified table.</span></span> <span data-ttu-id="3130a-400">インポート プロセスによってテーブルの統計が改変された後など、場合によっては、統計が古く、クエリ プランの問題の原因となっていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="3130a-400">Occasionally, statistics can be found to be out of date and to be causing query plan issues, such as after an import process that has skewed the statistics of the table.</span></span> <span data-ttu-id="3130a-401">このアクションは実行中に大きなパフォーマンス オーバーヘッドを与え、同じテーブルを使用するクエリでブロックの原因となることも知られていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-401">Note that this action will have a significant performance overhead while running and has also been known to cause blocking on queries that use the same table.</span></span> <span data-ttu-id="3130a-402">したがって、システムのパフォーマンスが低下しないようにするため、控えめに使用し、実行中は監視してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-402">Therefore, it should be used sparingly and monitored while running to ensure that the system does not degrade.</span></span>

### <a name="next-steps"></a><span data-ttu-id="3130a-403">次のステップ</span><span class="sxs-lookup"><span data-stu-id="3130a-403">Next steps</span></span>
- <span data-ttu-id="3130a-404">このクエリの実行中、システムのパフォーマンスが許容できないほど低下しないように、現在のブロックと現在の DTU の両方を監視します。</span><span class="sxs-lookup"><span data-stu-id="3130a-404">While running this query, monitor both current blocking and current DTU to ensure that system performance does not degrade unacceptably.</span></span> <span data-ttu-id="3130a-405">低下した場合、更新統計コマンドの終了を検討してください。</span><span class="sxs-lookup"><span data-stu-id="3130a-405">If it does, consider ending the update statistics command.</span></span>

### <a name="parameters"></a><span data-ttu-id="3130a-406">パラメーター</span><span class="sxs-lookup"><span data-stu-id="3130a-406">Parameters</span></span>
- <span data-ttu-id="3130a-407">テーブル名パラメーターは、統計情報を更新するテーブルの物理的な名前です。</span><span class="sxs-lookup"><span data-stu-id="3130a-407">The table name parameter is the physical name of the table to update statistics for.</span></span>
