---
title: サービス提供前およびサービス提供後
description: この記事では、サービス プロセスに導入された新しい変更について説明します。
author: matapg007
ms.date: 05/19/2022
ms.topic: article
audience: ADeveloper, IT Pro
ms.reviewer: sericks
ms.search.region: Global
ms.author: matgupta
ms.search.validFrom: 2022-05-19
ms.openlocfilehash: f146dbab78c337e747de8dd0f83ea3020b0355ee
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/03/2022
ms.locfileid: "8866383"
---
# <a name="pre-servicing-and-post-servicing"></a>サービス提供前およびサービス提供後

[!include[banner](../includes/banner.md)]

この記事では、サービス プロセスに導入された新しい変更について説明します。

Microsoft は、パイプラインのサービス提供前およびサービス提供後の新しい手順を導入し、オフライン サービスの外部でデータベース同期の事前チェックとテーブルのインデックス作成を実行できるようにしました。 したがって、ユーザーが通常の活動を実行できるように、環境は稼働し続け、アクセス可能です。 ただし、サービス提供前およびサービス提供後のすべてのサービス操作が制限されているため、サービスを実行できません。 この変更の主な利点は、サービス全体のダウンタイムを短縮できることです。

## <a name="pre-servicing"></a>サービス提供前

サービスの更新の場合、サービス提供前の手順は、サービス操作がトリガーされたときに実行されます。 この手順の間、Microsoft Dynamics Lifecycle Services (LCS) は、環境の状態を **サービス提供前** として表示します。 この状態は、環境がオンラインでアクセス可能であることを示していますが、他のサービス操作は許可されていません。

サービス提供前の手順は、サービスの失敗の原因となる事前定義された一連のエラーを特定するのに役立ちます。 事前チェックに失敗すると、ポイントインタイム リカバリ (PITR) なしで、すぐにソフト ロールバックがトリガーされ、環境は配置済みの状態に戻ります。 環境履歴ログから事前チェック エラーをフェッチすることにより、更新を再トリガーする前に必要な軽減を適用できます。

![LCS のサービス提供前の状態の環境。](https://user-images.githubusercontent.com/90061039/170361108-a669f070-5001-44b0-8e0b-81c5edca51cd.png)

サービス提供前が成功すると、環境状態が **サービス** に更新されます。 サービス手順の間、システムはオフラインになり、環境状態が **事後サービス** に更新されるまでアクセスできなくなります。 サービス手順が完了した後、電子メール通知が環境管理者に送信されます。

## <a name="post-servicing"></a>サービス提供後

後処理ステップの実行中、オフライン サービスが完了した後、LCS は環境状態を **事後サービス** として表示します。 この間、オフライン サービスの手順で実行されなかったインデックスの作成と変更は、オンライン モードで実行されます。 ユーザーが通常の活動を実行できるように、環境は稼働し続け、アクセス可能です。 ただし、更新プログラム パッケージに含まれる変更により、パフォーマンスが低下する可能性があります。 事後サービスの間、ユーザーは既存のサービス要求をキャンセルしたり、新しいサービス要求をトリガーしたりできません。 ログをダウンロードしてプロセスを確認できるオプションがあります。

![LCS の事後サービスの状態の環境。](https://user-images.githubusercontent.com/90061039/170360282-65acc76f-e7d9-4980-86c3-d8d9224fb08c.png)

事後サービスの手順でエラーが発生した場合、LCS に **事後サービスに失敗しました** と表示されます。 この間、ユーザーが通常の活動を実行できるように、環境は稼働し続け、アクセス可能です。 ただし、インデックスの変更に失敗した特定のテーブルでは、パフォーマンスが低下する可能性があります。 24 時間以内に問題が解決されない場合は、Microsoft サポートに問い合わせてください。

## <a name="recommended-best-practices-for-reduced-servicing-downtime"></a>サービスのダウンタイムを削減するための推奨されるベスト プラクティス

より高速なスキーマ同期をサポートするために、テーブル スキーマの変更を制限することをお勧めします。 最終的に、この同期はオンラインで実行できます。 このセクションで説明するすべてのスキーマ変更操作では、インデックスを削除して再作成する必要があるか、かなりのダウンタイムが必要であるため、サービス期間が長くなります。

### <a name="field-property-changes"></a>フィールド プロパティの変更

- **Scale** プロパティは、**Real Number** タイプのフィールドに対して変更されます。
- **String** タイプのフィールドの **Size** プロパティが **(Memo)** から固定サイズ *n* に、または固定サイズ *n* から **(Memo)** に変更されました。

### <a name="index-related-changes"></a>インデックスに関する変更

- テーブルの **Primary Index** プロパティは変更されました。
- テーブルの **Clustered Index** プロパティは変更されました
- フィールドが列ストア インデックスに追加または削除されています。
- フィールドがプライマリ インデックスに追加または削除されています。

## <a name="faq"></a>よく寄せられる質問

### <a name="what-are-the-most-common-errors-that-can-cause-pre-servicing-to-fail"></a>サービス提供前が失敗する原因となる可能性のある最も一般的なエラーは何ですか?

次の一覧は、サービス提供前が失敗する原因となる可能性のあるいくつかの一般的なエラーを示しています。 更新を再トリガーする前に、環境履歴ログを確認することをお勧めします。

- キーが重複しているため、CREATE UNIQUE INDEX ステートメントが終了しました。
- 元のフィールドをドロップして、テーブルを同期してください。
- 拡張機能を基本要素に適用することはできません。
- 次の依存関係がありません。
- データベース ストレージ クォータを超えようとしています。
