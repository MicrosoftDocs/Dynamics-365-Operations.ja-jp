---
title: Intelligent Data Management Framework のアーカイブ オブジェクトの作成
description: このトピックでは、アーカイブ オブジェクトの使用方法について説明します。
author: kfend
manager: AnnBe
ms.date: 11/14/2017
ms.topic: article
ms.prod: dynamics-ax-2012
ms.service: ''
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.custom: 17931
ms.assetid: 4d3e61d1-48aa-4e39-8112-6d211a1d0209
ms.search.region: Global
ms.author: kfend
ms.search.validFrom: ''
ms.dyn365.ops.version: 2012
ms.openlocfilehash: 5ebf7c04d0fe9d670f96686651367c811fd19a27
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/05/2020
ms.locfileid: "4681628"
---
# <a name="create-archive-objects-for-the-intelligent-data-management-framework"></a>Intelligent Data Management Framework のアーカイブ オブジェクトの作成

[!include [banner](../../includes/banner.md)]

<a name="overview-of-archive-objects"></a>アーカイブ オブジェクトの概要
---------------------------

アーカイブ オブジェクトはドライバー テーブルに基づき作成した階層関係ツリーです。 アーカイブ オブジェクトは、アーカイブ オブジェクトで作成したルールおよび選択基準に基づいて、生産データベースからトランザクション レコードをアーカイブします。 このトピックでは、運用データベースからアーカイブ データベースにレコードをコピーし、運用データベースからこれらのレコードを削除することによってアーカイブを実施する方法について説明します。 IDMF に含まれているテンプレート、または探索プロセスに基づき、アーカイブ オブジェクトを作成することができます。

> [!WARNING]
> このトピックを使用するには、Microsoft Dynamics AX のアプリケーションとデータベースのメンテナンスと管理に精通している必要があります。 IDMF では、Microsoft Dynamics AX アプリケーション テーブル間の階層関係ツリーを定義するアーカイブ オブジェクトを作成できます。 特定の条件に基づきレコードを選択するルールを適用することができます。 アーカイブ オブジェクト内の関係ツリー全体から選択基準に一致するレコードは、生産データベースからアーカイブ データベースに移動されます。 このフレームワークを不適切に使用すると、予期しない結果、データベース破損、データベース全体およびアプリケーションの復旧が必要となるアプリケーション ダウンタイムが発生する可能性があります。 実稼働環境で作業する前に、十分に注意を払い、テスト環境でリサイクル戦略を入念にテストする必要があります。

## <a name="overview-of-the-data-archiving-process"></a>データ アーカイブ プロセスの概要
アーカイブ機能により、スケジュールされているアーカイブ タスクを使用してレコードがアーカイブされます。 実行時に、アーカイブ タスクはこれらのタスクを完了します。

-   ドライバー テーブルに対して定義されているルールに基づいて、ドライバー テーブルから対象のレコードを選択します。
-   親子関係に基づいて、すべての子テーブルから対象のレコードを選択します。
-   特定のレコードを生産データベースからアーカイブ データベースにコピーします。
-   運用データベースから特定のレコードを削除します。

## <a name="considerations-for-archive-objects-driver-tables-relations-and-rules"></a>アーカイブ オブジェクト、ドライバー テーブル、関係、およびルールに関する注意事項
アーカイブ オブジェクトで作業する場合は、次の点を考慮してください。

-   削除オブジェクトのドライバー テーブルとして選択したテーブルが、**SalesTable** などのヘッダー テーブルであることを確認します。 必ずしもいつも正確ではありませんが、そのようなテーブルの **TableGroup** の値は、**WorkSheetHeader**、**Miscellaneous**、または **Transaction** です。
-   **TableGroup** 値が **Main**、**Parameter**、**Group**、**WorkSheetLine** のテーブルをドライバー テーブルにすることはできません。
-   ドライバー テーブルは、階層リレーションシップ ツリーのルート親になります。 IDMF は **XRefTableRelation** テーブルを照会して、親子関係を判別します。
-   アーカイブ オブジェクトに基づいてレコードをアーカイブすると、次の条件では、アプリケーションでデータの不整合が発生する場合があります。
    -   ドライバー テーブルには既知の親テーブルがあります。
    -   ドライバー テーブルには、アーカイブ オブジェクトにリレーションとして追加されていない既知の子テーブルがあります。
-   常にアーカイブ オブジェクトを最小化し、実装に必要なルールおよび関係のみを保持します。 次の条件のアーカイブ オブジェクトからテーブルを削除することを検討してください。
    -   このテーブルにはデータが含まれておらず、将来もデータが含まれない可能性があります。
    -   このテーブルには、**SalesParmTable** や **SpecTrans** などの一時データのみが格納されます。
    -   このテーブルには、**CustTransOpen** や **VendTransOpen** などの未処理のトランザクションが格納されます。
    -   テーブルはネストされたリレーションシップを作成します。 テーブルが、同じ特定関係条件のもとまたは主キーのセットで、関係ツリー上の異なるレベルで複数回表示される場合、関係ツリーの最も低い番号のレベルでのみ表示されるように検討します。
-   テーブルがドライバー テーブルに関連していて、独自のアーカイブ オブジェクトを作成している場合、ドライバー テーブル自体にすることをお勧めします。 たとえば、**SalesTable** をドライバー テーブルとして使用する場合、会社間の **PurchTable** が検出されます。 この場合、**PurchTable** を別のアーカイブ オブジェクトにすることを検討します。 ドライバー テーブルと子テーブルが異なる機能領域からのものである場合は、子テーブルが別々にアーカイブされるのに適している場合は、独独立したアーカイブ オブジェクトを個別に作成します。 これらの条件で、この子テーブルを関連するアーカイブ オブジェクトにすることを検討してください。
    -   このドライバー テーブルとその子テーブルは、機能的またはリレーショナルの依存関係のために一緒にアーカイブする必要があります。
    -   子テーブルの正しいアーカイブのルールを追加する必要があります。 ドライバー テーブルにはルールのみ追加することができます。 子テーブルのルールを追加するには、関連するアーカイブ オブジェクトのドライバー テーブルでなければなりません。 関連アーカイブ オブジェクトに追加するルールが親アーカイブ オブジェクトからのアーカイブに悪影響を及ぼさないようにしてください。
-   2 つのテーブル間に複数のリレーションシップが存在することがあります。 その場合、リレーションシップと機能を慎重に評価します。 アーカイブ オブジェクトでは単一のリレーションシップのみを使用することをお勧めします。 ただし、必要に応じて、複数のリレーションシップを使用できます。 有効なリレーションシップが存在する場合は固有インデックスまたは主キーを使用して、有効なリレーションシップを選択してください。
-   アーカイブ オブジェクトを作成する IDMF に含まれているアーカイブ テンプレートを使用しないでください。 これらのテンプレートは特定の Microsoft Dynamics AX アプリケーションで作成され、実装と一致しない場合があります。 代わりに、検出オプションを使用して独自のオブジェクトを作成し、テンプレートと比較します。 テンプレート内のテーブルは、実装で有効でない場合があります。 有効な既知のテーブルには、検出されたオブジェクトに表示されないものがあります。 探索プロセスで作成したオブジェクトおよびテンプレートの違いを慎重に分析し、その違いの原因を特定します。 要件に合わせるために、削除オブジェクトとアーカイブ オブジェクトからテーブルを手動で追加または削除します。
-   テーブル間の関係が正しく設定されていることを確認します。 すべてのカスタム テーブルに対して **TableGroup** プロパティが設定されていることを確認します。
-   アーカイブ オブジェクトに作成したリレーションシップ ツリーがシステムから目的のデータをアーカイブしていることを確認します。 作成するアーカイブ オブジェクトは関連するすべてのレコードを検索する必要があります。 不足している関係は、データの孤立を引き起こします。
-   リレーションシップ ツリーのテーブルは、アーカイブ機能の一部となり、マスター データ テーブルのリストから無効になります。

> [!WARNING]
> 運用環境に似たテスト環境で、アーカイブ オブジェクトとアーカイブ戦略がデータベースとアプリケーションに及ぼす影響を十分にテストします。 すべての業務プロセスをテストし、実稼働環境にアーカイブ オブジェクトを実装する前にユーザーの承認を得ます。

## <a name="overview-of-related-archive-objects"></a>関連するアーカイブ オブジェクトの概要
アーカイブ オブジェクトのリレーションシップ ツリーは非常に複雑である場合があります。 すべての関連するテーブルからデータをアーカイブするためには、複雑なリレーションシップ ツリーを管理する必要があります。 場合によっては、1 つのリレーションシップ ツリーに、データの整合性との機能的に有効なアーカイブを保証するために別のリレーションシップ ツリーを含める必要があります。 複雑であるため、別のアーカイブ オブジェクトに 1 つのアーカイブ オブジェクトを追加することによって、2 つの独立したアーカイブ オブジェクト間の関係を作成できます。 子アーカイブ オブジェクトは関連アーカイブ オブジェクトと呼ばれ、親アーカイブ オブジェクトとの関係を形成します。 アーカイブ タスクは選択したレコードをアーカイブ オブジェクト内の全てのテーブルおよび関連するアーカイブ オブジェクトにアーカイブします。 次の手順では、関連するアーカイブ オブジェクトを含むアーカイブ オブジェクトのチュートリアルを行います。
1. Microsoft Dynamics AX Windows クライアントを使用して、アプリケーション オブジェクト ツリー (AOT) を操作します。 AOT で、**データ ディクショナリ** &gt; **テーブル** &gt; **CustInvoiceSalesLink** &gt; **リレーション** と展開します。 **CustInvoiceSalesLink** テーブルには、2つの親 **SalesTable** および **CustInvoiceJour** があります。 **CustInvoiceJour** テーブルの **関係** ノードを展開します。 **CustInvoiceJour** テーブルには、AOT の **SalesTable** との関係がありません。
2. IDMF で、**構成** &gt; **アーカイブ テンプレート/アーカイブ オブジェクト** &gt; **SalesTable** とクリックして **SalesTable** アーカイブ オブジェクトを開きます。
3. 階層ツリーを確認し、親/子の関係を理解します。 AOT が 2 つのテーブル間の関係を示す場合でも、手順 1 の **CustInvoiceSalesLink** テーブルが **SalesTable** の子としてリレーションシップ ツリーにないことに注意します。 リレーションシップ ツリーに、**CustInvoiceJour** および **CustPackingSlipJour** という 2 つの楕円図形が含まれていることを確認します。 これらの楕円形は、**SalesTable** の関連アーカイブ オブジェクトを表します。 関連するアーカイブ オブジェクトは、親アーカイブ オブジェクトのリレーションシップ ツリーの一部であるアーカイブ オブジェクトです。
4. **CustInvoiceJour** をダブルクリックします。 **CustInvoiceJour** アーカイブ オブジェクトがルート テーブル **CustInvoiceJour** の横にある緑色の長方形に **SalesTable** を開いて表示していることに注意します。 緑の長方形は、**CustInvoiceJour** アーカイブ オブジェクトの親アーカイブ オブジェクトとして **SalesTable** を強調表示します。 **CustInvoiceSalesLink** テーブルには、子テーブル **CustInvoiceJour** テーブルがあります。 関連アーカイブ オブジェクトを戻すには、**SalesTable** をダブルクリックします。
5. **CustInvoiceJour** を右クリックし、**関係の表示** を選択します。 **関連するアーカイブ オブジェクトの構成** ウィンドウで、**SalesTable** および **CustInvoiceJour** テーブルの関係を確認してから、**閉じる** をクリックしてウィンドウを閉じます。
6. **SalesTable** アーカイブ オブジェクトで、**CustInvoiceJour** を右クリックして **削除** を選択します。 関連するアーカイブ オブジェクト **CustInvoiceJour** が削除されていることを確認します。
7. **SalesTable** を右クリックし、**関連するアーカイブ オブジェクトの追加** を選択します。
8. **関連するアーカイブ オブジェクトの構成** ウィンドウで、これらの手順に従います。

   1.  **関連するアーカイブ オブジェクトの選択** リストで、**CustInvoiceJour** を選択します。 **新しい関係** をクリックします。
   2.  **関連するアーカイブ オブジェクトの関係を構成** ウィンドウで、**関係名** フィールドに SalesTable と入力します。
   3.  **リレーションの説明** フィールドの有効な説明を入力します。
   4.  **関係の構成** ウィンドウで、次のテーブルを使用してフィールドを選択してから **追加** をクリックします。

       | リストから          | 値を選択    |
       |------------------------|---------------------|
       | **テーブル名**         | **SalesTable**      |
       | **フィールド名**         | **データ領域 ID**      |
       | **条件**          | **=**               |
       | **関連テーブル名** | **CustInvoiceJour** |
       | **関連フィールド名** | **データ領域 ID**      |

   5.  **新しい関係** をクリックします。 前のステップを使用することで、**SalesID** を使用して、**SalesTable** テーブルと **CustInvoiceJour** テーブル間にリレーションを作成します。 **追加** をクリックします。
   6.  **DataAreaId** フィールと **SalesID** フィールドを使用して、**SalesTable** テーブルと **CustInvoiceJour** テーブルが関連していることを確認します。
   7.  **保存** をクリックします。 **OK** をクリックします。 **閉じる** をクリックして親の SalesTable アーカイブ オブジェクトに戻ります。
   8.  SalesTable Archive Object オブジェクトに CustInvoiceJour Related Archive オブジェクトが含まれていることを確認します。
   9.  **保存** をクリックします。 **名前を付けて保存** ダイアログ ボックスに、SalesTable\_a と入力してから **保存** をクリックします。 **OK** をクリックして続行します。 アーカイブ オブジェクトは、新しい名前で保存する必要があります。
   10. リレーションシップ ツリー ワークスペースの右上にある **プロパティ** をクリックし、**プロパティ** ウィンドウをワークスペースにピン留めします。 リレーションシップ ツリーで、**関連するアーカイブ オブジェクト CustInoviceJour** をクリックしてから **削除** をクリックします。 **プロパティ** ウィンドウで **元に戻す** をクリックします。 元に戻す操作は、最後に **保存** をクリックした後に行った変更を元に戻します。 関連するアーカイブ オブジェクトを削除した後に **保存** をクリックしなかったため、ここでは、関連するアーカイブ オブジェクト **CustInvoiceJour** は元に戻す操作で戻されます。
   11. 関連するアーカイブ オブジェクト **CustInvoiceJour** をもう一度削除します。 アーカイブ オブジェクトを **SalesTable\_deleted** という名前で保存します。
   12. ツールバーで、**アーカイブ テンプレート/アーカイブ オブジェクト** をクリックします。 SalesTable アーカイブ オブジェクトのアイコンをリスト内の他のオブジェクトと比較し、その違いを確認します。 このアイコンは、既定のテンプレートを開いてアーカイブ オブジェクトとして保存したことを示します。 アーカイブ タスクでは、アーカイブ テンプレートではなく、アーカイブ オブジェクトのみを使用することができます。 **SalesTable** をクリックします。 IDMF が **SalesTable\_deleted** として保存したアーカイブ オブジェクトを開くことを確認します。 IDMF を使用すると、複数のバージョンのアーカイブ オブジェクトを保存し、最も最近に保存したバージョンのアーカイブ オブジェクトを使用できます。
   13. ツール バーで、**バージョンの表示** をクリックします。 **バージョン履歴** ウィンドウで、**SalesTable** を **アーカイブ テンプレート** リストで選択します。 **アーカイブ オブジェクト** リストに、さまざまなバージョンの **SalesTable** が上部にある最新バージョンとともに表示されていることに注意します。 アーカイブ タスクはアーカイブ オブジェクトの最新のバージョンを使用します。

   このチュートリアルでは、あるアーカイブ オブジェクトに、関連するアーカイブ オブジェクトを含めるという概念について説明しました。 アーカイブ オブジェクトを操作したり、親アーカイブ オブジェクトに関連アーカイブ オブジェクトを含める前に、Microsoft Dynamics AX のメタデータと機能について十分に理解する必要があります。

   <a name="understanding-the-archive-object-exception-list"></a>アーカイブ オブジェクト例外リストを理解する
   -----------------------------------------------

   IDMF を使用すると、このトピックの後半のセクションで説明する例外パラメーター リストを作成できます。 例外パラメーター リストは、すべての削除テンプレート、削除オブジェクト、アーカイブ テンプレート、およびアーカイブ オブジェクトにグローバルに適用されます。 例外パラメータ一覧に加えて、IDMF により、特にアーカイブ オブジェクトに対する例外テーブル リストを管理することができます。 新しいアーカイブ オブジェクトを作成し、ドライバー テーブルを選択すると、IDMF にアーカイブ オブジェクト例外テーブル ウィンドウが表示されます。 例外リストには、個別に独立したアーカイブ オブジェクトを作成するためのドライバー テーブルとして使用できるテーブルが含まれています。 これらのテーブルを慎重に評価し、関連する子テーブルまたは関連するアーカイブ オブジェクトとしてリレーションシップ ツリーに含めるかどうかを決定します。 検出プロセスは、アーカイブ オブジェクト例外テーブル リスト内のすべてのテーブルを無視し、リレーションシップが存在する場合でも、それらをリレーションシップ ツリーに含めません。 アーカイブ オブジェクト例外テーブルの一覧からテーブルを含めるには、テーブルの選択を解除し、**保存** をクリックしてから **続行** をクリックして検出プロセスを開始します。 この場合、関係が存在する場合、検出プロセスに選択解除されたテーブルが含まれます。 また、他のテーブルをリストに追加して、新規追加したテーブルを探索プロセスから除外するように選択することができます。

   <a name="navigation-of-the-archive-object-exception-tables-window"></a>アーカイブ オブジェクト例外テーブル ウィンドウのナビゲーション
   --------------------------------------------------------

   次のテーブルで、このウィンドウのコントロールについて説明します。
   #### <a name="panes"></a>ウィンドウ

   | ウィンドウ                        | 説明                                                                                                                                           |
   |-----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
   | **メイン** ウィンドウ             | ドライバー テーブル、およびこのドライバー テーブルの例外テーブルの一覧を示します。 例外テーブルのリストは、ドライバー テーブルに応じて変更されます。 |
   | **新しい例外テーブルの追加** | 例外テーブルの一覧にテーブルを追加するためのコントロールを提供します。                                                                                        |

   #### 

   #### <a name="buttons-main-window"></a>ボタン (主要なウィンドウ)

   | ボタン       | 説明                                                                                                 |
   |--------------|-------------------------------------------------------------------------------------------------------------|
   | **保存**     | **ステータス** フィールドの変更や追加されたテーブルなど、例外テーブルの一覧への変更を保存します。 |
   | **続行** | アーカイブ オブジェクトの探索プロセスを続行します。                                                 |

   #### 

   #### <a name="buttons-add-new-exception-tables-pane"></a>ボタン (新しい例外テーブル ウィンドウの追加)

   | ボタン    | 説明                                                                                                                       |
   |-----------|-----------------------------------------------------------------------------------------------------------------------------------|
   | **追加**   | 例外テーブル リストに選択したテーブルを追加します。 **追加** をクリックする前に、**テーブル名** の一覧からテーブルを選択する必要があります。 |
   | **クリア** | **テーブル名** リストをクリアします。                                                                                                    |

   #### 

   #### <a name="fields-main-window"></a>フィールド (主要なウィンドウ)

   | フィールド                | 説明                                                                                                                                                                                                                                                    |
   |----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | **テーブル名**       | ドライバー テーブル名。                                                                                                                                                                                                                                  |
   | **例外テーブル** | 例外テーブルの名前。 リスト内の各テーブルは、ドライバー テーブルになることが可能です。                                                                                                                                                                           |
   | **ステータス**           | **ステータス** フィールドが選択されたテーブルは、リレーションシップが存在していても、検索プロセス中にリレーションシップ ツリーに追加されません。 **ステータス** フィールドが選択されていない場合、リレーションシップが存在している場合、テーブルは検索プロセス中にリレーションシップ ツリーに追加されます。 |
   | 更新者          | 既存のテーブルのステータス変更、または新しいテーブルの一覧への追加を行ったユーザーの Windows ID。                                                                                                                                                       |

   #### 

   #### <a name="fields-add-exception-list"></a>フィールド (例外リストの追加)

   | フィールド          | 説明                                                         |
   |----------------|---------------------------------------------------------------------|
   | **テーブル名** | 例外テーブルの一覧に追加するテーブルを選択します。 |

    <a name="create-a-new-archive-object"></a>新しいアーカイブ オブジェクトを作成します
   ----------------------------

   IDMF に含まれるテンプレートを選択する代わりに、ドライバー テーブルを選択してドライバー テーブルに基づきリレーションシップ ツリーを作成することにより、アーカイブ オブジェクトを作成することができます。 アーカイブ オブジェクトを作成するには、これらの手順に従います。
   1. ツールバーで、**アーカイブ オブジェクトの作成** をクリックします。
   2. **アーカイブ オブジェクトの作成** ダイアログ ボックスで、**ドライバー テーブル** リストからテーブルを選択します。 リストでは、このトピックの後半で説明する例外パラメーター リストからテーブルを除外します。 **WMSOrder** に移動して選択します。 ドライバー テーブルは、特定のアーカイブ オブジェクトのリレーションシップ ツリーを定義する親テーブルです。 アーカイブ オブジェクトでは、ドライバー テーブルに子エンティティがある場合がありますが、リレーションシップ ツリーに親エンティティはありません。
   3. 続行するには、テーブルの最もユニークなインデックスを選択する必要があります。 このインデックスは、アーカイブ オブジェクトに親子関係を作成するために使用されます。 固有のキー フィールドで、orderid を選択します。 **WMSOrderIdx** インデックスは、**orderid** フィールドを使用して作成されます。
   4. **検出** をクリックします。 **アーカイブ オブジェクト例外テーブル** ダイアログ ボックスで、例外テーブルの一覧を慎重に確認します。 リストからテーブルを関係ツリーに含めるには、**ステータス** フィールドをクリアします。 **新しい例外テーブルを追加** ウィンドウを使用して、新しいテーブルをリストに追加します。 新しく追加されたテーブルの **ステータス** フィールドは、既定で選択されます。 **保存** をクリックして、変更をアーカイブ オブジェクト例外テーブル ウィンドウに保存します。 探索プロセスを開始し、アーカイブ オブジェクトを作成するには、**続行** をクリックします。
      > [!NOTE]
      > **管理** &gt; **検出** コマンドを使用すると、例外パラメーター リストを管理できます。 アーカイブ検索が選択されている例外パラメーター リストに属しているテーブルは、ドライバー テーブルと除外さらたテーブルの間にリレーションシップがあっても、アーカイブ オブジェクトが作成されると、リレーションシップ ツリーから除外されます。

   Microsoft Dynamics AX データベースからインポートされるメタデータと、例外パラメーター、およびアーカイブ オブジェクト例外テーブル リストを使用して、IDMF は階層的なリレーション ツリーを生成します。 リレーションシップ ツリーは 0 階でドライバー テーブルで始まり、親子関係の階層を作成します。 アーカイブ オブジェクトが次のスクリーン ショットのようになっていることを確認します。 アーカイブ オブジェクトを保存しないでください。 

   ![展開された IDMF アーカイブ オブジェクト](./media/idmfarchiveobjectexpanded.png) 

   このアーカイブ オブジェクトのリレーションシップ ツリーは 5 階層の深さです。 最上位レベルのレベル 0 には、ドライバー テーブル **WMSOrder** が含まれています。 レベル 1 には、ドライバー テーブルの子エンティティが含まれています。 レベル 2 には、レベル 1 のテーブルの子エンティティが含まれています。 レベル 4 の最後のレベルには、レベル 3 のテーブルの子エンティティが含まれています。 この関係ツリーは、以下のデータに基づいて作成されます。
   -   Microsoft Dynamics AX メタデータ。 検出プロセスは、メタデータを使用して、ドライバー テーブルに基づいて親子階層を形成する関連テーブルのリストを作成します。
   -   例外パラメーター。 例外パラメーターの一覧に属しているテーブルは関係ツリーから除外されます。 **管理** メニューを使用して、例外パラメーターを設定します。
   -   アーカイブ オブジェクトの例外テーブル ダイアログ ボックスに一覧表示されているテーブル。 このダイアログ ボックスで選択したテーブルは、階層的なリレーションシップ ツリーからも除外されます。

> [!WARNING]
> **管理** &gt; **マスター データ テーブル** をクリックしてマスター テーブルとして構成するテーブルは、マスター データ同期タスクによって実稼働データベースからアーカイブ データベースに複製されます。 検出プロセスによって作成されたリレーションシップ ツリーには、マスター テーブルとして構成されたテーブルが含まれている場合があります。 リレーションシップ ツリーに含まれるテーブルを確認し、マスタ テーブルとして扱う必要があるテーブルを削除します。 テーブルを右クリックし、**データ レプリケーションを追加** を選択して関係からテーブルを削除し、マスター データ テーブルとしてコンフィギュレーションします。 これらのテーブルを削除しない限り場合、関係ツリー内のテーブルは、アーカイブ オブジェクトを保存するときにマスター データの同期リストから自動的に削除されます。

リレーションシップ ツリーを検証し、Microsoft Dynamics AX アプリケーション上でそのツリーの機能的効果を評価します。 評価の結果として、一部の関係やルールを手動で追加、変更、または削除が必要となる場合があります。 たとえば、**バージョンの表示** をクリックして、IDMF に含まれる既定のテンプレートからアーカイブ オブジェクトを表示します。 前の手順で作成したリレーションシップ ツリーとテンプレートのリレーションシップ ツリーを比較します。 **WMSOrder** アーカイブ テンプレートのリレーションシップ ツリーは、作成した **WMSOrder** アーカイブ オブジェクトと異なります。 この違いは、Microsoft Dynamics AX アプリケーションの機能評価に基づいて既定のテンプレートに加えられた変更によるものです。 このチュートリアルが示すように、検索によって作成するアーカイブ オブジェクトは、IDMF に含まれる既定のテンプレートと一致しない場合があります。 ドライバー テーブルの選択には注意が必要です。 **ProdTable** などのテーブルを選択すると、各レベルの多数のテーブルにまたがっている数多くのレベルの関係ツリーが表示されます。 このようなアーカイブ オブジェクトは、複雑な関係ツリーを作成して、エラーの可能性を高くし、結果としてデータの破損やアプリケーションのダウンタイムが生じます。 

![無効なテーブルを含む IDMF アーカイブ オブジェクト](./media/idmfarchiveobjectwithinvalidtables.png)

IDMF に含まれている既定のテンプレートは、Microsoft Dynamics AX 実装のメタデータと一致しない場合があります。 生産データベースのメタデータに見つからない既定テンプレートのテーブルは、無効とマークされます。 図 2 に示すように、無効なテーブルに赤い点線の枠線が表示されます。 無効なテーブルは削除する必要があります。 有効なテーブルのフィールドを使用してリレーションとルールを作成するとき、IDMF はこれらのフィールドを検証します。 無効なコンフィギュレーション キーが設定されたフィールドは無効と見なされます。 無効なフィールドを持つ有効なテーブルは、黄色の点線の枠線で表示されます。 アーカイブ オブジェクトを保存する前に、リレーションシップ ツリーから無効なルールを含む有効なテーブルを削除するか、またはリレーションシップを修正する必要があります。

<a name="navigation-of-the-create-archive-object-workspace"></a>アーカイブ オブジェクトの作成ワークスペースのナビゲーション
-------------------------------------------------

次のテーブルで、このワークスペースのコントロールについて説明します。
#### <a name="panes"></a>ウィンドウ

<table>
  <colgroup>
    <col width="50%" />
    <col width="50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>ウィンドウ</th>
    <th>説明</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><strong>リレーションシップ ツリー</strong> ウィンドウ</td>
    <td>アーカイブ オブジェクトにすべてのテーブルのグラフィック ビューを提供します。 次のリストでは、リレーションシップ ツリー ウィンドウを移動するために使用できるコントロールとコマンドを示しています。 <ul>
    <li><strong><span class="ui">レベル</span></strong> スライダーでは、レベルを選択して、選択したレベルおよび上位レベルにあるテーブルのみを表示することができます。</li>
    <li><strong><span class="ui">ズーム</span></strong> スライダーでは、図のサイズを変更することができます。</li>
    <li>次のコマンドを操作するドライバー テーブルを右クリックします。 <ul>
    <li><strong><span class="ui">関連アーカイブ オブジェクトを追加する</span></strong>をクリックし、関連アーカイブ オブジェクトを追加します。</li>
    <li>無効なすべてのテーブルを、関連するすべてのテーブルとともに入れ子になった階層から削除するには、<strong><span class="ui">無効なテーブルをすべて削除する</span></strong>をクリックします。</li>
    </ul></li>
    <li>次のコマンドを操作する子テーブルを右クリックします。 <ul>
    <li>選択したテーブルをレベルから削除し、階層ツリーから入れ子になった子テーブルを削除するには、<strong><span class="ui">削除</span></strong>をクリックします。 たとえば、<strong>SpecTrans</strong> テーブルはレベル 2 とレベル 3 で表示されます。 レベル 2 のテーブルを右クリックし、<strong><span class="ui">削除</span></strong>を選択すると、レベル 2 からテーブルが、入れ子になった子関係と共に削除されます。 テーブルの発生はレベル 3 のままです。</li>
    <li><strong><span class="ui">すべての発生を選択</span></strong>をクリックすると、選択したテーブルとその関連テーブルのすべての出来事が緑色の点線の枠内に表示されます。 この場合、テーブル <strong>SpecTrans</strong> は入れ子になった子関係すべてと共にレベル 2 と 3 で選択されます。</li>
    <li>選択したテーブル、およびその関連テーブルのすべての内容を削除するには、<strong><span class="ui">すべてを削除</span></strong>をクリックしてください。 この場合、テーブル <strong>SpecTrans</strong> は入れ子になった子関係すべてと共にレベル 2 と 3 から削除されます。 削除されたテーブルが赤い実線の入った灰色の図形に表示されます。</li>
    <li>選択したテーブルをリレーション ツリーから削除し、マスター テーブル リストに追加するには、<span class="ui"><strong>データ複製に追加</strong></span>をクリックします。 このコマンドは次のタスクを実行します。 <ol>
    <li>すべての既存のアーカイブ オブジェクトとアーカイブ テンプレートから、選択したテーブルをそのネストされた子テーブルすべてと共に削除します。</li>
    <li>マスター データ テーブル リストの<strong><span class="ui">推奨テーブル</span></strong> タブで選択したテーブルを追加します (<strong><span class="ui">管理</span></strong> &gt; <strong><span class="ui">マスター データ テーブル</span></strong>)。</li>
    </ol></li>
    </ul></li>
    <li>選択したテーブルの親子関係階層を再生成するには、<strong><span class="ui">検出</span></strong>をクリックします。 このコマンドは、<strong><span class="ui">WorkSheetHeader</span></strong> というテーブル グループ プロパティを持つテーブルを選択した場合にのみ使用できます。</li>
    </ul>
    <div class="alert">
    <table>
    <thead>
    <tr class="header">
    <th><strong>メモ</strong></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>右上隅の記号 X があるテーブルは、フレームワーク オプション ウィンドウの行サイズ、またはテーブルサイズのコンフィギュレーションを満たしています (<strong><span class="ui">管理</span></strong> &gt; <strong><span class="ui">フレームワーク オプション</span></strong>)。 これらのテーブルを慎重に確認し、関係から削除してマスター データ テーブル リストに追加する必要があるかどうかを判断します (<strong><span class="ui">管理</span></strong> &gt; <strong><span class="ui">マスター データ テーブル</span></strong>)。 マスター データ テーブルの一覧にテーブルを追加するには、テーブルを右クリックし、<strong><span class="ui">データ レプリケートに追加</span></strong> を選択します。</td>
    </tr>
    </tbody>
    </table>
    </div></td>
    </tr>
    <tr class="even">
    <td><strong><span class="ui">プロパティ</span></strong></td>
    <td>選択したテーブルのプロパティを表示し、選択したテーブルに使用できるコマンドを提供します。 アーカイブ オブジェクト内のテーブルに複数のリレーションが存在するときは、ツリー ビューの <span class="ui">Relations</span> ノードを使用して、このセクションで後で詳しく説明しているように、1 つまたは複数のリレーションを無効にすることができます。</td>
    </tr>
    <tr class="odd">
    <td><strong><span class="ui">テーブルの削除</span></strong></td>
    <td>関係ツリーから削除するテーブルを選択するために使用できるデータ グリッドを提供します。 このペインには、データ グリッドをフィルタリングするために使用できる<span class="ui">高度なフィルタ</span>コントロールもあります。</td>
    </tr>
    <tr class="even">
    <td><strong><span class="ui">関連情報</span></strong></td>
    <td>一部のテーブルの追加情報を提供します。 関連する情報が指定された場合は、テーブルのアーカイブの妥当性を理解するために慎重に読んでください。</td>
    </tr>
    </tbody>
    </table>

#### <a name="buttons"></a>ボタン

| ボタン                    | 説明                                                                                                                                                                                                                                                                                              |
    |---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | **削除**                | **テーブルの削除** ウィンドウのデータ グリッドで選択されているテーブルを削除します。 テーブルを削除すると、選択したテーブルのすべての子テーブルが削除されます。 削除すると、リレーションシップ ツリー全体が削除され、選択したテーブルの子テーブルのすべてのネストされた親子関係が削除されます。 |
    | **元に戻す**                | アーカイブ対象に行われた変更を前回の変更まで戻します。 これは、「元に戻す」コマンドに似ています。                                                                                                                                                                                           |
    | **allShow を選択して表示** | すべてのテーブルまたは選択したテーブルを表示し、ボタンのラベルを切り替えます。 削除されたテーブルが、周囲に赤い実線の入った灰色のボックスに表示されます。                                                                                                                                                           |


#### <a name="fields-remove-table-pane"></a>フィールド (テーブルの削除ウィンドウ)

| フィールド                 | 説明                                                       |
|-----------------------|-------------------------------------------------------------------|
| **チェック ボックス**       | 関係ツリーから削除するテーブルを選択します。 |
| **テーブル名**        | テーブルの名前。                                            |
| **コンフィギュレーション キー** | このテーブルのコンフィギュレーション キー。                               |
| **レベル**             | リレーションシップ ツリー内のテーブルのレベル。                  |
| **行数**         | テーブルの行数。                                  |

<a name="walkthrough-work-with-an-archive-object"></a>チュートリアル: アーカイブ オブジェクトの操作
-----------------------------------------

このセクションでは、アーカイブ オブジェクトの操作に関するチュートリアルを提供します。

1.  アーカイブ オブジェクトを既に作成していない場合は、1 つを作成します。 ツール バーの **保存** をクリックします。 次のダイアログ ボックスで、警告メッセージを注意深く読んでから **はい** をクリックします。 **名前を付けて保存** ダイアログ ボックスに、**WmsOrder1** と入力してから **保存** をクリックします。 **OK** をクリックします。
2.  階層図の **WMSOrder** テーブルをクリックします。
3.  **ズーム** スライダーを使用して、テーブル名を簡単に読み取れるように図のサイズを変更します。
4.  リレーションシップ ツリーで、テーブル **WMSOrder** にマウス ポインターを移動し、ツール ヒントに表示される情報を確認します。 リレーションシップ ツリーで、**WMSOrderTrans** テーブルの上の **1:N 関係の説明** にマウス ポインターを移動し、ツール ヒントに表示される情報を確認します。
5.  **プロパティ** ウィンドウで、ツリー ビューの各ノードを展開して指定されている情報を表示します。
6.  **高度な** フィルター コントロールでの選択基準が表示されない場合、**高度な** フィルター矢印をクリックします。 **レベル** フィールドに 1 と入力してから、**検索** をクリックします。 これにより、レベル 1 にあるテーブルのみが表示されるようにグリッドが変更されます。
7.  横にあるチェック ボックスをオンにして **WMSOrderTrans** テーブルを選択します。
8.  **プロパティ** ウィンドウで **削除** をクリックします。 テーブル **WMSOrderTrans** とそこのレベル 2、3、4 にあるすべての子テーブルは削除されることに注意してください。
9.  **プロパティ** ウィンドウの **すべて表示** ボタンをクリックします。 図にはすべてのテーブルが表示され、削除されたテーブルは赤い線で表示されます。
10. **元に戻す** をクリックし、元のアーカイブ オブジェクトを復元します。 この図は、手順 8で **WMSOrderTrans** を削除する前の状態に戻ります。
11. 手順 7、8、9 を繰り返して、もう一度テーブルを削除します。 すべての削除されたテーブルが赤い実線の入った灰色の図形に表示されます。
12. **プロパティ** ウィンドウ内の **選択項目の表示** をクリックし、改訂されたアーカイブ オブジェクトを表示します。 削除したテーブルがアーカイブ オブジェクトに存在しないことを確認します。
13. ツール バーの **保存** をクリックします。 アーカイブ オブジェクトを新しいバージョンで保存するには、ダイアログボックスの **保存** をクリックします。 アーカイブ オブジェクトを保存するときに、一意の名前を指定する必要があります。 IDMF は、新しいバージョンの元のアーカイブ オブジェクトまたはアーカイブ テンプレートとして保存されているアーカイブ オブジェクトを扱います。
14. ツールバーで、**アーカイブ テンプレート/アーカイブ オブジェクト** をクリックし、**WMSOrder** をクリックします。
15. アーカイブ オブジェクト図に手順 11 で削除したテーブルが含まれていないことを確認します。 **すべての表示/選択項目の表示** を切り替えて、削除したテーブルが赤い実線による灰色の形状に表示されることを確認します。
16. **プロパティ** ウィンドウで **元に戻す** をクリックします。 アーカイブ オブジェクトは変化しません。 アーカイブ オブジェクトが保存されているため、元に戻す操作で変更を元に戻すことはできません。
17. ツール バーで、**バージョンの表示** をクリックします。 **バージョン履歴** ダイアログ ボックスで、**WMSOrder** をリストから選択し、アーカイブ オブジェクト リストでアーカイブ オブジェクトのバージョンを選択します。 アーカイブ オブジェクトの各バージョンは、一意の名前で保存されます。 したがって、リストの各アーカイブ オブジェクトは、異なるバージョンの **WMSOrder** を提供します。
18. 一覧で最後の項目 **WMSOrder** を選択し、**表示** をクリックしてアーカイブ オブジェクトを IDMF にアーカイブ テンプレートとして含まれている最初のバージョンに復元します。 復元されたアーカイブ オブジェクトは、手順 1 で作業を開始したアーカイブ オブジェクトとは異なります。 既定のアーカイブ テンプレートのリレーションシップ ツリーは、Microsoft Dynamics AX アプリケーションの機能評価に基づいて調整されています。
19. ツール バーの **保存** をクリックします。 オブジェクトを上書きするには、**はい** をクリックします。 **名前を付けて保存** ダイアログ ボックスで、アーカイブ オブジェクトの名前を入力してから **保存** をクリックします。 保存操作の成功または失敗を示すメッセージを閉じるには、**OK** をクリックします。 次のセクションでも使用するため、アーカイブ オブジェクトを開いたままにします。

<a name="archive-templatesarchive-object"></a>アーカイブ テンプレート/アーカイブ オブジェクト
---------------------------------

このコマンドは、システム内のアーカイブ テンプレートとアーカイブ オブジェクトのリストを提供します。 アーカイブ テンプレートとは事前定義されたリレーションシップ ツリーで IDMF に含まれているテンプレートです。 出発点としてアーカイブ テンプレートを使用し、アーカイブ オブジェクトを作成することができます。 スケジュールされたアーカイブ タスクの使用前に、要件を満たしているかどうか確認するためにアーカイブ テンプレートを確認して保存する必要があります。 このコマンドは、**アーカイブ オブジェクトの作成** ワークスペースと同じナビゲーションおよびツールバー コマンドを使用します。

### <a name="walkthrough-work-with-an-archive-template"></a>チュートリアル: アーカイブ テンプレートの操作

このセクションでは、アーカイブ テンプレートの操作に関するチュートリアルを提供します。

1.  ツールバーで、**アーカイブ テンプレート/アーカイブ オブジェクト** をクリックします。 **BankChequeTable** テンプレートのアイコンを確認します。
2.  リストから **BankChequeTable** を選択します。
3.  テーブル、テーブルのプロパティ、関係ツリーを確認し、**BankChequeTable** のデータ アーカイブがアーカイブ テンプレートの関係ツリーを通じてカスケードする方法を理解します。 このリレーションシップ ツリーに、アプリケーションと、Microsoft Dynamics AX アプリケーションに対して行ったすべてのカスタマイズが含まれていることを確認します。
4.  ツール バーの **保存** をクリックします。 アーカイブ オブジェクトを保存するときに、一意の名前を指定する必要があります。 名前を BankChequeTable\_ オブジェクトに変更し、この保存されたオブジェクトをアーカイブ オブジェクトとして識別します。 **保存** をクリックします。
5.  続行するにはダイアログ ボックスで **OK** をクリックします。
6.  ツールバーで、**アーカイブ テンプレート/アーカイブ オブジェクト** をクリックします。 リストの **BankChequeTable\_オブジェクト** が表示されません。 パージ オブジェクトとは異なり、アーカイブ オブジェクトは同じ名前で保存されますが、新しいバージョンで保存されます。 この場合、**BankChequeTable** オブジェクトはバージョン名 **BankChequeTable\_object** で作成されます。 同様に、最新バージョンは有効です。
7.  **BankChequeTable** のアイコンが以前と比較して変わっていると、オブジェクトとして保存されることを示しています。
