---
title: LCS 実装プロジェクトを別の Azure AD テナントに移動する
description: この記事では、サブスクリプションと LCS 実装プロジェクトを異なる Azure AD テナントに移動する方法について説明します。
author: RicardoCaeiroPro
ms.date: 11/30/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: IT Pro
ms.reviewer: sericks
ms.search.region: Global
ms.author: v-ricaei
ms.search.validFrom: 2018-05-30
ms.dyn365.ops.version: AX 7.0
ms.openlocfilehash: 9cb6c8c4c037d61ec26700a82b064cf29168a6fa
ms.sourcegitcommit: 09d4805aea6d148de47c8ca38d8244bbce9786ce
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/31/2022
ms.locfileid: "9386920"
---
# <a name="move-lcs-implementation-projects-to-different-azure-ad-tenants"></a>LCS 実装プロジェクトを別の Azure AD テナントに移動する

[!include [banner](../includes/banner.md)]

サブスクリプションと Microsoft Dynamics Lifecycle Services (LCS) 導入プロジェクトを別の Microsoft Azure Active Directory (Azure AD) テナントに移すことができます。 この移動が必要になる場合のいくつかのシナリオを次に示します。

- 誤ってサブスクリプションが正しくない Azure AD テナントに対して購入されました。

    > [!NOTE]
    > ユーザーがクラウド サービス プロバイダーであり、既存の顧客に財務と運用アプリのサブスクリプションを販売する場合は、その顧客との再販業者関係を要求して、顧客の既存の Azure AD テナントにサブスクリプションを配置する必要があります。 Microsoft パートナー センターで新しい顧客レコードを作成する場合、顧客の新しい Azure AD テナントを作成します。

- サブスクリプションが購入された後、顧客は Azure AD テナントの構造を変更します。

サブスクリプションおよび関連するすべてのコンポーネントの移動のプロセスには、次の図に示すように、次の 4 つの主要なステップがあります。

![サブスクリプション契約を移動するためのプロセス。](./media/move-subscription-process.png)

## <a name="activate-subscriptions-on-the-new-tenant"></a>新しいテナントのサブスクリプションを有効化

クラウド サービス プロバイダまたはボリューム ライセンスの再販業者と協力して、新しい Azure AD テナントに対するサブスクリプションを有効にします。 ユーザーおよびアドオン環境のすべてのサブスクリプションを有効にする必要があります。

### <a name="cloud-service-provider"></a>クラウド サービス プロバイダー

Microsoft クラウド ソリューション プロバイダー (CSP) 契約を通じてライセンスを取得している場合は、クラウド サービス プロバイダーから新しいテナントに対して必要なサブスクリプションを購入してください。 新しいテナントが既に存在する場合、クラウド サービス プロバイダは、再販業者関係を要求する必要があります。 または、パートナー センターのクラウド サービス プロバイダで必要な既定ドメイン名の新しい顧客を作成する必要があります **\*.onmicrosoft.com** (たとえば、**contoso.onmicrosoft.com**)。

クラウド サービス プロバイダーに、今回は既存のサブスクリプションを中断しないよう依頼します。

### <a name="volume-licensing"></a>ボリューム ライセンス

Microsoft ボリューム ライセンス契約を通じてライセンスを取得している場合は、[ボリューム ライセンス サポート センター](https://www.microsoft.com/Licensing/servicecenter/Help/Contact.aspx)に連絡し、サブスクリプションを古いテナントから新しいテナントに再マップするように依頼する必要があります。 Microsoft 365 管理センターからボリューム ライセンスのサポートに連絡することができます。 サブスクリプションが両方のテナントで有効になると、支払猶予期間を要求します。 顧客プライバシーの問題が原因で、顧客がこの要求を実行する必要があります。 次の情報が必要です。

- 公的顧客番号。
- 登録番号。
- 現在プロビジョニングされているサブスクリプションの現在のテナント ドメイン。
- 顧客がサブスクリプションのプロビジョニングを希望する宛先テナント ドメイン。
- 顧客が違うテナントに移行したボリューム ライセンス サブスクリプションを必要とする理由の詳細説明。
- 新しいテナントに移動しなければならない有料サブスクリプションの総数、サブスクリプション タイプおよび定員数。

> [!IMPORTANT]
> 古いテナントで LCS の廃棄が完了するまでの数週間、サブスクリプションが両方のテナントで並行して有効であることが非常に重要です。

## <a name="configure-lcs-on-the-new-tenant"></a>新しいテナントに LCS をコンフィギュレーションします。

新しいテナントで、開始し設定する必要がある新しい LCS プロジェクトを取得します。

1. 新しいプロジェクト オンボード ウィザードの操作を完了します。 詳細については、[LCS プロジェクトのオンボード](../../dev-itpro/lifecycle-services/project-onboarding.md) を参照してください。 ウィザードの完了時に、既存の **LCS プロジェクトを別のテナントから移動** し、ソース LCS プロジェクト ID を提供する **プロジェクトの概要** ページで、このウィザードを指定する必要があります。
2. LCS を完全に構成します。 この構成の一部として、次の作業を行う必要があります。
    1. サブスクリプション見積もりをアップロードして有効にします。 ソース LCS プロジェクトで既に住んでいる場合は、見積が一致することを確認する必要があります。
    2. 配置可能パッケージをアセット ライブラリに追加します。
    3. ビジネス プロセス モデラー (BPM) ライブラリの更新。

> [!IMPORTANT]
> この期間中、2 つの並列 LCS プロジェクトがあります。 LCS 内の **利用可能なサブスクリプション** ページの LCS プロジェクトに関連付けられている Azure AD テナントの名前と ID を確認できます。

## <a name="move-your-sandbox-environments-to-the-new-tenant"></a>サンドボックス環境を新しいテナントに移動する
1. 新しい LCS プロジェクトの非運用環境を配置します。
2. 必要なコード パッケージを環境に適用します。 そのターゲットで、ソースと同じバージョンのアプリケーションが実行されていることを確認します。 該当する場合は、[オールインワン配置可能パッケージ](../../dev-itpro/dev-tools/aio-deployable-packages.md) を使用し、ISV ライセンスを含めることをお勧めします。
3. 環境にデータをアップロードします。 データ パッケージを使用してデータを移動することも、データベースを復元することもできます。 データベースを復元する場合は、いくつかのプロパティを新しいテナントに再マップするために追加の手順が必要です。
4. ユーザー情報を更新します。
    1. 管理者ユーザーを除くすべてのユーザー アカウントを削除します。
    2. USERINFO の管理者ユーザー レコードを修正します。
    
    ```sql
        UPDATE USERINFO
        SET SID='mysid', NETWORKALIAS='myalias/email', NETWORKDOMAIN='https://sts.windows.net'
        WHERE ID = 'Admin'
        ```
5. Re-import all other users that have the correct security identifier (SID) and identity provider.
6. Run the following commands to update the tenant ID in the appropriate tables. You can verify the Azure AD tenant ID that is associated with an LCS project on the **Subscriptions available** page in LCS.
    
    ```sql
    Update POWERBICONFIG set TENANTID = 'newtenantid' where TENANTID = 'oldtenantid'
    Update PROVISIONINGMESSAGETABLE set TENANTID = 'newtenantid' where TENANTID = 'oldtenantid'
    Update B2BINVITATIONCONFIG set TENANTID = 'newtenantid' where TENANTID = 'oldtenantid'
    Update RETAILSHAREDPARAMETERS set TENANTID = 'newtenantid' where TENANTID = 'oldtenantid'
    ```

7. 環境を完全に構成します。 この手順の一部として、統合のエンドポイントをコンフィギュレーションします。
8. 新しい LCS プロジェクトのユーザー受け入れテスト (UAT) 環境でスモーク テストを実行します。 これらのテストでは、ユーザーのサインイン、統合、ワークフロー、印刷、レポート、および構成やユーザー情報に依存する同様のプロセスに焦点を当てる必要があります。

ソリューションとスコープに応じて、新しい Azure AD テナントで追加の手順を実行する必要があります。 これらの手順には、アプリケーションの登録 (定期的な統合と倉庫管理のため)、ドメインの追加、およびシングル サインオン (SSO) を有効にするディレクトリ同期の設定が含まれます。

Web サービスへの呼び出しが、環境の **ホーム** テナントからのみ許可されていることに注意してください。 たとえば、元のテナントは companya.com であり、統合は `services\@companya.com` として実行されました。 この場合、テナントを companyb.com に切り替えると、**userInfo.networkdomain** を `https://sts.windows.net/companyb.com` に更新してもWeb サービスの呼び出しに対して `services\@companya.com` を使用できなくなります。

> [!IMPORTANT]
> サンドボックス環境で、Azure Blob Storage に保存されている添付ファイルを処理するドキュメントは失われます。 Blob ストレージは、Microsoft によって運用環境に対してのみ移動されます。

## <a name="move-your-production-environment-to-the-new-tenant"></a>運用環境を新しいテナントに移動する

古いテナントに既に運用環境が配置されていない場合は、このセクションを省略できます。

古いテナントに運用環境が既に配置されていた場合、Microsoft は、データベースと Azure Blob のストレージを、古い運用環境から新しい運用環境に移動します。 前提条件として、すべてのサンドボックス環境と完了した UAT の移動が終了した後で、追加の手順を完了する必要があります。 運用環境を新しいテナントに移動するプロセスには、ダウンタイムが必要です。

運用環境を要求する前に、すべての前提条件が完了していることを確認します。

1. 運用環境ですべてのユーザーを正しくライセンスするために必要なライセンスを取得します。
2. ライセンスが準備できたら、新しい LCS プロジェクトにサブスクリプション見積もりをアップロードします。 これは、ソース LCS プロジェクトで有効なサブスクリプション見積もりに一致する必要があります。また、ピーク トランザクション ボリュームを正確に反映する必要があります。
3. Dynamics 365 FO Go Live (d365fogl\@microsoft.com) に、新しい LCS プロジェクトで Microsoft が運用データベースと Azure Blob ストレージを移動する準備ができていることを示す電子メールを送信します。 プロセスがスムーズに実行されるようにするには、電子メールに次の詳細を提供します。 次のリストを電子メールにコピーしてから、すべての情報に 1 行ずつ答えることをお勧めします。

    **Lifecycle Services**
    - ソースおよびターゲット LCS プロジェクトの LCS ID (LCS プロジェクト URL 番号) を提供します。
    - 運用日付をターゲット LCS プロジェクトで正しく設定していることを確認します。
    - 更新スケジュールが、ターゲット LCS プロジェクト (**LCS > メニュー > プロジェクト設定 > 更新設定**) で設定されていることを確認します。
    - ドキュメントの添付ファイルに対して Azure Blob ストレージを使用しているかどうかを確認します。
    - プロジェクト オンボード ウィザードで、プロジェクトがテナント移動として識別されていることを確認します。
    
    **テスト**
    - ターゲット LCS プロジェクトのサンドボックス環境 (Tier-2 またはそれ以降) でスモーク テストが完了していることを確認します。
    
    **コード管理**
    - 配置可能なパッケージが、ターゲット LCS プロジェクトでリリース候補としてマークされていることを確認します。
    - 使用している ISV ソリューションを一覧表示します。
    - 古い運用環境を実行しているバージョンを確認します。
    - データベースのコピーの問題を防ぐために、新しい運用環境に適用される非標準コードが、古い運用環境に存在する非標準コードとまったく同じであることを確認します。
    - カスタム フォントや高度な環境のインストールなど、新しい運用環境で考慮する必要がある、古い運用環境で実行された非典型的なアクションがあるかどうかを確認します。
    
    **環境**
    - 新しい運用環境を配置するために計画している環境のバージョンを共有します。
    - 業務をどのようにして行うかを説明します。
    - ソース LCS 環境およびプロジェクトの割り当てを解除して削除する日付を確認します。
    
4. Dynamics 365 FO Go-Live チームは 2 営業日以内にご回答します。さらに、FastTrack ソリューション アーキテクトは、運用配置に対するプロジェクトの準備の評価において、協力して作業します。
5. テナント移動評価が正常に完了すると、FastTrack ソリューション アーキテクトが配置用に運用要求を承認します。
6. 新しい LCS プロジェクトに対して運用配置要求を作成します。

    - 古い運用環境で使用されているので、新しい運用環境に対して同じ名前を選択することはできません。 新しい URL が生成されるように、新しい環境名を選択する必要があります。
    - 現在の運用環境で使用されているのと同じアプリケーション バージョンを選択していることを確認してください。
    - 運用構成ウィザードで、環境管理者として、名前付きユーザーではなく汎用ユーザー アカウントを選択します。

7. 運用環境を配置した後、ソース環境とターゲット環境のコードがまったく同じであることを確認します。それ以外の場合は、移行は失敗します。 必要に応じて、配置可能なパッケージをターゲットの運用環境にインストールする必要があります。
8. 古い運用環境から新しい運用環境にデータベースと BLOB ストレージをコピーすることを要求します。

     - **セルフ サービス環境へのクラウド配置**: タイプ **その他** の[サービス要求を送信](../../dev-itpro/lifecycle-services/submit-request-dynamics-service-engineering-team.md)して、Microsoft サービス エンジニアリング チームがデータベースと Blob ストレージを (該当する場合)、古い運用環境から新しい運用環境にコピーするよう要求します。 サービス要求には、ソースとターゲット プロジェクトの LCS ID および環境 ID が含まれていることを確認してください。
     
     - **両方のプロジェクト (新旧) はセルフ サービス配置です**: **サポート チケット** を送信して、データベースと Blob ストレージのコピーを (該当する場合)、古い運用環境から新しい運用環境に要求します。 サポート チケットには、ソースとターゲット プロジェクトの LCS ID および環境 ID が含まれていることを確認してください。
     
     
    1. このプロセスには、Microsoft と実装するプロジェクト チームとの間の対話が必要です。 電子メール通知または通知をサービス要求で直接フォローしていることを確認します。 
    2. Microsoft が活動を完了し、更新された情報が提供された後、新しい運用環境を検証する必要があります。 
    3. 移行後に問題が発生した場合は、サポート チケットをファイルします。

## <a name="tear-down-the-lcs-project-on-the-old-tenant"></a>古いテナントの LCS プロジェクトの破棄

新しい Azure AD テナントの新しい LCS プロジェクトが完全に機能した後、古い LCS プロジェクトで環境を停止、解除および削除する必要があります。 完了したとき、**コンフィグレーション** ボタンは環境ごとに使用できるようになります。 古いテナントに既に運用環境がある場合は、削除するサポート チケットをファイルする必要があります。

後で必要になる可能性のある残りのコンポーネントは、アセット ライブラリから保管する必要があります。

すべての環境を削除してすべてのアーティファクトを保存した後は、古いテナントの組織の管理者が LCS プロジェクトを削除する必要があります。
Microsoft は、顧客のアカウントを無効にし、サービスが長期間にわたって中断された後に顧客データを削除する権限を保有します。

## <a name="suspend-subscriptions-on-the-old-tenant"></a>古いテナントでサブスクリプションを中断します。

すべての環境が削除されると、必要な LCS コンポーネントを保存し、クラウド サービス プロバイダまたは Volume Licensing Support と協力して、以前の Azure AD テナントのすべてのライセンスを中断します。

- **クラウド サービス プロバイダー** - 古いテナントに対して既存のサブスクリプションを中断します。
- **ボリューム ライセンス サポート** - 作業が完了したこと、およびサブスクリプションが古いテナントに対してすぐ中断することを確認するボリューム ライセンス サポートを呼び出します。


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
