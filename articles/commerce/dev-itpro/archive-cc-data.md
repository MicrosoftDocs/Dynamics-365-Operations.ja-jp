---
title: クレジット カード トランザクション データのアーカイブ
description: このトピックでは、クレジット カード トランザクションをアーカイブに保存することでデータベースの領域を解放できる、Microsoft Dynamics 365 Commerce のアーカイブ ジョブについて説明します。
author: rubendel
ms.date: 01/28/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: IT Pro
ms.reviewer: v-chgri
ms.search.scope: Operations, Retail
ms.custom: 141393
ms.assetid: e23e944c-15de-459d-bcc5-ea03615ebf4c
ms.search.region: Global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: AX 7.0.1
ms.openlocfilehash: 19c2c3c330e0e4263e4b2da6316a0fccc646327e00357c470918c1ff5138c66e
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/05/2021
ms.locfileid: "6750702"
---
# <a name="archive-credit-card-transaction-data"></a>クレジット カード トランザクション データのアーカイブ

[!include [banner](../includes/banner.md)]
[!include [banner](../includes/preview-banner.md)]

このトピックでは、クレジット カード トランザクションをアーカイブに保存することでデータベースの領域を解放できる、Microsoft Dynamics 365 Commerce のアーカイブ ジョブについて説明します。 このジョブは、コマース バージョン 10.0.17 リリース時点で使用できます。

クレジット カードの認証ごとに、認証バイナリ ラージ オブジェクト ([auth BLOB](#key-terms)) がデータベースに格納されます。 Auth BLOB には、認証に関連するデータが含まれます。 時間が経過すると、これらの auth BLOB は増加し、データベースの容量を大量に得ることができます。 このトピックに説明されているジョブを使用すると、Azure Blob Storage にエクスポートしデータベースからデータを削除することで、auth BLOB データをアーカイブすることができます。

アーカイブ ジョブのパラメータは、トランザクションの日数に基づいて指定されます。 つまり、ジョブの **最小トランザクションの日数** フィールドが **365** 日に設定されている場合、たとえば 365 日以上経過しているクレジット カード認証に関するすべての XML データが、ジョブの実行時にアーカイブの対象になります。

> [!IMPORTANT]
> アーカイブしたデータを簡単に復元できません。 したがって、[リンクされた払戻し](#key-terms) の対象となるトランザクションはアーカイブする必要はありません。 たとえば、販売者の返品ポリシーで、2 日以内に同じクレジット カードへの払戻しをトランザクションで許可している場合、ジョブの **トランザクションの最小期間** フィールドは 730 日 (2年) に設定する必要があります。 この場合、730 日後にトランザクションが戻された場合、リンクされた払戻しを実行する必要がある XML は検出されません。 したがって、顧客はクレジット カードまたはクレジット メモやギフト カードなどの他の支払方法に対する[スタンドアロンの払戻し](#key-terms) を通じて、払戻しを受け取る必要があります。

## <a name="key-terms"></a>重要な用語

| 相談 | 説明 |
|---|---|
| Auth BLOB | クレジット カード プロセッサが支払要求に対して返す応答。 この応答は XML ファイルに格納され、時間の節約に基いてデータベースの容量を大量に使用できます。 |
| リンクされた払戻 | 前のトランザクションを参照する払戻し要求。 クレジット カード プロセッサは、リンクされた払戻しのリスクを伴と見なし、関連する手数料が低くなります。 |
| スタンドアロンの払戻し | 以前のトランザクションを参照しない払戻し要求。 スタンドアロンの払戻ではリスクが高く、処理手数料も高くなります。 |

## <a name="document-management-dependency"></a>ドキュメント管理の依存関係

アーカイブ ジョブを実行すると、ドキュメント管理を使用して、zip ファイル内の古いクレジット カード認証に関する XML データがエクスポートされます。 ドキュメント管理が環境で設定されていない場合、アーカイブ ジョブを正常に実行できません。 詳細については、[ドキュメント管理のコンフィギュレーション](../../fin-ops-core/fin-ops/organization-administration/configure-document-management.md) を参照してください。

アーカイブ ジョブでは、**トランザクションの最小日数** の値で定義されている条件を満たすすべてのクレジット カード支払データが処理されます。 ジョブが有効であり、定義された基準に基づいて大量のレコードを処理する必要がある場合、ジョブの実行に数日かかる場合があります。 ただし、支払のバックログがアーカイブされた後は、ジョブの実行に時間はかかりません。

## <a name="data-that-is-in-scope-for-archiving"></a>アーカイブの対象範囲にあるデータ

アーカイブ ジョブはデータを **RetailTransactionPaymentTrans** タブの **PaymentAuthorization**、**PaymentCaptureToken** および **PaymentCardToken** フィールドにアーカイブします。 アーカイブされたトランザクションには、これらのフィールドに関連付けられたデータは存在しないが、リンクされた払戻しは一度も行わずに返品できます。

## <a name="batch-job-setup"></a>バッチ ジョブの設定

**小売とコマース \> 小売とコマース IT \> クリーン アップ \> クレジット カードのトランザクション データをアーカイブ** を実行すると、コマース本社のアーカイブ ジョブにアクセスできます。 **クレジット カード トランザクション データのアーカイブ** ダイアログ ボックスでは、**トランザクションの最小日数** フィールドが必須フィールドです。 アーカイブの対象となるクレジット カード認証の日数を入力します。 入力する値は、顧客が元のクレジット カード認証にリンクされている払戻しを受け取る時間数である必要があります。 このフィールドを 365 日に設定した場合、たとえば販売者のポリシーによっては、366 日後のトランザクションに対する返品は払戻しの対象となる場合があります。 ただし、リンクされた払戻しを実行するために必要なデータは使用できため、実行された払戻しはスタンドアロンの払戻しである必要があります。

**トランザクションの最小日数** フィールド加えて、**クレジット カード トランザクション データのアーカイブ** ダイアログ ボックスでは、ジョブの繰り返しオプションが含まれます。 既定では、ジョブのバッチ処理が有効で、無効にできない必要があります。

次の図では、**クレジット カード トランザクション データをアーカイブ** ダイアログ ボックスのパラメータ設定例を示しています。

![クレジット カード トランザクション データのアーカイブ ダイアログ ボックスのパラメーター設定。](media/PAYMENTS/Batch1.png)

**最小トランザクションの日数** フィールドおよびバッチ詳細が設定された後、**次へ** を選び、エクスポートされるデータ サンプルを表示します。 次の図は、例を示します。 このサンプルのデータは限られていますが、アーカイブの対象となるすべてのデータをエクスポートできます。

![エクスポートされるデータのサンプル。](media/PAYMENTS/Batch2.png)

> [!IMPORTANT]
> アーカイブの対象となるデータには、カード所有者の名前など、個人を特定できる顧客情報が含まれます。 この機密データは、地域の規制要件に従って処理する必要があります。

次の図に示すように、アーカイブする必要があるデータのパラメータを確認した後、アーカイブされているデータを簡単に復元できないという確認を求めるメッセージが表示されます。

![確認用メッセージボックス。](media/PAYMENTS/Batch3.png)

**はい** を選び、アーカイブ ジョブが有効になると、**トランザクションの最小日数** 値よりも古いクレジット カードの認証に関するすべての XML データはアーカイブの対象になります。

## <a name="additional-resources"></a>追加リソース

[支払に関するよく寄せられる質問](/dynamics365/unified-operations/retail/dev-itpro/payments-retail)

[Adyen 向け Dynamics 365 Payment Connector](adyen-connector.md?tabs=8-1-3)

[チェックアウト モジュール](../add-checkout-module.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]