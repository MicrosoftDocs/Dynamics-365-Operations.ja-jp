---
title: カスタマイズされた Modern POS のデバイスの有効化
description: このトピックでは、カスタマイズした Modern POS アプリケーションを使用する場合に、デバイスの有効化が正常に動作するように、Microsoft Dynamics 365 Commerce Headquarters を構成する方法について説明します。
author: jashanno
manager: AnnBe
ms.date: 02/08/2021
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: IT Pro
ms.reviewer: rhaertle
ms.search.region: Global
ms.author: jashanno
ms.search.validFrom: 2017-09-30
ms.dyn365.ops.version: Application update 3
ms.openlocfilehash: bbb3cf24211f8bdd70eaf1a246782947ce3f8316
ms.sourcegitcommit: ca05440ee503bf15fe98fe138d317c1cdf21ad16
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/09/2021
ms.locfileid: "5141864"
---
# <a name="device-activation-of-a-customized-modern-pos"></a><span data-ttu-id="8d7a9-103">カスタマイズされた Modern POS のデバイスの有効化</span><span class="sxs-lookup"><span data-stu-id="8d7a9-103">Device activation of a customized Modern POS</span></span>

[!INCLUDE [banner](../includes/banner.md)]

<span data-ttu-id="8d7a9-104">このトピックでは、カスタマイズした Modern POS アプリケーションを使用する場合に、デバイスの有効化が正常に動作するように、Microsoft Dynamics 365 Commerce Headquarters を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-104">This topic explains how to configure Microsoft Dynamics 365 Commerce Headquarters so that device activation works correctly when a customized Modern POS application is used.</span></span> <span data-ttu-id="8d7a9-105">カスタマイズされた返信アドレスを取得し、Headquarters でその値を入力するために必要な手順を説明します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-105">It describes the steps that are required in order to obtain the customized reply address and enter that value in Headquarters.</span></span>

<span data-ttu-id="8d7a9-106">Modern POS は、Microsoft Dynamics 365 Commerce のクライアント側コンポーネントです。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-106">Modern POS is a client-side component for Microsoft Dynamics 365 Commerce.</span></span> <span data-ttu-id="8d7a9-107">POS を使用するには、デバイスの有効化を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-107">To use the POS, you must perform device activation.</span></span> <span data-ttu-id="8d7a9-108">デバイスの有効化は、ユーザーを認証する Azure Active Directory (Azure AD) を使用します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-108">Device activation uses Microsoft Azure Active Directory (Azure AD) to authenticate users.</span></span> <span data-ttu-id="8d7a9-109">この領域の拡張機能は、Web アカウント マネージャー サービスを活用するためにデバイスの有効化のフローを変更しました。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-109">Enhanced functionality in this area has modified the device activation flow to take better advantage of the Web Account Manager service.</span></span> <span data-ttu-id="8d7a9-110">この拡張の一部として、認証承認プロセスのセキュリティが強化されました。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-110">As part of this enhancement, there is now enhanced security for the authentication approval process.</span></span> <span data-ttu-id="8d7a9-111">このセキュリティ強化では、コールバック URI に特定の一意の値が必要になるため、POS のカスタマイズ時に Headquarters で追加設定が必要です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-111">This enhanced security requires additional configuration in Headquarters when the POS is customized, because a specific, unique value is now required for the callback URI.</span></span> <span data-ttu-id="8d7a9-112">(コールバック URI は、リダイレクト URI とも呼ばれます。)</span><span class="sxs-lookup"><span data-stu-id="8d7a9-112">(The callback URI is also known as the redirect URI.)</span></span>

<span data-ttu-id="8d7a9-113">既定では、Modern POS はこのコールバック URI に既に登録されています。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-113">By default, Modern POS is already registered for this callback URI.</span></span> <span data-ttu-id="8d7a9-114">ただし、カスタマイズするとき、コールバック URI が変更されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-114">However, when customized, the callback URI is changed.</span></span> <span data-ttu-id="8d7a9-115">したがって、再度動作するように正しく構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-115">Therefore, it must be correctly configured so that it works again.</span></span> <span data-ttu-id="8d7a9-116">このトピックでは、この構成を完了するために従う必要がある手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-116">This topic describes the steps that you must follow to complete this configuration.</span></span> <span data-ttu-id="8d7a9-117">この構成が完了していない場合、カスタマイズされた POS アプリケーションでデバイスの有効化を実行しようとすると、エラー メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-117">If this configuration isn't completed, you receive an error message when you try to perform device activation in the customized POS application.</span></span> <span data-ttu-id="8d7a9-118">このエラー メッセージは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-118">This error message resembles the following example:</span></span>

> <span data-ttu-id="8d7a9-119">AADSTS50011: 返信アドレス「ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]」はアプリケーションで構成された返信アドレスと一致しません。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-119">AADSTS50011: The reply address 'ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]' does not match the reply addresses configured for the application.</span></span>

<span data-ttu-id="8d7a9-120">返信アドレスは、上記のエラー メッセージの最後に表示される Modern POS パッケージ SID に依存します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-120">The reply address is dependent on the Modern POS package SID that is shown at the end of the above error message.</span></span> <span data-ttu-id="8d7a9-121">これは Package Family Name (PFN) の機能なので、名前と公開キーに依存します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-121">This is a function of the Package Family Name (PFN), so it is dependent on a name and public key.</span></span> <span data-ttu-id="8d7a9-122">つまり、Modern POS をカスタマイズし、会社の証明書で署名すると、SID は変更されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-122">This means that when you customize Modern POS and sign it with your company certificate, the SID will change.</span></span> <span data-ttu-id="8d7a9-123">変更はパッケージのバージョンではなく証明書に基づいているので、パッケージ全体が変わらず、証明書が同じである限り、SID は同じままです。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-123">The change is based on the certificate and not the package version, so as long as the entire package is not different and the certificate remains the same (which can be renewed to keep the same signature), then the SID will remain the same.</span></span>

> [!NOTE]
> <span data-ttu-id="8d7a9-124">Dynamics 365 Headquarters を構成する前に、カスタマイズされた Modern POS アプリケーションを 1 回使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-124">We recommend that you try to use the customized Modern POS application one time before you configure Dynamics 365 headquarters.</span></span> <span data-ttu-id="8d7a9-125">これにより、エラー メッセージがどのようなものかを確認し、カスタマイズされた返信アドレスをより簡単に取得できます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-125">In this way, you can see what the error message looks like and more easily obtain the customized reply address.</span></span>

## <a name="setup"></a><span data-ttu-id="8d7a9-126">段取り</span><span class="sxs-lookup"><span data-stu-id="8d7a9-126">Setup</span></span>
<span data-ttu-id="8d7a9-127">次の手順は、カスタマイズされた Modern POS アプリケーションを使用する場合に、デバイスの有効化が正常に動作できるようにするために必要です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-127">The following steps are required so that device activation works correctly when the customized Modern POS application is used.</span></span> <span data-ttu-id="8d7a9-128">2 つの Azure AD アプリケーションを作成します。1 つは Modern POS 用、1 つは Commerce Scale Unit 用です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-128">You will create two Azure AD applications: one for Modern POS and one for Commerce Scale Unit.</span></span> <span data-ttu-id="8d7a9-129">POS は Commerce Scale Unit を通じてリソースを使用するため、Commerce Scale Unit Azure AD アプリケーションが必要です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-129">The Commerce Scale Unit Azure AD application is required because the POS uses resources through Commerce Scale Unit.</span></span> <span data-ttu-id="8d7a9-130">したがって、POS が使用される場合は両方の Azure AD アプリケーションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-130">Therefore, both Azure AD applications are used when the POS is used.</span></span> <span data-ttu-id="8d7a9-131">このシナリオでは、Commerce Scale Unit は、POS が要求する保護されているリソースのエンドポイントとして機能します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-131">In this scenario, Commerce Scale Unit serves as the endpoint for protected resources that the POS requests.</span></span>

### <a name="create-the-commerce-scale-unit-azure-ad-application"></a><span data-ttu-id="8d7a9-132">Commerce Scale Unit Azure AD アプリケーションの作成</span><span class="sxs-lookup"><span data-stu-id="8d7a9-132">Create the Commerce Scale Unit Azure AD application</span></span>
1. <span data-ttu-id="8d7a9-133">Web ブラウザーで、<https://portal.azure.com/>に移動します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-133">In a web browser, go to <https://portal.azure.com/>.</span></span>
2. <span data-ttu-id="8d7a9-134">Azure AD アプリケーションを作成するための十分なアクセス許可を持つ Azure AD 資格情報を使用してログインします。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-134">Sign in by using Azure AD credentials that have enough permission to create Azure AD applications.</span></span>
3. <span data-ttu-id="8d7a9-135">Azure サービスの一覧から **Azure Active Directory** を選択し、表示される左端のメニューから **アプリの登録** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-135">Select **Azure Active Directory** from the list of Azure services, then select **App registrations** from the leftmost menu that appears.</span></span>
4. <span data-ttu-id="8d7a9-136">**新しい登録** を選択して、次の値を入力することにより、Commerce Scale Unit Azure AD アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-136">Create the Commerce Scale Unit Azure AD application by selecting **New registration** and entering the following values:</span></span>

    - <span data-ttu-id="8d7a9-137">**名前:** **カスタマイズされた Commerce Scale Unit** を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-137">**Name:** Enter **Customized Commerce Scale Unit**.</span></span> <span data-ttu-id="8d7a9-138">他の固有の値を入力できますが、入力された名前を記録しておいてください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-138">You can enter any other unique value, but be sure to make a note of the name entered.</span></span>
    - <span data-ttu-id="8d7a9-139">**サポートされる勘定タイプ:** このアプリケーションの登録が **すべての組織のディレクトリの勘定** の値を要求する複数のテナント間で使用される場合を除き、**この組織のディレクトリの勘定のみ** の値を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-139">**Supported account types:** Select the value **Accounts in this organization directory only** unless this application registration will be used across multiple tenants, which would require the next value **Accounts in any organizational directory**.</span></span> <span data-ttu-id="8d7a9-140">この選択は一般的ではないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-140">Note that this selection is not typical.</span></span>
    - <span data-ttu-id="8d7a9-141">**リダイレクト URI:** この値は空白のままにすることができますが、ドロップダウンの初期の選択が **Web** に設定されていることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-141">**Redirect URI:** This value can be left blank but you need to verify that the initial drop-down selection is set to **Web**.</span></span>

5. <span data-ttu-id="8d7a9-142">ページの下部にある **登録** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-142">Select **Register** at the bottom of the page.</span></span> <span data-ttu-id="8d7a9-143">ページは、新しく作成された Azure AD アプリケーションに変更されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-143">The page will change to the newly created Azure AD application.</span></span>
6. <span data-ttu-id="8d7a9-144">**アプリケーション ID URI の追加** と表示されているリンクのある **アプリケーション ID URI** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-144">Select **Application ID URI** where it has a link stating **Add an Application ID URI**.</span></span> <span data-ttu-id="8d7a9-145">このページは、**API の公開** を選択することによって左のメニューからアクセスすることもできます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-145">This page can also be reached from the left menu by selecting **Expose an API**.</span></span>
7. <span data-ttu-id="8d7a9-146">開かれたタイルで、**設定** と表示されている **アプリケーション ID URI** の値を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-146">On the tile that opens, select the **Application ID URI** value that states **Set**.</span></span> <span data-ttu-id="8d7a9-147">**保存** ボタンを選択する前に表示された値をコピーします。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-147">Copy the value shown before selecting the **Save** button.</span></span> <span data-ttu-id="8d7a9-148">この値は、次のセクションで POS の DLLHost.exe.config ファイルに貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-148">You will paste this value into the DLLHost.exe.config file for POS in the next section.</span></span>
8. <span data-ttu-id="8d7a9-149">**保存** を選択し、この URI を設定します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-149">Select **Save** to set this URI.</span></span>
9. <span data-ttu-id="8d7a9-150">**スコープの追加** ボタンを選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-150">Select the **Add a scope** button.</span></span>
10. <span data-ttu-id="8d7a9-151">表示されるスライダーで、次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-151">In the slider that appears, enter the following values:</span></span>

    - <span data-ttu-id="8d7a9-152">**スコープ名:** **AccessRetailServer** を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-152">**Scope name:** Enter **AccessRetailServer**.</span></span> <span data-ttu-id="8d7a9-153">他の固有の値を入力できますが、入力された名前を記録しておいてください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-153">You can enter any other unique value, but be sure to make a note of the name entered.</span></span>
    - <span data-ttu-id="8d7a9-154">**同意できるユーザー**: **管理者とユーザー** オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-154">**Who can consent**: Select the **Admins and users** option.</span></span>
    - <span data-ttu-id="8d7a9-155">**管理者の同意の表示名:** **AccessRetailServer** を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-155">**Admin consent display name:** Enter **AccessRetailServer**.</span></span> <span data-ttu-id="8d7a9-156">単純化のために、この値は上記の **スコープ名** と一致させます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-156">For simplicity, make this value match the **Scope name** above.</span></span>
    - <span data-ttu-id="8d7a9-157">**管理者の同意の説明:** **AccessRetailServer** を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-157">**Admin consent description:** Enter **AccessRetailServer**.</span></span> <span data-ttu-id="8d7a9-158">ここにはどの値も入力することができます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-158">You can enter any value here.</span></span> <span data-ttu-id="8d7a9-159">これはスコープの理由を記録するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-159">This is used noting the reason for the scope.</span></span>
    - <span data-ttu-id="8d7a9-160">**ユーザーの同意の表示名** および **ユーザーの同意の説明** は使用されません。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-160">The fields **User consent display name** and **User consent description** will not be used.</span></span>
    - <span data-ttu-id="8d7a9-161">**状態:** **有効** が選択されているか確認します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-161">**State:** Verify that **Enabled** is selected.</span></span>

11. <span data-ttu-id="8d7a9-162">**スコープの追加** ボタンを選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-162">Select the **Add scope** button.</span></span>
12. <span data-ttu-id="8d7a9-163">左端のメニューの **概要** タブを選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-163">Select the **Overview** tab on the leftmost menu.</span></span> <span data-ttu-id="8d7a9-164">**アプリケーション ID URI** の値が手順 7 でコピーされたものと一致していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-164">Verify that the **Application ID URI** value matches what was copied back in step seven.</span></span>

> [!NOTE]
> <span data-ttu-id="8d7a9-165">このトピックの後半で再び使用するため、Web ブラウザー ウィンドウを閉じないでください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-165">Do not close the web browser window because you will use it again later in this topic.</span></span>

### <a name="update-the-modern-pos-configuration"></a><span data-ttu-id="8d7a9-166">Modern POS 構成の更新</span><span class="sxs-lookup"><span data-stu-id="8d7a9-166">Update the Modern POS configuration</span></span>
1. <span data-ttu-id="8d7a9-167">ファイル エクスプローラーで、**C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\Retail Modern POS\\ClientBroker** に移動します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-167">In File Explorer, go to **C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\Retail Modern POS\\ClientBroker**.</span></span> <span data-ttu-id="8d7a9-168">(このパスは、コンピューターの Microsoft Windows オペレーティング システムが、x64 アーキテクチャ ベースであることを前提としています)。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-168">(This path assumes that the Microsoft Windows operating system on the computer is based on the x64 architecture.)</span></span>
2. <span data-ttu-id="8d7a9-169">エクスプローラーで、**ファイル** \> **Windows PowerShell を開く** \> **管理者として Windows PowerShell を開く** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-169">In File Explorer, select **File** \> **Open Windows PowerShell** \> **Open Windows PowerShell as administrator**.</span></span>
3. <span data-ttu-id="8d7a9-170">表示された Microsoft Windows PowerShell ウィンドウで、**notepad DLLHost.exe.config** と入力して Enter キーを押します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-170">In the Microsoft Windows PowerShell window that appears, enter **notepad DLLHost.exe.config**, and then press the Enter key.</span></span> <span data-ttu-id="8d7a9-171">(Windows PowerShell ウィンドウは、現在のファイル ディレクトリを既にポイントしています。)</span><span class="sxs-lookup"><span data-stu-id="8d7a9-171">(The Windows PowerShell window will already be pointed to the current file directory.)</span></span>
4. <span data-ttu-id="8d7a9-172">表示されたメモ帳ウィンドウで、**AADRetailServerResourceId** キーに対応する値を見つけます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-172">In the Notepad window that appears, find the value that corresponds to the **AADRetailServerResourceId** key.</span></span> <span data-ttu-id="8d7a9-173">(この値は、既定では `https://commerce.dynamics.com` です)。次に、前のセクションの手順 7 でコピーしたアプリケーション ID URI 値を貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-173">(By default, this value is `https://commerce.dynamics.com`.) Then paste the App ID URI value that you copied in step 7 in the previous section.</span></span>
5. <span data-ttu-id="8d7a9-174">**ファイル** \> **保存** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-174">Select **File** \> **Save**.</span></span>

> [!NOTE]
> <span data-ttu-id="8d7a9-175">次にセクションで再び使用するため、メモ帳ウィンドウを閉じないでください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-175">Don't close the Notepad window, because you will use it again in the next section.</span></span>
> <span data-ttu-id="8d7a9-176">上記の手順を実行する別の方法は、スクリプトまたはインストール後の手順のカスタマイズを使用することです。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-176">Another way to perform the above steps would be to use a script or a post-step installation customization.</span></span>

### <a name="create-the-customized-modern-pos-azure-ad-application"></a><span data-ttu-id="8d7a9-177">カスタマイズされた Modern POS Azure AD アプリケーションを作成する</span><span class="sxs-lookup"><span data-stu-id="8d7a9-177">Create the customized Modern POS Azure AD application</span></span>
1. <span data-ttu-id="8d7a9-178"><https://portal.azure.com/> が開いている Web ブラウザー ウィンドウに戻り、「Commerce Scale Unit Azure AD アプリケーションを作成する」セクションの手順 3 から 5 を繰り返して、Retail Modern POS Azure AD アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-178">Return to the web browser window where <https://portal.azure.com/> is open, and create the Retail Modern POS Azure AD application by repeating steps 3-5 in the "Create the Commerce Scale Unit Azure AD application" section.</span></span> <span data-ttu-id="8d7a9-179">ただし、今回は次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-179">However, enter the following values this time:</span></span>

    - <span data-ttu-id="8d7a9-180">**名前:** **カスタマイズされた Retail Modern POS** を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-180">**Name:** Enter **Customized Retail Modern POS**.</span></span> <span data-ttu-id="8d7a9-181">(他の固有の値を入力できますが、入力された名前を記録しておいてください。)</span><span class="sxs-lookup"><span data-stu-id="8d7a9-181">(You can enter any other unique value, but be sure to make a note of the name entered.)</span></span>
    - <span data-ttu-id="8d7a9-182">**サポートされる勘定タイプ:** このアプリケーションの登録が **すべての組織のディレクトリの勘定** の値を要求する複数のテナント間で使用される場合を除き、**この組織のディレクトリの勘定のみ** の値を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-182">**Supported account types:** Select the value **Accounts in this organization directory only** unless this application registration will be used across multiple tenants, which would require the next value **Accounts in any organizational directory**.</span></span> <span data-ttu-id="8d7a9-183">この選択は一般的ではないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-183">Note that this selection is not typical.</span></span>
    - <span data-ttu-id="8d7a9-184">**リダイレクト URI:** 初期のドロップダウン 値は、**パブリック クライアント/ネイティブ (モバイル & デスクトップ)** に変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-184">**Redirect URI:** The initial drop-down value should be changed to **Public client/native (mobile & desktop)**.</span></span> <span data-ttu-id="8d7a9-185">このタイプのリダイレクト URI に入力する値は、受信した Modern POS エラー メッセージのこのトピックの冒頭に表示される値です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-185">The value to enter for this type of Redirect URI is the value shown at the beginning of this topic in the Modern POS error message received.</span></span> <span data-ttu-id="8d7a9-186">そのエラー メッセージに対応する返信アドレス (リダイレクト URI) を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-186">Enter the reply address (redirect URI) that corresponds to that error message.</span></span> <span data-ttu-id="8d7a9-187">値の先頭は **ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]** です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-187">The value will start with **ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]**.</span></span>

        > [!NOTE]
        > - <span data-ttu-id="8d7a9-188">Windows のイベント ビューアーの **Microsoft-Dynamics-Commerce-ModernPos/Operational** で返信アドレス (リダイレクト URI) を表示することもできます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-188">You can also see the reply address (redirect URI) in Event Viewer in Windows, under **Microsoft-Dynamics-Commerce-ModernPos/Operational**.</span></span> <span data-ttu-id="8d7a9-189">イベント ID は 40619 です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-189">The event ID is 40619.</span></span> <span data-ttu-id="8d7a9-190">エラー メッセージの先頭は "This UWP application was assigned the following callback URI to be used while interacting with Azure AD: ms-appx-web://Microsoft.AAD.BrokerPlugIn/S-1-15-2-[...]" です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-190">The error message will start with the following text: "This UWP application was assigned the following callback URI to be used while interacting with Azure AD: ms-appx-web://Microsoft.AAD.BrokerPlugIn/S-1-15-2-[...]"</span></span>
        > - <span data-ttu-id="8d7a9-191">Azure AD アプリケーションが作成されたら、必要に応じて追加リダイレクト URI を指定できます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-191">After the Azure AD application is created, you can specify additional redirect URIs as you require.</span></span> <span data-ttu-id="8d7a9-192">異なるコールバック URI のある複数のパッケージが何らかの理由で生成された場合、この 1 つの Azure AD アプリケーションを保持し、その中にすべてのリダイレクト URI を保持してください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-192">If multiple packages that have different callback URIs have been generated for any reason, keep this single Azure AD application, and maintain all redirect URIs in it.</span></span>

2. <span data-ttu-id="8d7a9-193">**リダイレクト URI** フィールドのこの値を確認することは重要です。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-193">It is important to validate this value in the **Redirect URI** field.</span></span> <span data-ttu-id="8d7a9-194">次に、**作成** を選択し、処理が正常に完了するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-194">Then select **Create**, and wait until the operation is successfully completed.</span></span> <span data-ttu-id="8d7a9-195">(エラーが発生する場合は、解決してもう一度やり直します。)</span><span class="sxs-lookup"><span data-stu-id="8d7a9-195">(If an error occurs, address it, and then try again.)</span></span>

    <span data-ttu-id="8d7a9-196">タイルに、新しいカスタマイズされた Retail Modern POS Azure AD アプリケーションの詳細が表示されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-196">A tile appears that shows the details of the new customized Retail Modern POS Azure AD application.</span></span>

3. <span data-ttu-id="8d7a9-197">ページの下部にある **登録** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-197">Select **Register** at the bottom of the page.</span></span> <span data-ttu-id="8d7a9-198">ページは、新しく作成された Azure AD アプリケーションに変更されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-198">The page will change to the newly created Azure AD application.</span></span>
4. <span data-ttu-id="8d7a9-199">**アプリケーション (クライアント) ID** フィールドを検索し、値をコピーします。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-199">Find the **Application (client) ID** field, and copy the value.</span></span> <span data-ttu-id="8d7a9-200">前のセクションで開いたメモ帳に切り替え (または、上のセクション **Modern POS コンフィギュレーションの更新** に従って、**DLLHost.exe.config** ファイルを開く)、**AADClientId** に対応する値に移動します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-200">Switch to the notepad you opened in the previous section (or follow the above section **Update the Modern POS configuration** to open the **DLLHost.exe.config** file) to navigate to the value corresponding to **AADClientId**.</span></span> <span data-ttu-id="8d7a9-201">このフィールドにこの手順の最初でコピーした値を貼り付け、(同じセクションの手順 5 に示されているように) ファイルを保存します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-201">Paste in the value for this field that was copied at the beginning of this step and then save the file (as shown in step 5 of the same section).</span></span>
5. <span data-ttu-id="8d7a9-202">Web ブラウザーに戻り、左端のメニューで、**API アクセス許可** オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-202">Returning to the web browser, in the leftmost menu, select the **API permissions** option.</span></span>
6. <span data-ttu-id="8d7a9-203">**API アクセス許可** タイルで、**+ アクセス許可の追加** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-203">On the **API permissions** tile, select **+ Add a permission**.</span></span>
7. <span data-ttu-id="8d7a9-204">表示されるスライダーで、最初に **自分の API** ヘッダーを選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-204">On the slider that appears, first select the **My APIs** heading.</span></span> <span data-ttu-id="8d7a9-205">**カスタマイズされた Commerce Scale Unit** というタイトルの API、またはこのドキュメントの最初の手順 4 で名前として入力された値を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-205">Then select the API titled **Customized Commerce Scale Unit** or whatever value was entered as the name in step 4 at the beginning of this document.</span></span>
8. <span data-ttu-id="8d7a9-206">**アクセス許可の選択** の下位ヘッダーの下で、**AccessRetailServer** またはこのドキュメントの手順 10 でスコープ名として入力された値を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-206">Under the **Select permissions** sub-heading, select **AccessRetailServer** or whatever value was entered as the scope name in step 10 at the beginning of this document.</span></span>
9. <span data-ttu-id="8d7a9-207">スライダーの下部にある **アクセス許可の追加** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-207">Select **Add permissions** at the bottom of the slider.</span></span>
10. <span data-ttu-id="8d7a9-208">**\<your AAD name\> に対して管理者の同意の付与** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-208">Select **Grant admin consent for \<your AAD name\>**.</span></span> <span data-ttu-id="8d7a9-209">**はい** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-209">Select **Yes**.</span></span> <span data-ttu-id="8d7a9-210">これにより同意を付与することになり、**AccessRetailServer** 行の **状態** 列に表示される **許可済** によって確認することができます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-210">This grants consent and can be verified with the **Granted** displaying in the **Status** column in the **AccessRetailServer** row.</span></span>

        > [!NOTE]
        > Granting consent is not required, but simplifies the process by consenting in advance for all users in your tenant (and you as the Admin). If this step is not completed, then each user will be asked for consent the first time that they try to activate Modern POS.

### <a name="configure-dynamics-365-headquarters"></a><span data-ttu-id="8d7a9-211">Dynamics 365 Headquarters の構成</span><span class="sxs-lookup"><span data-stu-id="8d7a9-211">Configure Dynamics 365 Headquarters</span></span>
<span data-ttu-id="8d7a9-212">前の手順は、Modern POS アプリケーションを認証できるようにするために必要でした。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-212">The previous steps were required so that the Modern POS application can be authenticated.</span></span> <span data-ttu-id="8d7a9-213">ここでは、要求を承認できるように、次の手順を実行し、新しい Azure AD アプリケーションを Headquarters の安全なプログラムの一覧に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-213">You must now follow these steps to add the new Azure AD applications to the list of safe programs in Headquarters, so that the requests are authorized.</span></span> <span data-ttu-id="8d7a9-214">(安全なプログラムの一覧はセーフ リストと呼ばれることもあります)</span><span class="sxs-lookup"><span data-stu-id="8d7a9-214">(A list of safe programs is sometimes also referred to as a safe list.)</span></span>

1. <span data-ttu-id="8d7a9-215">Web ブラウザーで、Headquarters URL に移動し、Azure AD 資格情報を使用してログインします。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-215">In a web browser, go to the Headquarters URL, and sign in by using Azure AD credentials.</span></span>
2. <span data-ttu-id="8d7a9-216">**Retail と Commerce** &gt; **Headquarters の設定** &gt; **パラメーター** &gt; **Commerce 共有パラメーター** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-216">Go to **Retail and Commerce** &gt; **Headquarters setup** &gt; **Parameters** &gt; **Commerce shared parameters**.</span></span>
3. <span data-ttu-id="8d7a9-217">**ID プロバイダー** タブの **ID プロバイダー** セクションで、`HTTPS://sts.windows.net/` から始まるプロバイダーを選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-217">On the **Identity Providers** tab, in the **Identity providers** section, select the provider that begins with `HTTPS://sts.windows.net/`.</span></span> <span data-ttu-id="8d7a9-218">選択したプロバイダーに基づいて、**依存する関係者** セクションの値が更新されます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-218">The values in the **Relying parties** section are updated, based on the provider that you selected.</span></span>
5. <span data-ttu-id="8d7a9-219">**依存する関係者** セクションで、**+ 追加** を選択し、次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-219">In the **Relying parties** section, select **+ Add**, and enter the following values:</span></span>

    - <span data-ttu-id="8d7a9-220">**ClientId:** 前のセクションの手順 3 でコピーし、手順 13 で DLLHost.exe.config に貼り付けた値を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-220">**ClientId:** Enter the value that you copied in step 3 in the previous section and then pasted into the DLLHost.exe.config file in step 13.</span></span>
    - <span data-ttu-id="8d7a9-221">**タイプ:** **パブリック** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-221">**Type:** Select **Public**.</span></span>
    - <span data-ttu-id="8d7a9-222">**UserType:** **作業者** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-222">**UserType:** Select **Worker**.</span></span>
    - <span data-ttu-id="8d7a9-223">**名前:** このエントリが参照する、ユーザーがわかりやすい説明を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-223">**Name:** Enter a description to help users understand what this entry references.</span></span>

6. <span data-ttu-id="8d7a9-224">アクション ウィンドウで、**保存** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-224">On the Action Pane, select **Save**.</span></span> <span data-ttu-id="8d7a9-225">作成した依存する関係者は選択したままにしてください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-225">The relying party that you just created should remain selected.</span></span>
7. <span data-ttu-id="8d7a9-226">**サーバー リソース ID** セクションで、**+ 追加** を選択し、次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-226">In the **Server resource IDs** section, select **+ Add**, and enter the following values:</span></span>

    - <span data-ttu-id="8d7a9-227">**サーバー リソース ID:** 「Modern POS 構成の更新」セクションの手順 4 でコピーした URL を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-227">**Server Resource Id:** Enter the URL that you copied in step 4 in the "Update the Modern POS configuration" section.</span></span> <span data-ttu-id="8d7a9-228">(最初は、「Commerce Scale Unit Azure AD アプリケーションを作成する」セクションの手順 4 でこの値を作成しました。)</span><span class="sxs-lookup"><span data-stu-id="8d7a9-228">(You originally created this value in step 4 in the "Create the Commerce Scale Unit Azure AD application" section.)</span></span>
    - <span data-ttu-id="8d7a9-229">**名前:** このエントリが参照する、ユーザーがわかりやすい説明を入力します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-229">**Name:** Enter a description to help users understand what this entry references.</span></span>

8. <span data-ttu-id="8d7a9-230">アクション ウィンドウで、**保存** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-230">On the Action Pane, select **Save**.</span></span>
9. <span data-ttu-id="8d7a9-231">**Retail と Commerce** &gt; **Retail と CommerceIT** \> **配送スケジュール** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-231">Go to **Retail and Commerce** &gt; **Retail and CommerceIT** \> **Distribution schedule**.</span></span>
10. <span data-ttu-id="8d7a9-232">ジョブ **1110** (**グローバル構成**) を選択し、アクション ペインで **今すぐ実行** を選択します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-232">Select job **1110** (**Global configuration**), and then, on the Action Pane, select **Run now**.</span></span> <span data-ttu-id="8d7a9-233">このジョブは、新しいデータを同期させます。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-233">This job synchronizes the new data.</span></span> <span data-ttu-id="8d7a9-234">ただし、Commerce Scale Unit にはキャッシュがあり、数分は更新されません。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-234">However, there is a cache in Commerce Scale Unit that won't be updated for several minutes.</span></span> <span data-ttu-id="8d7a9-235">したがって、迅速な更新が必要な場合、Commerce Scale Unit アプリケーション プールを再利用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-235">Therefore, if you require an immediate update, the Commerce Scale Unit application pool must be recycled.</span></span>

    > [!NOTE]
    > <span data-ttu-id="8d7a9-236">最適な結果を得るため、Modern POS が終了していることと、DLLHost.exe のインスタンスがタスク マネージャーに存在しないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-236">For best results, verify that Modern POS is closed, and that no instances of DLLHost.exe exist in Task Manager.</span></span>

### <a name="perform-modern-pos-device-activation"></a><span data-ttu-id="8d7a9-237">Modern POS のデバイスの有効化の実行</span><span class="sxs-lookup"><span data-stu-id="8d7a9-237">Perform Modern POS device activation</span></span>
<span data-ttu-id="8d7a9-238">Modern POS デバイスを有効化してください。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-238">Try to activate the Modern POS device.</span></span> <span data-ttu-id="8d7a9-239">依然として問題が発生する場合は、Windowsでイベント ビューアーを開き、Modern POS に対応するログを表示します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-239">If you still experience issues, open Event Viewer in Windows, and view the logs that correspond to Modern POS.</span></span> <span data-ttu-id="8d7a9-240">前のセクションで見逃したステップを判断する際に役立つを警告やエラーを探します。</span><span class="sxs-lookup"><span data-stu-id="8d7a9-240">Look for warnings and errors that might help you determine which steps you missed in the previous sections.</span></span>
