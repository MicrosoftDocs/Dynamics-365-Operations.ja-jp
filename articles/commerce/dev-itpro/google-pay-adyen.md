---
title: Adyen を使用して Google Pay を構成する
description: この記事では、Microsoft Dynamics 365 Commerce で Adyen を使用して Google Pay を構成する方法について説明します。
author: BrianShook
ms.date: 07/05/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: brshoo
ms.search.validFrom: 2017-06-20
ms.openlocfilehash: c3f049946c66fcd8560f7c08a4cb2beab0dcd5b2
ms.sourcegitcommit: 3d2c0a39c4f987e9ac71df2f2fa6df0f64f10b2b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/06/2022
ms.locfileid: "9115031"
---
# <a name="configure-google-pay-with-adyen"></a>Adyen を使用して Google Pay を構成する

[!include [banner](../includes/banner.md)]

この記事では、Microsoft Dynamics 365 Commerce で Adyen を使用して Google Pay を構成する方法について説明します。

Dynamics 365 Commerce は、Adyen 支払ゲートウェイ サービスを使用する場合の Google Pay との統合を最初から提供しています。 Google Pay は、Adyen 支払サービスと連携し、Google Pay マーチャント アカウントを使用するデジタル ウォレットの支払方法です。 構成されている場合、Google Pay ボタンが、オンライン注文のチェックアウト中に選択可能な支払方法として使用可能になります。 ユーザーがサポートされているブラウザまたはデバイスで **Google Pay** を選択すると、直接 Google Pay サービスで支払を完了するよう転送されます。 その後、注文を完了するためにオンライン店舗に戻ります。

Google Pay が Commerce のエクスプレス チェックアウト モジュールと使用されている場合、ユーザーの支払アカウント情報が自動的にチェックアウト フォームに入力され、ユーザーはチェックアウト プロセスをより迅速に実行することができます。 Commerce には、エクスプレス チェックアウトの動作を有効にする決済エクスプレス モジュールが含まれています。 決済エクスプレス モジュールは、チェックアウトまたはカート ページで含められるフラグメントで使用することができます。 PayPal が構成されている場合、Google Pay 向け Dynamics 365 Payment Connector のコネクタ参照は、決済エクスプレス オプションと通常のチェックアウト オプションの両方を有効にする Adyen 向け Dynamics 365 Payment Connector にも使用されます。 また、Adyen 支払ターミナルおよびコマースの販売時点管理 (POS) を使用し、店舗での使用のために Google Pay を構成することができます。

## <a name="key-terms"></a>重要な用語

| 相談 | Description |
|---|---|
| Google Pay | Google Pay 「ボタン」とも呼ばれる Google Pay は、Adyen コネクタを介してサポートされるウォレット支払として提供されます。 Dynamics Google Pay Connector でサポートされているカスタマー エクスペリエンスと統合を有効にします。 |
| ウォレット | 銀行 ID 番号 (BIN) 範囲や有効期限など、クレジット カード タイプとデビット カード タイプを区別するために使用される従来の支払特性を含まない支払タイプ。 |
| 決済エクスプレス モジュール | サポートされている決済方法を使用し、迅速なチェックアウト動作をサポートする Dynamics 365 Commerce モジュール。 |

## <a name="prerequisites"></a>必要条件

Commerce で Google Pay と Adyen を使用するには、Google マーチャント アカウントが必要です。 Google マーチャント アカウントの設定方法については、[Google Pay での Adyen のドキュメント](https://docs.adyen.com/payment-methods/google-pay/)および Google の[統合 チェックリスト](https://developers.google.com/pay/api/web/guides/test-and-deploy/integration-checklist)を参照してください。

Google Pay の支払方法を、Adyen アカウントにも統合する必要があります。 統合リンクの指示については、[Adyen Google Pay](https://www.adyen.com/payment-methods/google-pay) を参照してください。

Dynamics 365 Commerce Headquarters の強化されたウォレット機能を有効にする必要もあります。 **ワークスペース \> 機能管理** に移動し、**拡張ウォレット サポートと支払の改善** 機能を検索して、**有効にする** を選択します。 機能を有効にした後 **1110** 配送スケジュールを実行して、すべてのチャンネルで変更を使用可能にします。

## <a name="map-the-google-pay-payment-method"></a>Google Pay の支払方法をマップする

Google Pay はデジタル ウォレットの支払方法です。 Google Pay の支払マッピングを設定する方法の詳細については、[ウォレット支払のサポート](../wallets.md)を参照してください。

POS およびオンライン チャネルの両方のカード支払/入金タイプに Google Pay の支払方法をマップするには、次の手順に従います。

1. Commerce Headquarters で、**小売とコマース \> チャネルの設定 \> 支払方法 \> カード タイプ** の順に移動します。
1. **新規** を選択して、Google Pay の行を追加します。
1. **ID** フィールドに、**GooglePay** と入力します。
1. **電子支払名** フィールドに、**Google Pay** と入力します。
1. **タイプ** フィールドに、**ウォレット** と入力します。
1. **発行者** フィールドに、**Google** と入力します。
1. アクション ウィンドウで、**プロセッサ マッピング** を選択し、**プロセッサ支払のマッピング方法** のダイアログ ボックスを開きます。
1. **マップされていないプロセッサ支払方法** の下でにマップされていないプロセッサ支払方法の一覧が表示され、それぞれ適切なコネクタに接続されます。 マップされていない Google Pay プロセッサ支払方法をカード支払/入金タイプにマップするには、各カード支払/入金タイプついて、次の手順に従います。

    1. **カード支払/入金タイプ** の下で、カード支払/入金タイプを選択します。
    1. **マップされていないプロセッサ支払方法** 列で、**Adyen 向け Dynamics 365 Payment Connector** コネクタ (POS で使用) と **Google Pay 向け Dynamics 365 Payment Connector** コネクタ (オンライン チャネルで使用) の両方を選択します。
    1. **追加** を選択します。 選択内容が **マップされたプロセッサ支払方法** 列に追加されます。

1. 支払方法のマッピングが完了したら、**保存** を選択します。
1. **カード タイプ** ページで、**保存** を選択します。

## <a name="configure-a-commerce-online-store-for-google-pay"></a>Google Pay 用に Commerce オンライン ストアを構成する

Google Pay を使用するよう Commerce オンライン ストアを構成するには、次の手順に従います。

1. Commerce 本社で、**小売とコマース\>チャネル\>オンライン店舗** の順に移動します。
1. チャネルの **小売チャネル ID** の値を選択して、サイトのオンライン ストア チャネルを選択します。
1. **支払口座** クイックタブの **コネクタ** の下に、**Adyen 向け Dynamics 365 Payment Connector** コネクタが表示されていることを確認します。 表示されていない場合、[Adyen 向け Dynamics 365 Payment Connector の設定](adyen-connector-setup.md)の指示に従って追加してください。

    > [!NOTE]
    > ほとんどの場合、**Adyen 向け Dynamics 365 Payment Connector** コネクタは、チャネルの最初のコネクタとして表示されています (最初のコネクタはプライマリ コネクタとも呼ばれます)。 **PayPal 向け Dynamics 365 Payment Connector** や **GooglePay 向け Dynamics 365 Payment Connector** コネクタなど、使用される他のコネクタが後に続きます。

1. **Adyen 向け Dynamics 365 Payment Connector** コネクタが追加された後、**追加** を選択して **GooglePay 向け Dynamics 365 Payment Connector** コネクタを追加します。 コネクタに対して次のプロパティを設定します。

    | フィールド                  | Description | 必須 | 自動セット | サンプル値 |
    | ---------------------- | ----------- | -------- | ----------------- | ------------ |
    | アセンブリ名          | GooglePay 向け Dynamics 365 Payment Connector のアセンブリ名。 | 有効 | 有効 | *バイナリ名* |
    | サービス アカウント ID     | マーチャントのプロパティ設定のための一意の識別子。 この識別子は支払トランザクションで記録され、下位のプロセス (請求など) が使用する商業プロパティを識別します。 | 有効 | 有効 | *GUID* |
    | Google マーチャント ID     | Google マーチャント アカウントに割り当てられている Google マーチャント IDを入力します。 このプロパティは運用環境には必要ですが、テスト環境では省略することができます。 詳細については、<https://pay.google.com/>にアクセスしてください。 | 有効 | 無効 | *数値 ID* |
    | マーチャント口座 ID    | 一意の Adyen 商業識別子を入力します。 この値は、[Adyen でサインアップ](adyen-connector-setup.md#sign-up-with-adyen)で説明されているように、Adyen でサインアップするときに提供されます。 | 有効 | 無効 | *マーチャント ID* |
    | クラウド API キー          | Adyen クラウド API キーを入力します。 このキーを取得するには、[API キーを取得する方法](https://docs.adyen.com/developers/user-management/how-to-get-the-api-key)の指示に従います。 | 有効 | 無効 | "abcdefg" |
    | ゲートウェイ環境    | マップ対称の Adyen ゲートウェイ環境。 可能な値は **テスト** および **ライブ** です。 このフィールドは、生産デバイスおよびトランザクションでのみ **ライブ** にセットする必要があります。 | 有効 | 有効 | "ライブ" |
    | サポートされている通貨   | コネクタが処理する必要がある通貨。 カードありのシナリオでは、トランザクション要求が支払端末に送信された後、Adyen は[動的通過換算](https://www.adyen.com/pos-payments/dynamic-currency-conversion) を使用した追加通過をすることができます。 サポートされている通貨の一覧を取得するには、Adyen サポートに問い合わせてください。 | 有効 | 有効 | "USD;EUR" |
    | サポートされている支払/入金タイプ | コネクタが処理する必要がある支払/入金タイプ。 | 有効 | 有効 | "GooglePay" |

1. コネクタ プロパティの設定が完了したら、**1070 (チャネルのコンフィギュレーション**) 配布スケジュール ジョブを実行します。

## <a name="configure-commerce-pos-for-google-pay"></a>Google Pay 向けの Commerce POS を構成する

POS 構成は、Adyen 向け Dynamics 365 Payment Connector に対してハードウェア プロファイルの **EFT サービス** フィールドの設定を使用します。 Commerce Headquarters で Adyen 向け Dynamics 365 Payment Connector の電子決済 (EFT) サービスを構成する方法については、[Dynamics 365 POS ハードウェア プロファイルの設定セクション](adyen-connector-setup.md#set-up-a-dynamics-365-pos-hardware-profile)を参照してください。

Adyen コネクタのプロセッサ マッピングは、Google Pay が POS 端末で使用するウォレット カード タイプをキャプチャします。

### <a name="use-the-payment-express-module-with-google-pay"></a>決済エクスプレス モジュールと Google Pay を使用する

コマース決済エクスプレス モジュールは、サポートする支払方法と連動して、チェックアウト プロセス中に支払サービス アカウント情報を仕様することで、サイトの顧客がより迅速にチェックアウトできるオプションを提供します。 決済エクスプレス モジュールは、構成されたコネクタ ボタンを参照して、ユーザーが選択した注文の詳細 (住所、連絡先情報、および支払方法) を返し、チェックアウト フォームに事前入力します。

決済エクスプレス モジュールと Google Pay を使用する場合、**決済エクスプレス** セクションで顧客が Google Pay ボタンを選択すると、Google Pay iFrame ウィンドウが開きます。 ユーザーは Google アカウントにサインインし、アカウントの配送先住所、請求先住所、メール アドレス、選択した Google Pay 支払方法を使用してトランザクションの支払を行います。

ユーザーが Google Pay ウィンドウでアクションを完了すると、Commerce サイトのチェックアウト ページに移動し、Google Pay アカウントの詳細がチェック アウト フォームに入力されます。 ユーザーが Google Pay ウィンドウからチェックアウト ページに戻った後、次の詳細が表示されます。

- 決済エクスプレス フローでは、返された配送先住所で利用可能な最初の配送オプションが、顧客のために事前に選択されます。
- Google Pay を使用する場合、連絡先メール アドレスは返されません。 ゲスト チェックアウト ユーザーは、チェックアウト ページの連絡先セクションに電子メール アドレスを入力する必要があります。 サインインしているユーザーは、Dynamics 顧客アカウント (認証に使用した基本電子メール アドレス) から連絡先データが自動的に入力されます。

**注文する** を選択して注文を確定する前に、顧客は注文を確認し、チェックアウトする注文の詳細を変更することができます。

### <a name="configure-google-pay-in-site-builder"></a>サイト ビルダーで Google Pay を構成する 

Google Pay を使用するフラグメントまたはページを構成する前に、サイトのコンテンツ セキュリティ ポリシーがコマース サイト ビルダーで設定されていることを確認する必要があります。

コンテンツ セキュリティ ポリシーがサイト ビルダーで設定されていることを確認するには、次の手順に従います。

1. サイトで、**サイト設定 \> 拡張機能** に移動します。
1. **コンテンツ セキュリティ ポリシー** タブで、**child-src**、**connect-src**、**frame-ancestors**、**frame-src**、**img-src**、**script-src**、および **style-src** ディレクティブに `*.google.com` の行を追加します。
1. 完了したら、**保存して公開** を選択します。

### <a name="configure-the-payment-express-fragment-with-google-pay-in-site-builder"></a>サイト ビルダーで Google Pay を使用する決済エクスプレス フラグメントを構成する

オンライン ストア用に Google Pay を使用する決済エクスプレス フラグメントを設定するには、次の手順に従います。

1. サイト ビルダーで、**フラグメント** に移動します。
1. **新規** を選択します。
1. **新規フラグメント** ダイアログ ボックスで、**コンテナー** モジュールを選択し、フラグメント名 (**エクスプレス チェックアウト** など) を入力して、**OK** を選択します。 
1. 新しいフラグメントの **既定のコンテナー** スロットを選択します。
1. 右側のプロパティ ウィンドウで、コンテナー モジュールのプロパティを設定します。

    - **ヘッダー** – サイトのエクスプレス チェックアウト セクションに表示するヘッダーを入力します (**エクスプレス チェックアウト** など)。
    - **コンテナー レイアウト** – **フロー** を選択します。
    - **幅** – **塗りつぶしコンテナー** を選択します。
    - **表示される子** – **3** を選択して、チェックアウト ページのエクスプレス チェックアウト セクションで 1 行に表示される子の数を指定します (テキスト ボックス、PayPal の決済エクスプレス、Google Pay の決済エクスプレスなど)。
    - **CSS クラス名** – **msc-express-payment-container** と入力します (必須)。

    > [!IMPORTANT]
    > - チェックアウト中のコンテナーの動作を制御するには、**CSS クラス名** の値を **msc-express-payment-container** に設定する必要があります。 この動作には、非表示、折りたたみ、およびチェックアウト フロー中のエクスプレス チェックアウト セクションに適用されるその他のアクションが含まれます。 **msc-express-payment-container** クラスは、モジュール ライブラリのチェックアウト モジュールと共にリリースされる既定の操作で動作します。
    > - **CSS クラス名** に対して追加のスタイルを含めることができます。 モジュールの動作をカスタマイズする場合、チェック アウト モジュールでエクスプレス チェックアウトの動作で同じモジュール ライブラリ コードの動作を使用しているときはスタイル コントロールを照合確認します。

1. **既定のコンテナー** スロットの省略ボタン (**...**) を選択し、**モジュールの追加** を選択します。
1. **モジュールの選択** ダイアログ ボックスで **決済エクスプレス** モジュールを選択して、**OK** を選択します。
1. **決済エクスプレス** モジュールのプロパティ ウィンドウで、**iFrame の高さ** の値をピクセル単位で設定または調整します (**60** など)。
1. **サポートされている支払/入金タイプ** フィールドに **GooglePay** と入力します。 チャネルに対して設定されているコネクタの **サポートされている支払/入金タイプ** の文字列と一致している必要があります (この記事で前述した [Google Pay 向けのコマース オンライン ストアを構成する](#configure-a-commerce-online-store-for-google-pay)セクションの説明を参照)。

    > [!NOTE]
    > 手順 6 から 9 を繰り返して、その他の支払方法用の **決済エクスプレス** モジュールを追加することができます。 **サポートされている支払/入金タイプ** の値を、追加で構成されている支払タイプ (**Paypal** など) と調整します。

1. オプション: テキスト ブロック モジュールを既定のコンテナー モジュールに追加して、指示または開示情報を含めることができます。 モジュールを追加した後、プロパティ ウィンドウで **リッチ テキスト** フィールドに必要なテキストを入力します。 **テキスト ブロック** スロットで省略記号 (**...**) を選択してテキストを決済エクスプレス モジュールの上または下に位置決めし、**上へ移動** または **下へ移動** を選択することができます。
1. **保存** を選択して変更を保存し、**編集を終了する** を 選択します。
1. **公開** を選択して、フラグメントを公開します。

### <a name="add-the-payment-express-fragment-to-the-checkout-page"></a>チェックアウト ページに決済エクスプレス フラグメントを追加する

チェックアウト ページに決済エクスプレス フラグメントを追加するには、次の手順に従います。

1. サイト ビルダーで **ページ** に移動し、サイトのチェックアウト ページを選択します。
1. **編集** を選択します。
1. **メイン スロット** で省略記号 (**...**) を選択し、**モジュールの追加** を選択します。
1. **モジュールの選択** ダイアログ ボックスで **コンテナー** モジュールを選択して、**OK** を選択します。
1. 右側のプロパティ ウィンドウで、コンテナー モジュールのプロパティを設定します。

    - **コンテナー レイアウト** – **積み上げ** を選択します。
    - **幅** – **塗りつぶしコンテナー** を選択します。
    - **表示される子** – **3** を選択して、チェックアウト ページのエクスプレス チェックアウト セクションで 1 行に表示される子の数を指定します (テキスト ボックス、PayPal の決済エクスプレス、Google Pay の決済エクスプレスなど)。

1. **コンテナー** モジュール スロットで省略ボタン (**...**) を選択し、**フラグメントの追加** を選択します。
1. **フラグメントの選択** ダイアログ ボックスで作成済のエクスプレス決済フラグメントを選択し、**OK** を選択します。
1. **保存** を選択して変更を保存し、**編集を終了する** を 選択します。
1. **公開** を選択して、ページを公開します。

> [!NOTE]
> チェックアウト ページにチェックアウト フラグメントが含まれるコンテナーが既に存在していて、決済エクスプレス モジュールを通常のチェックアウト コンテナーの上に表示する場合、**メイン スロット** で省略記号 (**...**) を選択し、既存のチェックアウトの上または下に位置決めしてから、**上へ移動** または **下へ移動** を選択します。

### <a name="add-the-payment-express-fragment-to-the-cart-page"></a>カート ページに決済エクスプレス フラグメントを追加する

カート ページに決済エクスプレス フラグメントを追加するには、次の手順に従います。

1. サイト ビルダーで **ページ** に移動し、サイトのカート ページを選択します。
2. **編集** を選択します。
3. 概要ビューにおいて、ツリー ビューで **メイン スロット** を展開し、**カート** モジュールを含むコンテナーを検索します。
4. **カート** モジュールで **決済エクスプレス** スロットを選択し、省略記号 (**...**) を選択して、**モジュールの追加** を選択します。
5. **モジュールの選択** ダイアログ ボックスで **決済エクスプレス** モジュールを選択して、**OK** を選択します。
6. **決済エクスプレス** モジュール スロットを選択します。 次に、右側のプロパティ ウィンドウの **サポートされている支払/入金タイプ** の下で、**GooglePay** と入力します。 チャネルに対して設定されたコネクタの **サポートされている支払/入金タイプ** の文字列と一致している必要があります (この記事で前述した [Google Pay 向けのコマース オンライン ストアを構成する](#configure-a-commerce-online-store-for-google-pay)セクションの説明を参照)。
1. **保存** を選択して変更を保存し、**編集を終了する** を 選択します。
1. **公開** を選択して、ページを公開します。

ユーザーは、カートの **決済エクスプレス** スロットに最大で 3 つまでサポートされる **決済エクスプレス** を含めることができます (つまり、3 つの使用可能なサポートされる支払オプション)。

### <a name="set-up-google-pay-as-an-option-in-the-checkout-payment-section"></a>チェックアウトの支払セクションのオプションとして Google Pay を設定する

支払専用、非エクスプレス機能のチェックアウト支払セクションのオプションとして Google Pay を設定することができます。 チェックアウト フォームはユーザーによって入力され、Google Pay の支払ページは Google Pay による支払のチェックアウトの準備だけを行います。 入力したチェックアウトの詳細を上書きするために Google アカウントの情報が使用されることはありません。

> [!NOTE]
> 次の手順では、サイトが、集荷情報、出荷先住所、配送オプション、連絡先情報、オプションの条件、およびチェックアウト要素のセクションで構成されたチェックアウト フラグメントを使用するものとします。 既定のモジュール ライブラリのチェック アウト モジュールは、テキスト ブロック、ロイヤルティ ポイント、ギフト カード、および支払モジュールを含むチェックアウト セクション のコンテナーと共にリリースされます。 詳細については、[支払モジュール](../payment-module.md)を参照してください。

チェックアウト ページの **支払方法** セクションで通常の支払オプションとして Google Pay を設定するには、次の手順に従います。

1. サイト ビルダーで **フラグメント** に移動し、サイトのチェックアウト フラグメントを選択します。
1. **編集** を選択します。
1. **チェックアウト情報** スロットで、省略ボタン (**...**) を選択し、**モジュールの追加** を選択します。
1. **モジュールの選択** ダイアログ ボックスで **支払** モジュールを選択して、**OK** を選択します。
1. 右側の **支払** モジュールのプロパティ ウィンドウで、コンテナー モジュールのプロパティを設定します。

    - **ヘッダー** – サイトのエクスプレス チェックアウト セクションに表示するヘッダーを入力します (**Google Pay** など)。
    - **iFrame の高さ** – 値をピクセル単位で希望の設計の高さに変更します (**75** など)。 
    - **サポートされている支払/入金タイプ** – Commerce Headquarters の Google Pay コネクタの構成に一致する **GooglePay** を入力します。
    - **基本支払** – チェック ボックスはオフのままにします。 (このプロパティは、通常、Adyen チェックアウト モジュールに対して有効にされています。)
    - **支払スタイルの上書き** – このプロパティは、Google Pay 構成にはサポートされていません。
    - **コネクタ ID を使用する** – ページで複数の支払コネクタを使用する場合は、このプロパティを選択する必要があります。

1. **支払** スロットで省略記号 (**...**) を選択してモジュールを他の支払モジュールの上または下に位置決めし、**上へ移動** または **下へ移動** を選択します。
1. **保存** を選択して変更を保存し、**編集を終了する** を 選択します。
1. **公開** を選択します。

### <a name="modes-of-delivery"></a>荷渡方法

Google Pay を使用する決済エクスプレス モジュールにより、Google Pal アカウントから選択した配送先住所に対して返される最初の配送オプションが事前に入力されます。 ユーザーは、必要に応じて出荷先住所を別のオプションに調整することができます。

配送方法が決済エクスプレス モジュールに表示される順序は、Commerce Headquarters のチャネルの **配送モード** ページで構成されます。 Commerce Headquarters で、**小売とコマース \> チャネル \> オンライン ストア** に移動し、ストアの **小売チャネル ID** を選択します。 アクション ウィンドウの **設定** タブで、**配送モード** を選択します。 一覧表示された配送モードは、決済エクスプレス モジュールと同じ順序で表示されます。 アクション ウィンドウで **配送モードの管理** を選択し、小売チャンネルまたは製品の配送モードの追加または削除を行います。 配送モードを設定する方法の詳細については、[配送モードの設定](/dynamicsax-2012/appuser-itpro/set-up-modes-of-delivery)を参照してください。

チェックアウト モジュールでは、チェックアウト中に配送モードが表示される場合に、配送オプション モジュールも使用します。 詳細については、[配送オプション モジュール](../delivery-options-module.md) を参照してください。

配送モードは、オンライン ストアの **配送モード** のリストに追加された場合に表示されます。

## <a name="additional-resources"></a>追加リソース

[支払に関するよく寄せられる質問](payments-retail.md)

[チェックアウト モジュール](../add-checkout-module.md)

[支払モジュール](../payment-module.md)
