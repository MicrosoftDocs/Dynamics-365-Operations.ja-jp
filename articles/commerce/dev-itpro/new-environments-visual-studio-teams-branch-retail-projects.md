---
title: コマース プロジェクトの新しい環境、Azure DevOps、およびブランチの設定
description: このトピックでは、Microsoft Dynamics 365 Commerce 実装プロジェクトの新しい環境、Microsoft Azure DevOps、およびのブランチ設定の推奨事項について説明します。
author: andreashofmann1
manager: AnnBe
ms.date: 07/09/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: ''
audience: IT Pro
ms.reviewer: rhaertle
ms.search.scope: Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: andreash
ms.search.validFrom: 2017-12-31
ms.dyn365.ops.version: Retail 7.3
ms.openlocfilehash: 52a220978cf7535117fe7eb72620e9b89f2b4a54
ms.sourcegitcommit: 1ec931f8fe86bde27f6def36ea214a2a05fb22f6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/13/2020
ms.locfileid: "3554289"
---
# <a name="set-up-new-environments-azure-devops-and-branches-for-commerce-projects"></a><span data-ttu-id="ef667-103">コマース プロジェクトの新しい環境、Azure DevOps、およびブランチの設定</span><span class="sxs-lookup"><span data-stu-id="ef667-103">Set up new environments, Azure DevOps, and branches for Commerce projects</span></span>

[!include [banner](../../includes/banner.md)]

<span data-ttu-id="ef667-104">Microsoft Dynamics 365 Commerce プロジェクトでは、ほとんどの環境がクラウドでホストされます。</span><span class="sxs-lookup"><span data-stu-id="ef667-104">Most environments for Microsoft Dynamics 365 Commerce projects are hosted in the cloud.</span></span> <span data-ttu-id="ef667-105">それら環境は Microsoft サブスクリプション または、クラウド ホストの顧客サブスクリプションで 提供されています。</span><span class="sxs-lookup"><span data-stu-id="ef667-105">They are either Microsoft-hosted on a Microsoft subscription or cloud-hosted on a customer subscription.</span></span> <span data-ttu-id="ef667-106">既定では、環境は、Microsoft によってホストされます。</span><span class="sxs-lookup"><span data-stu-id="ef667-106">By default, environments are Microsoft-hosted.</span></span> <span data-ttu-id="ef667-107">クラウド ホスト環境は、開発環境またはビルド環境を詳細に制御するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-107">You can use cloud-hosted environments to provide more control over a development or build environment.</span></span> <span data-ttu-id="ef667-108">詳細については、 [Lifecycle Services (LCS) ユーザー ガイド](../../dev-itpro/lifecycle-services/lcs-user-guide.md) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef667-108">For more details, see the [Lifecycle Services (LCS) user guide](../../dev-itpro/lifecycle-services/lcs-user-guide.md).</span></span>

## <a name="development-tier-1-environments"></a><span data-ttu-id="ef667-109">第 1 層環境の開発</span><span class="sxs-lookup"><span data-stu-id="ef667-109">Development Tier 1 environments</span></span>

<span data-ttu-id="ef667-110">開発環境は、第1層環境と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="ef667-110">Development environments are called Tier 1 environments.</span></span> <span data-ttu-id="ef667-111">開発環境を提供するにあたって、次の3 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="ef667-111">There are three options for hosting a development environment:</span></span>

+ <span data-ttu-id="ef667-112">コマース アプリには、1 つのサンドボックス第 1 層環境が用意されています。</span><span class="sxs-lookup"><span data-stu-id="ef667-112">The Commerce app comes with one Sandbox Tier 1 environment.</span></span> <span data-ttu-id="ef667-113">(詳細については [Microsoft Dynamics 365, Enterprise Edition, ライセンスガイド](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE1CkHI)を参照してください。)</span><span class="sxs-lookup"><span data-stu-id="ef667-113">(For details, see the [Microsoft Dynamics 365, Enterprise edition, Licensing Guide](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RE1CkHI).)</span></span>
+ <span data-ttu-id="ef667-114">Microsoft Azure のサブスクリプションで動作するクラウドホスト環境。</span><span class="sxs-lookup"><span data-stu-id="ef667-114">A cloud-hosted environment that you run on your own Microsoft Azure subscription.</span></span> <span data-ttu-id="ef667-115">このタイプの環境は Microsoft Dynamics Lifecycle Services (LCS) にて "クラウド ホスト環境" と呼ばれています。</span><span class="sxs-lookup"><span data-stu-id="ef667-115">This type of environment is known as "cloud-hosted" in Microsoft Dynamics Lifecycle Services (LCS).</span></span>
+ <span data-ttu-id="ef667-116">任意の場所でホストする、ダウンロードされた仮想マシン (VM)。</span><span class="sxs-lookup"><span data-stu-id="ef667-116">A downloaded virtual machine (VM) that you host in a location of your choice.</span></span>

<span data-ttu-id="ef667-117">コード拡張を含むコマースの実装については、管理権限を使用できる開発環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ef667-117">If your implementation of Commerce includes code extensions, we recommend that you use a development environment where you have administrator privileges.</span></span> <span data-ttu-id="ef667-118">管理者特権のない開発環境を使用する場合は、他のプログラミング ツールおよびオペレーティング システム をインストールまたは設定できません。</span><span class="sxs-lookup"><span data-stu-id="ef667-118">If you don't have administrator privileges in your development environment, you won't be able to install programming tools or configure the operating system.</span></span>

<span data-ttu-id="ef667-119">選択したホスティングモデルは、財務面にも影響があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-119">The hosting model that you choose has a financial impact.</span></span> <span data-ttu-id="ef667-120">第1層環境をシンプルなテスト環境として使うか、高品質なテスト環境として使用することでホスティング コストの一部を削減できます。</span><span class="sxs-lookup"><span data-stu-id="ef667-120">You can reduce some of the hosting cost by using a Tier 1 environment as a simple test environment or golden configuration environment.</span></span> <span data-ttu-id="ef667-121">Dynamics 365 サブスクリプションでは、1 つのレベル 1 環境が無料です。</span><span class="sxs-lookup"><span data-stu-id="ef667-121">One Tier 1 environment is free with your Dynamics 365 subscription.</span></span> <span data-ttu-id="ef667-122">このアプローチは理想的ではありませんが、ほとんどのプロジェクトで有効です。</span><span class="sxs-lookup"><span data-stu-id="ef667-122">Although this approach isn't ideal, it should work for most projects.</span></span>

<span data-ttu-id="ef667-123">チャネル コンポーネントを拡張する場合は、 [Prepare the development environment](#prepare-the-development-environment) を参照し、開発の準備ができるよう開発環境の設定方法を確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-123">If you want to extend channel components, see [Prepare the development environment](#prepare-the-development-environment) to learn how to configure a development environment so that it's ready for development.</span></span>

> [!NOTE]
> <span data-ttu-id="ef667-124">いつでもクラウド ホスト環境をシャットダウンできます。</span><span class="sxs-lookup"><span data-stu-id="ef667-124">You can shut down cloud-hosted environments at any time.</span></span> <span data-ttu-id="ef667-125">この機能は、ホスティングのコストを削減するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="ef667-125">This capability helps reduce the hosting cost.</span></span>

<span data-ttu-id="ef667-126">ホスティングの代替方法は、LCS から仮想ハードディスク (VHD) をダウンロードし、サーバー上にローカルにホストすることです。</span><span class="sxs-lookup"><span data-stu-id="ef667-126">A hosting alternative is to download a virtual hard disk (VHD) from LCS and host it locally on a server.</span></span> <span data-ttu-id="ef667-127">開発の観点からは、VHD イメージはホスト VM と同じ処理能力を備えています。</span><span class="sxs-lookup"><span data-stu-id="ef667-127">From a development perspective, VHD images have the same capabilities as a hosted VM.</span></span> <span data-ttu-id="ef667-128">唯一の違いは、LCS の展開が VHD でサポートされていないことです。</span><span class="sxs-lookup"><span data-stu-id="ef667-128">The only difference is that LCS deployments aren't supported on VHDs.</span></span> <span data-ttu-id="ef667-129">ただし、コマンド ラインの配置はサポートされています。</span><span class="sxs-lookup"><span data-stu-id="ef667-129">However, command-line deployments are supported.</span></span>

<span data-ttu-id="ef667-130">次のテーブルでは、それぞれのホスティング モデルの長所と短所を示します。</span><span class="sxs-lookup"><span data-stu-id="ef667-130">The following table shows the advantages and disadvantages of each hosting model.</span></span> <span data-ttu-id="ef667-131">プロジェクトに最も適したモデルを評価するために、この情報を使用します。</span><span class="sxs-lookup"><span data-stu-id="ef667-131">Use this information to evaluate the model that will work best for your project.</span></span>

<table>
<thead>
<tr>
<th><span data-ttu-id="ef667-132">ホスティング モデル</span><span class="sxs-lookup"><span data-stu-id="ef667-132">Hosting model</span></span></th>
<th><span data-ttu-id="ef667-133">メリット</span><span class="sxs-lookup"><span data-stu-id="ef667-133">Advantages</span></span></th>
<th><span data-ttu-id="ef667-134">欠点</span><span class="sxs-lookup"><span data-stu-id="ef667-134">Disadvantages</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td><span data-ttu-id="ef667-135">Microsoft によってホストされる環境 (LCS プロジェクトでは、既定またはアドオンに基づく)</span><span class="sxs-lookup"><span data-stu-id="ef667-135">Microsoft-hosted environment (in an LCS project, default or based on an add-on)</span></span></td>
<td><span data-ttu-id="ef667-136">サブスクリプションには第1層環境が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ef667-136">Your subscription includes one Tier 1 environment.</span></span> <span data-ttu-id="ef667-137">ビルド環境としてこの環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ef667-137">We recommend that you use this environment as a build environment.</span></span>
<p><span data-ttu-id="ef667-138">テレメトリ データは収集され、LCS 診断のページで利用可能です。</span><span class="sxs-lookup"><span data-stu-id="ef667-138">Telemetry data is collected and is available on the LCS diagnostics page.</span></span></p>
</td>
<td><span data-ttu-id="ef667-139">ユーザーは、管理アクションを実行できません。</span><span class="sxs-lookup"><span data-stu-id="ef667-139">Users can't perform administrative actions.</span></span>
<p><span data-ttu-id="ef667-140">ツールまたは証明書のをインストールができません。</span><span class="sxs-lookup"><span data-stu-id="ef667-140">Users can't install any tools or certificates.</span></span></p>
</td>
</tr>
<tr>
<td><span data-ttu-id="ef667-141">クラウドでホストされている環境 (LCS プロジェクトで、プライベートのサブスクリプション)</span><span class="sxs-lookup"><span data-stu-id="ef667-141">Cloud-hosted environment (in an LCS project, private subscription)</span></span></td>
<td><span data-ttu-id="ef667-142">完全な管理者権限が与えられています。</span><span class="sxs-lookup"><span data-stu-id="ef667-142">You have full administrative rights.</span></span>
<p><span data-ttu-id="ef667-143">ツールと証明書をインストールできます。</span><span class="sxs-lookup"><span data-stu-id="ef667-143">You can install tools and certificates.</span></span></p>
</td>
<td><span data-ttu-id="ef667-144">追加のコストがあります。</span><span class="sxs-lookup"><span data-stu-id="ef667-144">There is additional cost.</span></span> <span data-ttu-id="ef667-145">環境をシャットダウンすることでコストを軽減することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-145">You can mitigate this cost by shutting down the environment.</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="ef667-146">自己ホストされダウンロードされた VM</span><span class="sxs-lookup"><span data-stu-id="ef667-146">Self-hosted downloaded VM</span></span></td>
<td><span data-ttu-id="ef667-147">経験は、ホストに依存します。</span><span class="sxs-lookup"><span data-stu-id="ef667-147">The experience depends on the host.</span></span> <span data-ttu-id="ef667-148">経験は、VM がソリッド ステート ドライブ (SSD) で実行するなら、さらに速くなります。</span><span class="sxs-lookup"><span data-stu-id="ef667-148">The experience can be much faster if the VM runs on a solid-state drive (SSD).</span></span></td>
<td><span data-ttu-id="ef667-149">LCS から パッケージを配置することはできません。</span><span class="sxs-lookup"><span data-stu-id="ef667-149">You can't deploy packages from LCS.</span></span></td>
</tr>
</tbody>
</table>

<span data-ttu-id="ef667-150">第 2 層およびそれ以上のマシンは、複数のテストと検証の目的のためのマルチ ボックス環境です。</span><span class="sxs-lookup"><span data-stu-id="ef667-150">Tier 2 and higher machines are multi-box environments for multiple test and verification purposes.</span></span> <span data-ttu-id="ef667-151">実稼働環境はハンズ オンであり、LCS でサイズ変更のプロセスによって環境の規模が決定されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-151">Production environments are hands-off, and the size of the environment is determined by the sizing process in LCS.</span></span>

## <a name="branches-build-definitions-and-environments"></a><span data-ttu-id="ef667-152">分岐、ビルド定義、および環境</span><span class="sxs-lookup"><span data-stu-id="ef667-152">Branches, build definitions, and environments</span></span>

<span data-ttu-id="ef667-153">分岐は、ソフトウェア開発における重要なプラクティスです。</span><span class="sxs-lookup"><span data-stu-id="ef667-153">Branching is an important practice in software development.</span></span> <span data-ttu-id="ef667-154">[分岐とマージ入門](https://msdn.microsoft.com/library/aa730834(v=vs.80).aspx) のトピックでは、分岐の利点について説明します。</span><span class="sxs-lookup"><span data-stu-id="ef667-154">The [Branching and Merging Primer](https://msdn.microsoft.com/library/aa730834(v=vs.80).aspx) topic describes the advantages of branching:</span></span>

> [!NOTE]
> <span data-ttu-id="ef667-155">分岐と統合の戦略には、リスクと生産性のトレードオフがあります。</span><span class="sxs-lookup"><span data-stu-id="ef667-155">A branching and merging strategy involves a tradeoff between risk and productivity.</span></span> <span data-ttu-id="ef667-156">孤立して作業することの安全性と引き換えに、他の人と作業する生産性が向上します。</span><span class="sxs-lookup"><span data-stu-id="ef667-156">You trade the safety of working in isolation for the increased productivity of working with other people.</span></span> <span data-ttu-id="ef667-157">生産性の向上にはコストが伴います。追加作業量は今後ソフトウェアの資産をマージするために必要です。</span><span class="sxs-lookup"><span data-stu-id="ef667-157">The productivity increases come with a cost—the additional effort required for merging software assets sometime in the future.</span></span>
>
> <span data-ttu-id="ef667-158">ブランチを使用すると、チームや個人が並行して作業できるため、個々のソフトウェア資産の分離とコントロールが向上し、生産性が増します。</span><span class="sxs-lookup"><span data-stu-id="ef667-158">Using branches provides better isolation and control of individual software assets and increases productivity, because teams or individuals can work in parallel.</span></span> <span data-ttu-id="ef667-159">ただし、分岐を使用すると、後で分岐全体を再構成する必要があるため、マージ アクティビティの増加も必要になり、そのためリスクも増加します。</span><span class="sxs-lookup"><span data-stu-id="ef667-159">However, using branches also requires an increase in merge activities and therefore risk, because you must later reassemble branches into a whole.</span></span>

<span data-ttu-id="ef667-160">実装プロジェクトのデリバリーの詳細については、 [Dynamics 365 for Operations を使用した継続的な配信 (video)](https://mbspartner.microsoft.com/D365/Videos/101393) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef667-160">For more information about the delivery of implementation projects, watch [Continuous Delivery Using Dynamics 365 for Operations (video)](https://mbspartner.microsoft.com/D365/Videos/101393).</span></span>

<span data-ttu-id="ef667-161">分岐を作成するうえで、唯一の最良な戦略はありません。</span><span class="sxs-lookup"><span data-stu-id="ef667-161">There is no single best strategy for creating branches.</span></span> <span data-ttu-id="ef667-162">ストラテジーは、プロジェクト、および実装のサイズによって異なります。</span><span class="sxs-lookup"><span data-stu-id="ef667-162">The strategy depends on the project and the size of the implementation.</span></span> <span data-ttu-id="ef667-163">Joris De Gruyter が上記のビデオで述べているアプローチは成功したメソッドです。</span><span class="sxs-lookup"><span data-stu-id="ef667-163">The approach that Joris De Gruyter mentions in the preceding video is a successful method.</span></span>

<span data-ttu-id="ef667-164">次の図は、3 つのコード ブランチを示しています: Dev、Main、および ProdRel1。</span><span class="sxs-lookup"><span data-stu-id="ef667-164">The following illustration shows three code branches: Dev, Main, and ProdRel1.</span></span> <span data-ttu-id="ef667-165">数字は、セットアップの順序を示します。</span><span class="sxs-lookup"><span data-stu-id="ef667-165">The numbers indicate the order of setup.</span></span>

![分岐の作成](./media/1-Three-Code-Branch.png)

<span data-ttu-id="ef667-167">設定の説明は以下の通りです。</span><span class="sxs-lookup"><span data-stu-id="ef667-167">Here is an explanation of the setup.</span></span> <span data-ttu-id="ef667-168">かっこ内の数字は、前の図の番号を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-168">The numbers in brackets refer to the numbers in the preceding illustration:</span></span>

- <span data-ttu-id="ef667-169">**Dev** ブランチ \[2\] は、テストの準備ができていない、または不安定な可能性がある通常業務に使用されますが、開発者と協業する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-169">The **Dev** branch \[2\] is used for daily work that isn't ready for testing or might not be stable, but that must be shared with other developers.</span></span> <span data-ttu-id="ef667-170">大規模なチームは、さまざまな機能または目的のために、複数の開発ブランチを持つこともできます。</span><span class="sxs-lookup"><span data-stu-id="ef667-170">For larger teams, you might want to have multiple Dev branches for different features or purposes.</span></span>
- <span data-ttu-id="ef667-171">**Main** ブランチ \[1\] は、品質基準を達成し、他のユーザーによるテストへの準備に向けた変更を扱います。</span><span class="sxs-lookup"><span data-stu-id="ef667-171">The **Main** branch \[1\] is for changes that meet a certain quality bar and are ready for testing by other people.</span></span> <span data-ttu-id="ef667-172">このテストには、ユーザー承認テスト、パフォーマンス テスト、統合テスト、および修正プログラム後のサニティ テストが含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-172">This testing might include user acceptance tests, performance tests, integration tests, and sanity tests after hotfixes.</span></span> <span data-ttu-id="ef667-173">この分岐の配置可能パッケージは、ビルド環境で作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-173">Deployable packages for this branch must be created by a build environment.</span></span> <span data-ttu-id="ef667-174">ベスト プラクティスとして、レベル 1 環境で X++ パッケージを生成し、それらのパッケージを公式テストまたは実稼動環境に配置するべきではありません。</span><span class="sxs-lookup"><span data-stu-id="ef667-174">As a best practice, you should not generate X++ packages in a Tier 1 environment and then deploy those packages into an official test or production environment.</span></span> <span data-ttu-id="ef667-175">それ以外の場合は、コミットされていないソースの変更が含まれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-175">Otherwise, uncommitted source changes could be included.</span></span> <span data-ttu-id="ef667-176">適切なアプローチは、常に正式なビルド環境でビルドされたパッケージを展開します。</span><span class="sxs-lookup"><span data-stu-id="ef667-176">The correct approach is always to deploy packages that were built on official build environments.</span></span>
- <span data-ttu-id="ef667-177">**ProdRel1** ブランチ \[3\] は、任意の時点で実稼働環境に配備された、全てのソース コードを保持します。</span><span class="sxs-lookup"><span data-stu-id="ef667-177">The **ProdRel1** branch \[3\] holds all source code exactly as it's deployed in a production environment at any given point.</span></span> <span data-ttu-id="ef667-178">ビルド環境で使用できますが、必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="ef667-178">A build environment can be used but isn't required.</span></span> <span data-ttu-id="ef667-179">Main ブランチからのパッケージが実稼働環境に配置されている場合、運用配置後に (Main から ProdRel1 へ) コードをマージする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-179">If packages from the Main branch are deployed to a production environment, the code should be merged (from Main to ProdRel1) after a production deployment.</span></span> <span data-ttu-id="ef667-180">生産用分岐を用意することで、ビルドが必要な場合に、後で公式ビルドを生成することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-180">By having a branch for production, you can generate official builds later if you require them.</span></span>
- <span data-ttu-id="ef667-181">3つの分岐は、 X++ コード (メタデータのフォルダー内の拡張機能および修正プログラム)、および Retail ソフトウェア開発キット (SDK) のコピーの両方を **RetailSdk** のフォルダー \[5, 6, 7\]  内に保持しています。</span><span class="sxs-lookup"><span data-stu-id="ef667-181">All three branches hold both X++ code (extensions and hotfixes in Metadata folders) and a copy of the Retail software development kit (SDK) in **RetailSdk** folders \[5, 6, 7\].</span></span> <span data-ttu-id="ef667-182">Retail SDKには、基準の Microsoft コードおよびコードの拡張子が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ef667-182">The Retail SDK includes base Microsoft code and code extensions.</span></span> <span data-ttu-id="ef667-183">この基本コードとコードの拡張機能は、各分岐で異なります。</span><span class="sxs-lookup"><span data-stu-id="ef667-183">This base code and the code extensions can differ in each branch.</span></span>
- <span data-ttu-id="ef667-184">**RetailSdk-mirror** フォルダー \[4\] は、Microsoftの修正を Retail SDK に適用するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-184">The **RetailSdk-mirror** folder \[4\] is used to bring in Microsoft changes to the Retail SDK.</span></span> <span data-ttu-id="ef667-185">開発またはビルドの目的で使用されていません。</span><span class="sxs-lookup"><span data-stu-id="ef667-185">It isn't used for development or build purposes.</span></span> <span data-ttu-id="ef667-186">新しいバージョンまたは修正プログラムを使用する場合にのみ更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-186">It should be updated only when a new version or hotfix is used.</span></span> <span data-ttu-id="ef667-187">プロセスの詳細については、この[チート シート](https://dynamicsnotes.com/dynamics-365-for-finance-and-operations-hotfix-and-deployment-cheat-sheet/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-187">For a detailed description of the process, see this [cheat sheet](https://dynamicsnotes.com/dynamics-365-for-finance-and-operations-hotfix-and-deployment-cheat-sheet/).</span></span>

<span data-ttu-id="ef667-188">小規模な売プロジェクトでは、分岐が 2 つしかなくても構いません (メイン = 開発分岐)。</span><span class="sxs-lookup"><span data-stu-id="ef667-188">For small projects, it's acceptable to have only two branches (Main = Dev branch).</span></span> <span data-ttu-id="ef667-189">ただし、コード送信はテスト ビルドの品質に即座に影響を与える可能性があるため、開発者は規範を守らなければなりません。</span><span class="sxs-lookup"><span data-stu-id="ef667-189">However, developers must be more disciplined, because any code submissions can immediately affect the quality of test builds.</span></span> 

<span data-ttu-id="ef667-190">複数のブランチから配置可能なパッケージを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-190">You can build deployable packages out of multiple branches.</span></span> <span data-ttu-id="ef667-191">この場合、ビルド可能な各分岐に対して 1 つのビルド定義を持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-191">In this case, you must have one build definition for each branch that can be built.</span></span> <span data-ttu-id="ef667-192">ビルド環境が配置される際、初期のビルド定義が自動的に作成されます (Main ブランチ)。</span><span class="sxs-lookup"><span data-stu-id="ef667-192">The initial build definition is automatically created when a build environment is deployed (Main branch).</span></span> <span data-ttu-id="ef667-193">他のブランチのビルドのコピーを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-193">You can make copies of the build for other branches.</span></span> <span data-ttu-id="ef667-194">コマース コードを組み込むには、小規模な追加を行う必要があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-194">Note that you must make small additions to incorporate the Commerce code.</span></span>

<span data-ttu-id="ef667-195">次の高レベルの手順を使用して、開発作業を開始できるように環境を設定します。</span><span class="sxs-lookup"><span data-stu-id="ef667-195">The following high-level steps are used to set up an environment so that development work can begin.</span></span> <span data-ttu-id="ef667-196">カッコ内の数字の詳細については、前述の図と関連情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-196">For details about the numbers in brackets, see the previous illustration and the related information.</span></span>

1. <span data-ttu-id="ef667-197">Microsoft Azure DevOps \[1\] に ビルド環境と 空の Main ブランチを配置します。</span><span class="sxs-lookup"><span data-stu-id="ef667-197">Deploy a build environment and an empty Main branch in Microsoft Azure DevOps \[1\].</span></span>
2. <span data-ttu-id="ef667-198">開発環境の配置をする。</span><span class="sxs-lookup"><span data-stu-id="ef667-198">Deploy a development environment.</span></span>
3. <span data-ttu-id="ef667-199">開発ブランチとリリース ブランチ を作成する (前述の図 ProdRel1) \[2, 3\]。</span><span class="sxs-lookup"><span data-stu-id="ef667-199">Create the Dev branch and the release branch (for example, ProdRel1 in the previous illustration) \[2, 3\].</span></span>
4. <span data-ttu-id="ef667-200">Retail SDK \[4–7\] を追加します。</span><span class="sxs-lookup"><span data-stu-id="ef667-200">Add the Retail SDK \[4–7\].</span></span>
5. <span data-ttu-id="ef667-201">開発環境を準備します。</span><span class="sxs-lookup"><span data-stu-id="ef667-201">Prepare the development environment.</span></span>
6. <span data-ttu-id="ef667-202">オプション: 別のリリース ブランチの 2 つ目のビルド環境を配置します。</span><span class="sxs-lookup"><span data-stu-id="ef667-202">Optional: Deploy a second build environment for a different release branch.</span></span>
7. <span data-ttu-id="ef667-203">ビルド定義を準備します。</span><span class="sxs-lookup"><span data-stu-id="ef667-203">Prepare the build definitions.</span></span>

<span data-ttu-id="ef667-204">これらすべての手順が完了した後、分岐、環境、およびビルドが準備完了になります。</span><span class="sxs-lookup"><span data-stu-id="ef667-204">After you've completed all these steps, your branches, environment, and builds will be ready.</span></span>

<span data-ttu-id="ef667-205">次のセクションでは、各手順の詳細について説明します。</span><span class="sxs-lookup"><span data-stu-id="ef667-205">The following sections explain each step in detail.</span></span>

## <a name="deploy-a-build-environment-and-an-empty-main-branch-in-azure-devops"></a><span data-ttu-id="ef667-206">ビルド環境と Azure DevOps の空の Main ブランチを配置する</span><span class="sxs-lookup"><span data-stu-id="ef667-206">Deploy a build environment and an empty Main branch in Azure DevOps</span></span>

<span data-ttu-id="ef667-207">LCS のポータルを使用して、新しいビルド環境を配置します。</span><span class="sxs-lookup"><span data-stu-id="ef667-207">Use the LCS portal to deploy a new build environment.</span></span> <span data-ttu-id="ef667-208">管理者権限がある場合は、より多くのオプションと機能を有することができるため、クラウド ホスト環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ef667-208">We recommend that you use a cloud-hosted environment, because you will have more options and capabilities if you have administrative rights.</span></span> <span data-ttu-id="ef667-209">このトピックで前述した、「第 1 層環境の開発」のさまざまな環境ホスティング モデルに関するテーブルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-209">See the table about the various environment hosting models in the "Development Tier 1 environments" section, earlier in this topic.</span></span>

<span data-ttu-id="ef667-210">未所持の場合は、新しい Azure DevOps プロジェクトを作成して開始します。</span><span class="sxs-lookup"><span data-stu-id="ef667-210">Start by creating a new Azure DevOps project if you don't already have one.</span></span> <span data-ttu-id="ef667-211">Azure DevOps アカウントで、**新しいプロジェクト**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-211">In your Azure DevOps account, select **New project**.</span></span>

![VSTS プロジェクト](./media/2-VSTS-project.png)

<span data-ttu-id="ef667-213">新規 Azure DevOps プロジェクトが作成した後で、Azure DevOps へのアクセスを許可する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-213">After you create the new Azure DevOps project, you must give Azure DevOps access to it.</span></span> <span data-ttu-id="ef667-214">最初に、Azure DevOps アカウントに新しい個人用のアクセス トークンを作成します。</span><span class="sxs-lookup"><span data-stu-id="ef667-214">First, create a new personal access token on the Azure DevOps account.</span></span> <span data-ttu-id="ef667-215">次に、正しい URL と個人用アクセス トークンで LCS プロジェクトをコンフィギュレーションします。</span><span class="sxs-lookup"><span data-stu-id="ef667-215">Then configure the LCS project with the correct URL and personal access token.</span></span>

![LCS プロジェクト](./media/3-LCS-project.png)

<span data-ttu-id="ef667-217">LCS プロジェクトが Azure DevOps にリンクされたら、配置の準備ができています。</span><span class="sxs-lookup"><span data-stu-id="ef667-217">After the LCS project is linked to Azure DevOps, you're ready to deploy.</span></span>

<span data-ttu-id="ef667-218">新しい環境を追加、バージョンを選択、**DEVTEST** をトポロジとして追加、およびビルド環境を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-218">Add a new environment, select the version, select **DEVTEST** as the topology, and select a build environment.</span></span> <span data-ttu-id="ef667-219">次のページで、意味のある環境名を入力します。</span><span class="sxs-lookup"><span data-stu-id="ef667-219">On the next page, enter a meaningful name for the environment.</span></span> <span data-ttu-id="ef667-220">次に、ビルド エージェントの類似の名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="ef667-220">Then enter a similar name for the build agent.</span></span>

![ビルド エージェント](./media/4-build-agent.png)

<span data-ttu-id="ef667-222">次に、 **仮想マシン名をカスタマイズ**配下で、一意の名前を入力し、VMを配置します。</span><span class="sxs-lookup"><span data-stu-id="ef667-222">Next, under **Customize virtual machine names**, enter a unique name, and then deploy the VM.</span></span>

<span data-ttu-id="ef667-223">以下の図に示されているように、ビルド ボックスは配置され、ビルド定義および Main ブランチが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-223">The build box is deployed, and the build definition and Main branch are created, as shown in the following illustration.</span></span> <span data-ttu-id="ef667-224">このプロセスには数時間かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-224">This process might take a couple of hours.</span></span>

![ビルド ボックス Main ブランチ](./media/5-build-box-main-branch.png)

<span data-ttu-id="ef667-226">ビルド定義の一覧にビルドが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-226">The build appears in the list of build definitions.</span></span>

![ビルド定義](./media/19-build-definitions.png)

<span data-ttu-id="ef667-228">ビルド定義は、 **Agents for pool Default** のグリッドに に表示されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-228">The build definition appears in the **Agents for pool Default** grid.</span></span>

![既定プールのエージェント](./media/20-agents-for-pool-default.png)

## <a name="deploy-a-development-environment"></a><span data-ttu-id="ef667-230">開発環境の配置</span><span class="sxs-lookup"><span data-stu-id="ef667-230">Deploy a development environment</span></span>

<span data-ttu-id="ef667-231">実装プロジェクトの LCS ポータルを使用して、クラウド ホストの開発環境を作成します。</span><span class="sxs-lookup"><span data-stu-id="ef667-231">Use the LCS portal of your implementation project to create a cloud-hosted development environment.</span></span> 

1. <span data-ttu-id="ef667-232">正しいユーザー アカウントにサイン インしていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-232">Make sure that you're signed in to the correct user account.</span></span> <span data-ttu-id="ef667-233">このユーザー アカウントは開発マシンのテナントの作成に使用されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-233">This user account is used to create the tenant of the development machine.</span></span> <span data-ttu-id="ef667-234">たとえば、LCS に `lily@pad.com` としてサインインしている場合、環境は @pad.com テナント用に設定され、そのテナントからのユーザが必要です。</span><span class="sxs-lookup"><span data-stu-id="ef667-234">For example, if you're signed in to LCS as `lily@pad.com`, the environment is set up for the @pad.com tenant and expects users from that tenant.</span></span> <span data-ttu-id="ef667-235">他のユーザーを追加することができますが、Point of Sale (POS) の有効化はそのテナントのユーザーが行う必要があります</span><span class="sxs-lookup"><span data-stu-id="ef667-235">Although other users can be added, point of sale (POS) activation must be done by a user from that tenant.</span></span> <span data-ttu-id="ef667-236">場合によっては、顧客、パートナー、または他の関係者が異なるドメインの電子メール アカウントを使用する場合など、異なるドメインのユーザー アカウントが使用されることもあります。</span><span class="sxs-lookup"><span data-stu-id="ef667-236">In some cases, user accounts from different domains can be used, such as when customers, partners, or other parties use email accounts from different domains.</span></span> <span data-ttu-id="ef667-237">このような場合、配置中に使用されたテナントのみがユーザーをアクティブ化できるため、POS が有効なうちに調整が必要です。</span><span class="sxs-lookup"><span data-stu-id="ef667-237">In these cases, coordination is required during POS activation, because only the tenant that was used during deployment can activate users.</span></span>
2. <span data-ttu-id="ef667-238">正しいバージョンを選択し、**DEVTEST** を選択し、**DEV** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-238">Select the correct version, select **DEVTEST**, and then select **DEV**.</span></span> <span data-ttu-id="ef667-239">わかりやすい固有の名前を入力し、詳細設定でもマシン名が固有であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-239">Enter a meaningful and unique name, and make sure that the machine name is also unique in the advanced settings.</span></span> <span data-ttu-id="ef667-240">マシン準備のプロセスは、数時間かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-240">The process of preparing the machine might take a couple of hours.</span></span>

<span data-ttu-id="ef667-241">現在、Dev 分岐は存在しないため、Azure DevOps をローカル ディレクトリにマッピングするプロセスをスキップ可能です。</span><span class="sxs-lookup"><span data-stu-id="ef667-241">Because there is currently no Dev branch, you can skip the process of mapping Azure DevOps to the local directories.</span></span> <span data-ttu-id="ef667-242">ただし、後でそのプロセスを完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-242">However, you will have to complete that process later.</span></span>

## <a name="create-the-dev-and-release-branches"></a><span data-ttu-id="ef667-243">開発およびリリースの分岐を作成する</span><span class="sxs-lookup"><span data-stu-id="ef667-243">Create the Dev and release branches</span></span>

<span data-ttu-id="ef667-244">前述のように、変更が頻繁に行われるが、あまりテストされないブランチがある必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-244">As previously mentioned, you must have a branch that holds changes that are often made but less often tested.</span></span> <span data-ttu-id="ef667-245">生産のソース コードを格納するブランチも必要です。</span><span class="sxs-lookup"><span data-stu-id="ef667-245">You must also have a branch that holds the source code for production.</span></span> <span data-ttu-id="ef667-246">次の図は、予期される階層を示しています。</span><span class="sxs-lookup"><span data-stu-id="ef667-246">The following illustration shows the expected hierarchy.</span></span>

![Main ブランチ階層](./media/6-main-branch-hierarchy.png)

<span data-ttu-id="ef667-248">分岐を作成するには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="ef667-248">Follow these steps to create the branches.</span></span>

1. <span data-ttu-id="ef667-249">開発環境にサインインします。</span><span class="sxs-lookup"><span data-stu-id="ef667-249">Sign in to a development environment.</span></span>
2. <span data-ttu-id="ef667-250">Microsoft Visual Studio を管理者として起動します。</span><span class="sxs-lookup"><span data-stu-id="ef667-250">Start Microsoft Visual Studio as an administrator.</span></span> <span data-ttu-id="ef667-251">Azure DevOpsプロジェクトへのアクセス許可を持つアカウントを使用します。</span><span class="sxs-lookup"><span data-stu-id="ef667-251">Use an account that has access to the Azure DevOps project.</span></span>
3. <span data-ttu-id="ef667-252">チーム エクスプローラーでは、この接続が存在しない場合に、Azure DevOps のプロジェクトに Visual Studio を接続します。</span><span class="sxs-lookup"><span data-stu-id="ef667-252">In Team Explorer, connect Visual Studio to the Azure DevOps project, if this connection doesn't already exist.</span></span>
4. <span data-ttu-id="ef667-253">**トランク**/**メイン** フォルダーをローカル フォルダーにマップします (このマッピングが既に存在しない場合)。</span><span class="sxs-lookup"><span data-stu-id="ef667-253">Map the **Trunk**/**Main** folder to a local folder (if this mapping doesn't already exist).</span></span> <span data-ttu-id="ef667-254">このマッピングは一時的なものです。</span><span class="sxs-lookup"><span data-stu-id="ef667-254">This mapping is temporary.</span></span>
5. <span data-ttu-id="ef667-255">ソース管理エクスプローラーでは、**メイン** フォルダーを右クリックし、**分岐および結合** \> **分岐への変換**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-255">In Source Control Explorer, right-click the **Main** folder, and then select **Branching and Merging** \> **Convert to Branch**.</span></span>
6. <span data-ttu-id="ef667-256">**Main** ブランチを右クリックし、**分岐とマージ** \>**分岐**を選択し、新しい分岐を**開発**と名付けます。</span><span class="sxs-lookup"><span data-stu-id="ef667-256">Right-click the **Main** branch, select **Branching and Merging** \> **Branch**, and name the new branch **Dev**.</span></span>
7. <span data-ttu-id="ef667-257">**保留中の変更**を使用し、この変更内容を Azure DevOps に送信します。</span><span class="sxs-lookup"><span data-stu-id="ef667-257">Use **Pending Changes**, and submit this change to Azure DevOps.</span></span>
8. <span data-ttu-id="ef667-258">**Main** ブランチを右クリックし、**分岐とマージ** \>**分岐**を選択し、新しい分岐を **ProdRel1** と名付けます。</span><span class="sxs-lookup"><span data-stu-id="ef667-258">Right-click the **Main** branch, select **Branching and Merging** \> **Branch**, and name the new branch **ProdRel1**.</span></span>
9. <span data-ttu-id="ef667-259">**保留中の変更**を使用し、この変更内容を Azure DevOps に送信します。</span><span class="sxs-lookup"><span data-stu-id="ef667-259">Use **Pending Changes**, and submit this change to Azure DevOps.</span></span>

<span data-ttu-id="ef667-260">この時点で、 Visual Studio の Source Depot エクスプローラーは以下の図のようになります。</span><span class="sxs-lookup"><span data-stu-id="ef667-260">At this point, Source Depot Explorer in Visual Studio resembles the following illustration.</span></span>

![Source Depot エクスプローラー](./media/7-source-depot-explorer.png)

## <a name="add-the-retail-sdk"></a><span data-ttu-id="ef667-262">Retail SDK を追加</span><span class="sxs-lookup"><span data-stu-id="ef667-262">Add the Retail SDK</span></span>

<span data-ttu-id="ef667-263">次に、3 つのコード分岐のそれぞれに Retail SDK を追加して、コードの変更を Dev から Main に、そして最終的に ProdRel1 に反映させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-263">Next, you must add the Retail SDK to each of the three code branches, so that code changes can be propagated from Dev to Main and eventually to ProdRel1.</span></span> <span data-ttu-id="ef667-264">このステップでは、X++ コードと同様に、これらの分岐間での別々の変更も可能です。</span><span class="sxs-lookup"><span data-stu-id="ef667-264">This step also enables separate changes between these branches, as for the X++ code.</span></span> <span data-ttu-id="ef667-265">したがって、 X++ コードと共にすべての分岐に Retail SDK があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-265">Therefore, we will have the Retail SDK in every branch, together with the X++ code.</span></span> 

<span data-ttu-id="ef667-266">最初に、ミラー分岐を追加します。</span><span class="sxs-lookup"><span data-stu-id="ef667-266">First, add the mirror branch.</span></span> <span data-ttu-id="ef667-267">Retail SDK のミラー ブランチは、Microsoft からの更新プログラムをインポートする際、コード マージのベースラインとして必要です。</span><span class="sxs-lookup"><span data-stu-id="ef667-267">The Retail SDK mirror branch is required as a baseline for code merges when updates from Microsoft are imported.</span></span> <span data-ttu-id="ef667-268">更新プログラムを実行するプロセスについては、このトピックの後で説明があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-268">The process for taking updates will be explained later in this topic.</span></span>

<span data-ttu-id="ef667-269">ミラー ブランチまたはフォルダーは、プロジェクトごとに 1 回のみ必要です。</span><span class="sxs-lookup"><span data-stu-id="ef667-269">The mirror branch or folder is only required one time per project.</span></span>

1. <span data-ttu-id="ef667-270">開発を開始する正確なバージョンのある変更していない Retail SDK を検索します。</span><span class="sxs-lookup"><span data-stu-id="ef667-270">Find the unchanged Retail SDK that has the exact version that you want to start your development with.</span></span> <span data-ttu-id="ef667-271">この Retail SDK は、サービス ドライブ上のすべての開発マシン、またはダウンロードされたすべての修正プログラムに表示されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-271">This Retail SDK can be found on every development machine on the service drive, or in every downloaded hotfix.</span></span> <span data-ttu-id="ef667-272">Microsoft-version.txt ファイルを調べることによって、Retail SDK のバージョンを一意に識別することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-272">You can uniquely identify a version of the Retail SDK by inspecting the Microsoft-version.txt file.</span></span> <span data-ttu-id="ef667-273">このファイルは、Retail SDK ミラー フォルダへの更新以外は変更しないでください。</span><span class="sxs-lookup"><span data-stu-id="ef667-273">This file should not be changed, except by an update to the Retail SDK mirror folder.</span></span>

    ![Retail SDK](./media/8-retail-sdk.png)

2. <span data-ttu-id="ef667-275">ソース管理エクスプローラーでは、**トランク** フォルダーを右クリックし、**フォルダーへの品目の追加**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-275">In Source Control Explorer, right-click the **Trunk** folder, and then select **Add Items to Folder**.</span></span>
3. <span data-ttu-id="ef667-276">小売 SDK でトップ フォルダーを選択し、**次へ**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-276">Select the top folder in the Retail SDK, and then select **Next**.</span></span>
4. <span data-ttu-id="ef667-277">Visual Studio は、追加されるファイルの数を示します。</span><span class="sxs-lookup"><span data-stu-id="ef667-277">Visual Studio shows the number of files that will be added.</span></span> <span data-ttu-id="ef667-278">**RetailSdk** フォルダーが**トランク** フォルダーの下にあることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-278">Make sure that the **RetailSdk** folder is under the **Trunk** folder.</span></span>
5. <span data-ttu-id="ef667-279">項目を選択してから、**項目を含む**を選択して、除外されたアイテムが 0 (ゼロ) であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-279">Make sure that there are 0 (zero) excluded items by selecting items and then selecting **Include items**.</span></span>

    ![ソース管理](./media/9-source-control.png)

6. <span data-ttu-id="ef667-281">**完了** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-281">Select **Finish**.</span></span> <span data-ttu-id="ef667-282">このプロセスには数分かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-282">This process will take a few minutes.</span></span>
7. <span data-ttu-id="ef667-283">処理が完了したら、フォルダーの名前を **RetailSdk-mirror** に変更します。</span><span class="sxs-lookup"><span data-stu-id="ef667-283">When the process is completed, rename the folder **RetailSdk-mirror**.</span></span>

<span data-ttu-id="ef667-284">次に、各分岐に分岐する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-284">Next, you must branch to each branch.</span></span> <span data-ttu-id="ef667-285">コードの変更と同じパスをたどります。最初は Dev、その後は Main、次に ProdRel1 に進みます。</span><span class="sxs-lookup"><span data-stu-id="ef667-285">Follow the same path that the code changes will flow in: first to Dev, then to Main, and then to ProdRel1.</span></span>

1. <span data-ttu-id="ef667-286">ミラー分岐のフォルダーを選択し、右クリックして、**分岐とマージ** \> **分岐**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-286">Select the folder for the mirror branch, right-click, and then select **Branching and Merging** \> **Branch**.</span></span>
2. <span data-ttu-id="ef667-287">**開発**分岐に移動し、**/RetailSdk** を名前に追加し、それから **OK** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-287">Go to the **Dev** branch, append **/RetailSdk** to the name, and then select **OK**.</span></span>

    ![分岐の変更](./media/10-branch-change.png)

3. <span data-ttu-id="ef667-289">**保留中の変更**を使用し、変更内容を送信します。</span><span class="sxs-lookup"><span data-stu-id="ef667-289">Use **Pending Changes**, and submit the changes.</span></span>
4. <span data-ttu-id="ef667-290">同様の手順に従って、**開発**ブランチの **RetailSdk** フォルダを **Main** ブランチに分岐します。</span><span class="sxs-lookup"><span data-stu-id="ef667-290">Follow the same steps to branch the **RetailSdk** folder of the **Dev** branch to the **Main** branch.</span></span>
5. <span data-ttu-id="ef667-291">同様の手順に従って、**Main** ブランチの **RetailSdk** フォルダを **ProdRel1** ブランチに分岐します。</span><span class="sxs-lookup"><span data-stu-id="ef667-291">Follow the same steps to branch the **RetailSdk** folder of the **Main** branch to the **ProdRel1** branch.</span></span>

<span data-ttu-id="ef667-292">この時点で、 X++ およびコマース拡張機能設定のコード ブランチとコード場所があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-292">At this point, you have the code branches and code locations for the X++ and Commerce extensions setup.</span></span> <span data-ttu-id="ef667-293">ソース管理エクスプローラーでは、ファイル構造は次の図のようになります。</span><span class="sxs-lookup"><span data-stu-id="ef667-293">In Source Control Explorer, the file structure should resemble the following illustration.</span></span>

![ソース管理エクスプローラー](./media/11-source-control-explorer.png)

<span data-ttu-id="ef667-295">コマース カスタマイズのバージョンを変更する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="ef667-295">You should also change the version of the Commerce customization.</span></span> <span data-ttu-id="ef667-296">このバージョンは、Dev、Main、および ProdRel1 の分岐で異なっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-296">This version should differ in the Dev, Main, and ProdRel1 branches.</span></span> <span data-ttu-id="ef667-297">Customization.settings ファイルを変更するか、**RetailSdk\\BuildTools** フォルダーに新しい global.props ファイルを追加してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-297">Either change the Customization.settings file, or add a new global.props file in the **RetailSdk\\BuildTools** folder.</span></span> <span data-ttu-id="ef667-298">たとえば、Dev に 1.0.0.x、Main に 1.0.1.x、ProdRel1 に 1.0.2.x と番号を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-298">For example, you can number Dev as 1.0.0.x, Main as 1.0.1.x, and ProdRel1 as 1.0.2.x.</span></span>

## <a name="prepare-the-development-environment"></a><span data-ttu-id="ef667-299">開発環境の準備</span><span class="sxs-lookup"><span data-stu-id="ef667-299">Prepare the development environment</span></span>

<span data-ttu-id="ef667-300">コマース開発タスクに開発環境を準備することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-300">You can now prepare the development environment for Commerce development tasks.</span></span> <span data-ttu-id="ef667-301">開発環境では、Dev ブランチの X++ と Retail SDK の両コード の場所をローカル フォルダーにマップします。</span><span class="sxs-lookup"><span data-stu-id="ef667-301">The development environment will map the code locations for both X++ and the Retail SDK in the Dev branch to local folders.</span></span> <span data-ttu-id="ef667-302">メタデータ フォルダー (X++) は、常に PackagesLocalDirectory フォルダーへ割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-302">The Metadata folder (X++) must be always mapped to the PackagesLocalDirectory folder.</span></span> <span data-ttu-id="ef667-303">RetailSdk フォルダーの場所は、次のガイドラインに従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-303">The location of the RetailSdk folder must follow these guidelines:</span></span>

- <span data-ttu-id="ef667-304">場所は、ローカル ユーザーのフォルダーのどこかにあるはずです。</span><span class="sxs-lookup"><span data-stu-id="ef667-304">The location should be somewhere inside the local user's folder.</span></span>
- <span data-ttu-id="ef667-305">ファイルパスは、256文字以内に制限されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-305">The file path of any file is limited to 256 characters.</span></span> <span data-ttu-id="ef667-306">そのため、Retail SDK のルートへの短いパスを使用します。</span><span class="sxs-lookup"><span data-stu-id="ef667-306">Therefore, use a short path for the root of the Retail SDK.</span></span> <span data-ttu-id="ef667-307">たとえば **c:\\ユーザー\\\<user name\>\\ソース\\RetailSdk** を利用できます。</span><span class="sxs-lookup"><span data-stu-id="ef667-307">For example, you can use **c:\\users\\\<user name\>\\Source\\RetailSdk**.</span></span>

<span data-ttu-id="ef667-308">X++ および Retail SDK をマッピングするには、現在のワークスペースを編集する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-308">To map X++ and the Retail SDK, you must edit the current workspace.</span></span> <span data-ttu-id="ef667-309">**保留中の変更** \> **操作** \> **ワークスペース**を選択し、現在のワークスペースを次の図のように更新します。</span><span class="sxs-lookup"><span data-stu-id="ef667-309">Select **Pending Changes** \> **Actions** \> **Workspaces**, and update the current workspace so that it resembles the following illustration.</span></span> <span data-ttu-id="ef667-310">前述のように、分岐のメタデータ フォルダを PackagesLocalDirectory フォルダに、RetailSdk を選択した短縮フォルダにマッピングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-310">As was previously mentioned, you should map the Metadata folder of the branch to the PackagesLocalDirectory folder and the RetailSdk folder to a short folder of your choice.</span></span>

![現在のワークスペースの編集](./media/12-edit-current-workspace.png)

<span data-ttu-id="ef667-312">ファイルのダウンロードには数分かかります。</span><span class="sxs-lookup"><span data-stu-id="ef667-312">The download of the files can take a few minutes.</span></span>

<span data-ttu-id="ef667-313">コード ブランチのカスタマイズがあるかどうかに関係なく、以下の手順によって、開発ボックスにてコードの書き込みと実行ができる状態します。</span><span class="sxs-lookup"><span data-stu-id="ef667-313">Regardless of whether there are customizations in the code branches, the following steps prepare your development box so that you can write and run code.</span></span> <span data-ttu-id="ef667-314">計画されているカスタマイズに応じて、いくつかの手順はオプション扱いとなります。</span><span class="sxs-lookup"><span data-stu-id="ef667-314">Some steps are optional, depending on the customizations that are planned.</span></span>

1. <span data-ttu-id="ef667-315">好みの開発ツールをインストールします。</span><span class="sxs-lookup"><span data-stu-id="ef667-315">Install your favorite development tools.</span></span> <span data-ttu-id="ef667-316">自動化されたスクリプトの詳細については、[最も必要な開発ツールを Chocolatey で 5 分で自動インストールする](https://dynamicsnotes.com/auto-installing-most-needed-dev-tools-in-5-mins/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-316">For information about one automated script, see [Auto-Installing most needed dev tools in 5 mins with Chocolatey](https://dynamicsnotes.com/auto-installing-most-needed-dev-tools-in-5-mins/).</span></span>
2. <span data-ttu-id="ef667-317">コンパイル時間を削減するには、Microsoft Windows Defender からコードのフォルダーを除外します。</span><span class="sxs-lookup"><span data-stu-id="ef667-317">To help reduce the compile time, exclude the code folders from Microsoft Windows Defender.</span></span>
3. <span data-ttu-id="ef667-318">**Dev/Metadata** フォルダー内のコードが既に存在する場合は、すべてのコマース モデルを構築してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-318">If there is already code in the **Dev/Metadata** folder, build all Commerce models.</span></span> <span data-ttu-id="ef667-319">すべてのモデルを選択し、**データベース同期**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ef667-319">Select all the models, and then select **Database sync**.</span></span>
4. <span data-ttu-id="ef667-320">開発経験を速めるために、Microsoft インターネット インフォメーション サービス (IIS) に切り替えます。</span><span class="sxs-lookup"><span data-stu-id="ef667-320">To speed up the development experience, switch to Microsoft Internet Information Services (IIS).</span></span> <span data-ttu-id="ef667-321">手順については、 [MSDyn365FO. 開発 VM を IIS Express から の IIS に切り替える方法](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-321">For instructions, see [MSDyn365FO. How to switch from IIS Express to IIS on development VM](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/).</span></span> <span data-ttu-id="ef667-322">この手順は、管理者権限 (クラウド ホスト環境) を持つ第 1 層の VM でのみ実行できます。</span><span class="sxs-lookup"><span data-stu-id="ef667-322">This step can be done only on the Tier 1 VM where you have administrative privileges (cloud-hosted environment).</span></span>
5. <span data-ttu-id="ef667-323">オプション: 適切なデータが含まれている生産データベースの最新のコピーを復元します。</span><span class="sxs-lookup"><span data-stu-id="ef667-323">Optional: Restore a recent copy of a production database that has good data.</span></span>

    1. <span data-ttu-id="ef667-324">既存のデータベース **AxDB\_Orig** の名前を変更します。</span><span class="sxs-lookup"><span data-stu-id="ef667-324">Rename the existing database **AxDB\_Orig**.</span></span>
    2. <span data-ttu-id="ef667-325">Microsoft SQL Server Management Studio では、.bak ファイルを復元します。</span><span class="sxs-lookup"><span data-stu-id="ef667-325">In Microsoft SQL Server Management Studio, restore the .bak file.</span></span> <span data-ttu-id="ef667-326">(.bacpac ファイルが存在する場合、[Azure SQL データベースから SQL Server 環境にデータベースをコピー](https://docs.microsoft.com/dynamics365/unified-operations/dev-itpro/database/copy-database-from-azure-sql-to-sql-server)に記載されている手順に従います。)</span><span class="sxs-lookup"><span data-stu-id="ef667-326">(If a .bacpac file exists, follow the steps in [Copy a database from Azure SQL Database to a SQL Server environment](https://docs.microsoft.com/dynamics365/unified-operations/dev-itpro/database/copy-database-from-azure-sql-to-sql-server).)</span></span>
    3. <span data-ttu-id="ef667-327">Visual Studio で、モデル ストアを更新します。</span><span class="sxs-lookup"><span data-stu-id="ef667-327">In Visual Studio, refresh the model store.</span></span>
    4. <span data-ttu-id="ef667-328">Visual Studio では、データベースのソースおよびコピー先の環境が異なるバージョンの場合、完全なビルドを実行します。</span><span class="sxs-lookup"><span data-stu-id="ef667-328">In Visual Studio, do a full build if the source and destination environments of the database are on different versions.</span></span>
    5. <span data-ttu-id="ef667-329">Visual Studio で、データベースの完全同期を実行します。</span><span class="sxs-lookup"><span data-stu-id="ef667-329">In Visual Studio, run a full database synchronization.</span></span>
    6. <span data-ttu-id="ef667-330">バッチ サービスが実行中であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-330">Make sure that the Batch service is running.</span></span>
    7. <span data-ttu-id="ef667-331">環境再プロビジョニング ツールを実行します。</span><span class="sxs-lookup"><span data-stu-id="ef667-331">Run the Environment reprovisioning tool.</span></span> <span data-ttu-id="ef667-332">(LCS 資産ライブラリで最新バージョンを見つけて、**Maintain** 関数を使用して展開します。)</span><span class="sxs-lookup"><span data-stu-id="ef667-332">(Find the latest version in the LCS Asset library, and deploy it by using the **Maintain** function.)</span></span>
    8. <span data-ttu-id="ef667-333">ツールが成功したことを確認します。</span><span class="sxs-lookup"><span data-stu-id="ef667-333">Verify that the tool succeeded.</span></span> <span data-ttu-id="ef667-334">次のクエリでは、更新されたすべてのローカル開発コンピューターの URL が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-334">The following query should show the URLs of all local development machines that were updated.</span></span>

        ```sql
        select * from dbo.RETAILCHANNELPROFILEPROPERTY where ISSYSTEMRECORD = 1
        ```

    9. <span data-ttu-id="ef667-335">コマースで、**コマース スケジューラの初期化**ジョブを実行して、古いデータを削除します。</span><span class="sxs-lookup"><span data-stu-id="ef667-335">In Commerce, run the **Initialize Commerce Scheduler** job to delete old data.</span></span>

6. <span data-ttu-id="ef667-336">ユーザーアカウントを使用してコマースにサインインできることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-336">Make sure that you can sign in to Commerce by using your user account.</span></span> <span data-ttu-id="ef667-337">本稼働データベースの管理者でない場合は、管理者プロビジョニング ツールを実行して所有権を取得することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-337">If you aren't the Admin user in the production database, run the Admin provisioning tool to take ownership.</span></span> <span data-ttu-id="ef667-338">(このツールは **PackagesLocalDirectory/bin** フォルダーにあります。)</span><span class="sxs-lookup"><span data-stu-id="ef667-338">(This tool is in the **PackagesLocalDirectory/bin** folder.)</span></span>
7. <span data-ttu-id="ef667-339">Commerce Data Exchange (CDX) データの同期が機能することを確認します。</span><span class="sxs-lookup"><span data-stu-id="ef667-339">Verify that Commerce Data Exchange (CDX) data synchronization works.</span></span> <span data-ttu-id="ef667-340">コマースでは、**ダウンロード セッション**に移動します。</span><span class="sxs-lookup"><span data-stu-id="ef667-340">In Commerce, go to **Download sessions**.</span></span> <span data-ttu-id="ef667-341">多くの適用済セッションが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-341">You should see many applied sessions.</span></span> <span data-ttu-id="ef667-342">表示されない場合は、ジョブ **9999** を選択して実行してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-342">If you don't see them, select job **9999**, and run it.</span></span>
8. <span data-ttu-id="ef667-343"><https://www.microsoft.com/download/details.aspx?id=48593> から TypeScript バージョン 2.2.2 をインストールします。</span><span class="sxs-lookup"><span data-stu-id="ef667-343">Install TypeScript version 2.2.2 from <https://www.microsoft.com/download/details.aspx?id=48593>.</span></span>
9. <span data-ttu-id="ef667-344">コマンド プロンプトから Retail SDK の完全なビルドを実行します。</span><span class="sxs-lookup"><span data-stu-id="ef667-344">Do a full build of the Retail SDK from a command prompt.</span></span>

    1. <span data-ttu-id="ef667-345">管理者として、Microsoft Visual Studio 2015 の MSbuild コマンド プロンプトを開きます。</span><span class="sxs-lookup"><span data-stu-id="ef667-345">Open an MSbuild command prompt for Microsoft Visual Studio 2015 as an administrator.</span></span>
    2. <span data-ttu-id="ef667-346">ローカル VM で、 Retail SDK の場所にディレクトリを変更します。</span><span class="sxs-lookup"><span data-stu-id="ef667-346">Change the directory to the location of your Retail SDK on the local VM.</span></span>
    3. <span data-ttu-id="ef667-347">**msbuild** と入力し、Enter キーを押します。</span><span class="sxs-lookup"><span data-stu-id="ef667-347">Type **msbuild**, and then press Enter.</span></span> <span data-ttu-id="ef667-348">ビルドは成功するはずです。</span><span class="sxs-lookup"><span data-stu-id="ef667-348">The build should succeed.</span></span>

10. <span data-ttu-id="ef667-349">開発/サンプル Retail Modern POS (MPOS) 証明書をローカル コンピューターの信頼されたルート証明書ストアに追加する: **...\\RetailSDK\\BuildTools\\ModernPOSAppxSigningCert-Contoso.pfx**。</span><span class="sxs-lookup"><span data-stu-id="ef667-349">Add the development/sample Retail Modern POS (MPOS) certificate to the local machine's trusted root certificate store: **...\\RetailSDK\\BuildTools\\ModernPOSAppxSigningCert-Contoso.pfx**.</span></span> <span data-ttu-id="ef667-350">パスワードを空の文字列に設定します。</span><span class="sxs-lookup"><span data-stu-id="ef667-350">Set the password to an empty string.</span></span>
11. <span data-ttu-id="ef667-351">**...\\RetailSDK \\References\\YourCompany|Contoso.ModernPOSSetupOffline.exe** でインストーラーを実行して、MPO または MPOSOffline をインストールする</span><span class="sxs-lookup"><span data-stu-id="ef667-351">Install MPOS or MPOSOffline by running the installer at **...\\RetailSDK \\References\\YourCompany|Contoso.ModernPOSSetupOffline.exe**.</span></span> <span data-ttu-id="ef667-352">ClientBroker ファイルを配置するのには、1 回でこの手順を完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-352">You must complete this step one time to deploy the ClientBroker files.</span></span>
12. <span data-ttu-id="ef667-353">Visual Studio で、**ModernPOS.sln** (管理者として) を開き、完全なリビルドを実行します。</span><span class="sxs-lookup"><span data-stu-id="ef667-353">In Visual Studio, open **ModernPOS.sln** (as an administrator), and do a full rebuild.</span></span>
13. <span data-ttu-id="ef667-354">F5 キーを押して、MPOS をデバッガーで起動します。</span><span class="sxs-lookup"><span data-stu-id="ef667-354">Press F5 to start MPOS in the debugger.</span></span>
14. <span data-ttu-id="ef667-355">コマースでは、**チャネル プロファイル** ページを開き、既定のチャネル プロファイルのために Commerce Scale Unit URL をコピーします。</span><span class="sxs-lookup"><span data-stu-id="ef667-355">In Commerce, open the **Channel profiles** page, and copy the Commerce Scale Unit URL for the default channel profile.</span></span>
15. <span data-ttu-id="ef667-356">ブラウザー ウィンドウを開き、アドレス バーに URL を貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="ef667-356">Open a browser window, and paste the URL into the address bar.</span></span> <span data-ttu-id="ef667-357">ローカル Commerce Scale Unit を参照できるようになります。</span><span class="sxs-lookup"><span data-stu-id="ef667-357">You should be able to browse to your local Commerce Scale Unit.</span></span>
16. <span data-ttu-id="ef667-358">コマースでは、(アクティブ化) のいずれかの作業者への外部ユーザーの資格情報を加え、パスワードを保存し、最初のサインインの際にパスワード リセットを許可しないでください。</span><span class="sxs-lookup"><span data-stu-id="ef667-358">In Commerce, add external user credentials to any worker (for activation), save the password, and don't allow a password reset on first sign-in.</span></span>
17. <span data-ttu-id="ef667-359">コマースで、ジョブ **1060** (**AX/Distribution schedule**) を実行します。</span><span class="sxs-lookup"><span data-stu-id="ef667-359">In Commerce, run job **1060** (**AX/Distribution schedule**).</span></span>
18. <span data-ttu-id="ef667-360">手順 16 で追加したものと同じ Azure Active Directory(Azure AD) ユーザーを使用して、MPOS を有効にします。</span><span class="sxs-lookup"><span data-stu-id="ef667-360">Activate MPOS by using the same Azure Active Directory (Azure AD) user that you added in step 16.</span></span> <span data-ttu-id="ef667-361">Commerce Scale Unit URL を貼り付け、ストアとレジスターを選択し、有効化を完了します。</span><span class="sxs-lookup"><span data-stu-id="ef667-361">Paste the Commerce Scale Unit URL, select a store and a register, and finish the activation.</span></span>

<span data-ttu-id="ef667-362">ローカルのソースからデバッガで MPOS を実行できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="ef667-362">You should now be able to run MPOS in the debugger from your local sources.</span></span>

<span data-ttu-id="ef667-363">開発環境を準備するプロセスが完了したところです。</span><span class="sxs-lookup"><span data-stu-id="ef667-363">The process of preparing a development environment is now completed.</span></span> <span data-ttu-id="ef667-364">この時点で、任意の拡張コード (X++、Commerce Runtime \[CRT\]、Commerce Scale Unit、チャネル SQL、POS) を Azure DevOps に書き込み、デバッグ、テスト、送信することができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-364">At this point, any extension code (X++, Commerce runtime \[CRT\], Commerce Scale Unit, channel SQL, and POS) can be written, debugged, tested, and submitted to Azure DevOps.</span></span>

## <a name="optional-deploy-a-second-build-environment-for-a-different-release-branch"></a><span data-ttu-id="ef667-365">オプション: 別のリリース ブランチの 2 つ目のビルド環境を配置</span><span class="sxs-lookup"><span data-stu-id="ef667-365">Optional: Deploy a second build environment for a different release branch</span></span>

<span data-ttu-id="ef667-366">複数のリリースを同時に管理する必要がある場合は、異なるコード ブランチ (例えば、Main2 または Main3、または ProdRel1 または ProdRel2) から配置可能パッケージを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-366">If you must maintain multiple releases at the same time, you must create deployable packages from different code branches (for example, Main2 or Main3, and/or ProdRel1 or ProdRel2).</span></span>

<span data-ttu-id="ef667-367">2 つ目のビルド環境を設定する手順は、最初のビルド環境の手順と同じです。</span><span class="sxs-lookup"><span data-stu-id="ef667-367">The steps to set up a second build environment are the same as the steps for the first build environment.</span></span> <span data-ttu-id="ef667-368">この時点で、Azure DevOps プロジェクト および LCS プロジェクトと Azure DevOps プロジェクト間のリンクが既に存在しています。</span><span class="sxs-lookup"><span data-stu-id="ef667-368">At this point, an Azure DevOps project, and the link between the LCS project and the Azure DevOps project, already exist.</span></span>

<span data-ttu-id="ef667-369">ビルド環境を分離するには、リリース ブランチの新しい Azure DevOps エージェント キューを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ef667-369">To separate the build environments, we recommend that you create a new Azure DevOps agent queue for the release branch.</span></span> <span data-ttu-id="ef667-370">複数の分岐に対してエージェント キュー (およびそのビルド環境) を共有する方法はありますが、この方法は扱いにくいことがあります。</span><span class="sxs-lookup"><span data-stu-id="ef667-370">Although there are ways to share an agent queue (and its build environment) for multiple branches, this approach can be tricky.</span></span>

<span data-ttu-id="ef667-371">現時点では、ビルド環境は、配置中にターゲット環境としてバイナリ修正プログラムのバージョンと同じプラットフォームにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-371">Currently, the build environment must be on the same platform and binary hotfix version as the target environment during deployment.</span></span> <span data-ttu-id="ef667-372">それ以外の場合は、LCS でバージョンの互換性がないため配置可能パッケージを拒否する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-372">Otherwise, LCS might reject the deployable package because of version incompatibility.</span></span>

<span data-ttu-id="ef667-373">最初に新しい Azure DevOps エージェント キューを作成してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-373">First, create a new Azure DevOps agent queue.</span></span>

![VSTS エージェント キュー](./media/13-VSTS-agent-queue.png)

<span data-ttu-id="ef667-375">LCS から配置する際、**PRODREL1** をエージェント プールの名前として使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-375">When you deploy from LCS, use **PRODREL1** as the name of the agent pool.</span></span>

![LCS のキュー名](./media/14-queue-name-lcs.png)

<span data-ttu-id="ef667-377">次に、 **仮想マシン名をカスタマイズ** タブで、一意の名前を入力してから新規ビルドを配置します。</span><span class="sxs-lookup"><span data-stu-id="ef667-377">Next, on the **Customize virtual machine names** tab, enter a unique name, and then deploy the new build.</span></span> <span data-ttu-id="ef667-378">新しいビルドの展開およびエージェント キューの作成にかかるプロセスは、数時間かかります。</span><span class="sxs-lookup"><span data-stu-id="ef667-378">The process of deploying a new build and creating a new agent queue can take a couple of hours.</span></span>

![新しいエージェント キュー](./media/15-new-agent-queue.png)

## <a name="prepare-the-build-definitions"></a><span data-ttu-id="ef667-380">ビルド定義の準備</span><span class="sxs-lookup"><span data-stu-id="ef667-380">Prepare the build definitions</span></span>

<span data-ttu-id="ef667-381">このトピックで前述の手順を完了すると、1 つのビルド定義および 2 つのエージェント キューがある必要があり、各エージェント キューは 1 つのエージェントを持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-381">After you complete the steps earlier in this topic, you should have one build definition and two agent queues, and each agent queue should have one agent.</span></span> <span data-ttu-id="ef667-382">異なる分岐をビルドするには、ビルド定義を異なる方法でコンフィギュレーションしなければなりません。</span><span class="sxs-lookup"><span data-stu-id="ef667-382">To build different branches, you must configure the build definition differently.</span></span> <span data-ttu-id="ef667-383">したがって、ビルド定義を複製する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-383">Therefore, you must clone the build definition.</span></span>

<span data-ttu-id="ef667-384">ただし、ビルド定義を複製する前に、この手順を 2 回実行する必要がないように、Retail SDK をビルドに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-384">However, before you clone the build definition, you must add the Retail SDK into the build, so that you don't have to complete this step twice.</span></span> <span data-ttu-id="ef667-385">**Unified Operations プラットフォーム - Build Main** という名前の既存のビルド定義を編集するには、[Retail SDK を継続的ビルド システムと統合 (Azure DevOps)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/retail-sdk/integrate-retail-sdk-continuous-build) の手順に従って、Main 分岐のメタデータビルドに Retail SDK を統合します。</span><span class="sxs-lookup"><span data-stu-id="ef667-385">To edit the existing build definition, which is named **Unified Operations platform - Build Main**, follow the steps in [Integrate the Retail SDK with the continuous build system (Azure DevOps)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/retail-sdk/integrate-retail-sdk-continuous-build) to integrate the Retail SDK into the metadata build of the Main branch.</span></span>

<span data-ttu-id="ef667-386">複数のビルド ブランチおよび環境がある場合、ビルド定義を複製し、新しいビルド定義に名前を付けるだけで、どのブランチのためであるかを明確にします。</span><span class="sxs-lookup"><span data-stu-id="ef667-386">If you had multiple build branches and environments, just clone the build definition, and name the new build definition so that it's clear which branch it's for.</span></span> <span data-ttu-id="ef667-387">(複製機能は Azure DevOps のポータルで使用することができます)。</span><span class="sxs-lookup"><span data-stu-id="ef667-387">(The clone feature is available in the Azure DevOps portal).</span></span> <span data-ttu-id="ef667-388">作成した新しいエージェント キューを選択し、任意のビルド ステップまたはソース マッピングの次のパスを変更します。</span><span class="sxs-lookup"><span data-stu-id="ef667-388">Select the new agent queue that you created, and change the following paths in any build steps or source mappings.</span></span> <span data-ttu-id="ef667-389">(パスで、**メイン**を **ProdRel1** に変更します。)</span><span class="sxs-lookup"><span data-stu-id="ef667-389">(In the paths, change **Main** to **ProdRel1**.)</span></span>

- <span data-ttu-id="ef667-390">ソース マッピング</span><span class="sxs-lookup"><span data-stu-id="ef667-390">Source mappings</span></span>
- <span data-ttu-id="ef667-391">Retail SDK ビルド ステップ</span><span class="sxs-lookup"><span data-stu-id="ef667-391">Retail SDK build step</span></span>
- <span data-ttu-id="ef667-392">Retail SDK のコピー バイナリ ステップ</span><span class="sxs-lookup"><span data-stu-id="ef667-392">Retail SDK copy binaries step</span></span>
- <span data-ttu-id="ef667-393">ソリューション ステップ (X++ ビルド) の構築</span><span class="sxs-lookup"><span data-stu-id="ef667-393">Build the solution step (X++ build)</span></span>
- <span data-ttu-id="ef667-394">Retail SDK のコピー パッケージ ステップ</span><span class="sxs-lookup"><span data-stu-id="ef667-394">Retail SDK copy packages step</span></span>

## <a name="tips"></a><span data-ttu-id="ef667-395">ヒント</span><span class="sxs-lookup"><span data-stu-id="ef667-395">Tips</span></span>

- <span data-ttu-id="ef667-396">ビルド定義の**変数**セクションでこれらの変更を行うことで、公式ビルドを速めることができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-396">You can speed up an official build by making these changes in the **Variables** section of the build definition:</span></span>

    - <span data-ttu-id="ef667-397">**DeployReports** を **0** に設定します。</span><span class="sxs-lookup"><span data-stu-id="ef667-397">Set **DeployReports** to **0**.</span></span>
    - <span data-ttu-id="ef667-398">**SkipSourcePackageGeneration** を **1** に設定します。</span><span class="sxs-lookup"><span data-stu-id="ef667-398">Set **SkipSourcePackageGeneration** to **1**.</span></span>

- <span data-ttu-id="ef667-399">各分岐のコマース カスタマイズのバージョンを変更します。</span><span class="sxs-lookup"><span data-stu-id="ef667-399">Change the version of the Commerce customization in each branch.</span></span> <span data-ttu-id="ef667-400">バージョンは、Dev、Main、および ProdRel1 の分岐で異なっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-400">The version should be different in the Dev, Main, and ProdRel1 branches.</span></span> <span data-ttu-id="ef667-401">Customization.settings ファイルを変更するか、 **RetailSdk\\BuildTools** フォルダーに新しい global.props ファイルを追加してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-401">Either change the Customization.settings file, or add a new global.props file under the **RetailSdk\\BuildTools** folder.</span></span> <span data-ttu-id="ef667-402">ファイル名には、任意の種類の番号を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-402">You can use any kind of numbering for the file name.</span></span> <span data-ttu-id="ef667-403">たとえば、Dev に 1.0.0.x、Main に 1.0.1.x、ProdRel1 に 1.0.2.x と番号を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-403">For example, you can number Dev as 1.0.0.x, Main as 1.0.1.x, and ProdRel1 as 1.0.2.x.</span></span>
- <span data-ttu-id="ef667-404">効率性のため、使用されていないときは、ビルドや開発環境をシャットダウンします。</span><span class="sxs-lookup"><span data-stu-id="ef667-404">For efficiency, shut down build or development environments when they aren't being used.</span></span>
- <span data-ttu-id="ef667-405">クラウド ホストの階層 1 開発環境（管理者権限を持つ）を使用している場合は、IIS Express から IIS に切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-405">If you're using cloud-hosted Tier 1 development environments (where you have administrative privileges), you can switch from IIS Express to IIS.</span></span> <span data-ttu-id="ef667-406">IIS を使用してすべての Web アプリケーションを実行すると、より堅牢になりパフォーマンスが向上し、切り替えが回避されます。</span><span class="sxs-lookup"><span data-stu-id="ef667-406">Using IIS for running all web application is more robust, more performant, and avoids the switching.</span></span> <span data-ttu-id="ef667-407">詳細については、[MSDyn365FO. IIS Express から開発 VM の IIS に切り替える方法](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef667-407">For details, see [MSDyn365FO. How to switch from IIS Express to IIS on development VM](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/).</span></span>
- <span data-ttu-id="ef667-408">プロトタイプの目的で、開発者は Azure DevOps ソースコントロールを使用せずに開発 VM で Retail SDK を変更したいと思うかもしれません。</span><span class="sxs-lookup"><span data-stu-id="ef667-408">For prototyping purposes, a developer might want to change the Retail SDK on a development VM without using Azure DevOps source control.</span></span> <span data-ttu-id="ef667-409">手を加えずに常に元の Retail SDK を保持し、一時的に使用できるコピーを作成します。</span><span class="sxs-lookup"><span data-stu-id="ef667-409">Always keep the original Retail SDK untouched, and make a copy that you can work in temporarily.</span></span> <span data-ttu-id="ef667-410">このようにして、変更されていない Retail SDK を必要に応じて、後でミラー分岐に入れることができます。</span><span class="sxs-lookup"><span data-stu-id="ef667-410">In that way, you can take the unchanged Retail SDK into your mirror branch later, if it's required.</span></span>
- <span data-ttu-id="ef667-411">現時点では、ビルド環境は、ターゲット環境としてバイナリ修正プログラムのバージョンと同じプラットフォームにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef667-411">Currently, a build environment must be on the same platform and binary hotfix version as the target environment.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ef667-412">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="ef667-412">Additional resources</span></span>

[<span data-ttu-id="ef667-413">Retail プロジェクトのコードと環境の更新</span><span class="sxs-lookup"><span data-stu-id="ef667-413">Update code and environments for Retail projects</span></span>](./updating-environments.md)

[<span data-ttu-id="ef667-414">テストおよびパフォーマンスに関する問題</span><span class="sxs-lookup"><span data-stu-id="ef667-414">Testing and performance issues</span></span>](./retail-implementation-testing-performance.md)
