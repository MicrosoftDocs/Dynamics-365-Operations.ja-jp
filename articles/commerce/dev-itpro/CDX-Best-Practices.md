---
title: Commerce Data Exchange のベスト プラクティス
description: このトピックでは、Microsoft Dynamics 365 Commerce 環境の Commerce Data Exchange (CDX) によるデータ同期について説明します。
author: jashanno
ms.date: 05/11/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: RetailTerminalTable, RetailDevice
audience: IT Pro
ms.reviewer: sericks
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: Retail
ms.author: jashanno
ms.search.validFrom: 2020-08-31
ms.dyn365.ops.version: 10.0.12
ms.openlocfilehash: 45f4eb49382b958e2c7cc5aead655410c80882e2
ms.sourcegitcommit: 08ce2a9ca1f02064beabfb9b228717d39882164b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/11/2021
ms.locfileid: "6020667"
---
# <a name="commerce-data-exchange-best-practices"></a><span data-ttu-id="6c569-103">Commerce Data Exchange のベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="6c569-103">Commerce Data Exchange best practices</span></span>

[!include[banner](../includes/banner.md)]

<span data-ttu-id="6c569-104">このトピックは、Microsoft Dynamics 365 Commerce 環境に、データ同期、Commerce Data Exchange (CDX) に関連する機能を実装するユーザーを対象としています。</span><span class="sxs-lookup"><span data-stu-id="6c569-104">This topic is intended for people who implement functionality that is related to data synchronization, Commerce Data Exchange (CDX), in a Microsoft Dynamics 365 Commerce environment.</span></span> <span data-ttu-id="6c569-105">実装にあたってのベスト プラクティスのアドバイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="6c569-105">It gives best practices advice for implementations.</span></span>

## <a name="overview"></a><span data-ttu-id="6c569-106">概要</span><span class="sxs-lookup"><span data-stu-id="6c569-106">Overview</span></span>

<span data-ttu-id="6c569-107">データの構成と同期を適切に行うことは、実装が正しく機能するために非常に重要となります。</span><span class="sxs-lookup"><span data-stu-id="6c569-107">Proper data configuration and data synchronization are crucial to correctly functioning implementation.</span></span> <span data-ttu-id="6c569-108">ビジネス要件、IT インフラストラクチャ、および全体的な準備にかかわらず、データが正しく同期されていないと、環境全体が実質的に役に立たなくなります。</span><span class="sxs-lookup"><span data-stu-id="6c569-108">Regardless of business requirements, IT infrastructure, and overall preparedness, if data isn't correctly synchronized, the whole environment is effectively useless.</span></span> <span data-ttu-id="6c569-109">したがって、コマース本部から Commerce Scale Unit を経由してオフライン データベースを持つ最新の POS を使用する実店舗に至るまで、完全な実装の全体にわたってデータの設定、生成、同期、検証に必要なものを把握することが最優先事項となります。</span><span class="sxs-lookup"><span data-stu-id="6c569-109">Therefore, a top priority is to understand what is required to configure, generate, synchronize, and verify data across the full implementation from Commerce headquarters through the Commerce Scale Unit to the brick-and-mortar stores that use Modern POS with an offline database.</span></span>

<span data-ttu-id="6c569-110">このトピックに進む前に、チャネル (店舗)、レジスターとデバイス、および Modern POS オフライン データベースの概念を理解することが重要です。</span><span class="sxs-lookup"><span data-stu-id="6c569-110">Before you go through this topic, it's important that you understand the concepts of a channel (store), registers and devices, and the Modern POS offline database.</span></span> <span data-ttu-id="6c569-111">したがって、このトピックの最後にある 「デバイス管理実装ガイダンス」や「Commerce アーキテクチャの概要」などのリソースを確認することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-111">Therefore, we recommend that you review some of the resources at the end of this topic, such as the Device management implementation guide and the overview of the Commerce architecture.</span></span>

<span data-ttu-id="6c569-112">このトピックの主な内容は以下の表にまとめました。最初の列にはタグの似た「関連する領域」のリストが含まれており、関心のある分野に関するベストプラクティスをすばやく見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="6c569-112">The main content of this topic is organized into tables, where the first column includes lists of tag-like "associated areas" to help you more quickly find best practices that are related to your areas of concern.</span></span> <span data-ttu-id="6c569-113">新しい実装については、これらのテーブルをコピーし、さまざまなベスト プラクティスが完成したときにチェックできる場所にコピーしておくと役立つ場合があります。</span><span class="sxs-lookup"><span data-stu-id="6c569-113">For new implementations, you might find it useful to copy these tables to a location where you can check off the various best practices as they are completed.</span></span> <span data-ttu-id="6c569-114">このようにして、本番に移る前に可実装が準備されているかどうかを能な限り確認することができます。</span><span class="sxs-lookup"><span data-stu-id="6c569-114">In this way, you can help ensure that the implementation is prepared as well as possible before you move forward to production.</span></span>

## <a name="recommended-configurations-with-up-to-date-maturity-information-to-denote-confidence-of-functionality"></a><span data-ttu-id="6c569-115">推奨されるコンフィギュレーション (機能の信頼性を示す最新の満期情報を含む)</span><span class="sxs-lookup"><span data-stu-id="6c569-115">Recommended configurations (with up-to-date maturity information to denote confidence of functionality)</span></span>

<span data-ttu-id="6c569-116">次のコンフィギュレーションがリリースされましたが、一部の使用シナリオでは役に立たない可能性のあるロジックが変更されます。</span><span class="sxs-lookup"><span data-stu-id="6c569-116">The following configurations have been released but cause changes to logic that may not be useful for all usage scenarios.</span></span> <span data-ttu-id="6c569-117">これらの機能はテスト済ですが、完全に検証されていないシナリオもあります。</span><span class="sxs-lookup"><span data-stu-id="6c569-117">These features have been tested but have not been thoroughly validated in all scenarios.</span></span> <span data-ttu-id="6c569-118">次の表では、機能の信頼性に関する情報を提供するために満期がリスト化されています。</span><span class="sxs-lookup"><span data-stu-id="6c569-118">In the following table, maturity has been listed to provide insight in regard to confidence of functionality.</span></span>

<span data-ttu-id="6c569-119">機能は月によって変化しますので、特定の機能の満期や新しい機能が追加されたかどうかに関して、もう一度確認する価値があります。</span><span class="sxs-lookup"><span data-stu-id="6c569-119">The features will change from month to month, so it is valuable to check back regarding the maturity of a particular feature and whether any new features have been added.</span></span> <span data-ttu-id="6c569-120">次の機能のいずれかを適用するには、**Retail と Commerce > 本社の設定 > パラメーター > コマース パラメーター** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="6c569-120">To apply any of the following features, go to **Retail and Commerce > Headquarters setup > Parameters > Commerce parameters**.</span></span>  <span data-ttu-id="6c569-121">左端のメニューで、**コンフィギュレーション パラメーター** を選択します。</span><span class="sxs-lookup"><span data-stu-id="6c569-121">On the leftmost menu, select **Configuration parameters**.</span></span>  <span data-ttu-id="6c569-122">表示されるページで、**名前** フィールドにキー (下の表に示す) を入力し、既定値を (下の表の **説明** 列に示す) を **値** フィールドに入力します。</span><span class="sxs-lookup"><span data-stu-id="6c569-122">In the page that appears, enter the key (shown in the table below) into the **Name** field and the default value (listed in the **Description** column in the table below) into the **Value** field.</span></span>

| <span data-ttu-id="6c569-123">機能</span><span class="sxs-lookup"><span data-stu-id="6c569-123">Feature</span></span> | <span data-ttu-id="6c569-124">キー</span><span class="sxs-lookup"><span data-stu-id="6c569-124">Key</span></span> | <span data-ttu-id="6c569-125">説明</span><span class="sxs-lookup"><span data-stu-id="6c569-125">Description</span></span> |  <span data-ttu-id="6c569-126">満期</span><span class="sxs-lookup"><span data-stu-id="6c569-126">Maturity</span></span> |
|------------------|---------------------|------------------------------|-----------------------------------|
| <span data-ttu-id="6c569-127">遅延ダウンロード セッションを作成</span><span class="sxs-lookup"><span data-stu-id="6c569-127">Delayed download session creation</span></span> | <span data-ttu-id="6c569-128">CDX_ENABLE_DELAYED_OFFLINE_DOWNLOAD_SESSION_CREATION</span><span class="sxs-lookup"><span data-stu-id="6c569-128">CDX_ENABLE_DELAYED_OFFLINE_DOWNLOAD_SESSION_CREATION</span></span> | <span data-ttu-id="6c569-129">このパラメータによって、ダウンロード セッションが作成されるのを、Modern POS デバイスが有効になるまで遅らせます。</span><span class="sxs-lookup"><span data-stu-id="6c569-129">This parameter delays the download sessions from being created until after the Modern POS device is activated.</span></span>  <span data-ttu-id="6c569-130">この遅延により、長い期間使用されない可能性がある不必要なダウンロード セッションは作成されません。</span><span class="sxs-lookup"><span data-stu-id="6c569-130">This delay prevents creating unnecessary download sessions that may not be used for an extended period of time.</span></span> <span data-ttu-id="6c569-131">既定値は、**0** で無効です。</span><span class="sxs-lookup"><span data-stu-id="6c569-131">The default value is **0**, which means disabled.</span></span> <span data-ttu-id="6c569-132">機能を有効にするには、値を **1** に設定します。</span><span class="sxs-lookup"><span data-stu-id="6c569-132">To enable the feature, set the value to **1**.</span></span>| <span data-ttu-id="6c569-133">高</span><span class="sxs-lookup"><span data-stu-id="6c569-133">High</span></span><br><br><span data-ttu-id="6c569-134">(機能はバージョン 10.0.15 にリリースされました)</span><span class="sxs-lookup"><span data-stu-id="6c569-134">(Feature was released in version 10.0.15.)</span></span> |
| <span data-ttu-id="6c569-135">パッケージ注文の実施</span><span class="sxs-lookup"><span data-stu-id="6c569-135">Package order enforcement</span></span> | <span data-ttu-id="6c569-136">CDX_ENABLE_DOWNLOAD_SESSION_DEPENDENCY_ENFORCEMENT</span><span class="sxs-lookup"><span data-stu-id="6c569-136">CDX_ENABLE_DOWNLOAD_SESSION_DEPENDENCY_ENFORCEMENT</span></span> | <span data-ttu-id="6c569-137">このパラメータによって、ダウンロード セッション アプリケーションが順番に適用されます。</span><span class="sxs-lookup"><span data-stu-id="6c569-137">This parameter enforces download session application to apply in order.</span></span> <span data-ttu-id="6c569-138">ダウンロード セッション アプリケーションが失敗した場合 (既定の値は 3 に定義された **試行回数** 値で定義された試行回数の後に発生する場合)、そのセッションは **一時中断** としてマークされ、中断したセッションが再試行またはキャンセルされるまでセッション アプリケーションは続行されません。</span><span class="sxs-lookup"><span data-stu-id="6c569-138">If a download session application fails (which would occur after a number of attempts that are defined in the **Try count times** value that is by default a value of three), the session will be marked as **Suspended** and session applications will not proceed until the suspended session is retried or canceled.</span></span> <span data-ttu-id="6c569-139">このキーを使用して、以前に適用されたセッション (**利用可** または **一時中断** ではないセッション) を再実行することはできません。</span><span class="sxs-lookup"><span data-stu-id="6c569-139">Using this key, you cannot rerun previously applied sessions (sessions that are not in the **Available** or **Suspended** state).</span></span><br><br><span data-ttu-id="6c569-140">この機能により、順不同でダウンロード セッションを適用した後に発生する固有のキー例外が原因で、ダウンロード セッションの失敗を防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="6c569-140">This feature will prevent download sessions failures due to unique key exceptions that could occur after applying download sessions out of order.</span></span> <span data-ttu-id="6c569-141">既定値は、**0** で無効です。</span><span class="sxs-lookup"><span data-stu-id="6c569-141">The default value is **0**, which means disabled.</span></span> | <span data-ttu-id="6c569-142">中程度</span><span class="sxs-lookup"><span data-stu-id="6c569-142">Moderate</span></span><br><br><span data-ttu-id="6c569-143">(機能はバージョン 10.0.18 にリリースされました)</span><span class="sxs-lookup"><span data-stu-id="6c569-143">(Feature was released in version 10.0.18.)</span></span> |
| <span data-ttu-id="6c569-144">失敗時のロール バック</span><span class="sxs-lookup"><span data-stu-id="6c569-144">Roll back on failure</span></span> | <span data-ttu-id="6c569-145">CDX_ENABLE_ROLLBACK_ON_FAILURE</span><span class="sxs-lookup"><span data-stu-id="6c569-145">CDX_ENABLE_ROLLBACK_ON_FAILURE</span></span> | <span data-ttu-id="6c569-146">**このキーは既知問題のため、使用をお勧めしません。**</span><span class="sxs-lookup"><span data-stu-id="6c569-146">**Due to a known issue with this key, it is not recommended for use.**</span></span>  <span data-ttu-id="6c569-147">オフライン データベースからチャンネル データベースに (P ジョブ配送スケジュールに基づいて) トランザクションを同期する場合、通常、レコードがマージされます。</span><span class="sxs-lookup"><span data-stu-id="6c569-147">When synchronizing transactions from an offline database to the channel database (based on the P-job distribution schedule), the system normally merges records.</span></span> <span data-ttu-id="6c569-148">つまり、トランザクション ID が重複するレコードが上書きされます。</span><span class="sxs-lookup"><span data-stu-id="6c569-148">This means that records with duplicate transaction IDs will be overwritten.</span></span> <span data-ttu-id="6c569-149">この機能を使用すると、オフライン同期によってレコードが挿入されます。</span><span class="sxs-lookup"><span data-stu-id="6c569-149">With this feature, the offline synchronization will instead insert records.</span></span> <span data-ttu-id="6c569-150">この挿入により、上書きとエラー修正が防止され、問題を調査できます。</span><span class="sxs-lookup"><span data-stu-id="6c569-150">This insert prevents the overwrite and throws an error so the issue can be investigated.</span></span> <span data-ttu-id="6c569-151">この時点で、オフライン トランザクションの投稿同期の消去が失敗し、挿入エラーが発生してオフライン同期が停止する可能性があります。このため、現在は機能設定を無効にすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-151">At this time, the purge of offline transactions post synchronization could fail, triggering the insert error and stopping the offline sync. Due to this, it is currently recommended that this feature should be disabled.</span></span> <span data-ttu-id="6c569-152">既定値は **1** で、既定により有効です。</span><span class="sxs-lookup"><span data-stu-id="6c569-152">The default value is **1**, meaning that it's enabled by default.</span></span>  <span data-ttu-id="6c569-153">この値を **0** に変更することを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-153">It is highly recommended to change this value to **0**.</span></span> | <span data-ttu-id="6c569-154">既知の問題が原因で、低いです。</span><span class="sxs-lookup"><span data-stu-id="6c569-154">Low, due to known issue.</span></span><br><br><span data-ttu-id="6c569-155">(機能はバージョン 10.0.13 にリリースされました)</span><span class="sxs-lookup"><span data-stu-id="6c569-155">(Feature was released in version 10.0.13.)</span></span> |

## <a name="updating-configurations"></a><span data-ttu-id="6c569-156">コンフィギュレーションの更新</span><span class="sxs-lookup"><span data-stu-id="6c569-156">Updating configurations</span></span>

<span data-ttu-id="6c569-157">次の手順は、更新するたびに Dynamics 365 環境に対して実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6c569-157">The following should be performed after every update to the Dynamics 365 environment.</span></span>

| <span data-ttu-id="6c569-158">関連する領域</span><span class="sxs-lookup"><span data-stu-id="6c569-158">Associated areas</span></span> | <span data-ttu-id="6c569-159">ベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="6c569-159">Best practice</span></span> |
|------------------|---------------|
| <ul><li><span data-ttu-id="6c569-160">パラメーター</span><span class="sxs-lookup"><span data-stu-id="6c569-160">Parameters</span></span></li><li><span data-ttu-id="6c569-161">コマース スケジューラ</span><span class="sxs-lookup"><span data-stu-id="6c569-161">Commerce scheduler</span></span></li><li><span data-ttu-id="6c569-162">初期化</span><span class="sxs-lookup"><span data-stu-id="6c569-162">Initialization</span></span></li></ul> | <span data-ttu-id="6c569-163">**Retail とコマース \> バックオフィスの設定 \> コマース スケジューラ \> コマース スケジューラの初期化** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="6c569-163">Go to **Retail and Commerce \> Headquarters setup \> Commerce scheduler \> Initialize commerce scheduler**.</span></span> <span data-ttu-id="6c569-164">コマース スケジューラの基本構成データの初期化を続行するかどうかの確認を求められます。</span><span class="sxs-lookup"><span data-stu-id="6c569-164">You will be asked if you would like to proceed with initializing the base configuration data for Commerce scheduler.</span></span> <span data-ttu-id="6c569-165">更新のたびにこのアクションを実行することは、新しいテーブルまたは列の構成データを正しく設定する機能を管理するのに重要です。</span><span class="sxs-lookup"><span data-stu-id="6c569-165">Performing this action after every update is key to maintaining functionality as it correctly sets the configuration data for new tables or columns.</span></span> <span data-ttu-id="6c569-166">**既存のコンフィギュレーションの削除** をするパラメーターもあります。</span><span class="sxs-lookup"><span data-stu-id="6c569-166">There is also a parameter to **Delete existing configuration**.</span></span>  <span data-ttu-id="6c569-167">コンフィギュレーションが失われても影響が生じない非実稼働環境で作業すると明示的に指示されない限り、この設定は **いいえ** のままにします。</span><span class="sxs-lookup"><span data-stu-id="6c569-167">Unless explicitly told to do so or working on a non-production environment where losing configuration will not create an impact, leave this set to **No**.</span></span> |

## <a name="valuable-configurations"></a><span data-ttu-id="6c569-168">便利な構成</span><span class="sxs-lookup"><span data-stu-id="6c569-168">Valuable configurations</span></span>

| <span data-ttu-id="6c569-169">関連する領域</span><span class="sxs-lookup"><span data-stu-id="6c569-169">Associated areas</span></span> | <span data-ttu-id="6c569-170">ベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="6c569-170">Best practice</span></span> |
|------------------|---------------|
| <ul><li><span data-ttu-id="6c569-171">パラメーター</span><span class="sxs-lookup"><span data-stu-id="6c569-171">Parameters</span></span></li><li><span data-ttu-id="6c569-172">コマース スケジューラ</span><span class="sxs-lookup"><span data-stu-id="6c569-172">Commerce scheduler</span></span></li><li><span data-ttu-id="6c569-173">再試行</span><span class="sxs-lookup"><span data-stu-id="6c569-173">Retry</span></span></li></ul> | <span data-ttu-id="6c569-174">**小売とコマース \> バックオフィスの設定 \> パラメーター \> コマース スケジューラー パラメーター** に移動し、**試行回数** を **3** に設定します。</span><span class="sxs-lookup"><span data-stu-id="6c569-174">Go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce scheduler parameters**, and set **Try count** to **3**.</span></span> <span data-ttu-id="6c569-175">このフィールドの値が大きすぎる場合は、利用率の高い時間帯にダウンロード セッションが失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="6c569-175">If the value of this field is too high, download sessions might fail during high-usage times.</span></span>  <span data-ttu-id="6c569-176">また、**完全なデータセットの生成サイクル間隔の日単位** を **0** に確認 (または設定) します。</span><span class="sxs-lookup"><span data-stu-id="6c569-176">Additionally, verify (or set) **Full dataset generation interval in days** to **0**.</span></span> <span data-ttu-id="6c569-177">これは、完全なデータセットの生成は、時間以外に必要とされない限り発生しないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="6c569-177">This means full dataset generation will not occur unless required by something other than time.</span></span> <span data-ttu-id="6c569-178">これらの値を設定することにより、CDX を予定した方法で機能させることができ、エラーの発生またはパフォーマンスの問題を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="6c569-178">Setting these values allows CDX to function in a more expected manner while reducing possible error or performance issues.</span></span> |
| <ul><li><span data-ttu-id="6c569-179">機能プロファイル</span><span class="sxs-lookup"><span data-stu-id="6c569-179">Functionality profile</span></span></li><li><span data-ttu-id="6c569-180">データのリテンション期間</span><span class="sxs-lookup"><span data-stu-id="6c569-180">Data retention</span></span></li><li><span data-ttu-id="6c569-181">返品ポリシー</span><span class="sxs-lookup"><span data-stu-id="6c569-181">Return policy</span></span></li> | <span data-ttu-id="6c569-182">**小売とコマース \> チャネル設定 \> POS 設定 \> POS プロファイル \> 機能プロファイル** に移動し、続いて **機能** セクションで、**トランザクションの存在日数** を返品ポリシーに対して定義されている値と同じか、またはそれに近い値に設定します。</span><span class="sxs-lookup"><span data-stu-id="6c569-182">Go to **Retail and Commerce \> Channel setup \> POS setup \> POS profiles \> Functionality profile**, and then, in the **Functions** section, set **Days transactions exist** to a value that is the same as, or close to the value that is defined for the return policy.</span></span> <span data-ttu-id="6c569-183">たとえば、返品ポリシーに 30 日以内の返品可能と記載されている場合は、このフィールドを **30**、**31** に設定したり、または、通常のポリシーを超える特別な例外が可能な場合は **60** に設定します (この場合は通常の返品ポリシー期間の倍になるため、通常のポリシーの制限を超えてもより迅速な返品が可能となります)。</span><span class="sxs-lookup"><span data-stu-id="6c569-183">For example, if the return policy states an item can be returned within 30 days, set this field to **30**, **31**, or **60** if special exceptions are allowed beyond the usual policy (this would be twice the usual policy, allowing for faster returns even beyond the usual policy limits).</span></span> |
| <ul><li><span data-ttu-id="6c569-184">チャネル データベース グループ</span><span class="sxs-lookup"><span data-stu-id="6c569-184">Channel database group</span></span></li><li><span data-ttu-id="6c569-185">配送スケジュール</span><span class="sxs-lookup"><span data-stu-id="6c569-185">Distribution schedule</span></span></li><li><span data-ttu-id="6c569-186">オフライン プロファイル</span><span class="sxs-lookup"><span data-stu-id="6c569-186">Offline profile</span></span></li><li><span data-ttu-id="6c569-187">一時停止</span><span class="sxs-lookup"><span data-stu-id="6c569-187">Pause</span></span></li><li><span data-ttu-id="6c569-188">データ</span><span class="sxs-lookup"><span data-stu-id="6c569-188">Data</span></span></li><li><span data-ttu-id="6c569-189">ダウンロード</span><span class="sxs-lookup"><span data-stu-id="6c569-189">Download</span></span></li></ul> | <span data-ttu-id="6c569-190">新たに生成された端末に割り当てる "ダミー" のデータベース グループ (どの配布スケジュール ジョブにも関連付けられていないグループ)、または **オフライン同期の一時停止** オプションが **はい** に設定されている特別なオフライン プロファイルのいずれかを持つことを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-190">We highly recommend that you have either a "dummy" channel database group (that is, a group that isn't associated with any distribution schedule job) that you assign to the newly generated terminals, or a special offline profile where the **Pause offline synchronization** option is set to **Yes**.</span></span> <span data-ttu-id="6c569-191">このようにして、データ生成は、必要なときにシステムが最も可用性が高い時に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="6c569-191">In this way, data generation can occur when it's required and when the system is most available to do it.</span></span> <span data-ttu-id="6c569-192">(ただし、システムによっては必要に応じて何度か一時停止する場合があります。)</span><span class="sxs-lookup"><span data-stu-id="6c569-192">(However, the system might pause multiple times as required.)</span></span> |
  
### <a name="enable-table-and-index-compression"></a><span data-ttu-id="6c569-193">テーブルとインデックスの圧縮の有効化</span><span class="sxs-lookup"><span data-stu-id="6c569-193">Enable table and index compression</span></span>
<span data-ttu-id="6c569-194">このトピックを読む前に、[Commerce Data Exchange 実装ガイダンス](implementation-considerations-cdx.md#implementation-considerations) のオンプレミス データベース コンポーネント (CSU の一部としてオフライン データベースおよびチャンネル データベース) で使用される SQL Server の各種の推奨バージョンについて読み取る方をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-194">Before you read this topic, we recommended that you read about the different recommended versions of SQL Server used in on-premises database components (offline database and channel database as part of a CSU) in [Commerce Data Exchange implementation guidance](implementation-considerations-cdx.md#implementation-considerations).</span></span> <span data-ttu-id="6c569-195">Modern POS のオフライン データベースおよび CSU のチャンネル データベース (セルフホスト型) など、テーブル/インデックスの圧縮を、その上の施設のデータベースで有効にすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="6c569-195">It's important to enable table/index compression on their on-premises databases, such as the offline databases for Modern POS and the channel databases for the CSU (self-hosted).</span></span> <span data-ttu-id="6c569-196">この機能は、SQL Server 2016 SP1 Express、SQL Server 2017 Express、SQL Server 2019 Express および以降でのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="6c569-196">This is supported only on SQL Server 2016 SP1 Express, SQL Server 2017 Express, SQL Server 2019 Express, and later.</span></span> <span data-ttu-id="6c569-197">まだ SQL Server Express 2014 を実行している場合は、新しいバージョンにアップグレードする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6c569-197">If you are still running SQL Server Express 2014, an upgrade to a newer, supported version will be required.</span></span> <span data-ttu-id="6c569-198">ディスク領域を使用して、トップ テーブルのレポートを作成します (**SQL Server Management Studio > レポート > スタンダード レポート > トップ テーブルによるディスク用途**)。</span><span class="sxs-lookup"><span data-stu-id="6c569-198">Generate a report of the top tables using disk space (**SQL Server Management Studio > Reports > Standard Reports > Disk Usage by Top Tables**).</span></span> <span data-ttu-id="6c569-199">その後、レポートの上部にある各テーブルおよびインデックスの圧縮を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="6c569-199">After that, you can enable compression for each table and index at the top of the report.</span></span> <span data-ttu-id="6c569-200">基本コマンドを次に示します。</span><span class="sxs-lookup"><span data-stu-id="6c569-200">The basic commands are shown below.</span></span>

```Console
ALTER TABLE [ax].<table_name> REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX <index1_name> ON [ax].<table_name> REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX <index2_name> ON [ax].<table_name> REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
```

<span data-ttu-id="6c569-201">圧縮からメリットを頻繁に受けるテーブルの例として、この例では ax.INVENTDIM を使用します。</span><span class="sxs-lookup"><span data-stu-id="6c569-201">As an example of a table that often benefits from compression, this example uses ax.INVENTDIM:</span></span>

```Console
sp_helpindex 'ax.INVENTDIM'
```

<span data-ttu-id="6c569-202">上記のクエリには、選択したテーブルのすべてのインデックスが表示されます (そのリストはコマンドの次のセットで以下に示します)。</span><span class="sxs-lookup"><span data-stu-id="6c569-202">The above query will show all the indexes for the selected table (the list of which is shown below in the next set of commands).</span></span> <span data-ttu-id="6c569-203">そのクエリに基づいて、最初にこのトピックで示した基本的なコマンドを使用して、テーブルと関連のすべてのコマンドを圧縮できます。</span><span class="sxs-lookup"><span data-stu-id="6c569-203">Based on that query, can take the basic commands originally shown in this topic to compress the table and all related indices.</span></span>

```Console
ALTER TABLE [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX [I_-65082180_-588450352] ON [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX [I_-65082180_-997209838] ON [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX [IX_INVENTDIM_DATAAREAID_CONFIGID_INVENTSIZEID_INVENTCOLORID_INVENTSTYLEID_INVENTLOCATIONID] ON [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX [IX_INVENTDIM_DATAAREAID_INVENTLOCATIONID] ON [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX [IX_INVENTDIM_DATAAREAID_INVENTLOCATIONID_RECID] ON [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX [IX_INVENTDIM_INVENTLOCATIONID_INVENTSITEID_LICENSEPLATEID_WMSLOCATIONID_WMSPALLETID_CONFIGID] ON [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
ALTER INDEX [IX_INVENTDIM_RECID] ON [ax].[INVENTDIM] REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE)
```

<span data-ttu-id="6c569-204">適切なデータベース サイズに到達するまで、レポートのトップ テーブルに対して、このセクションを繰り返すことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-204">We recommend that you repeat this section for the top tables in the report, until an appropriate database size is reached.</span></span>


## <a name="practices-that-affect-performance"></a><span data-ttu-id="6c569-205">パフォーマンスに影響を与えるプラクティス</span><span class="sxs-lookup"><span data-stu-id="6c569-205">Practices that affect performance</span></span>

| <span data-ttu-id="6c569-206">関連する領域</span><span class="sxs-lookup"><span data-stu-id="6c569-206">Associated areas</span></span> | <span data-ttu-id="6c569-207">ベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="6c569-207">Best practice</span></span> |
|------------------|---------------|
| <ul><li><span data-ttu-id="6c569-208">チャネル データベース グループ</span><span class="sxs-lookup"><span data-stu-id="6c569-208">Channel database group</span></span></li><li><span data-ttu-id="6c569-209">オフライン プロファイル</span><span class="sxs-lookup"><span data-stu-id="6c569-209">Offline profile</span></span></li><li><span data-ttu-id="6c569-210">一時停止</span><span class="sxs-lookup"><span data-stu-id="6c569-210">Pause</span></span></li><li><span data-ttu-id="6c569-211">データ</span><span class="sxs-lookup"><span data-stu-id="6c569-211">Data</span></span></li><li><span data-ttu-id="6c569-212">ダウンロード</span><span class="sxs-lookup"><span data-stu-id="6c569-212">Download</span></span></li></ul> | <p><span data-ttu-id="6c569-213">オフライン データベースが使用できるように、データが必要になるまではオフライン データベース用のデータを生成しないでください。</span><span class="sxs-lookup"><span data-stu-id="6c569-213">Don't generate data for offline databases until that data is required so that an offline database can be used.</span></span> <span data-ttu-id="6c569-214">次のシナリオでは、なぜこのベスト プラクティスが重要なのかを示しています。</span><span class="sxs-lookup"><span data-stu-id="6c569-214">The following scenario shows why this best practice is important.</span></span></p><p><span data-ttu-id="6c569-215">関連するチャネル データベースのグループに追加された最新の POS オフライン データベースは、データベースの完全な同期が行われた後の既存のダウンロードセッションをすべて継承します。</span><span class="sxs-lookup"><span data-stu-id="6c569-215">A new Modern POS offline database that has been added to the relevant channel database group inherits all existing download sessions since the last full database synchronization occurred.</span></span> <span data-ttu-id="6c569-216">オフライン端末を持つ最新の POS インスタンスが新たに 100 個作成され、2 ヶ月間完全な同期が発生していない。</span><span class="sxs-lookup"><span data-stu-id="6c569-216">One hundred new Modern POS instances that have offline terminals are created, and a full synchronization hasn't occurred in two months.</span></span> <span data-ttu-id="6c569-217">20 分ごとに実際に変更があるのは、5 つのスケジューラ ジョブだけです。</span><span class="sxs-lookup"><span data-stu-id="6c569-217">Only five scheduler jobs have actual changes every 20 minutes.</span></span> <span data-ttu-id="6c569-218">(たとえば、これらの変更には価格と割引、または頻繁に更新される顧客が含まれる場合があります)。このシナリオでは、新たに作成された端末が有効化されているか、このデータを適用できるかどうかに関わらず、最大で 200 万のダウンロード セッションがただちに生成され、適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6c569-218">(For example, these changes might involve prices and discounts, or customers, which can be updated often.) In this scenario, up to 2,000,000 download sessions are immediately generated and must be applied, regardless of whether the newly created terminals are activated and capable of applying this data.</span></span></p><p><span data-ttu-id="6c569-219">多くの場合、このタイプの例外的なデータ生成は大規模であり、パフォーマンスに影響します。</span><span class="sxs-lookup"><span data-stu-id="6c569-219">Even at the best times, this type of exceptional data generation is large and affects performance.</span></span> <span data-ttu-id="6c569-220">稼働率の高い (最も忙しい時間) 時間帯の場合、環境のパフォーマンスが著しく損なわれることになります。</span><span class="sxs-lookup"><span data-stu-id="6c569-220">At the worst (that is, busiest) times, it severely impairs the environment's performance.</span></span> <span data-ttu-id="6c569-221">そのため、新たに生成された端末に割り当てる "ダミー" のデータベース グループ (どの配布スケジュール ジョブにも関連付けられていないグループ) を持つか、またはオフライン プロファイルで使用する **オフライン同期の一時停止** オプションを **はい** に設定することを強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-221">Therefore, we highly recommend that you either have a "dummy" channel database group (that is, a group that isn't associated with any distribution schedule job) that you assign to the newly generated terminals, or set the **Pause offline synchronization** option for the offline profile to **Yes**.</span></span> <span data-ttu-id="6c569-222">**オフライン同期の一時停止** オプションを **はい** に設定することで、オフライン プロファイルを使用したすべてのデータ生成を停止できます。</span><span class="sxs-lookup"><span data-stu-id="6c569-222">By setting the **Pause offline synchronization** option to **Yes**, you stop data generation for anything that uses the offline profile.</span></span> <span data-ttu-id="6c569-223">そのため、データの生成は必要となったタイミングでのみ行われ、システムの可用性が高い状態でのみ行われます。</span><span class="sxs-lookup"><span data-stu-id="6c569-223">Therefore, data generation can occur only when it's required, instead of constantly, and only when the system is most available to do it.</span></span> <span data-ttu-id="6c569-224">(ただし、システムによっては必要に応じて何度か一時停止する場合があります。)</span><span class="sxs-lookup"><span data-stu-id="6c569-224">(However, the system might pause multiple times as required.)</span></span> |
| <ul><li><span data-ttu-id="6c569-225">配送スケジュール</span><span class="sxs-lookup"><span data-stu-id="6c569-225">Distribution schedule</span></span></li><li><span data-ttu-id="6c569-226">スケジューラ ジョブ</span><span class="sxs-lookup"><span data-stu-id="6c569-226">Scheduler jobs</span></span></li><li><span data-ttu-id="6c569-227">アップロード</span><span class="sxs-lookup"><span data-stu-id="6c569-227">Upload</span></span></li></ul> | <span data-ttu-id="6c569-228">P-ジョブ (アップロード バッチ ジョブ) は複数実行できません。</span><span class="sxs-lookup"><span data-stu-id="6c569-228">No more than one P-job (upload batch job) should occur at any time.</span></span> <span data-ttu-id="6c569-229">並行して発生する可能性のある P- ジョブ アップロードの一括ジョブが複数作成された場合、アップロードされたトランザクションのデータを適用している間にテーブル ロックや遅延 (パフォーマンスの低下) が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="6c569-229">If multiple P-job upload batch jobs are created that might occur in parallel, table locking and delays (performance degradation) could occur while data of the uploaded transactions is being applied.</span></span> <span data-ttu-id="6c569-230">同時に複数のジョブを実行する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="6c569-230">The job doesn't have to occur multiple times at the same time.</span></span> <span data-ttu-id="6c569-231">頻繁に発生する可能性が考えられます。</span><span class="sxs-lookup"><span data-stu-id="6c569-231">It can just occur frequently.</span></span> |
| <ul><li><span data-ttu-id="6c569-232">パラメーター</span><span class="sxs-lookup"><span data-stu-id="6c569-232">Parameters</span></span></li><li><span data-ttu-id="6c569-233">コマース スケジューラ</span><span class="sxs-lookup"><span data-stu-id="6c569-233">Commerce scheduler</span></span></li><li><span data-ttu-id="6c569-234">データベースの事後同期</span><span class="sxs-lookup"><span data-stu-id="6c569-234">Post database sync</span></span></li></ul> | <span data-ttu-id="6c569-235">**Retail と Commerce\> 本社の設定\> パラメーター\> コマース スケジューラー パラメーター** の順にクリックします。</span><span class="sxs-lookup"><span data-stu-id="6c569-235">Go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce scheduler parameters**.</span></span> <span data-ttu-id="6c569-236">**データベース同期の転記** 下位ヘッダーの下に、さまざまな理由でパフォーマンスに影響を与える可能性がある 2 つのフィールドがあります。</span><span class="sxs-lookup"><span data-stu-id="6c569-236">Under the **Post database sync** sub-heading, there are two fields that can impact performance for different reasons.</span></span><br><br><span data-ttu-id="6c569-237">**同期完了後不要なマスター データをクリーン アップする** によって、CDX のダウンロード セッションが実行されるたびに店舗の業務手順の **マスター データのストライピング** を実行します。</span><span class="sxs-lookup"><span data-stu-id="6c569-237">**Clean up irrelevant master data after sync** performs the store procedure **Strip Master Data** after each CDX download session is executed.</span></span>  <span data-ttu-id="6c569-238">この手順により、パッケージの生成に含まれるものの、特定の店舗 (チャネル) のメンバーとして特定のデバイスのオフライン機能には必要ない不要なレコードは削除されます。</span><span class="sxs-lookup"><span data-stu-id="6c569-238">This step deletes unnecessary records that were included in package generation, but not necessary for the offline functionality for that specific device as a member of a specific store (channel).</span></span> <span data-ttu-id="6c569-239">この機能は、オフライン データベースに格納されているデータを最小限に抑えるのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="6c569-239">This feature assists in minimizing the data stored in the offline database.</span></span>  <span data-ttu-id="6c569-240">Express バージョンの SQL を使用する場合、データベースが小さいほうがパフォーマンスを向上させ、サイズの問題を最小限にすることができます。</span><span class="sxs-lookup"><span data-stu-id="6c569-240">A smaller database can assist performance and minimize size issues if using an Express version of SQL.</span></span> <span data-ttu-id="6c569-241">一部のカスタム SQL ビューで、この機能を認識していないテーブル間の依存関係が発生し、機能にエラーが生じる可能性がある場合は、最初にサンドボックス内のこの機能をテストすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-241">It is recommended to test this feature in Sandbox first as some custom SQL views could introduce dependencies between tables that this functionality is not aware of, resulting in errors in functionality.</span></span><br><br> <span data-ttu-id="6c569-242">**データベース統計の自動最適化** によって、チャネル データベースに適用される CDX ダウンロード セッション内の各テーブルのテーブル統計で更新が実行されます。</span><span class="sxs-lookup"><span data-stu-id="6c569-242">**Optimize database statistics automatically** runs an update on the table statistics for each table in the CDX download session applied to the channel database.</span></span> <span data-ttu-id="6c569-243">古いテーブル統計において、断片化されたインデックスよりも大きいパフォーマンスの問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="6c569-243">Outdated table statistics cause more performance issues than fragmented indexes.</span></span> <span data-ttu-id="6c569-244">有効になっている場合、コンフィギュレーション パラメーターに特定のフラグを追加することもお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6c569-244">When enabled, it is also recommended to add a specific flag into the configuration parameters.</span></span>  <span data-ttu-id="6c569-245">これを使用する場合は、**Retail と Commerce \> 本社の設定 \> パラメーター \> コマース共有パラメーター** の順にクリックし、**コンフィギュレーション パラメーター** 一覧に移動して、新しいフラグ **CDX_ENABLE_UPDATE_STATISTICS_FOR_REQUIRED_TABLE** に **1** を入力します。</span><span class="sxs-lookup"><span data-stu-id="6c569-245">If using this, go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce shared parameters**, navigate to the **Configuration parameters** listing, and enter the new flag **CDX_ENABLE_UPDATE_STATISTICS_FOR_REQUIRED_TABLE** with the value **1**.</span></span>  <span data-ttu-id="6c569-246">将来のリリースでこのコンフィギュレーション パラメーターがすべての環境に自動的に追加されますが、その存在を確認するのが重要であることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="6c569-246">Note that in a future release this configuration parameter will be automatically added to all environments, but it is valuable to verify that it exists.</span></span> |

## <a name="additional-resources"></a><span data-ttu-id="6c569-247">追加リソース</span><span class="sxs-lookup"><span data-stu-id="6c569-247">Additional resources</span></span>

- [<span data-ttu-id="6c569-248">Commerce Data Exchange のトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="6c569-248">Commerce Data Exchange troubleshooting</span></span>](CDX-Troubleshooting.md)
- [<span data-ttu-id="6c569-249">Commerce Data Exchange 実装ガイダンス</span><span class="sxs-lookup"><span data-stu-id="6c569-249">Commerce Data Exchange implementation guidance</span></span>](implementation-considerations-cdx.md)
- [<span data-ttu-id="6c569-250">Dynamics 365 Commerce アーキテクチャの概要</span><span class="sxs-lookup"><span data-stu-id="6c569-250">Dynamics 365 Commerce architecture overview</span></span>](../commerce-architecture.md)
- [<span data-ttu-id="6c569-251">ストア内トポロジの選択</span><span class="sxs-lookup"><span data-stu-id="6c569-251">Select an in-store topology</span></span>](retail-in-store-topology.md)
- [<span data-ttu-id="6c569-252">デバイス管理実装ガイダンス</span><span class="sxs-lookup"><span data-stu-id="6c569-252">Device management implementation guidance</span></span>](../implementation-considerations-devices.md)
- [<span data-ttu-id="6c569-253">Modern POS (MPOS) のコンフィギュレーション、インストール、および有効化</span><span class="sxs-lookup"><span data-stu-id="6c569-253">Configure, install, and activate Modern POS (MPOS)</span></span>](../retail-modern-pos-device-activation.md)
- [<span data-ttu-id="6c569-254">Commerce Scale Unit のコンフィギュレーションとインストール (自己ホスト)</span><span class="sxs-lookup"><span data-stu-id="6c569-254">Configure and install Commerce Scale Unit (self-hosted)</span></span>](retail-store-scale-unit-configuration-installation.md)

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
