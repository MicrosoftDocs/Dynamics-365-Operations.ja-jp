---
title: 販売時点管理 (POS) での製品検索および顧客検索
description: このトピックでは、Dynamics 365 Commerce の製品および顧客検索機能に加えられた改良の概要を示します。
author: ShalabhjainMSFT
manager: AnnBe
ms.date: 03/10/2021
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application user
ms.reviewer: josaw
ms.custom: 141393
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Retail
ms.author: shajain
ms.search.validFrom: 2017-06-30
ms.dyn365.ops.version: Retail April 2017 update
ms.openlocfilehash: 23b556e72e1ec76be48336bed21d02abd9d31087
ms.sourcegitcommit: db9b35ce6968cad8874b3c13d4c02d84e2617c8b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2021
ms.locfileid: "5574722"
---
# <a name="product-search-and-customer-search-in-the-point-of-sale-pos"></a>販売時点管理 (POS) での製品検索および顧客検索

[!include [banner](includes/banner.md)]

Modern 販売時点管理 (MPOS) およびクラウド販売時点管理 (CPOS) は、製品および顧客の使いやすい検索機能を提供します。 検索バーは、常に MPOS および CPOS ウィンドウの上部に表示されているため、従業員はすばやく製品および顧客を検索できます。

従業員は、現在の店舗に関連付けられている品揃えとカタログにある商品を検索できます。 会社内の他のどの店舗に関連付けられている品揃えとカタログも検索できます。 したがって、レジ担当者は、店舗の品揃え外製品でも販売および返品をすることができます。 同様に、従業員は、現在の店舗または会社内の他のどの店舗に関連付けられている顧客でも検索できます。 また、従業員は、親組織内の別の会社に関連付けられている顧客も検索できます。

## <a name="product-search"></a>製品検索

既定では、商品検索は、店舗の品揃えで実行します。 このタイプの検索は、*ローカル製品検索* と呼ばれます。 ただし、従業員は、現在の店舗に関連付けられている任意のカタログへ容易に切り替えることができ、または別の店舗で検索することができます。 このタイプの検索は、*リモート製品検索* と呼ばれます。 カタログを変更するには、ページの左側にある **カテゴリ** ボタンを選択します。 表示されるウィンドウの上部で **カタログを変更** ボタンを選択し、参照するのには使用可能なカタログのいずれかを選択します。 システムは、選択した製品のカタログを検索します。

**カタログの変更** ページで、従業員が任意の店舗を容易に選択し、またはすべての店舗間で製品を検索することができます。

![カタログを変更します](./media/Changecatalog.png "カタログを変更します")

ローカル商品検索は、次の製品プロパティ内で検索します。

- 製品番号
- 製品名
- 説明
- 分析コード
- バーコード
- 検索名

### <a name="additional-local-product-search-capabilities"></a>ローカル製品検索の追加機能

- 複数キーワード検索 (検索条件を使用して検索) では、小売業者は、*任意* の検索条件に一致するまたは *すべて* の検索条件に一致する結果のみを含む検索結果かどうかをコンフィギュレーションできます。 この機能の設定は、**製品検索** という名前の新しいグループ内の、POS 機能プロファイルで使用可能です。 既定の設定は **任意の検索条件に一致** です。 この設定は、推奨される設定でもあります。 **任意の検索条件に一致** 設定が使用される場合、結果として完全または部分的に 1 つまたは複数の検索条件に一致するすべての製品が返されます。 それらの結果は自動的に最もキーワードの一致 (完全または部分的) がある製品の昇順で並べ替えられます。

    **すべての検索条件に一致** 設定は、すべての検索条件 (全体または一部) と一致する製品のみを返します。 この設定は、製品名が長くなる場合、および従業員が検索結果で限定されるた製品のみを表示したいときに役に立ちます。 ただし、このタイプの検索には、2 つの制限があります。

    - 個々の製品プロパティに対して検索が行われます。 たとえば、少なくとも 1 つの製品のプロパティに対して、すべての検索キーワードがある製品のみが返されます。
    - 分析コードは検索されません。

- 小売業者は、ユーザーが製品名を入力すると検索候補を表示する製品検索をコンフィギュレーションできます。 この機能の新しい設定は、**製品検索** という名前のグループで、POS 機能プロファイルで使用できます。 設定は **入力中に検索提案を表示** と呼ばれます。 この機能は、全体の名前を手動で入力する必要がないため、従業員が検索している製品をすばやく見つけるのに役立ちます。
- 製品検索アルゴリズムは、製品の **検索名** プロパティで検索された条件も検索するようになります。

![製品候補](./media/Productsuggestions.png "製品候補")

## <a name="customer-search"></a>顧客検索

顧客検索は、さまざまな目的で顧客を見つけるのに使用されます。 たとえば、レジ担当者は顧客の欲しい物リストまたは購入履歴を表示したり、またはトランザクションに顧客を追加するかもしれません。 検索アルゴリズムは、次の顧客プロパティに存在する値と検索条件に一致します。

- 氏名
- 電子メール アドレス
- 電話番号
- ロイヤルティ カード番号
- 住所
- アカウント番号

アルゴリズムは検索キーワードのいずれかに一致するすべての顧客を返すため、これらのプロパティの中で、名前が複数キーワードの検索に対して非常に高い柔軟性を示します。 ほとんどのキーワードに一致する顧客は、結果の上部に表示されます。 この動作は、レジ担当者が氏名を入力して検索しているが、初期データ入力中に姓と名が入れ替えられたような状況で役に立ちます。 ただし、パフォーマンス上の理由から、他のすべてのプロパティは検索キーワードの順序を保持します。 そのため、検索キーワードの順序がデータが保存されている順序と一致しない場合、結果が返されません。

既定では、顧客検索は、店舗に関連付けられている顧客アドレス帳で実行されます。 このタイプの検索は、*ローカル顧客検索* と呼ばれます。 ただし、従業員は顧客をグローバルに検索することもできます。 つまり、会社の店舗間および他のすべての法人間を検索することができます。 このタイプの検索は、*リモート顧客検索* と呼ばれます。

グローバルに検索する場合、次の図に示すように、従業員はページの下部にある **フィルター結果** ボタンを選択でき、**すべての店舗の検索** オプションを選択できます。 この場合、顧客だけが返されるわけではありません。 本社で任意のアドレス帳の一部である関係者のすべてのタイプが返されます。 これらの関係者には、作業者、仕入先、連絡先、および競合他社が含まれます。

> [!NOTE]
> 結果が返されるリモート顧客検索用の最小 4 文字を入力する必要があります。

現在の会社でこれらの関係者用に顧客 ID が作成されていないため、他の法人から照会する顧客用に顧客 ID は表示されません。 ただし、従業員が顧客の詳細ページを開くと、システムは関係者の顧客 ID を自動的に生成し、また店舗の顧客アドレス帳を顧客に関連付けます。 したがって、後に行われるローカル店舗検索時には、顧客が表示されます。

![グローバル顧客検索](./media/Globalcustomersearch.png "グローバル顧客検索")

### <a name="additional-local-customer-search-capabilities"></a>ローカル顧客検索の追加機能

ユーザーが電話番号を検索する際、システムでは、顧客の作成時に追加された可能性のある特殊文字 (スペース、ハイフン、かっこなど) が無視されます。 したがって、レジ担当者は、検索する際に電話番号の形式を考慮する必要はありません。 たとえば、入力された顧客の電話番号が **123-456-7890** の場合、レジ担当者は **1234567890**、またはその電話番号の最初のいくつかの番号を入力することで顧客を検索できます。

> [!NOTE]
> 顧客は複数の電話番号と複数のメールを持つことができます。 顧客検索アルゴリズムでは、これらの二次的なメールと電話番号からも検索されますが、顧客の検索結果ページには、主要なメールと電話番号が表示されるだけです。 これにより、検索されたメールまたは電話番号を表示しない顧客の結果として、混乱が生じる場合があります。 今後のリリースでは、この情報を表示するために、顧客の検索結果画面の改善が計画されています。

従来の顧客検索は、複数のフィールド間で検索するため、時間がかかる場合があります。 代わりに、レジ担当者は名前、電子メール アドレス、または電話番号など、顧客の単一のプロパティで検索できます。 顧客検索アルゴリズムが使用するプロパティは *顧客検索条件* として総称されています。 システム管理者は、POS に表示されるショートカットとして 1 つまたは複数の条件を簡単にコンフィギュレーションできます。 検索は 1 つの条件に制限されているため、関連する検索結果のみが表示され、パフォーマンスは標準的な顧客検索のパフォーマンスに比べてより良いものです。 次の図に、POS での顧客検索ショートカットを示します。

![顧客検索ショートカット](./media/SearchShortcutsPOS.png "顧客検索ショートカット")

ショートカットとして検索基準を設定するには、管理者がコマースで **コマース パラメーター** ページを開き、次に **POS 検索基準** タブで、ショートカットとして表示されるべきすべての基準を選択する必要があります。

![検索ショートカットをコンフィギュレーション](./media/ConfigureShortcutsAX.png "検索ショートカットをコンフィギュレーション")

> [!NOTE]
> あまりに多くのショートカットを追加する場合は、POS の検索バーで、ドロップダウン メニューが雑然として、従業員の検索体験に影響する可能性があります。 必要な数のショートカットだけを追加するようお勧めします。

**表示順序** フィールドでは、POS で表示されるショートカットの順序を決定します。 表示される基準は、顧客を検索するのに顧客検索アルゴリズムが使用する、最初から用意されているプロパティです。 ただし、パートナーは、検索ショートカットとしてカスタム プロパティを追加することができます。 検索ショートカットとしてカスタム プロパティを追加するには、システム管理者は顧客の検索条件として使用する拡張可能列挙 (列挙) を拡張し、ショートカットとしてパートナーのカスタム プロパティをマークする必要があります。 パートナーは、そのカスタム ショートカットが検索に使用されるときに、結果を検索するコードを記述します。

> [!NOTE]
> 列挙に追加されるカスタム プロパティは、標準的な顧客検索アルゴリズムに影響しません。 つまり、顧客検索アルゴリズムは、カスタム プロパティでは検索しません。 ユーザーは、ショートカットとしてカスタム プロパティが追加された場合、または既定の検索アルゴリズムが上書きされる場合にのみ、検索用にカスタム プロパティを使用できます。

小売業者は、POS の既定の顧客検索モードを **すべての店舗の検索** に設定することもできます。 このコンフィギュレーションは、POS 以外で作成された顧客をすぐに検索する必要があるようなシナリオの場合 (たとえば、配送ジョブが実行される前であっても) に役に立ちます。 そのために、小売業者は POS 機能プロファイルで **既定の顧客検索モード** オプションをオンにする必要があります。 **はい** に設定すると、顧客検索のすべての試行により、本社に対するリアルタイムの呼び出しが行われます。

予期しないパフォーマンスの問題を防ぐために、このコンフィギュレーションは **CUSTOMERSEARCH_ENABLE_DEFAULTSEARCH_FLIGHTING** という名前のフライティング フラグの後ろに隠されています。 そのため、ユーザー インターフェイス (UI) に **既定の顧客検索モード** の設定を表示するには、小売業者はユーザー承認テスト (UAT) および実稼働環境のためにサポート チケットを作成する必要があります。 チケットを受け取った後、エンジニアリング チームは小売業者と協力し、パフォーマンスの評価と必要なすべての最適化の実装を行うのに小売業者が非実稼働環境でテストを行っていることを確認します。

## <a name="cloud-powered-customer-search"></a>クラウドを利用した顧客検索

Azure Cognitive Search サービスを使用する顧客検索機能のパブリック プレビューは、Commerce 10.0.18 リリースの一部としてリリースされました。 このサービスのユーザーは、パフォーマンスの向上に加えて、豊かに洗練され、関連性が向上した機能の恩恵を受けることもできます。 POS のグローバル検索機能 (「すべての店舗を検索」) を使用する場合、パフォーマンスの向上が特に明らかです。 これは、Commerce 本社のデータからクエリする代わりに、Azure 検索インデックスから検索結果がフェッチされるからです。 

### <a name="enable-the-cloud-powered-search-feature"></a>クラウドを利用した検索機能の有効化

> [!NOTE]
> Commerce 本社と Commerce Scale Unit の両方をバージョン 10.0.18 に更新する必要があります。 POS の更新は必須ではありません。

Commerce 本社で、クラウドを利用した検索機能を有効にするには、次の手順を実行します。

1. **システム管理者 \> ワークスペース \> フィーチャー管理** の順に移動します。
1. **(プレビュー) クラウドを利用した顧客検索** 機能を見つけて選択し、**今すぐ有効にする** を選択します。
1. **Retail と Commerce > 本社の設定 > コマース スケジューラ > コマース スケジューラの初期化** の順に移動して、**OK** を選択すると、**配送スケジュール** フォームに新しい **1010_CustomerSearch** ジョブが表示されます。
1. **Retail とコマース > Retail とコマース IT > 配送スケジュール** の順に移動します。
1. **1010_CustomerSearch** ジョブを実行します。 このジョブは、この日付を Azure 検索インデックスに発行します。 インデックスの発行が完了すると、ジョブのステータスが **適用済** に設定されます。
1. **1010_CustomerSearch** ジョブのステータスが **適用済** に設定された後、**1110 - グローバル コンフィギュレーション** ジョブを実行して、**機能管理** で新しく有効にされた機能の POS チャネルを更新します。
1. その後、**1010_CustomerSearch** ジョブを定期的に実行して、顧客の更新を検索インデックスに送信します。

> [!NOTE]
> 初期インデックスの発行では、すべての顧客レコードが Azure 検索インデックスに送信されるので、**1010_CustomerSearch** ジョブの完了に数時間かかる場合があります。 その後の更新には数分かかります。 クラウドを利用した検索機能が有効でも、インデックスの発行がまだ完了していない期間中は、POS からの顧客検索の既定値は、既存の SQL ベースの検索になります。 これにより、店舗運営が中断されることはありません。

### <a name="functional-differences-from-the-existing-search"></a>既存の検索との機能の違い

次のリストは、クラウドを利用した顧客検索機能と既存の検索機能の違いを示しています。 

- Commerce 本社で作成および編集された顧客は、**1010_CustomerSearch** ジョブの実行時 Azure 検索インデックスに送信されます。 これらの更新では、インデックスを更新するために少なくとも 15 ~ 20 分かかります。 POS ユーザーは、Commerce 本社で更新が行われてから 15 ~ 20 分後に新しい顧客を検索 (または更新情報に基づいて検索) することができます。 業務プロセスにおいて、Commerce 本社で作成した顧客を POS で直ちに検索可能にする必要がある場合、これは適切なサービスではない可能性があります。
- POS で作成された新しい顧客は Commerce Scale Unit から Azure 検索インデックスに送信され、直ちに店舗全体で検索可能になります。 ただし、非同期顧客作成機能が有効な場合、新しい顧客レコードは Commerce Scale Unit から Azure 検索インデックスに発行されず、顧客情報が Commerce 本社と同期され、非同期顧客の顧客 ID が生成されるまで POS から検索できません。 **1010_CustomerSearch** ジョブは、非同期顧客レコードを Azure 検索インデックスに送信できるようになります。 新しく作成された非同期顧客を POS で検索できるようになるまで平均で約 30 分かかります。 この見積は、**1010_CustomerSearch**、**P-job**、および **非同期モードから顧客と取引先を同期する** ジョブが 15 分ごとに実行されるようにスケジュールされていることを前提としています。
- クラウドを利用した検索では、顧客の 2 番目の電子メールと電話番号も検索されますが、現在、顧客の検索結果には、顧客の主要な電話番号と主要な電子メール アドレスのみが表示されます。 一見すると無関係な検索結果が返されたように思えますが、検索結果で顧客の 2 番目の電子メールと電話番号を確認すると、キーワードによる検索結果が顧客と一致していることを確認できます。 このような混乱を避け、ユーザーが検索結果が返された理由を容易に理解できるように、検索結果ページを改善する計画があります。
- 検索に 4 文字以上を使用するというグローバル検索 (「すべての店舗を検索」) での要件は、このサービスには適用されません。

> [!NOTE]
> Azure Cognitive Search サービスを使用する顧客検索機能は、限定された地域でプレビュー用に利用できます。 顧客検索機能は、次の地域では利用 *できません*。
> - ブラジル
> - インド
> - カナダ
> - 英国

[!INCLUDE[footer-include](../includes/footer-banner.md)]
