---
title: トランザクション イベント用の電子メール テンプレートの作成
description: このトピックでは、Microsoft Dynamics 365 Commerce のトランザクション イベント用の電子メール テンプレートの作成、アップロード、および構成する方法について説明します。
author: bicyclingfool
ms.date: 12/10/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: stuharg
ms.search.validFrom: 2020-01-20
ms.dyn365.ops.version: Release 10.0.8
ms.openlocfilehash: 25d7fcb803645f50ee4f5c608f5b6e789dfe3c31
ms.sourcegitcommit: eef5d9935ccd1e20e69a1d5b773956aeba4a46bc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2021
ms.locfileid: "7913755"
---
# <a name="create-email-templates-for-transactional-events"></a>トランザクション イベント用の電子メール テンプレートの作成

[!include [banner](includes/banner.md)]
[!include [banner](includes/preview-banner.md)]

このトピックでは、Microsoft Dynamics 365 Commerce のトランザクション イベント用の電子メール テンプレートの作成、アップロード、および構成する方法について説明します。

Dynamics 365 Commerce には、顧客に取引上のイベントを知らせるメールを送信するための、既成のソリューションを実装しています。 たとえば、注文が入った際や受け取り可能な状態になった場合、出荷された時などにメールを送信することができます。 このトピックでは、トランザクション電子メールの送信に使用される電子メール テンプレートの作成、アップロード、構成をする手順について説明します。

## <a name="notification-types"></a>通知タイプ

注文や顧客のライフサイクルの中で特定のイベントが発生したときに、メールで顧客に通知するように構成することができます。 通知を構成するには、Commerce のメール通知プロファイルを作成して、メールテンプレートを通知タイプにマッピングする必要があります。 メール通知プロファイルの設定方法については、[メール通知プロファイルの設定](email-notification-profiles.md)を参照してください。

Dynamics 365 Commerce は、次の通知タイプをサポートしています。

### <a name="order-created"></a>注文が作成されました

*作成された注文* の通知タイプは、Commerce 本部で新しい販売注文が作成されるとトリガーされます。

> [!NOTE]
> 注文作成の通知タイプは、販売時点管理 (POS) 端末で発生するキャッシュ アンド キャリー取引には適用されません。 この場合、電子メールまたは印刷されたレシートが代わりに生成されます。 詳細については、 [Modern POS (MPOS) から電子メールのレシートを送信する](email-receipts.md)を参照してください。

### <a name="order-confirmed"></a>注文確認済

*注文確認済* 通知のタイプは、Commerce 本部からの販売注文に対して注文確認ドキュメントが生成された場合に発生します。

### <a name="picking-completed"></a>集荷完了

*ピッキング完了* の通知タイプは、注文のピッキング リストが Commerce 本部で完了とマークされている場合にトリガーされます。

> [!NOTE]
> ピッキング完了の通知タイプは、POS 端末で品目がピッキング済みとマークされた場合にはトリガーされません。

### <a name="packing-completed"></a>梱包完了

*パッキング完了* の通知タイプは、POS 端末で Commerce 本部の注文に対して梱包明細ドキュメントが生成されたときに発生します。

梱包完了通知タイプは、トランザクション メールからの「注文の受け取り準備完了」や注文検索機能を容易にするために、以下の追加メール プレースホルダーをサポートしています。

| プレースホルダー名    | 使用方法 |
| ------------------- | ------- |
| `pickupstorename`     | 注文品の受け取りが可能な店舗名。 |
| `pickupstoreaddress`  | 注文品の受け取りが可能な住所。 |
| `pickupstorehourfrom` | 集荷店舗の開店時間。 |
| `pickupstorehourto`   | 集荷店舗の閉店時間。 |
| `pickupchannelid`     | 集荷店舗のチャネル ID。 |
| `packingslipid`      | 集荷される注文の梱包明細書の ID。 |
| `confirmationid`      | 集荷される注文の注文確認 ID。 (このIDは、チャネル参照 ID と呼ばれる場合もあります。) |

顧客のチェックインと注文ルックアップの機能については、[地理検知とリダイレクトの設定](geo-detection-redirection.md)と[ゲストのチェックアウト時の注文検索の有効化](order-lookup-guest.md)を参照してください。

### <a name="order-ready-for-pickup"></a>注文の受取準備完了

*集荷可能な注文* の通知タイプは、注文が梱包済みとマークされ、1 つ以上の注文行で配送モードが **顧客の集荷** に設定された場合に発生します。

> [!NOTE]
> 注文の集荷準備完了の通知タイプは廃止され、梱包完了の通知タイプに変更されました。 この通知タイプは、配送モードでカスタマイズされます。

### <a name="order-shipped"></a>注文出荷済

*注文の出荷* 通知タイプは、店舗以外の荷渡方法を持つ注文が請求された場合に発生します。

> [!NOTE]
> 注文の出荷通知タイプは廃止され、注文の請求通知タイプに変更されました。 この通知タイプは、配送モードでカスタマイズされます。

### <a name="order-invoiced"></a>注文請求済み

*請求書が発行された注文* の通知タイプは、POS や Commerce 本部で注文が請求されたときに発生します。

### <a name="issue-gift-card"></a>ギフト カードの発行

*ギフト カード* 発行通知タイプは、ギフト カード タイプの商品を含む販売注文が請求書を発行したときにトリガmーされます。

> [!NOTE]
> 発行されたギフト カードの通知メールは、ギフト カードの受取人に送信されます。 ギフト カードの送り先は、Commerce 本部の個別受注ラインの **ライン詳細** の **梱包** タブで指定します。 手動またはプログラムで指定できます。

ギフト カード発行通知タイプでは、次の追加プレースホルダーがサポートされます。

| プレースホルダー名      | 使用方法 |
| --------------------- | ------- |
| `giftcardnumber`        | ギフト カード タイプの製品の場合の、ギフトカード番号です。 |
| `giftcardbalance`       | ギフト カード タイプの製品の場合の、ギフトカード残高です。 |
| `giftcardmessage`       | ギフト カード タイプの製品の場合の、ギフトカードのメッセージです。 |
| `giftcardpin`         | ギフト カード タイプの製品の場合の、ギフトカードの識別番号 (PIN) です。 (このプレースホルダーは、外部のギフトカードに固有のものです) |
| `giftcardexpiration`    | ギフト カード タイプの製品の場合の、ギフトカードの有効期限です。 (このプレースホルダーは、外部のギフトカードに固有のものです) |
| `giftcardrecipientname` | ギフト カード タイプの製品の場合の、ギフトカードの受取人の名前です。 |
| `giftcardbuyername`     | ギフト カード タイプの製品の場合の、ギフトカードの購入者の名前です。 |

ギフトカードについての詳細は、 [Eコマース デジタル ギフト カード](digital-gift-cards.md)および[外部ギフト カードのサポート](dev-itpro/gift-card.md)を参照してください。

### <a name="order-cancellation"></a>注文取消

*注文の取り消し* の通知タイプは、Commerce 本部で注文がキャンセルされた際に発生します。

### <a name="customer-created"></a>顧客が作成されました

*作成された顧客* の通知タイプは、Commerce 本部で新しい顧客エンティティが作成されるとトリガーされます。

### <a name="b2b-prospect-approved"></a>企業間見込顧客が承認されました

*承認された B2B 見込顧客* の通知タイプは、見込顧客のオンボーディング リクエストが Commerce 本部で承認されるとトリガーされます。 B2B 見込顧客を承認、または否認する方法の詳細については、[新規ビジネス パートナーの管理者ユーザーを設定する](b2b/manage-b2b-users.md#set-up-the-administrator-user-for-a-new-business-partner)を参照してください。 

承認された B2B 見込顧客の通知タイプは、以下の追加プレースホルダーに対応しています。

| プレースホルダー名 | 使用方法                                                      |
| ---------------- | ------------------------------------------------------------ |
| `firstname`       | 申請に入力されている B2B の見込顧客の名です。 |
| `lastname`         | 申請に入力されている B2B の見込顧客の姓です。 |
| `company`          | 申請に記入されている申請者の会社名です。 |
| `email`            | 申請に入力されている見込顧客の電子メールアドレスです。   |
| `zipcode`          | 見込顧客のプライマリ住所の郵便番号です。 |
| `comments`         | 見込顧客が申請に入力したコメントです。 |
| `storename`        | 見込顧客が作成されたチャネルの名前です。 |
| `storeurl`         | 既定では空白です。 このプレースホルダーを使用するには、カスタム拡張機能を作成する必要があります。 |

### <a name="b2b-prospect-rejected"></a>企業間見込顧客が拒否されました

*否認された B2B 見込顧客* の通知タイプは、見込顧客のオンボーディング リクエストが Commerce 本部で否認されるとトリガーされます。 B2B 見込顧客を承認、または否認する方法の詳細については、[新規ビジネス パートナーの管理者ユーザーを設定する](b2b/manage-b2b-users.md#set-up-the-administrator-user-for-a-new-business-partner)を参照してください。 

否認された B2B 見込顧客の通知タイプは、以下の追加プレースホルダーに対応しています。

| プレースホルダー名 | 使用方法                                                      |
| ---------------- | ------------------------------------------------------------ |
| `firstname`        | 申請に入力されている B2B の見込顧客の名です。 |
| `lastname`         | 申請に入力されている B2B の見込顧客の姓です。 |
| `company`          | 申請に記入されている申請者の会社名です。 |

## <a name="create-an-email-template"></a>電子メール テンプレートを作成する

特定のトランザクション イベントを電子メールのテンプレートにマッピングするには、事前にテンプレートを作成しておく必要があります。

電子メール テンプレートを作成するには、次の手順に従います。

1. Commerce 本部で、**Retail と Commerce \> 本社の設定 \> 組織の電子メール テンプレート** または、**組織管理 \> 設定 \> 組織の電子メール テンプレート** に移動します。
1. **新規** を選択します。
1. **全般** 配下で、次のフィールドを設定します:

    - **電子メール ID** - 電子メール ID はテンプレートに固有の識別子です。 イベントにマッピングするテンプレートを選択したときに表示される値です。
    - **電子メールの説明** – このオプション フィールドを使用して、テンプレートの説明を入力できます。 入力した値は、Commerce 本部でのみ表示されます。
    - **送信者名** – ここに入力した名前が、ほとんどの電子メール クライアントの [差出人] フィールドに表示されます。
    - **送信者の電子メール** – このテンプレートを使用して送信する電子メールが使用する電子メールのアドレスを入力します。
    - **既定の言語コード** – このフィールドは、このテンプレートを呼び出したチャネルが言語を指定していない場合に、既定で送信されるメールのローカライズ バージョンを指定します。

1. **電子メール メッセージ コンテンツ** 配下で、**新規** を選択します。
1. **言語** フィールドに、電子メール テンプレートの言語を入力します。 言語とローカライズされたテンプレートは後で追加することもできます。
1. **件名** フィールドには、電子メールの件名フィールドに表示される件名を入力します。
1. 電子メールのテンプレートをアップロードするには、**編集** を選択します。

## <a name="create-an-email-message-body-by-using-html"></a>HTML を使用して電子メール メッセージの本文を作成する

電子メール メッセージの本文はHTMLで構成されています。 HTML およびインライン カスケードスタイルシート (CSS) で使用できる任意のレイアウト、スタイル、ブランディングを使用できます。 一般に公開されている web のエンドポイントに画像をホストする場合は、画像を使用することもできます。 画像を追加するには、HTML **&lt;img&gt;** タグの **src** 属性に画像のURLを入力します。

> [!NOTE]
> 電子メール クライアントにはレイアウトやスタイルの制限があり、メッセージ本文に使用するHTMLや CSS の調整が必要となる場合があります。 人気の高い電子メール クライアントによってサポートされている HTML を作成するためのベスト プラクティスについて理解しておくことをお勧めします。

## <a name="add-placeholders-to-the-email-message-body"></a>電子メール メッセージの本文にプレースホルダーを追加する

電子メールにはプレースホルダーを含めることができます。これは電子メールが生成された際に顧客固有の値やトランザクション固有の値に置き換えられます。 プレースホルダは常にパーセント記号 (%) で囲まれており、HTML 文書の中に直接挿入されます。

次に例を示します。

```html
<p>
    Hello %customername%,<br />
    Order number %salesid%, can be picked up from the <b>%pickupstorename%</b> store.
</p>
```

### <a name="order-placeholders-sales-order-level"></a>注文のプレースホルダー (販売注文レベル)

以下のプレースホルダーは、販売注文レベルで定義されたデータを取得して表示します (販売明細行レベルとは異なります)。

| プレースホルダー名     | 使用方法                                                      |
| -------------------- | ------------------------------------------------------------ |
| `customername`         | 注文を行った顧客の名称です。               |
| `customeraddress`      | 顧客の住所です。                                 |
| `customeremailaddress` | 顧客がチェックアウト時に入力した電子メール アドレスです。     |
| `salesid`              | 注文の販売 ID です。                                   |
| `orderconfirmationid`  | 注文の作成時に生成されたチャンネル間 ID。   |
| `channelid`            | 注文が行われた小売またはオンライン チャネルの ID。 |
| `deliveryname`         | 配送先住所に指定されている名前。         |
| `deliveryaddress`      | 出荷注文の配送先住所です。                     |
| `deliverydate`         | 配送日です。                                           |
| `shipdate`             | 出荷日です。                                               |
| `modeofdelivery`       | 注文の出荷モードです。                              |
| `ordernetamount`       | 注文の合計金額から税の合計を差し引いた金額です。         |
| `discount`            | 注文に対する割引の合計です。                            |
| `charges`              | 注文に対する金額の合計です。                             |
| `tax`                  | 注文の税の合計です。                                 |
| `total`                | 注文に対する金額の総計です。                              |
| `storename`            | 注文を行った店舗の名称です。            |
| `storeaddress`         | 注文を行った顧客の住所です。              |
| `storeopenfrom`        | 注文を行った店舗の開店時間です。         |
| `storeopento`          | 注文を行った店舗の閉店時間です。         |
| `pickupstorename`      | 注文が受け取られる店舗の名称です。\*   |
| `pickupstoreaddress`   | 注文がピッキングされる店舗の住所です。\* |
| `pickupopenstorefrom`  | 注文がピッキングされる店舗の開店時間です。\* |
| `pickupopenstoreto`    | 注文がピッキングされる店舗の閉店時間です。\* |
| `pickupchannelid`     | 集荷モードに指定されている店舗のチャネル ID。\* |
| `packingslipid`        | 注文の明細行が梱包されたときに生成された梱包明細の ID。\* |

\*これらのプレースホルダーは、**集荷準備完了** 通知タイプの注文に使用された場合にのみデータを返します。 

### <a name="order-line-placeholders-sales-line-level"></a>注文ラインのプレースホルダー (販売ライン レベル)

以下のプレースホルダーは、販売注文の個々の製品 (明細行) のデータを取得して表示します。

| プレースホルダー名               | 使用方法 |
|--------------------------------|-------------------|
| `productid`                      | <p>製品の ID。 この ID はバリアントを表しています。</p><p><strong>注:</strong> このプレースホルダーは廃止され、`lineproductrecid` が採用されました。</p> |
| `lineproductrecid`               | 製品の ID。 この ID はバリアントを表しています。 バリアント レベルで品目を一意に識別します。 |
| `lineitemid`                     | 製品の製品レベルの ID。 (この ID はバリアントを考慮していません。) |
| `lineproductvariantid`           | 製品バリアントの ID。 |
| `lineproductname`                | 生産の名前。 |
| `lineproductdescription`         | 製品の説明。 |
| `linequantity`                   | ラインに発注された単位数と測定単位 (**ea**、**pair** など) です。 |
| `lineunit`                       | ラインの測定単位です。 |
| `linequantity_withoutunit`       | ラインに発注された単位数で、測定単位を含まないもの。 |
| `linequantitypicked`             | 注文の **PickOrder** イベントが使用された場合の、ピッキングされた単位の数です。 これに該当しない場合は **0** (ゼロ) になります。 |
| `linequantitypicked_withoutunit` | **PickOrder** イベントが使用された場合の、測定単位を含まない、ピッキングされた単位の数です。 これに該当しない場合は **0** (ゼロ) になります。 |
| `linequantitypacked`             | **PackOrder** および **ピックアップ可能な注文** イベントが使用された場合の、梱包された単位数です。 これに該当しない場合は **0** (ゼロ) になります。 |
| `linequantitypacked_withoutuom`  | **PackOrder** および **ピックアップ可能な注文** イベントが使用された場合の、測定単位を含まない、梱包された単位数です。 これに該当しない場合は **0** (ゼロ) になります。 |
| `linequantityshipped`            | 以下に説明するように、特定のイベントが使用されている場合を除き、常に **0** となります。 |
| `linequantityshipped_withoutuom` | **ShipOrder** イベントが使用された場合の、測定単位を含まない、ピッキングされた単位の数です。 これに該当しない場合は **0** (ゼロ) になります。 |
| `lineprice`                      | 一単位の価格です。 |
| `linenetamount`                  | 単位および適用後のラインの価格です。 |
| `linediscount`                   | 個々の単位の割引です。 |
| `lineshipdate`                   | 当該ラインの出荷日です。 |
| `linedeliverydate`               | 当該ラインの配達日です。 |
| `linedeliverymode`               | 当該ラインの配送モードです。 |
| `linedeliveryaddress`            | 当該ラインの配達先住所です。 |
| `linepickupdate`                 | 集荷モードの配送を使用する注文の場合、顧客が指定した集荷日。 |
| `linepickuptimeslot`             | 集荷モードの配送を使用する注文の場合、顧客が指定した集荷時間の範囲。 |
| `giftcardnumber`                 | ギフト カード タイプの製品の場合の、ギフトカード番号です。 |
| `giftcardbalance`                | ギフト カード タイプの製品の場合の、ギフトカード残高です。 |
| `giftcardmessage`                | ギフト カード タイプの製品の場合の、ギフトカードのメッセージです。 |
| `giftcardpin`                    | ギフトカードタイプの製品の場合は、ギフトカードの PIN です。 (このプレースホルダーは、外部のギフトカードに固有のものです) |
| `giftcardexpiration`             | ギフト カード タイプの製品の場合の、ギフトカードの有効期限です。 (このプレースホルダーは、外部のギフトカードに固有のものです) |
| `giftcardrecipientname`          | ギフト カード タイプの製品の場合の、ギフトカードの受取人の名前です。 |
| `giftcardbuyername`              | ギフト カード タイプの製品の場合の、ギフトカードの購入者の名前です。 |

### <a name="format-of-order-line-placeholders-in-the-email-message-body"></a>電子メール メッセージ本文における注文明細行のプレースホルダーの形式

メール本文で個々の注文行の HTML を作成する際には、繰り返し表示される HTML ブロックと行のプレースホルダーを以下のプレースホルダーで囲みます。 プレースホルダーが HTML のコメントタグ内にあることに注意してください。

```html
<!--%tablebegin.salesline%-->

(Insert the repeating block of HTML and placeholders for individual lines here.)

<!--%tableend.salesline%-->
```

次に例を示します。

```HTML
<table>
    <tr>
        <td>Product name</td>
        <td>Quantity</td>
        <td>Price</td>
    </tr>
    <!--%tablebegin.salesline%-->
    <tr>
        <td>%lineproductname%</td>
        <td>%linequantity_withoutunit%</td>
        <td>%lineprice%</td>
    </tr>
    <!--%tableend.salesline%-->
</table>
```

## <a name="create-a-template-for-emailed-receipts"></a>メールで送信される領収書のテンプレートを作成する

領収書は、販売時点管理 (POS) で購入した顧客に電子メールで送信することができます。 一般的には、メールで送信する領収書のテンプレートの作成手順は、その他のトランザクション イベントのテンプレートの作成手順と同じです。 この場合、以下の変更が必要となります:

- **%message%** のプレースホルダーは、メールに領収書のテキストを挿入する目的で使用されます。 領収書の本文が正しく表示されるように、**%message%** プレースホルダーを HTML タグの **&lt;pre&gt;** および **&lt;/pre&gt;** で囲みます。
- **%receiptid%** プレースホルダーは、領収書の ID を表す QRコードまたはバーコードを表示するために使用できます。 (QRコードおよびバーコードはサード パーティ サービスによって動的に生成および提供されます。) 電子メールで送信する領収書の QRコードまたはバーコードを表示する方法については、[QRコードまたはバーコードをトランザクションおよび領収書の電子メールに追加する](add-qr-code-barcode-email.md) を参照してください。

## <a name="upload-the-email-html"></a>電子メールの HTML をアップロードする

HTML を作成し、テストした後は、メッセージの本文を Commerce 本部にアップロードする必要があります。 現時点では、電子メールの HTML はエクスポートできません。 そのため、HTML のマスターコピーは Commerce 本部以外で管理する必要があります。

新規、または編集した電子メールのテンプレート HTML をアップロードするには、次の手順に従います。

1. Commerce 本部で、**小売りとコマース \> 本部の設定 \> 組織の電子メールのテンプレート** に移動します。
1. HTML を追加または置換する言語の行を選択します。 または、**新規** を選択して新しい言語の行を作成します。
1. **編集** を選択します。
1. 表示されたダイアログ ボックスで、**参照** を選択します。 アップロードする HTMLドキュメントを参照して選択し、**開く** を選択し ます。
1. **アップロード** を選択します。
1. プレビュー ウィンドウに電子メールの HTML が表示されたら、**OK** を選択します。
1. 行に対して、 **本文** のチェックボックスが選択されていることを確認します。

Commerce 本部が電子メールを送信するように設定済みの場合は、テンプレートにマッピングされたイベントを呼び出すトランザクションを実行するすべての顧客に、新規または更新された電子メールが送信されます。

Dynamics 365 Commerce で電子メールを構成する方法の詳細については、[電子メールの構成と送信](../fin-ops-core/fin-ops/organization-administration/configure-email.md)を参照してください。

## <a name="additional-resources"></a>追加リソース 

[電子メール通知プロファイルの設定](email-notification-profiles.md)

[電子メールのコンフィギュレーションと送信](../fin-ops-core/fin-ops/organization-administration/configure-email.md)

[電子メールのレシートを設定](/dynamicsax-2012/appuser-itpro/set-up-email-receipts)

[Modern POS (MPOS) からの領収書メールを送信する](email-receipts.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
