---
title: B2B eコマース サイト用の顧客アカウントの支払方法の構成
description: このトピックでは、Microsoft Dynamics 365 Commerce で顧客アカウントの支払方法を構成する方法について説明します。 また、与信限度額が企業間 (B2B) e コマース サイトの分割払いのキャプチャにどのような影響を及ぼすかについても説明します。
author: josaw1
ms.date: 04/19/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: RetailOperations
audience: Application User, IT Pro
ms.reviewer: v-chgri
ms.search.region: Global
ms.search.industry: retail
ms.author: josaw
ms.search.validFrom: 2021-01-31
ms.dyn365.ops.version: 10.0.14
ms.openlocfilehash: a55a5d4c9dbf7909af5219843fc4310b6cdd4ed7
ms.sourcegitcommit: a58dfb892e43921157014f0784bd411f5c40e454
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/04/2022
ms.locfileid: "8689640"
---
# <a name="configure-the-customer-account-payment-method-for-b2b-e-commerce-sites"></a>B2B eコマース サイト用の顧客アカウントの支払方法の構成

[!include [banner](../../includes/banner.md)]

このトピックでは、Microsoft Dynamics 365 Commerce で顧客アカウントの支払方法を構成する方法について説明します。 また、与信限度額が企業間 (B2B) e コマース サイトの分割払いのキャプチャにどのような影響を及ぼすかについても説明します。

小売業者は、eコマースチャネルで販売する商品やサービスと引き換えに、様々なタイプの支払いを受け入れることができます。 小売業者が受け入れる各支払タイプは、システムの設定時に Dynamics 365 Commerce でコンフィギュレーションする必要があります。 B2B e コマース サイトでは、顧客勘定 (または"分割払い") の支払方法がサポートされている必要があります。 

## <a name="prerequisites"></a>必要条件

1. Commerce 本部の顧客勘定の支払い方法を追加します。
2. 顧客勘定の支払方法を eコマースチャネルに関連付けます。
3. Commerce 本部の **小売とコマース \> 顧客 \> すべての顧客 \> 既定の支払** で顧客に対して **Allow on account** プロパティが有効になっている必要があります。

    > [!NOTE]
    > すべての顧客に対して、分割払い支払方法の有効化を許可する必要がある場合、B2B サイトに関連付けられているチャンネルの既定の顧客に対して **Allow on account** プロパティを **はい** に設定できます。 

## <a name="enable-the-customer-account-payment-method-in-commerce-site-builder"></a>Commerce サイトビルダーで顧客勘定の支払い方法を有効にする 

Commerce サイトビルダーで顧客勘定の支払い方法を有効にするには、次の手順に従います。

1. **サイト 設定 \> 拡張機能** に移動します。
1. **顧客勘定支払を有効にする** プロパティを **B2B 顧客に対して有効化する** に設定します。 
1. **保存と公開** を選択します。

> [!NOTE]
> 新しいサイト設定は、app.settings.json ファイルがが更新された後にのみ有効になります。 詳細については、[SDK およびモジュール ライブラリの更新プログラム](../e-commerce-extensibility/sdk-updates.md)を参照してください。

## <a name="enable-the-customer-account-payment-method-on-the-checkout-page-for-the-b2b-e-commerce-site"></a>B2B e コマース サイトのチェック アウト ページで顧客勘定の支払方法を有効にする

B2B e コマース サイトのチェック アウト ページで顧客勘定の支払方法を有効にするには、次の手順に従います。

1. Commerce サイト ビルダで、B2B 電eコマース サイトのチェックアウト モジュールを含むチェック アウト ページまたはチェックアウト ページの特定部分を編集します。
1. **チェックアウト セクションのコンテナ** スロットで、**モジュールの追加** を選択 し、**顧客勘定の支払** モジュールを追加します。
1. 省略記号 (**...**) を選択して、必要に応じて **上へ移動** または **下へ移動** を選択して、**顧客アカウントの支払い** モジュールを配置します。
1. **保存** を選択し、 **編集の完了** を選択してページにチェックインし、**発行** を選択して公開します。

## <a name="confirm-that-the-customer-account-payment-method-has-been-enabled-and-published"></a>顧客勘定の支払い方法が有効化されており、公開されていることを確認する

顧客勘定の支払い方法が有効化されており、公開されていることを確認するには、次の手順に従います。

1. eコマース サイトにサインインします。
1. 買い物カゴに製品を追加します。
1. チェックアウトのページに移動します。 新しい **顧客勘定** の支払方法が表示されます。

## <a name="work-with-credit-limits"></a>与信限度額に関して

B2B サイトで顧客勘定支払の機能が有効になっている場合、組織は通常、注文のキャプチャプロセス中に与信限度額と与信限度額残高に関する情報を表示したいと思います。 顧客の与信限度額は、Commerce 本部の顧客レコードの **クレジットと回収** クイック タブの **Credit limit** プロパティで定義されます。 ただし、B2B のシナリオでは、顧客がおこなった注文は、多くの場合顧客が属している組織のアカウントに対して請求を行う必要があります。 したがって、顧客レコードの **請求と出荷** クイック タブで、**Invoice account** プロパティを組織の顧客 ID に設定する必要があります。 その後、顧客が B2B サイトで注文を行う際に、注文が組織に請求されます。 B2B サイトでは、顧客レコードに対して定義された与信限度額の代わりに組織の与信限度額も使用されます。

B2B Webサイトに表示される与信限度額の計算と残高は、Commerce 本部の **Credit limit type** プロパティの設定によって異なります。 このプロパティの場所は、**機能管理** ワークスペースで **クレジット管理** 機能が有効になっているかどうかによって異なります。

- **クレジット管理** 機能が有効な場合、このプロパティは、**クレジットと回収 \> 設定 \> クレジットと回収のパラメータ \> クレジット** の **与信限度額** クイック タブにあります。 
- **クレジット管理** 機能が無効な場合、このプロパティは、**売掛金勘定 \> 設定 \> 売掛金勘定のパラメータ \> 信用格付け** の **信用格付け** にあります。

**Credit limit type** プロパティでサポートされる値は、**なし**、**残高**、**残高 + 梱包明細または製品領収書**、**残高 + すべて** です。 これらの値の詳細については、[与信限度額のタイプ](/dynamics365/supply-chain/sales-marketing/credit-limits-customers) を参照してください。

> [!NOTE]
> **Credit limit type** プロパティを **残高 + 梱包明細または製品明細** に設定して、オープン販売注文を残高計算に含めずにすることをお勧めします。 その後、顧客が将来注文を行う場合、それらの注文が現在の残高に影響を与える可能性があるという変更を行う必要はありません。

分割払い注文に影響する別のプロパティは、顧客レコードの **クレジットと回収** クイック タブにある **Mandatory credit limit** プロパティです。 特定の顧客に対してこのプロパティを **はい** に設定すると、**与信限度額のタイプ** プロパティが **なし** に設定されているどの顧客に対しても与信限度額をチェックしないように指定されている場合でも、システムにそれをチェックさせることができます。

現在、分割支払方法を使用している顧客は、残りの注文の貸方残高より多く支払うことはできません。 たとえば、顧客の残りの貸方残高が $1,000 である一方で、注文金額が $1,200 の場合、顧客は、分割払い方法を使用して $1,000 のみを支払うことができます。 残高の支払には、他の支払方法を使用する必要があります。 将来のリリースでは、Commerce コンフィギュレーションにより、ユーザーは注文を行う際に与信限度額を超えて購入することができます。

**クレジットと回収** モジュールには、新しいクレジット管理機能があります。 これらの機能を有効にするには、**機能管理** ワークスペースの **クレジット管理** 機能を有効にします。 この新しい機能の 1 つによって、販売注文をブロック ルールに基づいて保留にできます。 その後、クレジット マネージャの担当者は、さらに分析した後で注文をリリースまたは否認できます。 ただし、販売注文を保留にできる機能は、Commerce 注文には適用されません。これは、販売注文には前払がある場合と、**クレジット管理** 機能が前払のシナリオを完全にサポートしないためです。 

**クレジット管理** 機能が有効になっているかどうかに関係なく、注文履行の際に顧客残高が与信限度額を超え終わった場合、販売注文は保留にされません。 代わりに、Commerce は、**与信限度額** クイック タブの **与信限度額を超えた場合のメッセージ** フィールドの値に応じて、警告メッセージまたはエラー メッセージが生成されます。

Commerce の販売注文の保留を妨げる **Exclude from credit management** プロパティは、販売注文ヘッダー (**小売とコマース \> 顧客 \> すべての販売注文**) にあります。 このプロパティが Commerce 販売注文に対して **はい** (既定値) に設定されている場合、注文はクレジット管理の保留ワークフローから除外されます。 ただし、このプロパティに **与信管理から除外** という名前が付いた場合でも、注文のフルフィルメントの際には定義された与信限度額が使用されます。 この注文は保留にはなりません。

ブロック ルールに基づいてCommerce 販売注文を保留にできる機能は、将来の Commerce リリースで計画されています。 これがサポートされるまで、Commerce 販売注文に新しいクレジット管理フローを強制的に実行する必要がある場合は、Visual Studio ソリューション内の次の XML ファイルをカスタマイズできます。 ファイルで、ロジックを変更して、**CredManExcludeSalesOrder** フラグが **いいえ** に設定されます。 これにより、既定で Commerce 販売注文の **Exclude from credit management** プロパティが **いいえ** に設定されます。

- RetailCreateCustomerOrderExtensions_CredMan_Extension.xml
- RetailCallCenterOrderExtensions_CredMan_Extension.xml

**CredManExcludeSalesOrder** フラグが **いいえ** に設定され、B2B 顧客が販売時点管理 (POS) アプリケーションを使用して店舗から購入できる場合は、現金売りトランザクションの転記が失敗する可能性があります。 たとえば、現金支払タイプに対するブロック ルールが設定され、B2B 顧客が店舗で一部の品目を現金で購入しました。 この場合、受注残の販売注文は保留にされ、正常に請求されません。 したがって、転記は正常におこなわれません。 このようなカスタマイズを実装した後は、最初から最後までテストすることをお勧めします。

## <a name="additional-resources"></a>追加リソース

[B2B eコマース サイトの設定](set-up-b2b-site.md)

[顧客階層を使用した B2B ビジネス パートナーの管理](partners-customer-hierarchies.md)

[B2B eコマース サイトでのビジネス パートナー ユーザーの管理](manage-b2b-users.md)

[B2B eコマース サイトの製品数量制限の設定](quantity-limits.md)

[SDK およびモジュール ライブラリの更新](../e-commerce-extensibility/sdk-updates.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
