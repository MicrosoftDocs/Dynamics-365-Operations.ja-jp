---
title: ウォレット支払のサポート
description: このトピックでは、Microsoft Dynamics 365 Commerce のウォレット支払のサポートの概要を説明します。
author: rubendel
ms.date: 05/18/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: IT Pro
ms.reviewer: josaw
ms.custom: 141393
ms.assetid: e23e944c-15de-459d-bcc5-ea03615ebf4c
ms.search.region: Global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2020-10-31
ms.dyn365.ops.version: AX 7.0.1
ms.openlocfilehash: 023c570669930a0b6c9336da47cb3081c61d099c
ms.sourcegitcommit: 273903b7b73ac726d447c50f7086e6d8b0f0f74e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/21/2021
ms.locfileid: "6087031"
---
# <a name="wallet-payment-support"></a><span data-ttu-id="ff808-103">Wallet 支払サポート</span><span class="sxs-lookup"><span data-stu-id="ff808-103">Wallet payment support</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="ff808-104">このトピックでは、Microsoft Dynamics 365 Commerce のウォレット支払のサポートの概要を説明します。</span><span class="sxs-lookup"><span data-stu-id="ff808-104">This topic provides an overview of wallet payment support for Microsoft Dynamics 365 Commerce.</span></span>  

## <a name="key-terms"></a><span data-ttu-id="ff808-105">重要な用語</span><span class="sxs-lookup"><span data-stu-id="ff808-105">Key terms</span></span>

| <span data-ttu-id="ff808-106">相談</span><span class="sxs-lookup"><span data-stu-id="ff808-106">Term</span></span> | <span data-ttu-id="ff808-107">説明</span><span class="sxs-lookup"><span data-stu-id="ff808-107">Description</span></span> |
|---|---|
| <span data-ttu-id="ff808-108">ウォレット</span><span class="sxs-lookup"><span data-stu-id="ff808-108">Wallet</span></span> | <span data-ttu-id="ff808-109">銀行 ID 番号 (BIN) 範囲や有効期限など、クレジット カード タイプとデビット カード タイプを区別するために使用される従来の支払特性を含まない支払タイプ。</span><span class="sxs-lookup"><span data-stu-id="ff808-109">A payment type that doesn't include traditional payment characteristics, such as the Bank Identification Number (BIN) range and expiration date, that are used to differentiate credit and debit card types.</span></span> |
| <span data-ttu-id="ff808-110">プロセッサ支払方法</span><span class="sxs-lookup"><span data-stu-id="ff808-110">Processor payment method</span></span> | <span data-ttu-id="ff808-111">支払 SDK のプロパティ支払カード プロパティ。</span><span class="sxs-lookup"><span data-stu-id="ff808-111">A property payment card property in the payments SDK.</span></span> <span data-ttu-id="ff808-112">このプロパティをコネクタ内のサポートされている支払方法に追加すると、従来の BIN 範囲マッピングを回避するために、Commerce 本社で設定されているカードまたはウォレットにこれらの支払方法をマップできます。</span><span class="sxs-lookup"><span data-stu-id="ff808-112">When this property is added to supported payment methods within a connector, those payment methods can be mapped to cards or wallets configured in Commerce headquarters to avoid the traditional BIN range mapping.</span></span> 
| <span data-ttu-id="ff808-113">支払サービス プロバイダー (PSP) 参照</span><span class="sxs-lookup"><span data-stu-id="ff808-113">Payment service provider (PSP) reference</span></span> | <span data-ttu-id="ff808-114">Adyen が支払トランザクションの識別に使用するキー。</span><span class="sxs-lookup"><span data-stu-id="ff808-114">The key that Adyen uses to identify payment transactions.</span></span> <span data-ttu-id="ff808-115">この機能により PSP 参照を有効にして、小売店舗トランザクションおよびコール センター認証の詳細ページに表示します。</span><span class="sxs-lookup"><span data-stu-id="ff808-115">This feature enables the PSP reference to be shown on the retail store transactions and call center authorization details pages.</span></span>

<span data-ttu-id="ff808-116">従来のクレジット カードやデビット カードとは異なり、ウォレット支払承認応答には BIN 範囲は含まれていません。</span><span class="sxs-lookup"><span data-stu-id="ff808-116">Unlike traditional credit and debit cards, wallet payment authorization responses don't include BIN ranges.</span></span> <span data-ttu-id="ff808-117">従来、BIN 範囲は、支払承認応答を BIN 範囲を持つ事前定義カード タイプに一致させるために使用されてきました。</span><span class="sxs-lookup"><span data-stu-id="ff808-117">Traditionally, BIN ranges have been used to match payment authorization responses to predefined card types that have BIN ranges.</span></span> <span data-ttu-id="ff808-118">このウォレット支払サポート機能は、プロセッサ支払方法のサポートを追加し、これらのバリアントを Commerce 本社で設定されたカード タイプにマッピングします。</span><span class="sxs-lookup"><span data-stu-id="ff808-118">The wallet payment support feature adds support for processor payment methods and mapping of those variants to card types that are set up in Commerce headquarters.</span></span>

<span data-ttu-id="ff808-119">**プロセッサ支払方法** は、特定の支払コネクタでサポートされている支払方法に適用できる支払 SDK のプロパティです。</span><span class="sxs-lookup"><span data-stu-id="ff808-119">**Processor payment method** is a property for the payments SDK that can be applied to payment methods supported for a particular payment connector.</span></span> <span data-ttu-id="ff808-120">プロセッサの支払方法を含む承認応答を受信すると、そのプロセッサ支払方法がカードまたはウォレットのタイプにマップされているかどうかを確認するルックアップが実行されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-120">When an authorization response is received that includes the processor payment method, a lookup is performed to determine if that processor payment method has been mapped to a card or wallet type.</span></span> <span data-ttu-id="ff808-121">マッピングが見つかった場合、その支払は一致するカードまたはウォレットタイプにマップされます。</span><span class="sxs-lookup"><span data-stu-id="ff808-121">If a mapping is found, that payment is mapped to the matching card or wallet type.</span></span> <span data-ttu-id="ff808-122">一致するものが見つからない場合は、Commerce の従来の BIN 範囲設定に従って BIN ルックアップが実行されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-122">If a match can't be found, a BIN lookup is performed following the traditional BIN range settings for Commerce.</span></span> 

<span data-ttu-id="ff808-123">ウォレット支払には BIN 範囲が含まれていないので、PayPal などの支払コネクタがウォレット支払をサポートしている場合は、支払コネクタを最新の支払 SDK に更新し、少なくともサポートされているすべてのウォレット支払いについて、プロセッサ支払方法のプロパティを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-123">Because wallet payments don't include BIN range, if a payment connector such as PayPal supports wallet payments, the payment connector should be updated to the latest payments SDK and the processor payment method property should be populated at least for all supported wallet payments.</span></span> 

<span data-ttu-id="ff808-124">プロセッサ支払方法のマッピングは、従来のデビットおよびクレジット カード支払にも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="ff808-124">Processor payment method mappings are also useful for traditional debit and credit card payments.</span></span> <span data-ttu-id="ff808-125">プロセッサの支払方法をカードにマッピングすることは、BIN 範囲マッピングよりも簡単で、コネクタでサポートされているすべての支払方法がカードまたはウォレット タイプにマップされるようにするのが簡単であるため、エラーが発生しにくくなります。</span><span class="sxs-lookup"><span data-stu-id="ff808-125">Mapping processor payment methods to cards is more straightforward than BIN range mapping and less prone to errors because it is easy to ensure all possible payment methods supported by a connector are mapped to a card or wallet type.</span></span> 

## <a name="enable-wallet-payment-support"></a><span data-ttu-id="ff808-126">ウォレット支払サポートの有効化</span><span class="sxs-lookup"><span data-stu-id="ff808-126">Enable wallet payment support</span></span>

<span data-ttu-id="ff808-127">Commerce 本店でウォレット支払サポートを有効にするには、**ワークスペース \> 機能管理** に移動し、**拡張ウォレット サポートと支払の改善** 機能を検索します。</span><span class="sxs-lookup"><span data-stu-id="ff808-127">To enable wallet payment support in Commerce headquarters, go to **Workspaces \> Feature management**, and then search for the **Enhanced wallet support and payment improvements** feature.</span></span> <span data-ttu-id="ff808-128">機能を選択し、**有効にする** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ff808-128">Select the feature, and then select **Enable**.</span></span> <span data-ttu-id="ff808-129">機能を有効にした後 **1110** 配送スケジュールを実行して、すべてのチャンネルで使用可能にします。</span><span class="sxs-lookup"><span data-stu-id="ff808-129">After you enable the feature, run the **1110** distribution schedule to make it available in all channels.</span></span>

## <a name="other-payment-enhancements-that-are-enabled-by-the-wallet-payment-support-feature"></a><span data-ttu-id="ff808-130">ウォレット支払サポート機能によって有効になるその他の支払の機能強化 </span><span class="sxs-lookup"><span data-stu-id="ff808-130">Other payment enhancements that are enabled by the wallet payment support feature</span></span>

<span data-ttu-id="ff808-131">ウォレット支払サポートを有効にすることに加えて、ウォレット支払サポート機能を使用すると、Adyen 向け Dynamics 365 Payment Connector を使用して作成された支払のために Commerce 本社で使用できる支払詳細が強化されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-131">In addition to enabling wallet payment support, the wallet payment support feature enhances the payment details that are available in Commerce headquarters for payments that are created by using the Dynamics 365 Payment Connector for Adyen.</span></span> 

<span data-ttu-id="ff808-132">コール センターでは、ウォレット支払サポート機能により、既定のビューに対して支払詳細承認用に 2 つのフィールドが追加されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-132">In the call center, the wallet payment support feature adds two fields to the default view for payment authorization details.</span></span> <span data-ttu-id="ff808-133">最初に、既存の **プロセッサの参照** 列に、Adyen によって提供される PSP 参照が入力されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-133">First, the existing **Processor reference** column is filled with the PSP reference that is provided by Adyen.</span></span> <span data-ttu-id="ff808-134">PSP 参照は、Adyen が支払を検索するために使用するキーです。</span><span class="sxs-lookup"><span data-stu-id="ff808-134">The PSP reference is the key that Adyen uses to look up payments.</span></span> <span data-ttu-id="ff808-135">2つ目として、既存の **承認コード** 列に、Adyen からの承認で提供された承認コード値が入力されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-135">Second, the existing **Approval code** column is filled with the approval code value that is provided in the authorization from Adyen.</span></span> 

<span data-ttu-id="ff808-136">小売用店舗トランザクションでは、Adyen コネクタを使用して作成された支払に対する支払トランザクション ビューに、追加の機能拡張が追加されています。</span><span class="sxs-lookup"><span data-stu-id="ff808-136">For retail store transactions, additional enhancements have been added to the payment transactions view for payments that are created by using the Adyen connector.</span></span> <span data-ttu-id="ff808-137">**承認コード** フィールドにはプロセッサからの承認コードが、**プロセッサ支払方法** フィールドにはプロセッサの支払方法が、**プロセッサの参照** フィールドには Adyen からの PSP 参照がそれぞれ表示されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-137">The **Approval code** field shows the approval code from the processor, the **Processor payment** field shows the processor payment method, and the **Processor reference** field shows the PSP reference from Adyen.</span></span> <span data-ttu-id="ff808-138">これら 3 つのフィールドは、データベース内の個別のフィールドではありません。</span><span class="sxs-lookup"><span data-stu-id="ff808-138">These three fields aren't discrete fields in the database.</span></span> <span data-ttu-id="ff808-139">これらは、特定の支払が表示されている場合にのみユーザー インターフェイスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-139">They will be shown in the user interface only when a specific payment is viewed.</span></span> <span data-ttu-id="ff808-140">フィールドを表示する前に、販売時点管理 (POS) クライアントを Commerce バージョン 10.0.20 以降で更新する必要があり、また **拡張ウォレット サポートおよび支払改善** 機能の **有効な** ステータスをチャネルに同期する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-140">Before the fields can be shown, the point of sale (POS) client must be updated with Commerce version 10.0.20 or later, and the **Enabled** status for the **Enhanced wallet support and payment improvements** feature must be synchronized to the channel.</span></span> 

## <a name="wallet-payment-method-support-and-processor-payment-methods"></a><span data-ttu-id="ff808-141">ウォレット支払方法のサポートとプロセッサ支払方法</span><span class="sxs-lookup"><span data-stu-id="ff808-141">Wallet payment method support and processor payment methods</span></span>

<span data-ttu-id="ff808-142">この機能は、**ウォレット** と呼ばれる新しい支払方法とカード タイプをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="ff808-142">This feature supports a new payment method and card type called **Wallet**.</span></span> <span data-ttu-id="ff808-143">ウォレット支払の主な特徴は BIN の範囲を持たないということです。</span><span class="sxs-lookup"><span data-stu-id="ff808-143">The primary characteristic of a wallet payment is that it does not have a BIN range.</span></span> <span data-ttu-id="ff808-144">ただし、ウォレット支払方法では、有効期限や従来必須と考えられていた一部のプロパティが返されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-144">However, wallet payment methods may not return expiration dates and some properties that have traditionally been considered mandatory.</span></span> <span data-ttu-id="ff808-145">ウォレット支払方法は、従来の BIN 範囲マッピングの代替として、プロセッサ支払方法にマップする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-145">Wallet payment methods must be mapped to processor payment methods as an alternative to the traditional BIN range mapping.</span></span> 

### <a name="adding-support-of-processor-payment-methods"></a><span data-ttu-id="ff808-146">プロセッサ支払方法のサポートの追加</span><span class="sxs-lookup"><span data-stu-id="ff808-146">Adding support of processor payment methods</span></span>

<span data-ttu-id="ff808-147">プロセッサ支払方法をサポートするには、支払コネクタは **PaymentCardProperties** で **aymentMethodVariant** プロパティを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-147">To support processor payment methods, payment connectors need to populate the **PaymentMethodVariant** property in **PaymentCardProperties**.</span></span> <span data-ttu-id="ff808-148">使用している支払 SDK にこのプロパティが含まれていない場合は、更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-148">If the payments SDK in use does not include this property, it should be updated.</span></span> 

### <a name="processor-payment-method-mapping"></a><span data-ttu-id="ff808-149">プロセッサ支払方法のマッピング</span><span class="sxs-lookup"><span data-stu-id="ff808-149">Processor payment method mapping</span></span>

<span data-ttu-id="ff808-150">**プロセッサ支払方法のマッピング** ページを使用して、設定済みのカードまたはウォレットのタイプにプロセッサ支払方法をマップできます。</span><span class="sxs-lookup"><span data-stu-id="ff808-150">The **Processor payment method mapping** page can be used to map processor payment methods to configured card or wallet types.</span></span> <span data-ttu-id="ff808-151">このページにアクセスするには、**カード タイプ** ページの **プロセッサ マッピング** リンクを選択します。</span><span class="sxs-lookup"><span data-stu-id="ff808-151">To access this page, select the **Processor mapping** link on the **Card types** page.</span></span>

![プロセッサ支払のマッピング リンク](media/Payments/ProcPmtMap.png)

<span data-ttu-id="ff808-153">このページが開くと、使用可能な支払コネクタにクエリを実行して、**PaymentMethodVariant** フィールドに入力された一連の設定済みの支払方法を収集します。</span><span class="sxs-lookup"><span data-stu-id="ff808-153">When this page opens, it queries available payment connectors to collect a set or payment methods with the **PaymentMethodVariant** field populated.</span></span> <span data-ttu-id="ff808-154">次に、これらの支払方法にカードまたはウォレットへの既存のマッピングがあるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="ff808-154">It then checks to determine if those payment methods have an existing mapping to a card or wallet.</span></span> <span data-ttu-id="ff808-155">マッピングを持たない支払方法は、ページの中央列に一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-155">Payment methods that do not have a mapping are listed in the center column of the page.</span></span> 

![マップされていないプロセッサ支払方法](media/Payments/Unmapped.png)

<span data-ttu-id="ff808-157">プロセッサの支払方法をカードまたはウォレットにマップするには、カードまたはウォレットを選択し、プロセッサ支払方法を選択して、**追加** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ff808-157">To map a processor payment method to a card or wallet, select the card or wallet, select the processor payment method, and then select **Add**.</span></span> <span data-ttu-id="ff808-158">プロセッサ支払方法が **マップ済み** 列に移動します。</span><span class="sxs-lookup"><span data-stu-id="ff808-158">The processor payment method moves to the **Mapped** column.</span></span> <span data-ttu-id="ff808-159">一致する支払承認を受け取ると、選択したカードまたはウォレットにマッピングされます。</span><span class="sxs-lookup"><span data-stu-id="ff808-159">When a matching payment authorization is received, it will be mapped to the chosen card or wallet.</span></span>

![マップ済みのプロセッサ支払方法](media/Payments/Mapped.png)

> [!NOTE]
> <span data-ttu-id="ff808-161">**プロセッサの支払方法のマッピング** 機能により、チャネル データベースに同期する必要がある新しいテーブルを追加します。</span><span class="sxs-lookup"><span data-stu-id="ff808-161">The **Processor payment method mapping** capability adds a new table that must be synchronized to the channel database.</span></span> <span data-ttu-id="ff808-162">このデータを Commerce スケジューラに追加するには、Commerceスケジューラを初期化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-162">To add this data to the Commerce scheduler, you need to initialize the Commerce scheduler.</span></span> <span data-ttu-id="ff808-163">詳細については、[commerce スケジューラのコンフィギュレーションの更新](./dev-itpro/cdx-best-practices.md#updating-configurations) に関連するドキュメントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ff808-163">For details, please refer to documentation related to [updating commerce scheduler configurations](./dev-itpro/cdx-best-practices.md#updating-configurations).</span></span> 

### <a name="when-not-to-use-processor-payment-method-mapping"></a><span data-ttu-id="ff808-164">プロセッサ支払方法のマッピングを使用しない場合</span><span class="sxs-lookup"><span data-stu-id="ff808-164">When not to use processor payment method mapping</span></span>

<span data-ttu-id="ff808-165">場合によっては、プロセッサ支払方法のマッピングがレポートのニーズに対して十分に細かくならない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-165">In certain cases, processor payment method mapping may not be granular enough for reporting needs.</span></span> <span data-ttu-id="ff808-166">たとえば、一部の小売業者は、同じプロバイダーからの外部ギフト カードを BIN 範囲で区別します。</span><span class="sxs-lookup"><span data-stu-id="ff808-166">For example, some retailers differentiate external gift cards from the same provider by their BIN range.</span></span> <span data-ttu-id="ff808-167">このシナリオでは、ギフト カードは、上記のシナリオを使用してマップされません。</span><span class="sxs-lookup"><span data-stu-id="ff808-167">In this scenario, the gift cards should not be mapped using the above scenario.</span></span> <span data-ttu-id="ff808-168">代わりに、従来の BIN 範囲マッピングを引き続き使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-168">Instead, they should continue to use traditional BIN range mapping.</span></span> 

## <a name="support-for-unidentified-card-types"></a><span data-ttu-id="ff808-169">識別されないカード タイプのサポート</span><span class="sxs-lookup"><span data-stu-id="ff808-169">Support for unidentified card types</span></span>

<span data-ttu-id="ff808-170">一部のシナリオでは、支払コネクタは、BIN 範囲またはプロセッサ支払方法のマッピングを持たないカードを返す場合があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-170">In some scenarios, a payment connector may return a card that does not have a BIN range or processor payment method mapping.</span></span> <span data-ttu-id="ff808-171">この場合、支払は支払ターミナルによって承認されますが、販売時点管理 (POS) が承認応答を特定のカード タイプにマップできない場合は、支払が取り消されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-171">If this occurs, the payment is authorized by the payment terminal, but is then reversed when the point of sale (POS) can't map the authorization response to a specific card type.</span></span> <span data-ttu-id="ff808-172">これに対処するために、不明の承認応答を既定のカード タイプにマップする機能が提供されます。</span><span class="sxs-lookup"><span data-stu-id="ff808-172">To address this, a capability is provided to map unknown authorization responses to a default card type.</span></span> 

![マップされていないカードの既定](media/Payments/DefaultUnmapped.png)

<span data-ttu-id="ff808-174">この機能により、支払がターミナルによって承認されず、POS によって取り消されるようになります。</span><span class="sxs-lookup"><span data-stu-id="ff808-174">This capability ensures that the payment is never authorized by the terminal and then reversed by the POS.</span></span> <span data-ttu-id="ff808-175">これにより、顧客や店舗の関係者の混乱を避けることができます。</span><span class="sxs-lookup"><span data-stu-id="ff808-175">This helps avoid confusion for customers and store associates.</span></span> <span data-ttu-id="ff808-176">この設定を使用する場合、不明な認証の既定のカードを定期的にチェックして、必要なカード タイプが誤って不明なカード タイプのデフォルトにマップされていないことを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-176">When this setting is used, the default card for unknown authorizations should be checked periodically to ensure that wanted card types are not accidentally being mapped to the default for unknown card types.</span></span> <span data-ttu-id="ff808-177">カード タイプが処理に本当に不要な場合は、プロセッサ レベルでオフにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ff808-177">If a card type is truly unwanted for processing, it should be turned off at the processor level.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ff808-178">追加リソース</span><span class="sxs-lookup"><span data-stu-id="ff808-178">Additional resources</span></span>

- [<span data-ttu-id="ff808-179">支払に関するよく寄せられる質問</span><span class="sxs-lookup"><span data-stu-id="ff808-179">Payments FAQ</span></span>](dev-itpro/payments-retail.md)
- [<span data-ttu-id="ff808-180">PayPal 向け Dynamics 365 Payment Connector</span><span class="sxs-lookup"><span data-stu-id="ff808-180">Dynamics 365 Payment Connector for PayPal</span></span>](paypal.md)
- [<span data-ttu-id="ff808-181">Adyen 向け Dynamics 365 Payment Connector</span><span class="sxs-lookup"><span data-stu-id="ff808-181">Dynamics 365 Payment Connector for Adyen</span></span>](dev-itpro/adyen-connector.md?tabs=8-1-3)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
