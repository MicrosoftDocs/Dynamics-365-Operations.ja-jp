---
title: ウォレット支払のサポート
description: このトピックでは、Microsoft Dynamics 365 Commerce のウォレット支払のサポートの概要を説明します。
author: BrianShook
ms.date: 03/11/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: IT Pro
ms.reviewer: josaw
ms.custom: 141393
ms.assetid: e23e944c-15de-459d-bcc5-ea03615ebf4c
ms.search.region: Global
ms.search.industry: Retail
ms.author: brshoo
ms.search.validFrom: 2020-10-31
ms.dyn365.ops.version: AX 7.0.1
ms.openlocfilehash: 1787f370e54a9cb7560bbbaab565f9b75d8eba25
ms.sourcegitcommit: 6dc2b877cf8ea9185a07964ec05c5ddb7a78471b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/12/2022
ms.locfileid: "8407883"
---
# <a name="wallet-payment-support"></a>Wallet 支払サポート

[!include [banner](../includes/banner.md)]

このトピックでは、Microsoft Dynamics 365 Commerce のウォレット支払のサポートの概要を説明します。  

## <a name="key-terms"></a>重要な用語

| 相談 | 説明 |
|---|---|
| ウォレット | 銀行 ID 番号 (BIN) 範囲や有効期限など、クレジット カード タイプとデビット カード タイプを区別するために使用される従来の支払特性を含まない支払タイプ。 |
| プロセッサ支払方法 | 支払 SDK のプロパティ支払カード プロパティ。 このプロパティをコネクタ内のサポートされている支払方法に追加すると、従来の BIN 範囲マッピングを回避するために、Commerce 本社で設定されているカードまたはウォレットにこれらの支払方法をマップできます。 
| 支払サービス プロバイダー (PSP) 参照 | Adyen が支払トランザクションの識別に使用するキー。 この機能により PSP 参照を有効にして、小売店舗トランザクションおよびコール センター認証の詳細ページに表示します。

従来のクレジット カードやデビット カードとは異なり、ウォレット支払承認応答には BIN 範囲は含まれていません。 従来、BIN 範囲は、支払承認応答を BIN 範囲を持つ事前定義カード タイプに一致させるために使用されてきました。 このウォレット支払サポート機能は、プロセッサ支払方法のサポートを追加し、これらのバリアントを Commerce 本社で設定されたカード タイプにマッピングします。

**プロセッサ支払方法** は、特定の支払コネクタでサポートされている支払方法に適用できる支払 SDK のプロパティです。 プロセッサの支払方法を含む承認応答を受信すると、そのプロセッサ支払方法がカードまたはウォレットのタイプにマップされているかどうかを確認するルックアップが実行されます。 マッピングが見つかった場合、その支払は一致するカードまたはウォレットタイプにマップされます。 一致するものが見つからない場合は、Commerce の従来の BIN 範囲設定に従って BIN ルックアップが実行されます。 

ウォレット支払には BIN 範囲が含まれていないので、PayPal などの支払コネクタがウォレット支払をサポートしている場合は、支払コネクタを最新の支払 SDK に更新し、少なくともサポートされているすべてのウォレット支払いについて、プロセッサ支払方法のプロパティを設定する必要があります。 

プロセッサ支払方法のマッピングは、従来のデビットおよびクレジット カード支払にも役立ちます。 プロセッサの支払方法をカードにマッピングすることは、BIN 範囲マッピングよりも簡単で、コネクタでサポートされているすべての支払方法がカードまたはウォレット タイプにマップされるようにするのが簡単であるため、エラーが発生しにくくなります。 

## <a name="enable-wallet-payment-support"></a>ウォレット支払サポートの有効化

Commerce 本店でウォレット支払サポートを有効にするには、**ワークスペース \> 機能管理** に移動し、**拡張ウォレット サポートと支払の改善** 機能を検索します。 機能を選択し、**有効にする** を選択します。 機能を有効にした後 **1110** 配送スケジュールを実行して、すべてのチャンネルで使用可能にします。

## <a name="other-payment-enhancements-that-are-enabled-by-the-wallet-payment-support-feature"></a>ウォレット支払サポート機能によって有効になるその他の支払の機能強化 

ウォレット支払サポートを有効にすることに加えて、ウォレット支払サポート機能を使用すると、Adyen 向け Dynamics 365 Payment Connector を使用して作成された支払のために Commerce 本社で使用できる支払詳細が強化されます。 

コール センターでは、ウォレット支払サポート機能により、既定のビューに対して支払詳細承認用に 2 つのフィールドが追加されます。 最初に、既存の **プロセッサの参照** 列に、Adyen によって提供される PSP 参照が入力されます。 PSP 参照は、Adyen が支払を検索するために使用するキーです。 2つ目として、既存の **承認コード** 列に、Adyen からの承認で提供された承認コード値が入力されます。 

小売店舗トランザクションでは、Adyen コネクタを使用して作成された支払に対する支払トランザクション ビューに、追加の機能拡張が追加されています。 **承認コード** フィールドにはプロセッサからの承認コードが、**プロセッサ支払方法** フィールドにはプロセッサの支払方法が、**プロセッサの参照** フィールドには Adyen からの PSP 参照がそれぞれ表示されます。 これら 3 つのフィールドは、データベース内の個別のフィールドではなく、特定の支払が表示される場合にのみユーザー インターフェイスに表示されます。 PayPal 向け Dynamics 365 Payment Connector を使用して処理された支払は、**承認コード**、**プロセッサの支払**、および **プロセッサの参照** フィールドの値も提供します。 フィールドを表示する前に、販売時点管理 (POS) クライアントを Commerce バージョン 10.0.20 以降で更新する必要があり、また **拡張ウォレット サポートおよび支払改善** 機能の **有効な** ステータスをチャネルに同期する必要があります。

> [!NOTE]
> PayPal 向け Dynamics 365 Payment Connector は、PayPal [API](https://developer.paypal.com/api/payments/v2/#authorizations_void) の制限により、支払無効化要求の 3 つのフィールド値 (**承認コード**、**プロセッサの支払**、**プロセッサの参照**) を提供しません。 ユーザー インターフェイスでは、3 つのフィールドが空白になります。 

## <a name="wallet-payment-method-support-and-processor-payment-methods"></a>ウォレット支払方法のサポートとプロセッサ支払方法

この機能は、**ウォレット** と呼ばれる新しい支払方法とカード タイプをサポートしています。 ウォレット支払の主な特徴は BIN の範囲を持たないということです。 ただし、ウォレット支払方法では、有効期限や従来必須と考えられていた一部のプロパティが返されない場合があります。 ウォレット支払方法は、従来の BIN 範囲マッピングの代替として、プロセッサ支払方法にマップする必要があります。 

### <a name="adding-support-of-processor-payment-methods"></a>プロセッサ支払方法のサポートの追加

プロセッサ支払方法をサポートするには、支払コネクタは **PaymentCardProperties** で **aymentMethodVariant** プロパティを設定する必要があります。 使用している支払 SDK にこのプロパティが含まれていない場合は、更新する必要があります。 

### <a name="processor-payment-method-mapping"></a>プロセッサ支払方法のマッピング

**プロセッサ支払方法のマッピング** ページを使用して、設定済みのカードまたはウォレットのタイプにプロセッサ支払方法をマップできます。 このページにアクセスするには、**カード タイプ** ページの **プロセッサ マッピング** リンクを選択します。

![プロセッサ支払のマッピング リンク。](media/Payments/ProcPmtMap.png)

このページが開くと、使用可能な支払コネクタにクエリを実行して、**PaymentMethodVariant** フィールドに入力された一連の設定済みの支払方法を収集します。 次に、これらの支払方法にカードまたはウォレットへの既存のマッピングがあるかどうかを確認します。 マッピングを持たない支払方法は、ページの中央列に一覧表示されます。 

![マップされていないプロセッサ支払方法。](media/Payments/Unmapped.png)

プロセッサの支払方法をカードまたはウォレットにマップするには、カードまたはウォレットを選択し、プロセッサ支払方法を選択して、**追加** を選択します。 プロセッサ支払方法が **マップ済み** 列に移動します。 一致する支払承認を受け取ると、選択したカードまたはウォレットにマッピングされます。

![マップ済みのプロセッサ支払方法。](media/Payments/Mapped.png)

> [!NOTE]
> **プロセッサの支払方法のマッピング** 機能により、チャネル データベースに同期する必要がある新しいテーブルを追加します。 このデータを Commerce スケジューラに追加するには、Commerceスケジューラを初期化する必要があります。 詳細については、[commerce スケジューラのコンフィギュレーションの更新](./dev-itpro/cdx-best-practices.md#update-configurations) に関連するドキュメントを参照してください。 

### <a name="when-not-to-use-processor-payment-method-mapping"></a>プロセッサ支払方法のマッピングを使用しない場合

場合によっては、プロセッサ支払方法のマッピングがレポートのニーズに対して十分に細かくならない可能性があります。 たとえば、一部の小売業者は、同じプロバイダーからの外部ギフト カードを BIN 範囲で区別します。 このシナリオでは、ギフト カードは、上記のシナリオを使用してマップされません。 代わりに、従来の BIN 範囲マッピングを引き続き使用する必要があります。 

## <a name="support-for-unidentified-card-types"></a>識別されないカード タイプのサポート

一部のシナリオでは、支払コネクタは、BIN 範囲またはプロセッサ支払方法のマッピングを持たないカードを返す場合があります。 この場合、支払は支払ターミナルによって承認されますが、販売時点管理 (POS) が承認応答を特定のカード タイプにマップできない場合は、支払が取り消されます。 これに対処するために、不明の承認応答を既定のカード タイプにマップする機能が提供されます。 

![マップされていないカードの既定。](media/Payments/DefaultUnmapped.png)

この機能により、支払がターミナルによって承認されず、POS によって取り消されるようになります。 これにより、顧客や店舗の関係者の混乱を避けることができます。 この設定を使用する場合、不明な認証の既定のカードを定期的にチェックして、必要なカード タイプが誤って不明なカード タイプのデフォルトにマップされていないことを確認する必要があります。 カード タイプが処理に本当に不要な場合は、プロセッサ レベルでオフにする必要があります。

## <a name="additional-resources"></a>追加リソース

- [支払に関するよく寄せられる質問](dev-itpro/payments-retail.md)
- [PayPal 向け Dynamics 365 Payment Connector](paypal.md)
- [Adyen 向け Dynamics 365 Payment Connector](dev-itpro/adyen-connector.md?tabs=8-1-3)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
