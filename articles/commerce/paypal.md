---
title: PayPal 向け Dynamics 365 Payment Connector
description: この記事では、PayPal 向け Microsoft Dynamics 365 Payment Connector の概要について説明します。
author: BrianShook
ms.date: 09/02/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: IT Pro
ms.reviewer: josaw
ms.custom: 141393
ms.assetid: e23e944c-15de-459d-bcc5-ea03615ebf4c
ms.search.region: Global
ms.search.industry: Retail
ms.author: brshoo
ms.search.validFrom: 2020-10-31
ms.dyn365.ops.version: AX 7.0.1
ms.openlocfilehash: 36349a57004fc30a0773544b095929902ea74e25
ms.sourcegitcommit: 1d5cebea3e05b6d758cd01225ae7f566e05698d2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/02/2022
ms.locfileid: "9405336"
---
# <a name="dynamics-365-payment-connector-for-paypal"></a>PayPal 向け Dynamics 365 Payment Connector

[!include [banner](../includes/banner.md)]

この記事では、PayPal 向け Microsoft Dynamics 365 Payment Connector (PayPal 支払いコネクタ) の概要について説明します。 これには、サポートされているフィーチャおよび機能、コネクタの設定および構成のガイド、トラブルシューティング情報、および一般的な一部の問題に関する説明の一覧が含まれています。

## <a name="key-terms"></a>重要な用語

| 相談 | 説明 |
|---|---|
| PayPal ウォレット | PayPal 「ボタン」として知られる PayPal ウォレットは、PayPal 支払いコネクタでサポートされる顧客エクスペリエンスと統合について説明します。 |
| ウォレット | BIN 範囲や有効期限など、クレジット カード タイプとデビット カード タイプを区別するために使用される従来の支払特性を含まない支払タイプ。 |

Microsoft Dynamics 365 Commerce は、PayPal ウォレットとの統合を最初から用意しています。 PayPal 支払いコネクタが構成されている場合、PayPal ボタンは、オンライン注文のチェックアウトの一部として選択可能な支払の算出方法になります。 ユーザーが **PayPal** を選択すると、PayPal で直接支払を完了するように指示され、注文完了のためにオンライン ストアフロントに戻ります。  

PayPal 支払いコネクタは、クレジット カード決済で活用されているのと同じ支払 SDK を使用して実装されます。 PayPal による支払のサポートを向上させるために、「ウォレット」支払タイプのサポートが追加され、クレジット カード以外の支払のサポートも強化されました。 具体的には、PayPal による支払は BIN 範囲を返しません。 PayPal および他のウォレットの支払をサポートするために、BIN 範囲を含まない支払のための新しいマッピングが導入されました。 この新しいマッピングは、クレジット カード決済の方法に対する既存の BIN 範囲マッピングを拡張するために使用することもできます。 詳細については、[ウォレット支払のサポート](wallets.md) を参照してください。 

PayPal 支払いコネクタは中国では使用できません。 Dynamics 365 Commerce が利用可能な他のロケールについては、現在のところ制限はありません。 

## <a name="functional-overview"></a>機能の概要

### <a name="paypal-wallet-in-storefront"></a>店舗での PayPal ウォレット 

PayPal 支払いコネクタは、電子商取引の支払のために PayPal ウォレットまたは PayPal ボタンの使用をサポートしています。 PayPal 支払いコネクタがオンライン店舗用に構成されている場合、顧客は支払時に PayPal ボタンを使用して支払を行うオプションが表示されます。 顧客が PayPal ボタンを選択すると、PayPal によって認証され、支払方法を選択できる、PayPal ウォレットの小さなブラウザー ウィンドウにリダイレクトされます。 認証と支払方法の選択に成功すると、顧客は、PayPal 支払がチェックアウト フォームに読み込まれた店舗にリダイレクトされます。 注文が行われると、PayPal 支払は注文の支払明細行として含められ、Commerce headquarters によって同期されます。

PayPal ウォレットの詳細については、PayPal がホストする [PayPal チェックアウト ページ](https://www.paypal.com/merchantapps/appcenter/acceptpayments/checkout) を参照してください。 

### <a name="fulfillment"></a>フルフィルメント

PayPal 支払明細行を含む注文は、クレジット カードを使用して支払が行われる注文と同じ方法で実行されます。 注文が作成されると、PayPal の支払は「承認済み」状態に追加されます。 フルフィルメント時に、注文が物流センターから顧客に出荷されるか、または店舗でピッキングされたかにかかわらず、注文に関連付けられた支払承認は、クレジット カード決済の取得に使用されるのと同じ支払 SDK 要求を使用して「取得」されます。 

PayPal による注文のフルフィルメントは、増分取得をサポートします。 つまり、注文が部分的にフルフィルメントされて請求された場合、残りの注文のために新しい承認を取得するのではなく元の承認の一部が取得されることになり、残りの注文がフルフィルメントされるときは元の同じ承認が参照されます。 

### <a name="authorization-expiration"></a>認証の有効期限

PayPal 決済コネクタを使用して行われた注文は、30 日以内にフルフィルメントする必要があります。 注文が 30 日以内にフルフィルメントまたは請求できない場合、元の認証は期限切れになります。 現在、PayPal 支払いコネクタは請求契約をサポートしていません。 定期請求の契約の場合、定期的なカード参照/トークンと同様に、元の承認が期限切れになった後、自動的に新しい承認を生成する必要があります。 つまり、承認が期限切れになった場合、注文は「処理しない」状態になり、顧客に連絡して代替の支払方法を用意してもらう必要があります。 

### <a name="order-intent"></a>受注の意図

Commerce バージョン 10.0.30 以降、本部の PayPal 支払いコネクタ設定には **OrderIntent** フィールドが含まれ、オンラインチャネル用の PayPal サービスで保存した注文で動作するように構成することができます。 支払人が注文を承認した後、PayPal 決済コネクタは PayPal 注文を保存するコマンドを送信し、PayPal 内の注文に対して参照できるようになります。 Commerce では、以前に void が呼び出された場合、特定の PayPal 注文の参照が再認証されることを意味します。 また、PayPal と連携して注文の有効期限を設定したり、元の認証が有効期限内であれば PayPal 注文に対して再認証を行う機能をカスタマイズすることも可能です。

Commerce headquarters で PayPal 支払いコネクタを設定する場合、**OrderIntent** フィールドは 2 つの値を持つことができます。

- **認証**: この設定値は既定の値です。 このフィールドを空白にすると、**Authorize** が既定の値になります。 **OrderIntent** フィールドを **Authorize** 値で構成することは、PayPal 処理指示値 **NO_INSTRUCTION** に相関します。 この値を使用すると、注文は PayPal で承認され、承認を変更することはできません。
- **保存**: **OrderIntent** フィールドを **Save** 値で構成することは、PayPal 処理指示値 **ORDER_SAVED_EXPLICITLY** に相関します。 この値を使用すると、注文参照は PayPal サービスに保存されます。

## <a name="test-the-paypal-payment-connector"></a>PayPal 決済コネクタのテスト

### <a name="create-a-paypal-developer-account"></a>PayPal 開発者アカウントの作成

PayPal 決済コネクタをテストするには、まず PayPal の開発者資格情報と PayPal サンドボックス環境を作成する必要があります。 

1. PayPal の開発リソースの一部として提供される [テストと Go-Live ](https://developer.paypal.com/docs/business/test-and-go-live/) に移動します。 
2. **テストと Go-Live** ページの [開始](https://developer.paypal.com/docs/platforms/get-started/) を選択します。 
3. そのページで、**開発者のダッシュボードにログイン** を選択します。
4. サインインを求められた場合、**サインアップ** を選択します。
5. **ビジネス アカウント** を選択し、**次へ** を選択 します。
6. PayPal アカウントに関連付ける電子メール アドレスを入力し、PayPal アカウントのパスワードを作成します。 
7. 次のページで、連絡先情報の詳細を入力し、PayPal のユーザー契約とプライバシーに関する声明を読みます。 使用条件に同意する場合は、**同意してアカウントを作成** を選択します。  

    > [!NOTE]
    > PayPal 開発者アカウントの作成で合意した契約条件は、アカウントを作成した組織または個人と PayPal との間のものです。 Microsoft はいかなる責任も追わず、契約で示される契約条件についていかなる保証も行いません。 これらの指示は、情報提供のみを目的としています。 

8. 契約条件に同意した後、ビジネス タイプを指定し、**続行** を選択します。
9. 次に、[PayPal 開発者のページ](https://developer.paypal.com/developer/applications) に移動し、**ダッシュボードにログイン** を選択します。
10. PayPal アカウントの作成時に使用した資格情報を使用してサインインします。
11. 開発者のダッシュボードで、RestAPI アプリの一覧で **既定のアプリケーション** を選択します。
12. ご利用のサンドボックス アカウントの **クライアント ID** と **シークレット** に注意してください。 これらは、Dynamics 365 Commerce で PayPal 決済コネクタを設定するために使用されます。

    > [!NOTE]
    > ライブ環境の **クライアント ID** と **シークレット** を収集するには、選択した RestAPI アプリの **ライブ** タブを選択します。

## <a name="set-up-the-paypal-payment-connector-in-dynamics-365-commerce"></a>Dynamics 365 Commerce に PayPal 決済コネクタを設定する

### <a name="map-the-paypal-wallet-payment-method-to-a-processor-payment-method"></a>PayPal ウォレットの支払方法をプロセッサ支払方法にマップする

> [!NOTE]
> これらの手順の一部は、ウォレットの支払方法をサポートするために新しい機能を活用しています。 この機能の詳細については、[ウォレット支払のサポート](wallets.md) を参照してください。

1. **Retail と Commerce \> チャネル設定 \> 支払方法 \> 支払い方法** に移動します。
2. **新規** を選択します。
3. **支払方法 ID** および **ウォレット** などの **支払方法名** を指定します。 **既定の機能** を **ウォレット** に設定し、**保存** を選択します。
4. **Retail と Commerce \> チャネル設定 \> 支払方法\> カード タイプ** に移動します。
5. **新規** を選択します。
6. **PayPal** などの **ID** を指定します。 **PayPal** などの **電子支払名** を設定します。 **種類** に **ウォレット** を設定し、**発行者** に **PayPal** などの名前を指定します。 **保存** を選択します。
7. 以前に作成したエントリを選択し、**プロセッサ マッピング** を選択します。
8. **プロセッサ支払方法のマッピング** ページで、以前に作成した **PayPal** のカード タイプを選択します。 中央の列で、**PayPal 向け Dynamics 365 Payment Connector** を選択し、**追加** を選択します。 

> [!NOTE]
> **プロセッサの支払方法のマッピング** 機能により、チャネル データベースに同期する必要がある新しいテーブルを追加します。 このデータを Commerce スケジューラに追加するには、Commerceスケジューラを初期化する必要があります。 詳細については、[commerce スケジューラのコンフィギュレーションの更新](./dev-itpro/cdx-best-practices.md#update-configurations) に関連するドキュメントを参照してください。 

### <a name="set-up-the-paypal-payment-connector-in-payment-services"></a>決済サービスに PayPal 決済コネクタを設定する

次の手順に従って、**支払サービス** で PayPal 決済コネクタを構成します。

1. Commerce 本社で、**売掛\> 支払設定\> 支払サービス** の順に移動します。
2. アクション ウィンドウで、**新規** を選択してから、**設定** タブで以下の情報を入力します。

    | フィールド | 説明 | サンプル値 |
    |---|---|---|
    | 支払サービス | 構成する支払サービスの名前を入力します。 | PayPal |
    | 決済コネクタ | PayPal 決済コネクタを選択します。 | PayPal 向け Dynamics 365 Payment Connector |
    | テスト モード | PayPal 決済コネクタの場合、運用環境およびテスト環境では、このフィールドを **False** に設定する必要があります。 | False |
    | クレジット カードの既定のプロセッサ | コール センターでは既定のプロセッサが使用されるため、この値は **No** に設定する必要があります。 | なし |
    | ゼロ トランザクションの支払プロセッサをバイパスする | この支払プロセッサが 0 (ゼロ) の量の取引でスキップする必要があるかを指定します。 | 有 |

3. **支払サービス アカウント** タブで、以下の情報を入力します。

    | フィールド | 説明 | 必須 | 自動セット | サンプル値 |
    |---|---|:-:|:-:|---|
    | アセンブリ名 | PayPal 決済コネクタのアセンブリの自動入力された名前。 | 有効 | 有効 | *バイナリ名* |
    | サービス アカウント ID | 商社のプロパティの設定のための自動入力された一意の識別子。 この識別子は支払トランザクションで記録され、下位のプロセスが使用する (請求など) 商業プロパティを識別します。 | 有効 | 有効 | *Guid* |
    | マーチャント クライアント ID | **既定のアプリケーション** の下の PayPal 開発者ダッシュボードで取得したサンドボックス **クライアント ID** を入力します。  | 有効 | 有効 | *文字列* |
    | マーチャント API キー | **既定のアプリケーション** の下の PayPal 開発者ダッシュボードから収集されたサンドボックスの **シークレット** を入力します。 | あり | あり | *文字列* |
    | サポートされている通貨 | PayPal 決済コネクタでサポートされるセミコロンで区切られた通貨を入力します。 既定値は **USD** です。 | 有効 | はい、ただし編集することができます。 | USD; CAD |
    | サポートされている支払/入金タイプ | その他の決済コネクタは、複数の支払/入金タイプをサポートします。 PayPal の場合、支払い方法は **PayPal** だけです。 | あり | あり | PayPal |
    | サポートされている支払方法のバリアント | その他の決済コネクタは、複数の支払方法のバリアントを返すことがあります。 PayPal の場合、バリアントは **PayPal** だけです。 | あり | あり | PayPal |
    | 環境 | このフィールドを使用して、トランザクションをサンドボックスまたは本番環境に送信する必要があるかどうかを指定します。 | 有効 | 有効 | *サンドボックス* または *ライブ* |
    | OrderIntent | このフィールドは、注文参照が PayPal サービスに保存されるかどうかを指定するために使用されます。 | 無効 | 無効 | *承認* (空白にした場合の既定の動作) または *保存* |
    
> [!NOTE]
> サンドボックス環境で支払をテストする場合は、**環境** フィールドは決して本番または本番環境に設定しないでください。 **マーチャント クライアント ID** および **マーチャント API キー** を使用することはできません。 サンドボックス環境は、サンドボックス テストのみに使用できます。

### <a name="set-up-the-paypal-payment-connector-for-the-online-store"></a>オンライン店舗用の PayPal 決済コネクタの設定

1. Commerce 本社で、**小売とコマース\>チャネル\>オンライン店舗** の順に移動します。
2. オンライン店舗を選択して、PayPal 決済コネクタを追加します。
3. **オンライン店舗** ページの、**支払口座** クイック タブで、**追加** を選択します。
4. **コネクタ** で、**PayPal 向け Dynamics 365 Payment Connector** を選択します。
5. 以下の追加情報を入力します。

    | フィールド | 説明 | 必須 | 自動セット | サンプル値 |
    |---|---|:-:|:-:|---|
    | アセンブリ名 | PayPal 決済コネクタのアセンブリの自動入力された名前。 | 有効 | 有効 | *バイナリ名* |
    | サービス アカウント ID | 商社のプロパティの設定のための自動入力された一意の識別子。 この識別子は支払トランザクションで記録され、下位のプロセスが使用する (請求など) 商業プロパティを識別します。 | 有効 | 有効 | *Guid* |
    | マーチャント クライアント ID | **既定のアプリケーション** の下の PayPal 開発者ダッシュボードで取得したサンドボックス **クライアント ID** を入力します。  | 有効 | 有効 | *文字列* |
    | マーチャント API キー | **既定のアプリケーション** の下の PayPal 開発者ダッシュボードから収集されたサンドボックスの **シークレット** を入力します。 | あり | あり | *文字列* |
    | サポートされている通貨 | PayPal 決済コネクタでサポートされるセミコロンで区切られた通貨を入力します。 既定値は **USD** です。 | 有効 | はい、ただし編集することができます。 | USD; CAD |
    | サポートされている支払/入金タイプ | その他の決済コネクタは、複数の支払/入金タイプをサポートします。 PayPal の場合、支払い方法は **PayPal** だけです。 | あり | あり | PayPal |
    | サポートされている支払方法のバリアント | その他の決済コネクタは、複数の支払方法のバリアントを返すことがあります。 PayPal の場合、バリアントは **PayPal** だけです。 | あり | あり | PayPal |
    | 環境 | このフィールドを使用して、トランザクションをサンドボックスまたは本番環境に送信する必要があるかどうかを指定します。 | 有効 | 有効 | *サンドボックス* または *ライブ* |
    | OrderIntent | このフィールドは、注文参照が PayPal サービスに保存されるかどうかを指定するために使用されます。 | 無効 | 無効 | *承認* (空白にした場合の既定の動作) または *保存* |

### <a name="set-up-the-paypal-payment-method-for-the-online-store"></a>オンライン ストア用に PayPal 支払方法を設定する

オンライン ストア用に PayPal 支払方法を設定するには、次の手順を実行します。

1. PayPal 決済コネクタが構成されているオンライン ストアの **設定** タブで、**支払の算出方法** を選択します。
1. **新規** を選択して、支払方法を追加します。
1. **支払方法** フィールドで、先ほど作成した PayPal の支払方法を選択します。 
1. **工程名** フィールドで、**カードで支払う** を選択します。
1. **コネクタ名** フィールドで、**PayPal 向け Dynamics 365 Payment Connector** を選択します。
1. **転記** クイックタブで、転記詳細を指定します。
1. **電子支払の設定** を選択し、**新規** を選択した後、**ID** フィールドで以前に PayPal に対して作成したカードの種類を選択します。 
1. **保存** を選択し、**電子支払の種類** と **オンライン ストア** ページを閉じます。 

> [!NOTE]
> サンドボックス環境で支払をテストする場合は、**環境** フィールドは決して本番または本番環境に設定しないでください。 **マーチャント クライアント ID** および **マーチャント API キー** を使用することはできません。 サンドボックス環境は、サンドボックス テストのみに使用できます。

Commerce 本社で上記の変更を行った後、**1070** の配送スケジュールを使用して変更を同期します。

### <a name="configure-paypal-for-the-storefront-checkout-module"></a>店舗精算モジュール用に PayPal を構成する

店舗がチェックアウト モジュールで PayPal を使用できるように構成する方法の詳細については、[支払モジュール](payment-module.md) を参照してください。  

## <a name="enter-a-merchant-relationship-with-paypal"></a>PayPal とのマーチャント リレーションシップに入力する

PayPal で **ライブ** のマーチャント アカウントを作成するには、セルフサービスの [PayPal チェックアウト ページ](https://www.paypal.com/merchantapps/appcenter/acceptpayments/checkout) に移動するか、または [販売担当者に連絡](https://www.paypal.com/business/contact-sales) してカスタム率について話し合います。 
 
## <a name="additional-resources"></a>追加リソース

[支払に関するよく寄せられる質問](dev-itpro/payments-retail.md)

[チェックアウト モジュール](add-checkout-module.md)

[支払モジュール](payment-module.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
