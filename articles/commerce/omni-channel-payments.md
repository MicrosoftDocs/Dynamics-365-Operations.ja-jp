---
title: オムニ チャネル支払の概要
description: このトピックでは、Dynamics 365 Commerce でのオムニ チャネルの支払概要を示します。
author: rubendel
manager: AnnBe
ms.date: 09/17/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application user
ms.reviewer: josaw
ms.search.scope: Operations, Retail
ms.custom: 141393
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: AX 8.1.3
ms.openlocfilehash: 80eaf36fb382e0ebe0a66383ea17ab76faa07dfa
ms.sourcegitcommit: 199848e78df5cb7c439b001bdbe1ece963593cdb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/13/2020
ms.locfileid: "4413874"
---
# <a name="omni-channel-payments-overview"></a><span data-ttu-id="94c8b-103">オムニ チャネル支払の概要</span><span class="sxs-lookup"><span data-stu-id="94c8b-103">Omni-channel payments overview</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="94c8b-104">このトピックでは、Dynamics 365 Commerce でのオムニ チャネルの支払概要を示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-104">This topic provides an overview of omni-channel payments in Dynamics 365 Commerce.</span></span> <span data-ttu-id="94c8b-105">ここには、サポートされるシナリオの包括的な一覧、機能、セットアップ、トラブルシューティングについての情報、および一般的な問題の説明が含まれています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-105">It includes a comprehensive list of supported scenarios, information about functionality, setup, and troubleshooting, and descriptions of some typical issues.</span></span>

## <a name="key-terms"></a><span data-ttu-id="94c8b-106">重要な用語</span><span class="sxs-lookup"><span data-stu-id="94c8b-106">Key terms</span></span>

| <span data-ttu-id="94c8b-107">相談</span><span class="sxs-lookup"><span data-stu-id="94c8b-107">Term</span></span> | <span data-ttu-id="94c8b-108">説明</span><span class="sxs-lookup"><span data-stu-id="94c8b-108">Description</span></span> |
|---|---|
| <span data-ttu-id="94c8b-109">トークン</span><span class="sxs-lookup"><span data-stu-id="94c8b-109">Token</span></span> | <span data-ttu-id="94c8b-110">支払プロセッサが参照として提供する一連のデータ。</span><span class="sxs-lookup"><span data-stu-id="94c8b-110">A string of data that a payment processor provides as a reference.</span></span> <span data-ttu-id="94c8b-111">トークンは、支払カード番号、支払認証、前回の支払キャプチャを表すことができます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-111">Tokens can represent payment card numbers, payment authorizations, and previous payment captures.</span></span> <span data-ttu-id="94c8b-112">トークンは、販売時点管理 (POS) システムの外で機密データを保持するのに役立つため重要です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-112">Tokens are important because they help keep sensitive data out of the point of sale (POS) system.</span></span> <span data-ttu-id="94c8b-113">*参照* と呼ばれることもあります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-113">They are sometimes also referred to as *references*.</span></span> |
| <span data-ttu-id="94c8b-114">カード トークン</span><span class="sxs-lookup"><span data-stu-id="94c8b-114">Card token</span></span> | <span data-ttu-id="94c8b-115">POS システムのストレージに対して支払プロセッサが提供するトークン。</span><span class="sxs-lookup"><span data-stu-id="94c8b-115">A token that a payment processor provides for storage in the POS system.</span></span> <span data-ttu-id="94c8b-116">カード トークンは、それを受け取る販売者のみが使用できます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-116">A card token can be used only by the merchant who receives it.</span></span> <span data-ttu-id="94c8b-117">カード トークンは、*カード参照* と呼ばれることもあります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-117">Card tokens are sometimes also referred to as *card references*.</span></span> |
| <span data-ttu-id="94c8b-118">承認 (認証) トークン</span><span class="sxs-lookup"><span data-stu-id="94c8b-118">Authorization (auth) token</span></span> | <span data-ttu-id="94c8b-119">POS システムが支払プロセッサに承認要求をした後、支払プロセッサが POS システムに送信する応答の一部として提供する固有の ID です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-119">A unique ID that a payment process provides as part of the response that it sends to a POS system after the POS system makes an authorization request.</span></span> <span data-ttu-id="94c8b-120">承認を取り消したり無効にしたりするなどのアクションを実行するためにプロセッサが呼び出された場合、この承認トークンを後で使用できます</span><span class="sxs-lookup"><span data-stu-id="94c8b-120">An authorization token can be used later if the processor is called to perform actions such as reversing or voiding the authorization.</span></span> <span data-ttu-id="94c8b-121">ただし、注文が履行されたとき、またはトランザクションが確定したときに、資金を取得するために最もよく使用されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-121">However, it's most often used to capture funds when an order is fulfilled or a transaction is finalized.</span></span> <span data-ttu-id="94c8b-122">承認トークンは、*承認参照* と呼ばれることもあります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-122">Authorization tokens are sometimes also referred to as *authorization references*.</span></span> |
| <span data-ttu-id="94c8b-123">キャプチャ トークン</span><span class="sxs-lookup"><span data-stu-id="94c8b-123">Capture token</span></span> | <span data-ttu-id="94c8b-124">支払が完了またはキャプチャされるときに、支払プロセッサが POS システムに提供する参照です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-124">A reference that a payment processor provides to a POS system when a payment is finalized or captured.</span></span> <span data-ttu-id="94c8b-125">これにより、キャプチャ トークンを使用して、返金要求など、その後の工程の支払キャプチャを参照できます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-125">The capture token can then be used to reference the payment capture in subsequent operations, such as refund requests.</span></span> | 
| <span data-ttu-id="94c8b-126">カードなし</span><span class="sxs-lookup"><span data-stu-id="94c8b-126">Card not present</span></span> | <span data-ttu-id="94c8b-127">現物カードが記載されていない支払トランザクションを参照する用語です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-127">A term that refers to payment transactions where a physical card isn't presented.</span></span> <span data-ttu-id="94c8b-128">たとえば、これらのトランザクションは、電子商取引またはコール センターのシナリオで発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-128">For example, these transactions can occur in e-commerce or call center scenarios.</span></span> <span data-ttu-id="94c8b-129">これらのトランザクションに向けて、支払に関連する情報は、電子商取引 Web サイト、コール センター フロー、または POS または支払ターミナルにて手動で入力されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-129">For these transactions, the payment-related information is manually entered on an e-commerce website, in a call center flow, or on the POS or payment terminal.</span></span> |
| <span data-ttu-id="94c8b-130">カードあり</span><span class="sxs-lookup"><span data-stu-id="94c8b-130">Card present</span></span> | <span data-ttu-id="94c8b-131">物理的なカードが、Microsoft Dynamics 365 POS システムにつながる支払ターミナル コネクタで提示および使用される支払トランザクションを参照する用語です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-131">A term that refers to payment transactions where a physical card is presented and used on a payment terminal that is connected to the Microsoft Dynamics 365 POS system.</span></span> |

## <a name="overview"></a><span data-ttu-id="94c8b-132">概要</span><span class="sxs-lookup"><span data-stu-id="94c8b-132">Overview</span></span>

<span data-ttu-id="94c8b-133">一般的に、*オムニ チャネル支払* という用語は、1 つのチャネルで注文を作成し、それを別のチャネルで満たすための機能を表します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-133">In general, the term *omni-channel payments* describes the ability to create an order in one channel and fulfill it in another channel.</span></span> <span data-ttu-id="94c8b-134">オムニ チャネル支払のサポートの鍵は、支払詳細を他の注文詳細の残りと一緒に保存し、別のチャネルで注文が取り消されたり処理されたりしたときに、支払詳細を使用することです。</span><span class="sxs-lookup"><span data-stu-id="94c8b-134">The key to omni-channel payment support is preserving payment details together with the rest of the order details, and then using those payment details when the order is recalled or processed in another channel.</span></span> <span data-ttu-id="94c8b-135">古典的な例として、「オンラインで購入、店舗で受取」というシナリオがあります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-135">A classic example is the "Buy online, pick up in store" scenario.</span></span> <span data-ttu-id="94c8b-136">このシナリオでは、注文をオンラインで作成したときに、支払詳細が追加されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-136">In this scenario, the payment details are added when the order is created online.</span></span> <span data-ttu-id="94c8b-137">その後、受取り時に顧客の支払カードを請求するために POS で呼び戻されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-137">They are then recalled at the POS to charge the customer's payment card at the time of pickup.</span></span> 

<span data-ttu-id="94c8b-138">このトピックで説明されるすべてのシナリオは、Commerce で提供される標準の支払ソフトウェア開発キット (SDK) を使用して実装できます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-138">All the scenarios that are described in this topic can be implemented by using the standard Payments software development kit (SDK) that is provided with Commerce.</span></span> <span data-ttu-id="94c8b-139">[Dynamics 365 Payment Connector for Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) では、こちらで説明されるすべてのシナリオの直ぐに使える実装を提供します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-139">The [Dynamics 365 Payment Connector for Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) provides an out-of-box implementation of every scenario that is described here.</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="94c8b-140">必要条件</span><span class="sxs-lookup"><span data-stu-id="94c8b-140">Prerequisites</span></span>

<span data-ttu-id="94c8b-141">このトピックで説明されるすべてのシナリオでは、オムニ チャネル支払をサポートする支払コネクタが必要です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-141">Every scenario that is described in this topic requires a payment connector that supports omni-channel payments.</span></span> <span data-ttu-id="94c8b-142">直ぐに使える Adyen コネクタは、支払 SDK を通じて使用可能となるシナリオをサポートするため、使うこともできます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-142">The out-of-box Adyen connector can also be used, because it supports the scenarios that are made available through the Payments SDK.</span></span> <span data-ttu-id="94c8b-143">支払コネクタの実装方法および一般的な Retail SDK の詳細については、[IT プロおよび開発者向けの小売ホーム ページ](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors) にアクセスしてください。</span><span class="sxs-lookup"><span data-stu-id="94c8b-143">For more information about how to implement payment connectors, and about the Retail SDK in general, visit the [Retail for IT pros and developers home page](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors).</span></span>

#### <a name="supported-versions"></a><span data-ttu-id="94c8b-144">サポートされているバージョン</span><span class="sxs-lookup"><span data-stu-id="94c8b-144">Supported versions</span></span>

<span data-ttu-id="94c8b-145">このトピックで説明されているオムニ チャネル支払の機能は、Microsoft Dynamics 365 for Retail 8.1.3 の一部としてリリースされました。</span><span class="sxs-lookup"><span data-stu-id="94c8b-145">The omni-channel payment capabilities that are described in this topic were released as part of Microsoft Dynamics 365 for Retail version 8.1.3.</span></span> 

#### <a name="card-present-and-card-not-present-connectors"></a><span data-ttu-id="94c8b-146">「カードあり」と「カードなし」のコネクタ</span><span class="sxs-lookup"><span data-stu-id="94c8b-146">"Card present" and "card not present" connectors</span></span>

<span data-ttu-id="94c8b-147">支払 SDK は、2 セットの支払い用アプリケーション プログラミング インターフェイス (APIs) に依存します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-147">The Payments SDK relies on two sets of application programming interfaces (APIs) for payments.</span></span> <span data-ttu-id="94c8b-148">最初の APIs セットは、**iPaymentProcessor** と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-148">The first set of APIs is named **iPaymentProcessor**.</span></span> <span data-ttu-id="94c8b-149">これは、コール センターおよび Microsoft Dynamics 電子商取引プラットフォームで使用できる「カードなし」の支払コネクタを実装するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-149">It's used to implement "card not present" payment connectors that can be used in call centers and with the Microsoft Dynamics e-Commerce platform.</span></span> <span data-ttu-id="94c8b-150">**iPaymentProcessor** インターファイスについては、支払いをカバーする[支払コネクタと支払デバイスの実装](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf) ホワイト ペーパーを参照してください。</span><span class="sxs-lookup"><span data-stu-id="94c8b-150">For more information about the **iPaymentProcessor** interface, see the [Implement a payment connector and a payment device](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf) white paper, which covers payments.</span></span> 

<span data-ttu-id="94c8b-151">2 番目の APIs セットは、**iNamedRequestHandler** と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-151">The second set of APIs is named **iNamedRequestHandler**.</span></span> <span data-ttu-id="94c8b-152">この機能は、支払ターミナルを使用する「カードあり」の支払統合をサポートします。</span><span class="sxs-lookup"><span data-stu-id="94c8b-152">It supports the implementation of "card present" payment integrations that use a payment terminal.</span></span> <span data-ttu-id="94c8b-153">**INamedRequestHandler** インターフェイスの詳細については、[支払ターミナルの支払統合を作成](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94c8b-153">For more information about the **iNamedRequestHandler** interface, see [Create a payment integration for a payment terminal](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension).</span></span> 

### <a name="setup-and-configuration"></a><span data-ttu-id="94c8b-154">設定およびコンフィギュレーション</span><span class="sxs-lookup"><span data-stu-id="94c8b-154">Setup and configuration</span></span>

<span data-ttu-id="94c8b-155">次のコンポーネントと設定手順が必要です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-155">The following components and setup steps are required:</span></span>

- <span data-ttu-id="94c8b-156">**E コマースの統合:** Commerce との統合は、注文がオンライン店舗で発生するシナリオをサポートするために必要です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-156">**eCommerce integration:** An integration with Commerce is required to support scenarios where an order originates in an online storefront.</span></span> <span data-ttu-id="94c8b-157">小売の電子商取引 SDK の詳細は[電子商取引プラットフォーム ソフトウェア開発キット (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94c8b-157">For more information about the Retail e-Commerce SDK, see [e-Commerce platform software development kit (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk).</span></span> <span data-ttu-id="94c8b-158">デモ環境では、参照ストアがオムニ チャネル支払のシナリオをサポートします。</span><span class="sxs-lookup"><span data-stu-id="94c8b-158">In a demo environment, the reference storefront supports omni-channel payment scenarios.</span></span> 
- <span data-ttu-id="94c8b-159">**オンライン支払構成:** オンライン チャネルの設定には、オムニ チャネル支払をサポートするように、更新された支払コネクタを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-159">**Online payments configuration:** The setup of the online channel must include a payment connector that has been updated to support omni-channel payments.</span></span> <span data-ttu-id="94c8b-160">代わりに、直ぐに使える支払コネクタを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-160">Alternatively, the out-of-box payment connector can be used.</span></span> <span data-ttu-id="94c8b-161">オンライン ストアの Adyen 支払コネクタを構成する方法については [Adyen 支払コネクタ](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94c8b-161">For information about how to configure the Adyen payment connector for online stores, see [Adyen payment connector](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce).</span></span> <span data-ttu-id="94c8b-162">そのトピックで説明されている電子商取引の設定に加えて、**電子商取引で支払情報の保存を許可する** パラメーターでは、Adyen コネクタの設定で **True** と設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-162">In addition to the eCommerce setup steps that are described in that topic, the **Allow saving payment information in e-commerce** parameter must be set to **True** in the settings for the Adyen connector.</span></span> 
- <span data-ttu-id="94c8b-163">**オムニ チャネルの支払コンフィギュレーション:** バック オフィスで **Retail および Commerce\>Headquarters の設定 \>パラメーター \>Commerce 共有パラメーター** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-163">**Omni-channel payments configuration:** In the back office, go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce shared parameters**.</span></span> <span data-ttu-id="94c8b-164">次に **オムニ チャネルの支払** タブで **オムニ チャネルの支払を使用する** オプションを **はい** に設定します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-164">Then, on the **Omni-channel payments** tab, set the **Use omni-channel payments** option to **Yes**.</span></span> <span data-ttu-id="94c8b-165">Commerce のバージョン 10.0.12 では、この設定は **機能管理** ワークスペースにあります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-165">In Commerce versions 10.0.12 and later, this setting is in the **Feature Management** workspace.</span></span> <span data-ttu-id="94c8b-166">**オムニ チャネル支払** 機能を選択して、**今すぐ有効にする** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="94c8b-166">Select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="94c8b-167">**支払サービス:** コールセンターでは、**支払サービス** ページの既定の支払コネクタを使用して支払を処理します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-167">**Payment services:** The call center uses the default payment connector on the **Payment services** page to process payments.</span></span> <span data-ttu-id="94c8b-168">「コールセンターで購入」や「店舗で受取り」などのシナリオをサポートするには、この既定の支払コネクタは、オムニ チャネル支払に向けた実装要望を満たす Adyen 支払コネクタまたはオムニ チャネル支払である必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-168">To support scenarios such as "Buy in call center, pick up in store," this default payment connector must be the Adyen payment connector or a payment connector that meets the implementation requirements for omni-channel payments.</span></span>
- <span data-ttu-id="94c8b-169">**EFT サービス:** 支払ターミナルを通じた支払は、ハードウェア プロファイルの **EFT サービス** FastTab で設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-169">**EFT service:** Payments through a payment terminal must be set up on the **EFT service** FastTab of the hardware profile.</span></span> <span data-ttu-id="94c8b-170">Adyen コネクタでは、そのままオムニ チャネル支払のシナリオがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-170">The Adyen connector supports omni-channel payments scenarios out of the box.</span></span> <span data-ttu-id="94c8b-171">**INamedRequestHandler** インターフェイスをサポートする他の支払コネクタは、オムニ チャネル支払をサポートする場合にも使用できます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-171">Other payment connectors that support the **iNamedRequestHandler** interface can also be used if they support omni-channel payments.</span></span>
- <span data-ttu-id="94c8b-172">**支払コネクタの使用可能性:** 注文が取り消されると、支払い入札明細では、その注文に関連付けられている承認の作成に使用された支払コネクタの名前が注文と共に取り消されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-172">**Payment connector availability:** When an order is recalled, the payment tender lines that are recalled together with the order include the name of the payment connector that was used to create the authorizations that are associated with that order.</span></span> <span data-ttu-id="94c8b-173">注文が満たされると、支払 SDK は、元の承認の作成に使用されたものと同じコネクタを使おうとします。</span><span class="sxs-lookup"><span data-stu-id="94c8b-173">When the order is fulfilled, the Payments SDK tries to use the same connector that was used to create the original authorization.</span></span> <span data-ttu-id="94c8b-174">したがって、同じ商社プロパティを持つ支払コネクタはキャプチャ可能でなければなりません。</span><span class="sxs-lookup"><span data-stu-id="94c8b-174">Therefore, a payment connector that has the same merchant properties must be available for capture.</span></span> 
- <span data-ttu-id="94c8b-175">**カード タイプ:** オムニ チャネルのシナリオが正常に機能するには、各チャネルで、オムニ チャネルに使用できる支払/入金タイプについて同じ設定を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-175">**Card types:** For omni-channel scenarios to work properly, each channel must have the same setup for tender types that can be used for omni-channel.</span></span> <span data-ttu-id="94c8b-176">この設定には、支払方法 ID とカードタイプ ID が含まれます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-176">This setup includes payment method IDs and card type IDs.</span></span> <span data-ttu-id="94c8b-177">たとえば、オンライン店舗設定で **カード** 支払/入金タイプが **2** の ID である場合、小売用店舗設定で同じ ID を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-177">For example, if the **Cards** tender type has an ID of **2** in the online store setup, it should have the same ID in the retail store setup.</span></span> <span data-ttu-id="94c8b-178">同じ要件が、カードタイプ ID にも適用されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-178">The same requirement applies to card type IDs.</span></span> <span data-ttu-id="94c8b-179">カード番号 **12** がオンライン店舗で **VISA** に設定されている場合、小売店舗に対して同じ ID が設定されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-179">If card number **12** is set to **VISA** in the online store, the same ID should be set up for the retail store.</span></span> 
- <span data-ttu-id="94c8b-180">組み込みハードウェア ステーションを含む Windows または Android 用  Retail Modern POS   または-</span><span class="sxs-lookup"><span data-stu-id="94c8b-180">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="94c8b-181">共有ハードウェア ステーションが接続されている iOS またはクラウド POS のモダン POS。</span><span class="sxs-lookup"><span data-stu-id="94c8b-181">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

### <a name="basic-principle-supporting-omni-channel-payments"></a><span data-ttu-id="94c8b-182">オムニ チャネル支払をサポートする基本原則</span><span class="sxs-lookup"><span data-stu-id="94c8b-182">Basic principle supporting omni-channel payments</span></span>

<span data-ttu-id="94c8b-183">支払コネクタと支払プロセッサは、トークンまたは参照を使用して、カード支払に関連する相互作用を参照します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-183">Payment connectors and payment processors use tokens, or references, to reference interactions that are related to card payments.</span></span> <span data-ttu-id="94c8b-184">たとえば、支払承認を要求すると、その承認への参照が提供されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-184">For example, when a payment authorization is requested, a reference to that authorization is provided.</span></span> <span data-ttu-id="94c8b-185">したがって、履行時に資金が取得される際、後から承認を参照できます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-185">Therefore, the authorization can be referenced later, when funds are captured at the time of fulfillment.</span></span> <span data-ttu-id="94c8b-186">商社、支払コネクタ、およびプロセッサに固有の承認です。</span><span class="sxs-lookup"><span data-stu-id="94c8b-186">This authorization is unique to the merchant, payment connector, and processor.</span></span> 

<span data-ttu-id="94c8b-187">オンラインで作成された注文を店舗で受け取る場合、その注文に対して同じ支払詳細をリコールして使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-187">If an order that was created online is being picked up in the store, the same payment details for that order must be recalled and used.</span></span> <span data-ttu-id="94c8b-188">元の承認に対して支払をキャプチャする要求の一部として元の詳細が提供されているとき、支払プロセッサはその要求を処理し、支払を取り込むことができます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-188">When the original details are provided as part of the request to capture a payment against the original authorization, the payment processor will be able to handle the request and capture the payment.</span></span> 

<span data-ttu-id="94c8b-189">オンライン注文を正しく参照するには、同じプロセッサをサポートする「カードなし」の支払コネクタも使用可能である必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-189">To correctly reference the online order, a "card not present" payment connector that supports the same processor must also be available.</span></span> <span data-ttu-id="94c8b-190">この方法で、POS システムは「カードあり」の支払に対して 1 つのプロセッサを持つことができますが、別の支払プロセッサにアクセスすることにより、異なる支払プロセッサを使い他のチャネルで作成された注文を満たすことができるようになります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-190">In this way, the POS system can have one processor for "card present" payments, but it can also have access to other payment connectors so that it can fulfill orders that are created in other channels by using different payment processors.</span></span> 

## <a name="supported-scenarios"></a><span data-ttu-id="94c8b-191">サポートされているシナリオ</span><span class="sxs-lookup"><span data-stu-id="94c8b-191">Supported scenarios</span></span>

<span data-ttu-id="94c8b-192">次のオムニ チャネル支払のシナリオがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-192">The following omni-channel payment scenarios are supported:</span></span>

- <span data-ttu-id="94c8b-193">オンラインで購入し、店舗で受取り</span><span class="sxs-lookup"><span data-stu-id="94c8b-193">Buy online, pick up in store</span></span>
- <span data-ttu-id="94c8b-194">コール センターで購入し、店舗で受取る</span><span class="sxs-lookup"><span data-stu-id="94c8b-194">Buy in call center, pick up in store</span></span>
- <span data-ttu-id="94c8b-195">店舗 A で購入し、店舗 B で受取る</span><span class="sxs-lookup"><span data-stu-id="94c8b-195">Buy in store A, pick up in store B</span></span>
- <span data-ttu-id="94c8b-196">店舗 A で購入し、顧客へ出荷</span><span class="sxs-lookup"><span data-stu-id="94c8b-196">Buy in store A, ship to customer</span></span>

    > [!NOTE]
    > <span data-ttu-id="94c8b-197">コール センターで "通常" の支払機能にマップされている支払は、POS で注文を取り消すときに支払額に反映されるように、**前払** = **はい** とマークされる必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-197">Payments made in the call center that map to the "Normal" payment function must be marked as **Prepay** = **Yes** to be reflected in the amount due when recalling the order in the POS.</span></span> <span data-ttu-id="94c8b-198">POSで注文が取り消されるときに、タイプ "通常" の前払以外の支払は認識されません。</span><span class="sxs-lookup"><span data-stu-id="94c8b-198">Non-prepay payments of type "Normal" are not recognized when the order is recalled in POS.</span></span> 

<span data-ttu-id="94c8b-199">これらのシナリオのバリエーションもサポートされています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-199">Variations of these scenarios are also supported.</span></span> <span data-ttu-id="94c8b-200">たとえば、オンライン注文には、顧客に出荷される明細行と、店舗で受取れる両方の明細行が含まれている場合があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-200">For example, an online order might include both lines that will be shipped to the customer and lines that will be picked up in a store.</span></span> <span data-ttu-id="94c8b-201">すべての注文フルフィルメント オプションは、オムニ チャネル支払を通じてサポートされます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-201">All order fulfillment options are supported via omni-channel payments.</span></span> 

<span data-ttu-id="94c8b-202">次のセクションでは、シナリオごとに手順を説明し、デモ データを使用してシナリオの実行方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-202">The following sections describe the steps for each scenario and show how to run the scenario by using demo data.</span></span> 

### <a name="buy-online-pick-up-in-store"></a><span data-ttu-id="94c8b-203">オンラインで購入し、店舗で受取り</span><span class="sxs-lookup"><span data-stu-id="94c8b-203">Buy online, pick up in store</span></span>

<span data-ttu-id="94c8b-204">始める前に、次の条件が満たされていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-204">Before you start, make sure that the following prerequisites are in place:</span></span>

- <span data-ttu-id="94c8b-205">Adyen コネクタがコンフィギュレーションされている参照ストアがあります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-205">You have a reference storefront where the Adyen connector is configured.</span></span>
- <span data-ttu-id="94c8b-206">**Commerce 共有パラメーター** ページの **オムニ チャネル支払** オプションを、**True** に設定します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-206">The **Omni-channel payments** option on the **Commerce shared parameters** page is set to **True**.</span></span> <span data-ttu-id="94c8b-207">それ以降のバージョンでは、この設定が **フィーチャー管理** ワークスペースに移動され、**オムニ チャネル支払** 機能を選択して、**今すぐ有効にする** をクリックできるようになっています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-207">In later versions this settng is moved to the **Feature Management** workspace where you can select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="94c8b-208">ヒューストンの POS レジスターに対して、Adyen 支払コネクタがコンフィギュレーションされています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-208">The Adyen payment connector is configured for the Houston POS register.</span></span>
- <span data-ttu-id="94c8b-209">組み込みハードウェア ステーションを含む Windows または Android 用  Retail Modern POS   または-</span><span class="sxs-lookup"><span data-stu-id="94c8b-209">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="94c8b-210">共有ハードウェア ステーションが接続されている iOS またはクラウド POS のモダン POS。</span><span class="sxs-lookup"><span data-stu-id="94c8b-210">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

<span data-ttu-id="94c8b-211">次の手順に従い、シナリオを実行します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-211">Follow these steps to run the scenario.</span></span>

1. <span data-ttu-id="94c8b-212">参照店舗内で、店舗内での受取注文を作成します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-212">In the reference storefront, create an order for in-store pickup.</span></span> <span data-ttu-id="94c8b-213">必ず **ヒューストン** 店舗を選択してください。</span><span class="sxs-lookup"><span data-stu-id="94c8b-213">Be sure to select the **Houston** store.</span></span> 
2. <span data-ttu-id="94c8b-214">チェックアウトの手順を実行し、テスト クレジットカード番号を使用して支払を行います。</span><span class="sxs-lookup"><span data-stu-id="94c8b-214">Go through the checkout steps, and pay by using a test credit card number.</span></span> <span data-ttu-id="94c8b-215">テスト クレジットカード番号は、[Adyen テスト カード番号のページ](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description) で確認できます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-215">You can find test credit card numbers on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description).</span></span>
3. <span data-ttu-id="94c8b-216">Commerce で、**同期注文** バッチ ジョブと **P-001** 配送スケジュールを使用して、バック オフィスに注文を作成します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-216">In Commerce, use the **Synchronize orders** batch job and the **P-001** distribution schedule to create the orders in the back office.</span></span>
4. <span data-ttu-id="94c8b-217">POS の開始ページで、店舗の受取の注文を確認するため、**受取注文** の操作を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-217">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
5. <span data-ttu-id="94c8b-218">参照ストアで作成された注文から 1 つ以上の明細行を選択し、**受取** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-218">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="94c8b-219">注文はバック オフィスから取得されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-219">The order is retrieved from the back office.</span></span> 

6. <span data-ttu-id="94c8b-220">注文明細行の詳細がバック オフィスから取得され、オムニ チャネルに使用できるカード支払が検出された場合は、支払方法が使用可能であると通知されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-220">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
7. <span data-ttu-id="94c8b-221">**利用可能な支払方法を使用** を選択し、参照ストアに入力されたカード詳細を使用してトランザクションを完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-221">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="94c8b-222">注文明細行はトランザクション ページに読み込まれ、請求額は 0 (ゼロ) になります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-222">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span> 

8. <span data-ttu-id="94c8b-223">**支払** タブを選択し、オンライン注文から引き出された支払/入金明細行を表示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-223">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
9. <span data-ttu-id="94c8b-224">任意の支払方法を選択し、トランザクションを完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-224">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-call-center-pick-up-in-store"></a><span data-ttu-id="94c8b-225">コール センターで購入し、店舗で受取る</span><span class="sxs-lookup"><span data-stu-id="94c8b-225">Buy in call center, pick up in store</span></span>

1. <span data-ttu-id="94c8b-226">Commerce の **顧客サービス** ページで、検索バーの **Karen Berg** を入力し、**検索** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-226">In Commerce, on the **Customer service** page, enter **Karen Berg** in the search bar, and then select **Search**.</span></span> 
3. <span data-ttu-id="94c8b-227">検索結果で、**Karen Berg** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-227">Select **Karen Berg** in the search results.</span></span>
4. <span data-ttu-id="94c8b-228">Karen が **顧客サービス** ページに読み込まれた後、**新しい販売注文** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-228">After Karen is loaded onto the **Customer service** page, select **New sales order**.</span></span>
5. <span data-ttu-id="94c8b-229">新しい販売注文ページで、**ヘッダー** を選択し、注文ヘッダーを表示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-229">On the new sales order page, select **Header** to view the order header.</span></span> 
6. <span data-ttu-id="94c8b-230">**注文ヘッダー** ページで、サイトを **セントラル** に設定し、倉庫を **ヒューストン** に設定します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-230">On the **Order header** page, set the site to **Central** and the warehouse to **Houston**.</span></span>
7. <span data-ttu-id="94c8b-231">**配送** タブで、顧客が受け取れるよう、**配送のモード** フィールドを **60** に設定します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-231">On the **Deliver** tab, set the **Mode of delivery** field to **60** for customer pickup.</span></span>
8. <span data-ttu-id="94c8b-232">**明細行** を選択し、注文に 1 つ以上の明細行を追加します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-232">Select **Lines**, and then add one or more lines to the order.</span></span> 
9. <span data-ttu-id="94c8b-233">**完了** を選択して、注文完了フローを入力します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-233">Select **Complete** to enter the order completion flow.</span></span>
10. <span data-ttu-id="94c8b-234">支払セクションまでスクロールし、**追加** を選択し、支払方法のタイプが **カード** に設定されている明細行を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-234">Scroll down to the payments section, select **Add**, and then select a line where the payment method type is set to **Cards**.</span></span> 
11. <span data-ttu-id="94c8b-235">追加サイン (**+**) を選択し、カード支払に追加します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-235">Select the plus sign (**+**) to add a card payment.</span></span> 
12. <span data-ttu-id="94c8b-236">[Adyen のテストカード番号のページ](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description) で検出されたテスト クレジットカード番号の詳細を入力し、**OK** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-236">Enter the details for a test credit card number that you found on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description), and then select **OK**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="94c8b-237">入力したカード番号のカードのブランドが、支払を開始したときに選択されたブランドと異なる場合は、支払が続行されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-237">If the card brand for the card number that you entered differs from the brand that was selected when the payment was initiated, the payment will still go through.</span></span> <span data-ttu-id="94c8b-238">ただし、ステップ 10 で選択したカード ブランドにマップされている勘定に転記されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-238">However, it will be posted to the accounts that are mapped to the card brand that you selected in step 10.</span></span>

12. <span data-ttu-id="94c8b-239">**OK** をもう一度選択し、**注文完了支払** ダイアログ ボックスを閉じます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-239">Select **OK** again to close the **Order completion payments** dialog box.</span></span>
13. <span data-ttu-id="94c8b-240">**販売注文の集計** ページで、**送信** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-240">On the **Sales order summary** page, select **Submit**.</span></span>
14. <span data-ttu-id="94c8b-241">POS の開始ページで、店舗の受取の注文を確認するため、**受取注文** の操作を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-241">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="94c8b-242">参照ストアで作成された注文から 1 つ以上の明細行を選択し、**受取** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-242">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="94c8b-243">注文はバック オフィスから取得されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-243">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="94c8b-244">注文明細行の詳細がバック オフィスから取得され、オムニ チャネルに使用できるカード支払が検出された場合は、支払方法が使用可能であると通知されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-244">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="94c8b-245">**利用可能な支払方法を使用** を選択し、参照ストアに入力されたカード詳細を使用してトランザクションを完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-245">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="94c8b-246">注文明細行はトランザクション ページに読み込まれ、請求額は 0 (ゼロ) になります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-246">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="94c8b-247">**支払** タブを選択し、オンライン注文から引き出された支払/入金明細行を表示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-247">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="94c8b-248">任意の支払方法を選択し、トランザクションを完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-248">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-pick-up-in-store-b"></a><span data-ttu-id="94c8b-249">店舗 A で購入し、店舗 B で受取る</span><span class="sxs-lookup"><span data-stu-id="94c8b-249">Buy in store A, pick up in store B</span></span>

1. <span data-ttu-id="94c8b-250">ヒューストンの店舗の POS を起動します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-250">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="94c8b-251">**トランザクション** ページで、数値パッドを使用して **2001** を入力することにより、Karen Berg をトランザクションに追加します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-251">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="94c8b-252">トランザクションに 1 つ以上の明細行を追加します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-252">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="94c8b-253">**注文** を選択して、注文オプションを表示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-253">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="94c8b-254">**すべて受取** を選択し、メッセージが表示されたら、**顧客注文** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-254">Select **Pick up all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="94c8b-255">検索バーで **シアトル** と入力し、受取のため **シアトル** の店舗を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-255">In the search bar, enter **Seattle**, and then select the **Seattle** store for pickup.</span></span> 
7. <span data-ttu-id="94c8b-256">**OK** を選択し、現在の日付が受取の集配の日付として使用されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-256">Select **OK** to accept the current date as the date of pickup.</span></span>
9. <span data-ttu-id="94c8b-257">**支払カード** を選択し、支払を開始します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-257">Select **Pay card** to initiate the payment.</span></span>
10. <span data-ttu-id="94c8b-258">預金の期日を迎える金額のカード支払/入金を行います。</span><span class="sxs-lookup"><span data-stu-id="94c8b-258">Tender the card payment for the amount that is due for the deposit.</span></span> 
11. <span data-ttu-id="94c8b-259">支払ターミナルで預金支払を完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-259">Complete the deposit payment on the payment terminal.</span></span> 
12. <span data-ttu-id="94c8b-260">預金が支払われたら、オプションを選択してフルフィルメントの同じカードを使用し、注文が完了するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-260">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span> 
13. <span data-ttu-id="94c8b-261">シアトル店舗の POS を起動します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-261">Start the POS for the Seattle store.</span></span>
14. <span data-ttu-id="94c8b-262">POS の開始ページで、店舗の受取の注文を確認するため、**受取注文** の操作を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-262">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="94c8b-263">参照ストアで作成された注文から 1 つ以上の明細行を選択し、**受取** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-263">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="94c8b-264">注文はバック オフィスから取得されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-264">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="94c8b-265">注文明細行の詳細がバック オフィスから取得され、オムニ チャネルに使用できるカード支払が検出された場合は、支払方法が使用可能であると通知されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-265">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="94c8b-266">**利用可能な支払方法を使用** を選択し、参照ストアに入力されたカード詳細を使用してトランザクションを完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-266">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="94c8b-267">注文明細行はトランザクション ページに読み込まれ、請求額は 0 (ゼロ) になります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-267">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="94c8b-268">**支払** タブを選択し、オンライン注文から引き出された支払/入金明細行を表示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-268">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="94c8b-269">任意の支払方法を選択し、トランザクションを完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-269">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-ship-to-customer"></a><span data-ttu-id="94c8b-270">店舗 A で購入し、顧客へ出荷</span><span class="sxs-lookup"><span data-stu-id="94c8b-270">Buy in store A, ship to customer</span></span>

1. <span data-ttu-id="94c8b-271">ヒューストンの店舗の POS を起動します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-271">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="94c8b-272">**トランザクション** ページで、数値パッドを使用して **2001** を入力することにより、Karen Berg をトランザクションに追加します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-272">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="94c8b-273">トランザクションに 1 つ以上の明細行を追加します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-273">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="94c8b-274">**注文** を選択して、注文オプションを表示します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-274">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="94c8b-275">**すべて出荷** を選択し、メッセージが表示されたら、**顧客注文** を選択します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-275">Select **Ship all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="94c8b-276">配送方法ページで、**標準翌日配達** を選択し、**OK** を選択して、今日の日付を配送日として受け入れます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-276">In the shipping method page, select **Standard overnight**, and then select **OK** to accept today's date as the shipping date.</span></span> 
7. <span data-ttu-id="94c8b-277">**OK** を選択し、現在の日付が受取の集配の日付として使用されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-277">Select **OK** to accept the current date as the date of pickup.</span></span>
8. <span data-ttu-id="94c8b-278">**支払カード** を選択し、支払を開始します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-278">Select **Pay card** to initiate the payment.</span></span>
9. <span data-ttu-id="94c8b-279">預金の期日を迎える金額のカード支払/入金を行います。</span><span class="sxs-lookup"><span data-stu-id="94c8b-279">Tender the card payment for the amount that is due for the deposit.</span></span> 
10. <span data-ttu-id="94c8b-280">支払ターミナルで預金支払を完了します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-280">Complete the deposit payment on the payment terminal.</span></span> 
11. <span data-ttu-id="94c8b-281">預金が支払われたら、オプションを選択してフルフィルメントの同じカードを使用し、注文が完了するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-281">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span>

<span data-ttu-id="94c8b-282">注文が受取、集荷、梱包、およびバック オフィスで請求されると、POS で提供される支払詳細を使用して、顧客に出荷される商品のための資金がキャプチャされます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-282">When the order is picked, packed, and invoiced in the back office, the payment details that are provided at the POS will be used to capture the funds for the goods that are being shipped to the customer.</span></span> 

## <a name="scenario-details"></a><span data-ttu-id="94c8b-283">シナリオの詳細</span><span class="sxs-lookup"><span data-stu-id="94c8b-283">Scenario details</span></span>

<span data-ttu-id="94c8b-284">説明した基本的なシナリオに加えて、オムニ チャネル支払をサポートするために、支払 SDK にいくつかの拡張が行われています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-284">In addition to the basic scenarios that were just described, several enhancements have been made to the Payments SDK to support omni-channel payments.</span></span> 

### <a name="pos"></a><span data-ttu-id="94c8b-285">POS</span><span class="sxs-lookup"><span data-stu-id="94c8b-285">POS</span></span>

#### <a name="single-swipedip-for-customer-orders"></a><span data-ttu-id="94c8b-286">顧客注文用のシングル スワイプ/dip</span><span class="sxs-lookup"><span data-stu-id="94c8b-286">Single swipe/dip for customer orders</span></span>

<span data-ttu-id="94c8b-287">オムニ チャネル支払機能が実装されていない前に、預金を含む顧客注文が POS で作成されるとき、顧客はカードを 2 回スワイプ (または dip) する必要があります。1 回は預金を支払うためで、もう 1 回は次の注文フルフィルメントをトークン化するためです。</span><span class="sxs-lookup"><span data-stu-id="94c8b-287">Before the omni-channel payments feature was implemented, when customer orders that included deposits were created at the POS, customers were required to swipe (or dip) their card two times: one time to pay the deposit and one time to tokenize the card for subsequent order fulfillment.</span></span> <span data-ttu-id="94c8b-288">オムニ チャネルのトークン化機能がオンになっているとき、顧客は両方に預金を支払うためカードを 1 回だけスワイプする必要があります。また、後で履行される商品のための金額を承認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-288">When the omni-channel tokenization feature is turned on, customers must swipe their card only one time to both pay the deposit and authorize the amount that is due for goods that will be fulfilled later.</span></span> <span data-ttu-id="94c8b-289">履行の時点で、認定されたファンドが取得されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-289">At the time of fulfillment, the authorized funds are captured.</span></span> <span data-ttu-id="94c8b-290">オムニ チャネルのトークン化機能が実装される前に、定期カードのトークンだけが次の注文のフルフィルメントのために作成されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-290">Before the omni-channel tokenization feature was implemented, only a recurring card token was created for subsequent order fulfillment.</span></span> <span data-ttu-id="94c8b-291">したがって、保留中のフルフィルメントの資金は承認されておらず、資金が特定の購買に対して保留中ではないため、後で回収できる可能性は低くなりました。</span><span class="sxs-lookup"><span data-stu-id="94c8b-291">Therefore, the funds for the pending fulfillment weren't authorized, and because those funds weren't being held for that specific purchase, it was less likely that they could be captured later.</span></span>

> [!NOTE]
> <span data-ttu-id="94c8b-292">シングル スワイプは、小売バージョン 8.1.3 でサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="94c8b-292">Single swipe isn't supported in Retail version 8.1.3.</span></span> <span data-ttu-id="94c8b-293">バージョン 8.1.3での顧客注文は、オムニ チャネルのトークン化機能が実装される前に使われたものと同じフローが使用されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-293">Customer orders in version 8.1.3 use the same flow that was used before the omni-channel tokenization feature was implemented.</span></span> 

### <a name="cards-that-cant-issue-recurring-card-tokens"></a><span data-ttu-id="94c8b-294">定期カード トークンを発行できないカード</span><span class="sxs-lookup"><span data-stu-id="94c8b-294">Cards that can't issue recurring card tokens</span></span>

<span data-ttu-id="94c8b-295">定期カード トークンの発行をサポートしていないので、一部のカードはオムニ チャネル支払に使用できません。</span><span class="sxs-lookup"><span data-stu-id="94c8b-295">Some cards can't be used for omni-channel payments, because they don't support issuing recurring card tokens.</span></span> <span data-ttu-id="94c8b-296">POS で注文が作成されるとき、定期カード トークンをサポートしていないカードを使用して預金が支払われた場合は、前のカードのトークン化フローが使用されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-296">When an order is created at the POS, if the deposit is paid by using a card that doesn't support recurring card tokens, the previous card tokenization flow is used.</span></span> <span data-ttu-id="94c8b-297">したがって、次の注文フルフィルメントで使用される支払を提供する顧客は、2 番目のカードを提示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-297">Therefore, a customer who wants to provide a payment that will be used for subsequent order fulfillment must present a second card.</span></span> <span data-ttu-id="94c8b-298">2 番目のカードが定期的なカード トークンをサポートしていない場合、トークン化のアクションが拒否され、レジ担当者は別のカードを提供するよう顧客に求めるメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-298">If the second card doesn't support recurring card tokens, the tokenization action will be declined, and the cashier will be prompted to ask the customer to provide a different card.</span></span> 

### <a name="using-a-different-card"></a><span data-ttu-id="94c8b-299">別のカードを使用</span><span class="sxs-lookup"><span data-stu-id="94c8b-299">Using a different card</span></span>

<span data-ttu-id="94c8b-300">注文受取の店舗に来る顧客には、別のカードを使用するためのオプションが用意されています。</span><span class="sxs-lookup"><span data-stu-id="94c8b-300">A customer who comes to the store for order pickup has the option to use a different card.</span></span> <span data-ttu-id="94c8b-301">受注受取時に、レジ担当者が **使用可能な支払方法の利用** プロンプトを受け取ると、顧客が同じカードを使用するかどうかをたずねることができます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-301">When the cashier receives the **Use available payment method** prompt at the time of order pickup, he or she can ask whether the customer wants to use the same card.</span></span> <span data-ttu-id="94c8b-302">注文の作成に使用されたカードを顧客が失い、別のカードを使用して注文の支払を行う場合は、レジ担当者が **別の支払方法を使用** に選択できます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-302">If the customer has lost the card that was used to create the order and wants to pay for the order by using a different card, the cashier can select **Use a different payment method**.</span></span> <span data-ttu-id="94c8b-303">顧客が同じ注文に対してより多くの品目を受取るため戻ってきた場合、元のカードの認証がまだ有効であれば、レジ担当者はそのカードを使用するかどうかを再度確認することができます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-303">If the customer comes back later to pick up more items for the same order, if the original card authorization is still valid, the cashier can again ask whether the customer wants to use that card.</span></span>

### <a name="invalid-authorizations"></a><span data-ttu-id="94c8b-304">無効な認証</span><span class="sxs-lookup"><span data-stu-id="94c8b-304">Invalid authorizations</span></span>

<span data-ttu-id="94c8b-305">注文の作成に使用されたカードが有効でなくなった場合、商品が受取に対して選択されたときは、支払キャプチャの要求が失敗します。</span><span class="sxs-lookup"><span data-stu-id="94c8b-305">If the card that was used to create an order is no longer valid, when products are selected for pickup, the payment capture request will fail.</span></span> <span data-ttu-id="94c8b-306">そして、POS 支払コネクタでは、同じカードの詳細を使用して、新しい承認とキャプチャを作成しようと試みます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-306">The POS payment connector will then try to create a new authorization and capture by using the same card details.</span></span> <span data-ttu-id="94c8b-307">新しい承認またはキャプチャに失敗した場合、レジ担当者は支払を処理できなかったことを通知されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-307">If the new authorization or capture fails, the cashier will be informed that the payment could not be processed.</span></span> <span data-ttu-id="94c8b-308">レジ担当者は、顧客から新しい支払を取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94c8b-308">The cashier must then get a new payment from the customer.</span></span> 

### <a name="multiple-available-payments"></a><span data-ttu-id="94c8b-309">複数の使用可能な支払</span><span class="sxs-lookup"><span data-stu-id="94c8b-309">Multiple available payments</span></span>

<span data-ttu-id="94c8b-310">複数の入金/支払方法および明細行がある注文が受取されると、まずレジ担当者に **利用可能な支払方法を使用** の確認メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-310">When an order that has multiple tenders and multiple lines is picked up, the cashier first receives the **Use available payment method** prompt.</span></span> <span data-ttu-id="94c8b-311">複数のカードがある場合、レジ担当者が **利用可能な支払方法を使用** 選択するとき、既存カードの支払/入金明細行は現在受取されている商品の残高が満たされるまでキャプチャされます。</span><span class="sxs-lookup"><span data-stu-id="94c8b-311">If there are multiple cards, when the cashier selects **Use available payment method**, existing card tender lines will be captured until the balance is met for the goods that are currently being picked up.</span></span> <span data-ttu-id="94c8b-312">レジ担当者には、受取する商品に使うカードを選択するためのオプションはありません。</span><span class="sxs-lookup"><span data-stu-id="94c8b-312">The cashier won't have the option to select the card that should be used for the goods that are being picked up.</span></span> 

## <a name="related-topics"></a><span data-ttu-id="94c8b-313">関連トピック</span><span class="sxs-lookup"><span data-stu-id="94c8b-313">Related topics</span></span>

- [<span data-ttu-id="94c8b-314">支払に関するよく寄せられる質問</span><span class="sxs-lookup"><span data-stu-id="94c8b-314">Payments FAQ</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/payments-retail)
- [<span data-ttu-id="94c8b-315">Adyen 向け Dynamics 365 Payment Connector</span><span class="sxs-lookup"><span data-stu-id="94c8b-315">Dynamics 365 Payment Connector for Adyen</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3)
- [<span data-ttu-id="94c8b-316">Dynamics 365 Commerce 評価環境で BOPIS を構成する</span><span class="sxs-lookup"><span data-stu-id="94c8b-316">Configure BOPIS in a Dynamics 365 Commerce evaluation environment</span></span>](https://docs.microsoft.com/dynamics365/commerce/cpe-bopis)

