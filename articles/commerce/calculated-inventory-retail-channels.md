---
title: 小売チャンネルの引当可能在庫数量の計算
description: このトピックでは、会社が Microsoft Dynamics 365 Commerce を使用して、オンラインおよび店舗チャネルの製品の見積済手持在庫を表示する方法について説明します。
author: hhainesms
ms.date: 04/23/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: hhaines
ms.search.validFrom: 2020-02-11
ms.dyn365.ops.version: Release 10.0.10
ms.openlocfilehash: 96a600279b7a90d6626d23ee8868de13e9dd0f14
ms.sourcegitcommit: dc4898aa32f381620c517bf89c7856e693563ace
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/17/2021
ms.locfileid: "6270888"
---
# <a name="calculate-inventory-availability-for-retail-channels"></a><span data-ttu-id="fd0d2-103">小売チャンネルの引当可能在庫数量の計算</span><span class="sxs-lookup"><span data-stu-id="fd0d2-103">Calculate inventory availability for retail channels</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="fd0d2-104">このトピックでは、会社が Microsoft Dynamics 365 Commerce を使用して、オンラインおよび店舗チャネルの製品の見積済手持在庫を表示する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-104">This topic describes how a company can use Microsoft Dynamics 365 Commerce to view estimated on-hand availability for products in the online and store channels.</span></span>

## <a name="accuracy-of-inventory-availability"></a><span data-ttu-id="fd0d2-105">引当可能在庫数量の正確性</span><span class="sxs-lookup"><span data-stu-id="fd0d2-105">Accuracy of inventory availability</span></span>

<span data-ttu-id="fd0d2-106">コマースでは、拡張性とパフォーマンスを確保するために複数のサーバーとデータベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-106">Commerce uses multiple servers and databases to ensure scalability and performance.</span></span> <span data-ttu-id="fd0d2-107">したがって、販売時点管理 (POS) アプリケーションによって提供される使用可能な在庫値、E コマースの在庫状態のアプリケーション プログラミング インターフェイス (API)、および手持在庫ページについて理解しておくことが重要です。Commerce 本社では、リアルタイムで 100 パーセントの正確性を達成できない場合があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-107">Therefore, it's important that you understand that the available inventory values that are provided through the point of sale (POS) application, the e-commerce inventory availability application programming interfaces (APIs), and the on-hand inventory pages in Commerce headquarters might not be 100 percent accurate in real time.</span></span> <span data-ttu-id="fd0d2-108">オンラインまたは店舗チャネルの製品に対して作成されたトランザクションが、本社と同期していない場合、本社の手持在庫ページには、これらの製品に対して正確なリアルタイム在庫値が表示されないことがあります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-108">If transactions that are created for products in the online or store channel haven't yet been synced to headquarters, the on-hand inventory pages in headquarters might not show an accurate real-time inventory value for those products.</span></span> <span data-ttu-id="fd0d2-109">逆に、本社または他の統合アプリケーションのユーザーが在庫から在庫を引き出したり、返品したり、その他の方法で調整できるように会社をコンフィギュレーションしている場合は、POS またはオンライン チャネルでは、品目に対して正確なリアルタイム値を示すために必要なすべての情報がない場合があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-109">Conversely, if you configured your company so that users in headquarters or other integrated applications can sell, receive, return, or otherwise adjust inventory out of a store or online warehouse, the POS or online channel might not have all the information that is required to show accurate real-time values for items.</span></span>

<span data-ttu-id="fd0d2-110">営業日に提供されている手持在庫データすべては予測値と見なされていることを理解しておくことは重要です。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-110">It's critical to understand that all on-hand availability data that is provided during the operational day is considered an estimated value.</span></span> <span data-ttu-id="fd0d2-111">したがって、アプリケーションが棚の実在庫によって提供する手持在庫情報を比較しようとした場合や、POS に表示されている手持在庫の値を同じ倉庫を見つける手持在庫の値と比較しようとした場合など、本社では値が異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-111">Therefore, if you try to compare the on-hand inventory information that the application provides with actual physical inventory on the shelves, or if you try to compare the on-hand values that are shown in POS with the on-hand data that you find for the same warehouse in headquarters, the values might differ.</span></span> <span data-ttu-id="fd0d2-112">営業日中のこの差異は予想されますが、問題とは限りません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-112">This difference during the operational day is expected and should not be considered an issue.</span></span> <span data-ttu-id="fd0d2-113">データを監査して、POS、API、および本社で提供されている値が、店舗または倉庫の棚にある実際の物理単位と一致していることを確認する場合、その最適なタイミングは、チャネルの操作がその日に停止し、すべてのトランザクションが本社とチャネル間で正しく同期された後です。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-113">If you want to audit data and make sure that the values provided in POS, APIs, and headquarters match the actual physical units that you find on your store or warehouse shelves, the best time to do it is after channel operations have stopped for the day and all transactions have been correctly synced between headquarters and the channels.</span></span>

## <a name="channel-side-inventory-calculation"></a><span data-ttu-id="fd0d2-114">チャネル側の在庫計算</span><span class="sxs-lookup"><span data-stu-id="fd0d2-114">Channel-side inventory calculation</span></span>

<span data-ttu-id="fd0d2-115">チャネル側の在庫計算は、ベースラインとしての Commerce 本社の最新のチャネル在庫データと、ほぼリアルタイムの手持在庫の見積を計算するためのベースラインに含まれていないチャネルで発生した追加の在庫変更の要素を取得するメカニズムです。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-115">The channel-side inventory calculation is a mechanism that takes the last-known channel inventory data in Commerce headquarters as a baseline, and then factors in additional inventory changes that occurred on the channel side that aren't included in that baseline to calculate a near-real-time estimated on-hand inventory.</span></span> 

<span data-ttu-id="fd0d2-116">現在、次の在庫変更はチャネル側の在庫計算ロジックで考慮されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-116">The following inventory changes are currently considered in the channel-side inventory calculation logic:</span></span>

- <span data-ttu-id="fd0d2-117">店舗の現金売りを通して販売された在庫</span><span class="sxs-lookup"><span data-stu-id="fd0d2-117">Inventory sold through cash-and-carry orders in store</span></span>
- <span data-ttu-id="fd0d2-118">店舗またはオンライン チャネルの顧客注文を通して販売された在庫</span><span class="sxs-lookup"><span data-stu-id="fd0d2-118">Inventory sold through customer orders in store or online channel</span></span>
- <span data-ttu-id="fd0d2-119">店舗に返品される在庫</span><span class="sxs-lookup"><span data-stu-id="fd0d2-119">Inventory returned to store</span></span>
- <span data-ttu-id="fd0d2-120">店舗倉庫からフルフィルメントされた在庫 (ピッキング、梱包、出荷)</span><span class="sxs-lookup"><span data-stu-id="fd0d2-120">Inventory fulfilled (pick, pack, ship) from store warehouse</span></span>

<span data-ttu-id="fd0d2-121">チャネル側の在庫計算を使用するには、前提条件として、**製品の使用可能性** ジョブによって作成された本社の在庫データのスナップショットを定期的にチャネル データベースに送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-121">To use the channel-side inventory calculation, as a prerequisite a periodic snapshot of inventory data from headquarters created by the **Product availability** job must be sent to the channel databases.</span></span> <span data-ttu-id="fd0d2-122">このスナップショットは、製品または製品バリアントと倉庫の特定の組み合わせについて、本社が在庫の有無に関して持っている情報を表します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-122">The snapshot represents the information that headquarters has about inventory availability for a specific combination of a product or product variant and a warehouse.</span></span> <span data-ttu-id="fd0d2-123">このトランザクションには、スナップショットの取得の時点で本社で処理および転記された在庫トランザクションだけが含まれるため、分散サーバー間で発生する定数的な販売プロセスにより、リアルタイムでは 100% 正確ではない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-123">It includes only the inventory transactions that were processed and posted in headquarters at the time when the snapshot was taken, and it might not be 100 percent accurate in real time because of the constant sales processing that occurs across distributed servers.</span></span>

- <span data-ttu-id="fd0d2-124">POS アプリケーションで現金払いまたは非同期の顧客注文販売を介して店舗にある製品の在庫が販売された場合、本社ではその販売に関連する在庫払出トランザクションに関する情報を直ちに取得することはありません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-124">If inventory was sold for a product in a store through a cash-and-carry or asynchronous customer order sale in the POS application, headquarters won't immediately have information about the related inventory issue transaction for the sale.</span></span> <span data-ttu-id="fd0d2-125">P-ジョブが関連するトランザクションを店舗のチャネル データベースから本社へアップロードした後になって、本社には店舗販売のタイプで販売されている在庫情報が含まれます。関連する販売注文は、明細転記またはトリクル フィード転記のプロセスを介して作成されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-125">Headquarters will have information about the inventory that is sold for these types of store sales only after the P-job uploads the related transaction from the store's channel database into headquarters and the related sales orders are created through statement posting or the trickle feed posting processes.</span></span> <span data-ttu-id="fd0d2-126">本社の注文を作成するプロセスによって、関連する在庫トランザクションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-126">The process of creating the orders in headquarters creates the related inventory transactions.</span></span> 
- <span data-ttu-id="fd0d2-127">E コマース チャネル注文では、トランザクションが P-ジョブを通じて本社に送信され、注文の同期処理が完了した後にのみ、在庫トランザクションに関する情報が含まれます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-127">For e-commerce channel orders, headquarters has information about the inventory transactions only after the transactions are sent to headquarters through the P-job and the order synchronization process is completed.</span></span>

<span data-ttu-id="fd0d2-128">Commerce 本社で在庫のスナップショットを行うには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-128">To take a snapshot of inventory in Commerce headquarters, follow these steps.</span></span>

1. <span data-ttu-id="fd0d2-129">**Retail とコマース \> Retail とコマース IT \> 製品と在庫 \> 製品の可用性** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-129">Go to **Retail and Commerce \> Retail and Commerce IT \> Products and inventory \> Product availability**.</span></span>
1. <span data-ttu-id="fd0d2-130">**OK** を選択し、**製品の可用性** ジョブを実行します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-130">Select **OK** to run the **Product availability** job.</span></span> <span data-ttu-id="fd0d2-131">バッチで実行されるように、このジョブをスケジュール設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-131">You can also schedule this job to run in batch.</span></span>

<span data-ttu-id="fd0d2-132">**製品の可用性** ジョブの実行が完了したら、取得したデータをチャネルのデータベースにプッシュして、最新の本社の在庫スナップショットを、見積済手持在庫のチャネル側計算で考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-132">After the **Product availability** job has finished running, the data that was captured must be pushed to the channel databases, so that the latest headquarters inventory snapshot can be considered in the channel-side calculation of estimated on-hand inventory.</span></span>

<span data-ttu-id="fd0d2-133">本社からチャネル データベースにスナップショット データを同期するには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-133">To sync snapshot data from headquarters to your channel databases, follow these steps.</span></span>

1. <span data-ttu-id="fd0d2-134">**Retail とコマース \> Retail とコマース IT \> 配送スケジュール** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-134">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="fd0d2-135">**1130** (**製品の可用性**) ジョブを実行し、**製品の可用性** ジョブによって本社からチャネル データベースに作成されたスナップショット データを同期します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-135">Run the **1130** (**Product availability**) job to sync the snapshot data that the **Product availability** job has created from headquarters to your channel databases.</span></span>

## <a name="inventory-availability-apis-for-e-commerce"></a><span data-ttu-id="fd0d2-136">E コマースの在庫可用性 API</span><span class="sxs-lookup"><span data-stu-id="fd0d2-136">Inventory availability APIs for e-commerce</span></span>

<span data-ttu-id="fd0d2-137">E コマースのシナリオにおいて製品の引当可能在庫数量のクエリを実行するために、Commerce は次の API を提供します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-137">Commerce provides the following APIs for e-commerce scenarios to query inventory availability of a product:</span></span>

- <span data-ttu-id="fd0d2-138">**GetEstimatedAvailability** – この API を使用して、オンライン チャネルの倉庫またはオンライン チャネルのフルフィルメント グループにリンクされている倉庫の製品または製品バリアントの在庫のクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-138">**GetEstimatedAvailability** – Use this API to query inventory for a product or product variant in the online channel warehouse or warehouses that are linked to the online channel's fulfillment group.</span></span>
- <span data-ttu-id="fd0d2-139">**GetEstimatedProductWarehouseAvailability** – 特定の倉庫からの製品または製品バリアントのクエリを実行するには、この API を使用してください。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-139">**GetEstimatedProductWarehouseAvailability** – Use this API to query inventory for a product or product variant from a specific warehouse.</span></span>

> [!NOTE]
> <span data-ttu-id="fd0d2-140">こららの API は、Commerce 10.0.7 およびそれ以前のリリースの **GetProductAvailabilities** と **GetAvailableInventoryNearby** API を置き換えます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-140">These APIs replace the **GetProductAvailabilities** and **GetAvailableInventoryNearby** APIs in Commerce release 10.0.7 and earlier.</span></span>

<span data-ttu-id="fd0d2-141">両方の API は内部的にチャネル側の計算ロジックを使用し、要求された製品と倉庫の **引当可能な現物** の見積数量、**利用可能な合計** 数量、**測定単位 (UoM)**、および **在庫レベル** を返します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-141">Both APIs internally use the channel-side calculation logic and return estimated **physical available** quantity, **total available** quantity, **unit of measure (UoM)**, and **inventory level** for the requested product and warehouse.</span></span> <span data-ttu-id="fd0d2-142">戻り値は、必要に応じて E コマース サイトに表示するか、または E コマース サイトで他のビジネス ロジックのトリガーとして使用することができます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-142">The returned values can be shown on your e-commerce site if you want, or they can be used to trigger other business logic on your e-commerce site.</span></span> <span data-ttu-id="fd0d2-143">たとえば、在庫レベルが「在庫切れ」である製品の購入を防止することができます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-143">For example, you can prevent the purchase of products with an "out of stock" inventory level.</span></span>

<span data-ttu-id="fd0d2-144">コマースで利用可能なその他の API が直接本社へアクセスし、製品の手持在庫数量をフェッチすることができでも、潜在的なパフォーマンスの問題と、これらの頻繁な要求が本社のサーバーに与える可能性のある影響のため、E コマースの環境で使用することはお勧めしません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-144">Although other APIs that are available in Commerce can go directly to headquarters to fetch on-hand quantities for products, we don't recommend that they be used in an e-commerce environment because of potential performance issues and the impact that these frequent requests can have on your headquarters servers.</span></span> <span data-ttu-id="fd0d2-145">また、チャネル側の計算を使用し、上記の 2 つの API は、本社にはまだ知らされていないチャネルで作成されたトランザクションを考慮に入れることにより、製品の可用性に関するより正確な見積を提供することができます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-145">Additionally, with channel-side calculation, the two APIs mentioned above can provide a more accurate estimate of a product's availability by taking into account the transactions created in the channels that aren’t yet known to headquarters.</span></span>

<span data-ttu-id="fd0d2-146">2 つの API を使用するには、本社の **機能の管理** ワークスペースを使用して、**最適化された製品在庫計算** 機能を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-146">To use the two APIs, you must enable the **Optimized product availability calculation** feature through the **Feature management** workspace in headquarters.</span></span> <span data-ttu-id="fd0d2-147">オンラインおよび店舗チャネルが同じフルフィルメント倉庫を使用する場合、店舗チャネルで作成された未転記のトランザクション (現金売り、顧客注文、返品) の要素に対する 2 つの API 内にチャネル側の計算ロジックが含まれるように、**E コマースのチャネル側在庫計算の拡張ロジック** 機能を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-147">If your online and store channels use the same fulfillment warehouses, you must also enable the **Enhanced e-Commerce channel-side inventory calculation logic** feature to have the channel-side calculation logic within the two APIs to factor in the unposted transactions (cash-and-carry, customer orders, returns) created in the store channel.</span></span> <span data-ttu-id="fd0d2-148">これらの機能を有効にした後、**1070** (**チャネル コンフィギュレーション**) ジョブを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-148">You will need to run the **1070** (**Channel configuration**) job after enabling these features.</span></span>

<span data-ttu-id="fd0d2-149">API の出力で製品数量を返す方法を定義するには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-149">To define how product quantity should be returned in the API output, follow these steps.</span></span>

1. <span data-ttu-id="fd0d2-150">**Retail と Commerce \> 本社の設定 \> パラメーター \> コマース パラメーター** の順にクリックします。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-150">Go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce parameters**.</span></span>
1. <span data-ttu-id="fd0d2-151">**在庫** タブを選択し、**E コマースの在庫可用性 API** クイックタブで、**数量の API 出力** 設定を構成します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-151">Select the **Inventory** tab, and then on the **Inventory availability APIs for e-Commerce** FastTab configure the value of the **Quantity in API output** setting.</span></span>
1. <span data-ttu-id="fd0d2-152">**1070** (**チャネル構成**) ジョブを実行し、チャネルに最新の設定を同期します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-152">Run the **1070** (**Channel configuration**) job to sync the latest setting to channels.</span></span>

<span data-ttu-id="fd0d2-153">**数量の API 出力** 設定には、3 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-153">The **Quantity in API output** setting provides three options:</span></span>

- <span data-ttu-id="fd0d2-154">**在庫数量を返す** - API の出力で、要求された製品の引当可能現物数と利用可能な合計数量を返します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-154">**Return inventory quantity** - Physical available and total available quantity of a requested product are returned in API output.</span></span>
- <span data-ttu-id="fd0d2-155">**在庫バッファーを差し引いた在庫数量を返す** - API 出力で返される数量は在庫バッファー値を差し引いて調整されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-155">**Return inventory quantity subtracting inventory buffer** - The quantity returned in the API output is adjusted by subtracting the inventory buffer value.</span></span> <span data-ttu-id="fd0d2-156">在庫バッファーの詳細については、[在庫バッファーと在庫レベルのコンフィギュレーション](inventory-buffers-levels.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-156">For more information about the inventory buffer, see [Configure inventory buffers and inventory levels](inventory-buffers-levels.md).</span></span>
- <span data-ttu-id="fd0d2-157">**在庫数量は返さない** - 在庫レベルだけが API 出力で返されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-157">**Not return inventory quantity** - Only the inventory level is returned in the API output.</span></span> <span data-ttu-id="fd0d2-158">在庫レベルの詳細については、[在庫バッファーと在庫レベルのコンフィギュレーション](inventory-buffers-levels.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-158">For more information about inventory levels, see [Configure inventory buffers and inventory levels](inventory-buffers-levels.md).</span></span>

<span data-ttu-id="fd0d2-159">`QuantityUnitTypeValue` API パラメーターを使用して、API で数量を返す単位のタイプを指定できます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-159">You can use the `QuantityUnitTypeValue` API parameter to specify the unit type in which you would like the APIs to return quantity.</span></span> <span data-ttu-id="fd0d2-160">このパラメーターは、**在庫単位** (既定)、**購入単位**、および **販売単位** のオプションをサポートします。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-160">This parameter supports the **inventory unit** (default), **purchase unit**, and **sell unit** options.</span></span> <span data-ttu-id="fd0d2-161">返品数量は、本社で定義された対応する測定単位 (UOM) の精度に丸められます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-161">The returned quantity is rounded to the defined precision of the corresponding unit of measure (UOM) in headquarters.</span></span>

<span data-ttu-id="fd0d2-162">**GetEstimatedAvailability** API は、さまざまなクエリ シナリオをサポートするために次の入力パラメーターを提供します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-162">The **GetEstimatedAvailability** API offers the following input parameters to support different query scenarios:</span></span>

- <span data-ttu-id="fd0d2-163">`DefaultWarehouseOnly` - このパラメーターを使用して、オンライン チャネルの既定の倉庫にある製品の在庫のクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-163">`DefaultWarehouseOnly` - Use this parameter to query inventory for a product in the online channel's default warehouse.</span></span> 
- <span data-ttu-id="fd0d2-164">`FilterByChannelFulfillmentGroup` および `SearchArea` - これら 2 つのパラメーターを使用し、`longitude`、`latitude`、および `radius` に基づいて、特定の検索領域内でのすべての集荷場所から製品在庫のクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-164">`FilterByChannelFulfillmentGroup` and `SearchArea` - Use these two parameters to query inventory for a product from all pickup locations within a specific search area, based on `longitude`, `latitude`, and `radius`.</span></span> 
- <span data-ttu-id="fd0d2-165">`FilterByChannelFulfillmentGroup` および `DeliveryModeTypeFilterValue` - これら 2 つのパラメーターを使用し、オンライン チャネルのフルフィルメント グループにリンクされ、指定された配送モードをサポートするよう構成されている特定の倉庫から製品在庫のクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-165">`FilterByChannelFulfillmentGroup` and `DeliveryModeTypeFilterValue` - Use these two parameters to query inventory for a product from specific warehouses that are linked to an online channel's fulfillment group and are configured to support certain modes of delivery.</span></span> <span data-ttu-id="fd0d2-166">`DeliveryModeTypeFilterValue` パラメーターは、**すべて** (既定)、**出荷**、および **集荷** のオプションをサポートします。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-166">The `DeliveryModeTypeFilterValue` parameter supports the **all** (default), **shipping**, and **pickup** options.</span></span> <span data-ttu-id="fd0d2-167">たとえば、オンライン注文が複数の出荷倉庫からフルフィルメントされる場合、これら 2 つのパラメーターを使用して、すべての出荷倉庫における製品の引当可能在庫数量のクエリを実行できます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-167">For example, in a scenario where an online order can be fulfilled from multiple shipping warehouses, you can use these two parameters to query a product's inventory availability in all of those shipping warehouses.</span></span> <span data-ttu-id="fd0d2-168">この場合、API は、出荷倉庫の製品の手持数量と在庫レベルに加えて、クエリ スコープ内のすべての出荷倉庫からの集計数量と集計在庫レベルを返します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-168">The API in this case returns the product's on-hand quantity and inventory level in each of the shipping warehouses, plus an aggregated quantity and an aggregated inventory level from all shipping warehouses in the query scope.</span></span>
 
<span data-ttu-id="fd0d2-169">Commerce の購入ボックス、店舗セレクター、欲しい物リスト、買い物カゴ、および買い物カゴ アイコン モジュールは、上記の API とパラメーターを使用して、E コマース サイト間の在庫レベル メッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-169">The Commerce buy box, store selector, wishlist, cart, and cart icon modules consume the APIs and parameters mentioned above to display inventory level messages across the e-commerce site.</span></span> <span data-ttu-id="fd0d2-170">Commerce のサイト ビルダーは、販売促進と購入の動作を制御するためにさまざまな在庫設定を提供します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-170">Commerce site builder provides various inventory settings to control merchandising and purchase behavior.</span></span> <span data-ttu-id="fd0d2-171">詳細については、[在庫設定を適用する](inventory-settings.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-171">For more information, see [Apply inventory settings](inventory-settings.md).</span></span>

## <a name="pos-inventory-lookup-with-channel-side-calculation"></a><span data-ttu-id="fd0d2-172">チャネル側の計算を使用した POS 在庫検索</span><span class="sxs-lookup"><span data-stu-id="fd0d2-172">POS inventory lookup with channel-side calculation</span></span>

<span data-ttu-id="fd0d2-173">リリース 10.0.9 およびそれ以前の Commerce では、本社に対するリアル タイム サービスで使用される POS の **在庫検索** 操作が、店舗のチャネル コンフィギュレーションの一部としてフルフィルメント グループ用に構成されているユーザーの現店舗と他の店舗の両方で選択された製品の在庫情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-173">In the Commerce release 10.0.9 and earlier, the **Inventory lookup** operation in POS used a real-time service call to headquarters to get inventory information for the selected product for both the user's current store and any other stores that are configured for the fulfillment group as part of the channel configuration for the store.</span></span> <span data-ttu-id="fd0d2-174">Commerce のリリース 10.0.10 およびそれ以降では、本社へのリアルタイムのサービス呼び出しをオフにし、代わりに Commerce サーバー上でのチャネル側計算を使用して、店舗およびフルフィルメント グループで定義されている他の全ての場所において物理的に使用可能な手持在庫を決定することができます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-174">In Commerce release 10.0.10 and later, you can turn off real-time service calls to headquarters and instead use channel-side calculation on the Commerce server to determine the on-hand inventory that is physically available for the store and any other locations that are defined in the fulfillment group.</span></span> <span data-ttu-id="fd0d2-175">また、このチャネル計算による在庫構成は、オンラインでなくても本社から在庫検索を取得する必要がないため、インターネット接続が不安定な場所でも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-175">This channel-calculated inventory configuration is also useful for locations where internet connectivity is unreliable, because you don't have to be online to get inventory lookups headquarters.</span></span>

<span data-ttu-id="fd0d2-176">チャネル側の計算が正しく構成および管理されている場合は、コマースのサーバー データベースにあるトランザクション データを使用しているが、まだ本社に含まれていない情報の可能性があるため、現在の店舗在庫より信頼性の高い見積もりを提供できます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-176">When channel-side calculation is correctly configured and managed, it can provide a more reliable estimate of the current store inventory because it uses the transactional data that is in the Commerce channel database but that headquarters might not yet have information about.</span></span> <span data-ttu-id="fd0d2-177">たとえば、POS の在庫検索に既存のリアルタイム サービス コールを使用している場合、本社では製品に対してのみ発生した現金店頭払いの売上に関する情報がまだ得られていない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-177">For example, if you use the existing real-time service call for inventory lookups in POS, headquarters probably won't yet have information about a cash-and-carry sale that just occurred for a product.</span></span> <span data-ttu-id="fd0d2-178">したがって、本社がその製品に対して返す手持在庫値は、おそらく店舗の実手持在庫を 1 ユニット上回る可能性があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-178">Therefore, the on-hand inventory value that headquarters returns for that product will probably exceed the store's actual on-hand inventory by one unit.</span></span> <span data-ttu-id="fd0d2-179">ただし、チャネル側計算を使用する場合は、現金店頭払い売上を計算に含めることができ、表示される手持在庫値から差し引かれます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-179">However, if you use channel-side calculation, the cash-and-carry sale can be factored into the calculation and deducted from the on-hand value that is shown.</span></span> <span data-ttu-id="fd0d2-180">チャネル側計算とリアルタイムのサービス コールの両方が提供する値は手持在庫の推定値のみでも、チャネル計算によって提供される値は現店舗に対して正確である可能性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-180">Although the values that both the channel-side calculation and the real-time service call provide are only estimates of on-hand inventory, the value that the channel-side calculation provides is much more likely to be accurate for the current store.</span></span>

<span data-ttu-id="fd0d2-181">本社で POS の **在庫検索** 操作を構成して、チャネル側の計算ロジックを使用してリアルタイム サービス呼び出しをオフにするには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-181">To configure the POS **Inventory lookup** operation in headquarters to use the channel-side calculation logic and turn off real-time service call, follow these steps.</span></span>

1. <span data-ttu-id="fd0d2-182">**Retail とコマース \> チャネル設定 \> POS 設定 \> POS プロファイル \> 機能プロファイル** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-182">Go to **Retail and Commerce \> Channel setup \> POS setup \> POS profiles \> Functionality profiles**.</span></span>
1. <span data-ttu-id="fd0d2-183">機能プロファイルを選択します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-183">Select a functionality profile.</span></span>
1. <span data-ttu-id="fd0d2-184">**機能** クイックタブの **在庫の利用可能性の計算** セクションで、**在庫の利用可能性の計算モード** の値を **リアルタイム サービス** から **チャネル** に変更します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-184">On the **Functions** FastTab, in the **Inventory availability calculation** section, change the value of **Inventory availability calculation mode** from **Real time service** to **Channel**.</span></span> <span data-ttu-id="fd0d2-185">既定では、すべての機能プロファイルでリアルタイム サービス コールが使用されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-185">By default, all functionality profiles use real-time service calls.</span></span> <span data-ttu-id="fd0d2-186">チャネル側の計算ロジックを使用する場合、このフィールドの値を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-186">You must change the value of this field if you want to use channel-side calculation logic.</span></span> <span data-ttu-id="fd0d2-187">選択した機能プロファイルにリンクされているすべての小売用店舗は、この変更によって影響を受けます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-187">Every retail store that is linked to the selected functionality profile will be affected by this change.</span></span>

<span data-ttu-id="fd0d2-188">続いて、以下のこれらの手順を実行して、本社の配送スケジュール プロセスを介してチャネルに変更を同期させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-188">You must then sync the changes to the channels through the distribution schedule process in headquarters by following these steps.</span></span>

1. <span data-ttu-id="fd0d2-189">**Retail とコマース \> Retail とコマース IT \> 配送スケジュール** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-189">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="fd0d2-190">**1070** (**チャネル コンフィギュレーション**) ジョブを実行します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-190">Run the **1070** (**Channel configuration**) job.</span></span>

<span data-ttu-id="fd0d2-191">コンフィギュレーションが完了した後、POS アプリケーションのユーザーが **在庫検索** 工程 (標準およびマトリックス ビュー) を使用する場合、物理的に利用できる在庫についての情報は、リアルタイム サービス コールを使用しなくなります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-191">After the configuration is completed, the information that is provided about physically available inventory no longer uses a real-time service call when a user in the POS application uses the **Inventory lookup** operation (standard and matrix views).</span></span> <span data-ttu-id="fd0d2-192">代わりに、現店舗の現物在庫とフルフィルメント グループのすべての店舗に関するデータが、コマース本社からチャネル データベースに配信された最新の既知のスナップショットに基づいて計算されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-192">Instead, data about physically available inventory for the current store and all the stores in the fulfillment group is calculated based on the last-known snapshot that was delivered to the channel database from Commerce Headquarters.</span></span> <span data-ttu-id="fd0d2-193">1130 ジョブから最後の同期スナップショットに含まれなかったチャネル データベースで選択した製品に存在する追加の売上または返品トランザクションを基に、スナップショットの値はチャネル計算によってさらに絞り込み、物理的に利用可能な値を調整することができます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-193">The snapshot value is further refined by the channel-side calculation to adjust the physically available value, based on additional sales or return transactions that exist for the selected product in the channel database that were not included in the last synchronized snapshot from the 1130 job.</span></span> <span data-ttu-id="fd0d2-194">チャネル データベースがフルフィルメント グループのいずれかの倉庫または店舗のトランザクション データを含まない場合、値の再計算に因数分解できる追加のトランザクションを含みません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-194">If the channel database doesn't contain transactional data for any of the warehouses or stores in the fulfillment group, it contains no additional transactions that can be factored into a recalculation of the value.</span></span> <span data-ttu-id="fd0d2-195">したがって、これらの倉庫または店舗に対して表示できる最適な手持在庫の見積は、最新のコマース本社スナップショットからのデータです。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-195">Therefore, the best estimate of on-hand inventory that can be shown for those warehouses or stores is the data from the last-known Commerce Headquarters snapshot.</span></span>

<span data-ttu-id="fd0d2-196">POS の **注文フルフィルメント** スクリーンでは、注文フルフィルメント行が選択されユーザーが選択した品目の手持在庫の **詳細** パネルを表示する際に、品目の手持在庫を表示するためにチャネル側計算も活用されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-196">The **Order fulfillment** screens of POS also leverage the channel side calculation to show on-hand inventory for items when an order fulfillment line is selected and a user views the **Details** panel for on-hand inventory for the selected item.</span></span>

## <a name="optimize-your-inventory-data"></a><span data-ttu-id="fd0d2-197">在庫データの最適化</span><span class="sxs-lookup"><span data-stu-id="fd0d2-197">Optimize your inventory data</span></span>

<span data-ttu-id="fd0d2-198">在庫の最適予測を保証するには、次のコマース バッチジョブを使用し、それらを頻繁に実行することが重要です。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-198">To ensure the best possible estimate of inventory, it's critical that you use the following Commerce batch jobs and run them frequently:</span></span>

- <span data-ttu-id="fd0d2-199">**P- ジョブ** – P- ジョブは **配送スケジュール** ページで検出され、頻繁に実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-199">**P-job** – The P-job is found on the **Distribution schedules** page and should be run frequently.</span></span> <span data-ttu-id="fd0d2-200">このジョブでは、E コマース注文、POS で作成された非同期の顧客注文、およびチャネル データベースからコマース本社に作成された現金店頭払い注文を取得し、それらをさらに処理できるようにします。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-200">This job brings e-Commerce orders, asynchronous customer orders that POS created, and cash-and-carry orders that POS created from the channel databases into Commerce Headquarters, so that they can be processed further.</span></span> <span data-ttu-id="fd0d2-201">このデータがコマース本社へチャネルから同期されるまで、コマース本社ではこれらのトランザクションによって発生した倉庫内の製品に対する在庫調整についての情報がありません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-201">Until this data is synced from the channel to Commerce Headquarters, Commerce Headquarters has no information about inventory adjustments to products in the warehouses that result from those transactions.</span></span>
- <span data-ttu-id="fd0d2-202">**注文の同期** – このジョブでは、P- ジョブが E コマースと非同期な顧客注文トランザクションを提供およびコマース本社の販売注文に変換するようコマース本社の非加工トランザクション データを処理します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-202">**Synchronize orders** – This job processes the raw transactional data in Commerce Headquarters that the P-job provides and converts e-Commerce and asynchronous customer order transactions into sales orders in Commerce Headquarters.</span></span> <span data-ttu-id="fd0d2-203">このジョブが処理および販売注文が作成されるまで、在庫トランザクションは作成されません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-203">Until this job is processed and the sales orders are created, no inventory transactions are created.</span></span> <span data-ttu-id="fd0d2-204">したがって、コマース本社の手持在庫についてはトランザクションが考慮されません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-204">Therefore, on-hand inventory in Commerce Headquarters won't consider the transactions.</span></span>
- <span data-ttu-id="fd0d2-205">**バッチのトランザクション明細書の計算** – 店舗で作成された現金店頭払いのトランザクションについては、トリクル フィード転記のプロセスにより、売上に関する在庫が確実に更新されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-205">**Calculate transactional statements in batch** – For cash-and-carry transactions that are created in the store, the trickle feed posting process ensures that inventory that is related to the sales is updated efficiently.</span></span> <span data-ttu-id="fd0d2-206">現金店頭払い注文の在庫トランザクションを最も効率的に処理するには、[トリクル フィード転記](./trickle-feed.md) を使用してシステムを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-206">To get the most efficient processing of inventory transactions for cash-and-carry orders, make sure that you configure your system to use [trickle feed posting](./trickle-feed.md).</span></span>
- <span data-ttu-id="fd0d2-207">**バッチのトランザクション明細書を転記** – このジョブは、トリクル フィード転記にも必要です。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-207">**Post transactional statements in batch** – This job is also required for trickle feed posting.</span></span> <span data-ttu-id="fd0d2-208">**バッチのトランザクション明細書の計算** ジョブに従います。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-208">It follows the **Calculate transactional statements in batch** job.</span></span> <span data-ttu-id="fd0d2-209">このジョブでは、計算された明細書が系統的に転記されるので、現金店頭払い売上の販売注文がコマース本社で作成され、店舗の在庫が正確に反映されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-209">This job systematically posts the calculated statements, so that sales orders for cash-and-carry sales are created in Commerce Headquarters and Commerce Headquarters more accurately reflects your store's inventory.</span></span>
- <span data-ttu-id="fd0d2-210">**製品の可用性** – このジョブでは、コマース本社からの在庫のスナップショットが作成されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-210">**Product availability** – This job creates the snapshot of inventory from Commerce Headquarters.</span></span>
- <span data-ttu-id="fd0d2-211">**1130 (製品の可用性)** – このジョブは **配送スケジュール** ページにあり、**製品の可用性** ジョブの直後に実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-211">**1130 (Product availability)** – This job is found on the **Distribution schedules** page and should be run immediately after the **Product availability** job.</span></span> <span data-ttu-id="fd0d2-212">このジョブでは、コマース本社からチャネル データベースに対して、在庫スナップショット データを転送します。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-212">This job transports the inventory snapshot data from Commerce Headquarters to the channel databases.</span></span>

> [!NOTE]
> - <span data-ttu-id="fd0d2-213">**製品の可用性** と **1130** のジョブを毎時ごとに実行し、P-ジョブのスケジュール、注文の同期、およびトリクル フィードの転記関連ジョブを同じまたはそれ以上の頻度で実行することがベスト プラクティスです。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-213">It is a best practice to run the **Product availability** and **1130** jobs on an hourly basis, and to schedule P-job, synchronize orders, and trickle feed posting-related jobs with the same or higher frequency.</span></span>
> - <span data-ttu-id="fd0d2-214">パフォーマンス上の理由から、チャネル側在庫の可用性計算が E コマース API または POS チャネル側の在庫ロジックを使用して、在庫の可用性依頼を作成するために使用される際、計算によって再度計算ロジックの実行が正当化するのに十分な時間が経過したかどうか特定するためのキャッシュが使用されます。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-214">For performance reasons, when channel-side inventory availability calculations are used to make an inventory availability request using the e-Commerce API's or the POS channel-side inventory logic, the calculation uses a cache to determine whether enough time has passed to justify running the calculation logic again.</span></span> <span data-ttu-id="fd0d2-215">既定のキャッシュは 60 秒に設定されています。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-215">The default cache is set to 60 seconds.</span></span> <span data-ttu-id="fd0d2-216">たとえば、店舗のチャネル側計算を有効にして、**在庫検索** ページで製品の手持在庫を表示しているとします。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-216">For example, you turned on channel-side calculation for your store and viewed the on-hand inventory for a product on the **Inventory lookup** page.</span></span> <span data-ttu-id="fd0d2-217">その後、製品の 1 つのユニットが販売された場合、**在庫検索** ページではキャッシュがクリアーされるまで、在庫の減少が示されません。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-217">If one unit of the product is then sold, the **Inventory lookup** page won't show the reduced inventory until the cache has been cleared.</span></span> <span data-ttu-id="fd0d2-218">POS でトランザクションを転記した後、手持在庫が削減されたことを確認する前に、60 秒待機する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-218">After users post transactions in POS, they should wait 60 seconds before they verify that the on-hand inventory has been reduced.</span></span>

<span data-ttu-id="fd0d2-219">ビジネス シナリオが短いキャッシュ時間を要求する場合、製品サポート担当者に問い合わせてください。</span><span class="sxs-lookup"><span data-stu-id="fd0d2-219">If your business scenario requires a smaller cache time, contact your product support representative for assistance.</span></span>


[!INCLUDE[footer-include](../includes/footer-banner.md)]
