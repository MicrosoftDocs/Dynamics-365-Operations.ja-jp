---
title: 小売チャネルの引当可能在庫数量の計算
description: このトピックでは、店舗およびオンライン チャネルの手持在庫を表示するために使用できるオプションについて説明します。
author: hhainesms
manager: annbe
ms.date: 08/13/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-commerce
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.search.scope: Retail, Core, Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: hhainesms
ms.search.validFrom: 2020-02-11
ms.dyn365.ops.version: Release 10.0.10
ms.openlocfilehash: 6d25a426268ebfb6990eb3dadb1ad451f86f59a1
ms.sourcegitcommit: 65a8681c46a1d99e7ff712094f472d5612455ff0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/13/2020
ms.locfileid: "3694925"
---
# <a name="calculate-inventory-availability-for-retail-channels"></a>小売チャネルの引当可能在庫数量の計算

[!include [banner](../includes/banner.md)]

このトピックでは、会社が Microsoft Dynamics 365 Commerce を使用して、オンラインおよび店舗チャネルの製品の見積済手持在庫を表示する方法について説明します。

## <a name="accuracy-of-calculation"></a>計算精度

コマースでは、拡張性とパフォーマンスを確保するために複数のサーバーとデータベースを使用します。 したがって、販売時点管理 (POS) アプリケーションによって提供される使用可能な在庫値、E コマースの在庫状態のアプリケーション プログラミング インターフェイス (APIs)、および手持在庫ページについて理解しておくことが重要です。コマース本社では、リアルタイムで 100 パーセント の正確性を達成できない場合があります。 オンラインまたは店舗チャネルの製品に対して作成されたトランザクションが、コマース本社のサーバーおよびデータベースと同期していない場合、コマース本社の手持在庫ページには、これらの製品に対して正確なリアルタイム在庫値が表示されないことがあります。 逆に、コマース本社または他の統合アプリケーションのユーザーが在庫から在庫を引き出したり、返品したり、その他の方法で調整できるように会社をコンフィギュレーションしている場合は、POS またはオンライン チャネルでは、品目に対して正確なリアルタイム手持在庫値を示すために必要なすべての情報がない場合があります。

このトピックでは、アプリケーションまたはチャネル間のデータの遅延を制限するために頻繁に実行される可能性のあるデータ同期プロセスについて説明します。 ただし、営業日に提供されているすべての手持在庫が、予測される価値であると考えていることを理解しておくことが重要です。 したがって、アプリケーションが棚の実在庫によって提供する手持在庫情報を比較しようとした場合や、POS に表示されている手持在庫の値を同じ倉庫を見つける手持在庫の値と比較しようとした場合など、コマース本社では値が異なる場合があります。 営業日中のこの差異は予想されますが、問題とは限りません。 データを監査して、在庫の可用性 APIs およびコマース本社で提供されている値が、店舗または倉庫の棚にある実際の物理単位と一致していることを確認する場合は、チャネルの操作がその日に停止し、すべてのトランザクションがコマース本社とチャネル間で正しく同期された後に行うのが最適な時期です。

## <a name="use-inventory-lookup-apis-for-e-commerce-inventory-availability-requests"></a>E コマースの在庫入手の要求のため在庫検索 APIs を使用

顧客が E コマース サイトでショッピングをしている場合は、次の APIs 使用して製品の在庫状態を示すことができます。

- **GetEstimatedAvailability** – E コマース チャネルのフルフィルメント グループのコンフィギュレーションにリンクされた E コマースの倉庫または全ての倉庫の品目の在庫状態を取得するには、この API を使用してください。 この API は、経度および緯度のデータに基づいて、特定の検索領域または半径における倉庫に使用することもできます。
- **GetEstimatedProductWarehouseAvailability** – 特定の倉庫からの品目の在庫を要求するには、この API を使用してください。 たとえば、注文の集荷を伴うシナリオで、在庫状態を表示するために使用できます。

> [!NOTE]
> こららの APIs は、Dynamics 365 Retail バージョン 10.0.7 およびそれ以前のバージョンの **GetProductAvailabilities** と **GetAvailableInventoryNearby** APIs を置き換えます。

両方の APIs はコマースのサーバーからデータをフェッチし、製品または製品バリアントの特定の組み合わせと倉庫の手持在庫の見積を提供します。 コマースのサーバー上で利用可能な他の APIs が直接コマース本社へ移動し製品の手持在庫数量をフェッチすることができでも、潜在的なパフォーマンスの問題と、これらの頻繁なリクエストがコマース本社のサーバーに与える可能性のある関連する影響のため、E コマースの環境で使用することはお勧めしません。 さらに、手持在庫がコマースのサーバーを通じて計算される場合は、コマース本社にまだ同期されていない最近の E コマース トランザクションで販売された在庫が計算に含まれる可能性が高くなります。 コマース本社では、これらのトランザクションに関する情報がない場合もありますが、コマースのサーバーとチャネル データベースではデータがあります。 したがって、データはに反映され、製品の使用可能な在庫の正確な見積を提供するのに役立ちます。

### <a name="get-started-with-e-commerce-calculated-inventory-availability"></a>E コマースで計算された在庫利用可能性について開始

前述の 2 つの API を使用する前に、Commerce Headquarters の **機能の管理** ワークスペースを使用して、**最適化された製品在庫計算** 機能を有効にする必要があり ます。

APIs では、ある品目に対する最適な在庫利用可能量を計算する前に、コマース本社からの在庫利用可能性の定期スナップショットを処理し、E コマースの Commerce Scale Unit で使用するチャネル データベースに送信する必要があります。 このスナップショットは、製品または製品バリアントと倉庫の特定の組み合わせについて、コマース本社が在庫の有無に関して持っている情報を表します。 在庫入庫によって発生する在庫調整や移動、またはコマース本社で実行される出荷などのプロセスによって、また E コマース チャネルが同期プロセスのためにのみ情報を保持することができます。

**製品の可用性**ジョブで作成されるデータベース スナップショットは、スナップショットが取得された時点で、コマース本社にて処理および転記された在庫トランザクションのみ計算されます。 POS アプリケーションで現金払いまたは非同期の顧客注文販売を介して店舗倉庫の製品の在庫が販売された場合、コマース本社ではその販売に関連する在庫払出トランザクションに関する情報を直ちに取得することはありません。 P- ジョブが関連するトランザクションを店舗のチャネル データベースからコマース本社へアップロードした後、店舗販売のみのタイプで販売されている在庫情報が含まれます。関連する販売注文は、明細転記またはトリクル フィード転記のプロセスを介して作成されます。 コマース本社の注文を作成するプロセスによって、関連する在庫トランザクションが作成されます。 E コマース チャネル注文では、トランザクションが P- ジョブを通じてコマース本社に送信され、注文の同期処理が完了した後にのみ、在庫トランザクションに関する情報が含まれます。 したがって、**製品の可用性**ジョブで提供されている在庫のスナップショット値が、分散サーバー間で発生する定数的な販売プロセスのため、リアルタイムに 100 パーセント正確ではないことを理解しておくことが重要です。

コマース本社で在庫のスナップショットを行うには、次の手順を実行します。

1. **Retail とコマース \> Retail とコマース IT \> 製品と在庫 \> 製品の可用性**の順に移動します。
1. **OK** を選択し、**製品の可用性**ジョブを実行します。 バッチで実行されるように、このジョブをスケジュール設定することもできます。

**製品の可用性**ジョブの実行が完了したら、取得したデータを E コマースのデータベースにプッシュして、最新のコマース本社の在庫スナップショットを、見積済手持在庫の計算に考慮する必要があります。

1. **Retail とコマース \> Retail とコマース IT \> 配送スケジュール**の順に移動します。
1. **1130** (**製品の可用性**) ジョブを実行し、**製品の可用性**ジョブによってコマース本社からチャネル データベースに作成されたスナップショット データを同期します。

在庫状態が **GetEstimatedAvailability** または **GetEstimatedProductWarehouseAvailability** API から依頼されると、計算が実行され、製品在庫の可能な限り最良の見積を取得しようとします。 この計算は、チャンネル データベースに含まれている E コマースの顧客注文を参照しますが、1130 ジョブによって提供されたスナップショット データには含まれていませんでした。 このロジックは、コマース本社から最後に処理された在庫トランザクションを追跡して、それをチャネル データベース内のトランザクションと比較することによって実行されます。 これは、チャネル側の計算ロジックのベースラインを提供します。これにより、E コマースのチャネル データベースの顧客注文販売トランザクションで発生した追加の在庫移動を、API によって予測される在庫値として考慮することができます。

チャネル側の計算ロジックによって、指定された製品と倉庫の予想される物理的な利用可能値と合計値が戻されます。 この値は、必要に応じて E コマース サイトに表示するか、または E コマース サイトで他のビジネス ロジックのトリガーとして使用することができます。 たとえば、API によって渡された実際の手持在庫数量の代わりに、「在庫切れ」メッセージを表示することができます。

推定在庫値のチャネル側 E コマース APIs が、チャネル データベースで作成されたがまだコマース本社に同期および転記されていない顧客注文のみに基づく在庫を評価できます。 チャネル データベースに店舗固有の倉庫のトランザクション データも含まれている場合、その現金店頭払いの売上は、それらの倉庫のチャネル側の E コマースの計算に考慮されません。

## <a name="configure-the-inventory-lookup-operation-in-the-pos-channel"></a>POS チャネルでの在庫検索操作のコンフィギュレーション

Retail バージョン 10.0.9 では、リアル タイム サービスで使用される POS から**在庫検索**オペレーションがコマース本社を呼び出し、店舗のチャネル コンフィギュレーションの一部としてフルフィルメント グループ用に構成されているユーザーの現店舗と他の店舗の両方で選択された製品の在庫情報を取得します。 コマース バージョン 10.0.10 以降では、コマース本社へのリアルタイムのサービス呼び出しを無効にすることができます。 代わりに、コマースのサーバーでチャネル側計算を使用し、店舗で物理的に利用可能な手持在庫とフルフィルメント グループに定義されているその他の場所を特定できます。 また、このチャネル計算による在庫構成は、オンラインでなくてもコマース本社から在庫検索を取得する必要がないため、インターネット接続が不安定な場所でも役立ちます。

チャネル側の計算が正しく構成および管理されている場合は、コマースのサーバー データベースにあるトランザクション データを使用しているが、まだコマース本社に含まれていない情報の可能性があるため、現在の店舗在庫より信頼性の高い見積もりを提供できます。 たとえば、POS の在庫検索に既存のリアルタイム サービス コールを使用している場合、コマース本社では製品に対してのみ発生した現金店頭払いの売上に関する情報がまだ得られていない可能性があります。 したがって、コマース本社がその製品に対して返す手持在庫値は、おそらく店舗の実手持在庫を 1 ユニット上回る可能性があります。 ただし、チャネル側計算を使用する場合は、現金店頭払い売上を計算に含めることができ、表示される手持在庫値から差し引かれます。 チャネル側計算とリアルタイムのサービス コールの両方が提供する値は手持在庫の推定値のみでも、チャネル計算によって提供される値は現店舗に対して正確である可能性が高くなります。

### <a name="get-started-with-pos-channel-side-calculated-inventory-availability"></a>POS チャネル側で計算された在庫利用可能性について開始

チャンネルの計算ロジックを使用し、POS アプリケーションからの在庫検索用リアルタイム サービス呼び出しを無効化するには、まず、 Commerce Headquarters の **機能の管理** ワークスペースを使用して、**最適化された製品在庫計算** 機能を有効にする必要があります。 機能を有効にするには、**機能プロファイル**に変更を加える必要があります。

**機能プロファイル**を作成するには、次の手順に従います。

1. **Retail とコマース \> チャネル設定 \> POS 設定 \> POS プロファイル \> 機能プロファイル**の順に移動します。
1. 機能プロファイルを選択します。
1. **機能**クイックタブの**在庫の利用可能性の計算**セクションで、**在庫の利用可能性の計算モード**フィールドの値を**リアル タイム サービス**から**チャネル**に変更します。 既定では、すべての機能プロファイルでリアルタイム サービス コールが使用されます。 したがって、チャネル側計算ロジックを使用する場合は、このフィールドの値を変更する必要があります。 選択した機能プロファイルにリンクされているすべての小売用店舗は、この変更によって影響を受けます。

続いて、以下の手順を実行して、配送スケジュール プロセスを介してチャネルに変更を同期させる必要があります。

1. **Retail とコマース \> Retail とコマース IT \> 配送スケジュール**の順に移動します。
1. **1070** (**チャネル コンフィギュレーション**) ジョブを実行します。

コンフィギュレーションが完了した後、POS アプリケーションのユーザーが**在庫検索**工程 (標準およびマトリックス ビュー) を使用する場合、物理的に利用できる在庫についての情報は、リアルタイム サービス コールを使用しなくなります。 代わりに、現店舗の現物在庫とフルフィルメント グループのすべての店舗に関するデータが、コマース本社からチャネル データベースに配信された最新の既知のスナップショットに基づいて計算されます。 1130 ジョブから最後の同期スナップショットに含まれなかったチャネル データベースで選択した製品に存在する追加の売上または返品トランザクションを基に、スナップショットの値はチャネル計算によってさらに絞り込み、物理的に利用可能な値を調整することができます。 チャネル データベースがフルフィルメント グループのいずれかの倉庫または店舗のトランザクション データを含まない場合、値の再計算に因数分解できる追加のトランザクションを含みません。 したがって、これらの倉庫または店舗に対して表示できる最適な手持在庫の見積は、最新のコマース本社スナップショットからのデータです。

POS の**注文フルフィルメント**スクリーンでは、注文フルフィルメント行が選択されユーザーが選択した品目の手持在庫の**詳細**パネルを表示する際に、品目の手持在庫を表示するためにチャネル側計算も活用されます。

## <a name="optimize-your-inventory-data"></a>在庫データの最適化

在庫の最適予測を保証するには、次のコマース バッチジョブを使用し、それらを頻繁に実行することが重要です。

- **P- ジョブ** – P- ジョブは**配送スケジュール**ページで検出され、頻繁に実行する必要があります。 このジョブでは、E コマース注文、POS で作成された非同期の顧客注文、およびチャネル データベースからコマース本社に作成された現金店頭払い注文を取得し、それらをさらに処理できるようにします。 このデータがコマース本社へチャネルから同期されるまで、コマース本社ではこれらのトランザクションによって発生した倉庫内の製品に対する在庫調整についての情報がありません。
- **注文の同期** – このジョブでは、P- ジョブが E コマースと非同期な顧客注文トランザクションを提供およびコマース本社の販売注文に変換するようコマース本社の非加工トランザクション データを処理します。 このジョブが処理および販売注文が作成されるまで、在庫トランザクションは作成されません。 したがって、コマース本社の手持在庫についてはトランザクションが考慮されません。
- **バッチのトランザクション明細書の計算** – 店舗で作成された現金店頭払いのトランザクションについては、トリクル フィード転記のプロセスにより、売上に関する在庫が確実に更新されます。 現金店頭払い注文の在庫トランザクションを最も効率的に処理するには、[トリクル フィード転記](https://docs.microsoft.com/dynamics365/commerce/trickle-feed) を使用してシステムを構成する必要があります。
- **バッチのトランザクション明細書を転記** – このジョブは、トリクル フィード転記にも必要です。 **バッチのトランザクション明細書の計算**ジョブに従います。 このジョブでは、計算された明細書が系統的に転記されるので、現金店頭払い売上の販売注文がコマース本社で作成され、店舗の在庫が正確に反映されます。
- **製品の可用性** – このジョブでは、コマース本社からの在庫のスナップショットが作成されます。
- **1130 (製品の可用性)** – このジョブは**配送スケジュール**ページにあり、**製品の可用性**ジョブの直後に実行する必要があります。 このジョブでは、コマース本社からチャネル データベースに対して、在庫スナップショット データを転送します。

これらのバッチ ジョブを頻繁 (数分ごと) に実行しないことをお勧めします。 頻繁に実行すると Commerce Headquarters (HQ) が過負荷になり、パフォーマンスが低下する可能性があります。 一般に、製品の可用性と 1130 のジョブを毎時ごとに実行し、P-ジョブのスケジュール設定、注文の同期、およびトリクル フィードの転記関連ジョブを同じまたはそれ以上の頻度で実行することをお勧めします。

> [!NOTE]
> パフォーマンス上の理由から、チャネル側在庫の可用性計算が E コマース API's または新しい POS チャネル側の在庫ロジックを使用して、在庫の可用性依頼を作成するために使用される際、計算によって再度計算ロジックの実行が正当化するのに十分な時間が経過したかどうか特定するためのキャッシュが使用されます。 既定のキャッシュは 60 秒に設定されています。 たとえば、店舗のチャネル側計算を有効にして、**在庫検索**ページで製品の手持在庫を表示しているとします。 その後、製品の 1 つのユニットが販売された場合、**在庫検索**ページではキャッシュがクリアーされるまで、在庫の減少が示されません。 POS でトランザクションを転記した後、手持在庫が削減されたことを確認する前に、60 秒待機する必要があります。

ビジネス シナリオが短いキャッシュ時間を要求する場合、製品サポート担当者に問い合わせてください。
