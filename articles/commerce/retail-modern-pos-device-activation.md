---
title: Modern POS (MPOS) のインストール、構成、有効化
description: このトピックでは、さまざまなプラットフォームで Modern POS を構成、ダウンロード、インストールする方法について説明します。 デバイスの有効化を通じて Modern POS を有効化する方法について説明します。
author: jashanno
ms.date: 09/01/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: RetailChannelManagementWorkspace, RetailDevice, RetailTerminalTable
audience: Developer, IT Pro
ms.reviewer: josaw
ms.custom: 20501
ms.assetid: 1a8dba89-f81b-40d5-9e1e-dba7b335600d
ms.search.region: Global
ms.search.industry: Retail
ms.author: jashanno
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update
ms.openlocfilehash: 4cea0aa61ba8f0b19b6bbb1dffd53cb3556ccaa4
ms.sourcegitcommit: d420b96d37093c26f0e99c548f036eb49a15ec30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/03/2021
ms.locfileid: "7472135"
---
# <a name="configure-install-and-activate-modern-pos-mpos"></a>Modern POS (MPOS) のインストール、構成、有効化

[!include [banner](includes/banner.md)]
[!include [banner](includes/preview-banner.md)]

このトピックでは、さまざまなプラットフォームで Modern POS を構成、ダウンロード、インストールする方法について説明します。 このトピックは、レガシ セルフサービス インストーラーに基づいています。 シールされたセルフサービス インストーラーの詳細については、[シールされた Commerce セルフサービス コンポーネントの一括配置](dev-itpro/Enhanced-Mass-Deployment.md) を参照してください。 デバイスの有効化を通じて Modern POS を有効化する方法について説明します。

> [!NOTE]
> 最新の POS インストーラーには、Modern POS とオフラインの Modern POS (このインストーラーでもオフライン データベースをインストールします) の 2 つが用意されています。
>
> リリース 10.0.11 以降、ClientBroker フォルダーに保存されているカスタマイズ ファイルを変更すると、新しいリリースをインストールするときに問題が発生することがあります。 これらの問題には、オフラインの使用不可、または新しいインストーラーが正常に完了できないことが含まれることがあります。 回避策として、新しいインストーラーを使用してインストールを実行する前に、Modern POS ディレクトリの ClientBroker フォルダーにあるファイルを削除することができます。
> 
> 10.0.15 リリースから、以前のバージョンからの更新時に Modern POS 用のクライアント ブローカー フォルダーにあるファイルへのカスタマイズによりエラーが発生することがあります。 既知の回避策は、新しい Modern POS インストーラーを実行する前に、クライアント ブローカー フォルダーからすべてのファイルを削除することです。 自動化については、インストーラーの事前ステップとして、簡単にスクリプトを記述することができます。 このフォルダー内のすべてのファイルを削除する必要があります。 このエラーが発生すると、新しいインストーラーは現在のインストールを正常に更新します。

## <a name="technology"></a>テクノロジ

セルフサービス プロセスでは、Modern POS インストーラーの適切なバージョンをダウンロードし、販売時点管理 (POS) レジスターとして使用する物理デバイスにインストールできます。 デバイスの有効化は、物理デバイスを Headquarters のレジスターに結びつける主要なオンボード手順です。 この機能の主要な技術的な機能を以下に示します。

- 物理デバイスをビジネス エンティティに関連付けます (登録)。
- Microsoft Azure Active Directory (Azure AD) およびデバイス トークン/ID を通してセキュリティを強化します。
- Modern POS の権限のないリモート使用を阻止します。 (つまり、リモートでデバイスを無効化します。)
- POS の最初のタッチポイントとして簡単な Modern POS の機能 (番号順序、ハードウェア プロファイル、商社情報) の設定を初期化します。
- Payment Card Industry (PCI) 規格に準拠し、Headquarters からのデバイス情報を報告します。

> [!NOTE]
> オンプレミス環境で使用するための Modern POS をインストールする場合、Modern POS はデバイスの有効化に Azure Active Directory の資格情報を使用しません。

## <a name="setup"></a>セットアップ

このトピックで説明されている手順を開始する前に、次の手順を実行します。

- Headquarters にサインインするための資格情報があることを確認します。
- デバイスに Modern POS をインストールするための管理者アクセス権またはルート アクセス権があることを確認します。
- デバイスから Commerce Scale Unit にアクセスできることを確認します。
- その環境に、**人事管理** モジュールのコマース アクセス許可グループとジョブが含まれていることを確認します。 これらの権限グループとジョブは、デモ データの一部としてインストールされている必要があります。

## <a name="download-and-install-modern-pos"></a>Modern POS のダウンロードおよびインストール

### <a name="verify-that-the-device-is-correctly-configured"></a>デバイスが正しくコンフィギュレーションされていることを確認します。

1. Headquarters で、**Retail と Commerce** &gt; **チャネル** &gt; **チャネル配置** に移動します。
2. **チャネル配置** ページで、**レジスター** タイルを選択します。
3. **レジスター** ページで、店舗のレジスターを選択します。 デモ データはヒューストン店舗を完全に定義し、セルフサービスを登録しています。 ヒューストン レジスタを見つけるには、デバイス リストの上部にあるフィルターで **Houston** と入力します。
4. **レジスター番号** 列でレジスター番号を選択することにより、レジスターを選択します。 Houston 店舗では、レジスター Houston-3 が適切に定義されているため、例として役立ちます。
5. レジスターのページの、**一般** で、**オフライン サポート** オプションが **いいえ** に設定されていることを確認します。 オフライン サポートを使用するには、アクション ウィンドウで **編集** を選択し、**オフライン サポート** オプションを **はい** に設定します。

### <a name="download-the-modern-pos-installer"></a>Modern POS インストーラーのダウンロード

1. **ようこそ** ページで、左上隅のメニューを使用して、**Retail と Commerce** &gt; **チャンネル** &gt; **チャネル配置** に移動します。
2. **チャネル配置** ページで、**デバイス** タイルを選択します。
3. デバイスを選択します。

    > [!NOTE]
    > - Houston デバイスが適切に定義されています。 Houston-3 は、Microsoft Windows デスクトップまたはタブレットの例として役立ちます。 Houston-21 は、Windows Phone の例として役立ちます。
    > - デバイスを選択すると、アクション ウィンドウの **ダウンロード** ボタンを使用できるようになります。

4. **ダウンロード** を選択し、**構成ファイル** を選択します。 次の点に注意してください。

    - ブラウザーは、生成されたダウンロード ポップアップをブロックする可能性があります。 **1 回許可** または **このサイトのオプション** &gt; **常に許可** を選択します。 次に、デバイスが選択されているときに **ダウンロード** を再度選択します。
    - 構成ファイルは、Modern POS インストーラーと同じ場所に保存する必要があります。 セキュリティ上の理由から、インストールの完了後に、このファイルを削除します。 構成ファイルが、実行可能なインストーラーと同じファイル名でない場合は、コマンド ラインを使用して実行可能ファイルを実行して構成ファイルを指定するか、XML 構成ファイルの名前を実行可能ファイル名と同じベース名に変更する必要があります。

5. Internet Explorer ウィンドウの下部に表示される通知バーで、**保存** を選択します。 (通知バーは、他のブラウザでは別の場所に表示される場合があります。)
6. **ダウンロード** を選択し、**Retail Modern POS** を選択します。 次の点に注意してください。

    - ブラウザーは、生成されたダウンロード ポップアップをブロックする可能性があります。 **1 回許可** または **このサイトのオプション** &gt; **常に許可** を選択します。 次に、デバイスが選択されているときに **ダウンロード** を再度選択します。
    - 使用する必要があるインストール パッケージは、オフライン サポートが必要かどうか、および Modern POS をインストールするデバイスが Windows タブレットまたは電話デバイス (Windows Phone、Android デバイス、または iOS デバイス) かどうかによって異なります。 レジスターの設定と、デバイスに設定されているアプリケーションのタイプに基づいて、適切なパッケージがダウンロード用に自動的に選択されます。 Windows タブレットでオフライン パッケージが選択されていますが、Microsoft SQL Server がまだインストールされていない場合 (またはオフライン パッケージの要件を満たしていない場合)、SQL Server はダウンロードされません。 SQL Server (および全文検索などの関連する必須機能) をインストールして、インストーラーを再度試行します。

7. Internet Explorer ウィンドウの下部に表示される通知バーで、**保存** を選択します。 (通知バーは、他のブラウザでは別の場所に表示される場合があります。)
8. セットアップ インストーラが保存されたら、通知バーの、**実行** を選択します。 (この手順はブラウザによって異なる場合があります。)

### <a name="before-running-the-modern-pos-installer"></a>Modern POS インストーラーを実行する前に

- すべての [システム要件](../fin-ops-core/fin-ops/get-started/system-requirements.md) を満たしていることを確認します。 オフライン データベースを使用する場合は、最初に、[Commerce Data Exchange 実装ガイダンス](dev-itpro/implementation-considerations-cdx.md#commerce-data-exchange-implementation-guidance) セクション、およびそれによって参照される関連するベスト プラクティス コンテンツを確認することをお勧めします。
- 一時的にウィルス対策アプリケーションを無効にすることをお勧めします。 積極的なウィルス対策ソリューションの場合、使用中のアクティブなファイルをチェックしたときに、ウィルス対策ソリューションがフリーズする可能性があることが報告されています。
- インストーラーは、最新のアプリケーションをサイドロードします。 したがって、サイドロードされたアプリケーションを許可するようにグループ ポリシー エントリを設定する必要があります。 インストーラーは、このインストールを可能にするために、次のように関連するレジストリ キーを変更します。

    - **パス:** HKLM:SoftwarePoliciesMicrosoftWindowsAppx
    - **プロパティ:** AllowAllTrustedApps
    - **値:** 1

- オフラインが使用されている (オフライン データベースが作成されている) 場合、既定の SQL Server のインスタンスが存在している必要があります。 SQL Server のインスタンスが存在していても、既定として設定されていない場合、インストーラーはオフライン データベースのインストールに失敗します。

オンプレミス環境で使用する Modern POS をインストールする場合は、次のようにコマンド ラインからインストーラーを起動する必要があります。

```Console
ModernPosSetupOffline.exe -UseAdfsAuthentication
```

### <a name="run-the-modern-pos-installer-on-a-windows-computer"></a>Windows コンピューターで Modern POS インストーラーを実行する

Modern POS インストーラーは、まず関連付けられているファイルを抽出し、インストールを開始します。

1. インストーラーは、すべての前提条件が満たされていることを検証します。 次の点に注意してください。

    - システムの再起動が必要な場合は、インストーラーでこれに関する要件を確認できますが、通常インストールを続行できます。
    - Modern POS のサイドローディング インストールには、グループ ポリシーの変更が必要です。 この変更が必要かどうかがインストーラーによって通知され、自動的に変更されます。

2. オフライン サポートを選択しましたが、有効なバージョンの SQL Server が見つからない場合、前提条件の確認中にインストーラーは失敗します。 この手順で前提条件が満たされない場合は、まずインストーラを再試行してください。 それでもインストーラーに失敗する場合は、このトピックの[トラブルシューティング](#troubleshooting)を参照します。
3. インストーラーは Modern POS をインストールします。
4. インストールが成功したことを示すページで、**閉じる** を選択しインストーラーを終了します。

プログラムを開始できるようになりました。

> [!NOTE]
> このインストールは、インストーラーを実行した管理者ユーザーに対してのみ行われます。 その他のすべてのユーザーについては、Modern POS をインストールするデスクトップ アイコンが作成されます。 ユーザーがサイン インするたびに、そのユーザーがアイコンをダブルクリックする必要があります。 その後、要求に応じて、プログラムがインストールまたは更新されます。 更新後にユーザーがデスクトップ アイコンを使用しない場合、POS クライアントは、実行する前に正しく更新されるように、デスクトップ アイコンからら実行するようユーザーに POS クライアントより要求されます。

### <a name="run-the-installer-on-any-other-device-windows-phone-google-android-device-or-apple-ios-device"></a>その他のデバイス (Windows Phone、Google Android デバイス、または Apple iOS デバイス) でインストーラーを実行する

1. アプリケーションが、デバイスに直接ダウンロードされなかった場合、ダウンロードしたアプリケーション ファイルと関連付けられている構成ファイルをデバイス上の同じフォルダに転送します。 デバイスの種類によっては、APP ファイル、APK ファイル、または IPA ファイルになります。

    このステップはさまざまな方法で実行できることに注意してください。 たとえば、共有フォルダー、USB ケーブル経由での転送、またはユーザーのデバイスへの安全な送信を通してファイルにアクセスすることができます。

2. デバイスのファイル エクスプローラーを使用して、アプリ ディレクトリを参照します。
3. アプリケーションのインストールを開始するためにアプリケーションをタップします。 (構成ファイルが同じ場所に保存されている場合は、アプリケーションを起動してデバイスの有効化を開始すると、Commerce Scale Unit URL が自動的に入力されます。)

    一部のデバイスでは、アプリケーションのインストールを開始するためにファイルをダブルタップする必要があることに注意してください。 一部のデバイスは、アプリケーションがインストールされたことを通知しないことがあります。 これらのデバイスで、アプリケーション一覧を見て、アプリケーションが正しくインストールされたことを確認することをお勧めします。

4. インストールが完了したら、デバイス上のアプリケーション一覧にあるアプリケーションを起動できるようにする必要があります。 たとえば、Windows Phone にアプリケーションをインストールした後は、ホーム画面のタイルの一覧から開始できます。

プログラムを開始できるようになりました。

## <a name="create-a-worker"></a>作業者を作成

このトピックのでは、既に作業者を作成し、彼らを提供されているデモ データ内のヒューストン アドレス帳に割り当てました。 したがって、このトピックでは事前生成データを使用します。

### <a name="create-a-worker"></a>作業者を作成

1. **Retail と Commerce** &gt; **従業員** &gt; **作業者** の順に移動します。
2. アクション パネルにて **+新規** を選択して新しい従業員を作成します。
3. 名前および姓を入力します。 たとえば、**John** を名として、**Smith** を姓として入力します。
4. **法人** フィールドが **USRT** に設定され、**作業者の種類** フィールドが **従業員** に設定され、**雇用開始日** フィールドが当日の午前 12 時に設定されていることを確認し、従業員の雇用がすぐに開始されるようにします。
5. **職位の割り当て** チェック ボックスを選択します。 ストア マネージャーの職位ある職位番号 **000544** を選択します。
6. **個人のアクション タイプ** フィールドを **採用アクション** に設定し、すぐに新しい従業員を雇用します。
7. **続行** を選択します。
8. アクション ウィンドウで、**完了** を選択し新しい作業者の作成を終了します。
9. 作業者リストに戻ります。 新しく作成された作業者 (たとえば、John Smith など) を検索します。 新しい作業者の詳細を表示する作業者の名前を選択します。
10. アクション ウィンドウで、**編集** を選択します。
11. 作業者用の言語が **ja-JP** になっていることを確認します。
12. **作業者集計** の **アドレス帳** フィールドで、**ヒューストン** ストアを選択します。
13. **コマース** タブで、POS パスワードをリセットすることができます。 このチュートリアルでは、パスワードを **123** にリセットします。
14. **コマース** タブの、**画面レイアウト** で、画面レイアウトを割り当てます。 たとえば、**F2MP16:9M** (**Fabrikam MPOS マネージャー (16:9)**) を選択します。
15. アクション ウィンドウで、**保存** を選択します。
16. **Retail と Commerce** &gt; **定期処理** &gt; **配送スケジュール** の順に移動します。
17. **1060 – スタッフ** ジョブを選択し、アクション ウィンドウで **今すぐ実行** を選択して作業者データをチャネル データベースに同期します。
18. 新しい作業者が作成され、店舗に同期された後、その作業者は割り当てられたヒューストン店舗で使用されているすべての POS デバイスにサイン インし、トランザクションを実行できます。 ただし、デバイスが最初に有効になっている必要があります。 次のセクションでは、新しい作業者用のデバイスを有効にする方法について説明します。

### <a name="map-an-azure-ad-account-to-a-worker-who-has-pos-permissions-for-device-activation"></a>デバイスの有効化の POS アクセス許可がある作業者に、Azure AD アカウントをマップする

新しい作業者の Modern POS をアクティブにする前に、この手順を完了する必要があります。

1. コマースの **作業者** ページから、前の手順で作成した作業者の **作業者の詳細** ページを開きます。
2. アクション ウィンドウで、**編集** を選択します。
3. **コマース** タブで、**POS アクセス許可** リンクを選択します。 **POS のアクセス許可グループ** で、値が **マネージャ** であることを確認します。
4. 完了したら、新しい作業者の **作業者の詳細** のページに戻ります。

    **作業者の詳細** ページに戻るには、アクション ウィンドウの右側にある **閉じる** ボタン (**X**) を選択します。

5. アクション ウィンドウで、**コマース** を選択し、**既存の ID の関連付け** を選択します。
6. 表示されるダイアログ ボックスで、**AX 管理の管理者** という Azure AD アカウントを選択します。(代替管理者の Azure AD アカウントが作成されている場合は、そのアカウントを選択します。)
7. **OK** を選択します。 デモ データでは、Headquarters で管理者アカウントに関連付けられている Azure AD アカウントが、管理者 Azure AD アカウントです。
8. アクション ウィンドウで、**保存** を選択し、ページを更新します。 **外部 ID** セクションは、新しい情報で更新される必要があります。

    **外部識別子** フィールドは空のままになることに注意してください。 この動作は予期されています。 したがって、これは無視できます。

この手順は、Retail Cloud POS または Modern POS を有効化する前に完了する必要があります。 詳細については、[有効化アカウントの管理とデバイスの検証](set-up-activation-accounts-validate-devices-hq.md)を参照してください。

### <a name="run-the-validate-devices-for-activation-check"></a>有効化チェックのためにデバイス検証を実行

1. Headquarters で、**デバイス** ページ (**Retail と Commerce** &gt; **POS の設定** &gt; **デバイス**) を開きます。
2. デバイスの有効化を検証するデバイスを選択し、**デバイスで有効化を検証する** を選択します。 たとえば、デバイスの **HOUSTON-3** を選択します。
3. 表示されるダイアログ ボックスで、デバイスを検証する作業者 (前の手順で Azure AD アカウントにマップされた作業者) を選択します。 たとえば、作業者の **000160** を選択します。
4. **OK** を選択し、次のメッセージが表示されることを確認します。「デバイス HOUSTON-3 とスタッフ 000160 の有効化前の検証が完了しました。 検証: 成功

## <a name="activate-a-device"></a>デバイスのアクティブ化

> [!NOTE]
> Azure Active Directory トークンが取得できないため、クラウド POS デバイスのデバイスのアクティブ化中に Safari ブラウザーでエラーが表示されることがあります。 この問題は、[Apple デバイスの Microsoft Enterprise SSO プラグイン](/azure/active-directory/develop/apple-sso-plugin) を利用することで解決できます。

1. コンピューターで Modern POS を起動します。 **開始する前に** ページの手順を読み、完了したことを確認します。 その後、**次へ** を選択します。
2. **有効化** を選択します。 Azure AD サインイン ページにリダイレクトされます。
3. `admin@<MyCompany>.onmicrosoft.com` など、以前マップした Azure AD アカウントおよびパスワードを入力します。
4. 有効化が完了したら、**開始** を選択します。
5. 作業者アカウント **000160** とパスワード **123** を使用して Modern POS にサインインします。

デバイスが有効化され、使用する準備ができました。

## <a name="update-the-modern-pos-application"></a>Modern POS アプリケーションの更新

> [!NOTE]
> 配置可能パッケージの詳細については、[配置可能パッケージの適用](../fin-ops-core/dev-itpro/deployment/apply-deployable-package-system.md) を参照してください。

1. Modern POS アプリケーションが環境にアップロードされた後、デバイスでパッケージのバージョンを選択することができます。 パッケージ一覧には、新しいアップロードされたアプリケーションが含まれている必要があります。
2. Modern POS アプリケーションを更新するには、[Modern POS のダウンロードおよびインストール](#download-and-install-modern-pos) セクションの手順に従ってください。 インプレース更新を行うには、新しいバージョンのセルフ サービス インストーラーを実行します。 アンインストールは必須でないか、推奨されていません。 デバイスの有効化状態は更新後も維持されます。
3. インストーラーは、現在インストールされているコンフィギュレーション設定を使用します。 コマースでのさまざまな構成の変更によって構成ファイルが変更されている場合、更新によって Modern POS アプリケーションの設定が変更されることはありません。

> [!WARNING]
> インストーラーが成功するのに、Modern POS オフライン データベースの更新は必要ではありません。 オフライン データベースは古いバージョンを保持することがあり、エラーが発生した場合に更新されないことがあります。 カスタマイズが更新された場合、または更新の失敗が検出されない場合に、オフライン データベースが正しく動作しないことがあります。 これらのシナリオでは、ブロックの問題を修正し、Modern POS を再度更新して、オフライン データベースが正しく更新されるようにすることが重要です。

## <a name="troubleshooting"></a>トラブルシューティング

### <a name="troubleshoot-installation"></a>インストールに関するトラブルシューティング

- トランザクションの間 Modern POS が使用中で、POS がオフラインに切り替わると、「買い物カゴのバージョンが変更されました」というエラーが表示されます。

    **ソリューション:** 終了して作業を続行する場合に選択します。 これは既知の問題で、現在調査中です。 このエラーにより問題は発生しません。

- ブラウザーが、生成されるダウンロード ポップアップをブロックします。

    **ソリューション:** いずれかを選択 **1 回のみ許可** または **このサイトのオプション** &gt; **常に許可** (または使用しているブラウザーで同等のコマンド)。 次に、正しいレジスターが選択されているときに **ダウンロード** を再度選択します。

- 使用する必要があるインストール パッケージは、オフライン サポートが必要かどうかによって異なります。 適切なパッケージがダウンロード用に自動的に選択されます。 オフライン パッケージについては、SQL Server がインストールされている必要があり、オフライン パッケージの要件を満たす必要があります。

    **ソリューション:** SQL Server のインストールが完了していない場合 (または要件を満たしていない場合)、サポートされているバージョンのインストールが必要です。 このインストールは長い期間がかかることがあり、全文検索機能を含める必要があります。

- このインストールは、インストーラーを実行した管理者ユーザーに対してのみ行われ、その他のユーザーに対しては行われません。

    **ソリューション:** インストーラーは、Modern POS のインストール、アップグレード、および実行に使用されるデスクトップ アイコンを生成します。 このアイコンは、コンピューター上のすべてのユーザーに対して生成されます。 Modern POS をインストールする必要があるユーザーがこのアイコンをダブルクリックすると、そのプログラムがインストールされます。 ユーザーは Modern POS を使用できます。

- セルフ サービス Modern POS インストーラーを使うと、SQL Server が正常にダウンロードおよびインストールされません。

    - **ソリューション 1:** インストーラーは自動的に SQL Server をダウンロードしなくなりました。 前提条件のインストールを満たすために、サポートされているバージョンの SQL Server を全文検索でダウンロードおよびインストールします。

- パフォーマンス (perf) カウンターの登録に失敗したため、Modern POS のインストールが失敗します。

    **ソリューション:** この問題を解決するには、次の手順に従ってください。

    1. 管理者として **コマンド プロンプト** ウィンドウを開きます。
    2. 次のコマンドを入力します。

        ```Console
        lodctr /s:"perf_backup.txt"
        ```

    3. 次のコマンドを入力します。

        ```Console
        lodctr /R
        ```

    4. システムでシステムのバックアップのパフォーマンス カウンター設定が再構築されない場合、**lodctr/R** コマンドを再実行します。
    5. Modern POS インストーラーを再実行します。

- クラウド ホスト環境ではなくダウンロードした仮想ハード ディスク (VHD) を使用している場合、ダウンローダーが失敗する場合があります。

    - **ソリューション 1:** ダウンロードした VHD では、Azure Storage エミュレーターがインストールされており、正しく動作している必要があります。 そうしないと、セルフサービス パッケージを正しくダウンロードすることはできません。
    - **ソリューション 2:** VHD を Microsoft Hyper-V に統合するプロセス中にエラーが発生した可能性があります。 パッケージを正しくダウンロードする前に、手動でアクセス許可を編集する必要があります。 以下の手順を実行します。

        1. ファイル エクスプローラーで、**C:\\Microsoft Dynamics 365\\70\\Retail Server** を参照します。
        2. **SelfServicePackages** フォルダーを右クリックし、**プロパティ** を選択します。
        3. **セキュリティ** タブで、**編集** をクリックします。
        4. **SelfServiceDeployment のアクセス許可** ダイアログ ボックスで、**追加** を選択します。
        5. **ユーザー、コンピュータ、サービス アカウント、またはグループの選択** ダイアログ ボックスで、**場所** を選択します。
        6. **場所** ダイアログ ボックスで、リスト (ローカル コンピューター) の最初のエントリを選択し、**OK** を選択します。
        7. **ユーザー、コンピュータ、サービス アカウント、またはグループの選択** ダイアログ ボックスで、**IIS\_IUSRS** という名前を入力してから **名前の確認** を選択します。 オブジェクト名は、**IIS\_IUSRS** に変更する必要があります。 **OK** を選択します。
        8. **SelfServiceDeployment のアクセス許可** ダイアログ ボックスで、新しい **IIS\_ISURS** ユーザーを選択します。 **IIS\_IUSRS のアクセス許可** の **フル コントロール** アクセス許可で **許可** を選択します。 **OK** を選択します。
        9. **アクセス許可を開く** ダイアログ ボックスで、**OK** を選択します。

- 最新の iOS バージョンでは、自己署名証明書をサポートしていません。

    - **ソリューション 1:** ドメインを使用して、適切なドメイン ベースの証明書を生成します。
    - **ソリューション 2:** オープン ソース OpenSSL ライブラリをダウンロードし、インストールの完了後に次の手順を実行します:

        1. PowerShell を使用して、**$ openssl genrsa -des3 -out rootCA.key 2048** などのコマンドを使用して、ルート証明機関 (CA) の秘密キーを作成します。
        2. パスワードの入力を求められますが、パスワードは後で使用するために覚えておく必要があります。
        3. 次に、**$ openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.pem** などのコマンドを使用してルート証明書を生成します。 以前に入力したパスワードと、いくつかの基本的な証明書情報を求めるプロンプトが表示されます。

            > [!NOTE]
            > 証明書の有効期間は変更できます。 上記の例では、これは 1024 日です。

        4. 新しい **info.ext** ファイルを作成し、次の情報を入力します:

            - keyUsage = keyEncipherment, dataEncipherment
            - extendedKeyUsage = 1.3.6.1.5.5.7.3.1
            - subjectAltName = @alt_names
            - [alt_names]
            - DNS: 1 = &lt;ホスト コンピュータの完全修飾ドメイン名&gt;

        5. **openssl req -new -nodes -out server.csr -newkey rsa:2048 -keyout server.key** などのコマンドを使用して、署名要求と秘密キーを生成します。
        6. **$ openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 500 -sha256 -extfile info.ext** などのコマンドを使用して、以前に生成されたルート証明書を使用して証明書を発行します。ルート キーのパスワードを求めるプロンプトが表示され、証明書の有効日数 (この例では 500 日) を指定する必要があります。
        7. **$ openssl pkcs12 -inkey server.key -in server.crt -export -out server.pfx** などのコマンドを使用して IIS 証明書を生成します。 このコマンドは、新しいパスワードを要求します。このパスワードは、あとで証明書をインポートする時に使用されます。
        8. **Certmgr.msc** を開いて、**信頼されたルート証明機関** に移動します。 **インポート** アクションを使用して、以前に生成された **rootCA.pem** ルート CA ファイルをインポートします。
        9. 同じウィンドウで、**パーソナル** に移動し、**インポート** アクションを使用して、以前に生成された **server.pfx** をインポートします。
        10. 次に、**IIS マネージャー** を開き、**RetailHardwareStationWebSite** を選択し、一番右のメニューから **バインドの編集** を選択します。
        11. 新しいウィンドウで、HTTPS サイトのバインドを選択し、**編集** を選択します。 最後の画面で、新しくインストールした証明書を選択し、**OK** を選択します。
        12. 証明書が正しく使用されていることを確認します。 Web ブラウザーで、`https://<hostname>/HardwareStation/ping`に移動します。
        13. iOS デバイスに証明書をインストールします:

            - **rootCA.pem** ファイルをコピーして、コピーの名前を **rootCA.crt** に変更します。
            - OneDrive またはその他のファイル ホスティング ロケーションを使用して、**rootCA.crt** と **server.crt** をアップロードし、iOS デバイスにダウンロードできるようにします。

        14. iOS デバイスで、**設定 &gt; 全般 &gt; プロファイル** に移動し、**rootCA.crt** 用にダウンロードしたプロファイルを選択します。 **インストール** を選択します。
        15. プロファイルの状態が **検証済** に更新されていることを確認し、**server.crt** ファイルに対して同じプロセスを繰り返します。
        16. **設定 &gt; 全般 &gt; 情報 &gt; 証明書の信頼設定** に移動し、インストールされているルート証明書を有効にします。
        17. iOS デバイスで、以前に指定したハードウェア ステーションの ping URL を使用して、証明書が信頼できることを確認します。
        18. POS アプリケーションを **非ドロワーモード** で開き、通常実行されるようにハードウェア ステーションとペアリングします。

### <a name="troubleshoot-device-activation-for-modern-pos"></a>Modern POS のデバイス有効化のトラブルシューティング

- Microsoft アカウント (Azure AD) サインイン ページは開きません。

    **ソリューション**: Azure AD エンドポイントに到達できない場合があります。 しばらく待ってから、もう一度やり直してください。

- Azure AD アカウントを入力した後、ユーザーが承認されていない状態を示すエラー メッセージを受入します。

    **ソリューション**: Azure AD ユーザーがデバイスを有効化するための POS アクセス許可を持つ作業者にマップされていることを確認します。 作業者の **デバイスの管理** アクセス許可を **はい** に設定する必要があります。

- Android デバイスで Modern POS を使用する場合、デバイスの有効化と Azure AD ベースの POS サインインにより、スタンドアロンのブラウザインスタンスで Azure AD サインイン ページが開きますが、サインイン プロセスは続行されません。
    
    **ソリューション:** Commerce Scale Unit のバージョンが 10.0.22 以降で、Modern POS のバージョンが 10.0.21 以前かどうかを確認します。 その場合、最新の Commerce サンプル リポジトリ (バージョン 10.0.22 以降) から Modern POS を再構築し、Android デバイスで Modern POS アプリケーションを更新する必要があります。

- デバイスの有効化が完了していません。 手順のいずれかの最中に失敗します。

    **ソリューション:** すべてのデータが正しいことを確認するには、このチェックリストに従ってください。

    - Headquarters で有効化チェックのためのデバイス検証を完了し、デバイスが検証をパスしたことを確認します。
    - デバイスを有効化しているクライアント コンピューターで、Commerce Scale Unit URL 正常性チェックにアクセスし、正常性チェックが承認されていることを確認します。 URL には次の形式を使用します: `https://MyCompanyNameret.axcloud.dynamics.com/commerce/healthcheck?testname=ping`
    - 作業者は、Azure AD アカウント (**外部 ID** 下) にマップする必要があります。
    - マッピングされる Azure AD アカウントは、同じテナントに属している必要があります。
    - 作業者を Azure AD アカウントにマップするには、Microsoft Dynamics Lifecycle Services (LCS) の管理者アカウントを使用して Headquarters にサインインします。
    - 作業者がマネージャー ロール内のコマース ユーザーとして設定されていることを確認します。 (この品目は、検証によってチェックされます。)
    - チャネルが公開されていることを確認します。 (この品目は、検証によってチェックされます。)
    - チャネル データベースに本社から同期したデータが含まれており、ダウンロード ジョブが実行されていることを確認します。
    - **登録** でハードウェア プロファイルを設定します。 (この品目は、検証によってチェックされます。)
    - レジスターおよび店舗に画面レイアウトがあることを確認します。 (この品目は、検証によってチェックされます。)
    - 基本住所が法人に対して設定されていることを確認します。
    - 言語が Commerce Data Exchange: Real-time Service ユーザー プロファイル (デモ データでの JBB) に設定されていることを確認します。
    - リアルタイム サービス プロファイルに適切なアクセス許可があることを確認します。
    - 電子決済 (EFT) のコンフィギュレーションの値があることを確認します。

### <a name="troubleshoot-modern-pos-connectivity"></a>Modern POS 接続のトラブルシューティング

開発者トポロジまたはデモ環境などのシングル コンピュータ システム上、または Commerce Scale Unit と Modern POS が同じコンピュータにインストールされている場合は、Modern POS はデバイス有効化を完了できません。

**ソリューション:** この問題は、Modern POS が同じコンピューターへのネットワーク コール (つまり、それ自体の呼び出し) を行うことができないために発生します。 この問題を緩和するには、同じコンピュータに対して通信できるように AppContainer ループバック例外を有効にする必要があります。 Modern POS のこのループバックを有効にするのにさまざまなアプリケーションが役立ちます。 ループバックの詳細については、[ループバックの有効化およびネットワーク分離のトラブルシューティングの方法](/previous-versions/windows/apps/hh780593(v=win.10))を参照してください。

## <a name="additional-resources"></a>追加リソース

[POS のレイアウト デザイナーのインストール](install-pos-layout-designer.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
