---
title: E コマースの評価環境のコンフィギュレーション
description: このガイドでは、Microsoft Dynamics 365 Commerce Preview のプロビジョニングおよびコンフィギュレーションのためのステップ バイ ステップの手順が提供されます。
author: v-chgri
manager: annbe
ms.date: 10/15/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-commerce
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.search.scope: Retail, Core, Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.search.industry: ''
ms.author: anupamar
ms.search.validFrom: 2019-10-31
ms.dyn365.ops.version: ''
ms.openlocfilehash: b0dce2796e69cd8dee87cba176a521c26c81eb1a
ms.sourcegitcommit: fbc106af09bdadb860677f590464fb93223cbf65
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/06/2019
ms.locfileid: "2771683"
---
# <a name="configure-an-e-commerce-evaluation-environment"></a>E コマースの評価環境のコンフィギュレーション

[!include [banner](includes/preview-banner.md)]
[!include [banner](includes/banner.md)]

このガイドでは、Microsoft Dynamics 365 Commerce Preview のプロビジョニングおよびコンフィギュレーションのためのステップ バイ ステップの手順が提供されます。 開始する前に、少なくともドキュメントをざっと見て、プロセスに伴う事柄およびガイドに含まれる内容を把握することをお勧めします。

*メモ: Microsoft Dynamics 365 Commerce Preview へのアクセス許可がまだ与えられていない場合、[コマース Web サイト](https://aka.ms/Dynamics365CommerceWebsite) からプレビューのアクセス許可を要求できます。*

## <a name="summary"></a>集計
環境を正常にプロビジョニングするには、特定の製品名とタイプのあるプロジェクトを作成する必要があります。 環境および Retail Cloud Scale Unit には、後で E コマースのプロビジョニングを開始するために使用する必要がある特定のパラメーターもあります。 このガイドの指示には、実行する必要のあるすべての手順および使用する必要があるパラメーターが含まれています。

プロビジョニングが正常に完了した後、Preview 環境を準備するのに必要なプロビジョニング後の手順があります。 一部の手順は、システムのどの側面を評価するかに応じて使用するオプションです。 考えが変わった場合、後でいつでもオプションの手順を実行できます。

プロビジョニングの手順について質問がある場合、または問題が発生した場合は、[Microsoft Dynamics 365 Commerce Preview Yammer グループ](https://aka.ms/Dynamics365CommercePreviewYammer) をご利用ください。 

## <a name="prerequisites"></a>必要条件
次に、Dynamics 365 Preview 環境をプロビジョニングするための前提条件を示します。
* **Lifecycle Services ポータル (LCS)** へのアクセス許可があります。
* **Dynamics 365 Commerce Preview プログラムを承諾しました**
* **見込みプリセールス**または**移行、ソリューションの作成、および学習**のためにプロジェクトを作成するのに必要なアクセス許可があります。
* 環境のプロビジョニングを行うプロジェクトで、**環境管理者**または**プロジェクト所有者**ロールのメンバーになっています。
* Azure サブスクリプションへの管理者アクセス許可があるか、または代理として管理者アクセス許可が必要な 2 つの手順を実行できるサブスクリプション管理者の連絡先があります
* **AAD テナント ID** が使用可能です
* **E コマース システムの管理者グループ**として使用される **AAD セキュリティ グループ**が作成され、その ID が使用可能になりました
* **評価とレビューのモデレーター グループ**として使用される **AAD セキュリティ グループ**が作成され、その ID が使用可能になりました (上記のシステム管理者グループと同じ SG)
## <a name="provisioning-preview-environment"></a>プレビュー環境のプロビジョニング
これらの手順では、Microsoft Dynamics 365 Commerce Preview 環境のプロビジョニングについて説明します。 これらの手順を正常に完了した後、コンフィギュレーションする準備ができたプレビュー環境ができます。 ここで説明するすべての活動は、LCS ポータルに配置されます。

*プレビュー アクセスは、プレビュー アプリケーションで指定した LCS アカウントおよび組織に関連付けられています。プロビジョニングには同じアカウントを使用する必要があります。プレビュー環境で異なる LCS アカウントまたはテナントを使用する必要がある場合、詳細を提供する必要があります。連絡先情報については、下の「追加リソース」を参照してください。*
### <a name="before-starting"></a>開始する前に
##### <a name="grant-access-to-e-commerce-applications"></a>E コマース アプリケーションへのアクセス許可を与える

*メモ:**ログインするユーザーは AAD テナント管理者である必要があります**。このステップを正常に完了しない場合、プロビジョニングの残りの手順は失敗します。*

1. この手順では、**AAD テナント ID** が必要です。E コマース アプリケーションを承認して、Azure サブスクリプションにアクセスする必要があります。 これを達成する最も簡単な方法は、次のような URL を組み立てることです。

https://login.windows.net/{AAD_TENANT_ID}/oauth2/authorize?client_id=fbcbf727-cd18-4422-a723-f8274075331a&response_type=code&redirect_uri=https://sb.manage.commerce.dynamics.com/_commerce/Consent&response_mode=query&prompt=admin_consent&state=12345

2. **URL を直接クリックしないで**、代わりにブラウザーまたはテキスト エディターにコピーし、**\{AAD_TENANT_ID\}** を自分の **AAD Tenant ID** で置換してから URL に移動ます。
3. Microsoft AAD ログイン ダイアログボックスが表示され、サブスクリプションに Dynamics 365 Commerce (プレビュー) のアクセス許可を与えることを確認します。
4. 操作が成功したかどうかを確認するページに送信されます。

##### <a name="log-in-to-the-lcs"></a>LCS へのログイン
1. LCS ポータル https://lcs.dynamics.com へのログイン
1. Preview へのアクセス許可を要求するために使用したものと同じ LCS アカウントでログインしていることを確認します。
##### <a name="confirm-that-preview-features-are-available-and-enabled"></a>プレビュー機能が使用可能で有効になっていることを確認する
1. LCS の表紙ページで右にスクロールし、**プレビュー機能の管理**タイルをクリックします。
1. 「プライベート プレビュー機能」までスクロールし、次の機能が使用可能で有効になっていることを確認します。
    1. **E コマースの評価**
    1. **Commerce Preview プログラムの環境**
1. これらの機能がリストに表示されない場合、勤務先の電子メール、LCS アカウント、およびテナントの詳細と共にお問い合わせください。 お問い合わせ方法に関する情報については、下記の**追加リソース**を参照してください。

![プレビュー管理タイル](./media/preview1.png)

![プレビュー機能](./media/preview2.png)
### <a name="create-project"></a>プロジェクトの作成
##### <a name="creating-new-project"></a>新しいプロジェクトの作成
1. **+** をクリックして、新しいプロジェクトを作成します。
1. パートナーである場合、**移行、ソリューションの作成、および学習**を選択します。
1. 顧客の場合、**見込みプリセールス**を選択します。
1. 必要に応じて、名前、説明、および業種を入力します。
1. **製品名**について、**Dynamics 365 Retail** を選択します。
1. **製品バージョン**について、**Dynamics 365 Retail** を選択します。
1. **方法**について、**Dynamics Retail の実装方法**を選択します。
1. 必要に応じて、既存のプロジェクトからロールとユーザーをインポートできます。
1. **作成** をクリックします。
1. プロジェクト ビューに送信されます。
##### <a name="add-azure-connector"></a>Azure コネクタの追加
1. パートナーである場合、ツール タイルから右の**プロジェクト設定**をクリックします。
1. 顧客の場合、トップ メニューから**プロジェクト設定**を選択します。
1. **Azure コネクタ**を選択します。
1. Azure コネクタを追加するには、**+ 追加**をクリックします。
1. 名前を入力します。
1. **Azure サブスクリプション ID** を入力します。
1. **Azure リソース マネージャー (ARM) を使用するようにコンフィギュレーションする**を有効にします。
1. **Azure サブスクリプション AAD テナント ドメイン (または ID)** が正しいことを確認します。 必要に応じて、Azure サブスクリプション管理者に問い合わせてください。
1. **次へ** をクリックします。
1. 画面の指示に従って、サブスクリプションに必要なアプリケーションのアクセス許可を与えます。 必要に応じて、Azure サブスクリプション管理者に問い合わせてください。
    1. Azure ポータル https://portal.azure.com/ にログインします。
    1. 正しいディレクトリが選択されていることを確認してください。
    1. 左のメニューから**サブスクリプション**をクリックします。
    1. リストから正しいサブスクリプションを検索、選択します。 必要に応じて、検索を使用します。
    1. メニューから**アクセス制御 (IAM)** を選択します。
    1. 右側の**ロール割り当ての追加**の下の**追加**をクリックします。 **ロール割り当ての追加**ウィンドウが開きます。
    1. **ロール**について、**貢献者**を選択します。
    1. **アクセス権の割り当て先**について、**Azure AD ユーザー、グループ、またはサービス プリンシパル**のままにします。
    1. **選択**の下で、**b96b7e94-b82e-4e71-99a0-cf7fb188acea** を入力します。
    1. リスト**から Dynamics 配置サービス [wsfed-enabled]** を選択します。
    1. **保存**をクリックします。
1. **次へ** をクリックします。
1. 画面の指示に従って、サブスクリプションに必要なアプリケーションのアクセス許可を与えます。 必要に応じて、Azure サブスクリプション管理者に問い合わせてください。
1. **次へ** をクリックします。
1. **Azure リージョン**について、**米国東部**、**米国東部 2**、**米国西部**、または**米国西部 2** のいずれかを選択します。
1. **接続** をクリックします。
1. Azure コネクタがリストに表示されます。
### <a name="import-extension"></a>拡張機能のインポート
1. 上部のプロジェクト名をクリックして、プロジェクトの表紙ページに戻ります。
1. パートナーである場合、ツール タイルから右の**資産ライブラリ**をクリックします。
1. 顧客の場合、トップ メニューから**資産ライブラリ**を選択します。
1. 左のリストから、**ソフトウェア配置可能パッケージ**を選択します。
1. アクション ウィンドウで、**インポート**をクリックします。
1. 共有アセット ライブラリの**下にある**資産のリストから、**コマース プレビュー デモ ベース拡張機能**を選択します。
1. **ピック**をクリックします。
1. 資産ライブラリに戻ると、リストに拡張機能が表示されます。

![プロジェクトの作成 - バージョン](./media/import.png)
### <a name="deploy-environment"></a>環境の配置

*メモ: 1 つのオプション画面がスキップするなど、手順 6、7、または 8 が表示されない事があります。**環境パラメーター** ビューで、**環境名**フィールドの上に、直接「Dynamics 365 Commerce (プレビュー) - デモ (10.0.6 とプラットフォーム更新プログラム 30)」というテキストが表示されていることを確認してください。下のスクリーンショットを参照してください。*

1. トップ メニューで、**クラウド ホスト環境**を選択します。
1. 環境を追加するために **+ 追加**をクリックします。
1. **アプリケーションのバージョン**については、**10.0.6** を選択します
1. **プラットフォーム バージョン**については、**プラットフォームの更新プログラム 30** を選択します。
1. **次へ** をクリックします。
1. 環境トポロジについては、**デモ**を選択してください。
1. 環境トポロジについては、**Dynamics 365 Commerce (プレビュー) - デモ**を選択します 。
1. 以前に 1 つの Azure コネクタをコンフィギュレーションしている場合、この環境に対して使用されます。 複数の Azure コネクタをコンフィギュレーションしている場合、使用できるコネクタを選択するオプションがあります。**米国東部**、**米国東部 2**、**米国西部**、または**米国西部 2** (最高のエンド ツー エンド パフォーマンスのために推奨)
1. **環境名**を入力します。
1. 必要に応じて、VM のサイズを調整します。 (VM SKU **D13 v2** を推奨します)
1. **詳細設定**はそのままにしておきます。
1. 画面上で価格とライセンス条項を確認した後、同意を示すチェック ボックスをオンにします。
1. **次へ** をクリックします。
1. 配置の確認画面で、詳細が正しいことを確認した後、**配置**をクリックします。
1. **クラウド ホスト環境**ビューに戻り、環境がリストに表示されます。
1. 要求した環境はキューに格納され、その後配置されます。 すべての環境ワークフローが完了するまでに少し時間がかかりますので、数時間後にもう一度確認してください (約6 - 9時間)。
1. 続行する前に、環境の状態が**配置済み**になっていることを確認してください。

![プロジェクトの作成 - バージョン](./media/project1.png)

![プロジェクトの作成 - トポロジ 1](./media/project2.png)

![プロジェクトの作成 - トポロジ 2](./media/project3.png)

![プロジェクト作成 - 環境パラメーター](./media/project4.png)
### <a name="initialize-rcsu"></a>RCSU の初期化
1. **クラウド ホスト環境**ビュー内で、リストから環境を選択します。
1. 画面の右側にある環境ビューから、**完全な詳細**をクリックします。 環境の詳細のビューが表示されます。
1. **環境機能**の下で、**管理**をクリックします。
1. **小売**タブで、**初期化**をクリックします。 RCSU 初期化パラメーター ビューが表示されます。
1. **リージョン**について、**米国東部**、**米国東部 2**、**米国西部**、または**米国西部 2** を選択します。
1. **バージョン**について、最初にドロップダウン リストから**バージョンを指定**を選択し、下に表示されるテキスト フィールドで **9.16.19262.5** を指定します。 *メモ: ここに一覧表示されている**正確なバージョンを指定**して、後で正しいバージョンに RCSU を更新しないようにしてください。*
1. **拡張機能の適用**を有効にする。
1. 拡張機能のリストから、**コマース プレビュー デモ ベース拡張機能**を選択します。
1. **初期化**をクリックします。
1. 配置の確認画面で、詳細が正しいことを確認した後、**はい**をクリックします。
1. **小売**タブが有効化され、**小売管理**ビューに戻ります。 RCSU がプロビジョニング用にキューに格納されました。
1. 続行するには、RCSU の状態が**成功**になるまで待ちます (約 2 - 5 時間かかります)。
### <a name="initialize-e-commerce"></a>E コマースの初期化
1. **E コマース (プレビュー)** タブに切り替えます。
1. プレビューの同意を確認した後、**設定**をクリックします。
1. **E コマース テナント名**に名前を入力します。 ただし、E コマース インスタンスを指し示す一部の URL に表示されます。
1. **Retail Cloud Scale Unit の名前**について、リストから RCSU を選択します (リストには 1 つのオプションのみがあります)。
1. **E コマースの地域**は自動的に設定され、変更できません。
1. **次へ** をクリックして続行します。
1. **サポートされるホスト名**について、有効なドメイン (www.fabrikam.com など) を入力します。
1. **システム管理者の AAD セキュリティ グループ**について、E コマースのシステム管理者グループとして使用したい AAD SG ID を入力します。
1. **評価とレビュー モデレーター用 AAD セキュリティ グループ**について、評価とレビュー モデレーター グループとして使用したい AAD SG ID を入力します。
1. **B2C** の値を空のままにします (B2C で始まる 7 つのフィールド)。
1. **評価とレビュー サービスを有効にする**を有効にしたままにしておきます。
1. **初期化**をクリックします。
1. **E コマース (プレビュー)** タブが有効化され、**小売管理**ビューに戻ります。 E コマースの初期化を開始しました。
1. 続行する前に、E コマースの初期化状態が**初期化成功**になるまでお待ちください。
1. 右下の**リンク**の下です。
    * **E コマース サイト**のリンクをメモしておきます。 これは、C2 サイトのルートへのリンクです。
    * **E コマース サイトの管理ツール**のリンクをメモしておきます。 これは、サイト管理ツール (C1 作成ツール) へのリンクです。
## <a name="post-provisioning-steps"></a>プロビジョニング後の手順
この段階で環境はエンド ツー エンドにプロビジョニングされていますが、環境の評価を開始する前に実行する必要のあるコンフィギュレーション手順があります。
### <a name="before-starting"></a>開始する前に
1. トップ メニューで、**クラウド ホスト環境**を選択します。
1. リストから、環境を選択します。
1. 右側の環境情報から**完全な詳細**をクリックします。
1. **ログイン**をクリックしてメニューを開き、**環境にログオン**を選択します。

**USRT** 法人が選択されていることを確認します (右上隅)。

### <a name="configure-pos"></a>POS のコンフィギュレーション
##### <a name="associate-worker-with-your-identity"></a>作業者と ID の関連付け
1. 左側のメニューを使用して、**モジュール > 小売 > 従業員 > 作業者**の順に移動します。
1. リストで、レコード **000713 - アンドリュー コレット**を見つけ、選択します。
1. アクション ウィンドウで、**小売**をクリックします。
1. **既存の ID の関連付け**をクリックします。
1. **電子メール**フィールド (**電子メールを使用した検索**の右)、電子メール アドレスを入力します。
1. **検索**をクリックします。
1. レコードと名前を選択します。
1. **OK**をクリックします。
1. **保存**をクリックします。
##### <a name="activate-cloud-pos"></a>クラウド POS の有効化
1. LCS ポータルへのログイン
1. プロジェクトに移動します。
1. トップ メニューで、**クラウド ホスト環境**を選択します。
1. リストから、環境を選択します。
1. 右側の環境情報から**完全な詳細**をクリックします。
1. **ログイン**をクリックしてメニューを開き、**クラウド販売時点管理にログオンする**を選択すると、POS が読み込みます。
1. **次へ** をクリックします。
1. AAD アカウントを使用してログインします。
1. **店舗名**の下で、**サンフランシスコ**を選択します。
1. **次へ** をクリックします。
1. **レジスターとデバイス**の下で、**SANFRAN-1** を選択します。
1. **有効化** をクリックします。
1. ログアウトしていて、POS ログイン画面で終了する必要があります。
1. オペレーター ID **000713** およびパスワード **123** を使用して、クラウド POS エクスペリエンスにログインできるようになりました。
### <a name="site-setup"></a>サイトの設定
1. 以前にメモした URL を使用して、**サイト管理ツール**にログインします。
1. **Fabrikam** サイトをクリックして、サイトの設定ダイアログを開きます。
1. ドメインについて、以前 E コマースを初期化した時に入力したドメインを選択します。
1. 既定のチャネルについて、**Fabrikam 拡張オンライン ストア**を選択します。 *メモ:**拡張**オンライン ストアが選択されていることを確認してください*
1. 既定の言語について、**en-us** を選択します。
1. **パス**はそのままにしておきます。
1. **OK**をクリックします。
1. サイトのページのリストに送信されます。
### <a name="enable-jobs"></a>ジョブの有効化
1. 環境 (HQ) にログインします。
1. 左側のメニューを使用して、**Retail > 照会およびレポート > バッチ ジョブ**の順に移動します。
1. 下のリストの各ジョブに対して、次の手順を実行します。
    * **小売用の注文電子メール通知の処理**。
    * **製品の使用可能性**。
    * **P-0001**。
    * **注文ジョブを同期します**。
1. クイック フィルターを使用し、名前を使用してジョブを検索します (上記のリストを参照)。
1. ジョブの状態が**源泉徴収**の場合、次の手順を実行します。
    1. レコードを選択します。
    1. アクション ウィンドウから、**バッチ ジョブ** -リボン を開き、**状態の変更**をクリックします。
    1. **待機中**を選択し、**OK** をクリックします。
### <a name="run-full-data-sync"></a>完全データ同期の実行
1. 左側にあるメニューを使用して、**モジュール > 小売り > 本社の設定 > 小売用スケジューラ > チャネル データベース**に移動します。
1. **既定**のチャネルは、左側のリストから選択できます。 *使用可能な他のチャネル (**scXXXXXXXXX**) を選択します*。
1. アクション ウィンドウから、**完全なデータの同期**を選択します。
1. 配送スケジュールとして **9999** を入力します。
1. **OK**をクリックします。
1. **OK**をクリックします。
### <a name="after-these-steps-you-are-ready-to-start-evaluating-your-preview-environment"></a>これらの手順を実行した後、プレビュー環境の評価を開始する準備が整います。
**E コマース サイトの管理ツール**の URL を使用して、C1 作成エクスペリエンスに移動し、**E コマース サイト**の URL を使用して、C2 サイト エクスペリエンスに移動します。

## <a name="additional-resources"></a>追加リソース
### <a name="how-to-find-your-aad-tenant-id"></a>AAD テナント ID を検索する方法
AAD テナント ID は GUID で、この例のようになります: **72f988bf-86f1-41af-91ab-2d7cd011db47**
##### <a name="from-azure-portal"></a>Azure ポータルから
1. Azure ポータル https://portal.azure.com/ にログインします。
1. 正しいディレクトリが選択されていることを確認してください。
1. 左側のメニューから **Azure Active Directory** をクリックします。
1. **管理**の下の**プロパティ**をクリックします。
1. AAD テナント ID は、**ディレクトリ ID** の下に表示されます。
##### <a name="from-openid-connect-metadata"></a>OpenID Connect のメタデータから
**\{YOUR_DOMAIN\}** を自分のドメインに置換することにより、**OpenID URL** を作成します。例、microsoft.com: https://login.microsoftonline.com/{YOUR_DOMAIN}/.well-known/openid-configurationhttps://login.microsoftonline.com/microsoft.com/.well-known/openid-configuration

1. 自分のドメインを使用して **OpenID URL** に移動します。
1. AAD テナント ID は、複数のプロパティ値で表示できます。
1. **authorization_endpoint** を検索し、**login.microsoftonline.com/** 直後の GUID を抽出します。
### <a name="how-to-find-the-id-of-your-aad-security-group"></a>AAD セキュリティ グループの ID を検索する方法
AAD セキュリティ グループ ID は GUID で、この例のようになります: **436ea7f5-ee6c-40c1-9f08-825c5811066a**

この手順は、ユーザーが ID を検索しようとしているグループのメンバーであるとします。
1. グラフ エクスプローラーに移動します: https://developer.microsoft.com/en-us/graph/graph-explorer#
1. **Microsoft によるサインイン**をクリックし、資格情報を使用してサインインします。
1. サインインの後、左側から**さらにサンプルを表示**をクリックします。
1. 右側のウィンドウから**グループ**を有効にします。
1. 右側のウィンドウを閉じます。
1. **所属するすべてのグループ**をクリックします。
1. **応答プレビュー** テキスト ボックスからグループを検索します。
1. セキュリティ グループ ID は、プロパティ **ID** の下に表示されています。
### <a name="test-credit-card-information-to-perform-test-purchases"></a>テスト購買を実行するためのクレジット カード情報のテスト
サイトでテスト トランザクションを実行するために、このテスト クレジット カード情報を使用できます。

カード番号: 4111-1111-1111-1111、有効期限: 10/20、CVV: 737

*メモ: どのような状況でも、テスト サイトで実際のクレジット カード情報は使用しないでください。*
### <a name="useful-links"></a>役に立つリンク
* [LCS (Lifecycle Services)](https://docs.microsoft.com/en-us/dynamics365/unified-operations/dev-itpro/lifecycle-services/lcs-user-guide)
* [RCSU (Retail Cloud Scale Unit)](https://docs.microsoft.com/en-us/business-applications-release-notes/october18/dynamics365-retail/retail-cloud-scale-unit)
* [Microsoft Azure ポータル](https://azure.microsoft.com/en-us/features/azure-portal)
* [Dynamics 365 Commerce Web サイト](https://aka.ms/Dynamics365CommerceWebsite)
* [Dynamics 365 Retail のヘルプ リソース](../retail/index.md)
### <a name="microsoft-dynamics-365-commerce-preview-support"></a>Microsoft Dynamics 365 Commerce Preview のサポート
プロビジョニングの手順を実行している間に問題が発生する場合、[Microsoft Dynamics 365 Commerce Preview Yammer グループ](https://aka.ms/Dynamics365CommercePreviewYammer) を参照してください。 

Yammer グループにアクセスする際に問題が発生した場合、電子メール **Dynamics365Commerce@microsoft.com** にて問い合わせることもできます。 この電子メール アドレスはアクティブに監視されていないので、応答の遅延が予想されます。
***
## <a name="prerequisites-for-optional-features"></a>オプション機能の前提条件
トランザクション電子メール機能を評価する場合、次の前提条件を満たす必要があります。
* プレビュー環境をプロビジョニングする Azure サブスクリプションから使用できる電子メール サーバー (SMTP サーバー) が使用可能。
* サーバーの FQDN/IP、SMTP ポート番号、および認証の詳細が利用可能。

デジタル資産管理機能を評価する場合、特に新しいオムニチャネル画像を取り込む場合は、次の前提条件を満たす必要があります。
* **CMS テナント名**が使用可能である必要があります。 この名前を検索する指示は次のとおりです。
### <a name="configure-image-backend-optional"></a>イメージ バックエンドのコンフィギュレーション (オプション)
##### <a name="finding-your-media-base-url"></a>メディア ベース URLの検索
*メモ: この手順を完了する前に、**サイト設定**を完了する必要があります。*
1. 以前にメモした URL を使用して、サイト管理ツールにログインします。
1. **Fabrikam** サイトを開きます。
1. 左のメニューから**資産**を選択します。
1. 1 つの画像資産を選択します。
1. 右側のプロパティ インスペクターから**パブリック URL** を検索します。 URL が含まれています。
    * URL の例: https://images-us-sb.cms.commerce.dynamics.com/cms/api/fabrikam/imageFileData/MA1nQC
1. URL の最後の識別子 (上記の URL の例では MA1nQC) を、次の文字列で置換します: **search?fileName=**
    * 置換後の URL の例: https://images-us-sb.cms.commerce.dynamics.com/cms/api/fabrikam/imageFileData/search?fileName=
    * これは、**メディア ベース URL** です - メモしておいてください。
##### <a name="updating-the-media-base-url"></a>メディア ベース URL の更新
1. 環境 (HQ) にログインします。
1. 左側にあるメニューを使用して、**モジュール > 小売 > チャネルの設定 > チャネルのプロファイル**に移動します。
1. **編集** をクリックします。
1. **プロファイルのプロパティ**から、**メディア サーバー ベース URL** のプロパティ値を、以前に作成した**メディア ベース URL** で置き換えます。
1. **既定**のチャネルの下で、左側のリストから他のチャネルを選択します。
1. **プロファイル プロパティ**の下の **+ 追加**をクリックします。
1. 追加されたプロパティについて、**メディア サーバー ベース URL** をプロパティ キーとして選択し、プロパティ値については、以前に作成した**メディア ベース URL** を入力します。
1. **保存**をクリックします。

### <a name="configure-email-server-optional"></a>電子メール サーバーのコンフィギュレーション (オプション)
ここで入力する SMTP サーバーまたは電子メール サービスは、環境に使用している Azure サブスクリプションからアクセスできる必要があります。
1. 環境 (HQ) にログインします。
1. 左側にあるメニューを使用して、**モジュール > 小売 > 本社の設定 > パラメーター > 電子メールパラメーター**の順に移動します。
1. **SMTP 設定**タブをクリックします。
1. **送信メール サーバー フィールド**に、SMTP サーバーまたは電子メール サービスの FQDN または IP アドレスを入力します。
1. **SMTP ポート番号**フィールドに、ポート番号を入力します (既定値は、SSLを使用していない場合は25です)。
1. **ユーザー名**フィールドについて、値を入力します (承認が必要)。
1. **パスワード** フィールドについて、値を入力します (承認が必要)。
1. **保存**をクリックします。
1. **更新**をクリックします。
1. **テスト電子メール** タブをクリックします。
1. 電子メール プロバイダー フィールドで、**SMTP** を選択します。
1. **送信先**フィールドで、テスト電子メールの配信先となる電子メール アドレスを入力します。
1. **テスト電子メールの送信**をクリックします。
### <a name="configure-email-templates-optional"></a>電子メール テンプレートのコンフィギュレーション (オプション)
有効な送信者の電子メールアドレスで更新する必要がある、電子メールを送信する各トランザクション イベントの電子メール テンプレート。
1. 左側にあるメニューを使用して、**モジュール > 組織管理者 > 設定 > 組織の電子メール設定**の順に移動します。
1. **リストを表示**をクリックします。
1. リストの各テンプレートに対して、次の操作を行います。
    1. **送信者の電子メール** フィールドに、この電子メール テンプレートの送信者の電子メールアドレスを入力します。
    1. (オプション) **送信者名**フィールドに、この電子メール テンプレートの送信者として使用される名前を入力します。
1. **保存**をクリックします。
### <a name="customizing-email-templates-optional"></a>電子メール テンプレートのカスタマイズ (オプション)
電子メール テンプレートをカスタマイズして別の画像を使用したり、テンプレート内のリンクを更新してプレビュー環境にリンクしたりすることができます。 次の手順では、既定のテンプレートをダウンロードし、システムのテンプレートを更新する方法について説明します。
1. ブラウザーを使用して、次の HTML ドキュメントを含む [Microsoft Dynamics 365 Commerce Preview の既定の電子メールアドレス テンプレート .zip ファイル](https://download.microsoft.com/download/d/7/b/d7b6c4d4-fe09-4922-9551-46bbb29d202d/Commerce.Preview.Default.Email.Templates.zip) 含むMicrosoft Previewの既定の電子メールテンプレート .zipファイルをダウンロードします。
    1. 注文確認モジュール テンプレート
    1. ギフト カード テンプレートの発行
    1. 新しい注文テンプレート
    1. 注文テンプレートのパック
    1. 注文テンプレートのピック
1. テキストまたは HTML エディターを使用してテンプレートをカスタマイズします。 サポートされているトークンのリストを参照してください。
1. 環境 (HQ) にログインします。
1. 左側にあるメニューを使用して、**モジュール > 小売 > 本社の設定 > パラメーター > 組織の電子メールのテンプレート**の順に移動します。
1. 左のリストを展開すると、すべてのテンプレートが表示されます。
1. カスタマイズする各テンプレートについて、次の手順を実行します。
    1. リストから、テンプレートを選択します。
    1. **電子メール メッセージのコンテンツ**の下で、リストから適切な言語バージョンを選択します (既定値は**en-us**)。
    1. **電子メール メッセージのコンテンツ**の下で、**編集**をクリックすると、**電子メール テンプレートのアップロード** ウィンドウが開きます。
    1. **参照**をクリックし、カスタマイズされたコンテンツを含む HTML ファイルを検索します。
    1. **アップロード**をクリックすると、テンプレートがシステムにアップロードされ、プレビューが表示されます。
    1. **OK**をクリックします。
    1. (オプション) テンプレートの**件名**プロパティをカスタマイズします。
    1. **保存**をクリックします。

#### <a name="supported-tokens-in-the-email-template"></a>電子メール テンプレートでサポートされているトークン
これらのトークンは、電子メールの表示時間に顧客と注文に適用される実際の値によって置換されます。

**販売注文** - 次のトークンは、販売注文全体に適用されます。

|トークンの名前|トークン|
|---|---|
|注文番号|%salesid%|
|顧客の名前|%customername%|
|配送先住所|%deliveryaddress%|
|請求先住所|%customeraddress%|
|注文日付|%shipdate%|
|荷渡方法|%modeofdelivery%|
|割引|%discount%|
|売上税|%tax%|
|注文合計|%total%|

**販売明細行** - 注文の各製品に対して次のトークンが設定されます。

*メモ:**製品リスト - 開始**および**製品リスト - 終了**のトークンを全製品に対して繰り返される HTML ブロックの先頭と末尾に配置します。*

|トークンの名前|トークン|
|---|---|
|製品リスト - 開始|\<!--%tablebegin.salesline% -->|
|Product list - 終了|\<!--%tableend.salesline%-->|
|製品名|%lineproductname%|
|説明|%lineproductdescription%|
|件数|%linequantity%|
|明細行の単価|%lineprice% (確認)|
|明細行の品目合計|%linenetamount%|
|明細行割引|%linediscount%|
|出荷日|%lineshipdate%|
|調達方法|%linedeliverymode%|
|配送先住所|%linedeliveryaddress%|
|明細行の販売単位|%lineunit%|

