---
title: コマース チャネルの会計統合の概要
description: このトピックでは、Dynamics 365 Commerce で使用できる会計統合の機能の概要を提供します。
author: josaw
manager: annbe
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.region: Global
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: 2f1abf29058e773f1645301fcd7a960df488d92b
ms.sourcegitcommit: deac22ba5377a912d93fe408c5ae875706378c2d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/16/2021
ms.locfileid: "5017470"
---
# <a name="overview-of-fiscal-integration-for-commerce-channels"></a><span data-ttu-id="f002f-103">コマース チャネルの会計統合の概要</span><span class="sxs-lookup"><span data-stu-id="f002f-103">Overview of fiscal integration for Commerce channels</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="f002f-104">はじめに</span><span class="sxs-lookup"><span data-stu-id="f002f-104">Introduction</span></span>

<span data-ttu-id="f002f-105">このトピックは、Dynamics 365 Commerce で使用できる会計統合の機能についての概要です。</span><span class="sxs-lookup"><span data-stu-id="f002f-105">This topic is an overview of the fiscal integration capabilities that are available in Dynamics 365 Commerce.</span></span> <span data-ttu-id="f002f-106">会計統合には、小売業界での税金の詐欺防止を目的とした地方の会計法に従って、販売の会計登録を可能にするさまざまな会計デバイスおよびサービスとの統合が含まれます。</span><span class="sxs-lookup"><span data-stu-id="f002f-106">Fiscal integration includes integration with various fiscal devices and services that enable fiscal registration of sales in accordance with local fiscal laws that are aimed at preventing tax fraud in the retail industry.</span></span> <span data-ttu-id="f002f-107">会計統合を使用してカバーすることができる典型的なシナリオを以下に示します:</span><span class="sxs-lookup"><span data-stu-id="f002f-107">Here are some typical scenarios that can be covered by using fiscal integration:</span></span>

- <span data-ttu-id="f002f-108">会計プリンターのような、POS (販売時点管理) に接続している会計デバイスに販売を登録してから、顧客に会計レシートを印刷します。</span><span class="sxs-lookup"><span data-stu-id="f002f-108">Register a sale on a fiscal device that is connected to point of sale (POS), such as a fiscal printer, and print a fiscal receipt for the customer.</span></span>
- <span data-ttu-id="f002f-109">Retail POS で完了した販売と返品に関する情報を、税務当局が運営する外部の Web サービスに安全に送信します。</span><span class="sxs-lookup"><span data-stu-id="f002f-109">Securely submit information that is related to sales and returns that are completed in Retail POS to an external web-service that is operated by the tax authority.</span></span>
- <span data-ttu-id="f002f-110">デジタル署名での販売トランザクション データの改ざん防止を保証するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="f002f-110">Help guarantee inalterability of sales transaction data through digital signatures.</span></span>

<span data-ttu-id="f002f-111">会計統合機能は、Retail POS と会計デバイスおよび会計サービスとの統合のさらなる開発とカスタマイズのための共通のソリューションを提供するフレームワークです。</span><span class="sxs-lookup"><span data-stu-id="f002f-111">The fiscal integration functionality is a framework that provides a common solution for further development and customization of the integration between Retail POS and fiscal devices and services.</span></span> <span data-ttu-id="f002f-112">この機能には、特定の国または地域の基本的なシナリオをサポートし、特定の会計デバイスまたはサービスと連携する会計統合サンプルも含まれています。</span><span class="sxs-lookup"><span data-stu-id="f002f-112">The functionality also includes fiscal integration samples that support basic scenarios for specific countries or regions, and that work with specific fiscal devices or services.</span></span> <span data-ttu-id="f002f-113">会計統合サンプルは、コマース コンポーネントのいくつかの拡張機能で構成され、ソフトウェア開発キット (SDK) が含まれます。</span><span class="sxs-lookup"><span data-stu-id="f002f-113">A fiscal integration sample consists of several extensions of Commerce components and is included in the software development kit (SDK).</span></span> <span data-ttu-id="f002f-114">会計統合のサンプルの詳細については、「[Retail SDK の会計統合のサンプル](#fiscal-integration-samples-in-the-retail-sdk)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-114">For more information about the fiscal integration samples, see [Fiscal integration samples in the Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span></span> <span data-ttu-id="f002f-115">小売 SDK のダウンロードと使用方法については、[小売 ソフトウェアの開発キット (SDK) のアーキテクチャ](../dev-itpro/retail-sdk/retail-sdk-overview.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-115">For information about how to install and use the Retail SDK, see [Retail software development kit (SDK) architecture](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span></span>

<span data-ttu-id="f002f-116">他の会計デバイスまたはサービスと Retail POS を統合する、または他の国や地域の要件をカバーするために、会計統合サンプルでサポートされていない他のシナリオをサポートするには、既存の会計統合サンプルを拡張するか、例として既存のサンプルを使用することによって新しいサンプルを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-116">To support other scenarios that aren't supported by a fiscal integration sample, to integrate Retail POS with other fiscal devices or services, or to cover requirements of other countries or regions, you must either extend an existing fiscal integration sample or create a new sample by using an existing sample as an example.</span></span>

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a><span data-ttu-id="f002f-117">会計デバイスの会計登録プロセスおよび会計統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-117">Fiscal registration process and fiscal integration samples for fiscal devices</span></span>

<span data-ttu-id="f002f-118">Retail POS の会計登録プロセスは、1 つまたは複数のステップで構成できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-118">A fiscal registration process in Retail POS can consist of one or more steps.</span></span> <span data-ttu-id="f002f-119">各ステップには、1 つの会計デバイスまたはサービスでの特定の取引またはイベントの会計登録が含まれます。</span><span class="sxs-lookup"><span data-stu-id="f002f-119">Each step involves fiscal registration of specific transactions or events in one fiscal device or service.</span></span> <span data-ttu-id="f002f-120">次のソリューション コンポーネントは、ハードウェア ステーションに接続されている会計デバイスの会計登録に参加します:</span><span class="sxs-lookup"><span data-stu-id="f002f-120">The following solution components participate in the fiscal registration in a fiscal device that is connected to a Hardware station:</span></span>

- <span data-ttu-id="f002f-121">**Commerce runtime (CRT) 拡張機能** - このコンポーネントは、会計デバイスとのやり取りにも使用される形式でトランザクション/イベント データをシリアル化し、会計デバイスからの応答を解析し、その応答をチャネル データベースに格納します。</span><span class="sxs-lookup"><span data-stu-id="f002f-121">**Commerce runtime (CRT) extension** – This component serializes transaction/event data in the format that is also used for interaction with the fiscal device, parses responses from the fiscal device, and stores the responses in the channel database.</span></span> <span data-ttu-id="f002f-122">拡張機能は、登録する必要がある特定のトランザクションおよびイベントも定義します。</span><span class="sxs-lookup"><span data-stu-id="f002f-122">The extension also defines the specific transactions and events that must be registered.</span></span> <span data-ttu-id="f002f-123">このコンポーネントは多くの場合、*会計ドキュメント プロバイダー* と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="f002f-123">This component is often referred to as a *fiscal document provider*.</span></span>
- <span data-ttu-id="f002f-124">**ハードウェア ステーション拡張機能**- このコンポーネントは、会計デバイスとの通信を初期化し、会計ドキュメントから抽出されたトランザクション/イベント データに基づいて会計デバイスに要求とダイレクト コマンドを送信し、会計デバイスからの応答を受信します。</span><span class="sxs-lookup"><span data-stu-id="f002f-124">**Hardware station extension** – This component initializes the communication with the fiscal device, sends requests and direct commands to the fiscal device based on the transaction/event data that is extracted from the fiscal document, and receives responses from the fiscal device.</span></span> <span data-ttu-id="f002f-125">このコンポーネントは多くの場合、*会計コネクタ* と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="f002f-125">This component is often referred to as a *fiscal connector*.</span></span>

<span data-ttu-id="f002f-126">会計デバイスの会計統合サンプルには、会計ドキュメント プロバイダーおよび会計コネクター用の、CRT およびハードウェア ステーション拡張機能がそれぞれ含まれています。</span><span class="sxs-lookup"><span data-stu-id="f002f-126">A fiscal integration sample for a fiscal device contains the CRT and Hardware station extensions for a fiscal document provider and a fiscal connector, respectively.</span></span> <span data-ttu-id="f002f-127">次のコンポーネントの構成も含まれます:</span><span class="sxs-lookup"><span data-stu-id="f002f-127">It also contains the following component configurations:</span></span>

- <span data-ttu-id="f002f-128">**会計ドキュメント プロバイダー構成** - この構成は、出力メソッドおよび会計ドキュメントの形式を定義します。</span><span class="sxs-lookup"><span data-stu-id="f002f-128">**Fiscal document provider configuration** – This configuration defines an output method and a format for fiscal documents.</span></span> <span data-ttu-id="f002f-129">また、Retail POS からのデータと、会計デバイス ファームウェアで事前定義されている値との互換性を維持するための、税金と支払い方法のデータ マッピングも含まれています。</span><span class="sxs-lookup"><span data-stu-id="f002f-129">It also contains a data mapping for taxes and payment methods, to make data from Retail POS compatible with the values that are predefined in the fiscal device firmware.</span></span>
- <span data-ttu-id="f002f-130">**会計コネクタ構成** - この構成は、特定の会計デバイスとの物理的な通信を定義します。</span><span class="sxs-lookup"><span data-stu-id="f002f-130">**Fiscal connector configuration** – This configuration defines the physical communication with the specific fiscal device.</span></span>

<span data-ttu-id="f002f-131">特定の POS レジスターの会計登録プロセスは、POS 機能プロファイルの対応する設定によって定義されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-131">A fiscal registration process for a specific POS register is defined by a corresponding setting in the POS functionality profile.</span></span> <span data-ttu-id="f002f-132">会計登録プロセスの構成、会計ドキュメント プロバイダーおよび会計コネクタ構成のアップロード、およびそれらのパラメーターを変更する方法の詳細については、[会計登録プロセスの設定](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-132">For more details about how to configure a fiscal registration process, upload fiscal document provider and fiscal connector configurations, and change their parameters, see [Set up a fiscal registration process](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span></span>

<span data-ttu-id="f002f-133">次の例では、会計デバイスの一般的な会計登録実行フローを示します。</span><span class="sxs-lookup"><span data-stu-id="f002f-133">The following example shows a typical fiscal registration execution flow for a fiscal device.</span></span> <span data-ttu-id="f002f-134">フローは、POS でのイベント (たとえば、販売トランザクションの終了処理など) で始まり、次のステップのシーケンスを実装します。</span><span class="sxs-lookup"><span data-stu-id="f002f-134">The flow starts with an event in the POS (for example, finalization of a sales transaction) and implements the following sequence of steps:</span></span>

1. <span data-ttu-id="f002f-135">POSは、CRT から会計ドキュメントを要求します。</span><span class="sxs-lookup"><span data-stu-id="f002f-135">The POS requests a fiscal document from CRT.</span></span>
2. <span data-ttu-id="f002f-136">CRT は、現在のイベントが会計登録を必要とするかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="f002f-136">CRT determines whether the current event requires fiscal registration.</span></span>
3. <span data-ttu-id="f002f-137">会計登録プロセスの設定に基づいて、CRT は、会計登録に使用する会計コネクタおよび対応する会計ドキュメント プロバイダーを識別します。</span><span class="sxs-lookup"><span data-stu-id="f002f-137">Based on the fiscal registration process settings, CRT identifies a fiscal connector and corresponding fiscal document provider to use for the fiscal registration.</span></span>
4. <span data-ttu-id="f002f-138">CRT は、トランザクションまたはイベントを表す会計ドキュメント (たとえば、XML ドキュメント) を生成する会計ドキュメント プロバイダーを実行します。</span><span class="sxs-lookup"><span data-stu-id="f002f-138">CRT runs the fiscal document provider that generates a fiscal document (for example, an XML document) that represents the transaction or event.</span></span>
5. <span data-ttu-id="f002f-139">POS は、CRT が準備する会計ドキュメントをハードウェア ステーションに送信します。</span><span class="sxs-lookup"><span data-stu-id="f002f-139">The POS sends the fiscal document that CRT prepares to a Hardware station.</span></span>
6. <span data-ttu-id="f002f-140">ハードウェア ステーションは、会計ドキュメントを処理し、会計デバイスまたはサービスに通信する会計コネクタを実行します。</span><span class="sxs-lookup"><span data-stu-id="f002f-140">The Hardware station runs the fiscal connector that processes the fiscal document and communicates it to the fiscal device or service.</span></span>
7. <span data-ttu-id="f002f-141">POS は、会計デバイスまたはサービスからの応答を分析して、会計登録が正常に完了したかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="f002f-141">The POS analyzes the response from the fiscal device or service to determine whether the fiscal registration was successful.</span></span>
8. <span data-ttu-id="f002f-142">CRT は応答をチャネル データベースに保存します。</span><span class="sxs-lookup"><span data-stu-id="f002f-142">CRT saves the response to the channel database.</span></span>

<span data-ttu-id="f002f-143">![ソリューション スキーマ](media/emea-fiscal-integration-solution.png "ソリューション スキーマ")</span><span class="sxs-lookup"><span data-stu-id="f002f-143">![Solution schema](media/emea-fiscal-integration-solution.png "Solution schema")</span></span>

## <a name="error-handling"></a><span data-ttu-id="f002f-144">エラー処理</span><span class="sxs-lookup"><span data-stu-id="f002f-144">Error handling</span></span>

<span data-ttu-id="f002f-145">会計統合フレームワークは、会計登録中のエラーを処理するための次のオプションを提供します:</span><span class="sxs-lookup"><span data-stu-id="f002f-145">The fiscal integration framework provides the following options to handle failures during fiscal registration:</span></span>

- <span data-ttu-id="f002f-146">**再試行** – オペレーターは、エラーが迅速に解決され、会計登録が再実行される場合にこのオプションを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="f002f-146">**Retry** – Operators can use this option when the failure can be resolved quickly, and the fiscal registration can be rerun.</span></span> <span data-ttu-id="f002f-147">たとえば、会計デバイスが接続されていないときや、会計プリンターが用紙切れ、または会計プリンターで紙詰まりがあるときに、このオプションを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="f002f-147">For example, this option can be used when the fiscal device isn't connected, the fiscal printer is out of paper, or there is a paper jam in the fiscal printer.</span></span>
- <span data-ttu-id="f002f-148">**キャンセル** – このオプションを使用すると、オペレーターは現在のトランザクションまたはイベントの会計登録が失敗した場合に延期することができます。</span><span class="sxs-lookup"><span data-stu-id="f002f-148">**Cancel** – This option lets operators postpone the fiscal registration of the current transaction or event if it fails.</span></span> <span data-ttu-id="f002f-149">登録が延期された後も、オペレーターは POS の作業を続けることができ、会計登録に必要のない操作を完了することができます。</span><span class="sxs-lookup"><span data-stu-id="f002f-149">After the registration is postponed, the operator can continue to work on the POS and can complete any operation that the fiscal registration isn't required for.</span></span> <span data-ttu-id="f002f-150">会計登録を必要とするイベントが POS で発生すると (たとえば、新しいトランザクションが開かれると)、エラー処理ダイアログ ボックスが自動的に表示され、前のトランザクションが正しく登録されなかったことをオペレーターに通知し、エラー処理オプションを提供します。</span><span class="sxs-lookup"><span data-stu-id="f002f-150">When any event that requires the fiscal registration occurs in the POS (for example, a new transaction is opened), the error handling dialog box automatically appears to notify the operator that the previous transaction wasn't correctly registered and to provide the error handling options.</span></span>
- <span data-ttu-id="f002f-151">**スキップ** – 特定の条件下で会計登録を省略でき、POS で通常の操作を続行できる場合、オペレーターはこのオプションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-151">**Skip** – Operators can use this option when the fiscal registration can be omitted under specific conditions and regular operations can be continued on the POS.</span></span> <span data-ttu-id="f002f-152">たとえば、このオプションは、会計登録が失敗した販売トランザクションを特別な紙の仕訳帳に登録できる場合に使用できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-152">For example, this option can be used when a sales transaction that the fiscal registration failed for can be registered in a special paper journal.</span></span>
- <span data-ttu-id="f002f-153">**登録済としてマーク** – オペレーターは、トランザクションが会計デバイスに実際に登録されている (たとえば、会計レシートが印刷された) ときにこのオプションを使用できますが、会計応答がチャネル データベースに保存されているときにはエラーが発生しました。</span><span class="sxs-lookup"><span data-stu-id="f002f-153">**Mark as registered** – Operators can use this option when the transaction was actually registered in the fiscal device (for example, a fiscal receipt was printed), but a failure occurred when the fiscal response was being saved to the channel database.</span></span>

> [!NOTE]
> <span data-ttu-id="f002f-154">**スキップ** および **登録済としてマーク** オプションは、使用する前に、会計登録プロセスで有効化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-154">The **Skip** and **Mark as registered** options must be activated in the fiscal registration process before they are used.</span></span> <span data-ttu-id="f002f-155">さらに、対応するアクセス許可をオペレーターに付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-155">In addition, corresponding permissions must be granted to operators.</span></span>

<span data-ttu-id="f002f-156">**スキップ** および **登録済としてマーク** オプションを使用すると、エラーの理由や会計登録をスキップしたりトランザクションを登録済としてマークすることの妥当性など、エラーに関する特定の情報を取得できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-156">The **Skip** and **Mark as registered** options enable info codes to capture some specific information about the failure, such as the reason for the failure or a justification for skipping the fiscal registration or marking the transaction as registered.</span></span> <span data-ttu-id="f002f-157">エラー処理のパラメーターを設定する方法の詳細については、[エラー処理の設定](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-157">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="optional-fiscal-registration"></a><span data-ttu-id="f002f-158">任意の会計登録</span><span class="sxs-lookup"><span data-stu-id="f002f-158">Optional fiscal registration</span></span>

<span data-ttu-id="f002f-159">会計登録は、いくつかの操作では必須ですが、他の操作ではオプションの場合があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-159">Fiscal registration might be mandatory for some operations but optional for others.</span></span> <span data-ttu-id="f002f-160">たとえば、通常の販売および返品の会計登録は必須かもしれませんが、顧客預金に関連する操作の会計登録はオプションの場合があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-160">For example, the fiscal registration of regular sales and returns might be mandatory, but the fiscal registration of operations that are related to customer deposits might be optional.</span></span> <span data-ttu-id="f002f-161">この場合、販売の会計登録を完了していないとそれ以降の販売はブロックされますが、顧客預金の会計登録が完了していなくても、販売はブロックされません。</span><span class="sxs-lookup"><span data-stu-id="f002f-161">In this case, failure to complete the fiscal registration of a sale should block further sales, but failure to complete the fiscal registration of a customer deposit should not block further sales.</span></span> <span data-ttu-id="f002f-162">必須操作とオプション操作を区別するために、さまざまなドキュメント プロバイダーを介してそれらを処理し、それらのプロバイダーの会計登録プロセスに別々のステップを設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f002f-162">To distinguish mandatory and optional operations, we recommend that you handle them through different document providers, and that you set up separate steps in the fiscal registration process for those providers.</span></span> <span data-ttu-id="f002f-163">オプションの会計登録に関連するすべてのステップで、**エラーでも続行** パラメーターを有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-163">The **Continue on error** parameter should be enabled for any step that is related to optional fiscal registration.</span></span> <span data-ttu-id="f002f-164">エラー処理のパラメーターを設定する方法の詳細については、[エラー処理の設定](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-164">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="manually-running-fiscal-registration"></a><span data-ttu-id="f002f-165">会計登録を手動で実行</span><span class="sxs-lookup"><span data-stu-id="f002f-165">Manually running fiscal registration</span></span>

<span data-ttu-id="f002f-166">トランザクションまたはイベントの会計登録が失敗後に延期された場合 (たとえば、オペレーターがエラー処理ダイアログ ボックスで **キャンセル** を選択した場合)、 対応する操作を呼び出して手動で会計登録を再実行できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-166">If the fiscal registration of a transaction or event has been postponed after a failure (for example, if the operator selected **Cancel** in the error handling dialog box), you can manually rerun the fiscal registration by invoking a corresponding operation.</span></span> <span data-ttu-id="f002f-167">詳細については、[延期された会計登録の手動実行を有効にする](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-167">For more details, see [Enable manual execution of postponed fiscal registration](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span></span>

### <a name="fiscal-registration-health-check"></a><span data-ttu-id="f002f-168">会計登録の正常性チェック</span><span class="sxs-lookup"><span data-stu-id="f002f-168">Fiscal registration health check</span></span>

<span data-ttu-id="f002f-169">会計登録の正常性チェック手順では、特定のイベントが発生したときに会計デバイスまたはサービスの使用可能性を確認します。</span><span class="sxs-lookup"><span data-stu-id="f002f-169">The health check procedure for fiscal registrations verifies the availability of the fiscal device or service when specific events occur.</span></span> <span data-ttu-id="f002f-170">会計登録を現在完了することができない場合は、オペレーターに事前に通知されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-170">If the fiscal registration can't currently be completed, the operator is notified in advance.</span></span>

<span data-ttu-id="f002f-171">次のイベントが発生すると、POS は正常性チェックを実行します。</span><span class="sxs-lookup"><span data-stu-id="f002f-171">The POS runs the health check when the following events occur:</span></span>

- <span data-ttu-id="f002f-172">新しいトランザクションが開く。</span><span class="sxs-lookup"><span data-stu-id="f002f-172">A new transaction is opened.</span></span>
- <span data-ttu-id="f002f-173">一時停止したトランザクションが呼び出される。</span><span class="sxs-lookup"><span data-stu-id="f002f-173">A suspended transaction is recalled.</span></span>
- <span data-ttu-id="f002f-174">販売または返品トランザクションが確定する。</span><span class="sxs-lookup"><span data-stu-id="f002f-174">A sales or return transaction is finalized.</span></span>

<span data-ttu-id="f002f-175">正常性チェックが失敗すると、POS は正常性チェック ダイアログ ボックスを表示します。</span><span class="sxs-lookup"><span data-stu-id="f002f-175">If the health check fails, the POS shows the health check dialog box.</span></span> <span data-ttu-id="f002f-176">このダイアログ ボックスには、次のボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-176">This dialog box provides the following buttons:</span></span>

- <span data-ttu-id="f002f-177">**OK**: このボタンをクリックすると、オペレーターは正常性チェックのエラーを無視して操作の処理を続行できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-177">**OK** – This button lets the operator ignore a health check error and continue to process the operation.</span></span> <span data-ttu-id="f002f-178">**正常性チェック エラーのスキップを許可** が有効になっている場合にのみ、オペレーターはこのボタンを選択することができます。</span><span class="sxs-lookup"><span data-stu-id="f002f-178">Operators can select this button only if the **Allow skip health check error** permission is enabled for them.</span></span>
- <span data-ttu-id="f002f-179">**キャンセル** : オペレーターがこのボタンを選択すると、POS は最後のアクションをキャンセルします (たとえば、アイテムは新しいトランザクションに追加されません)。</span><span class="sxs-lookup"><span data-stu-id="f002f-179">**Cancel** – If the operator selects this button, the POS cancels the last action (for example, an item isn't added to a new transaction).</span></span>

> [!NOTE]
> <span data-ttu-id="f002f-180">正常性チェックは、現在の操作で会計登録が必要な場合、および会計登録プロセスの現在のステップで **エラーでも続行** パラメーターが無効になっている場合のみ実行されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-180">The health check is run only if the current operation requires fiscal registration, and if  the **Continue on error** parameter is disabled for the current step of the fiscal registration process.</span></span> <span data-ttu-id="f002f-181">詳細については、[エラー処理の設定](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-181">For more details, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

## <a name="storing-fiscal-response-in-fiscal-transaction"></a><span data-ttu-id="f002f-182">会計トランザクションの会計応答を保存しています。</span><span class="sxs-lookup"><span data-stu-id="f002f-182">Storing fiscal response in fiscal transaction</span></span>

<span data-ttu-id="f002f-183">トランザクションまたはイベントの会計登録が成功すると、チャネル データベースに会計トランザクションが作成され、元のトランザクションまたはイベントにリンクされます。</span><span class="sxs-lookup"><span data-stu-id="f002f-183">When fiscal registration of a transaction or event is successful, a fiscal transaction is created in the channel database and linked to the original transaction or event.</span></span> <span data-ttu-id="f002f-184">同様に、**スキップ** または **登録済としてマーク** オプションが、失敗した会計登録に対して選択されている場合、この情報は会計トランザクションに格納されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-184">Similarly, if the **Skip** or **Mark as registered** option is selected for a failed fiscal registration, this information is stored in a fiscal transaction.</span></span> <span data-ttu-id="f002f-185">会計トランザクションには、会計デバイスまたはサービスの会計応答が保持されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-185">A fiscal transaction holds the fiscal response of the fiscal device or service.</span></span> <span data-ttu-id="f002f-186">会計登録プロセスがいくつかのステップで構成されている場合は、登録の成功または失敗をもたらしたプロセスの各ステップに対して会計トランザクションが作成されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-186">If the fiscal registration process consists of several steps, a fiscal transaction is created for each step of the process that resulted in a successful or failed registration.</span></span>

<span data-ttu-id="f002f-187">会計トランザクションは、トランザクションと共に *P ジョブ* によって本社に転送されます。</span><span class="sxs-lookup"><span data-stu-id="f002f-187">Fiscal transactions are transferred to Headquarters by the *P-job*, together with transactions.</span></span> <span data-ttu-id="f002f-188">**店舗のトランザクション** ページの **トランザクション** クイック タブで、小売トランザクションにリンクされている会計トランザクションを表示することができます。</span><span class="sxs-lookup"><span data-stu-id="f002f-188">On the **Fiscal transactions** FastTab of the **Store transactions** page, you can view the fiscal transactions that are linked to transactions.</span></span>

<span data-ttu-id="f002f-189">会計トランザクションには、次の詳細が格納されます:</span><span class="sxs-lookup"><span data-stu-id="f002f-189">A fiscal transaction stores the following details:</span></span>

- <span data-ttu-id="f002f-190">会計登録プロセスの詳細 (プロセス、コネクタ グループ、コネクタなど)。</span><span class="sxs-lookup"><span data-stu-id="f002f-190">Fiscal registration process details (process, connector group, connector, and so on).</span></span> <span data-ttu-id="f002f-191">この情報が会計応答に含まれている場合は、**登録番号** フィールドに、会計デバイスのシリアル番号も格納します。</span><span class="sxs-lookup"><span data-stu-id="f002f-191">It also stores the serial number of the fiscal device in the **Register number** field, if this information is included in the fiscal response.</span></span>
- <span data-ttu-id="f002f-192">会計登録のステータス: 登録が成功した場合は **完了**、オペレーターが失敗した登録に **スキップ** オプションを選択した場合は **スキップ済**、オペレーターが **登録済としてマーク** オプションを選択した場合は **登録済としてマーク済**。</span><span class="sxs-lookup"><span data-stu-id="f002f-192">The status of the fiscal registration: **Completed** for successful registration, **Skipped** if the operator selected the **Skip** option for a failed registration, or **Marked as registered** if the operator selected the **Mark as registered** option.</span></span>
- <span data-ttu-id="f002f-193">選択した会計トランザクションに関連する情報コード トランザクション。</span><span class="sxs-lookup"><span data-stu-id="f002f-193">Info code transactions that are related to a selected fiscal transaction.</span></span> <span data-ttu-id="f002f-194">情報コード トランザクションを表示するには、**会計トランザクション** クイック タブで、ステータスが **スキップ済** または **登録済としてマーク済** になっている会計トランザクションを選択してから、**情報コード トランザクション** を選択します。</span><span class="sxs-lookup"><span data-stu-id="f002f-194">To view the info code transactions, on the **Fiscal transactions** FastTab, select a fiscal transaction that has a status of **Skipped** or **Marked as registered**, and then select **Info code transactions**.</span></span>

## <a name="fiscal-texts-for-discounts"></a><span data-ttu-id="f002f-195">割引用の会計テキスト</span><span class="sxs-lookup"><span data-stu-id="f002f-195">Fiscal texts for discounts</span></span>

<span data-ttu-id="f002f-196">国や地域によっては、さまざまな種類の割引が適用される場合に、会計レシートに印刷する必要がある追加のテキストについての特別な要件があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-196">Some countries or regions have special requirements about additional texts that must be printed on fiscal receipts when different kinds of discounts are applied.</span></span> <span data-ttu-id="f002f-197">会計統合機能を使用すると、会計レシートの割引明細行の後に印刷される割引用の特別なテキストを設定できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-197">The fiscal integration functionality lets you set up a special text for a discount that is printed after a discount line on a fiscal receipt.</span></span> <span data-ttu-id="f002f-198">手動割引の場合は、POS 機能プロファイルで **製品割引** 情報コードとして指定されている情報コードの会計テキストを構成できます。</span><span class="sxs-lookup"><span data-stu-id="f002f-198">For manual discounts, you can configure a fiscal text for the info code that is specified as the **Product discount** info code in the POS functionality profile.</span></span> <span data-ttu-id="f002f-199">割引用の会計テキストを設定する方法の詳細については、[割引用の会計のテキストの設定](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-199">For more details about how to set up fiscal texts for discounts, see [Set up fiscal texts for discounts](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span></span>

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a><span data-ttu-id="f002f-200">会計 X および会計 Z レポートの印刷</span><span class="sxs-lookup"><span data-stu-id="f002f-200">Printing fiscal X and fiscal Z reports</span></span>

<span data-ttu-id="f002f-201">会計統合機能は、統合された会計デバイスまたはサービスに固有の、営業終了時の明細書の生成をサポートします:</span><span class="sxs-lookup"><span data-stu-id="f002f-201">Fiscal integration functionality supports generation of end-of-day statements that are specific to the integrated fiscal device or service:</span></span>

- <span data-ttu-id="f002f-202">POS 画面レイアウトには、対応する操作を実行する新しいボタンを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-202">New buttons that run corresponding operations should be added to the POS screen layout.</span></span> <span data-ttu-id="f002f-203">詳細については、[会計 X/Z レポートを POS から設定する](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f002f-203">For more details, see [Set up fiscal X/Z reports from the POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span></span>
- <span data-ttu-id="f002f-204">会計統合サンプルでは、これらの操作は会計デバイスの対応する操作に一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f002f-204">In the fiscal integration sample, these operations should be matched to the corresponding operations of the fiscal device.</span></span>

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a><span data-ttu-id="f002f-205">Retail SDK の会計統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-205">Fiscal integration samples in the Retail SDK</span></span>

<span data-ttu-id="f002f-206">次の会計統合サンプルは、Retail SDK で現在使用できます:</span><span class="sxs-lookup"><span data-stu-id="f002f-206">The following fiscal integration samples are currently available in the Retail SDK:</span></span>

- [<span data-ttu-id="f002f-207">イタリア向け会計プリンター統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-207">Fiscal printer integration sample for Italy</span></span>](emea-ita-fpi-sample.md)
- [<span data-ttu-id="f002f-208">ポーランド向け会計プリンター統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-208">Fiscal printer integration sample for Poland</span></span>](emea-pol-fpi-sample.md)
- [<span data-ttu-id="f002f-209">オーストリア向け会計登録サービス統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-209">Fiscal registration service integration sample for Austria</span></span>](emea-aut-fi-sample.md)
- [<span data-ttu-id="f002f-210">チェコ共和国向け会計登録サービス統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-210">Fiscal registration service integration sample for Czech Republic</span></span>](emea-cze-fi-sample.md)
- [<span data-ttu-id="f002f-211">スウェーデン向け制御ユニットの統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-211">Control unit integration sample for Sweden</span></span>](./emea-swe-fi-sample.md)
- [<span data-ttu-id="f002f-212">ドイツ向け会計登録サービス統合サンプル</span><span class="sxs-lookup"><span data-stu-id="f002f-212">Fiscal registration service integration sample for Germany</span></span>](./emea-deu-fi-sample.md)

<span data-ttu-id="f002f-213">次の会計統合機能は、Retail SDK でも利用可能ですが、現在は会計統合フレームワークを利用していません。</span><span class="sxs-lookup"><span data-stu-id="f002f-213">The following fiscal integration functionality is also available in the Retail SDK but doesn't currently take advantage of the fiscal integration framework.</span></span> <span data-ttu-id="f002f-214">この機能の会計統合フレームワークへの移行は、今後の更新で予定されています。</span><span class="sxs-lookup"><span data-stu-id="f002f-214">Migration of this functionality to the fiscal integration framework is planned for later updates.</span></span>


- [<span data-ttu-id="f002f-215">フランス向けデジタル署名</span><span class="sxs-lookup"><span data-stu-id="f002f-215">Digital signature for France</span></span>](emea-fra-cash-registers.md)
- [<span data-ttu-id="f002f-216">ノルウェー向けデジタル署名</span><span class="sxs-lookup"><span data-stu-id="f002f-216">Digital signature for Norway</span></span>](emea-nor-cash-registers.md)

<span data-ttu-id="f002f-217">Retail SDK で使用可能な次のレガシ会計統合機能は、会計統合フレームワークを使用せず、それ以降の更新では推奨されません。</span><span class="sxs-lookup"><span data-stu-id="f002f-217">The following legacy fiscal integration functionality that is available in Retail SDK does not use the fiscal integration framework and will be deprecated in later updates:</span></span>

- [<span data-ttu-id="f002f-218">スウェーデン向け制御ユニットの統合サンプル (レガシ)</span><span class="sxs-lookup"><span data-stu-id="f002f-218">Control unit integration sample for Sweden (legacy)</span></span>](./retail-sdk-control-unit-sample.md)
