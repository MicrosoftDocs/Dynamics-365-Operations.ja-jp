---
title: ユーザーのサインインに対するカスタム ページの設定
description: このトピックでは Microsoft Dynamics 365 Commerce で、Azure Active Directory (Azure AD) 企業と顧客間 (B2C) テナントのユーザー向けにカスタマイズされたサインインを処理するカスタム ページを構築する方法について説明します。
author: brianshook
manager: annbe
ms.date: 06/16/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-commerce
ms.technology: ''
audience: Application user
ms.reviewer: v-chgri
ms.search.scope: Operations, Retail, Core
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: brshoo
ms.search.validFrom: 2019-10-31
ms.dyn365.ops.version: Release 10.0.5
ms.openlocfilehash: 71c0f0b6969985b04262b522dd2165eb1475878d
ms.sourcegitcommit: 9a2e9f7dfec47c42178bb67a3e099e610515baf3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/16/2020
ms.locfileid: "3456975"
---
# <a name="set-up-custom-pages-for-user-sign-ins"></a>ユーザーのサインインに対するカスタム ページの設定


[!include [banner](includes/banner.md)]

このトピックでは Microsoft Dynamics 365 Commerce で、Azure Active Directory (Azure AD) 企業と顧客間 (B2C) テナントのユーザー向けにカスタマイズされたサインインを処理するカスタム ページを構築する方法について説明します。

## <a name="overview"></a>概要

Dynamics 365 Commerce で作成されたカスタム ページを利用してユーザー サインイン フローを処理するには、コマース環境で参照される Azure AD ポリシーを設定する必要があります。 Azure AD B2C アプリケーションを使用して、「登録してサインイン」、「プロファイル編集」、および「パスワード リセット」 Azure AD B2C ポリシーをコンフィギュレーションできます。 その後、Microsoft Dynamics Lifecycle Services (LCS) を使用してコマース環境で実行されるプロビジョニング プロセス中に、Azure AD B2C テナントとポリシー名を参照できます。

カスタム コマース ページは、サインイン、登録、アカウント プロファイル編集、またはパスワード リセット モジュールを使用して構築できます。 これらのカスタム ページ用に公開されたページ URL は、Azure ポータルの Azure AD B2C ポリシー コンフィギュレーションで参照する必要があります。

## <a name="set-up-b2c-policies"></a>B2C ポリシーを設定する

Azure AD B2C テナントを設定し、コマース環境に関連付けた後、Azure ポータル **Azure AD B2C** ページに移動し、メニューの**ポリシー**で、**ユーザー フロー (ポリシー)** を選択します。

![メニューのユーザー フロー (ポリシー) コマンド](./media/B2C_CustomPage_PoliciesMenu.png)

「登録してサインイン」、「プロファイル編集」、および「パスワード リセット」 ユーザー サインイン フローをコンフィギュレーションできるようになりました。

### <a name="configure-the-sign-up-and-sign-in-policy"></a>「登録とサインイン」 ポリシーのコンフィギュレーション

「登録とサインイン」 ポリシーをコンフィギュレーションするには、次の手順を実行します。

1. **新しいユーザー フロー**を選択し、**推奨**タブで、**登録とサインイン** ポリシーを選択します。
1. ポリシーの名前を入力します (たとえば、**B2C\_1\_SignInSignUp**)。
1. **ID プロバイダー** セクションで、ポリシーに使用する ID プロバイダーを選択します。 少なくとも、**電子メールの登録**を選択する必要があります。
1. **属性の収集**の列で、**電子メール アドレス**、**指定された名前**、および**姓**のチェック ボックスをオンにします。
1. **返品クレーム**の列で、**電子メール アドレス**、**指定された名前**、**ID プロバイダー**、**姓**、および**ユーザー オブジェクト ID**のチェック ボックスをオンにします。

    ![選択された属性とクレーム](./media/B2C_SignInSignUp_Attributes.png)

1. **OK** を選択してポリシーを作成します。
1. 新しいポリシー名をダブルクリックし、ナビゲーション ウィンドウで**プロパティ**を選択します。
1. **JavaScript を使用したページ レイアウト (プレビュー) を有効にする**のオプションを**オン**に設定します。

    ![新しいポリシーのプロパティ ページ](./media/B2C_SignInSignUp_EnableJavascript.png)

> [!NOTE]
> ポリシー名は、コマース環境で完全に参照されます。 (**B2C\_1\_** の接頭語は参照に含まれます。) 作成したポリシーの名前を変更することはできません。 既存のコマース環境のポリシーを置き換える場合は、元のポリシーを削除して、同じ名前の新しいポリシーを作成することができます。 または、環境が既にプロビジョニングされている場合は、サービス要求を通じて新しいポリシー名を送信することもできます。

カスタム ページを作成した後、このポリシーに戻り設定を完了します。 ここでは、ポリシーを閉じて、Azure ポータルの**ユーザー フロー (ポリシー)** ページに戻ります。

### <a name="configure-the-profile-editing-policy"></a>「プロファイル編集」ポリシーのコンフィギュレーション

「プロファイル編集」をコンフィギュレーションするには、次の手順を実行します。

1. **新しいユーザー フロー**を選択し、**推奨**タブで、**プロファイル編集**ポリシーを選択します。
1. ポリシーの名前を入力します (たとえば、**B2C\_1\_EditProfile**)。
1. **ID プロバイダー** セクションで、ポリシーに使用する ID プロバイダーを選択します。 少なくとも、**ローカル アカウント サインイン**を選択する必要があります。
1. **属性の収集**の列で、**電子メール アドレス**および**姓**のチェック ボックスをオンにします。
1. **返品クレーム**の列で、**電子メール アドレス**、**指定された名前**、**ID プロバイダー**、**姓**、および**ユーザー オブジェクト ID**のチェック ボックスをオンにします。
1. **OK** を選択してポリシーを作成します。
1. 新しいポリシー名をダブルクリックし、ナビゲーション ウィンドウで**プロパティ**を選択します。
1. **JavaScript を使用したページ レイアウト (プレビュー) を有効にする**のオプションを**オン**に設定します。

カスタム ページを作成した後、このポリシーに戻り設定を完了します。 ここでは、ポリシーを閉じて、Azure ポータルの**ユーザー フロー (ポリシー)** ページに戻ります。

### <a name="configure-the-password-reset-policy"></a>「パスワードのリセット」 ポリシーのコンフィギュレーション

「パスワードのリセット」 ポリシーをコンフィギュレーションするには、次の手順を実行します。

1. **新しいユーザー フロー**を選択し、**プレビュー** タブで、**パスワード リセット v1.1** ポリシーを選択します。

    ![プレビュー タブで選択されたパスワード リセット v1.1 ポリシー](./media/B2C_ForgetPassword_Menu.png)

1. ポリシーの名前を入力します (たとえば、**B2C\_1\_ForgetPassword**)。
1. **ID プロバイダー** セクションで、**電子メールアドレスを使用したパスワードのリセット**を選択します。
1. **返品クレーム**の列で、**電子メール アドレス**、**指定された名前**、**姓**、および**ユーザー オブジェクト ID** のチェックボックスをオンにします。

    ![選択されたクレーム](./media/B2C_ForgetPassword_Attributes.png)

1. **OK** を選択してポリシーを作成します。
1. 新しいポリシー名をダブルクリックし、ナビゲーション ウィンドウで**プロパティ**を選択します。
1. **JavaScript を使用したページ レイアウト (プレビュー) を有効にする**のオプションを**オン**に設定します。

カスタム ページを作成した後、このポリシーに戻り設定を完了します。 ここでは、ポリシーを閉じて、Azure ポータルの**ユーザー フロー (ポリシー)** ページに戻ります。

## <a name="build-the-custom-pages"></a>カスタム ページの構築

ユーザーのサインインを処理するカスタム ページを作成するには、次の手順を実行します。

1. コマース作成ツールでサイトに移動します。
1. 次の 5 つのテンプレートと 5 ページを作成します。

    - サインイン モジュールを使用する**サインイン** テンプレートおよびページ。
    - 登録モジュールを使用する**登録**テンプレートおよびページ。
    - パスワード リセット モジュールを使用する**パスワードのリセット** テンプレートとページ。
    - パスワード リセット検証モジュールを使用する**パスワードのリセット検証**テンプレートとページ。
    - アカウント プロファイルの編集モジュールを使用する**プロファイル編集**テンプレートとページ

プロパティを作成するときは、次のガイドラインに従います。

- 各ページまたは各モジュールについて、ビジネス要件に最も適したレイアウトとスタイルを使用します。
- Azure AD B2C の設定で使用する必要があるすべてのページと URL を公開します。
- ページと URL を公開した後、Azure AD B2C ポリシーのコンフィギュレーションに使用する必要がある URL を収集します。 **?preloadscripts=true** 接尾語は、使用時にすべての URL に追加されます。

> [!IMPORTANT]
> 相対リンクが設定されている汎用のヘッダーおよびフッターを再利用しないようにします。 これらのページは、使用時に Azure AD B2C ドメインでホストされるので、すべてのリンクに対して絶対 URL を使用する必要があります。

## <a name="configure-azure-ad-b2c-policies-with-custom-page-information"></a>カスタム ページ情報を使用して、Azure AD B2C ポリシーをコンフィギュレーションする 

Azure ポータルで、**Azure AD B2C** ページに戻り、メニューの**ポリシー**で、**ユーザー フロー (ポリシー)** を選択します。

### <a name="update-the-sign-up-and-sign-in-policy-with-custom-page-information"></a>カスタム ページ情報で「登録とサインイン」 ポリシーを更新する

カスタム ページ情報で「登録とサインイン」 ポリシーを更新するには、次の手順を実行します。

1. 以前にコンフィギュレーションした**サインインと登録**ポリシーで、ナビゲーション ウィンドウで、**ページ レイアウト**を選択します。
1. **統一登録またはサインインのページ**のレイアウトを選択します。
1. **カスタム ページ コンテンツの使用**オプションを、**はい**に設定します。
1. **カスタム ページのURI** フィールドに、完全なサインイン URL を入力します。 **preloadscripts=true** 接尾語を含めます。 たとえば、「``www.<my domain>.com/sign-in?preloadscripts=true``」を入力します。
1. **ページ レイアウト バージョン (プレビュー)** フィールドで、**1.2.0** を選択します。
1. **ローカル アカウントの登録ページ**のレイアウトを選択します。
1. **カスタム ページ コンテンツの使用**オプションを、**はい**に設定します。
1. **カスタム ページの URI** フィールドに、完全なサインアップ URL を入力します。 **preloadscripts=true** 接尾語を含めます。 たとえば、「``www.<my domain>.com/sign-up?preloadscripts=true``」を入力します。
1. **ページ レイアウト バージョン (プレビュー)** フィールドで、**1.2.0** を選択します。
1. **ユーザー属性** セクションで、次の手順を実行します。

    1. **電子メール アドレス**、**指定された名前**、および**姓**の属性に対して、**必要な検証**フィールドで、**いいえ**を選択します。
    1. **指定された名前**、および**姓**の属性に対して、**オプション** フィールドで、**いいえ**を選択します。

    ![ローカル アカウントの登録ページ ポリシーのコンフィギュレーション](./media/B2C_SignUp_PageURLConfig.png)

### <a name="update-the-profile-editing-policy-with-custom-page-information"></a>カスタム ページ情報で「プロファイル編集」ポリシーを更新する

カスタム ページ情報で「プロファイル編集」ポリシーを更新するには、次の手順を実行します。

1. 以前にコンフィギュレーションした**プロファイル編集**ポリシーで、ナビゲーション ウィンドウで、**ページ レイアウト**を選択します。
1. **プロファイル編集ページ**のレイアウトを選択します。
1. **カスタム ページ コンテンツの使用**オプションを、**はい**に設定します。
1. **カスタム ページの URI** フィールドに、完全なプロファイル編集 URL を入力します。 **preloadscripts=true** 接尾語を含めます。 たとえば、「``www.<my domain>.com/profile-edit?preloadscripts=true``」を入力します。
1. **ページ レイアウト バージョン (プレビュー)** フィールドで、**1.2.0** を選択します。
1. **ユーザー属性** セクションで、次の手順を実行します。

    1. **電子メールアドレス**、**指定された名前**の属性に対して、**必要な検証**フィールドで**いいえ**を選択します。
    1. **指定された名前**、および**姓**の属性に対して、**オプション** フィールドで、**いいえ**を選択します。

### <a name="update-the-password-reset-policy-with-custom-page-information"></a>カスタム ページ情報で「パスワードのリセット」 ポリシーを更新する

カスタム ページ情報で「パスワードのリセット」 ポリシーを更新するには、次の手順を実行します。

1. 以前にコンフィギュレーションした**パスワードのリセット** ポリシーで、ナビゲーション ウィンドウで、**ページ レイアウト**を選択します。
1. **新しいパスワード ページ**のレイアウトを選択します。
1. **カスタム ページ コンテンツの使用**オプションを、**はい**に設定します。
1. **カスタム ページの URI** フィールドに、完全なパスワード リセット URL を入力します。 **preloadscripts=true** 接尾語を含めます。 たとえば、「``www.<my domain>.com/passwordreset?preloadscripts=true``」を入力します。
1. **ページ レイアウト バージョン (プレビュー)** フィールドで、**1.2.0** を選択します。
1. **アカウントの検証ページ**のレイアウトを選択します。
1. **カスタム ページ コンテンツの使用**オプションを、**はい**に設定します。
1. **カスタム ページの URI** フィールドに、完全なパスワード リセット検証 URL を入力します。 **preloadscripts=true** 接尾語を含めます。 たとえば、「``www.<my domain>.com/passwordreset-verification?preloadscripts=true``」を入力します。
1. **ページ レイアウト バージョン (プレビュー)** フィールドで、**1.2.0** を選択します。



## <a name="customize-default-text-strings-for-labels-and-descriptions"></a>ラベルと説明の既定のテキスト文字列のカスタマイズ

スターター キットでは、サインイン モジュールにはラベルと説明の既定のテキスト文字列が事前に入力されています。 サインイン モジュールの global.json ファイルの値を更新することにより、ソフトウェア開発キット (SDK) でこれらの文字列をカスタマイズできます。

たとえば、パスワード リンクを忘れた場合の既定のテキストは**パスワードをお忘れですか**です。 以下は、サインイン ページに表示される既定のテキストを示しています。

![サインイン ページでパスワード リンクを忘れた場合の既定のテキスト](./media/B2C_SignUp_ModuleFace.png)

ただし、スタート キット サインイン モジュールの global.json ファイルでは、次の図に示すように、**パスワードをお忘れですか**にテキストを編集することができます。

![サインイン モジュール global.json ファイルの更新されたリンク テキスト](./media/B2C_CustomizingStringsForModule.png)

global.json ファイルを更新して変更内容を公開すると、コマースとライブ サインイン ページの両方のサインイン モジュールに新しいリンク テキストが表示されます。

## <a name="additional-resources"></a>追加リソース

[ドメイン名のコンフィギュレーション](configure-your-domain-name.md)

[新しい E コマース サイトの配置](deploy-ecommerce-site.md)

[オンライン ストア チャネルのセットアップ](online-stores.md)

[E コマース サイトの作成](create-ecommerce-site.md)

[チャンネルとオンライン サイトの関連付け](associate-site-online-store.md)

[robots.txt ファイルの管理](manage-robots-txt-files.md)

[URL リダイレクトの一括アップロード](upload-bulk-redirects.md)

[B2C テナントを Commerce に 設定](set-up-B2C-tenant.md)

[Commerce 環境での複数の B2C テナントのコンフィギュレーション](configure-multi-B2C-tenants.md)

[コンテンツ配信ネットワーク (CDN) のサポートの追加](add-cdn-support.md)

[場所に基づく店舗検出の有効化](enable-store-detection.md)
