---
title: 明細書の算定のための店舗トランザクションの検証
description: この記事では、Microsoft Dynamics 365 Commerce で店舗トランザクションを検証するための機能について説明します。
author: analpert
ms.date: 01/31/2022
ms.topic: index-page
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgriffin
ms.custom: ''
ms.assetid: ed0f77f7-3609-4330-bebd-ca3134575216
ms.search.region: global
ms.search.industry: Retail
ms.author: analpert
ms.search.validFrom: 2019-01-15
ms.dyn365.ops.version: 10
ms.openlocfilehash: 4be40189777a37495f185467050b61af47b684d7
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/03/2022
ms.locfileid: "8890516"
---
# <a name="validate-store-transactions-for-statement-calculation"></a>明細書の算定のための店舗トランザクションの検証

[!include [banner](includes/banner.md)]

この記事では、Microsoft Dynamics 365 Commerce で店舗トランザクションを検証するための機能について説明します。 検証プロセスでは、転記エラーの原因となるトランザクションを明細書転記プロセスが取得する前に、そのトランザクションを識別してマークします。

明細書を転記しようとすると、コマース トランザクション テーブルのデータの不整合により、検証プロセスが失敗することがあります。 不整合の原因となる要因の例を次に示します。

- ヘッダー テーブルのトランザクションの合計が、明細行のトランザクションの合計と一致しない。
- ヘッダー テーブルで指定された品目の数がトランザクション テーブルの品目数と一致しない。
- ヘッダー テーブルの税額が、明細行の税額と一致しない。 

明細書転記プロセスが矛盾したトランザクションを取得した場合、作成される売上請求書と支払仕訳帳が原因で明細書転記が失敗することがあります。 **店舗トランザクションの検証** プロセスでは、トランザクション検証ルールに合格したトランザクションのみを取引明細書の算定プロセスに渡すことを保証することで、これらの問題を防くことができます。

次の図は、トランザクションのアップロード、トランザクションの検証、および取引明細書の算定と転記に関する定期的な日次プロセスと、財務諸表の算定と転記に関する営業終了プロセスを示しています。

![トランザクションのアップロード、トランザクションの検証、および取引明細書の算定と転記に関する定期的な日次プロセスと、財務諸表の算定と転記に関する営業終了プロセスを示す図](./media/valid-checker-statement-posting-flow.png)

## <a name="store-transaction-validation-rules"></a>店舗トランザクション検証ルール

**店舗トランザクションの検証** バッチ処理では、以下の検証ルールに基づいてコマース トランザクション テーブルの整合性をチェックします。

> [!NOTE]
> 検証ルールは、後続のリリースでも引き続き追加されます。

### <a name="transaction-header-validation-rules"></a>トランザクション ヘッダー検証ルール

次の表に、小売トランザクションが明細書転記に渡される前に小売トランザクションのヘッダーをチェックするトランザクション ヘッダー検証ルールの一覧を示します。

| ルール | 説明 |
|-------|-------------|
| 営業日 | このルールでは、トランザクションの営業日が元帳のオープン会計期間に関連付けられているか検証します。 |
| 通貨の丸め | このルールでは、トランザクション金額が通貨の丸めルールに従って丸められているか検証します。 |
| 顧客 ID | このルールでは、トランザクションで使用される顧客がデータベースに存在するかを検証します。 |
| 割引金額 | このルールでは、ヘッダーの割引金額が明細行の割引金額の合計と等しいかを検証します。 |
| 会計ドキュメントの転記ステータス (ブラジル) | このルールでは、その会計ドキュメントを正常に転記できるかを検証します。 |
| 総額 | このルールでは、トランザクション ヘッダーの総額が、トランザクション明細行の正味金額の (税込) と請求金額の合計であるかを検証します。 |
| 正味 | このルールでは、トランザクション ヘッダーの正味金額が、トランザクション明細の正味金額 (税抜の) と請求金額の合計であるかを検証します。 |
| 正味 + 税 | このルールでは、トランザクション ヘッダーの総額が、トランザクション明細行の正味金額 (税抜) とすべての税および請求金額の合計であるかを検証します。 |
| 品目数 | このルールでは、トランザクション ヘッダーに指定された品目の数がトランザクション明細行の合計数と一致するかを検証します。 |
| 支払額 | このルールでは、トランザクション ヘッダーの支払額がすべての支払トランザクションの合計と一致するかを検証します。 |
| 課税控除の算定 | このルールでは、算定された金額と請求金額明細行の課税控除額の合計が元の算定金額と等しいかを検証します。 |
| 税込価格 | このルールでは、**価格に税が含まれる** フラグがトランザクション ヘッダーおよび税トランザクションで一貫しているかを検証します。 |
| トランザクションが空白でない | このルールでは、トランザクションに明細行が含まれ、少なくとも 1 つの明細行が無効ではないことを検証します。 |
| 過少支払または過剰支払 | このルールでは、総額と支払額の差が最大過少支払/過剰支払コンフィギュレーションより多くないことを検証します。 |

### <a name="transaction-line-validation-rules"></a>トランザクション明細行検証ルール

次の表に、小売トランザクションが明細書転記に渡される前に小売トランザクションの明細行の詳細をチェックするトランザクション明細行検証ルールの一覧を示します。

| ルール | 説明 |
|-------|-------------|
| バーコード | このルールでは、トランザクション明細行で使用されるすべての品目バーコードがデータベースに存在するかを検証します。 |
| 請求金額明細行 | このルールでは、算定された金額と請求金額明細行の課税控除額の合計が元の算定金額と等しいかを検証します。 |
| ギフト カード返品 | このルールでは、トランザクションにギフト カードの返品がないかを検証します。 |
| 品目バリアント | このルールでは、トランザクション明細行で使用されるすべての品目とすべてのバリアントがデータベースに存在するかを検証します。 |
| 明細行割引 | このルールでは、明細行の割引金額が割引トランザクションの合計と一致するかを検証します。 |
| 明細行の税額 | このルールでは、明細行の税額が税トランザクションの合計と一致するかを検証します。 |
| 負の価格 | このルールでは、トランザクション明細行に負の価格が使用されていないかを検証します。 |
| シリアル番号による管理 | このルールでは、シリアル番号によって管理される品目のトランザクション明細行に、シリアル番号が存在するかを検証します。 |
| シリアル番号分析コード | このルールでは、品目のシリアル番号分析コードが非アクティブな場合にシリアル番号が指定されていないかを検証します。 |
| 符号の矛盾 | このルールでは、数量の符号と正味金額の符号が、すべてのトランザクション明細行で同じであるかを検証します。 |
| 課税控除 | このルールでは、明細行品目の価格と課税控除額の合計が元の価格と等しいかを検証します。 |
| 税グループの割り当て | このルールでは、消費税グループと品目別税金グループの組み合わせによって、有効な税の交差が生じるかを検証します。 |
| 測定単位の変換 | このルールでは、すべての明細行の測定単位に在庫測定単位への有効な変換があるかを検証します。 |

## <a name="enable-the-store-transaction-validation-process"></a>店舗トランザクション検証プロセスの有効化

Commerce 本社で定期的に実行する場合は **店舗トランザクションの検証** ジョブを構成します (**Retail と Commerce \> Retail および Commerce IT \> POS 転記**)。 バッチ ジョブは、店舗の組織階層に基づいてスケジュールされます。 このバッチ処理を構成して、**P ジョブ** および **トランザクション明細書の計算** バッチ ジョブと同じ頻度で実行することをお勧めします。

## <a name="results-of-the-validation-process"></a>検証プロセスの結果

**店舗トランザクションの検証** バッチ処理の結果は、各小売店舗トランザクションで確認できます。 トランザクション レコードの **検証ステータス** フィールドは、**成功**、**エラー**、または **なし** に設定されます。 **最後の検証日時** フィールドには、最後に検証が実行された日付が表示されます。

次の表で各検証ステータスについて説明します。

| 検証ステータス | 説明 |
|-------------------|-------------|
| 成功 | 有効なすべての検証ルールに合格しました。 |
| エラー | 有効な検証ルールでエラーが検出されました。 操作ウィンドウで **検証エラー** を選択すると、エラーに関する詳細情報を表示できます。 |
| なし | そのトランザクション タイプには検証ルールを適用する必要がありません。 |

![[検証ステータス] フィールドと [検証エラー] ボタンが表示される店舗トランザクション ページ。](./media/valid-checker-validation-status-errors.png)

検証ステータスが **成功** のトランザクションのみが トランザクション明細書に取り込まれます。 ステータスが **エラー** のトランザクションを表示するには、**店舗の財務** ワークスペースで **現金売りの検証エラー** タイルを確認します。

![[店舗の財務] ワークスペースのタイル。](./media/valid-checker-cash-carry-validation-failures.png)

現金売りの検証エラーの修正方法の詳細については、[現金売りトランザクションと現金管理トランザクションの編集と監査](edit-cash-trans.md)を参照してください。

## <a name="additional-resources"></a>追加リソース

[現金売りトランザクションと現金管理トランザクションの編集と監査](edit-cash-trans.md)

[!INCLUDE[footer-include](../includes/footer-banner.md)]
