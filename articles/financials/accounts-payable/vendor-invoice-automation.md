---
title: "仕入先請求書の自動化"
description: "このトピックでは、添付ファイルを含む請求書など、仕入先請求書のエンドツーエンドの自動化で利用可能な機能について説明します。"
author: ShivamPandey-msft
manager: AnnBe
ms.date: 08/22/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
audience: Application User
ms.reviewer: twheeloc
ms.search.region: Global
ms.author: shpandey
ms.search.validFrom: 2016-11-30
ms.dyn365.ops.version: AX 7.0.0
ms.translationtype: HT
ms.sourcegitcommit: 69eeb90387ca5765c163c7d482295ea104cc078c
ms.openlocfilehash: 75865ece49837e2a8758c4d739d3e29ce9128945
ms.contentlocale: ja-jp
ms.lasthandoff: 09/29/2017

---
# <a name="vendor-invoice-automation"></a>仕入先請求書の自動化

このトピックでは、添付ファイルを含む請求書など、仕入先請求書のエンドツーエンドの自動化で利用可能な機能について説明します。

買掛金勘定 (AP) プロセスを合理化したい組織は、多くの場合、請求書処理プロセスが効率化を図る必要があるプロセス領域の最上位にあると考えます。 多くの場合は、このような組織は、紙の請求書の処理からサード パーティ光学式文字認識 (OCR) サービス プロバイダにオフロードします。 それにより、各請求書のスキャン イメージと共に機械可読請求書メタデータを受け取ります。 オートメーションのためには、請求システムでこれらのコンポーネントの消費を有効にする「最終工程」ソリューションを構築します。 Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition の請求書自動化ソリューションをそのまま使用することで、この「最終工程」を実現できます。

## <a name="solution-context"></a>ソリューション コンテキスト

請求書自動化ソリューションでは、請求書ヘッダーと請求明細行の請求書メタデータおよび請求書に適用される添付ファイルを受け取ることができる標準インターフェイスを実現します。 このインターフェイスに準拠しているコンポーネントを生成する外部のシステムは、請求書および添付ファイルの自動処理のためのフィードを Finance and Operations に送信することができます。

次の図は、Contoso が仕入先請求書の処理のために OCR サービス プロバイダと統合する場合のシナリオの例を示します。 Contoso 社の仕入先は、請求書をサービス プロバイダーへ電子メールで送信します。 OCR 処理によっては、サービス プロバイダーは請求書メタデータ (ヘッダーまたは明細行) および請求書のスキャン イメージを生成します。 Finance and Operations が使用できるように、統合レイヤーでこれらのコンポーネントを変換します。

![統合シナリオ例](media/vendor_invoice_automation_01.png)

請求書の統合が必要な場合、上記のシナリオのさまざまなバリエーションが可能です。 別のユースケースはデータ移行で、このインターフェイスを使用して Finance and Operations で請求書および添付ファイルを作成できます。

### <a name="solution-components"></a>ソリューション コンポーネント

ソリューション フットプリントは、次のコンポーネントで構成されます。

+ 請求書ヘッダー、請求書の明細行、および請求書の添付ファイルのデータ エンティティ
+ 請求書の例外処理
+ 請求書の添付ファイルを並べて表示するビューアー

このトピックの後半では、これらのソリューション コンポーネントの詳細説明を提供します。

## <a name="data-entities"></a>データ エンティティ

データ パッケージは、Finance and Operations に送信する必要がある作業単位で、請求書ヘッダー、請求明細行、および請求書の添付ファイルが作成されます。 データ パッケージを構成するコンポーネントで使用されるのは次のデータ エンティティです。

+ 仕入先請求書ヘッダー
+ 仕入先請求明細行
+ 仕入先請求書ドキュメントの添付ファイル

仕入先請求書ドキュメントの添付ファイルは、この機能の一部として導入される新しいデータ エンティティです。 添付ファイルをサポートできるように、仕入先請求書ヘッダーのエンティティが変更されました。 この機能に関して、仕入先請求書の明細行のエンティティは変更されていません。

このトピックでは、データ パッケージの詳細な定義は説明されません。 データ パッケージを作成する方法も説明しません。 この情報に関しては「[データ エンティティとパッケージのフレームワーク](../../dev-itpro/data-entities/data-entities-data-packages.md)」を参照してください。

請求書および添付ファイルを含むテスト データを簡単に生成するには、以下の手順を実行します。

1. Finance and Operations インスタンスへログインします。
1. [**買掛金勘定**] > [**請求書**] > [**保留中の仕入先請求書**] に移動します。
1. 明細行および添付ファイルがある請求書を作成します。

    > [!NOTE]
    > 添付ファイルは、ヘッダー添付ファイルにする必要があります。 現時点では、仕入先請求書ドキュメントの添付ファイルのエンティティは、明細行の添付ファイルをサポートしていません。

1. **データ管理**ワークスペースを開きます。
1. 仕入先請求書ヘッダー、仕入先請求書の明細行、および仕入先請求書ドキュメントの添付ファイルのエンティティを含むエクスポート ジョブを作成します。
1. データをエクスポートします。
1. エクスポートしたデータを、パッケージとしてダウンロードします。 対象のインスタンスにデータをテスト用にインポートするために、パッケージを使用できます。

### <a name="determining-the-legal-entity-for-an-invoice"></a>請求書の法人を決定します。

データ パッケージからインポートする請求書と、それが属する法人を関連付ける方法は 2 つあります。

+ 請求書を処理するインポート ジョブが、**データ管理**ワークスペースでジョブがスケジュールされた会社にインポートします。 つまり、ジョブを実行する会社が、請求書が属する会社となります。
+ 請求書が含まれるデータ パッケージが Finance and Operations に送信された時、呼び出し元 (つまり、Finance and Operations の外部で実行される統合アプリケーション) は HTTP 要求で明示的に会社の ID に言及します。 この場合は、Finance and Operations で処理のジョブを実行する会社コンテキストが上書きされ、請求書は HTTP 要求で渡された会社にインポートされます。

> [!NOTE]
> この動作は、標準的なデータ管理の動作です。 間違いが生じないように、請求書のコンテキストで、念のために説明されています。

## <a name="exception-processing"></a>例外処理

統合により仕入先請求書が Finance and Operations に渡されるシナリオの場合、買掛金勘定のチーム メンバーが例外処理や障害が発生した請求書を扱い、障害が発生した請求書から保留中の請求書を作成する簡単な方法が存在する必要があります。 この仕入先請求書の例外処理は、Finance and Operations の一部として提供されています。

### <a name="exceptions-list-page"></a>[例外リスト] ページ

例外請求書の新しいリスト ページは、[**買掛金管理**] > [**請求書**] > [**インポートの失敗**] > [**インポートに失敗した仕入先請求書**] にあります。 このページは、仕入先請求書ヘッダーのデータ エンティティのステージング テーブルから、すべての仕入先請求書のヘッダー レコードを表示します。 同じレコードを**データ管理**ワークスペースで表示することもできます。ここでは、例外処理機能で提供されているのと同じアクションを実行することもできます。 ただし、例外処理機能が提供する UI は、機能ユーザーに対して最適化されています。

![[例外リスト] ページ](media/vendor_invoice_automation_02.png)

このリスト ページには、フィード経由で受け取る次のフィールドが含まれています。

+ [**会社**] – 請求書が属する会社
+ [**エラー メッセージ**] – 請求書を作成できなかった理由を説明する、データ管理フレームワークが発行するエラー メッセージ
+ [**番号**] – 請求書番号
+ [**請求元仕入先**]
+ [**名前**] – 仕入先の名前
+ [**仕入先**]
+ [**発注書**] – 請求書の発注書 (PO) 番号
+ **転記日付**
+ [**請求日**]
+ [**請求明細**]
+ [**通貨**]
+ [**ログ**]
+ [**明細行参照**] – 外部システムから取得する識別子

    > [!NOTE]
    > 明細行参照は請求書 ID ではありません。

このリスト ページには、次のように使用できるプレビュー ウィンドウもあります。

+ グリッド内の [**エラー メッセージ**] 列を展開する必要がないように、エラー メッセージ全体を表示します。
+ 請求書に添付ファイルが付属している場合、請求書の添付ファイルのリスト全体を表示します。

リスト ページでは、次の操作がサポートされています。

+ **編集** – 編集モードで例外レコードを開くので、問題を修正することができます。
+ [**オプション**] – リスト ページで利用できる標準オプションにアクセスします。 [**ワークスペースへの追加**] オプションで、例外リスト ページをリストまたはタイルとしてワークスペースに固定することができます。

### <a name="exception-details-page"></a>[例外の詳細] ページ

編集モードを開始するときに、問題がある請求書の [例外の詳細] ページが表示されます。 添付ファイルがある場合、請求書および既定の添付ファイルは [例外の詳細] ページに並べて表示されます。

![[例外の詳細] ページ](media/vendor_invoice_automation_03.png)

前の例では、受け取った仕入先請求書ヘッダーには明細行がありませんでした。 そのため、明細行のセクションは空です。

[例外の詳細] ページでは、次の操作がサポートされています。

+ [**保留中の請求書の作成**] – 例外処理の一部として請求書の問題を解決した後、このボタンをクリックして保留中の請求書を作成できます。 保留中の請求書の作成は、(非同期操作) としてバック グラウンドで発生します。

### <a name="shared-service-vs-organization-based-exception-processing"></a>共有サービス対組織に基づく例外処理

[例外リスト] ページは、**データ管理**ワークスペースがステージング レコードの処理でサポートする標準セキュリティ構造をサポートします。 請求書のインポート ジョブは、次の方法でセキュリティ保護できます。

+ ユーザー ロールごと
+ ユーザー別
+ 法人ごと

![ユーザー ロールごと、および法人ごとで保護されているインポート ジョブ](media/vendor_invoice_automation_04.png)

請求書インポート ジョブのセキュリティを構成すると、[例外リスト] ページはその設定に従います。 表示されるように設定された請求書例外レコードのみが表示されます。

たとえば、Contoso は法人ごとに請求書の例外を処理することにしました。 この場合、法人 A のユーザーは法人 A の請求書例外のみが表示されるように、法人 B のユーザーは、法人 B の請求書例外だけを見ることができるように、請求書インポート ジョブのセキュリティを構成します。この設定により、請求書の例外管理の職務分掌が実現できます。

Contoso がセキュリティを適用しない場合、同じユーザーがすべての法人の請求書の例外を処理できます。 この設定では、請求書の例外管理の共有サービス シナリオを実現できます。

## <a name="side-by-side-attachment-viewer"></a>添付ファイルを並べて表示するビューアー

仕入先請求書の添付ファイルを簡単に表示するため、請求書作成プロセスで現在使用される次のページでは、添付ファイル ビューアーを提供します。

+ **例外処理**
+ [**保留中の仕入先請求書**] ページ (請求書の確認プロセスでも使用可能)
+ [**請求仕訳帳**照会] ページ (転記された請求書)

添付ファイル ビューアーが提供する主な機能を以下に示します。

+ ドキュメント管理がサポートするすべての添付ファイル タイプ (ファイル、画像、URL、およびメモ) を表示します。
+ 複数ページの TIFF ファイルを表示します。
+ イメージ ファイルには、次のアクションを実行できます。
  + 画像の一部を強調表示します。
  + 画像の一部をブロックします。
  + イメージに注釈を追加します。
  + 画像を拡大/縮小します。
  + 画像を移動します。
  + 操作の取り消し、やり直しができます。
  + 画像をサイズに合わせます。

> [!NOTE]
> これらのアクションは、画像ファイル (JPEG、TIFF、PNG など) でのみ使用できます。 これらのアクションを使用して画像に対して行う変更は、画像ファイルに保存されます。 現時点では、添付ファイル ビューアーにバージョン管理や監査機能は含まれていません。

### <a name="default-attachment"></a>既定の添付ファイル

仕入先請求書に複数のファイルが添付されている場合、[**添付ファイル**] ページで、ドキュメントのいずれかを既定の添付ファイルとして設定できます。 [**既定の添付ファイルです**] オプションは、この機能の一部として追加された新しいオプションです。 このオプションは、仕入先請求書ドキュメントの添付ファイル データ エンティティでも公開されます。 したがって、既定の添付ファイルは統合により設定できます。

1 つのドキュメントだけを、既定の添付ファイルとして設定できます。 既定の添付ファイルとしてドキュメントを設定した後は、請求書を開いたときに自動的に添付ファイル ビューアーに表示されます。 既定の添付ファイルとしてドキュメントを設定しなかった場合、請求書を開いても添付ファイル ビューアーにはどのファイルも自動的に表示されません。

### <a name="showhide-invoice-attachments"></a>請求書添付ファイルの表示/非表示

[**例外処理**]、[**保留中の請求書**]、および [**請求仕訳帳**照会] ページに新たに表示されるボタンで、添付ファイル ビューアーの表示または非表示を切り替えられます。

### <a name="security"></a>セキュリティ

添付ファイル ビューアーの次のアクションは、ロール ベース セキュリティ経由で制御されます。

+ 強調表示
+ ブロック
+ 注釈

### <a name="pending-vendor-invoices-page"></a>[保留中の仕入先請求書] ページ

次の特権は、強調表示、ブロック、および注釈のアクションのための読み取り専用アクセスまたは読み取り/書き込みアクセスを添付ファイル ビューアーに提供します。

+ **仕入先請求書の画像を管理** – この特権は読み取り/書き込みアクセスを提供します。
+ **仕入先請求書の画像を表示** – この特権は読み取り専用アクセスを提供します。

次の職務は、それらのアクションに関して、添付ファイル ビューアーに読み取り専用アクセスまたは読み取り/書き込みアクセスを提供します。

+ **仕入先請求書の管理** – 仕入先請求書の画像管理権限はこの職務に割り当てられます。
+ **仕入先請求書状態の照会** – 仕入先請求書の画像表示権限はこの職務に割り当てられます。

次のロールは、それらのアクションに関して、添付ファイル ビューアーに読み取り専用アクセスまたは読み取り/書き込みアクセスを提供します。

+ **買掛金勘定係**および**買掛金勘定マネージャー** – 仕入先請求書の管理職務がこれらのロールに割り当てられます。
+ **買掛金勘定係**、**買掛金勘定マネージャー**、**買掛金勘定集中支払係**、および**買掛金勘定支払係** – 仕入先請求書状態の照会職務がこれらのロールに割り当てられます。

### <a name="invoice-exception-details-page"></a>[請求書例外の詳細] ページ

次の特権は、強調表示、ブロック、および注釈のアクションのための読み取り専用アクセスまたは読み取り/書き込みアクセスを添付ファイル ビューアーに提供します。

> [!NOTE]
> このセクションに記載されているロールは、最初から添付ファイル ビューアーの請求書の画像の読み取り専用アクセスを提供します。 ロールに画像への書き込みアクセス権が必要な場合、ここに記載されている特権と職務を使用して、書き込みアクセスをそのロールに割り当てることができます。

+ **仕入先請求書ヘッダー エンティティ画像の管理** – この特権は、添付ファイル ビューアーで請求書イメージへの読み取り/書き込みアクセスを提供します。
+ **仕入先請求書ヘッダー エンティティ画像の表示** – この特権は、添付ファイル ビューアーで請求書イメージへの読み取り専用表示を提供します。

次の職務は、それらのアクションに関して、添付ファイル ビューアーに読み取り専用アクセスを提供します。

+ **仕入先請求書の管理** – 仕入先請求書ヘッダー エンティティ画像管理特権はこの職務に割り当てられます。

次のロールは、それらのアクションに関して、添付ファイル ビューアーに読み取り専用アクセスを提供します。

+ **買掛金勘定係**および**買掛金勘定マネージャー** – 仕入先請求書の管理職務がこれらのロールに割り当てられます。

既定では、ユーザー ロールが任意のページでの編集権限を提供している場合、ユーザーは添付ファイル ビューアーでの強調表示、ブロック、およびコメント アクションの編集権限も有します。 ただし、ページの編集権限があるものの添付ファイル ビューアーの編集権限を持たない特定のロールが必要なシナリオの場合、このユース ケースの必要を満たすためには前のリストから適切な権限を使用することができます。

