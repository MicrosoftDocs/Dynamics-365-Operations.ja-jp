---
title: 販売履歴データのクリーンアップをスケジュールする
description: このトピックでは、販売更新履歴のクリーンアップ定期処理タスクを定期的に実行してスケジュールすることで、システムのパフォーマンスを向上させる方法について説明します。
author: myvakalo
ms.date: 03/21/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: myvakalo
ms.search.validFrom: 2021-09-29
ms.dyn365.ops.version: 10.0.19
ms.openlocfilehash: 6c6c1e08d45f2a7d1e1267010b286111bad01a6c
ms.sourcegitcommit: 197e6ddee84522fd587c6e4ee4f9089101e301c2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/13/2022
ms.locfileid: "8570397"
---
# <a name="schedule-sales-history-data-cleanup"></a>販売履歴データのクリーンアップをスケジュールする

[!include [banner](../includes/banner.md)]

Microsoft Dynamics 365 Supply Chain Management は標準操作の一部として、販売履歴更新データを継続的に生成して格納します。 時間の経過と共に、古くなった販売履歴データが大量にシステムに蓄積される場合があります。 このデータが累計された場合、販売注文に関連するドキュメントを転記するときにパフォーマンスと機能上の問題が発生する可能性があります。 (これらのドキュメントには、販売注文確認、販売梱包明細、販売ピッキング リスト、請求書が含まれます)。 そのため、*販売更新履歴クリーンアップ* 定期処理タスクを定期的に実行する設定およびスケジュールを行う必要があります。 このタスクによって、不要になった販売履歴更新データはすべて削除されます。

*販売更新履歴クリーンアップ* 定期処理タスクを使用する場合、*販売履歴クリーンアップのパフォーマンス向上* 機能を有効にすることをお勧めします。これにより、タスクの実行が効率的になります。 (しかし、この機能を有効にしなくてもタスクを実行できます)。

## <a name="turn-on-the-sales-history-cleanup-features"></a>販売履歴クリーンアップ機能を有効にする

*販売更新履歴のクリーンアップ* 定期処理タスクを、このトピックで説明しているすべての機能と共に設定および使用するには、以下のサブセクションで説明するように、機能管理で、*販売履歴クリーンアップ パフォーマンスの向上* 機能と *経過日数に基づいて販売更新履歴をクリーンアップする* 機能を有効にする必要があります。

### <a name="sales-history-cleanup-performance-improvements"></a>販売履歴クリーンアップ パフォーマンスの向上

**販売更新履歴のクリーンアップ** の定期的なバッチ ジョブは、大量の販売更新がある環境で頻繁に実行されないと、時間がかかることがあります。 このような場合は、*販売履歴クリーンアップのパフォーマンス改善* を使用すると、実行期間の短縮と信頼性の改善に役立ちます。

この機能により、次の方法で既存のクリーンアップ ジョブが改善します。

- クリーンアップはバッチに分割されます (カスタマイズしてバッチ サイズを変更できます)。
- 最大 2 時間実行されます (カスタマイズして期間を変更できます)。
- 可能であれば、データベース機能を活用して、競合のロックを最小限にし、クリーンアップ中にトランザクション テーブルが入らないようにします。

この機能を有効にした後、**販売更新履歴のクリーンアップ** バッチ ジョブ (**販売およびマーケティング \> 期間タスク \> クリーンアップ \> 販売更新履歴クリーンアップ**) が以前と同じ方法で実行されますが、パフォーマンスは改善し、最大 2 時間実行されます。 つまり、特定の保管期間のすべてのデータをクリーンアップするために何度か実行する必要がある場合があります。

この機能は使用する前にシステムでオンにする必要があります。 管理者は、[機能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) 設定を使用して、機能の状態を確認し、有効にすることができます。 **機能管理** ワークスペースで、この機能は次のようにリストされています。

- **モジュール:** *販売とマーケティング*
- **機能名:** *販売履歴クリーンアップ パフォーマンスの改善*

### <a name="clean-up-sales-update-history-based-on-age"></a>経過日数に基づいて販売更新履歴をクリーンアップする

*経過日数に基づいて販売更新履歴をクリーンアップする* 機能を使用すると、*販売更新履歴クリーンアップ* 定期処理タスクの実行時に保持するレコードの最大期間を指定できます。 古いレコードは削除されます。 この機能は、タスクが実行される日付を基準として常に年数が計算されるので、タスクを定期的に実行するために設定する場合に役立ちます。 この機能を使用しない場合、保持できる最も古いレコードに対する特定の日付だけを設定できます。

この機能は使用する前にシステムでオンにする必要があります。 管理者は、[機能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) 設定を使用して、機能の状態を確認し、有効にすることができます。 **機能管理** ワークスペースで、この機能は次のようにリストされています。

- **モジュール:** *販売とマーケティング*
- **機能名:** *経過日数に基づいて販売更新履歴をクリーンアップする*

## <a name="set-up-and-schedule-the-sales-history-cleanup-periodic-task"></a>販売履歴クリーンアップ定期処理タスクの設定およびスケジュール設定

*販売履歴のクリーンアップ* 定期処理タスクを設定およびスケジュールするには、次の手順に従います。

1. 保持する必要がある販売注文の転記の一時データの日数を決定するために業務上のニーズを分析します。 通常は 3 か月おき、最大で 6 か月おきにクリーンアップ タスクを実行することをお勧めします。
1. **販売とマーケティング \> 定期的なタスク \> クリーンアップ \> 販売更新履歴のクリーンアップ** に移動します。
1. **販売更新履歴のクリーンアップ** ダイアログ ボックスの **パラメーター** クイック タブで、次のフィールドを設定します。

    - **クリーンアップ** – 次のいずれかの値を選択して、クリーンアップするレコードのタイプを指定します。

        - **実行済** – 完全に処理されたレコードのみを削除します。 これらのレコードにそれ以上使用できる可能性は低いため、このオプションが最も安全です。
        - **実行済でエラーあり** – 完全に処理されたレコードとエラーが発生したレコードの両方を削除します。 このオプションが最もよく使用されます。 レコードを自動的にクリーンアップするのではなく、エラーのあるレコードを検査して修正することもできます。 ただし、多くの会社では、それらのレコードを約 1 か月後もクリーンアップすることを選択しています。それ以降は関連性がなくなる可能性が高いためです。
        - **すべて** – 実行済でエラーがある、待機中のレコードを削除します。 待機中のレコードは有効ですが、まだ完全に処理されていません。 ほとんどの場合、自動的に削除しないことをお勧めします。 ただし、場合によっては、一定期間が経過した後に自動的に削除することを選択することもできます。

    - **経過日数に基づいてレコードを保持する** – タスクが実行された日の経過日数に基づいてレコードをクリーンアップするか、固定日より前に作成されたレコードを削除するかを指定します。 クリーンアップを繰り返しタスクとしてスケジュールする場合、経過日数は常にタスクが実行される日付を基準として計算されるので、このオプションを *はい* に設定する必要があります。

        - このオプションを *はい* に設定し、**最大経過日数** フィールドを有効にします。 このフィールドを使用すると、タスクを実行するごとに保持されるレコードの最大経過日数を指定できます。 **作成期限** フィールドは無視されます。
        - このオプションを *いいえ* に設定し、**作成期限** フィールドを有効にします。 このフィールドを使用すると、タスクを実行したときに保持されるレコードの最も古い作成日を指定できます。 **最大経過日数** フィールドは無視されます。

    - **作成期限** – この設定は、**経過日数に基づいてレコードを保持する** オプションが *いいえ* に設定されている場合にのみ適用されます。 タスクを実行したときに保持されるレコードの最も古い作成日を指定します。 この日付の前に作成されたレコードが削除されます。
    - **最大経過日数** – この設定は、**経過日数に基づいてレコードを保持する** オプションが *はい* に設定されている場合にのみ適用されます。 タスクを実行するごとに保持されるレコードの最大経過日数を指定します。 古いレコードは削除されます。

1. **バックグラウンドで実行** クイックタブで、タスクの実行方法、タイミング、および頻度を指定します。 これらの設定を使用して、手順 1 で決定したスケジュールを実装します。 このフィールドは、Supply Chain Management の他の種類の[バッチ ジョブ](../../fin-ops-core/dev-itpro/sysadmin/batch-processing-overview.md)で実行されるのと同様に機能します。
1. **OK** を選択して設定を適用し、ダイアログ ボックスを閉じます。
