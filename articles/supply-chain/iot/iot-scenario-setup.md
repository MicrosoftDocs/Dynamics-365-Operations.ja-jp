---
title: IoT インテリジェンスのシナリオ設定
description: このトピックでは、IoT インテリジェンスのシナリオを Microsoft Dynamics 365 Supply Chain Management でコンフィギュレーションする方法について説明します。
author: robinarh
ms.date: 08/16/2019
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: rhaertle
ms.custom: ''
ms.search.region: Global
ms.author: rhaertle
ms.search.validFrom: 2020-04-04
ms.dyn365.ops.version: 10.0.5
ms.openlocfilehash: 9a45ed57f1fb5e4d508c30b2f3a83dafacfb7dd870701a8f519bbc1e807ed982
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/05/2021
ms.locfileid: "6736796"
---
# <a name="scenario-setup-for-iot-intelligence"></a>IoT インテリジェンスのシナリオ設定

[!include [banner](../../includes/banner.md)]

このトピックでは、IoT インテリジェンスのシナリオを Microsoft Dynamics 365 Supply Chain Management でコンフィギュレーションする方法について説明します。 シナリオを設定する前に、[Microsoft Dynamics Lifecycle Services (LCS) の設定](iot-lcs-setup.md) おこなう必要があります。

このトピックでは、マシンが停止した際に Supply Chain Management で通知を生成するように、**装置のダウンタイム** のシナリオを構成します。 このトピックでは、品目の属性が指定された範囲外である場合に通知が生成されるように、**製品品質** シナリオをコンフィギュレーションする方法、および生産スループットがしきい値を下回った場合に通知を生成するように **生産遅延** シナリオをコンフィギュレーションする方法についても説明します。

## <a name="configure-the-equipment-downtime-scenario-in-supply-chain-management"></a>Supply Chain Management における 装置のダウンタイムシナリオの構成

**装置のダウンタイム** シナリオでは、**PartOut** 信号をマシンの警告しきい値にマッピングします。 シナリオに対してマシンが選択されていて、Supply Chain Management で **動作** するように設定されている場合にのみ、監視がされます。 マシンから最後に受信した **PartOut** 信号からの時間が、警告のしきい値よりも大きい場合、**マシンの停止** 通知がトリガーされます。 マシンがまだ動作している場合は、次の **パーツ アウト** 信号を受け取ったときに、**マシンの起動** 通知がトリガーされます。 マシンが 30 分間停止した場合は、新たな **マシンの停止** 通知がトリガーされます。

**装置のダウンタイム** シナリオには、次のような依存関係があります。

+ 警告をトリガーするには、マッピングされたマシンで製造オーダーが実行されている必要があります。
+ マッピングされたマシンの **PartOut** 信号を表す信号は、一意のプロパティ名で IoT ハブに送信する必要があります。
+ この値がミリ秒単位で表される UNIX **タイムスタンプ** プロパティ (ms) は、Azure IoT ハブ メッセージに含まれている必要があります。

このシナリオを構成するには、次の手順に従います。

1. Supply Chain Management にサインインします。
2. IoT インテリジェンス機能のフラグを有効化します。 詳細については [機能管理の概要](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) を参照してください。
3. メトリックを構成します。 構成方法の詳細については、[メトリックの構成方法](iot-metrics-setup.md#configure-metrics)を参照してください。
4. **生産管理 \> 設定 \> IoT インテリジェンス \> シナリオ管理** に移動します。
6. **装置のダウンタイムタイル** タイルで、**コンフィギュレーション** を選択して、コンフィギュレーション ウィザードを開きます。

   ウィザードの最初のページは、**装置のセンサーのスキーマ定義** ページです。 このページでは、Supply Chain Management のスキーマを設定して、IoT Hub メッセージの JavaScript Object Notation (JSON) 形式と一致させることを目標としています。 複数のメッセージ スキーマを定義することができます。 詳細については、[IoT Hub メッセージのスキーマの形式](iot-schema-format.md) を参照してください。 この例では、メッセージ ペイロードに次の形式のメッセージがまとめて含まれています。

    ```json
    {
        "timestamp": 1576016821614,
        "payload": [
            {
                "id": "IoTInt.Machine1225.PartOut",
                "timestamp": 1576016821614,
                "value": True
            },
            {
                "id": "IoTInt.Machine1226.PartOut",
                "timestamp": 1576016991616,
                "value": True
            }
        ]
    }
    ```

7. テーブルに明細行を追加し、次の値を設定します。

    1. **スキーマ名** フィールドを **ID** に設定します。
    2. **スキーマのパス** フィールドを **/payload\[\*\]/id** に設定します。
    3. **説明** フィールドを **メッセージ ID** に設定します。

8. テーブルに別の明細行を追加し、次の値を設定します。

    1. **スキーマ名** フィールドを **タイムスタンプ** に設定します。
    2. **スキーマのパス** フィールドを **/payload\[\*\]/id** に設定します。
    3. **説明** フィールドを **メッセージ タイムスタンプ** に設定します。

9. テーブルに別の明細行を追加し、次の値を設定します。

    1. **スキーマ名** フィールドを **ID** に設定します。
    2. **スキーマのパス** フィールドを **/payload\[\*\]/id** に設定します。
    3. **説明** フィールドを **メッセージ値** に設定します。

    > [!NOTE]
    > メッセージ内のすべてのプロパティを定義する必要はありません。 必要なプロパティのみを定義します。 前の手順では、**ルートタイムスタンプ** の行は作成しませんでした。 **ルート タイムスタンプ** のパスは **/timestamp** です。

10. **次へ** をクリックして、**装置センサーのスキーマ マッピング** ページに移動します。
11. **装置リソース ID** の行の、**スキーマ名** フィールドで **ID** を選択します。
12. **UTC 時間** の行で、**スキーマ名** フィールドの **タイムスタンプ** を選択します。
13. **パーツ生成信号** の行で、**スキーマ名** フィールドで **値** を選択します。
14. **次へ** をクリックして、**装置リソース ID の構成** ページに移動します。
15. これらの手順に従って、IoT Hub メッセージの値を Supply Chain Management のリソースにマッピングします。

    1. **シグナル データ値** テーブルで、新しい行を追加します。 **値** フィールドで、**IoTInt.Machine1225.PartOut** を入力します。 この値は、IoT Hub メッセージの JSON **ID** 値プロパティから取得されます。
    2. **保存** を選択します。
    3. **業務レコードのマッピング** テーブルで、**新規** を選択します。 **業務レコード タイプ** フィールドの既定値は自動入力されるため、変更する必要はありません。
    4. **業務レコード** フィールドで、この信号の値を送信する Supply Chain Management マシンのリソースを選択します。
    5. **保存** を選択します。
    6. これらの手順を繰り返して、**Machine1226** に新たな業務レコード マッピングを追加します。 Supply Chain Management では、複数の信号データの値を 1 つのレコードにマッピングすることができます。

16. 処理するマシンを選択するには、**選択済** 列を使用します。 すべての信号の値を定義する必要はなく、すべてのマシンを選択する必要もありません。
17. **次へ** を選択して、**パーツ生成信号の構成** ページに移動します。
18. **信号データ値** テーブルで、行を追加し、**値** フィールドを **True** に設定します。 この値は、IoT Hub メッセージの JSON **値** プロパティから取得されます。 シナリオに必要な数だけ値を追加することができます。
19. **保存** を選択します。
20. **次へ** を選択して、**装置ダウンタイムのしきい値** ページに移動し ます。 一覧に表示されているマシンは、既に信号の値にマッピングされているマシンです。 このページでは、マシンが停止しているかどうかを判断するしきい値を定義します。 たとえば、しきい値を **10** に設定した場合、**PartOut** 信号を 10 分間マシンから受信しない場合は Supply Chain Management が通知が生成します。
21. **次へ** を選択して **シナリオの有効化** ページに進みます。 オプションを設定してシナリオを有効化します。
22. **完了** を選択します。

シナリオの設定が完了しました。 IoT Hub インテリジェンスでは、IoT Hub メッセージの処理が自動的に開始されます。

## <a name="configure-the-product-quality-scenario-in-supply-chain-management"></a>Supply Chain Management における 製品の品質シナリオの構成

**製品の品質** シナリオでは、品目の属性が指定された範囲外の場合に通知を生成します。 たとえば、センサーで各品目の重量を IoT Hub に送信することができます。 Supply Chain Management では、品目が重すぎる、または軽すぎる場合に通知が生成されます。

**製品品質** シナリオには、次のような依存関係があります。

+ マッピングされたマシンで製造オーダーを実行し、マッピングされたバッチ属性を持つ製品を生産したときのみ警告をトリガーすることができます。
+ バッチ属性を表す信号が IoT ハブに送信され、一意のプロパティ名が含まれる必要があります。
+ この値がミリ秒単位で表される UNIX **タイムスタンプ** プロパティが、IoT Hib メッセージに存在する必要があります。

## <a name="configure-the-production-delays-scenario-in-supply-chain-management"></a>Supply Chain Management における 生産遅延シナリオの構成

**生産遅延** シナリオでは、生産の処理能力がしきい値を下回った場合に通知が生成されます。 このシナリオでは、生産された品目ごとに **PartOut** 信号が IoT Hub に送信されます。 Supply Chain Management では、注文の遅延は、製造オーダーの実行がスケジュールされている量、生産されるべき品目の数、ジョブが実行された時間数、および入庫した **PartOut** 信号数に基づいて計算されます。 ジョブに対する **PartOut** 信号の数が想定されるしきい値を下回った場合に、遅延通知が生成されます。

**生産遅延** シナリオには、次のような依存関係があります。

+ 警告をトリガーするには、マッピングされたマシンで製造オーダーが実行されている必要があります。
+ マッピングされたマシンの **PartOut** 信号を表す信号は、一意のプロパティ名でAzure IoT ハブに送信する必要があります。
+ この値がミリ秒単位で表される UNIX **タイムスタンプ** プロパティが、IoT Hib メッセージに存在する必要があります。

## <a name="disable-a-scenario"></a>シナリオの無効化

次の手順に従い、シナリオを無効化します。

1. Supply Chain Management では、**生産管理 \> 設定 \> IoT インテリジェンス \> シナリオ管理** に移動します。
2. シナリオのタイルで、**コンフィギュレーション** を選択します。
3. **次へ** を選択して最後のウィザード ページに進みます。
4. オプションを設定してシナリオを無効化します。


[!INCLUDE[footer-include](../../includes/footer-banner.md)]