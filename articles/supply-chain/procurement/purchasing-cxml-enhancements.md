---
title: cXML 拡張機能の購入
description: 購買 cXML 拡張機能は、購買要求に対して使用される既存の外部カタログ機能である PunchOut に基づいています。
author: GalynaFedorova
ms.date: 08/03/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: CatCXMLParameters, CatCXMLPurchRequest
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: gfedorova
ms.search.validFrom: 2020-08-03
ms.dyn365.ops.version: 10.0.13
ms.openlocfilehash: 319079ca82ea91a4ab963a1dfa34ed256a3ddb21
ms.sourcegitcommit: 9166e531ae5773f5bc3bd02501b67331cf216da4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/03/2022
ms.locfileid: "8674284"
---
# <a name="purchasing-cxml-enhancements"></a>cXML 拡張機能の購入

[!include [banner](../includes/banner.md)]

_購買 cXML 拡張機能_ 機能は、購買要求に対して使用される [既存の外部カタログ機能](set-up-external-catalog-for-punchout.md) 上に構築されています。 この既存の機能は、_PunchOut_ と呼ばれています。 発注書は購買要求から取得する必要はありませんが、発注書の仕入先と、発注書ドキュメントの送信に使用されるパラメータとの間につながりが必要です。

## <a name="turn-on-the-purchasing-cxml-enhancements-feature"></a>cXML 拡張機能の購入機能を有効にする

この機能を有効にするには、**[機能の管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)** ページを開いて、*cXML 拡張機能の購入* と名前の付いた機能を検索します。 機能を選択し、**直ちに有効化** を選択してオンにします。 (Supply Chain Management のバージョン10.0.21では、この機能は既定で有効になっています。)

この機能を有効にした後、次の 3 つの領域の設定をコンフィギュレーションする必要があります。

- **[cXML パラメータ](#cxml-parameters)** - これらの設定を使用して、発注書を送信するための機能のいくつかのグローバル パラメータを設定します。
- **[仕入先の設定](#vendor-setup)** - 仕入先に対して作成されたすべての新規発注書に対して、既定で Commerce の拡張マークアップ言語 (cXML) を使用する必要がある場合は、その仕入先に対して **購買注文を cXML 経由で送信する** オプションを _はい_ に設定します。
- **[外部カタログ](#external-catalog-setup)** - 新規 **発注書のプロパティ** の新しい設定を使用して、発注書ドキュメントの形式と送付方法を定義します。

次の図は、このコンフィギュレーションの概要を示しています。

![cXML 機能を設定するための領域。](media/cxml-settings-areas.png "cXML 機能を設定するための領域")

また、[発注書要求バッチジョブ](#po-batch) を設定する必要があります。 このバッチ ジョブは、確認された発注書を送信するために使用されます。

## <a name="set-up-global-cxml-parameters"></a><a name="cxml-parameters"></a>グローバル cXML パラメーターの設定

**cXML パラメータ** ページを使用して、発注書を送信するための機能に適用するいくつかのグローバル パラメータを設定します。

![cXML パラメータ ページ。](media/cxml-parameters.png "cXML パラメータ ページ")

**調達 \> 設定 \> cXML 管理 \> cXML パラメータ** に移動し、次のパラメータを設定します。

- **cXML テスト モード** – このグローバル パラメータは、バッチ ジョブから発注書が物理的に送信される方法に影響します。 次の値からいずれか 1 つを選択します。

    - **テスト** - このモードでは、バッチ ジョブを実行することができますが、メッセージの XML ドキュメントは生成されますが、送信されることはありません。 その代わりに、確認のために発注書要求に保存されます。 初期実装を行っていて、cXML メッセージにデータがどのように入力されているかを確認する場合は、このモードを使用すると便利です。 また、最初の検証のために仕入先に送信するサンプル メッセージを生成することもできます。
    - **ライブ** - このモードでは、[外部カタログの設定](#external-catalog-setup) を使用して、各ドキュメントを仕入先に物理的に送信します。

- **購買要求の更新の送信** - このオプションを *はい* に設定すると、発注書の更新メッセージが送信されます。 メッセージが送信されないようにするには、*いいえ* に設定します。 ほとんどのベンダーは、更新メッセージを受け取らないことを希望しています。 その代わりに、発注書を変更する場合は、お客様が電話またはメールで連絡を受けられるようにする必要があります。 このパラメータはグローバル パラメータであり、各仕入先の外部カタログに上書きを指定することはできません。 発注書に対して 2 番目の確認を転記した後、最初の確認書が既に送信され、仕入先によって確認されている場合、発注書は更新済としてマークされます。 2 番目の確認があるが、最初の確認書がまだ送信されていない場合は、2 番目の確認は新しいドキュメントとして処理されます。 1 通の確認メッセージが送信されるまで、注文書を何度でも確認できます。 次の確認は更新メッセージとして処理されます。
- **購買要求の削除の送信** - このオプションを *はい* に設定すると、発注書のメッセージ削除が送信されます。 メッセージが送信されないようにするには、*いいえ* に設定します。 ほとんどのベンダーは、削除メッセージを受け取らないことを希望しています。 その代わりに、発注書が誤って送信された場合は、お客様が電話またはメールで連絡を受けられるようにする必要があります。 このパラメータはグローバル パラメータであり、各仕入先の外部カタログに上書きを指定することはできません。 発注書は、Supply Chain Management で発注書をキャンセルすると、削除済としてマークされます。
- **アーカイブ ファイル** - アーカイブされた cXML ドキュメントをエクスポートおよび保存するファイルのパスを指定します。 このパスは、**発注書の要求** ページから削除機能を実行するときに使用されます。
- **番地の最大文字数** - cXML ドキュメントの住所の [番地] フィールドで使用できる最大文字数を入力します。 このグローバル パラメータは、外部カタログ プロパティで上書きが指定されていない限り、すべての仕入先に影響します。

## <a name="set-up-vendor-purchase-orders-to-use-cxml"></a><a name="vendor-setup"></a>cXML を使用する仕入先発注書の設定

**cXML を介した発注書の送信** オプションが _はい_ に設定されている発注書を確認するたびに、cXML メッセージが自動的に生成され、その発注書に関連付けられている仕入先に配信されます。 発注書に対してこのオプションを制御するには、次の 2 つの方法があります。

- 要求から作成されたすべての新規発注書に対して cXML を自動的に使用するように仕入先を設定するには、**調達 \> 仕入先 \> すべての仕入先** に移動して、仕入先を選択または作成して、[詳細] ページを表示します。 その後、**発注書の既定値** クイックタブで、**cXML を介して発注書を送信する** をオプションを _はい_ に設定します。 要求から作成 **されていない** 新しい発注書に対して cXML も自動的に使用する必要がある場合は、このトピックの後の [「注文プロパティの設定」](#set-order-properties) セクションの説明に従って、関連する外部カタログの **ENABLEMANUALPO** 注文プロパティを _True_ に設定する必要があります。
- 個々の発注書について、**調達 \> 発注書 \> すべての発注書** の順に移動して、購買注文を選択または作成して [詳細] ページを表示します。 **ヘッダー** ビューに切り替え、**設定** クイックタブで、必要に応じて **cXML オプションを介して発注書を送信** オプションを設定します。

![仕入先の発注書の既定の設定。](media/cxml-order-defaults.png "仕入先の発注書の既定の設定")

## <a name="set-up-an-external-catalog-to-use-cxml"></a><a name="external-catalog-setup"></a>cXML を使用するために外部カタログを設定する

**外部カタログ** ページで、各カタログについて、PunchOut 機能と発注書を送信する機能を設定できます。 関連する設定を検索するには、**調達 \> カタログ \> 外部カタログ** に移動します。 [通常どおりに各カタログを設定して](set-up-external-catalog-for-punchout.md) 開始します。 このプロセスには、仕入先の割り当て、仕入先が供給できるカテゴリの選択、およびカタログの有効化が含まれます。 次に、このセクションで説明する追加の設定をコンフィギュレーションします。

> [!NOTE]
> CXML 経由で送信可能な発注書を確認すると、その発注書に関連付けられている仕入先がシステムによって検索され、その仕入先に関連付けられている最初の有効な外部カタログが検索されます。 その後、その外部カタログの設定を使用して、発注書が送信されます。 複数の外部カタログが設定されている場合、システムは、発注書の仕入先に基づいて、最初に検出された外部カタログのみを使用します。 したがって、仕入先ごとに外部カタログを 1 つだけ作成することをお勧めします。

![外部カタログの設定。](media/cxml-supplier-catalog.png "外部カタログの設定")

### <a name="set-the-punchout-protocol-type"></a>PunchOut プロトコル タイプの設定

**外部カタログ** ページの **一般** クイックタブで、**Punchout プロトコル タイプ** フィールドを _cXML_ に設定します。 このオプションは、パートナーが機能を拡張して追加のオプションを提供している場合を除き、利用可能なオプションとなります。

PunchOut 用のカタログも使用している場合は、[メッセージ形式も設定](set-up-external-catalog-for-punchout.md) する必要があります。 メッセージ形式は、要求からの PunchOut トランザクションで仕入先への接続を確立するために使用されます。 発注書が送信されると、注文プロパティを使用して仕入先との関連付けが確立されます。

### <a name="set-the-order-properties"></a><a name="set-order-properties"></a>注文プロパティを設定する

_購買用 cXML 拡張_ 機能を使用すると、外部カタログに対して新しい **注文プロパティ** クイックタブが追加されます。 このクイックタブには、注文プロパティを定義するグリッドが用意されています。 また、ツールバーも提供します。 このツールバーには、注文プロパティを管理するために使用できる次の 3 つのボタンが表示されます。

- **既定のプロパティ** - 新しいカタログを設定するときに、共通に使用されるプロパティの定義済みコレクションをグリッドに追加するには、このボタンを選択します。
- **新規** - グリッドに新しいプロパティを追加します。
- **削除** - 現在選択されているプロパティをグリッドから削除します。 誤って既定のプロパティを削除してしまった場合は、**既定のプロパティ** を選択して、不足しているすべてのプロパティを復元します。

グリッドに 1 つ以上のプロパティを追加するたびに、右の列を使用してそれぞれの値を指定します。

既定のプロパティは、次のように使用します。

- **BUYER\_COOKIE** – この追跡フィールドを使用して、自分の会社の特定の情報を示すことができます。 このプロパティがどのように使用されるかについては、仕入先との契約がない限り、発注書を送信するときにはあまり意味がありません。 したがって、この値は単純な値に設定する必要があります。
- **DELIVERTO** - 注文書から出荷先住所がドキュメントに入力されると、**アテンション情報** フィールドを使用して XML メッセージの **DeliverTo** フィールドが設定されます。 この値を依頼者の名前にする必要があり、発注書ヘッダーに [依頼者] フィールドを設定する場合は、このプロパティの _REQUESTER_ の値を入力し、依頼者の名前が XML の **DeliverTo** フィールドに入力されるようにします。 この場合、使用される主要なメール アドレスと電話番号は、注文者の代わりに、要求者からのものになります。
- **DEPLOYMENTMODE** - このプロパティを仕入先によって要求されるように設定します。 通常、この値は _PRODUCTION_ または _TEST_ のいずれかです。 仕入先との通信に基づいて値を設定します。 通常は、仕入先がテスト システムまたは生産システムとして指定した **ORDERCHECKURL** 値の背後で目的のシステムと一致する必要があります。
- **FIXEDBILLADDRESSID** – XML メッセージの **addressID** フィールドが設定されている場合、そのアドレスに指定されている場所をピックします。 仕入先に伝えた ID 値が、何らかの理由で住所の場所の値と異なる場合は、ここで値を指定することによって上書きを強制できます。 これは、仕入先との住所を1つだけ使用し、仕入先のシステムで住所が設定されていることを前提としています。 請求先住所は、Supply Chain Management の法人に対して指定されている基本請求書の住所です。
- **FIXEDBILLADDRESSID** – XML メッセージの **addressID** フィールドが設定されている場合、そのアドレスに指定されている場所をピックします。 仕入先に伝えた ID 値が、何らかの理由で住所の場所の値と異なる場合は、ここで値を指定することによって上書きを強制できます。 これは、仕入先との住所を1つだけ使用し、仕入先のシステムで住所が設定されていることを前提としています。 出荷先住所は、発注書のヘッダーで指定されている住所です。 ほとんどの仕入先は、行の住所ではなくヘッダーの住所のみを受け入れるようになっています。 XML には明細行の住所のフィールドが含まれていますが、これらはヘッダーアドレスに設定されます。
- **FROM\_DOMAIN** – 発注書ドキュメントの送信に使用される値を入力します。 この値は、仕入先によって提供されます。
- **FROM\_IDENTITY** – 発注書ドキュメントの送信に使用される値を入力します。 この値は、仕入先によって提供されます。
- **ORDERCHECKURL** – 発注書ドキュメントを送信する先の URL を入力します。 この URL は、`https://` から始まり、仕入先によって提供されます。
- **PAYLOAD\_ID** – 現在の仕入先に対して設定されている業務プロセスに必要な、ペイロード ID の接頭語の値を入力します。
- **SENDER\_DOMAIN** – 発注書ドキュメントの送信に使用される値を入力します。 この値は、仕入先によって提供されます。
- **SENDER\_DOMAIN** – 発注書ドキュメントの送信に使用される値を入力します。 この値は、仕入先によって提供されます。
- **SHARED\_SECRET** – 発注書ドキュメントの送信に使用される値を入力します。 この値は、仕入先によって提供されます。
- **STREETLENGTH** – 仕入先が番地として受け取る最大文字数を表す数値を入力します。 ここで入力した値は、**cXML パラメータ** ページで指定された値より優先されます。 このシステムは、改行とスペースを削除して、Supply Chain Management の標準住所を、ここで指定された文字数に調整します。 追加の文字はすべて切り捨てられます。
- **TO\_DOMAIN** – 発注書ドキュメントの送信に使用される値を入力します。 この値は、仕入先によって提供されます。
- **TO\_IDENTITY** – 発注書ドキュメントの送信に使用される値を入力します。 この値は、仕入先によって提供されます。
- **USERAGENT** – 使用しているシステムを識別する値を入力します。 たとえば、_Dynamics 365 Supply Chain Management_ を入力します。
- **VERSION** – 仕入先がこの情報を要求した場合に、cXML のバージョン番号を入力します。 既定のバージョンは *1.2.008* です。 このバージョンは安定しており、ほとんどの仕入先によって受け入れられています。
- **RESPONSETEXT** – 注文が送信された後に仕入先から取得する cXML 応答メッセージに必要なユーザー設定のテキストを入力します。 このようにして、システムはメッセージを _認知済み_ とマークすることができます。 応答が標準のテキストまたはここに入力した顧客のテキストと一致しない場合、要求は _エラー_ としてマークされます。
- **RESPONSETEXTSUB** –  **RESPONSETEXT** フィールドで指定された値を仕入先応答テキストで検索する場合は、このプロパティを _TRUE_ に設定します。 たとえば、仕入先は、応答に "OK" を含む長い文字列を返す場合があります。 この場合は、**RESPONSETEXT** フィールドに _OK_ と入力して、**RESPONSETESTSUB** を _TRUE_ に設定して、応答内の任意の場所で "OK" を検索します。 その後、注文を _承認済み_ に設定できます。
- **CONTENTTYPE** - 一般的なカタログ設定では、このプロパティを設定する必要はありません。 発注書の送信時に仕入先のシステムからサーバー 500 エラーが発生した場合は、このプロパティを _FALSE_ に設定することでテストできます。 この値によって web 要求の設定が変更され、一部のプラットフォームでメッセージを送信できるようになる可能性があります。
- **ENABLEHEADERS** - このプロパティを _TRUE_ に設定すると、注文書と共にヘッダーが送信されます。 このプロパティは、仕入先で要求されている場合にのみ設定する必要があります。 このプロパティを _TRUE_ に設定する場合は、仕入先によって提供される名前に基づく追加のカスタムプロパティを追加し、それらのプロパティに _H\__ のプレフィックスを付け。 代表的な例としては、**H\_USERID**、**H\_PASSWORD**、**H\_RECEIVERID**、**H\_ACTIONREQUEST** があります。 既定のプロパティには、次のカスタムプロパティが含まれています。

    - **H\_USERID** –  取引相手が、注文書を送信するための URL の一部としてユーザー ID を送信する必要がある場合は、その値を入力します。
    - **H\_PASSWORD** – 取引相手が、注文書を送信するための URL の一部としてパスワードを送信する必要がある場合は、その値を入力します。

- **ENABLEMANUALPO** - このプロパティが _TRUE_ に設定されている場合、ユーザーが手動で発注書を作成するとき (つまり、ユーザーが要求から開始しない場合)、これらの発注書の設定は、仕入先から **cXML を通じて、購買注文を送信する** オプションの設定を継承します。 このプロパティが設定されていない場合、または _FALSE_ に設定されている場合、**手動** で作成された発注書の発注書ヘッダーには、cXML オプションを使用した発注書の送信は設定されません。 要求から作成された発注書の場合、このプロパティの設定に関係なく、**cXML オプションを介して発注書を送信** オプションは常に仕入先から継承されます。 詳細については、このトピックの [cXML を使用するために仕入先の発注書を設定する](#vendor-setup) を参照してください。
- **PUNCHOUTPOONLY** - このプロパティが _TRUE_ に設定されている場合、PunchOut プロセスから作成された購買要求明細行のみが、**cXML を介して発注書を設定する** オプションを設定します。 さらに、発注書のすべての明細行の購買要求明細行のタイプは、_外部カタログ品目_ である必要があります。 それ以外の場合は、cXML 購買注文を作成できません。
- **PUNCHOUTSHIPTO** - このプロパティが _TRUE_ に設定されている場合、ユーザーが外部カタログを開いたときに、法人の既定の住所が PunchOut 設定の要求メッセージに追加されます。 このアドレスは、**ShipTo** アドレスとして追加されます。 仕入先は、**ShipTo** 住所を使用して、会社の場所に基づく価格決定を示します。
- **TRACEPUNCHOUT** - 要求から外部カタログを参照しようとするとエラーメッセージが表示される場合は、このプロパティを _TRUE_ に設定します。 これにより、Supply Chain Managemen と仕入先サイトとの間で送信される **PunchOutSetupRequest** メッセージと **PunchOutResponse** メッセージに関する追跡情報が入力されます。 この情報は、問題が発生している仕入先カタログの **外部カタログの設定** ページから開くことができる、**cXML カートのメッセージログ** ページに表示されます。 PunchOut ごとにデータベースのパフォーマンスのオーバーヘッドが増大するので、トラブルシューティングを行う場合にのみこのプロパティを _TRUE_ に設定します。 詳細については、このトピックで後述する [外部カタログ PunchOut のメッセージログを表示する](#message-log) セクションを参照してください。
- **REPLACENEWLINE** – 仕入先のシステムが改行文字 (\\n) を含む **PunchOutResponse** メッセージを送信するために問題が発生する場合は、このプロパティを _TRUE_ に設定し ます。 この問題は、仕入先のメッセージがミドルウェアまたは調達ハブを介して解析されている場合に発生する可能性があります。 新しい仕入先の設定に関する問題が発生した場合は、**TRACEPUNCHOUT** プロパティを _TRUE_ に設定して、**PunchOutResponse** メッセージを表示して、XML タグが改行文字で分割されているかどうかを確認します。
- **POCOMMENTS** – Supply Chain Management で発注書に添付されているメモを cXML ドキュメントに含める場合は、このプロパティを _TRUE_ に設定します。 添付テキストは、発注書メッセージのヘッダーコメントに含まれます。 これらの添付ファイルをシステムで選択して処理する方法の詳細については、このトピックの [発注書にメモを添付する](#attach-po-notes) を参照してください。
- **VENDCOMMENTS** – Supply Chain Management の発注書に添付されているメモを cXML ドキュメントに含める場合は、このプロパティを _TRUE_ に設定します。 添付テキストは、発注書メッセージのヘッダーコメントに含まれます。 これらの添付ファイルをシステムで選択して処理する方法の詳細については、[発注書にメモを添付する](#attach-po-notes) セクションを参照してください。
- **CLEANAMP** – 仕入先へのPunchOutを実行しようとしたときにエラーメッセージが表示され、仕入先の返品URLに正しくエンコードされていないアンパサンド (\&) が含まれている場合は、このプロパティを _TRUE_ に設定します。
- **PUNCHOUTTZ** - 作業を行っている仕入先が、PunchOut 要求メッセージの日時について特定の検証を行うために、国際標準化機構 (ISO) 8601標準を使用している場合は、このプロパティを _TRUE_ に設定します。 Supply Chain Management では、**PunchOutSetupRequest** メッセージで協定世界時 (UTC) の日付が使用されます。 したがって、このプロパティを _TRUE_ に設定すると、日付と時刻の形式に *+ 00:00* が追加されます。
- **WMSADDRESSID** - このプロパティを _TRUE_ に設定すると、発注書ヘッダーの倉庫番号が、仕入先に送信される発注書要求の **ShipTo** アドレスで **addressID**  値として使用されます。 **FIXEDSHIPADDRESSID** プロパティに値を設定すると、その値はこの値よりも優先されます。 したがって、ドキュメントの **ShipTo** アドレスに **addressID** を設定するには、1 つのプロパティを使用するか、またはその他のプロパティを使用する必要があります。
- **PUNCHOUTSHIPTOUSER** - このプロパティは、**PUNCHOUTSHIPTO** プロパティと共に使用されます。 **PUNCHOUTSHIPTO** を _TRUE_ に設定すると、法人の住所がピックアップされます。 **PUNCHOUTSHIPTOUSER** が _TRUE_ に設定されている場合は、法人の住所の代わりに、PunchOut ユーザーからのメインの住所が使用されます。

### <a name="activate-the-external-catalog"></a>外部カタログをアクティブ化する

外部カタログのすべてのプロパティを設定し、その他の設定をコンフィギュレーションしたら、**外部カタログ** ページの **一般** クイックタブに戻り、**有効** オプションを *はい* に設定します。

### <a name="attach-notes-to-a-purchase-order"></a><a name="attach-po-notes"></a>発注書へのメモの添付

[注文のプロパティを設定する](#set-order-properties) セクションで説明したように、配送された cXML に、関連する発注書や仕入先のレコードに関連付けられているメモのテキストを含める場合は、外部カタログの設定で **POCOMMENTS** や **VENDCOMMENTS** プロパティを _TRUE_ に設定できます。 このセクションでは、使用する場合の、システムでの添付ファイルの選択方法および処理方法について詳しく説明します。

システムで検索するメモのタイプを設定するには、**調達 \> 設定 \> フォーム \> フォーム設定** に移動します。 次に、**発注書** タブで、**含めるドキュメントのタイプ** フィールドを含めることができる注記のタイプに設定します。 ドキュメントの添付ファイルではなく、テキスト注記のみが含められます。

![フォーム設定ページ。](media/cxml-form-setup.png "フォーム設定ページ")

添付ファイルが発注書に含まれるのは、その **タイプ** フィールドに **タイプのドキュメントを含める** フィールドで選択した値が設定されており、**制限** フィールドが _外部_ に設定されている場合のみです。 発注書の添付ファイルを作成、表示、または編集するには、**調達 \> すべての発注書** に移動して、発注書を選択または作成して、右上隅にある **添付ファイル** ボタン (クリップの記号) を選択します。

![仕入先に送信するように設定されている添付ファイル。](media/cxml-note-to-vendor.png "仕入先に送信するように設定されている添付ファイル")

## <a name="view-the-cxml-cart-message-log-for-external-catalog-punchout"></a><a name="message-log"></a>外部カタログ PunchOut の cXML カート メッセージ ログを表示する

**Punchout プロトコル タイプ** フィールドを外部カタログの _cXML_  に設定すると、システムによって、仕入先から戻されるカートのメッセージ ログがキャプチャされます。 このログは、トラブルシューティングやその他のデータ目的に使用できます。

外部カタログのログを開くには、関連するカタログを選択し、アクションウィンドウで **cXML カート メッセージ ログ** を選択します。 **cXML カートのメッセージ ログ** ページに、返品されたカート、それらのカートに関連する XML、関連する購買要求で作成された明細行の一覧が表示されます。

![cXML カート メッセージ ログ ページ。](media/cxml-cart-message-log.png "cXML カート メッセージ ログページ")

## <a name="set-the-extrinsic-elements-for-external-catalog-punchout"></a>外部カタログ PunchOut の外部カタログの外部要素を設定する

**パンチアウト プロトコル タイプ** フィールドを外部カタログの *cXML* に設定すると、要求 XML メッセージの適切な位置に挿入されるカスタムの外部要素を追加できます。

外部カタログに外部の要素を追加するには、次の手順に従います。

1. **調達 \> カタログ \> 外部カタログ** の順に移動します。
1. 関連するカタログを選択します。
1. **メッセージ形式** クイックタブの **外部** セクションで、**追加** を選択して、含めたい各外部要素ごとにグリッドを追加するために行を追加します。 各行で、次のフィールドを設定します。

    - **名前** – 各要素の名前を入力します。 この値は、各行によって作成された **外部** XML要素の **名前** 属性の値になります。 通常は、各組み込み要素の名前について、仕入先と協力して合意します。
    - **値** - 要素の値を選択します。 この値は、各行によって作成された 外部 XML 要素の値になります。 使用可能な値は次のとおりです。

        - **ユーザー名** – PunchOut をするユーザーの名前を使用します。 この名前は、Supply Chain Management のためのサインイン名です。
        - **ユーザーのメール** - PunchOut をするユーザーのメール アドレスを使用します。 このアドレスは、**ユーザー オプション** ページの **アカウント** タブで設定された住所です。
        - **ランダム値** – 一意のランダム値を使用します。
        - **ユーザーのフルネーム** -  外部カタログにアクセスするユーザーに関連付けられている連絡担当者のフル ネームを使用します。
        - **名** - 外部カタログにアクセスするユーザーに関連付けられている連絡担当者の名を使用します。
        - **姓** - 外部カタログにアクセスするユーザーに関連付けられている連絡担当者の姓を使用します。
        - **電話番号** - 外部カタログにアクセスするユーザーに関連付けられている連絡担当者の主な電話番号を使用します。

![外部要素の設定。](media/cxml-extrinsics.png "外部要素の設定")

外部要素はユーザーが PunchOut を行うまで追加されないため、ユーザーまたは管理者は外部要素を表示しません。 これらは、cXML セットアップ要求メッセージの **BuyerCookie** と **BrowserFromPost** との間に自動的に挿入され ます。 したがって、外部カタログを設定するときに、XMLで手動で設定する必要はありません。

![XML に追加された外部要素。](media/cxml-extrinsics-xml.png "XML に追加された外部要素")

## <a name="create-and-process-a-purchase-order"></a><a name="create-po"></a>発注書を作成し、処理する

仕入先の発注書を作成すると、その仕入先からの **cXML を介して発注書を送信** オプションの設定が継承されます。 ただし、この設定は後で必要に応じて変更できるように、発注書の **ヘッダー** にある **設定** クイックタブで使用できます。

![cXML を使用するように設定された発注書。](media/cxml-purchase-order.png "cXML を使用するように設定された発注書")

PunchOut フローからの購買要求から発注書を作成すると、必要な明細行の詳細がすべて入力されます。 その後、発注書明細行を手動で追加したり、他の発注書からコピーしたりできます。 すべての必須フィールドが設定されていることを確認します。 これらの必須項目には、外部参照番号 (cXMLメッセージで使用される仕入先番号) が含まれます。

![外部参照番号の例。](media/cxml-line-details.png "外部参照番号の例")

発注書の詳細をすべて入力したら、確認してください。 発注書が確認されない限り、メッセージは送信されません。 発注書を確認するには、アクション ペインの **アクション** グループの **購入** タブで、**確認** を選択します。 

発注書を確認した後、**発注書確認** 仕訳帳を使用して確認書のステータスを表示できます。 アクション ペインで、**購入** タブの、**仕訳帳** グループで、**発注書の確認** を選択します。

各発注書には、複数の確認を付けることができます。 各確認には、増分番号が付けられています。 次の図では、発注書が *00000275*、確認が *00000275-1* です。 この番号付けにより、標準の Supply Chain Management の機能が反映されます。ここでは、発注書の変更が行われ、したがって、仕入先に送信する必要がある cXML メッセージのタイプが確認書に基づいて識別されます。 図に示すように、**発注書の確認** ページには、**注文送信ステータス** と **注文要求の仕入先ステータス** フィールドも含まれます。 このページに表示される可能性があるさまざまなステータス値の詳細については、このトピックで後述する [発注書要求の監視](#monitor-po-requests) セクションを参照してください。

![発注書確認ページ。](media/cxml-po-confirmations.png "発注書確認ページ")

ドキュメントに関する詳細情報を表示するには、グリッドの上にある **発注書要求** を選択します。

**発注書要求** ページには 2 つのグリッドが含まれています。 ページの上部にあるグリッドには、送信用にマークされている発注書ごとに 1 つのレコードがあります。 ページ下部の **発注書の要求履歴** タブにあるグリッドに、選択した発注書の複数のレコードがあり、各確認書のステータスを示している場合があります。 次の図は、**発注書の要求履歴** タブのグリッドにある上部グリッドとドキュメント 00000275-1 の発注書 00000275 を示しています。

![発注書要求ページ。](media/cxml-po-request.png "発注書要求ページ")

バッチ ジョブが設定されて実行されている場合は、ドキュメントが送信されます。 ドキュメントが送信された後にステータスの変更を表示できます。 次の図では、**注文送信ステータス** フィールドが _送信済_ に設定されています。 **"注文要求の仕入先ステータス** フィールドは _"承認済_ に設定され、仕入先がドキュメントを受信したことを示し、それを読み取ってシステムに保管することができました。 **発注書要求履歴** タブのグリッドには、ドキュメントが送信された時刻が表示されます。 このページに表示される可能性があるさまざまなステータス値の詳細については、[発注書要求の監視](#monitor-po-requests) セクションを参照してください。

![発注書要求ページのステータス メッセージ。](media/cxml-po-request-2.png "発注書要求 ページのステータス メッセージ")

## <a name="schedule-the-purchase-order-request-batch-job"></a><a name="po-batch"></a>発注書要求バッチ ジョブのスケジュール

発注書要求を送信するためのバッチ ジョブを有効化するには、**調達 \>設定" \>cXML 管理 \> 発注書要求** に移動し、アクション ペインの **発注書要求** タブの **バッチグループ** で、**ジョブの送信**  を選択して **購買要求の準備と送信** ダイアログ ボックスを開きます。 このダイアログ ボックスを使用すると、Supply Chain Management のバッチ ジョブの場合と同様に、繰り返しを設定できます。 注文のボリュームに基づいて、間隔を選択します。 バッチ ジョブは毎分実行できますが、仕入先のスケジュールに一致する注文入荷ウィンドウに基づいて、営業日にバッチを送信することをお勧めします。

たとえば、仕入先は、1 PMが受け取ったすべての注文が同日に出荷されることを示すポリシーを持っています。 この場合、朝に数回はバッチを実行して、注文を連絡する必要があるかもしれません。 残りの注文は、翌日に送信されます。 この決定は、単なる業務上の意思決定です。 これを確認し、それに応じてパラメータを設定することができます。

このプロセスでは、*待機* ステータスを持つ発注書要求ドキュメントが検索されます。 仕入先に直ちに送信する必要がある注文がある場合は、**ジョブの送信** を選択して、**バッチ処理** オプションを *いいえ* に設定できます。

## <a name="monitor-purchase-order-requests"></a><a name="monitor-po-requests"></a>発注書要求の監視

### <a name="view-the-status-of-a-purchase-order"></a>発注書のステータス表示

cXML 経由で送信できる注文は確認されると、_待機_ ステータスになります。 [発注書の作成および処理](#create-po) セクションで説明したように、**発注書要求** ページに発注書ステータスが表示されます。 各発注書要求には、パラメータとデータに応じて、複数のステータスのいずれかが含まれる場合があります。 このセクションでは、さまざまなステータスのタイプとその値について説明します。 この情報は問題を管理し、発注書のステータスを理解するのに役立ちます。

![発注書要求ページの発注書ステータス。](media/cxml-monitor-po-request.png "発注書要求 ページの発注書ステータス")

**発注書要求** ページの上部にあるグリッドには、次のステータス値が表示される場合があります。

- **注文送信詩テータス** – このフィールドは次の値のうちの一つを持つことができます。

    - **待機中** - ドキュメントは送信を待機しています。
    - **送信済** - ドキュメントが送信されました。
    - **停止** - ドキュメントは送信前に _停止済_ としてマークされました。 (ドキュメントを _停止_ としてマークするには、**購買要求** ページのアクション ペインで **停止** を選択します。)
    - **アーカイブ** - ドキュメントが削除されています。 (ドキュメントを消去するには、**購入要求** ページのアクション ペインで **消去する** を選択します。)

- **注文要求仕入先ステータス** – このフィールドは次の値のうちの一つを持つことができます。

    - **待機中** - ドキュメントは送信を待機しています。
    - **確認済み** - ドキュメントは、仕入先によって受入済として認知されています。 仕入先から返された詳細な XML メッセージを確認するには、ページの下部にある **応答 MXL** タブを選択します。
    - **エラー** - ドキュメントは仕入先に送信されましたが、エラーが発生しました。 エラー メッセージを確認するには、ページの下部にある **応答 XML** タブを選択します。

**発注書要求** ページの下部にある **発注書の要求履歴** タブのグリッドには、次の値が表示される場合があります。

- **注文要求タイプ** – このフィールドは次の値のうちの一つを持つことができます。

    - **新規** - この明細行は発注書が確認された直後に新しい行としてマークされます。
    - **更新** - 確認書が既に送信され、仕入先によって確認されている場合は、次の確認書が _更新_ としてマークされます。 [グローバル cXML パラメータ](#cxml-parameters) で **購買要求の更新の送信** オプションが *はい* に設定されている場合にのみ更新が送信されます。
    - **削除** - 確認書が既に送信されて仕入先に対して承認されているが、発注書がキャンセルされると、待機中の確認が _削除_ としてマークされます。 [グローバル cXML パラメータ](#cxml-parameters) で **購買要求の削除の送信** オプションが *はい* に設定されている場合にのみ削除が送信されます。

- **要求時間** - 注文の確認が作成された時刻。 要求時間を注文のステータス時間と比較して、確認と仕入先の確認の間の時間を決定することができます。
- **注文送信ステータス** - このフィールドは、ページの上部にある **注文送信ステータス** フィールドと同じです。 確認レベルでのステータスの表示を容易にするために、これはここで繰り返されます。 **注文要求タイプ** フィールドが *新規* に設定され ていて、発注書が確認を送信する前に再確認された場合は、**注文送信ステータス** フィールドが *アーカイブ* に設定されます。
- **注文ステータスの時刻** - 発注書要求履歴レコードが最後に更新された時刻。 (更新には、ステータスの変更が含まれています。)
- **注文要求仕入先ステータス** - このフィールドは、ページの上部にある **注文要求仕入先ステータス** フィールドと同じです。 確認レベルでのステータスの表示を容易にするために、これはここで繰り返されます。
- **再送信時刻** - レコードが再送信された時刻。
- **再送信回数** - レコードが再送信された回数。 高い数字は複数の失敗を示し、データの設定または仕入先のデータ設定に問題があることを示している可能性があります。

### <a name="view-the-xml-for-a-purchase-order-request-message"></a>発注書要求メッセージの XML 表示

発注書要求メッセージの XML を表示するには、**発注書の要求** ページの下部にある **XML テキストの要求** タブを選択します。 このタブの情報は、テスト中またはエラー検証時に役立ちます。 情報を読みやすくするために、情報をフォーマットされたメッセージとして表示できます。 タブの内容をテキスト ファイルにコピーしてから、XML エディターで表示します。

![要求 XML テキスト タブ。](media/cxml-request-xml-text.png "要求 XML テキスト タブ")

### <a name="view-the-details-of-the-vendor-response"></a>仕入先応答の詳細表示

仕入先の確認またはエラー応答の内容を表示するには、**注文要求** ページの下部にある **応答XML** タブを選択します。

![応答 XML タブ。](media/cxml-response-xml.png "応答 XML タブ")

## <a name="additional-resources"></a>追加リソース

- [パンチアウト eProcurement の外部カタログの設定](set-up-external-catalog-for-punchout.md)
- [パンチアウト e-procurement の外部カタログの使用](use-external-catalogs-for-punchout.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
