---
title: 材料取り扱い設備のインターフェイス (MHAX)
description: この記事では、外部の材料取り扱い設備のインターフェイス (MH) システムに接続できるような材料取り扱い設備のインターフェイス (MHAX) を設定する方法について説明します。
author: Mirzaab
ms.date: 03/04/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: WMHEParameters, WMHESubscription, WMHEQueueManagerWorkspace, WMHEInboundQueue, WMHEOutboundQueue
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: mirzaab
ms.search.validFrom: 2021-03-04
ms.dyn365.ops.version: 10.0.17
ms.openlocfilehash: c4b0d991d320d5a679d0ed60880c56a6cb849e2d
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/03/2022
ms.locfileid: "8907090"
---
# <a name="material-handling-equipment-interface-mhax"></a>材料取り扱い設備のインターフェイス (MHAX)

[!include [banner](../../includes/banner.md)]

*材料取り扱い設備インターフェイス* (MHAX) を使用すると、外部の物理材料取り扱い (MH) システムを、Microsoft Dynamics 365 Supply Chain Management の高度な倉庫管理 (WMS) によって管理される倉庫に接続できます。 WMS と MH システム間のインターフェイスは、2 つのキューで構成されています: 1 つは発信イベント用 (WMS から MH)、もう 1 つは受信イベント用 (MH から WMS )です。 WMS システムは、さまざまな作業の作成および実行プロセス中に作成された作業明細行に基づいて発信イベントを生成します。 次に、MH システムは、新しいイベントについて定期的に WMS システムをポーリングして、応答を処理します。 MH システムは、作業指示に従ってイベントの処理を終了した後、作業明細行の完了やショート ピッキングなどの受信イベントを送信します。

次の図は、MHAX 統合を使用する際に発生するさまざまな要素およびプロセスの順序を示しています。

![MHAX コンポーネントと相互作用。](media/mhax-components.png "MHAX コンポーネントと相互作用")

ここでは、前の図に示した相互作用について説明します。

1. 作業の作成または作業の実行中に、発信イベントが発信キューに作成されます。
2. MH 設備は、MH 設備サービスに接続し、関連する新しいイベントに対するポーリングを行い、それらのイベントを処理します。
3. MH 設備を再報告する準備ができたときに、その設備が再度サービスに接続し、受信イベントを送信します。 これらのイベントは、キュー プロセッサによって直ちに処理されます。
4. 受信イベント データに基づいて、キュー プロセッサで既存の作業を実行したり、変更したり、新しい作業を作成したりします。

## <a name="turn-on-the-mhax-feature"></a>MHAX 機能をオンにする

MHAX 機能を使用する前に、その機能とコンフィギュレーション キーの両方を有効にする必要があります。

1. **システム管理者 \> ワークスペース \> フィーチャー管理** の順に移動します。
2. **[機能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)** ワークスペースで、*材料取り扱い設備のインターフェイス* という名前の機能を有効にします。
3. [メンテナンス モード](../../fin-ops-core/dev-itpro/sysadmin/maintenance-mode.md)の説明に従って、システムをメンテナンス モードにします。
4. **システム管理 \> 設定 \> ライセンス コンフィギュレーション** の順にクリックします。
5. **取引 \>倉庫と輸送管理** を展開し、**材料取り扱い設備のインターフェイス** のチェック ボックスをオンにします。
6. [メンテナンス モード](../../fin-ops-core/dev-itpro/sysadmin/maintenance-mode.md)の説明に従って、メンテナンス モードをオフにします。

## <a name="set-mhax-parameters"></a>MHAX パラメーターの設定

この機能を構成するには、**材料取り扱い設備のインターフェイス パラメーター** ページでいくつかの一般的なパラメーターを設定する必要があります。

1. **材料取り扱い設備のインターフェイス \> 設定 \> 材料取り扱い設備のインターフェイス パラメーター** に移動します。
2. **一般** タブで、次のフィールドを設定します。

    - **ユーザー ID** – 作業者を選択します。 この作業者は、受信キューを通じて処理されるすべての作業操作 (ピッキングおよびプット) を実行するために使用されます。
    - **受信メッセージ ID を有効にする** – このオプションが *はい* に設定されている場合、重複する受信メッセージ ID を受信するとメッセージが拒否され、エラー メッセージにメッセージが既に存在することが示されます。 このオプションを *いいえ* に設定すると、重複する受信メッセージ ID が許可されます。

3. **番号順序** タブで、システム全体の番号順序を選択します。この番号順序を使用して、受信キュー項目、発信キュー品目、および作業明細行のペアに対して固有 ID を生成します。

## <a name="outbound-events"></a>発信イベント

作業の作成中または作業の実行中の特定の時点で、MH システムに送信する発信イベントを生成する必要するかどうかはシステムが決定します。 倉庫の処理中に特定のポイントに対してサブスクリプションが構成されている場合、サブスクリプションの設定に従ってイベントが生成されます。

### <a name="structure-of-outbound-events"></a>発信イベントの構造

各発信イベントは、発信キュー ID で一意に識別されます。 発信トランザクション タイプはイベントのタイプを決定します。 イベントを生成したサブスクリプションの倉庫および ID もイベントに記録されます。

MH システムにデータを転送するために、発信イベントには、データ用の 10 フィールド (**data01** から **data10**) が含まれます。 これらのデータ フィールドには、既存のデータベース フィールドに対して 1 対 1 (1:1) のマッピングがあります。 具体的には、作業明細行および作業ヘッダー テーブルのフィールドから抽出されます。 フィールドは自由に選択できます。 サブスクリプションを作成するときに設定します。

既存のデータベース フィールドに対して 1:1 のマッピングを行う 10 のデータ フィールドに加え、イベントには、*ペイロード* と呼ばれる追加のデータ フィールドを含めることができます。 このフィールドの内容は、*ペイロード ジェネレーター* と呼ばれるカスタム X++ コードによって生成されます。 使用する必要があるすべてのペイロード ジェネレーターはサブスクリプションで設定されます。

MH システムが各発信キュー ID を 1 回だけ受信するために、ステータス フィールドを使用して、イベントを外部システムに送信できるかどうか、またはすでに送信されているかどうかを指定します。

### <a name="outbound-queue-subscriptions"></a>発信キューのサブスクリプション

イベントを生成する前に、イベントを生成するかどうか、および生成する方法を MHAX 機能に示すサブスクリプションを設定する必要があります。 生成されたイベントはサブスクリプション ID によってタグ付けされます。 したがって、複数の MH システムは同じ WMS システムに接続できますが、イベントは別々に維持されます。 MHAX サービスが新しいイベントに対するポーリングを行う場合、サブスクリプションはイベントを取得する際に使用できるオプションの 1 つです。

サブスクリプションを作成するには、**材料取り扱い設備のインターフェイス \> 設定 \> サブスクリプション** に移動します。 各サブスクリプションに対して、次のパラメータを使用できます。

- **サブスクリプション ID** – サブスクリプションを識別する一意の名前。
- **説明** – サブスクリプションの自由書式の説明。
- **倉庫** – イベントをフィルタ処理する特定の倉庫。
- **発信トランザクション タイプ** – サブスクリプションに含まれるイベントのタイプ。
- **ペイロード ジェネレーター** – 発信イベントの **プレイロード** フィールドに追加情報を入力できるコード拡張機能。

クエリは各サブスクリプションに関連付けできます。 このクエリは、作業明細行とヘッダーをフィルタ処理して、サブスクリプションを使用してイベントを生成する作業をさらに制限します。 サブスクリプションにクエリを追加するには、**サブスクリプション** ページで関連するサブスクリプションの **クエリの実行** チェック ボックスをオンにし、アクション ウィンドウで **クエリの編集** を選択します。 標準の Supply Chain Management クエリ エディターが表示されます。

さらに、サブスクリプションには、必要に応じて、作業ヘッダーまたは作業明細行のいずれかのフィールドを発信イベントの 10 種類の空きデータ フィールドの一部またはすべてにマップする *サブスクリプション マップ* が含まれます。 MHAX サービスに情報を返すには、通常、作業明細行レコード ID または *作業明細行ペア ID* が含まれます。 (作業明細行ペア ID は、システムが単一の返却コマンドを使用してピッキング明細行とプット明細行を処理できるようにする新しいプロパティです。) 残りのフィールドは、ユース ケースによって異なります。 この記事の後半で例をいくつか紹介します。

サブスクリプション マップを設定するには、**サブスクリプション** ページで関連するサブスクリプションを選択し、アクション ウィンドウで **サブスクリプション マップ** を選択します。 表示された **サブスクリプション マップ** ダイアログ ボックスで、必要に応じて使用できる各データ フィールドに対してテーブルとフィールドを割り当てることができます。

### <a name="outbound-event-types"></a>発信イベント タイプ

このセクションでは、使用可能なさまざまなイベント タイプについて説明します。 (イベント タイプは *トランザクション タイプ* とも呼ばれます。) また、各タイプのイベントが WMS システムでいつ作成されるかについても説明します。

#### <a name="work-creation-events"></a>作業作成イベント

作業作成イベントは、アプリケーションによって作業が生成された後に作成されます。 この動作は、ほとんどのタイプの作業作成プロセス、特にピッキングおよび補充作業の作成に適用されます。 一般に、作業が *オープン* 状態で作成され、作業を作業員が実行できる状態を示す場合は、作業作成イベントが生成されます。 さらに、基本的な移動作業 (テンプレート作業による移動ではない) については、オープン作業として作成されていなくても、作業作成イベントが生成されます。

この動作の例外として、現在サポートされていない循環棚卸作業があります。 MH システムの在庫棚卸は MHAX の範囲外にあり、棚卸の結果を在庫棚卸仕訳帳にインポートする必要があります。

作業の作成が完了すると、MHAX サービスは生成された作業明細行を処理し、各作業ヘッダーに対して生成されたすべての作業明細行に作業明細行ペア ID を割り当てます。 その目的は、すべてのピッキング作業明細行を、1 つの作業行に分け、その後の 1 つの作業行に分法でグループ化します。 (グループは、作業テンプレートのピック/プットのペアに対応します。) これにより、1 つの ID を使用して、関連のすべてのピッキング明細行とプット明細行の作業完了を報告できます。 グループ化プロセスは最初の行から始まり、連続するプット/ピック作業明細行のペアに遭遇するまで同じ ID で続行されます。 実行している ID は、そのペアのプット明細行に割り当てられます。 その後、ペアのピック明細行に使用される新しい ID。 このプロセスは、作業ヘッダーに属しているすべての明細行が処理されるまで続行されます。

作業作成イベントの特別な機能として、作業ヘッダーで **ブロックされたウェーブ** を *はい* に設定した場合、生成されたイベントは、MH システムへの送信に使用される *準備完了* の通常のステータスではなく、ステータスが *ブロック* になります。 作業ヘッダーの **ブロックされたウェーブ** フラグは、おそらく未完了の補充作業のために、作業ヘッダーがまだ作業者を実行する準備ができていないことを示します。 **ブロックされたウェーブ** フラッグが無効にされている場合、生成済みのイベントのブロックが解除され、MH システムがキューから取得できます。

#### <a name="work-initiation-events"></a>作業開始イベント

作業開始イベントは、作業状態が作業の更新時に *開く* から *進行中* に変更される場合にトリガーされます。

#### <a name="work-completion-events"></a>作業完了イベント

作業完了イベントは、作業状態が作業の更新時に *進行中* から *終了済* に変更される場合にトリガーされます。

#### <a name="work-cancellation-events"></a>作業のキャンセル イベント

作業完了イベントは、作業状態が作業の更新時に *キャンセル済み* から *キャンセル済み* 以外のステータスに変化したときにトリガーされます。 さらに、作業ヘッダーに関連付けらた他のすべてのイベントは、すべてのサブスクリプションのキューから削除されます。 これにより、外部システムが不必要なイベントを処理するのを防ぎます。

#### <a name="pickput-completion-events"></a>ピック/プット完了イベント

ピック/プット完了イベントは、作業明細行の更新中にピック/プット明細行の状態が *進行中* から *終了済* に変更される場合にトリガーされます。

### <a name="monitor-the-outbound-queue"></a>発信キューの監視

発信キューを確認するには、**材料取り扱い設備のインターフェイス \>共通 \> 発信キュー** に移動します。 **発信キュー** ページは、すべての発信キュー品目とその状態が一覧表示されます。 キュー品目を選択して、その詳細を表示します。 これらの詳細には、品目のトランザクション タイプ、使用したサブスクリプション、各データ フィールド (**data01** から **data10**) およびペイロードの値が含まれます。

### <a name="clean-up-the-outbound-queue"></a>発信キューのクリーンアップ

最終的に、発信キューは既に送信されたキュー品目でいっぱいになり始めます。 これらの品目を削除するには、**材料取り扱い設備のインターフェイス \> 定期処理のタスク \> クリーンアップ\> 発信キューのクリーンアップ** に移動します。

## <a name="inbound-events"></a>受信イベント

このセクションでは、MH システムが WMS システムに報告できるさまざまな種類の受信イベントについて説明します。 また、データは MH システムによって提供される必要があり、各受信イベントが WMS システムで何を行うかについても説明します。

### <a name="structure-of-inbound-events"></a>受信イベントの構造

受信イベントが送信されると、外部システムは最大 10 個のパラメータ (**data01** から **data10**) とともに受信トランザクション タイプを提供する必要があります。 オプションの検証により、MHAX サービスが同じ受信イベントを複数回受信していないことを確認できます。 この検証を有効にするには、各受信イベントに一意のメッセージ ID が必要です。 重複するメッセージ ID を受信し、**材料取り扱い設備のインターフェイス パラメーター** ページで **受信メッセージ IDを有効にする** オプションが *はい* に設定されている場合、メッセージは拒否されます。 エラー メッセージは、メッセージが既に存在することを示します。

受信データ フィールドに加えて、システムはイベントに一意の受信キュー ID を割り当てます。

### <a name="inbound-event-types"></a>受信イベント タイプ

このセクションでは、サポートされている受信イベント タイプ (トランザクション タイプ) と、イベントを処理するために提供する必要のあるデータについて説明します。

#### <a name="work-confirm-events"></a>作業確認イベント

作業確認イベントは、受信するデータ フィールドに次の情報が含まれる必要があります。

- **data01** – 作業明細行ペア ID。
- **data02** – 作業明細行レコード ID (`RecId` 値)。

    > [!NOTE]
    > **data01** フィールド *または* **data02** フィールドの *どちらか* が存在している必要があります。

- **data03** – ピックするライセンス プレートの ID。
- **data04** – 作業ヘッダーのターゲット ライセンス プレート ID。

作業明細行ペア ID が提供されている場合、作業明細行ペア ID でマークされ、状態が *開く* または *進行中* であるすべてのピック、プット、またはカスタム作業明細行が順番に実行されます。 作業明細行レコード ID (`RecId` 値) が提供されている場合は、*開く* または *進行中* の状態を持つ、作業明細行がピック、プット、またはカスタム作業明細行である必要があります。

ライセンス プレートで管理されている場所からのピック明細行では、明細行が作業明細行レコード ID または作業明細行ペア ID のどちらでマークされているかに関係なく、**data03** でピックするライセンス プレートを指定する必要があります。 **data04** フィールドは、ピックに対する作業ヘッダーのターゲット ライセンス プレートを指定する必要があります。

プット明細行は、それ以上の情報を受け入れません。 これらは、現在の作業明細行の場所と作業のターゲット ライセンス プレートのみに基づいて実行されます。 別の場所にプットを行う必要がある場合は、この記事の後半の [上書きイベント](#override-events) セクションの説明に従って、作業明細行の場所を変更してください。

カスタム作業明細行は、受信イベントで追加情報を必要とせず、サポートしません。

#### <a name="short-pick-events"></a>ショート ピック イベント

ショート ピック イベントは、受信するデータ フィールドに次の情報が含まれる必要があります。

- **data02** – 作業レコード ID (`RecId` 値)。
- **data03** – ピックするライセンス プレートの ID。
- **data04** – ピックする数量。
- **data05** – ショート ピック例外コード。
- **data06** – 作業ヘッダーのターゲット ライセンス プレート ID。

> [!NOTE]
> **data01** フィールド は、ショート ピック イベントに使用されません。

このイベントは作業確認イベントと似ていますが、ピック明細行にのみ適用されます。

#### <a name="override-events"></a><a id="override-events"></a> 上書きイベント

上書きイベントは、受信するデータ フィールドに次の情報が含まれる必要があります。

- **data01** – 作業レコード ID (`RecId` 値)。
- **data02** – 新しい場所の ID。

作業明細行は、*開く* または *進行中* のいずれかの状態であり、 新しい場所が存在する必要があります。

#### <a name="license-plate-receipt-events"></a>ライセンス プレート受領書イベント

ライセンス プレート受領書イベントは、受信するデータ フィールドに次の情報が含まれる必要があります。

- **data01** – 受け取る受信ライセンス プレートの ID。

システムは、**data01** フィールドの値として渡されたライセンス プレートに基づいて、ライセンス プレートの入荷の操作を実行します。

### <a name="monitor-the-inbound-queue"></a>受信キューの監視

受信キューを確認するには、**材料取り扱い設備のインターフェイス \>共通 \> 受信キュー** に移動します。 **受信キュー** ページは、すべての受信キュー品目とその状態が一覧表示されます。 キュー品目を選択して、その詳細を表示します。 これらの詳細には、品目のトランザクション タイプ、メッセージ ID、各データ フィールド (**data01** から **data10**) の値が含まれます。

受信イベントの処理中にエラーまたは別のタイプのログ品目が発生した場合は、アクション ウィンドウで **エラー ログ** を選択してログを検査できます。

### <a name="inbound-event-processing"></a>受信イベントの処理

受信イベントは、まずデータベースに書き込まれた後、すぐに (同期敵に) 実行されます。 処理中にエラーが発生した場合でもイベントはキューに書き込まれますが、状態は *エラー済* に設定されています。 MHAX サービスは MH システムにエラー メッセージを返し、その後の調査のために受信イベント レコードにエラー ログを格納します。

*エラー* の状態があるイベントは、エラー条件が修正されれば、後で再処理できます。 それらを再処理するには、次のいずれかの手順に従います。

- **材料取り扱い設備のインターフェイス \> 共通 \> 受信キュー** に移動します。 関連する受信キューを選択し、アクション ウィンドウ **再処理** を選択します。
- **材料取り扱い設備のインターフェイス \> 共通 \> エラー受信キューの再処理** に移動します。 標準のバッチ ジョブ ダイアログ ボックスが表示されます。 そこでレコード フィルタを設定し、バッチ ジョブをスケジュールまたは実行してキューを再処理できます。

すべての作業操作 (ピックとプット) は、**材料取り扱い設備のインターフェイス パラメーター** ページの **ユーザー ID** フィールドで選択された作業者を使用して実行されます。

### <a name="clean-up-the-inbound-queue"></a>受信キューのクリーンアップ

最終的に、受信キューは既に処理されたキュー品目でいっぱいになり始めます。 これらの品目を削除するには、**材料取り扱い設備のインターフェイス \> 定期処理のタスク \> クリーンアップ\> 受信キューのクリーンアップ** に移動します。

## <a name="get-a-quick-overview-by-using-the-queue-manager"></a>キュー マネージャを使用した簡単な概要の取得

受信キューと発信キューに関連付けられているすべての活動の簡単な概要を取得するには、**材料取り扱い設備のインターフェイス \> ワークスペース \> キュー マネージャ** に移動します。 **キュー マネージャ** ページは、キューを監視および参照するために使用できる一連のタブとタイルを提供します。 また、この記事に記載されている他の多くのページへの便利なリンクも紹介します。

## <a name="connect-to-the-mhax-service"></a>MHAX サービスに接続

MHAX はカスタム サービスとして実装されます。 したがって、SOAP および REST 呼び出しを介してアクセスできます。 SOAP および REST エンドポイントのアドレスは次のとおりです。

- **SOAP:** `https://base_environment_URL/soap/services/WMHEServices`
- **REST:** `https://base_environment_URL/api/services/WMHEServices/WMHEService`

## <a name="retrieve-messages-from-the-outbound-queue"></a>発信キューからのメッセージの取得

発信キューからメッセージを取得するには、次のいずれかの方法を使用します。

- `readOutboundSubscriptionQueue` を使用してサブスクリプション ID に基づいてイベントを取得します。
- `readOutboundWarehouseQueue` を使用して複数のサブスクリプションにわたるイベント タイプと倉庫 ID に基づいてイベントを取得します。
