---
title: 倉庫管理の手持在庫エントリ クリーンアップ ジョブ
description: このトピックでは、関連する不要なレコードを識別および削除することによってシステムのパフォーマンスを向上させる、手持在庫エントリのクリーンアップ  ジョブについて説明します。
author: perlynne
ms.date: 04/23/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: SysOperationTemplateForm
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: perlynne
ms.search.validFrom: 2020-04-03
ms.dyn365.ops.version: Release 10.0.12
ms.openlocfilehash: 4dd3bb9dc580e715b6945da1f94cf27e601c549e
ms.sourcegitcommit: 0e8db169c3f90bd750826af76709ef5d621fd377
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/01/2021
ms.locfileid: "5808729"
---
# <a name="warehouse-management-on-hand-entries-cleanup-job"></a><span data-ttu-id="c6bb4-103">倉庫管理の手持在庫エントリ クリーンアップ ジョブ</span><span class="sxs-lookup"><span data-stu-id="c6bb4-103">Warehouse management on-hand entries cleanup job</span></span>

<span data-ttu-id="c6bb4-104">手持在庫の計算に使用されるクエリのパフォーマンスは、関連するテーブルのレコード数によって影響されます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-104">The performance of queries that are used to calculate on-hand inventory is affected by the number of records in the tables that are involved.</span></span> <span data-ttu-id="c6bb4-105">パフォーマンスを向上させる方法の 1 つとして、データベースで考慮する必要があるレコードの数を減らすことがあります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-105">One way to help improve the performance is to reduce the number of records that the database must consider.</span></span>

<span data-ttu-id="c6bb4-106">このトピックでは、InventSum と WHSInventReserve のテーブルから不要なレコードを削除する、手持在庫エントリのクリーンアップ ジョブについて説明します。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-106">This topic describes the on-hand entries cleanup job, which deletes unneeded records in the InventSum and WHSInventReserve tables.</span></span> <span data-ttu-id="c6bb4-107">これらのテーブルには、倉庫管理処理が有効になっている品目の手持情報が格納されます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-107">These tables store on-hand information for items that are enabled for warehouse management processing.</span></span> <span data-ttu-id="c6bb4-108">(これらの品目は WHS 品目と呼ばれます。) これらのレコードを削除すると、手持在庫計算のパフォーマンスが大幅に向上する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-108">(These items are referred to as WHS items.) Deletion of these records can significantly improve the performance of on-hand calculations.</span></span>

## <a name="what-the-cleanup-job-does"></a><span data-ttu-id="c6bb4-109">クリーンアップ ジョブとは</span><span class="sxs-lookup"><span data-stu-id="c6bb4-109">What the cleanup job does</span></span>

<span data-ttu-id="c6bb4-110">手持在庫エントリのクリーンアップ ジョブでは、すべてのフィールド値が *0* (ゼロ) である WHSInventReserve テーブルと InventSum テーブルのすべてのレコードが削除されます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-110">The on-hand entries cleanup job deletes any records in the WHSInventReserve and InventSum tables where all the field values are *0* (zero).</span></span> <span data-ttu-id="c6bb4-111">これらのレコードは、手持在庫情報に寄与しないので、削除することができます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-111">These records can be deleted because they don't contribute to the on-hand information.</span></span> <span data-ttu-id="c6bb4-112">このジョブでは、**場所** レベル以下のレコードのみが削除されます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-112">The job deletes only records that are below the **Location** level.</span></span>

<span data-ttu-id="c6bb4-113">マイナスの現物在庫が許可されている場合は、クリーンアップ ジョブによってすべての関連エントリを削除できない場合があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-113">If negative physical inventory is allowed, the cleanup job might not be able to delete all the relevant entries.</span></span> <span data-ttu-id="c6bb4-114">このような制限があるのは、ライセンス プレートに複数のシリアル番号があり、それらのシリアル番号のいずれかがマイナスになるような特殊なシナリオでジョブを実行する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-114">The reason for this limitation is that the job must allow for a special scenario where a license plate has multiple serial numbers, and one of those serial numbers has become negative.</span></span> <span data-ttu-id="c6bb4-115">たとえば、ライセンス プレートにシリアル番号 1 が+1 台、シリアル番号 2 が –1 台ある場合、ライセンス プレートのレベルではシステムは手元にあるのはゼロになります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-115">For example, the system will have zero on hand at the license plate level when a license plate has +1 pcs of serial number 1 and –1 pcs of serial number 2.</span></span> <span data-ttu-id="c6bb4-116">この特殊なシナリオでは、ジョブで範囲の最初の削除が行われ、下位のレベルから先に削除が試行されます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-116">For this special scenario, the job does a breadth-first deletion, where it tries to delete from lower levels first.</span></span>

## <a name="schedule-and-configure-the-cleanup-job"></a><span data-ttu-id="c6bb4-117">クリーンアップ ジョブのスケジュールと構成</span><span class="sxs-lookup"><span data-stu-id="c6bb4-117">Schedule and configure the cleanup job</span></span>

<span data-ttu-id="c6bb4-118">手持在庫管理の定期処理タスクは、を使用でき **倉庫管理 \> 定期処理タスク \> クリーンアップ \> 手持在庫エントリのクリーンアップ** で使用できます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-118">The on-hand entries cleanup job is available at **Inventory management \> Periodic tasks \> Clean up \> Warehouse management on-hand entries cleanup**.</span></span> <span data-ttu-id="c6bb4-119">ジョブを実行するためのスコープとスケジュールを制御するには、標準のジョブ設定を使用します。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-119">Use the standard job settings to control the scope and schedule for running the job.</span></span> <span data-ttu-id="c6bb4-120">さらに、次の設定が提供されます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-120">In addition, the following settings are provided:</span></span>

- <span data-ttu-id="c6bb4-121">**この日数更新されていない場合は削除** - 数量がゼロになった手持在庫エントリが削除されるまでにジョブが待機する最小日数を入力します。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-121">**Delete if not updated for this many days** – Enter the minimum number of days that the job should wait before it deletes an on-hand entry that has dropped to zero quantity.</span></span> <span data-ttu-id="c6bb4-122">この設定を使用すると、まだ使用されている手持在庫エントリを削除してしまうリスクを軽減することができます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-122">Use this setting to help reduce the risk of deleting on-hand entries that are still being used.</span></span> <span data-ttu-id="c6bb4-123">クリーンアップをできるだけ早く実行するには、*0* (ゼロ) を入力するか、このフィールドを空白のままにします。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-123">If you want cleanup to occur as soon as possible, either enter *0* (zero) or leave the field blank.</span></span>
- <span data-ttu-id="c6bb4-124">**最大実行時間 (時間)** - クリーンアップ ジョブの最大実行時間を時間単位で入力します。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-124">**Maximum execution time (hours)** – Enter the maximum execution time of the cleanup job, in hours.</span></span> <span data-ttu-id="c6bb4-125">この時間が経過する前にジョブが完了していない場合は、これまで完了した作業を保存して閉じます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-125">If the job isn't completed before this time passes, it will save the work that it has completed so far and then close itself.</span></span> <span data-ttu-id="c6bb4-126">この機能は、在庫使用が多い実装に特に関連しています。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-126">This capability is especially relevant for implementations that have high inventory use.</span></span> <span data-ttu-id="c6bb4-127">このような場合は、システムの負荷ができるだけ軽い時にジョブが実行されるようにスケジュールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-127">In these cases, you should schedule the job to run at times when the system load is as light as possible.</span></span> <span data-ttu-id="c6bb4-128">バッチ ジョブが完了するまで継続して実行されるようにするには、*0* (ゼロ) を入力するか、このフィールドを空白のままにします。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-128">If you want the batch job to continue to run until it's completed, either enter *0* (zero) or leave the field blank.</span></span> <span data-ttu-id="c6bb4-129">この設定は、関連する機能が [システムでオンになっている場合](#max-execution-time) にのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-129">This setting is available only if the related feature has been [turned on in your system](#max-execution-time).</span></span>

<span data-ttu-id="c6bb4-130">通常の業務時間内にジョブを実行することもできますが、業務時間外にジョブを実行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-130">Although you can run the job during regular business hours, we recommend that you run it outside working hours.</span></span> <span data-ttu-id="c6bb4-131">この方法を取ることで、ユーザーがクリーンアップされるレコードを処理している場合に発生する競合を回避するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-131">In this way, you help prevent conflicts that can occur if a user is working with a record that is also being cleaned up.</span></span>

<span data-ttu-id="c6bb4-132">そのレコードが別のユーザーによって使用されているときに、その品目のレコードを削除しようとすると、クリーンアップ ジョブとユーザーのいずれかでデッドロック エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-132">If the job tries to delete a record for an item while that record is being used by another user, a deadlock error occurs for either the cleanup job or the user.</span></span>

<span data-ttu-id="c6bb4-133">ジョブが実行されると、コミット サイズは 100 になります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-133">When the job runs, it has a commit size of 100.</span></span> <span data-ttu-id="c6bb4-134">つまり、100 回削除するごとに 1 回コミットしようとします。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-134">In other words, it will try to commit one time for every 100 deletions.</span></span> <span data-ttu-id="c6bb4-135">ただし、一部の削除は設定ベースなので、同じトランザクションで 100 以上のレコードを削除できる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-135">However, because some deletions are set-based, there might be scenarios where more than 100 records can be deleted in the same transaction.</span></span> <span data-ttu-id="c6bb4-136">したがって、ロック エスカレーションが依然として発生する場合があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-136">Therefore, lock escalations can still sometimes occur.</span></span>

## <a name="possible-user-impact"></a><span data-ttu-id="c6bb4-137">考えられるユーザーへの影響</span><span class="sxs-lookup"><span data-stu-id="c6bb4-137">Possible user impact</span></span>

<span data-ttu-id="c6bb4-138">特定のレベル (ライセンス プレートのレベルなど) のすべてのレコードが手持在庫エントリのクリーンアップ ジョブによって削除されると、ユーザーへの影響が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-138">Users might be affected if the on-hand entries cleanup job deletes all the records for a given level (such as the license plate level).</span></span> <span data-ttu-id="c6bb4-139">この場合、関連する手持在庫エントリは使用できなくなるため、ライセンス プレートで以前に在庫が使用可能になったことを確認する機能が予想どおりに機能しないことがあります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-139">In this case, the functionality for seeing that inventory was previously available on-hand at a license plate might not work as expected because the relevant on-hand entries are no longer available.</span></span> <span data-ttu-id="c6bb4-140">たとえば、次のような状況が発生します。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-140">This can, for example, be experienced in the following situations:</span></span>

- <span data-ttu-id="c6bb4-141">**手持在庫** リストで、ユーザーが条件 **数量 \<\> 0** を選択解除するか、**分析コード表示設定** で **終了済トランザクション** 条件を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-141">On the **On-hand list**, when the user deselects the condition **Quantity \<\> 0** or selects the condition **Closed transactions** in the **Dimensions display** settings.</span></span>
- <span data-ttu-id="c6bb4-142">ユーザーが **現在の日付** パラメーターを設定した場合の、過去の期間の **在庫分析コード別の物理在庫** レポート。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-142">In a **Physical inventory by inventory dimension** report for past periods, when the user sets the **As of date** parameter.</span></span>

<span data-ttu-id="c6bb4-143">ただし、クリーンアップ ジョブによって提供されるパフォーマンスの向上は、機能におけるこれらの小さな損失を損なう必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-143">However, the performance improvement that the cleanup job provides should make up for these small losses in functionality.</span></span>

## <a name="make-the-maximum-execution-time-setting-available"></a><a name="max-execution-time"></a><span data-ttu-id="c6bb4-144">最大実行時間の設定を有効にする</span><span class="sxs-lookup"><span data-stu-id="c6bb4-144">Make the Maximum execution time setting available</span></span>

<span data-ttu-id="c6bb4-145">規定では、**最大実行時間** 設定は使用できません。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-145">By default, the **Maximum execution time** setting isn't available.</span></span> <span data-ttu-id="c6bb4-146">この機能を使用する場合は、[機能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) を使用して、システムの関連機能を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-146">If you want to use it, you must use [feature management](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) to turn on the related feature in your system.</span></span> <span data-ttu-id="c6bb4-147">**機能管理** ワークスペースで、この機能は次のようにリストされています。</span><span class="sxs-lookup"><span data-stu-id="c6bb4-147">In the **Feature management** workspace, the feature is listed in the following way:</span></span>

- <span data-ttu-id="c6bb4-148">**モジュール:** *倉庫管理*</span><span class="sxs-lookup"><span data-stu-id="c6bb4-148">**Module:** *Warehouse management*</span></span>
- <span data-ttu-id="c6bb4-149">**機能名:** *倉庫管理の手持在庫エントリ クリーンアップ ジョブの最大実行時間*</span><span class="sxs-lookup"><span data-stu-id="c6bb4-149">**Feature name:** *Maximum execution time for the warehouse management on-hand entries cleanup job*</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]