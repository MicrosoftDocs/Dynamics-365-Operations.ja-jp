---
title: CTP を使用した販売注文配送日の計算
description: 精算可能在庫 (CTP) 機能を使用すると、特定の商品を約束できる現実的な日付を顧客に提示することができます。 この記事では、各計画エンジン (計画の最適化および組み込みエンジン) に CTP を設定および使用する方法について説明します。
author: t-benebo
ms.date: 07/20/2022
ms.topic: article
ms.search.form: SalesAvailableDlvDates, SalesTable, CustParameters, InventItemOrderSetup
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: benebotg
ms.search.validFrom: 2022-07-20
ms.dyn365.ops.version: 10.0.28
ms.openlocfilehash: 9a2d8a66fe7e68ebd5729a401af3f0efe04051b1
ms.sourcegitcommit: e0905a3af85d8cdc24a22e0c041cb3a391c036cb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/06/2022
ms.locfileid: "9229938"
---
# <a name="calculate-sales-order-delivery-dates-using-ctp"></a>CTP を使用した販売注文配送日の計算

[!include [banner](../../includes/banner.md)]
[!INCLUDE [preview-banner](../../includes/preview-banner.md)]

精算可能在庫 (CTP) 機能を使用すると、特定の商品を約束できる現実的な日付を顧客に提示することができます。 各販売行に対して、既存の在庫、生産能力、輸送時間を考慮した日付を指定できます。

CTP は、能力情報を考慮して[納期回答可](../../sales-marketing/delivery-dates-available-promise-calculations.md) ATP の機能を拡張します。 ATP では材料の入手可能性のみを考慮し、無限能力リソースを考慮しますが、CTP では材料と能力の両方の入手可能性が考慮されます。 したがって、指定された概算時間で需要が満たされるかどうかのより現実的な画像を提供します。

CTP は、(計画最適化または内蔵エンジン) を使用しているか、組み込みのマスター プラン エンジンを使用しているかによって、動作が若干異なります。 この記事では、各エンジンに対してそれを設定する方法について説明します。 計画最適化のための CTP は現在、組み込みエンジンでサポートされている CTP シナリオのサブセットのみをサポートしています。

## <a name="turn-on-ctp-for-planning-optimization"></a>計画最適化のための CTP を有効にする

内蔵マスター プラン エンジンのための CTP は常に利用できます。 ただし、計画の最適化のための CTP を使用する場合は、システム用にこの機能を有効にする必要があります。 管理者は、[機能管理](../../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) 設定を使用して、機能の状態を確認し、有効にすることができます。 **機能管理** ワークスペースで、この機能は次のようにリストされています。

- **モジュール:** *マスター プラン*
- **フィーチャー名:** *(プレビュー) 計画最適化のための CTP*

## <a name="how-ctp-compares-to-atp"></a>CTP と ATP の比較

CTP と ATP は似ていますが、次の例に示すように、CTP の方が正確な結果を出す場合があります。

品目 A は品目 B と品目Cで構成される品目で、品目 A の数量は 0 (ゼロ) です。 材料のみを考慮した ATP チェックを実行すると、ATP 数量も 0 (ゼロ) になります。 ただし、CTP チェックを実行すると、システムは品目 B および C の引当可能在庫を確認して、品目 A にするために必要なリソースを確認して、品目 A にできる数を計算します。 さらに、CTP 計算では、B および C の品目を多く製造するために必要なリソースと材料を確認し、それらを使用して品目 A を多くすることができます。

材料とリソースの両方を考慮する CTP 計算では、材料のみをチェックする計算よりも多くの数量が表示される場合があります (特に、確認する品目が受注生産品目の場合など)。 言い換えれば、CTP 機能は停止機能に基づいており、予想配送日を計算するために選択した販売注文に対して実行できます。

## <a name="how-ctp-differs-depending-on-the-master-planning-engine-that-you-use"></a>CTP の種類は、使用するマスター プラン エンジンによって異なります。

次の表に、組み込みのマスター プラン エンジンに対する 計画最適化のための CTP と CTP の違いを示します。

| 要素 | 計画の最適化 | 組み込みマスター計画エンジン |
|---|---|---|
| 注文、注文 明細行、および製品の **配送日管理** 設定 | *計画最適化のための CTP* | *CTP* |
| 計算時刻 | この計算は、動的プランをスケジュールされたタスクとして実行することでトリガーされます。 | この計算は、販売注文の行を入力または更新する度にすぐに実行されます。 |
| **計画最適化のための CTP の状態** フィールド値 | <p>*準備が完了していない* という値は、注文と明細行が作成または最後に更新された後に動的計画が実行されていない注文や注文明細行に対して表示されます。</p><p>動的計画を実行 して 確認された出荷日の計算に CTP が使用された注文および明細行には、*準備完了* の値が表示されます。</p> | *準備完了* の値が常に表示されます。 |

## <a name="set-default-delivery-date-control-methods"></a><a name="default-methods"></a>既定の配送日の管理方法の設定

システムでは、複数の方法を使用して、各注文および注文明細行の出荷日見積を計算できます。 ほとんどの場合は、グローバル既定の方法として配送日の管理方法を設定する必要があります。 また、各製品に個別の上書きを設定できます。 後で、必要に合った各注文または注文明細行の既定のメソッドを上書きできます。

### <a name="set-the-global-default-delivery-date-control"></a><a name="global-default"></a>グローバル既定配送日の管理を設定する

上書きが適用されないすべての新しい注文明細行に、既定の配送日の管理方法が適用されます。 ひとつを選択するには、次の手順に従います。

1. **売掛金勘定 \> 設定 \> 売掛金勘定パラメーター** に移動します。
1. **出荷** タブの、**配送管理** クイックタブにある、**配送日の管理** フィールドで、会社の既定のメソッドとして使用する方法を選択します。

    - *なし* – 確定配送日の計算。
    - *販売リード タイム* – 販売リード タイムは、販売注文の作成から品目の出荷までの時間です。 配送日の計算は日数の既定値に基づき、有効在庫数、既知の要求、または供給計画は考慮されません。
    - *ATP* – ATP は、顧客に特定の日付で納期を回答できる使用可能な品目の数量です。 ATP の計算には、未コミット在庫、リード タイム、計画受入と払出が含まれます。
    - *ATP + 払出安全日数* – 出荷日は、ATP 日付に品目の払出安全日数を加えた日付と同じになります。 払出安全日数は、品目を出荷する準備にかかる時間です。
    - *CTP* - 組み込みのマスタ プラン エンジンによって提供される CTP 計算を使用します。 計画の最適化を使用している場合、*CTP* 配送日管理方法は許可されません。選択されている場合、計算が実行されるとエラーが発生します。
    - *計画最適化のための CTP* – 計画の最適化によって提供される CTP 計算を使用します。 組み込みのマスター プラン エンジンを使用している場合は、このオプションは効果がありません。

### <a name="set-delivery-date-control-overrides-for-individual-products"></a>個々の製品の配送日管理の上書きの設定

グローバル既定の方法として設定されているのとは異なる配送日の管理方法を使用する特定の製品に対して、上書きを割り当てできます。

1. **製品管理情報 \> 製品 \> リリースされた製品** の順に移動します。
1. 設定する製品を選択します。
1. アクション ペインで、**在庫の管理** タブの **注文設定** グループで、**既定の注文設定** を選択します。
1. **既定の注文設定** ページの **販売注文** クイックタブで、**配送の上書き** コントロール オプションを *はい* に設定します。
1. **配送日の管理** フィールドで、選択した製品に使用する方法を選択します。 [グローバル既定の配送日の設定](#global-default) で説明されているのと同じオプションを 使用できます。

## <a name="schedule-ctp-for-planning-optimization-calculations"></a><a name="batch-job"></a>計画の最適化のための CTP 算定のスケジュール

計画の最適化のための CTP を使用する場合は、動的計画を実行して CTP 計算を実行し、すべての関連する注文の確認済の出荷日および入荷日を設定する必要があります。 この計画には、出荷日および入荷日を確認したすべての品目が含まれる必要があります。 (組み込み計画エンジンに CTP を使用すると、ローカルで CTP 計算がすぐに行われます。 したがって、動的プランを実行して CTP 結果を確認する必要は一度も発生しません。

すべてのユーザーが日付を適切な時間に利用するように、関連する計画を定期的に実行するようにバッチ ジョブを設定することをお勧めします。 たとえば、動的プランを 30 分おきに実行するために設定されたバッチ ジョブでは、確認された出荷日と受信日が 30 分おきに設定されます。 したがって、注文の入力およびインポートを行うユーザーは、確認された出荷日および受信日を取得するために最大 30 分待つ必要があります。

動的プランを定期的に実行するバッチ ジョブを設定するには、次の手順に従います。

1. **マスター プラン \>マスター プラン \> 実行 \> マスター プラン** の順に移動します。
1. **マスタ プラン** ダイアログ ボックスの **パラメータ** クイック タブで、**マスタ プラン** フィールドを実行する動的マスタ プランに設定します。
1. **バックグラウンドで実行** クイックタブで、**バッチ処理** オプションを *はい* に設定します。
1. **繰り返し** を選択し、必要に応じてスケジュールを設定します。
1. **OK** を選択して、スケジュールを保存します。
1. **OK** を選択して一括ジョブを作成し、ダイアログ ボックスを閉じます。

## <a name="use-ctp-for-built-in-master-planning"></a>組み込みマスター計画に CTP を使用する

### <a name="create-a-new-order-by-using-ctp-for-built-in-master-planning"></a>組み込みのマスター プランに CTP を使用した新しい注文を作成する

新しい販売注文または注文書の行を追加する度に、システムは既定の配送日管理方法を割り当てる必要があります。 注文ヘッダーは常にグローバル既定のメソッドで始まります。 上書きが注文品目に割り当てられている場合は、その上書きが新しい注文明細で使用されます。 それ以外の場合は、新しい注文行はグローバル既定の方法も使用します。 従って、最もよく使用する配送日と一致するように、規定メソッドを設定する必要があります。 注文を作成した後は、既定のメソッドを注文ヘッダーレベルまたは注文行レベルで必要に合って上書きできます。 詳細については、[既定の配送日管理方法の設定](#default-methods) および [CTP を使用する既存の販売注文の変更](#change-orders) を参照してください。

### <a name="view-confirmed-delivery-dates-when-you-use-ctp-for-built-in-master-planning"></a>組み込みのマスタ プランで CTP を使用する場合の確認済出荷日の表示

組み込みのマスター プラン エンジンを使用している場合は、**出荷日の管理** フィールドが *CTP* に設定されている注文明細行または注文明細行に CTP 計算が適用されます。

組み込みマスタ プランに CTP を使用する販売明細行の場合は、販売明細行を保存する度に、**確認済出荷日** フィールドと **確認済入荷日** フィールドが自動的に設定されます。 後で販売ラインに関連する変更を行った場合 (数量やサイトを変更する場合など)、日付は直ちに再計算されます。

- 販売注文行の確認済出荷日を表示するには、販売注文を開いて、販売行を選択します。 その後、**明細行の詳細** クイックタブの **配送** タブで、**出荷日の確認** 値と **受領日の確認** 値をレビューします。
- 注文全体の確認済出荷日を表示するには、販売注文を開いて、**ヘッダー** ビューを選択します。 その後、**出荷** クイックタブで、**出荷日の確認** 値と **受領日の確認** 値をレビューします。

## <a name="use-ctp-for-planning-optimization"></a>計画最適化のために CTP を使う

### <a name="create-a-new-order-by-using-ctp-for-planning-optimization"></a>計画最適化に CTP を使用した新しい注文を作成する

新しい販売注文または注文書の行を追加する度に、システムは既定の配送日管理方法を割り当てる必要があります。 注文ヘッダーは常にグローバル既定のメソッドで始まります。 上書きが注文品目に割り当てられている場合は、その上書きが新しい注文明細で使用されます。 それ以外の場合は、新しい注文行はグローバル既定の方法も使用します。 従って、最もよく使用する配送日と一致するように、規定メソッドを設定する必要があります。 注文を作成した後は、既定のメソッドを注文ヘッダーレベルまたは注文行レベルで必要に合って上書きできます。 詳細については、[既定の配送日管理方法の設定](#default-methods) および [CTP を使用する既存の販売注文の変更](#change-orders) を参照してください。

### <a name="view-confirmed-delivery-dates-when-using-ctp-for-planning-optimization"></a>計画の最適化のために CTP を使用する場合の確認済出荷日の表示

計画最適化を使用している場合は、**出荷日の管理** フィールドが *計画最適化のための CTP* に設定されている注文明細行または注文明細行に CTP 計算が適用されます。

計画の最適化のための CTP を使用する販売明細行の場合、**確認済出荷日** フィールドと **確認済入荷日** フィールドは、(通常は定期処理バッチ ジョブを使用して) 適切な動的計画を実行するまで空白になります。 これらは自動的に設定されます。 詳細については、[計画最適化のための CTP 算定をスケジュールする](#batch-job) を参照してください。

**計画最適化の CTP ステータス** フィールドは、計画の最適化のために CTP を使用する各行について、確認済の日付がまだ計算されているかどうかを示します。 このフィールドの値は、確認された出荷日がまだ計算されていないか、他の変更によって無効になる明細行および注文の *準備が整っていない* 明細行および注文の値を示します。 これは、計算された明細行および 注文に対する *準備が完了* した値を示します。 各行および注文全体のステータスを表示できます。

- 販売注文行のステータスを表示するには、販売注文を開いて、販売行を選択します。 その後、**明細行の詳細** クイック タブの **配送** タブで、**計画の最適化** ステータス値の CTP を確認します。 計算後に、その明細行の **確認済出荷日** フィールドおよび **確認済入荷日** フィールドもこのタブに表示されます。
- 注文全体のステータスを表示するには、販売注文を開いて、**ヘッダー** ビューを選択します。 その後、明細行の詳細 クイック タブの **配送** クイックタブで、**計画の最適化 CTP のステータス** を確認します。 計算後に、その注文の **確認済出荷日** フィールドおよび **確認済入荷日** フィールドもこのタブに表示されます。

<!-- KFM: The following text may be untrue and needs to be reviewed with the PM for next revision:

The sales orders that are *Ready* or *Not ready* are shown in the **All sales orders** list page. You can check the sales order that are *Ready* or *Not ready* from the sales order list page by filtering on this new status field.

-->

> [!NOTE]
> - 計画最適化のための CTP の確認日が計算された後に販売注文行を更新すると、次に適切な動的計画が実行されるまで、これらの日付はシステムによってクリアされます。
> - 既存の確認済日付に影響する可能性がある関連設定を編集する場合 (リード タイム、引当、マーキングの変更など)、関連する既存の注文の確認済日付はクリアする必要があります。 このアクションによって、各関連する明細行のステータスが *準備完了* に 変更されます。 次にこの変更を行った場合、システムは次回動的計画を実行する時点で確認済日付を再計算します。

## <a name="change-existing-sales-orders-so-that-they-use-ctp"></a><a name="change-orders"></a>既存の販売注文を CTP を使用するために変更する

どのオープンな注文でも、**配送日の管理** 値をいつでも変更できます。 ヘッダー レベルや各行の値は必要に応じ変更できます。

### <a name="change-to-ctp-at-the-order-header-level"></a>注文ヘッダー レベルで CTP に変更する

<!-- KFM: Would be nice to mention how changing this setting on the header affects the individual lines. -->

注文ヘッダー レベルで CTP を使用する注文を変更するには、次の手順に従います。

1. **売掛金勘定 \> 注文 \> すべての販売注文** に移動します。
1. 設定する販売注文を開するか、新しい販売注文を作成します。
1. **ヘッダー** を選択して、**販売注文の詳細** ページでヘッダー情報を開きます。
1. **出荷** クイック タブで、使用している計画エンジンに応じて、**出荷日の管理** フィールドを次のいずれかの値に設定します。

    - *CTP* - 組み込みのマスタ プラン エンジンによって提供される CTP 計算を使用します。 計画の最適化を使用している場合、*CTP* 配送日管理方法は変更が許可されません。 したがって、この値を選択した場合は、計算の実行時にエラーが発生します。
    - *計画最適化のための CTP* – 計画の最適化によって提供される CTP 計算を使用します。 組み込みのマスター プラン エンジンを使用している場合は、この設定は効果がありません。

<!-- KFM: Additional dialogs are shown here. Review these with the PM and expand this procedure at next revision. -->
1. **OK** を選択して変更を適用します。

### <a name="change-to-ctp-at-the-order-line-level"></a>注文明細行レベルで CTP に変更する

別の配送日の管理方法を使用して注文明細行を作成した場合は、いつでも CTP に変更できます。 明細行レベルで行った変更は、他の行には影響を与えます。 ただし、更新された各行の計算の変更に応じて、注文の出荷日全体が前後に移動する場合があります。 <!-- KFM: Confirm this intro at next revision -->

明細行レベル組み込みマスター計画のための CTP を使用できるように注文を変更するには、次の手順に従います。

1. **売掛金勘定 \> 注文 \> すべての販売注文** に移動します。
1. 設定する販売注文を開するか、新しい販売注文を作成します。
1. **販売注文の詳細** ページの **販売注文行** クイック タブで、設定する販売注文の行を選択します。
1. **明細行の詳細** クイック タブの、**出荷** タブで、使用している計画エンジンに応じて、**出荷日の管理** フィールドを次のいずれかの値に設定します。

    - *CTP* - 組み込みのマスタ プラン エンジンによって提供される CTP 計算を使用します。 計画の最適化を使用している場合、*CTP* 配送日管理方法は変更が許可されません。 したがって、この値を選択した場合は、計算の実行時にエラーが発生します。
    - *計画最適化のための CTP* – 計画の最適化によって提供される CTP 計算を使用します。 組み込みのマスター プラン エンジンを使用している場合は、この設定は効果がありません。

    **出荷可能日および入荷可能日付** ダイアログ ボックスが表示され、出荷可能日および入荷可能日付が表示されます。 このダイアログ ボックスは、前のセクションで説明した注文ヘッダーと同様の方法で注文明細行に対して使用します。

1. アクション ウィンドウで、**保存** を選択します。
