---
title: 在庫の視覚化アプリ
description: このトピックでは、在庫の視覚化アプリの使用方法について説明します。
author: yufeihuang
ms.date: 08/02/2021
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-08-02
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: cc09dd82547ec42041889e9a96662cd17549a3ea
ms.sourcegitcommit: b9c2798aa994e1526d1c50726f807e6335885e1a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/13/2021
ms.locfileid: "7345005"
---
# <a name="inventory-visibility-app"></a>在庫の視覚化アプリ

[!include [banner](../includes/banner.md)]
[!INCLUDE [cc-data-platform-banner](../../includes/cc-data-platform-banner.md)]

このトピックでは、在庫の視覚化アプリの使用方法について説明します。

在庫の視覚化は、視覚化のためのモデル駆動型アプリを提供します。 アプリには、**コンフィギュレーション**、**運用の可視性**、および **在庫集計** の 3 つのページが含まれます。 次の機能があります:

- 手持構成と仮引当構成を行うユーザー インターフェイス (UI) を提供します。
- さまざまな分析コードの組み合わせによるリアルタイムの手持在庫のクエリがサポートされます。
- 引当要求を転記するための UI を提供します。
- すべての分析コードを使用して製品の手持在庫のカスタマイズ ビューを提供します

## <a name="prerequisites"></a>必要条件

開始する前に、[在庫視覚化の設定](inventory-visibility-setup.md)で示されているように、在庫視覚化アドインのインストールと設定を行います。

## <a name="configuration"></a><a name="configuration"></a>構成

**構成** ページにより、手持構成と仮引当構成を設定することができます。 アドインをインストールすると、既定の構成に Microsoft Dynamics 365 Supply Chain Management (`fno` データ ソース) からの値が含まれます。 既定の設定を確認できます。 また、業務要件や外部システムの在庫転記要件に基づき、[Dataverse](/powerapps/maker/common-data-service/data-platform-intro) で構成を変更して、複数のシステム間で在庫変更を転記、整理、および照会する方法を標準化することができます。

### <a name="define-data-sources"></a>データ ソースの定義

在庫視覚化と統合する各 *データ ソース* を定義します。 在庫視覚化は、販売時点管理 (POS) システム、Supply Chain Management、および他の外部システムなど、さまざまなデータ ソースとの統合をサポートします。 既定では、Supply Chain Management が在庫視覚化の既定のデータ ソース (`fno`) として設定されます。

データ ソースを追加するには、次の手順に従います。

1. Power Apps 環境にサインインし、**在庫視覚化** を開きます。
1. **構成** ページを開きます。
1. **データ ソース** タブで **新しいデータ ソース** を選択してデータ ソースを追加します。

> [!NOTE]
> データ ソースを追加する場合、在庫視覚化サービスの構成を更新する前に、データ ソースの名前、物理的測定、および分析コードのマッピングを検証してください。 **構成の更新** を選択した後は、これらの設定を変更することはできません。

### <a name="set-up-dimension-mappings"></a>分析コード マッピングの設定

在庫視覚化は、データ ソースの分析コードからマッピングできるベース分析コードの一覧を提供します。 33 個の分析コードをマッピングに使用することができます。

- 既定では、データ ソースの 1 つとして Supply Chain Management を使用している場合、Supply Chain Management の標準分析コードに 13 の分析コードがマップされます。 他の 12 の分析コード (`inventDimension1` から `inventDimension12`) が Supply Chain Management のカスタム分析コードにマッピングされます。 残りの 8 つの分析コードは、外部データ ソースにマップできる拡張分析コードです。
- データ ソースの 1 つとして Supply Chain Management を使用しない場合、分析コードを自由にマップすることができます。 使用可能な分析コードの完全な一覧を次の表に示します。

> [!NOTE]
> 分析コードが既定の分析コードの一覧に含まれておらず、外部データ ソースを使用している場合は、`ExtendedDimension1` から `ExtendedDimension8` を使用してマッピングを行うことをお勧めします。

| 分析コード タイプ | 分析コード名 |
|---|---|
| 品目 | `ColorId` |
| 品目 | `SizeId` |
| 品目 | `StyleId` |
| 品目 | `ConfigId` |
| 追跡 | `BatchId` |
| 追跡 | `SerialId` |
| 保管場所 | `LocationId` |
| 保管場所 | `SiteId` |
| 在庫状態 | `StatusId` |
| 倉庫固有 | `WMSLocationId` |
| 倉庫固有 | `WMSPalletId` |
| 倉庫固有 | `LicensePlateId` |
| 外 | `VersionId` |
| 在庫 (カスタム) | `InventDimension1` から `InventDimension12` |
| 外 | `ExtendedDimension1` から `ExtendedDimension8` |

分析コード マッピングを追加するには、次の手順に従います。

1. Power Apps 環境にサインインし、**在庫視覚化** を開きます。
1. **構成** ページを開きます。
1. **データ ソース** タブの **分析コード マッピング** セクションで **追加** を選択して、分析コード マッピングを追加します。
1. **分析コード名** フィールドで、ソース分析コードを指定します。
1. **終了分析コード** フィールドで、マップする在庫視覚化の分析コードを選択します。
1. **保存** を選択します。

![分析コード マッピングの追加](media/inventory-visibility-dimension-mapping.png "分析コード マッピングの追加")

たとえば、データ ソースに製品のカラー分析コードが含まれる場合、`exterchannel` データ ソースで `ProductColor` カスタム分析コードを追加して、`ColorId` ベース分析コードにマップすることができます。 `ColorId` ベース分析コードにマップされます。

## <a name="create-a-physical-measure"></a>物理的測定の作成

データ ソースが在庫の変更を在庫視覚化に転記する場合、*物理的測定* を使用してその変更を転記します。 物理的測定は、集計された在庫トランザクションの状態を反映するモディファイアーです。 クエリは、物理的測定に基づくことがあります。

在庫視覚化には、既定の物理的測定の一覧があります。 これら既定の物理的測定は、Supply Chain Management (**在庫管理 \> 照会およびレポート \> 手持在庫リスト**) の **手持在庫リスト** ページにある在庫トランザクションの状態から取得されます。

| モディファイアー | 氏名 |
|---|---|
| `PhysicalInvent` | 現物在庫 |
| `ReservPhysical` | 引当済現物数 |
| `AvailPhysical` | 引当可能現物数 |
| `ReservOrdered` | 発注引当済 |
| `PostedQty` | 転記された数量 |
| `Deducted` | 払出済 |
| `Picked` | 受取済 |
| `Received` | 受領済み |
| `Registered` | 登録済 |
| `Arrived` | 着荷済 |
| `Ordered` | 発行済 |
| `OnOrder` | 受注中 |
| `QuotationReceipt` | 見積受入 |
| `QuotationIssue` | 見積書発行 |

データ ソースが Supply Chain Management である場合、既定の物理的測定を再作成する必要はありません。 ただし、外部データ ソースの場合は、次の手順に従って新しい物理的測定を作成することができます。

1. Power Apps 環境にサインインし、**在庫視覚化** を開きます。
1. **構成** ページを開きます。
1. **データ ソース** タブの **物理的測定** セクションで **追加** を選択し、ソース測定の名前を指定して、変更を保存します。

## <a name="define-the-product-hierarchy-index"></a>製品階層インデックスの定義

集計された分析コード グループを設定することにより、在庫視覚化を使用して、手持在庫の状態を照会することができます。 在庫視覚化において、各分析コード グループは *インデックス* と呼ばれます。 各インデックスはセット番号に対応しています。 在庫視覚化で照会を行う方法に基づいて、インデックスの設定に使用する分析コードを決定することができます。

製品階層インデックスを設定するには、以下の手順に従ってください。

1. Power Apps 環境にサインインし、**在庫視覚化** を開きます。
1. **構成** ページを開きます。
1. **製品階層インデックス** タブの **分析コード マッピング** セクションで **追加** を選択して、分析コード マッピングを追加します。
1. 既定では、インデックスの一覧が用意されています。 既存のインデックスを変更するには、関連するインデックスのセクションで **編集** または **追加** を選択します。 新しいインデックス セットを作成するには、**新しいインデックス セット** を選択します。 すべてのインデックス セットの各行の **分析コード** フィールドで、ベース分析コードの一覧から選択します。 次のフィールドの値は自動的に生成されます。

    - **セット番号** – 同じグループ (インデックス) に属する分析コードはグループ化され、同じセット番号が割り当てされます。
    - **階層** – 階層は、分析コード グループ (インデックス) でクエリ可能できるようサポートされる分析コードの組み合わせを定義するために使用されます。 たとえば、*スタイル*、*色*、および *サイズ* の階層の順序が設定されている分析コード グループを設定する場合、システムは 3 つのクエリ グループの結果をサポートします。 1 つ目のグループはスタイルのみです。 2 つ目のグループはスタイルおよび色の組み合わせです。 3 つ目のグループはスタイル、色、およびサイズの組み合わせです。 その他の組み合わせはサポートされていません。

詳細については、[製品インデックス階層の構成](inventory-visibility-configuration.md#index-configuration)を参照してください。

### <a name="example"></a>例

このセクションでは、階層の仕組みを示す例を提供します。 次の表に、このサンプルで使用可能な在庫の一覧を示します。

| 項目 | スタイル | 色 | サイズ | 件数 |
|---|---|---|---|---|
| I0001 | ワイド | 黒 | 小 | 1 |
| I0001 | ワイド | 黒 | 大 | 2 |
| I0001 | ワイド | 赤 | 小 | 3 |
| I0001 | 通常 | 黒 | 小 | 4 |
| I0001 | 通常 | 黒 | 大 | 5 |
| I0001 | 通常 | 赤 | 小 | 6 |
| I0001 | 通常 | 赤 | 大 | 7 |

インデックス階層の設定方法を次の表に示します。

| キー | 設定番号 | 階層 |
|---|---|---|
| `StyleId` | 1 | 1 |
| `ColorId` | 1 | 2 |
| `SizeId` | 1 | 3 |

以上に述べた設定に基づき、在庫視覚化クエリの分析コードの組み合わせは *スタイル*、*色*、および *サイズ* になります。 階層の設定により、次の方法で外部システムが手持在庫の照会を行うことができるようになります。

- `()` – すべてグループ化されます。 出力は次のようになります。

    - I0001, 28

- `(StyleId)` – スタイルでグループ化。 出力は次のようになります。

    - I0001、ワイド、6
    - I0001、通常、22

- `(StyleId, ColorId)` – スタイルおよび色の組み合わせ別にグループ化されます。 出力は次のようになります。

    - I0001、ワイド、黒、3
    - I0001、ワイド、赤、3
    - I0001、通常、黒、9
    - I0001、通常、赤、13

- `(StyleId, ColorId, SizeId)` – 色およびサイズの組み合わせ別にグループ化されます。 出力は次のようになります。

    - I0001、ワイド、黒、S,1
    - I0001, 全体, 黒, 大, 2
    - I0001、ワイド、赤、S、3
    - I0001、通常、黒、S、4
    - I0001、通常、黒、L、5
    - I0001、通常、赤、S、6
    - I0001、通常、赤、L、7

## <a name="set-up-a-custom-calculated-measure"></a>カスタム計算測定の設定

在庫視覚化を使用して、在庫の物理的測定と *カスタム計算測定* の両方を照会できます。

構成により、合計集計された出来高数量を取得するために加算または減算する一連のモディファイアーを定義できます。

1. Power Apps 環境にサインインし、**在庫視覚化** を開きます。
1. **構成** ページを開きます。
1. **計算測定** タブで **新しい計測** を選択し、計算された測定を追加します。 その後、次の表の説明に従ってフィールドを設定します。

    | フィールド | 先頭値 |
    |---|---|
    | 新しい計算測定の名前 | 計算測定の名前を入力します。 |
    | データ ソース | 照会しているシステムはデータ ソースです。 |
    | モディファイアーのデータ ソース | モディファイアーのデータ ソースを入力します。 |
    | モディファイアー | モディファイアーの名前を入力します。 |
    | モディファイアー タイプ | モディファイアー タイプ (*加算* または *減算*) を選択します。 |

次の表は、`MyCustomAvailableforReservation` の計算されたカスタム測定値の例を示しています。 この例の詳細については、[データ ソースの構成](inventory-visibility-configuration.md#data-source-configuration)を参照してください。

| 計算メジャーのデータ ソース | 計算メジャー | モディファイアーのデータ ソース | モディファイアー | モディファイアー タイプ |
|---|---|---|---|---|
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `availphysical` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `orderedintotal` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `orderedreserved` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `mypos` | `Inbound` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `mypos` | `Outbound` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `exterchannel` | `received` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `exterchannel` | `issued` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `Exteexterchannelrchannel` | `reserved` | `Subtraction` |

### <a name="set-up-a-soft-reservation-mapping"></a><a name="setup-reservation-mapping"></a>仮引当マッピングの設定

[!INCLUDE [preview-banner-section](../../includes/preview-banner-section.md)]

**仮引当マッピング** タブを編集する前に、**機能管理** タブの *OnHandReservation* 機能を有効にする必要があります。

物理的測定から計算メジャーへのマッピングを設定することにより、在庫視覚化サービスを有効にし、物理的測定に基づいて、引当可能在庫数を自動的に検証することができます。

このマッピングを設定する前に、(このトピックで前述されているように) Power Apps の **構成** ページの **データ ソース** タブと **計算メジャー** タブで、物理的測定、計算メジャー、およびそれらのデータ ソースを定義する必要があります。

仮引当マッピングを定義するには、次の手順に従います。

1. 仮引当測定として機能する物理的測定を定義します (`softreservordered` など)。
1. **構成** ページの **計算メジャー** タブで、物理的計測にマップする AFR 計算式を含む、*引当に使用可能な* (AFR) 計算メジャーを定義します。 たとえば、`availforreserv` (引当に使用可能) を設定し、以前に定義された `softreservordered` 物理的測定にマップすることができます。 このようにして、引当に使用可能になる `softreservordered` 在庫状態の数量を検索できます。 次の表は、AFR 計算式を示しています。

    | モディファイアー | データ ソース | 措置 |
    |---|---|---|
    | `Addition` | `fno` | `availphysical` |
    | `Addition` | `pos` | `inbound` |
    | `Subtraction` | `pos` | `outbound` |
    | `Subtraction` | `iv` | `softreservordered` |

1. **構成** ページを開きます。
1. **仮引当マッピング** タブで、物理的測定から計算メジャーへのマッピングを設定します。 前の例の場合、次の設定を使用して、以前に定義された `softreservordered` 物理測定に `availforreserv` をマップすることができます。

    | 物理的測定データ ソース | 物理的測定 | 引当データ ソースで使用可能 | 引当計算メジャーで使用可能 |
    |---|---|---|---|
    | `iv` | `softreservordered` | `iv` | `availforreserv` |

### <a name="set-up-a-soft-reservation-hierarchy"></a><a name="setup-reservation-hierarchy"></a>仮引当階層の設定

[!INCLUDE [preview-banner-section](../../includes/preview-banner-section.md)]

**仮引当階層** タブを編集する前に、**機能管理** タブの *OnHandReservation* 機能を有効にする必要があります。

引当階層は、引当の際に指定する必要がある分析コードの順序を表します。 これは、手持在庫クエリに対して製品インデックス階層が機能するのと同じように機能します。

引当階層は、手持のインデックス階層とは異なる場合があります。 この独立性により、ユーザーが分析コードを詳細に分割して、より正確な引当の要件を指定できるカテゴリ管理を実装できます。

#### <a name="example"></a>例

次の予約階層がシステムで設定されています。

| 分析コード | 階層 |
|---|---|
| `ColorId` | 1 |
| `SizeId ` | 2 |
| `StyleId` | 3 |

この引当階層が指定されると、次の分析コードの順序で引当を実行できます。

- `()` – 分析コードは指定されていません。
- `(ColorId)`
- `(ColorId, SizeId)`
- `(ColorId, SizeId, StyleId)`

分析コードの順序は、引当階層順序、分析コードごとの分析コードに厳密に従う必要があります。 たとえば、この順序は引当階層で定義されていないので、この例では `(ColorId, StyleId)` がある引当は許可されません。

### <a name="control-feature-management"></a><a name="feature-switch"></a>機能管理の制御

在庫視覚化アドインにより、*OnHandReservation* および *OnHandMostSpecificBackgroundService* のような機能が提供されます。 既定では、これらの機能は無効になっています。 それらを使用するには、Power Apps で **構成** ページを開き、**機能管理** タブで有効にします。

### <a name="complete-and-update-the-configuration"></a>構成の完了と更新

構成が完了した後、すべての変更を在庫視覚化にコミットする必要があります。 変更をコミットするには、Power Apps の **構成** ページの右上隅にある **構成の更新** を選択します。

**構成の更新** を初めて選択するとき、システムは資格情報を要求します。

- **クライアント ID** – 在庫視覚化のために作成した Azure アプリケーション ID。
- **テナント ID** – Azure テナント ID。
- **クライアント シークレット** – 在庫視覚化のために作成した Azure アプリケーション シークレット。

サインインした後、在庫視覚化サービスで構成が更新されます。

> [!NOTE]
> 在庫視覚化サービスの構成を更新する前に、データ ソースの名前、物理的測定、および分析コードのマッピングを検証してください。 **構成の更新** を選択した後は、これらの設定を変更することはできません。

### <a name="find-the-service-endpoint"></a><a name="get-service-endpoint"></a>サービス エンドポイントを検索する

在庫視覚化サービスの正しいエンドポイントが分からない場合、Power Apps の **構成** ページを開き、右上隅の **サービス エンドポイントの表示** を選択します。 ページに正しいサービス エンドポイントが表示されます。

## <a name="operational-visibility"></a>運用可視化

**運用可視化** ページは、さまざまな分析コードの組み合わせに基づいた、リアルタイムの手持在庫クエリの結果を提供します。 *OnHandReservation* 機能が有効になっている場合、**運用可視化** ページから引当要求を転記することもできます。

### <a name="on-hand-query"></a>手持在庫クエリ

**手持在庫クエリ** タブに、リアルタイムの手持在庫クエリの結果が表示されます。

**手持在庫クエリ** タブを選択すると、システムは資格情報を要求し、在庫視覚化サービスを照会するために必要なベアラー トークンを取得することができます。 **BearerToken** フィールドにベアラー トークンを貼り付け、ダイアログ ボックスを閉じることができます。 その後、手持在庫クエリ要求を転記することができます。

ベアラー トークンが有効でないか、または期限切れの場合、新しいトークンを **BearerToken** フィールドに貼り付ける必要があります。 正しい **クライアント ID**、**テナント ID**、**クライアント シークレット** の値を入力し、**更新** を選択します。 システムは自動的に有効な新しいベアラー トークンを取得します。

手持在庫クエリを転記するには、要求の本文にクエリを入力します。 [転記メソッドを使用したクエリ](inventory-visibility-api.md#query-with-post-method)で説明されているパターンを使用します。

![手持在庫クエリの設定](media/inventory-visibility-query-settings.png "手持在庫クエリの設定")

### <a name="reservation-posting"></a>引当の転記

[!INCLUDE [preview-banner-section](../../includes/preview-banner-section.md)]

**引当の転記** タブを使用して、引当要求を転記します。 引当要求を転記する前に、*OnHandReservation* 機能を有効にする必要があります。 この機能の詳細については、[在庫可視性の確保](inventory-visibility-reservations.md)を参照してください。

引当要求を転記するには、要求の本文に値を入力する必要があります。 [1 つの予約イベントの作成](inventory-visibility-api.md#create-one-reservation-event)で説明されているパターンを使用します。 その後、**転記** を選択します。 要求応答の詳細を表示するには、**詳細の表示** を選択します。 応答の詳細から **reservationId** の値も取得できます。

## <a name="inventory-summary"></a>在庫集計

**在庫集計** は、*在庫手持合計エンティティ* 用にカスタマイズされたビューです。 すべての分析コードと共に、製品の在庫集計を提供します。 Dataverse が提供する **高度なフィルター** を使用することにより、自分にとって重要な行を示す個人用ビューを作成できます。 高度なフィルター オプションを使用すると、単純なものから複雑なものまで、さまざまなビューを作成できます。 グループ化され、入れ子になった条件をフィルターに追加することもできます。

**高度なフィルター** の使用方法の詳細については、[高度なグリッド フィルターを使用した個人用ビューの編集または作成](/powerapps/user/grid-filters-advanced)を参照してください

カスタマイズ ビューの上部には、**既定の分析コード**、**カスタム分析コード**、および **測定** の 3 つのフィールドが表示されます。 これらのフィールドを使用して、表示する列を制御できます。

現在の結果をフィルター処理または並べ替えるための列のヘッダーを選択できます。

カスタマイズ ビューの下部に、「50 レコード (29 件選択済み)」または「50 レコード」などの情報が表示されます。 この情報は、**高度なフィルター** の結果から現在読み込まれているレコードを参照しています。 「29 件選択済み」というテキストは、列ヘッダー フィルターを使用して読み込まれたレコードに対して選択されたレコード数を表します。

ビューの下部にある **さらに読み込む** ボタンにより、Dataverse からさらに多くのレコードを読み込むことができます。 読み込まれるレコードの既定の数は 50 です。 **さらに読み込む** を選択するとき、次に使用可能な 1,000 レコードがビューに読み込まれます。 **さらに読み込む** ボタン上の数は、現在読み込まれているレコードと、**高度なフィルター** の結果のレコード総数を示しています。

![在庫集計](media/inventory-visibility-onhand-list.png "在庫集計")
