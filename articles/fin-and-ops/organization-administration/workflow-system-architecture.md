---
title: ワークフロー システムのアーキテクチャ
description: この記事では、Microsoft Dynamics 365 for Finance and Operations のワークフロー システムのアーキテクチャについて説明します。
author: sericks007
manager: AnnBe
ms.date: 08/18/2017
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.scope: Core, Operations
ms.custom: 56351
ms.assetid: 107a3f9f-aa1d-4087-9b35-196d8b82b0fb
ms.search.region: Global
ms.author: tjvass
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: f8c1bb3937620ce9e71f9555067c12183b7606c4
ms.sourcegitcommit: 9d4c7edd0ae2053c37c7d81cdd180b16bf3a9d3b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/15/2019
ms.locfileid: "1561629"
---
# <a name="workflow-system-architecture"></a>ワークフロー システムのアーキテクチャ

[!include [banner](../includes/banner.md)]

この記事では、Microsoft Dynamics 365 for Finance and Operations のワークフロー システムのアーキテクチャについて説明します。

ワークフロー インフラストラクチャは、Application Object Server (AOS) でホストされる 2 つのコンポーネント (X++ ワークフロー ランタイムおよび管理ワークフロー ランタイム) から構成されます。

X++ ワークフロー ランタイムは、次のコンポーネントで構成されます。

- ワークフロー ランタイム アプリケーション プログラミング インターフェイス (API)
- メッセージング バッチ ジョブ
- メッセージ キュー

必要に応じて、メッセージング バッチ ジョブまたはワークフロー ランタイム API のいずれかがアプリケーション コードを呼び出すことができます。 X++ ワークフロー ランタイムは、Microsoft .NET フレームワークの CIL (共通中間言語) にコンパイルされます。

管理ワークフロー ランタイムは、Windows Workflow Foundation および Finance and Operations の拡張機能で構成されます。

論理的には、ワークフロー インフラストラクチャは Finance and Operations の拡張で、ユーザーにとって透過的です。 物理的には、X++ ワークフローおよび管理ワークフローのランタイムは両方とも AOS でホストされます。 ワークフロー インフラストラクチャは AOS と .NET Interop でバッチ処理を使用して、その 2 つのサブシステムを統合し、片方のサブシステムからもう一方のサブシステムにメッセージを渡します。 バッチ プロセッサで実行される X++ コードは、.NET CIL にコンパイルされます。 バッチ処理は、.NET 共通言語ランタイム (CLR) で実行されます。

次の図に、ワークフロー インフラストラクチャの高レベル アーキテクチャの概要を示します。

[![ワークフロー\_architecturediagram2016](./media/workflow_architecturediagram2016.png)](./media/workflow_architecturediagram2016.png)

ユーザーは、 Finance and Operations で、ワークフローのページとコントロールを使用して、業務プロセスに参加できます。

開発者は、Finance and Operations に追加済のオブジェクトのワークフローを作成できます。 次の表は、ユーザーが経費精算書を承認のためにワークフロー システムに提出したときに発生するワークフロー ステップを示します。

| ステップ | ランタイム                  | 活動 |
|------|--------------------------|----------|
| 1    | X++ ワークフロー ランタイム     | ユーザーは、ワークフローのいずれかの制御で **送信** をクリックして、経費精算書を送信します。 このアクションにより、X++ コードはワークフロー ランタイム API を呼び出し、ワークフロー インスタンスが有効になります。 ワークフロー ランタイム API は、メッセージをメッセージ キューに書き込みます。 メッセージング バッチ ジョブは、メッセージを読み取り、ワークフローのアクティブ化要求を管理ワークフロー ランタイムに送信します。<blockquote>[!NOTE] メッセージング バッチ ジョブは 1 分間隔でメッセージ キューを処理します。</blockquote> |
| 2    | 管理されるワークフロー ランタイム | X++ からの .NET Interop は、メッセージを受け取り、新しいワークフロー インスタンスを Windows Workflow Foundation 経由で開始します。 このワークフロー インスタンスは、X++ への.NET Interop CIL 経由でX++ ワークフロー ランタイム API のコールバックを実行し、ワークフローが起動されたことを示すメッセージを書き込みます。<p>メッセージが転記された後、管理されたワークフロー ランタイムはアイドル状態のワークフロー インスタンスを Finance and Operations データベースに保存します。 その後、ランタイムはメモリからワークフロー インスタンスを削除します。 管理ワークフロー ランタイムが、このワークフロー インスタンスに対する別のメッセージを X++ ワークフロー ランタイムから受け取ると、ワークフロー インスタンスはメモリーに復元され、再開されます。</p><p>各ワークフロー インスタンスは固有です。 2 人のユーザーが承認のために経費精算書を提出すると、2 つのワークフロー インスタンスが開始されます。</p> |
| 3    | X++ ワークフロー ランタイム     | メッセージング バッチ ジョブが、**ワークフローで開始された**メッセージをメッセージ キューから読み取り、**ワークフローで開始された**イベントを処理するアプリケーション イベント ハンドラーを開始します。 次に、バッチ ジョブは、イベントが処理されたことを示す確認メッセージを書き込みます。 |
| 4    | 両方                     | この同じメッセージング パターンが、ワークフロー インスタンスのライフサイクル全体で必要に応じて繰り返されます。 |

このワークフロー アーキテクチャは、信頼できる堅牢なメッセージ システムを提供し、また、ワークフローの状態とアプリケーションの状態を常に同期させるために役立ちます。 ハードウェアやソフトウェアに予期しない障害が発生すると、ワークフロー インスタンスの状態は最後に保存された既知の点まで戻され、メッセージはキュー内に保持されます。 したがって、アーキテクチャから見ると、復旧モデルは、問題の解決とワークフローの再開です。
