---
title: エンティティ格納を Data Lake として使用可能にする
description: このトピックでは、エンティティ格納を Microsoft Azure Data Lake として使用可能にする方法について説明します。
author: MilindaV2
manager: AnnBe
ms.date: 12/27/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: kfend
ms.search.scope: Operations
ms.custom: 96283
ms.assetid: ''
ms.search.region: Global
ms.author: milindav
ms.search.validFrom: 2018-12-03
ms.dyn365.ops.version: Platform Update 23
ms.openlocfilehash: 6d11da34810bf76f6b194f87a729a255357ff29c
ms.sourcegitcommit: 2b890cd7a801055ab0ca24398efc8e4e777d4d8c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "1506022"
---
# <a name="make-entity-store-available-as-a-data-lake"></a>エンティティ格納を Data Lake として使用可能にする

[!include [banner](../includes/banner.md)]

[!include [banner](../includes/private-preview-banner.md)]

> [!IMPORTANT]
> このシナリオへのアクセスは、フライティングを通じて利用できます。 シナリオは、複数のプラットフォームの更新プログラムを通じてリリースされます。
>
> - **自動化されたエンティティ格納の更新:** プラットフォーム更新 23 で利用可
> - **Microsoft Azure Data Lake (フル プッシュ) のエンティティ格納データ:** プラットフォーム更新 23 (制限付き) で利用可
> - **PowerBI.com にあるエンティティ格納スキーマの DataFlows :** 将来のプラットフォーム更新で使用可能
> - **Azure Data Lake (トリクル フィード) のエンティティ格納データ:** 将来のプラットフォーム更新で利用可
> - **PowerBI.comを 使用して分析ワークスペースを拡張:** 将来のプラットフォーム更新で使用可能

## <a name="automated-entity-store-refresh"></a>自動化エンティティ格納更新
Date Lake 統合を有効にする前に、自動のエンティティ店舗更新を有効にする必要があります。 
1. **システム管理** \> **セットアップ** \> **エンティティ格納** に移動します。

    **エンティティ店舗** ページで、メッセージに、**自動エンティティ格納更新** オプションに切り替えることができることが示されます。 このオプションは、システムによって管理されます。 管理者は、エンティティ格納更新をスケジュール設定または監視する必要はありません。

2. **今すぐ切り替える** を選択します。

    > [!IMPORTANT]
    > このアクションは、元に戻すことはできません。 **自動エンティティ格納更新** オプションに切り替えた後、古いユーザー インターフェイス (UI) エクスペリエンスに戻すことはできません。

3. **はい** を選択して続行します。

新しいエクスペリエンスが表示されます。

![新しい UI エクスペリエンス](./media/entity-store-data-lake-03.png)

新しいエクスペリエンスをオンにすると、それぞれの集計の測定で更新を定義できます。 次の更新オプションを選択できます。

- 1 時間ごと
- 1 日に 2 回
- 1 日に 1 回
- 1 週間に 1 回

加えて、**更新** ボタンを選択することにより、管理者が必要に応じて集計の測定を更新できます。 追加のオプションは、将来のプラットフォーム更新プログラムで追加されます。 これらのオプションには、リアルタイム更新のオプションが含められます。

> [!IMPORTANT]
> 自動化更新を有効にすると、システムは集計測定の更新を無効にすることがあります。 集計測定に戻って、適切な更新間隔がシステムに適用されていることを検証する必要があります。
>

## <a name="entity-store-data-in-azure-data-lake-full-push"></a>Azure Data Lake 内のエンティティ格納データ (フル プッシュ)

> [!IMPORTANT]
> この制限機能は、フライティング経由でオンにします。 この機能は、環境がフライトに含まれている場合にのみ使用できます。

この機能が有効になると、エンティティ格納データは、Microsoft サブスクリプションでリレーショナル エンティティ格納データベースに入力されません。 代わりに、独自のサブスクリプションの Azure Data Lake ストレージ Gen2 アカウントに入力されます。 PowerBI.com およびその他の Azure ツールのすべての機能をエンティティ格納で使用できます。

開始する前に、Azure ポータルでこれらのタスクを実行する必要があります。

1. **ストレージ アカウントを作成する。** Microsoft Dynamics 365 for Finance and Operations 環境が準備されているのと同じデータ センター内のストレージ アカウントの準備。 その後で指定する必要があるため、ストレージ アカウントの接続文字列をメモします。
2. **Key Vault およびシークレットを作成する。** 独自のサブスクリプションで Azure Key Vault をプロビジョニングします。 作成した Key Vault エントリのドメイン ネーム システム (DNS) 名が必要になります。 さらに、Key Vault にシークレットを追加します。 値として、前のタスクで書き留めた接続文字列を指定します。 その後で指定する必要があるため、シークレットの名前をメモします。
3. **アプリを登録する。** Azure Active Directory (Azure AD) アプリケーションを作成し、Key Vault にアプリケーション プログラミング インターフェイス (API) アクセスを付与します。 後でを入力する必要があるため、アプリケーション IDとそのアプリケーション キー (シークレット) をメモします。
4. **サービス プリンシパルを Key Vault に追加する。** Key Vault で、**アクセス ポリシー** オプションを使用して、Azure AD アプリケーションに**取得**および**リスト**アクセス許可を付与します。 この方法で、アプリケーションは、Key Vault 内のシークレットにアクセスできます。

次のセクションでは、それぞれのタスクについて詳細に説明します。

### <a name="create-storage-accounts"></a>ストレージ アカウントを作成する

1. Azure ポータルで、新しいストレージ アカウントを作成します。
2. **ストレージ アカウントを作成** ダイアログ ボックスで、次のパラメーター フィールドの値を指定します。

    - **場所:** Finance and Operations 環境があるデータ センターを選択します。 選択したデータ センターが異なる Azure リージョンにある場合、追加のデータ移動コストが発生します。 Microsoft Power BI やデータ ウェアハウスが別の地域にある場合、地域間でストレージを移動するためにレプリケーションを使用することができます。
    - **パフォーマンス:** **標準**を選択することをお勧めします。
    - **アカウントの種類:** **StorageV2** を選択する必要があります。

3. **詳細オプション** ダイアログ ボックスで、**Data Lake ストレージ Gen2 (プレビュー)** オプションをオフにします。

    > [!NOTE]
    > これは、今後の更新で使用可能になります。 それまでは、Azure Data Lake Storage API を使用してデータを使用することはできません。
    >
    > Data Lake Storage Gen2 のプレビュー プログラムに参加していない場合、**Data Lake ストレージ Gen2 (プレビュー)** オプションが表示されないことがあります。

4. **確認して作成** を選択します。 配置が完了したら、新しいリソースが Azure ポータルに表示されます。
5. リソースを選択し、**設定** \> **アクセス キー** を選択します。
6. その後で指定する必要があるため、接続文字列値を書き留めます。

### <a name="create-a-key-vault-and-a-secret"></a>Key Vault およびシークレットを作成する

1. Azure ポータルで、新しい Key Vault を作成します。
2. **Key Vault の作成** ダイアログ ボックスの **場所** フィールドで、Finance and Operations 環境があるデータ センターを選択します。
3. Key Vault が作成されたら、一覧で選択して **シークレット** を選択します。
4. **生成/インポート** を選択します。
5. **シークレットを作成** ダイアログ ボックスの **アップロード オプション** フィールドで、**手動** を選択します。
6. シークレットの名前を入力します。 その後で指定する必要があるため、名前をメモします。
7. 値フィールドに、前の手順でストレージ アカウントから取得した接続文字列を入力します。
8. **有効** を選択し、**作成**を選択します。 シークレットが作成され、Key Vault に追加されます。

### <a name="register-the-app"></a>アプリを登録する

1. Azure ポータルで、**Azure Active Directory** を選択し、**アプリケーション登録**を選択します。
2. **新しいアプリケーションの登録** を選択し、以下の情報を入力します。

    - **名前:** アプリの名前を入力します。
    - **アプリケーション タイプ:** **Web API** を選択します。
    - **サインオン URL:** Finance and Operations のルート URL をコピーしてここに貼り付けます。

3. アプリケーションが作成されたら選択し、**設定** を選択します。
4. **必要なアクセス許可** オプションを選択します。
5. 表示されたダイアログ ボックスで、**オプションの追加** を選択し、**API の追加** を選択します。
6. API のリストで **Azure Key Vault** を選択します。
7. **委任アクセス許可** チェック ボックスをオンにしてアクセス許可を付与し、**完了** を選択して変更を保存します。
8. 新しいアプリケーションの **アプリケーション** メニューで、**キー** を選択します。
9. **キーの説明** フィールドに、名前を入力します。
10. 期間を選択し、**保存** を選択します。 シークレットが **値** フィールドに生成されます。
11. 1、2 分以内に削除されるので、すぐにシークレットをクリップボードにコピーします。 後でアプリケーションにこのキーを指定する必要があります。

### <a name="add-a-service-principal-to-key-vault"></a>サービス プリンシパルを Key Vault に追加する

1. Azure ポータルで、以前に作成した Key Vault を開きます。
2. **アクセス ポリシー** を選択し、**追加** を選択して新しいアクセス許可ポリシーを作成します。
3. **プリンシパルの選択** フィールドに、以前に登録したアプリケーションの名前を選択します。
4. **キーのアクセス許可** フィールドで、**取得** および **リスト** のアクセス許可を選択します。
5. **シークレットのアクセス許可** フィールドで、**取得** および **リスト** のアクセス許可を選択します。

    ![取得およびリストのアクセス許可](./media/entity-store-data-lake-05.png)

6. **保存** を選択します。

## <a name="work-in-entity-store-in-a-data-lake"></a>Data Lake のエンティティ格納で作業する

1. **システム管理** \> **設定** \> **システム パラメーター** の順に移動します。
2. **データ接続** タブで、このトピックの前の部分でメモした次の情報を入力します。

    - **アプリケーション ID:** 前に登録した Azure AD アプリケーションのアプリケーション ID を入力します。
    - **アプリケーション シークレット:** Azure AD アプリケーションのアプリケーション キー (秘密) を入力します。
    - **DNS 名:** Key Vault の DNS 名を入力します。
    - **シークレット名:** 接続文字列情報と共に Key Vault に追加したシークレットの名前を入力します。

    ![[システム パラメーター] ページの [データ接続] タブ](./media/entity-store-data-lake-04.png)

3. **Azure Key Vault のテスト** および **Azure Storage のテスト** リンクを選択し、指定した構成情報にシステムがアクセスできることを検証します。
4. **データ接続を有効にする** チェック ボックスをオンにします。

エンティティ格納データが、リレーショナル エンティティ格納データベースではなく、指定したストレージ場所に入力されるようになりました。

集計の測定と、エンティティ格納 UI で選択した更新オプションが、Data Lake にコピーされたデータに適用されるようになりました。
