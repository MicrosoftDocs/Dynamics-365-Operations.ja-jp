---
title: 最新バージョンへのセルフサービス アップグレード
description: このトピックでは、Microsoft Dynamics 365 for Finance and Operations の最新の更新バージョンに移行するプロセスについて説明します。
author: laneswenka
manager: AnnBe
ms.date: 08/16/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.scope: Operations
ms.search.region: Global
ms.author: laswenka
ms.search.validFrom: 2019-04-30
ms.dyn365.ops.version: 10.0.1
ms.openlocfilehash: 41bc9ffa9eaeabf77849670da76adabdd307b8fd
ms.sourcegitcommit: 109a6ef2d20758dc4a25c51b11e22dd2214a1cc4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/16/2019
ms.locfileid: "1886687"
---
# <a name="self-service-upgrade-to-the-latest-version"></a>最新バージョンへのセルフサービス アップグレード

[!include [banner](../includes/banner.md)]

> [!IMPORTANT]
> このトピックは、次の開始バージョンに適用されます:
>
> - Microsoft Dynamics 365 for Operations バージョン 1611 (2016 年 11 月) (バージョン 7.1 とも呼ばれます)
> - Microsoft Dynamics 365 for Finance and Operations Enterprise edition (2017 年 7 月) (バージョン 7.2 とも呼ばれます)
> - Microsoft Dynamics 365 for Finance and Operations、Enterprise edition 7.3

このチュートリアルでは、これらのタスクを実行する方法を説明します。

> [!div class="checklist"]
> * 選択するバージョンを把握します。
> * カスタマイズを拡張機能としてリファクターします。
> * 開発環境でのデータ アップグレードを実行します。
> * サンドボックス ユーザー受け入れテスト (UAT) 環境で、セルフサービス アップグレードを実行します。
> * 実稼働環境でセルフサービス アップグレードを実行します。

## <a name="understand-which-version-to-select-for-upgrade"></a>アップグレードするために選択するバージョンを把握します。

継続的な更新をサポートするようにセルフサービス アップグレード プロセスを調整するに、新しいリリースごとに最も古いリリースバージョンが廃止されます。

たとえば、プラットフォーム アップデート (PU) 23 を適用したアプリケーション バージョン 7.3 があります。 現在サポートされているアップグレード バージョンは、PU 23 の 8.1.3、PU 24 の 10.0.0、そして PU 25 の 10.0.1です。 次のリリースである PU 26 の 10.0.2 が一般に利用可能になると、それは使用可能なアップグレード オプションに追加され、PU 23 の 8.1.3 は削除されます。

新しいバージョンを追加して最も古いバージョンを削除するこの継続的なプロセスのため、顧客が利用可能な最新バージョンにアップグレードすることをお勧めします。 このように、サンドボックス環境をアップグレードしてから、後で実稼働環境を同じバージョンにアップグレードできるようになるまで 2 か月あります。

サンドボックス環境を PU 23 の 8.1.3 にアップグレードすることを選択して、その後 Microsoft が PU 26 のバージョン 10.0.2 をリリースし、PU 23 のバージョン 8.1.3 がアップグレード オプションとして削除されると、実稼働環境のアップグレードから **ブロックされます**。 この場合は、サンドボックス環境からやり直し、新しいサポート対象バージョンにアップグレードする必要があります。

### <a name="targeted-release-schedule"></a>対象となるリリース スケジュール

> [!NOTE]
> この表の日付は変更される可能性があります。

| 選択可能なバージョン | 新規顧客向けの最新バージョンの一般提供 (GA) | アップグレードの最新バージョンの GA |
|---|---|---|
| 7.3 の PU 23 – PU 25<br>8.1.3 の PU 23 – 10.0.1 の PU 25 | 2019年4月8日の週 | 2019 年 4 月 29 日の週 |
| 7.3 の PU 24 – PU 26<br>10.0.0 の PU 24 – 10.0.2 の PU 26 | 2019年5月13日の週 | 2019 年 5 月 27 日の週 |
| 7.3 の PU 25 – PU 27<br>10.0.1 の PU 25 – 10.0.3 の PU 27 | 2019年6月10日の週 | 2019 年 6 月 24 日の週 |
| 7.3 の PU 26 – PU 28<br>10.0.2 の PU 26 – 10.0.4 の PU 28 | 2019年7月8日の週 | 2019 年 7 月 29 日の週 |
| 7.3 の PU 27 – PU 29<br>10.0.3 の PU 27 – 10.0.5 の PU 29 | 2019 年 10 月 7 日の週 | 2019 年 10 月 21 日の週 |

## <a name="refactor-your-customizations-as-extensions"></a>カスタマイズを拡張機能としてリファクターします

アップグレードを準備するには、拡張機能としてオーバーレイされたすべてのカスタマイズをリファクターする必要があります。 最新バージョンに新しい開発環境を配置して、バージョン管理に新しいブランチを作成し、[オーバーレイから拡張機能への移行](../extensibility/migrate-overlayer-extension.md) のガイダンスに従うことをお勧めします。

オーバーレイがなくカスタマイズの 100 パーセントで拡張機能をすでに使用している場合は、バージョン管理におけるアップグレード作業のために新しいブランチを作成することをお勧めします。 Microsoft X++ 修正プログラムがインストールされている場合、それらは最新バージョンに適用されないためバージョン管理から削除する必要があります。

## <a name="run-the-data-upgrade-in-a-development-environment"></a>開発環境でのデータ アップグレードを実行します

データ アップグレード プロセスを外部データベースのコピーで実行します。 環境が既に実稼働状態にある場合、ソース データベースは実稼働データベースのコピーです。 それ以外の場合は、古いバージョンを実行している最新のデータベースです。

アップグレード対象のリリースを実行している開発環境でこのプロセスを実行します。 このステップは、開発者によって行われる検証プロセスです。 これにより、手動操作を必要とせずに環境でカスタマイズの特定のセットを使用することで、データのアップグレードを完了できることの確認に役立ちます。

実稼働データベースのコピーを作成するには [標準ユーザー受け入れテスト (UAT) データベースのコピーをエクスポートする](../database/dbmovement-scenario-exportuat.md) の手順に従ってください。

データのアップグレード プロセスを実行するには、[開発環境やデモ環境でデータをアップグレードする](../migration-upgrade/upgrade-data-to-latest-update.md) の手順に従います。

> [!IMPORTANT]
> - 開発環境でのデータのアップグレードは必須ステップです。 これにより、サンドボックス UAT と実稼働環境をアップグレードする際に、後のダウンタイムの延長やアップグレード エラーのリスクを軽減できます。
> - データをアップグレードする前に複数のアプリケーション修正プログラムが必要なことがあります。 既存の開発環境を再配置する前に、これらの修正プログラムが必要かどうかを確認します。 必要な修正プログラムをインストールし Microsoft Azure DevOps にチェックインします。 このステップは、開発環境の古いバージョンでのみで完了できます。 さまざまな状況で必要な修正プログラムの一覧については、[開発環境やデモ環境でデータをアップグレードする](upgrade-data-to-latest-update.md#before-you-begin) を参照してください。
 
## <a name="upgrade-your-tier-2-standard-acceptance-test-sandbox-environment"></a>階層 2 以上のスタンダード承認テスト サンドボックス環境のアップグレード

コード アップグレードを完了し、Microsoft SQL Server でデータを操作しなくても開発環境でエンド ツー エンドのデータ アップグレードを実行することができるようになったら、サンドボックス環境内でプロセスを開始することができます。

### <a name="prerequisite"></a>前提条件

アップグレードを開始する前に、サンドボックス環境に最新の生産データがあることを確認しておくことを強くお勧めします。 データ セットが最新の状態の場合、実稼働環境でアップグレードを確実に行うことができます。 この手順を完了するには、[トレーニング目的での更新](../database/dbmovement-scenario-general-refresh.md) のチュートリアルを使用します。

### <a name="begin-the-upgrade"></a>アップグレードの開始

サンドボックス環境で、**メンテナンス** メニューの **アップグレード** を選択します。

<img src="media/UpgradeAutomation/01_Select.png" width="700px" alt="Maintain menu" />

アプリケーション バージョンとプラットフォーム アップデートの最新の組み合わせを選択できるダイアログ ボックスが表示されます。

<img src="media/UpgradeAutomation/02_Prepare.png" width="500px" alt="Prepare upgrade environment dialog box" />

> [!IMPORTANT]
> 準備が失敗したことを示すエラーが発生した場合、このトピックの後半の[既知の問題](#known-issues)を参照してください。

### <a name="preparation"></a>準備

環境の詳細ページが更新され、2 つのサンドボックス環境のオプションが右上隅に表示されます。 オプションを選択することで、古いサンドボックス環境とアップグレード中の新しいサンドボックス環境の間で切り替えることができます。

<img src="media/UpgradeAutomation/03_Provision.png" width="700px" alt="Old and Upgrade in progress options" />

フル環境配置に類似しているので、準備ステージには 8 時間以上かかることがあります。 アップグレード中の環境は、展開を高速化するために空の Azure SQL データベースに接続され、配置対象として選択した新しいバージョンで実行されます。

この間、元のサンドボックス環境はそのまま残ります。 この段階では、ダウンタイムの影響はありません。

> [!IMPORTANT]
> 配置の失敗を示すエラーが発生した場合、Microsoft Dynamics サービス エンジニアリング (DSE) チームに通知が送信され、お客様の代わりに問題を事前に解決します。 この問題は、Azure に、お客様の地域で使用できる必要なリソースがない場合に発生する可能性があります。 Microsoft DSE は、より多くのリソースを割り当てるために Azure エンジニアと連携します。 ステージング展開が正常に完了したら、電子メールが送信されます。

### <a name="package-application"></a>パッケージ アプリケーション

ステージング展開が完了したら、環境の詳細ページに戻り、**進行中のアップグレード** ビューに切り替えます。 このビューには、**アップグレード** メニューが表示されます。

**アップグレード** メニューには、**更新プログラムの適用** オプションが含まれます。 ソフトウェアの展開可能なパッケージを新しい環境に適用するには、このオプションを選択します。 これらのパッケージには、独立系ソフトウェア ベンダー (ISV) ソリューションによるパッケージ、独自のカスタマイズ パッケージ、プラットフォーム バイナリ更新プログラム パッケージのどれであるかに関係なく、任意のバイナリ パッケージが含まれます。

最初の手順として、最新のプラットフォーム更新プログラムを適用することを **強くお勧めします**。 バージョン 8.1 にアップグレードする場合は、8.1.3 など、最新のバイナリ アップデート パッケージを入手することをお勧めします。 このパッケージはプラットフォームの最新の更新プログラムも含みます。 このようにして、最新の修正プログラムが利用できることを保証し、プロセスの後半でエラーを減らすのに役立ちます。

<img src="media/UpgradeAutomation/06_ApplyUpdates.png" width="700px" alt="Apply updates option on the Upgrade menu" />

環境に新しいパッケージを適用する場合、プロセスは、定期的な環境保守のプロセスと同じになります。 パッケージ アプリケーションが完成したら、別のパッケージの適用に進む前に、そのパッケージの **サインオフ** ボタンを使用する必要があります。

パッケージの展開が失敗した場合は、**ロールバック** ボタンを使用して取り消すことができます。 このボタンは、**アップグレード** メニューの **ロールバック** オプションとは同じでは**ない**ことに注意してください。

### <a name="critical-hotfixes"></a>重要な修正プログラム

セルフサービス アップグレード プロセスの使用が増加するにつれて、Microsoft はさまざまな対象バージョンの成功にはいくつかの修正プログラムが重大であることを確認しています。 たとえば、バージョン 7.3 にアップグレードしている場合、データのアップグレード、Retail コンポーネント、またはパフォーマンスに関する問題を一貫して解決する Microsoft サポート技術情報 (KB) 記事の一覧が表示されます。

<img src="media/UpgradeAutomation/Upgrade_CriticalKBs.png" width="700px" alt="Critical hotfixes" />

目標は、プロセスの **データ アップグレード** ステップを始める前に、この一覧が空である必要があることです。 これらのサポート技術情報の記事の修正プログラムは、アップグレードが進行中の環境にインストールする必要があります。

### <a name="data-upgrade-and-environment-swap"></a>データ アップグレードと開発スワップ

すべてのパッケージがアップグレード中のサンドボックス環境に適用され、それらをサインオフしたら、データ アップグレードを開始することができます。

> [!IMPORTANT]
> このステージにより、元のサンドボックス環境のダウンタイムが開始されます。

**アップグレード** メニューで、**データ アップグレード** を選択します。

<img src="media/UpgradeAutomation/08_DataUpgrade.png" width="700px" alt="Data upgrade option on the Upgrade menu" />

元のサンドボックス環境がオフになり、新しい環境が元のデータベースに接続されるようにデータベース接続がスワップされます。 この処理は、最大 1 時間かかります。

<img src="media/UpgradeAutomation/09_Swap.png" width="500px" alt="Confirmation message about the environment swap" />

次に、対象バージョンのデータ アップグレード パッケージが自動的に適用されます。 データ アップグレード パッケージを適用するために必要な時間は、データベースのサイズによって異なります。

データのアップグレードが失敗した場合は、**アップグレード** メニューの **ロールバック** を選択して、データのアップグレードが開始される前の時点にデータベースを復元する必要があります。 ロールバックの実行前に、ログをダウンロードして失敗の根本原因を特定することを強くお勧めします。 これにより次回のデータ アップグレードの実行がより円滑に行われることを保証するのに役立ちます。

### <a name="upgrade-days-remaining"></a>アップグレードの残り日数

セルフサービスのアップグレード プロセスは追加費用なしで並列環境を提供するため、この環境を使用できる期間には時間制限があります。 現在、この時間制限は 10 カレンダー日に設定されており、プロセスを開始するために **管理** メニューで **アップグレード** を選択したときに開始します。

#### <a name="what-happens-when-the-time-limit-expires"></a>制限を超過した場合。

タイマーが 0 (ゼロ) に達したとき考えられる結果は 3 つあります:

<img src="media/UpgradeAutomation/Upgrade_Timer.png" width="300px" alt="Upgrade timer has reached 0 (zero) days" />

- **データのアップグレード** 手順をまだ開始していない場合、新しい環境はキューに入り削除されます。 このシナリオでは、アップグレード進行中の環境がプロビジョニングされ、カスタマイズとパッケージがオプションで適用されました。 ただし、データがアップグレードされておらず、元の環境でダウンタイムが発生しませんでした。
- **データ アップグレード** 手順を実行した後でロールバックした場合、新しい環境は削除のためにキューに入れられます。 このシナリオでは、データ アップグレードがロールバックされたため、古い環境が基本環境になります。
- **データ アップグレード** 手順を実行してもアップグレードをまだコミットしていない場合、アクションは実行されず、環境も削除されません。 ロールバックをコミットまたは実行するまで、この状態のままにしておくことができます。 ロールバックを行うことを決めてタイマーが 0 (ゼロ) の場合、新しい環境が削除されます。

アップグレードを成功としてコミットした場合にのみ、元の環境はキューに入り削除されます。

### <a name="commit-or-roll-back"></a>コミットまたはロールバック

データ アップグレード パッケージが適用された後、環境を確認することができます。ユーザーは、ビジネス検証アクティビティを実行できます。 この検証に成功した場合は、**アップグレード** メニューで **コミット** を選択することにより、アップグレード全体を成功とマークできます。 実稼働環境に移行する前にアップグレードをコミットする必要があります。 アップグレードをコミットした後で、元の環境はキューに入り削除されます。

<img src="media/UpgradeAutomation/10_CommitRollback.png" width="700px" alt="Commit option on the Upgrade menu" />

ビジネス検証が失敗すると、**アップグレード** メニューで **ロールバック** を選択できます。 このオプションは、データベースのポイント イン タイムの復元を実行し、元のサンドボックス環境にデータベース接続を戻して、元のサンドボックス環境をオンラインに戻します。 その後、サンドボックス環境が元の状態になります。

### <a name="post-upgrade-actions"></a>アップグレード後のアクション

アップグレードをサインオフした後で、集計の測定を更新する必要があります。 メジャー アップグレードのたびに集約の測定を更新する必要があります。 それらを更新するには **システム管理** \> **設定** \> **エンティティ格納** に移動して、そして **更新** を選択します。

> [!NOTE]
> バッチ処理を使用して、この更新プログラムを実行するようにスケジュールできます。

### <a name="upgrade-production"></a>実稼動環境のアップグレード

サンドボックス UAT 環境でアップグレードをコミットした後、サンドボックス環境でアップグレード プロセスを完了します。 実稼働環境で、同じプロセスを開始できるようになりました。 実行する手順は同じです。

実稼働環境のアップグレード時に非常に長いダウンタイムを引き起こす問題が発生した場合、[実稼働環境の停止の報告](https://docs.microsoft.com/business-applications-release-notes/April18/dynamics365-finance-operations/report-production-outage)プロセスを使用して、Microsoft に知らせてサポートを受けます。

### <a name="upgrade-additional-environments"></a>追加の環境のアップグレード

同じ方法で追加のサンドボックス環境をアップグレードできます。 その他のサンドボックス環境の割り当てを解除して削除し、新しいバージョンで再展開できます。 [データベースの更新](../database/database-refresh.md)セルフサービス アクションを使用することで、別のサンドボックスまたは実稼働環境からアップグレードするデータベースにコピーできます。

### <a name="known-issues"></a>既知の問題

**準備操作を開始できませんでした。Microsoft サポートに通知されました。問題が解消しない場合は、次の ID でサポートにお問い合わせください。**

この既知の問題には Microsoft Dynamics Lifecycle Services (LCS) バック エンドの環境証明書が関係しています。 この影響を受けた場合、サポート チケットを送信し、エラー メッセージに表示されたアクティビティ ID を含めます。 Microsoft が問題を解決します。 Microsoft は影響される環境の一覧を編集しており、今後はこの問題を積極的に解決しようとしています。

**アップグレードをキャンセルしてからもう一度やり直したいと思っています。**

アップグレードをキャンセルするには、**メンテナンス** メニューの **アップグレードのキャンセル** を選択します。 **メンテナンス** メニューは、**アップグレードを実行中です** ビュー (新しいサンドボックス環境) ではなく、**古い** ビュー (元のサンドボックス環境) で使用できます。

**手順 X でアップグレードが失敗しました: サービス モデルの DVT スクリプト: MRProcessServiceします。**

この DVT エラーは断続的であり、データ アップグレード パッケージの **再開** ボタンを使用して解決できます。 **再開** を選択すると、同じ段階でプロセスが再開されます。 Microsoft では、この問題を確実に再現しようとしており、今後修正プログラムを作成する予定です。

**アプリケーション構成の同期に失敗しました。最初に TTSBEGIN を呼び出さずに TTSCOMMIT の呼び出してください。**

この TTSCOMMIT エラーは断続的であり、データ アップグレード パッケージの **再開** ボタンを使用して解決できます。 **再開** を選択すると、同じ段階でプロセスが再開されます。 (この問題は PU 21 で修正されます。)
