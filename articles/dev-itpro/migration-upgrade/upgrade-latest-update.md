---
title: "最新の Finance and Operations 更新プログラムへの移行の処理"
description: "このトピックでは、Microsoft Dynamics 365 for Finance and Operations を最新の更新バージョンにアップグレードするプロセスについて説明します。"
author: robadawy
manager: AnnBe
ms.date: 11/20/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Developer, IT Pro
ms.reviewer: margoc
ms.search.scope: Operations
ms.custom: 102343
ms.assetid: e48d7424-371a-49ee-882c-07b7ceb00183
ms.search.region: Global
ms.author: tabell
ms.search.validFrom: 2016-05-31
ms.dyn365.ops.version: Platform update 1
ms.translationtype: HT
ms.sourcegitcommit: 5bc4c31ee76c0d318c86885fdacbb813ae47da19
ms.openlocfilehash: fa54fed38ad4694f36e21a95b194e27ffdb0e277
ms.contentlocale: ja-jp
ms.lasthandoff: 06/11/2018

---

# <a name="process-for-moving-to-the-latest-update-of-finance-and-operations"></a>最新の Finance and Operations 更新プログラムへの移行の処理

[!include [banner](../includes/banner.md)]

このトピックでは、Microsoft Dynamics 365 for Finance and Operations の以前のリリースから最新の更新バージョンにアップグレードするプロセスについて説明します。 プロセス全体とサポートされるシナリオを説明しますが、プロセスの各ステップに関する詳細な指示は提示しません。

使用できる各リリースの内容の詳細については、[新機能および変更された機能](../../fin-and-ops/get-started/whats-new-changed.md) を参照してください。

## <a name="definitions"></a>定義

Finance and Operations のプラットフォーム更新プログラムは、主に次のコンポーネントで構成されます。

- Application Object Server (AOS)
- 分析とレポート作成
- Microsoft Office 統合
- データ管理
- 統合サービス
- Web クライアント
- その他のバイナリ

次のアプリケーション オブジェクト ツリー (AOT) モデルも含まれます。

- アプリケーション プラットフォーム
- アプリケーション基準
- ディレクトリと Test Essentials

その他のすべてのコンポーネントは Finance and Operations アプリケーション と呼ばれます。

## <a name="introduction-to-the-scenarios"></a>シナリオの概要

### <a name="scenario-1-update-to-a-specific-application-hotfix"></a>シナリオ 1: 特定のアプリケーションの修正プログラムを更新する

このシナリオは、特定の問題に対処するために 1 つ以上の小さな修正プログラムが必要だが、時間やコストの制約などのビジネス要因によってアプリケーション更新を完全に行なうことができない場合に使用します。

### <a name="scenario-2-upgrade-your-custom-code"></a>シナリオ 2: カスタム コードをアップグレードする

このプロセスは、シナリオ 3 を使用する前に必要です。 開発者は、その他の活動を開始する前にこのプロセスを完了する必要があります。

Dynamics 365 for Finance and Operations 8.0 およびこれ以降のバージョンでは、Microsoft モデルのオーバーレイ経由でのカスタマイズは許可されていません。 アップグレードする前に、カスタマイズを拡張機能にリファクターする計画が必要です。 詳細については、[拡張機能のホームページ](../extensibility/extensibility-home-page.md)および [8.0 環境でオーバーレイをリファクタリングする](../extensibility/refactoring-over-layering.md)を参照してください。

### <a name="scenario-3-upgrade-to-the-latest-application-release"></a>シナリオ 3: 最新のアプリケーション リリースにアップグレードする

このシナリオは、時間やコストの制約などのビジネス要因によって最新のアプリケーション リリース全体が更新されない場合に使用します。 アプリケーションの更新の例を次に示します。

- Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition (2017 年 7 月) (7.2 とも呼ばれる)
- Microsoft Dynamics 365 for Finance and Operations Enterprise Edition 7.3
- Microsoft Dynamics 365 for Finance and Operations 8.0

プラットフォームのみの更新プログラムをインストールするには、代わりにシナリオ 4 を使用します。

### <a name="scenario-4-upgrade-to-the-latest-platform-only"></a>シナリオ 4: 最新のプラットフォームのみにアップグレードする

アプリケーションの更新が不要な場合は、このシナリオを使用してプラットフォームの最新リリースに更新します。 プラットフォーム更新プログラムは常に累積的です。 プラットフォームの更新の例を次に示します。

- Microsoft Dynamics AX プラットフォーム更新プログラム 2 (2016 年 8 月)
- Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition プラットフォーム更新プログラム 9 (2017 年 7 月)
- Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition プラットフォーム更新プログラム 11 (2017 年 10 月)

> [!IMPORTANT]
> Microsoft Dynamics AX プラットフォーム更新プログラム 1 (2016 年 5 月) およびプラットフォーム更新プログラム 2 では、プラットフォーム X++ コードのオーバーレイが可能になりました。 以降のプラットフォーム更新プログラムでは、プラットフォーム レベルの X++ のオーバーレイがロックされます。 プラットフォーム更新プログラム 1 またはプラットフォーム更新プログラム 2 をアップグレードする場合、開発者は、アップグレード可能になる前に拡張機能としてオーバーレイをリファクターする必要があります。 Microsoft Dynamics 365 for Operations およびプラットフォーム更新プログラム 3 (2016 年 11 月) またはそれ以降のバージョンをそれ以降のプラットフォーム更新プログラムにアップグレードする場合、X++ コードをリファクターする必要はありません。

## <a name="scenario-1-update-to-a-specific-application-hotfix"></a>シナリオ 1: 特定のアプリケーションの修正プログラムを更新する

このシナリオは、特定の問題に対処するために 1 つ以上の小さな修正プログラムが必要だが、時間やコストの制約などのビジネス要因によって主要なアプリケーション更新を完全に行なうことができない場合に使用します。

アプリケーションの新しい機能を組み込むには、アプリケーションを完全にアップグレードする必要はありません。 アプリケーションの現在更新中のすべての機能は、個別に Microsoft Dynamics Lifecycle Services (LCS) で使用することができます。 LCS から修正プログラムをダウンロードする方法の詳細については、[Lifecycle Services から修正プログラムをダウンロード](download-hotfix-lcs.md) を参照してください。

## <a name="scenario-2-upgrade-your-custom-code"></a>シナリオ 2: カスタム コードをアップグレードする

このシナリオでは、以前のリリースから現在のリリースにコードをアップグレードするプロセスについて説明します。 このプロセスは、シナリオ 3 を使用する前に必要です。 開発者は、その他の活動を開始する前にこのプロセスを完了する必要があります。 アプリケーションを新しいメジャー リリースまたは累積リリースにアップグレードするプロセスの一部として、新しい環境を配置する場合は、コードのアップグレードが必要です。 プラットフォームの更新には、コードのアップグレードは不要です。

| ソース環境 | ソースの AX7.version ファイル内容を予定 | ターゲット環境 | コード アップグレード サービスは必要ですか。 |
|--------------------|---------------------------------------------------------|--------------------|---------------------------------------|
| アプリケーション 7.3                               | 7.3.11971.56116 | アプリケーション リリース 8.0 | 有 |
| 2017 年 7 月のリリース (アプリケーション 7.2)                               | 7.2.11792.56024 | アプリケーション リリース 8.0 または 7.3 | 有 |
| リリース 1611 (アプリケーション 7.1)                               | 7.1.1541.3036 | アプリケーション リリース 8.0、7.3、または 2017 年 7 月 (7.2) | 有 |
| 2016 年 8 月リリース (アプリケーション 7.0.1 およびプラットフォーム更新プログラム 2) | 7.0.1265.27075 | アプリケーション リリース 8.0、7.3、2017 年 7 月 (7.2) または 1611 (7.1) | 有 |
| 2016 年 5 月のリリース (アプリケーション 7.0.1)                           | 7.0.1265.23014 | アプリケーション リリース 8.0、7.3、2017 年 7 月 (7.2) または 1611 (7.1) | 有 |
| 2016 年 2 月リリース (アプリケーション 7.0)                      | 7.0.1265.3015 |  アプリケーション リリース 8.0、7.3、2017 年 7 月 (7.2) または 1611 (7.1) | 有 |
| Microsoft Dynamics AX 2012                                     | 該当なし | アプリケーション リリース 7.3 または 2017 年 7 月 (7.2)  | 有 |
| アプリケーション リリース 7.3         | 該当なし | さらに新しいバージョンのプラットフォーム | 無 |
| 2017 年 7 月のリリース (アプリケーション 7.2)         | 該当なし | さらに新しいバージョンのプラットフォーム | 無 |
| リリース 1611 (アプリケーション 7.1)            | 該当なし | さらに新しいバージョンのプラットフォーム | 無 |
| 2016 年 5 月リリース (プラットフォーム更新プログラム 1、アプリケーション 7.0.1)        | 該当なし | 2016 年 8 月リリース (プラットフォーム更新プログラム 2、アプリケーション 7.0.1) | 無 |

実際の顧客であるか、まだプロジェクトの実装フェーズにあるかに関係なく、コードをプラットフォーム/アプリケーションの最新の更新プログラムにアップグレードする手順に従います。

1. コードをアップグレードするには、LCS のコード アップグレード サービスを使用します。 詳細については、[Lifecycle Services でコード アップグレード サービスのコンフィギュレーション](../lifecycle-services/configure-execute-code-upgrade.md)  を参照してください。

    > [!NOTE]
    > コード アップグレード サービスは、インストールした古い Microsoft X++ 修正プログラムも削除します。 古い Microsoft X++ の修正プログラムの削除は必須ステップであるため、カスタム コードがない場合でもコード アップグレード サービスを使用することをお勧めします。

2. アップグレードする新しいバージョンを実行する新しい開発環境を展開します。 この環境を使用して、コードをマージし、カスタム コードをリファクターします。 最新の更新プログラムを実行する新しい開発/テスト環境の要求を送信します。

    - サブスクリプションで新しい開発やテスト環境が可能ではない場合、既存の開発やテスト環境を削除することが必要な可能性があります。
    - プロジェクトのタイプに応じて、開発者仮想マシン (VM) を展開するためのその他のオプションがあります。

        - 開発仮想ハード ディスク (VHD) をダウンロードします。
        - Microsoft Azure サブスクリプションを実行している場合は、新しい開発者トポロジーを配置します。

    - 古い開発環境から開発データを保持する場合は、データベースのバックアップを作成し、BAK ファイルを保存します。 次に、コードのアップグレードが完了したら、「[開発、デモ、またはサンドボックスの環境でのデータのアップグレード](upgrade-data-to-latest-update.md)」の手順に従って、新しい開発環境にデータベース バックアップを復元し、データをアップグレードできます。

3. コードの移行手順を完了します。

    1. 開発 VM を Microsoft Visual Studio Team Services (VSTS) に接続し、アップグレードされたコードを含む VSTS ブランチにローカル メタデータ フォルダをマップします。
    2. 同期して、競合を解決し、ビルドしてテストします。
    3. アップグレード後のコードを含む VSTS ブランチを、主要な開発の分岐とマージします。 詳細については、[フォルダーおよびファイルをマージする](https://www.visualstudio.com/en-us/docs/tfvc/merge-folders-files) を参照してください。
    4. ビルドしテストします。
    5. コードの配置可能パッケージを作成します。

4. この環境に適用される修正プログラムをインストールします。
5. 展開可能なパッケージをプロジェクトの LCS アセット ライブラリにアップロードします。

コードの移行手順の詳細については、[コードの移行](../dev-tools/developer-home-page.md#code-migration) を参照してください。 コードの移行が完了した後は、シナリオ 3 に進みます。

## <a name="scenario-3-upgrade-to-the-latest-application-release"></a>シナリオ 3: 最新のアプリケーション リリースにアップグレードする

これらの手順は、以前のリリースで稼動しており、最新のプラットフォームおよびアプリケーションの各リリースに完全にアップグレードする顧客に適用されます。 これらのステップは、まだ稼働していない場合でも、実稼働環境をすでに展開して構成しているお客様にも適用されます。 アプリケーションをアップグレードしていなく、プラットフォームをアップグレードする場合は、代わりに 4 つのシナリオを使用します。

### <a name="upgrade-your-code"></a>コードのアップグレード

最初に、シナリオ 2 で説明されているように、コードをアップグレードします。 このステップは、開発者のタスクです。 これは、アップグレード対象の新しいリリースを実行している開発環境で実行されます。

### <a name="upgrade-your-data-in-a-development-environment"></a>開発環境でのデータのアップグレード

データ アップグレード プロセスを外部データベースのコピーで実行します。 環境が既に実稼働状態にある場合、ソース データベースは実稼働データベースのコピーです。 それ以外の場合、ソース データベースは最新のデータベースです。 アップグレード対象のリリースを実行している開発環境でこのプロセスを実行します。 このステップは、開発者によって行われる検証プロセスです。 これにより、開発者はこの環境でカスタマイズの特定のセットを使用することで、データのアップグレードを正常に完了できることの確認に役立ちます。

実稼働のデータベースのコピーを作成するには、[[Microsoft Dynamics 365 for Finance and Operations データベースを Azure SQL データベースから SQL Server 環境にコピーする](../database/copy-database-from-azure-sql-to-sql-server.md)] の手順に従います。

データのアップグレード プロセスを実行するには、[[開発環境またはデモ環境のデータ アップグレード プロセス](upgrade-data-to-latest-update.md)] の手順に従います。

> [!IMPORTANT]
> - 開発環境でのデータのアップグレードは必須ステップです。 これにより、サンドボックス ユーザー受け入れテスト (UAT) と実稼働環境をアップグレードする際に、後のダウンタイムの延長やアップグレード エラーのリスクを軽減できます。
> - データをアップグレードする前に複数のアプリケーション修正プログラムが必要なことがあります。 既存の開発環境を再配置する前に、これらの修正プログラムが必要かどうかを確認します。 必要な修正プログラムをインストールし、VSTS にチェックインします。 このステップは、開発環境の古いバージョンでのみで完了できます。 さまざまな状況で必要な修正プログラムの一覧については、[開発、デモ、またはサンドボックス環境でのデータのアップグレード](upgrade-data-to-latest-update.md#before-you-begin) を参照してください。
 
### <a name="upgrade-your-sandbox-uat-environment"></a>サンドボックス UAT 環境のアップグレード

次の条件が満たされたとき、Microsoft のサービス エンジニア リング チーム (DSE) がユーザーのためにこのプロセスを実行するように要求する必要があります。 LCS を使用して要求を送信します。

- コード アップグレード プロセスを実行して、開発環境でのデータのアップグレードのテストを完了しました。
- 現在、実稼働状態にあります。すなわち、実稼働環境にすでに配置されています。

DSEは、レベル 2 以上の 1 つのサンドボックス UAT 環境でデータのアップグレードを行います。 このアップグレード プロセスはコントロールとして使用されます。 本サンドボックス環境では、本番環境で使用されるのと同じアップグレード プロセスが使用されます。

**任意の追加の 2 層 またはそれ以上のサンドボックス環境をアップグレードします。**

追加のレベル 2 以上のサンド ボックス環境をアップグレードする必要はありません。 代わりに、それらを削除して再配置し、データベース更新要求を行って、すでにアップグレードされたレベル 2 以上の環境からデータベースをコピーします。 または、[サンドボックス環境のアップグレードをするためのプロセス](upgrade-sandbox-environment.md) の手順に従ってこれらの環境を手動でアップグレードできます。

**任意の第 1 層環境のアップグレード**

新しいバージョンを使用して階層 1 環境 (開発ボックスまたはワン ボックスとも呼ばれます) を展開することができます。 その後、アップグレードされた VSTS ブランチに同期するだけです。 第 1 層環境のデータを取得するには、[[開発環境またはデモ環境のデータ アップグレード プロセス](upgrade-data-to-latest-update.md)] の手順に従ってデータベースをアップグレードします。

#### <a name="use-lcs-to-submit-an-upgrade-request-to-dse"></a>LCS を使用して DSE にアップグレード要求を送信

1. アップグレードする環境の**環境の詳細**ページで、**メンテナンス**を選択し、**アップグレード**を選択します。 アップグレードの要求を入力するダイアログ ボックスが表示されます。

2. アップグレード後のターゲット バージョンを選択し、優先ダウンタイム期間の開始時刻と終了時刻を指定します。
    - 日付と時刻のピッカーは、使用可能な時間を示します。
    - 予想される期間内にアップグレードを実行できるようにするには、アップグレードを行う前に、アップグレード要求を少なくとも 5 営業日前に提出する必要があります。 新しい環境がダウンタイム期間の前に準備できるように、事前に通知する必要があります。
    
    > [!IMPORTANT] 
    > 要求は DSE チームが利用可能かどうかによって異なるため、特定のアップグレード ウィンドウを利用可能などうかは保証できません。 コミットするとすぐに、アップグレードのウィンドウを要求することをお勧めします。
    
    - ダウンタイムの開始と終了まで 8 時間以上を許可する必要があります。 この時間は、新しい環境で交換し、データ アップグレード プロセスを完了するために必要です。

3. アップグレードされた環境の一部である必要があるカスタムコードまたは X++ 修正プログラムがある場合は、アプリケーション (AOT) 配置可能パッケージを選択します。 アップグレードされたカスタム コードと、開発またはビルド環境で作衛された必要な X++ 修正プログラムを含む、AOT が配置可能なパッケージを選択します。 次の図に示すように、**ソリューション資産のカスタマイズ** タブを使用します。タブの次の図に示すようにします。

    ![ソリューション資産のカスタマイズ タブ](./media/selectsolutionassets.PNG)

    > [!IMPORTANT]
    > - サービス リクエストでアプリケーションの配置可能なパッケージを選択しないと、DSE で要求が拒否される可能性があります。
    > - DSE は UAT 環境で生産データベースのコピーをアップグレードしますが、DSE は現在の UAT データベースをアップグレードしません。 UAT 環境のアップグレードは、アップグレード プロセスの実稼働前検証として意図されています。
    > - エラーによりアップグレード プロセスが停止される場合は、DSE は環境を元の状態にロール バックします。 失敗の原因となった問題を解決して、アップグレードを新しい時間にスケジュールすることができます。
    > - 小売機能を使用している場合、追加のアップグレード手順が必要であるため、16 時間以上のダウンタイムを必要とします。

#### <a name="validate-your-sandbox-environment"></a>サンドボックス環境の検証

DSE チームがアップグレード プロセスが完了すると、サービス要求ステータスは **検証の準備完了** に変わります。 システムはこの段階で利用可能です。 更新された環境は、古い環境と同じ URL、同じ環境名、同じマシン名を持ちます。 サービス要求のステータスを検証してから、**検証に成功しました** または **検証に失敗しました** に変更します。 サービス要求を**検証に失敗しました**に設定すると、アップグレードのロールバックが開始されます。 ロールバック要求時には最長で 5 日の作業日があります。 その後、Microsoft は、古い環境を破棄します。

### <a name="upgrade-your-production-environment"></a>実稼動環境のアップグレード

1. LCS を使用して、サンドボックス環境の場合と同様に、実稼働環境を更新するためのアップグレード要求を送信します。
3. サービス要求のステータスを**検証に成功しました**に設定し、検証とテスト、サインオフを完了します。 問題が検出され、古い環境をロールバックする場合は、ステータスを **検証に失敗しました**に設定し、ロールバックします。 ロールバック要求時には最長で 5 日の作業日があります。 その後、Microsoft は、古い環境を破棄します。

## <a name="scenario-4-upgrade-to-the-most-current-platform-only"></a>シナリオ 4: 最新のプラットフォームのみにアップグレードする

プラットフォーム AOT モデル (Application Platform、Application Foundation、および Directory および Test Essentials) のカスタマイズが含まれていない環境を実行している場合は、新しい環境にアップグレードせずに、プラットフォームのインプレース更新を実行できます 。 このプロセスの詳細については、[Finance and Operations を最新のプラットフォーム更新プログラムにアップグレード](upgrade-latest-platform-update.md) を参照してください。 ユーザーのプラットフォームのみをアップグレードする場合は、コードのアップグレード (このトピックではシナリオ 2)、またはデータ アップグレード スクリプトの実行は必要ありません。

