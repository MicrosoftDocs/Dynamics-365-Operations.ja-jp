---
title: "最新の Finance and Operations 更新プログラムへの移行の処理"
description: "このトピックでは、Microsoft Dynamics 365 for Finance and Operations を最新の更新バージョンに移行するプロセスについて説明します。"
author: laneswenka
manager: AnnBe
ms.date: 12/04/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Developer, IT Pro
ms.reviewer: margoc
ms.search.scope: Operations
ms.custom: 102343
ms.assetid: e48d7424-371a-49ee-882c-07b7ceb00183
ms.search.region: Global
ms.author: tabell
ms.search.validFrom: 2016-05-31
ms.dyn365.ops.version: Platform update 1
ms.translationtype: HT
ms.sourcegitcommit: 222041860cd29274a3edddba037773a833b21d14
ms.openlocfilehash: f1d41dba7acd34b04fe323b12dc35a0aea5174fe
ms.contentlocale: ja-jp
ms.lasthandoff: 12/05/2018

---

# <a name="process-for-moving-to-the-latest-update-of-finance-and-operations"></a>最新の Finance and Operations 更新プログラムへの移行の処理

[!include [banner](../includes/banner.md)]
[!include [banner](../includes/preview-banner.md)]

このトピックでは、Microsoft Dynamics 365 for Finance and Operations を最新リリースに更新またはアップグレードするプロセスについて説明します。 プロセス全体とサポートされるシナリオを説明しますが、プロセスの各ステップに関する詳細な指示は提示しません。

Finance and Operations の各リリースの内容については、[新機能と変更点](../../fin-and-ops/get-started/whats-new-changed.md)を参照してください。

## <a name="definitions"></a>定義

- **パブリック プレビュー**: だれでも入手できるようにされた機能であり、機能はサポートされています。 追加機能強化や、プレビュー フェーズを終了する前に解決する必要がある既知の問題が存在する可能性があります。
- **廃止**: 長期的にサポートされない機能またはプロセス。 機能またはプロセスのサポートが終了する日付を明示する必要があります。
- **アップグレード**: バージョン 8.0 より前のソース環境では、Finance and Operations のある公式リリースから次のリリースに移行するプロセス。 例としては、7.1 から 7.3 または 7.3 から 8.0 への移行があります。 プロセスには、無料サンド ボックス環境、コード アップグレード、およびデータ アップグレードの設定が含まれます。
- **更新**: バージョン 8.0 以降のソース環境で、バイナリ パッケージを環境に適用し、Finance and Operations のある公式リリースから次のリリースに移行するプロセス。 このプロセスには、低いダウンタイム要件があり、データ アップグレードは含まれません。

## <a name="introduction-to-the-scenarios"></a>シナリオの概要

### <a name="scenario-1-update-to-a-specific-application-hotfix-to-be-deprecated"></a>シナリオ 1: 特定のアプリケーションの修正プログラムを更新する (非推奨予定)

> [!IMPORTANT]
> このシナリオは、すべてのユーザーがバージョン 8.1 以降に移行する必要がある 2019 年 4 月までに非推奨になります。 バージョン 8.1 は、個々の X++ 修正プログラムをリリースまたはサポートしなくなりました。

このシナリオは、特定の問題に対処するために 1 つ以上の小さな修正プログラムが必要だが、時間やコストの制約などのビジネス要因によってアプリケーション更新を完全に行なうことができない場合に使用します。

### <a name="scenario-2-upgrade-your-custom-code"></a>シナリオ 2: カスタム コードをアップグレードする

このシナリオは、シナリオ 3 を使用する前に必要です。 開発者は、その他の活動を開始する前にカスタム コードのアップグレードを完了する必要があります。

バージョン 8.0 以降では、Microsoft のモデルをオーバーレイヤーすることでカスタマイズを行うことはできません。 アップグレードする前に、カスタマイズを拡張機能にリファクターする計画が必要です。 詳細については、[拡張機能のホームページ](../extensibility/extensibility-home-page.md)および [8.0 環境でオーバーレイをリファクタリングする](../extensibility/refactoring-over-layering.md)を参照してください。

### <a name="scenario-3-upgrade-to-the-latest-application-release-public-preview"></a>シナリオ 3: 最新のアプリケーション リリースにアップグレードする (パブリック プレビュー)

このシナリオを使用して、Finance and Operations の最新のリリースに移行します。

このトピックの後半で定義されているプロセスを使用することで、無料サンドボックス環境を設定することができます。 実稼働前および実稼働環境の両方で、ダウンタイム ウィンドウをフル コントロールできます。

### <a name="scenario-4-upgrade-to-the-latest-platform-only"></a>シナリオ 4: 最新のプラットフォームのみにアップグレードする

アプリケーションの更新が不要な場合は、このシナリオを使用してプラットフォームの最新リリースに更新します。 プラットフォーム更新プログラムは常に累積的です。 プラットフォームの更新の例を次に示します。

- Microsoft Dynamics AX プラットフォーム更新プログラム 2 (2016 年 8 月)
- Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition プラットフォーム更新プログラム 9 (2017 年 7 月)
- Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition プラットフォーム更新プログラム 11 (2017 年 10 月)

> [!IMPORTANT]
> Microsoft Dynamics AX プラットフォーム更新プログラム 1 (2016 年 5 月) およびプラットフォーム更新プログラム 2 では、プラットフォーム レベル X++ コードのオーバーレイが可能でした。 以降のプラットフォーム更新プログラムでは、プラットフォーム レベルの X++ コードのオーバーレイがロックされます。 プラットフォーム更新プログラム 1 またはプラットフォーム更新プログラム 2 をアップグレードする場合、開発者は、アップグレード可能になる前に拡張機能としてオーバーレイをリファクターする必要があります。 Microsoft Dynamics 365 for Operations およびプラットフォーム更新プログラム 3 (2016 年 11 月) またはそれ以降のバージョンをそれ以降のプラットフォーム更新プログラムにアップグレードする場合、X++ コードをリファクターする必要はありません。

## <a name="scenario-1-update-to-a-specific-application-hotfix-to-be-deprecated"></a>シナリオ 1: 特定のアプリケーションの修正プログラムを更新する (非推奨予定)

> [!IMPORTANT]
> このシナリオは、すべてのユーザーがバージョン 8.1 以降に移行する必要がある 2019 年 4 月までに非推奨になります。 バージョン 8.1 は、個々の X++ 修正プログラムをリリースまたはサポートしなくなりました。

このシナリオは、特定の問題に対処するために 1 つ以上の小さな修正プログラムが必要だが、時間やコストの制約などのビジネス要因によって主要なアプリケーション更新を完全に行なうことができない場合に使用します。

アプリケーションの新しい機能を組み込むには、アプリケーションを完全にアップグレードする必要はありません。 アプリケーションの現在更新中のすべての機能は、個別に Microsoft Dynamics Lifecycle Services (LCS) で使用することができます。 LCS から修正プログラムをダウンロードする方法の詳細については、[Lifecycle Services から修正プログラムをダウンロード](download-hotfix-lcs.md) を参照してください。

## <a name="scenario-2-upgrade-your-custom-code"></a>シナリオ 2: カスタム コードをアップグレードする

このシナリオでは、以前のリリースから現在のリリースにコードをアップグレードするプロセスについて説明します。 このプロセスは、シナリオ 3 を使用する前に必要です。 開発者は、その他の活動を開始する前にこのプロセスを完了する必要があります。 アプリケーションを新しいメジャー リリースまたは累積リリースにアップグレードするプロセスの一部として、新しい環境を配置する場合は、コードのアップグレードが必要です。 プラットフォームの更新には、コードのアップグレードは不要です。

| ソース環境 | ソースの AX7.version ファイル内容を予定 | ターゲット環境 | コード アップグレード サービスは必要ですか。 |
|--------------------|---------------------------------------------------------|--------------------|---------------------------------------|
| アプリケーション 7.3 | 7.3.11971.56116 | アプリケーション リリース 8.x | 有 |
| 2017 年 7 月のリリース (アプリケーション 7.2) | 7.2.11792.56024 | アプリケーション リリース 8.x または 7.3 | 有 |
| リリース 1611 (アプリケーション 7.1) | 7.1.1541.3036 | アプリケーション リリース 8.x、7.3、または 2017 年 7 月 (7.2) | 有 |
| 2016 年 8 月リリース (アプリケーション 7.0.1 およびプラットフォーム更新プログラム 2) | 7.0.1265.27075 | アプリケーション リリース 8.x、7.3、2017 年 7 月 (7.2) または 1611 (7.1) | 有 |
| 2016 年 5 月のリリース (アプリケーション 7.0.1) | 7.0.1265.23014 | アプリケーション リリース 8.x、7.3、2017 年 7 月 (7.2) または 1611 (7.1) | 有 |
| 2016 年 2 月リリース (アプリケーション 7.0) | 7.0.1265.3015 | アプリケーション リリース 8.x、7.3、2017 年 7 月 (7.2) または 1611 (7.1) | 有 |
| Microsoft Dynamics AX 2012 | 該当なし | アプリケーション リリース 7.3 または 2017 年 7 月 (7.2) | 有 |
| アプリケーション リリース 7.3 | 該当なし | さらに新しいバージョンのプラットフォーム | 無 |
| 2017 年 7 月のリリース (アプリケーション 7.2) | 該当なし | さらに新しいバージョンのプラットフォーム | 無 |
| リリース 1611 (アプリケーション 7.1) | 該当なし | さらに新しいバージョンのプラットフォーム | 無 |
| 2016 年 5 月リリース (プラットフォーム更新プログラム 1、アプリケーション 7.0.1) | 該当なし | 2016 年 8 月リリース (プラットフォーム更新プログラム 2、アプリケーション 7.0.1) | 無 |

実際の顧客であるか、まだプロジェクトの実装フェーズにあるかに関係なく、コードをプラットフォーム/アプリケーションの最新の更新プログラムにアップグレードする手順に従います。

1. コードをアップグレードするには、LCS のコード アップグレード サービスを使用します。 詳細については、[Lifecycle Services でコード アップグレード サービスのコンフィギュレーション](../lifecycle-services/configure-execute-code-upgrade.md)  を参照してください。

    > [!NOTE]
    > コード アップグレード サービスは、インストールした古い Microsoft X++ 修正プログラムも削除します。 古い Microsoft X++ の修正プログラムの削除は必須ステップであるため、カスタム コードがない場合でもコード アップグレード サービスを使用することをお勧めします。

2. アップグレードする新しいバージョンを実行する新しい開発環境を展開します。 この環境を使用して、コードをマージし、カスタム コードをリファクターします。 最新の更新プログラムを実行する新しい開発/テスト環境の要求を送信します。

    - サブスクリプションで新しい開発やテスト環境が可能ではない場合、既存の開発やテスト環境を削除することが必要な可能性があります。
    - プロジェクトのタイプに応じて、開発者仮想マシン (VM) を展開するためのその他のオプションがあります。

        - 開発仮想ハード ディスク (VHD) をダウンロードします。
        - Microsoft Azure サブスクリプションを実行している場合は、新しい開発者トポロジーを配置します。

    - 古い開発環境から開発データを保持する場合は、データベースのバックアップを作成し、BAK ファイルを保存します。 次に、コードのアップグレードが完了したら、「[開発、デモ、またはサンドボックスの環境でのデータのアップグレード](upgrade-data-to-latest-update.md)」の手順に従って、新しい開発環境にデータベース バックアップを復元し、データをアップグレードできます。

3. コードの移行手順に従います。

    1. 開発 VM を Microsoft Azure DevOps に接続し、アップグレードされたコードを含む Azure DevOps ブランチにローカル メタデータ フォルダをマップします。
    2. 同期して、競合を解決し、ビルドしてテストします。
    3. アップグレード後のコードを含む Azure DevOps ブランチを、主要な開発の分岐とマージします。 詳細については、[フォルダーおよびファイルをマージする](https://www.visualstudio.com/docs/tfvc/merge-folders-files) を参照してください。
    4. ビルドしテストします。
    5. コードの配置可能パッケージを作成します。

4. この環境に適用される修正プログラムをインストールします。
5. 展開可能なパッケージをプロジェクトの LCS アセット ライブラリにアップロードします。

コードの移行手順の詳細については、[コードの移行](../dev-tools/developer-home-page.md#code-migration) を参照してください。 コードの移行が完了した後は、シナリオ 3 に進みます。

## <a name="scenario-3-upgrade-to-the-latest-application-release-public-preview"></a>シナリオ 3: 最新のアプリケーション リリースにアップグレードする (パブリック プレビュー)

> [!IMPORTANT]
> アプリケーションのバージョン 8.0 を使用していて、8.1 リリースに移行する場合は、[8.0 から 8.1 への環境の更新](./appupdate-80-81.md)にある簡略化された手順に従います。

これらの手順は、以前のリリースで稼動しており、最新のプラットフォームおよびアプリケーションの各リリースに完全にアップグレードする顧客に適用されます。 これらのステップは、まだ稼働していない場合でも、実稼働環境をすでに展開して構成しているお客様にも適用されます。 アプリケーションをアップグレードしていなく、プラットフォームをアップグレードする場合は、代わりに 4 つのシナリオを使用します。

### <a name="upgrade-your-code"></a>コードのアップグレード

最初に、シナリオ 2 で説明されているように、コードをアップグレードします。 このステップは、開発者のタスクです。 これは、アップグレード対象の新しいリリースを実行している開発環境で実行されます。

### <a name="upgrade-your-data-in-a-development-environment"></a>開発環境でのデータのアップグレード

データ アップグレード プロセスを外部データベースのコピーで実行します。 環境が既に実稼働状態にある場合、ソース データベースは実稼働データベースのコピーです。 それ以外の場合、ソース データベースは最新のデータベースです。 アップグレード対象のリリースを実行している開発環境でこのプロセスを実行します。 このステップは、開発者によって行われる検証プロセスです。 これにより、開発者はこの環境でカスタマイズの特定のセットを使用することで、データのアップグレードを正常に完了できることの確認に役立ちます。

実稼働のデータベースのコピーを作成するには、[[Microsoft Dynamics 365 for Finance and Operations データベースを Azure SQL データベースから SQL Server 環境にコピーする](../database/copy-database-from-azure-sql-to-sql-server.md)] の手順に従います。

データのアップグレード プロセスを実行するには、[[開発環境またはデモ環境のデータ アップグレード プロセス](upgrade-data-to-latest-update.md)] の手順に従います。

> [!IMPORTANT]
> - 開発環境でのデータのアップグレードは必須ステップです。 これにより、サンドボックス ユーザー受け入れテスト (UAT) と実稼働環境をアップグレードする際に、後のダウンタイムの延長やアップグレード エラーのリスクを軽減できます。
> - データをアップグレードする前に複数のアプリケーション修正プログラムが必要なことがあります。 既存の開発環境を再配置する前に、これらの修正プログラムが必要かどうかを確認します。 必要な修正プログラムをインストールし、Azure DevOps にチェックインします。 このステップは、開発環境の古いバージョンでのみで完了できます。 さまざまな状況で必要な修正プログラムの一覧については、[開発、デモ、またはサンドボックス環境でのデータのアップグレード](upgrade-data-to-latest-update.md#before-you-begin) を参照してください。
 
### <a name="upgrade-your-tier2standard-acceptance-test-or-higher-sandbox-environment-public-preview"></a>階層 2/スタンダード承認テスト (またはそれ以上) サンドボックス環境のアップグレード (パブリック プレビュー)

コードを完成し、Microsoft SQL Server でデータを操作しなくても開発環境でエンド ツー エンドのデータ アップグレードを実行することができるようになったら、サンドボックス環境内でプロセスを開始することができます。

まず、セルフサービスのアップグレードのプレビュー機能がアカウントで有効であることを確認します。 LCS で、**プレビュー機能管理** に移動し、一覧で **セルフサービスで環境をアップグレード** 機能を選択し、**プレビュー機能有効** オプションが **はい** に設定されていることを確認します。

#### <a name="prerequisite"></a>前提条件

アップグレードを開始する前に、サンドボックス環境に最新の生産データがあることを確認しておくことを強くお勧めします。 データ セットが最新の状態の場合、実稼働環境でアップグレードを確実に行うことができます。 この手順を完了するには、[データベースの更新](../database/database-refresh.md)セルフサービス アクションを使用します。

#### <a name="begin-the-upgrade"></a>アップグレードの開始

サンドボックス環境で、**メンテナンス** メニューの **アップグレード** を選択します。

<img src="media/UpgradeAutomation/01_Select.png" width="700px" alt="Maintain menu" />

最新のアプリケーションとプラットフォームの組み合わせを選択するダイアログ ボックスが表示されます。

<img src="media/UpgradeAutomation/02_Prepare.png" width="500px" alt="Prepare upgrade environment dialog box" />

> [!NOTE]
> 準備が失敗したことを示すエラーが発生した場合、このトピックの後半の[既知の問題](#known-issues)を参照してください。

#### <a name="preparation"></a>準備

環境の詳細ページが更新され、2 つのサンドボックス環境のオプションが右上隅に表示されます。 オプションを選択することで、古いサンドボックスとアップグレード中の新しいサンドボックスの間で切り替えることができます。

<img src="media/UpgradeAutomation/03_Provision.png" width="700px" alt="Old and Upgrade in progress options" />

フル環境配置に類似しているので、準備ステージには 8 時間以上かかることがあります。 アップグレード中の環境は、展開を高速化するために空の Microsoft Azure SQL データベースに接続され、展開対象として選択した新しいバージョンで実行されます。

この間、元のサンドボックスは変更されず、この段階ではダウンタイムによる影響はありません。 

> [!NOTE]
> 展開の失敗を示すエラーが発生した場合、Microsoft Dynamics サービス エンジニアリング (DSE) チームに通知が送信され、お客様の代わりに問題を事前に解決します。 この問題は、Azure に、お客様の地域で使用できる必要なリソースがない場合に発生する可能性があります。 Microsoft DSE は、より多くのリソースを割り当てるために Azure エンジニアと連携します。 ステージング展開が正常に完了したら、電子メールが送信されます。 

#### <a name="package-application"></a>パッケージ アプリケーション

ステージング展開が完了したら、環境の詳細ページに戻り、**進行中のアップグレード** ビューに切り替えます。 このビューには、**アップグレード** メニューが表示されます。

**アップグレード** メニューには、**更新プログラムの適用** オプションが含まれています。 ソフトウェアの展開可能なパッケージを新しい環境に適用するには、このオプションを選択します。 これらのパッケージには、独立系ソフトウェア ベンダー (ISV) ソリューションによるパッケージ、独自のカスタマイズ パッケージ、プラットフォーム バイナリ更新プログラム パッケージのどれであるかに関係なく、任意のバイナリ パッケージが含まれます。 

<img src="media/UpgradeAutomation/06_ApplyUpdates.png" width="700px" alt="Apply updates option on the Upgrade menu" />

環境に新しいパッケージを適用する場合、プロセスは、定期的な環境保守のプロセスと同じになります。 パッケージ アプリケーションが完成したら、別のパッケージの適用に進む前に、そのパッケージの **サインオフ** ボタンを使用する必要があります。

パッケージの展開が失敗した場合は、**ロールバック** ボタンを使用して取り消すことができます。 このボタンは、**アップグレード** メニューの **ロールバック** オプションとは同じでは**ない**ことに注意してください。

各パッケージの展開には、約 1 時間かかることがあります。

#### <a name="data-upgrade-and-environment-swap"></a>データ アップグレードと開発スワップ

すべてのパッケージがアップグレード中のサンドボックスに適用され、それらをサインオフしたら、データ アップグレードを開始することができます。

> [!NOTE]
> このステージにより、元のサンドボックス環境のダウンタイムが開始されます。

**アップグレード** メニューで、**データ アップグレード** を選択します。 元のサンドボックス環境がオフになり、新しい環境が元のデータベースに接続されるようにデータベース接続がスワップされます。 この処理は、最大 1 時間かかります。

<img src="media/UpgradeAutomation/08_DataUpgrade.png" width="700px" alt="Data upgrade option on the Upgrade menu" />

<img src="media/UpgradeAutomation/09_Swap.png" width="500px" alt="Confirmation message about the environment swap" />

次に、対象バージョンのデータ アップグレード パッケージが自動的に適用されます。 データ アップグレード パッケージを適用するために必要な時間は、データベースのサイズによって異なります。

#### <a name="commit-or-rollback"></a>コミットまたはロールバック

データ アップグレード パッケージが適用された後、環境を確認することができます。ユーザーは、ビジネス検証アクティビティを実行できます。 この検証に成功した場合は、**アップグレード** メニューで **コミット** を選択することにより、アップグレード全体を成功とマークできます。 実稼働環境に移行するには、アップグレードをコミットする必要があります。

<img src="media/UpgradeAutomation/10_CommitRollback.png" width="700px" alt="Commit option on the Upgrade menu" />

検証が失敗すると、**アップグレード** メニューで **ロールバック** を選択できます。 このオプションは、データベースのポイント イン タイムの復元を実行し、元のサンドボックスにデータベース接続を戻して、元のサンドボックスをオンラインに戻します。 その後、サンドボックスが前の状態になります。

#### <a name="upgrade-production"></a>実稼動環境のアップグレード

このステージに到達すると、アップグレード プロセスは完了しています。 実稼働環境で、同じプロセスを開始できるようになりました。 実行する手順は、まったく同じです。

実稼働環境のアップグレード時に非常に長いダウンタイムを引き起こす問題が発生した場合、[実稼働環境の停止の報告](https://docs.microsoft.com/business-applications-release-notes/April18/dynamics365-finance-operations/report-production-outage)プロセスを使用して、Microsoft に知らせてサポートを受けます。

#### <a name="upgrade-additional-environments"></a>追加の環境のアップグレード

これと同じ方法で、追加サンドボックス環境をアップグレードすることができます。 その他のサンドボックス環境の割り当てを解除して削除し、新しいバージョンで再展開できます。 [データベースの更新](../database/database-refresh.md)セルフサービス アクションを使用することで、別のサンドボックスまたは実稼働環境からアップグレードするデータベースにコピーできます。

#### <a name="known-issues"></a>既知の問題

**準備操作を開始できませんでした。Microsoft サポートに通知されました。問題が解消しない場合は、次の ID でサポートにお問い合わせください。**

この既知の問題には、LCS バックエンドの環境証明書が関係しています。 この影響を受けた場合、サポート チケットを送信し、エラー メッセージに表示されたアクティビティ ID を含めます。 Microsoft が問題を解決します。 Microsoft は影響を受ける環境のリストをまとめており、今後はこの問題を事前に解決しようとしています。

**アップグレードをキャンセルしてからもう一度やり直したいと思っています。**

アップグレードをキャンセルするには、**メンテナンス** メニューの **アップグレードのキャンセル** を選択します。  **メンテナンス** メニューは、**アップグレードを実行中です** ビュー (新しいサンドボックス) ではなく、**古い** ビュー (元のサンドボックス) で使用できます。

**手順 X でアップグレードが失敗しました: サービス モデルの DVT スクリプト: MRProcessServiceします。**

この DVT エラーは断続的であり、データ アップグレード パッケージの **再開** ボタンを使用して解決できます。 **再開** を選択すると、この段階でプロセスが再開されます。 Microsoft では、この問題を確実に再現しようとしており、今後修正プログラムを作成する予定です。

**アプリケーション構成の同期に失敗しました。最初に TTSBEGIN を呼び出さずに TTSCOMMIT の呼び出してください。**

この TTSCOMMIT エラーは断続的であり、データ アップグレード パッケージの **再開** ボタンを使用して解決できます。 **再開** を選択すると、この段階でプロセスが再開されます。 Microsoft では、この問題を確実に再現しようとしており、今後修正プログラムを作成する予定です。

## <a name="scenario-4-upgrade-to-the-most-current-platform-only"></a>シナリオ 4: 最新のプラットフォームのみにアップグレードする

アプリケーション オブジェクト ツリー (AOT) モデル (Application Platform、Application Foundation、および Directory および Test Essentials) のカスタマイズが含まれていない環境を実行している場合は、新しい環境にアップグレードせずに、プラットフォームのインプレース更新を実行できます。 このプロセスの詳細については、[Finance and Operations を最新のプラットフォーム更新プログラムにアップグレード](upgrade-latest-platform-update.md) を参照してください。 ユーザーのプラットフォームのみをアップグレードする場合は、コードのアップグレード (このトピックではシナリオ 2)、またはデータ アップグレード スクリプトの実行は必要ありません。

