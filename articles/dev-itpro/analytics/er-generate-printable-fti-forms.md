---
title: 印刷可能な FTI フォームの生成
description: このトピックでは、電子レポート (ER) フレームワークを使用して、印刷可能な自由書式の請求書 (FTI) フォームを Microsoft Office ドキュメントとして生成する方法について説明します。
author: NickSelin
manager: AnnBe
ms.date: 07/24/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.scope: Core, Operations
ms.custom: 220314
ms.assetid: 2685df16-5ec8-4fd7-9495-c0f653e82567
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2018-04-01
ms.dyn365.ops.version: Release 8.0
ms.openlocfilehash: d27a11a0d925b0f1164578f9c04e6abd4736b2b2
ms.sourcegitcommit: 9d4c7edd0ae2053c37c7d81cdd180b16bf3a9d3b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/15/2019
ms.locfileid: "1554026"
---
# <a name="generate-printable-fti-forms"></a>印刷可能な FTI フォームを生成する

[!include[banner](../includes/banner.md)]

電子レポート (ER) フレームワークにより、印刷可能な自由書式の請求書 (FTI) フォームを Microsoft Office ドキュメントとして生成することができます。 このトピックでは、使用可能なコンフィギュレーション テンプレートと共に、独自のコンフィギュレーションを構築する方法について説明します。

## <a name="overview"></a>概要

Microsoft SQL Server Reporting Services (SSRS) を使用して印刷可能な FTI フォームを生成する既存の機能に加えて、ER フレームワークを使用することができるようになりました。 Microsoft Office Excel および Word で印刷可能な FTI フォームを管理することができます。 また、コードを変更せずにレイアウト、データ フロー、および形式を特定の要件に合わせて変更することもできます。

> [!NOTE]
> 印刷可能な FTI フォーム ソリューションのサンプル用の既存の ER コンフィギュレーションの概要から開始する場合、このトピックで後述する**印刷可能な FTI フォームを生成するための ER コンフィギュレーションのサンプルをダウンロード**のセクションに直接移動します。

## <a name="create-customized-configurations-for-fti-printable-forms"></a>FTI 印刷可能フォームのカスタマイズされたコンフィギュレーションの作成
印刷可能な FTI フォームのカスタマイズされたソリューションの一部として、ER コンフィギュレーションのセットを作成する必要があります。

### <a name="configure-the-er-data-model"></a>ER データ モデルのコンフィギュレーション
アプリケーションには、顧客請求ビジネス ドメインを説明するデータ モデルを含む ER データ モデルのコンフィギュレーションを含める必要があります。 要件として、データ モデルの名前は **CustomersInvoicing** である必要があります。 ER データ モデルを設計する方法の詳細については、[電子申告 (ER) 用にドメイン固有のデータ モデルを設計](tasks/er-design-domain-specific-data-model-2016-11.md)を参照してください。

### <a name="configure-the-er-model-mapping"></a>ER データ マッピングのコンフィギュレーション
アプリケーションには、CustomersInvoicing データ モデルの ER モデル マッピングを含める必要があります。 モデル マッピングは、ER データ モデル コンフィギュレーションまたは ER モデル マッピング コンフィギュレーションのいずれかにすることができます。 ただし、モデル マッピングのルート記述子の名前は **FreeTextInvoice** である必要があります。

マッピングには、次のデータ ソースを含める必要があります。

- データ ソース タイプ: **テーブル レコード**

    - このデータ ソースには **CustInvoiceJour** という名前を付ける必要があります。
    - CustInvoiceJour アプリケーション テーブルを参照する必要があります。
    - 印刷のために選択されている請求書の一覧をアプリケーションから ER モデル マッピングに渡すため、実行時に使用されます。

- データ ソース タイプ: **オブジェクト**

    - このデータ ソースには **PrintMgmtPrintSettingDetail** という名前を付ける必要があります。
    - **PrintMgmtPrintSettingDetail** アプリケーション クラスを参照する必要があります。
    - 実行している ER 形式のための印刷管理設定の詳細をアプリケーションから ER モデル マッピングに渡すため、実行時に使用されます。

ER フレームワークとのアプリケーション統合の詳細については、アプリケーションのソース コードの**ERPrintMgmtReportFormatSubscriber** クラス (ER アプリケーション スイート統合モデル) を参照してください。

ER モデル マッピングの設計に関する詳細については、[モデル マッピングの定義および電子申告 (ER) のデータ ソースの選択](tasks/er-define-model-mapping-select-data-sources-2016-11.md) を参照してください。

### <a name="configure-the-er-format"></a>ER 形式のコンフィギュレーション
アプリケーション インスタンスには、FTI フォームを生成するために使用される ER 形式のコンフィギュレーションが必要です。 

> [!NOTE]
> この形式のコンフィギュレーションは CustomersInvoicing データ モデル用に作成され、**FreeTextInvoice** ルート記述子があるモデル マッピングを使用する必要があります。

ER 形式をコンフィギュレーションする方法の詳細については、[電子申告 (ER) 用の形式のコンフィギュレーションの作成](tasks/er-format-configuration-2016-11.md) を参照してください。 OpenXML 形式でレポートを生成するために ER 形式を設計する方法の詳細については、[電子申告 (ER) 用に OpenXML 形式でレポートを生成するためのコンフィギュレーションの設計](tasks/er-design-reports-openxml-2016-11.md) を参照してください。

## <a name="configure-print-management"></a>印刷管理のコンフィギュレーション
ER フレームワークを使用して FTI フォームを生成するために、SSRS レポートを割り当てる場合と同じ方法で ER 形式を割り当てることができます。 ER 形式とすべての売掛金勘定 FTI を関連付けるには、**売掛金勘定** \> **設定** \> **フォーム** \> **フォームの設定** \> **一般** \> **印刷管理** \> **自由書式の請求書** \> **オリジナル**に移動します。 ER 形式と特定の顧客または請求書を関連付けるには、次の手順に従います。

1. **売掛金勘定** \> **請求書** \> **すべての自由書式の請求書**に移動します。
2. ER 形式を関連付ける FTI を選択し、**印刷管理設定**ページを開きます。
3. 処理する請求書のスコープを指定するドキュメント レベルを選択します。
4. 指定されたドキュメント レベルの ER 形式を選択します。

![印刷管理設定](media/FTIbyGER-PMSetting.png)

> [!NOTE]
> **CustomersInvoicing** データ モデルの **FreeTextInvoice** ルート記述子を使用している ER 形式のみが、選択された形式の**レポート形式の検索**フィールドに表示されます。

## <a name="generate-fti-forms"></a>FTI フォームの生成
FTI フォームは、SSRS レポートが生成される場合と同じ方法で ER フレームワークに生成されます。

FTI フォームを生成するために、範囲または選択のいずれかによって請求書を選択できます。 

![請求書の選択](media/FTIbyGER-InvoiceSelection.png)

![請求書の確認](media/FTIbyGER-InvoiceExcelPreview.png)

この方法で FTI フォームを印刷するために ER 形式を使用する場合、既定の ER ファイル出力先が使用されます。 出力先は変更できません。 ER 形式の ER 出力先をコンフィギュレーションする方法の詳細については、[電子申告の出力先](electronic-reporting-destinations.md) を参照してください。

**請求書の印刷**を有効にし、また**印刷管理の出力先の使用**を無効にすることによって、FTI の転記時に FTI フォームを生成することもできます。

> [!NOTE]
> この方法で FTI フォームを印刷するために ER 形式を使用する場合、既定の ER ファイル出力先が使用されます。 出力先が既にコンフィギュレーションされている場合、実行時に既定の出力先を変更できます。 出力先を変更するには、次のセキュリティ権限が必要です。
>
> - **名前:** ERFormatDestinationRuntimeMaintain
> - **ラベル:** 実行時に電子申告形式の出力先を管理

![電子申告の送信先](media/FTIbyGER-ERFileDestinationSetting.png)

![電子申告形式の出力先](media/FTIbyGER-ERFileDestinationUsage.png)

ER フレームワークは現在、生成されたドキュメントのために次の出力先をサポートしています。

- **ダウンロードしたファイル** – 生成されたフォームは、ブラウザーを使用して保存することができるダウンロードとして提供されます。
- **画面** – 生成された FTI フォームを Excel 形式でプレビューするために、Microsoft Office 365 Excel が使用されます。
- **SharePoint フォルダー** – 生成されたフォームはドキュメント管理フレームワークの設定に基づいて保管されます。
- **アプリケーション アーカイブ** – 生成されたフォームは、Microsoft Azure ストレージ内の実行ログ レコードの添付ファイルとして保管されます。
- **電子メール** – 生成されたフォームは電子メールの添付ファイルとして送信されます。

> [!NOTE]
> 現在、Dynamics プリンター回覧エージェントを使用する直接印刷はサポートされていないため、プリンターに直接生成された FTI フォームを送信することはできません。

## <a name="download-sample-er-configurations-to-generate-printable-fti-forms"></a>印刷可能な FTI フォームを生成するためのサンプル ER コンフィギュレーションのダウンロード
サンプル ER コンフィギュレーションをダウンロードし、FTI ソリューションのテンプレートとして使用できます。 コンフィギュレーションは、Microsoft Dynamics Lifecycle Services (LCS) の共有アセット ライブラリに保管されます。 コンフィギュレーションには次のものが含まれます。

- **顧客請求モデル** コンフィギュレーションには、必要なデータ モデルとモデル マッピングが含まれています。
- **顧客 FTI レポート (GER)** コンフィギュレーションには、サンプルの形式が含まれています。

> [!NOTE]
> これらのコンフィギュレーションは、すべての可能なシナリオを明確にするのに役立つサンプルとして作成されました。 これらの構成の今後は、この評価と受け取るすべてのフィードバックの結果によって決まります。

### <a name="features-that-are-implemented-in-the-sample-er-format"></a>サンプル ER 形式に実装されている機能
サンプル ER 形式のコンフィギュレーションでは、FTI フォームを生成するためのテンプレートとして Excel ファイルが使用されています。

![形式デザイナー](media/FTIbyGER-ERFormat.png)

現在、このサンプル ER 形式では、FTI フォームを生成するために次の機能がサポートされています。

- FTI フォームは、転記された元の請求書およびまだ転記されていない元の請求書の両方に対して生成されます。 修正済請求書および訂正票はサポートされていません。
- FTI フォームは、請求書の言語で生成されます。 生成されたフォーム内の値および日付の形式は、ユーザーのクライアント ロケールの設定に基づきます。
- 処理された請求書に明細行が含まれていない場合、生成される請求書にはデータ使用不可能の通知が表示されます。
- 生成される請求書のヘッダーは、**売掛金勘定パラメーター** ページ上で FTI フォームに対して選択されている用紙の書式に基づきます。 会社の詳細は、用紙の書式が空白の場合のみ、生成される請求書フォームのヘッダーに表示されます。
- 生成される請求書フォームには、**売掛金勘定パラメーター** ページ上で適切なオプションが FTI フォームに対して選択されている場合、会社および顧客の課税控除番号が表示されます。
- 生成される請求書の明細行および請求書の合計セクションでは、請求書登録通貨に既定の請求書金額の詳細を表示します。
- 生成される請求書の合計セクションには、**売掛金勘定パラメーター** ページ上で**ユーロを表す通貨で金額を印刷**オプションが有効になっている場合、ユーロ通貨と請求書登録通貨で金額の詳細を表示することができます。
- 生成される請求書フォームには、**売掛金勘定パラメーター** ページ上の設定に基づいて、利用可能なすべての処理請求書の注記が表示されます。 注記は請求書全体と各請求明細行の両方に含められます。
- AR フォームの注記の一覧でコンフィギュレーションされている場合、生成される請求書フォームには顧客 FTI フォームおよび処理中の請求書の言語に対する注記が含められます。
- 印刷管理の設定に応じて、請求書の言語、ER 形式、および FTI ドキュメント スコープに対してコンフィギュレーションされている場合、生成される請求書にはカスタム フッター テキストが含められます。
- 生成される請求書フォームの合計セクションには、利用可能なすべての現金割引情報が含められます。
- 生成される請求書フォームの支払スケジュールのセクションには、利用可能なすべての支払スケジュールの詳細が含まれます。
- 生成される請求書フォームの利幅セクションには、利用可能なすべての任意の雑費トランザクションが含まれます。
- **売掛金勘定パラメーター** ページ上の**売上税の仕様**の設定に基づいて、生成される請求書フォームには売上税の詳細が含められます。 このセクションでは、請求書登録通貨でのみ表示するか、または請求書登録通貨および会社の会計通貨で同時に表示するか、いずれかの方法で税の詳細が表示されます。
- 生成される請求書フォームには、口座引落通知の詳細が表示されます。 たとえば、請求書に対して必須の口座引落の委任状 ID を持つ支払方法が選択された場合、請求書の処理がユーロ通貨で登録された場合、および口座引落の委任状 ID が請求書に対して定義された場合に表示されます。
- 生成される請求書には、転記された請求書に対して使用可能であるすべての前払の詳細が表示されます。
- 生成される請求書フォームは、電子メールの添付ファイルとして請求書の顧客に送信できます。 適切な ER ファイルの出力先は、使用されている ER 形式に対してコンフィギュレーションする必要があります。

### <a name="countryregion-specific-features"></a>国/地域固有の機能 
次の国/地域に固有の機能は、固有の要件が ER コンフィギュレーションでどのように処理されるかを示すために、サンプル ER 形式に含められています。

#### <a name="norway"></a>ノルウェー
エンタープライズ レジスターの条件は、請求書が次のようにコンフィギュレーションされている法人に対して処理される場合、生成される請求書フォームのヘッダーに配置されます。

- ノルウェー用の国/地域コンテキストが使用されます。
- **Foretaksregisteret の印刷**パラメータが販売ドキュメントで有効です。

#### <a name="spain"></a>スペイン
**現金勘定方法の特別な制度**の条件は、請求書が次のようにコンフィギュレーションされている法人に対して処理される場合、生成される請求書フォームのヘッダーに配置されます。

- スペイン用の国/地域コンテキストが使用されます。
- 現金勘定方法の特別な制度は請求書の処理日に有効です。

現金割引金額および請求明細行の正味金額など、現金割引の詳細が利用可能な場合、次のようにコンフィギュレーションされている法人に対して処理される時、生成される請求書フォームの請求合計のセクションに表示されます。

- スペイン用の国/地域コンテキストが使用されます。
- 請求書のオプション (**一般会計パラメーター** \> **消費税セクション**) で、**請求書に現金割引を適用**が有効になっています。

#### <a name="italy"></a>イタリア
商品割引マークは、イタリア用の国/地域コンテキストを使用してコンフィギュレーションされている法人に対して処理される場合、生成される請求書の請求明細行に含められます。

#### <a name="finland"></a>フィンランド
生成される請求書フォームに加えて、次のように振替送金伝票を生成できます。

- フィンランド用の国/地域コンテキストを使用しており、**振替口座**および**銀行のバーコード**としてマークされている銀行口座を少なくとも 1 つ所有している法人に対して。 
- **フィンランド**の関連する支払添付書類に対して必要であるとマークされている請求書に対して。

![振替伝票](media/FTIbyGER-GiroSlip.PNG)

> [!NOTE]
> サンプル ER 形式は、必要に応じて別のワークシートに振替送金伝票を生成するようにコンフィギュレーションされています。

> [!NOTE]
> Excel 形式で生成される請求書フォームをプレビューするローカル コンピューター上でバーコードを生成するために使用するフォントを、まずインストールする必要があります。

### <a name="use-the-sample-er-format-to-configure-email-destinations"></a>サンプル ER 形式を使用した電子メール送信先のコンフィギュレーション
サンプル ER 形式の次の要素を使用した電子メール送信先のコンフィギュレーション:

- 顧客の連絡先の電子メール アドレスは、次の ER 式からアクセスできます: **model.InvoiceBase.Contact.ElectronicMail**。
- 電子メールの件名のテキストは、次の ER 式からアクセスできます: **Emailing.TxtToUse.Subject**。
- 電子メールの本文のテキストは、次の ER 式からアクセスできます: **Emailing.TxtToUse.Body**。

![宛先設定](media/FTIbyGER-ERFileDestinationSettingEmail.png)

電子メールの件名と本文の既定のテキストは、サンプル ER 形式で定義されています。 言語は形式のラベルによって異なります。 事前定義された **ERFTITMP** ID を持つ組織電子メールのカスタム テンプレートが追加されていない場合、既定のテキストが電子メールに使用されます。

> [!NOTE]
> **ERFTITMP** 電子メール テンプレート ID がサンプル ER 形式で定義されています。 必要に応じて、このサンプル形式から作成される新しい ER 形式で変更することができます。

事前定義された **ERFTITMP** ID を持つ組織の電子メールが、請求書を処理する法人に対して追加されている場合、電子メールの件名および本文のテキストのテンプレートが電子メールを生成するために使用されます。 

![組織の電子メール テンプレート](media/FTIbyGER-EmailTemplate.png)

![電子メール テンプレートのアップロード](media/FTIbyGER-EmailTemplateBody.png)

サンプル ER 形式の ER 式 **Emailing.TxtToUse.Subject** は、すべてのプレースホルダー %1 を請求書処理 ID によって置換するようコンフィギュレーションされています。

サンプル形式の **Emailing.TxtToUse.Body** 式は、プレースホルダーに対して次の代用のためにコンフィギュレーションされています。

- 「%1」は顧客の連絡担当者の名前に置き換えられます。
- 「%2」は会社名に置き換えられます。
- 「%3」は顧客名に置き換えられます。
- 「%4」は会社の連絡担当者の名前に置き換えられます。
- 「%5」は会社の連絡担当者の肩書きに置き換えられます。
- 「%6」は会社の連絡担当者の電子メール アドレスに置き換えられます。

![電子メール](media/FTIbyGER-Email.PNG)

## <a name="additional-resources"></a>その他のリソース
[電子申告の概要](general-electronic-reporting.md)
