--- 
title: "CSV 形式 (ER) の外部ファイルからデータをインポートするためのコンフィギュレーションを設計する"
description: "この手順を使用して、外部ファイルから CSV 形式から Dynamics 365 for Finance and Operations アプリにデータをインポートする電子申告 (ER) 構成を設計します。"
author: NickSelin
manager: AnnBe
ms.date: 12/12/2017
ms.topic: business-process
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
audience: Application User
ms.reviewer: kfend
ms.search.scope: Operations
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.translationtype: HT
ms.sourcegitcommit: a0739304723d19b910388893d08e8c36a1f49d13
ms.openlocfilehash: f6bfa9f7c0638b0eaacf1a49bcd7d84ffab3acbf
ms.contentlocale: ja-jp
ms.lasthandoff: 03/26/2018

---
# <a name="design-a-configuration-to-import-data-from-an-external-file-in-csv-format-er"></a>CSV 形式 (ER) の外部ファイルからデータをインポートするためのコンフィギュレーションを設計する

[!INCLUDE [task guide banner](../../includes/task-guide-banner.md)]

この手順を使用して、外部ファイルから CSV 形式から Dynamics 365 for Finance and Operations アプリにデータをインポートする電子申告 (ER) 構成を設計します。 この手順では、サンプル会社 Litware, Inc. 用に、必要な ER コンフィギュレーションを作成します。これらのステップを完了するには、まず手順「ER コンフィギュレーション プロバイダーの作成および有効なプロバイダーとしてのマーク付け」にあるステップを完了する必要があります。 

この手順は、「システム管理者」または「電子レポート開発者」ロールが割り当てられているユーザー用に作成されています。 これらのステップは、USMF データ セットを使用して完了することができます。 

ローカルで、以下のファイルをダウンロードして保存する必要もあります: (https://go.microsoft.com/fwlink/?linkid=862266): 1099model.xml、1099formatcsv.xml、1099entriescsv.csv。

1. [組織管理] > [ワークスペース] > [電子申告] の順に移動します。
    * Dynamics 365 for Finance and Operations アプリケーションのテーブルに、XML、TXT、または CSV 形式の外部ファイルをインポートするプロセスを構成できます。 まず、ビジネス観点から、インポートされたデータを表す抽象データ モデルを作成する必要があります: ER データ モデルの構成が作成されます。 次に、ファイルから抽象データ モデルにデータをポートする方法として、設計されたデータ モデルにマップするインポートされたファイルの構造を定義します: ER 形式の構成が作成されます。 次に、インポートされたファイルのデータと保持されている抽象データ モデルを使用してアプリケーション テーブルまたはデータ エンティティーを更新する方法を記述する、新しいモデル マッピングを使用し、ER データ モデル構成を拡張する必要があります。  
    * 以下の手順では、後で仕入先の 1099 フォームの決済に使用するために、外部 CSV ファイルから外部で追跡された仕入先の取引をどのようにインポートするかを示します。   
    * サンプル会社 Litware, Inc. のコンフィギュレーション プロバイダーが使用可能であり、アクティブとしてマークされていることを確認します。 このコンフィギュレーション プロバイダーが表示されない場合は、「コンフィギュレーション プロバイダーの作成および有効なプロバイダーとしてのマーク付け」という手順のステップを完了する必要があります。  
2. [コンフィギュレーションをレポートする] をクリックします。
3. [1099 Payments model] フィルタを適用します。 手順「電子申告のために外部ファイルからデータをインポートするために必要な構成を作成する ER」を既に完了しており、 [1099 Payments model] 構成を構成ツリーで利用できる場合、次の下位タスクのすべての手順をスキップしてください 。   

## <a name="add-a-new-er-model-configuration"></a>新しい ER モデル コンフィギュレーションの追加
1. データのインポートをサポートする新しいモデルを作成する代わりに、既にダウンロードしてある 1099model.xml ファイルをロードします。 このファイルには、仕入先のトランザクションのカスタム データ モデルが含まれています。 このデータ モデルは、必要なデータ コンポーネントに既にマップされています。  
2. [交換] をクリックします。
3. [XML ファイルから読み込む] をクリックします。
4. [参照] をクリックし、以前ダウンロードした 1099model.xml ファイルに移動します。  
5. [OK] をクリックします。

## <a name="add-a-new-er-format-configuration-that-supports-data-import"></a>データのインポートをサポートする新しい ER 書式のコンフィギュレーションの追加
1. ツリーで、[1099 Payments model] を選択します。
2. [コンフィギュレーションの作成] をクリックすると、ドロップ ダイアログが開きます。
3. [新規] フィールドで、「1099 Payments model のデータ モデルに基づいた書式」と入力します。
4. [データのインポートのサポート] フィールドで [はい] を選択します。
5. ESC キーを押してこのページを閉じます。
    * データのインポートをサポートするために、新しい ER 書式を作成する代わりに既にダウンロードしてあるファイル 1099formatcsv.xml をロードします。 このファイルには、受信する CSV ファイルの構造と仕入先の取引のデータ モデルに対する構造のマッピングを定義する、必要な ER 書式が含まれています。   
6. [交換] をクリックします。
7. [XML ファイルから読み込む] をクリックします。
    * [参照] をクリックし、以前ダウンロードした 1099formatcsv.xml ファイルに移動します。  
8. [OK] をクリックします。
9. ツリーで、[1099 Payments model] を展開します。
10. ツリーで、[1099 Payments model\For importing vendors' transactions (CSV)] を選択します。

## <a name="review-format-settings"></a>書式設定の確認
1. [デザイナー] をクリックします。
2. [展開] / [折りたたみ] をクリックします。
3. [詳細の表示] をオンに切り替えます。
    * 設計された形式は、CSV 形式の外部ファイルの予想構造を表します。  
4. ツリーで、[受取: ファイル\ルート: 順番] を選択します。
    * 順番タイプのルート要素の場合、「特殊文字」フィールドで「New line - Windows (CR LF)」オプションが選択されています。 この設定に基づいて、解析ファイル内の各明細行を別々のレコードとみなす必要があります。   
5. ツリーで、[受取: ファイル\ルート: 順番\行: 順番 1..*] を選択します。
    * 順番タイプのルート\明細行要素の場合、[多様性] フィールドで 「1 つ、多数」が選択されています。 この設定に基づいて、解析ファイルに少なくとも 1 つの明細行が表示されます。   
6. ツリーで、[受取: ファイル\ルート: 順番\行: 順番 1..* \タイプ: ケース] を選択します。
    * CASE タイプのルート\明細行\タイプ要素は、ルート\明細行順序の入れ子になった要素として追加されていることに注意してください。 この CASE 要素には 3 つの入れ子になった順序要素が含まれているため、この設定では解析ファイルで 3 種類の明細行を満たすと想定しています。   
7. ツリーで、[受取: ファイル\ルート: 順番\行: 順番 1..* \タイプ: ケース\ヘッダー: 順番 1..1 ] を選択します。
    * 順番タイプのルート\明細行\タイプ\ヘッダー要素には、固定された文字列値として定義されている値の、入れ子になった文字列要素が含まれています。 この順序は、解析ファイルのヘッダー行を解析します。   
8. ツリーで、[受取: ファイル\ルート: 順番\行: 順番 1..* \タイプ: ケース\レコード: 順番 1..1 (,)] を選択します。
    * 順番タイプのルート\明細行\タイプ\レコード要素は、トランザクション明細行を解析するように構成されています。 「区切り記号」文字オプションがコンマとして設定されていることに注意してください。 つまり、解析ファイル内のこの明細行のタイプでは、フィールド区切り記号としてコンマが使用されることを意味します。   
    * 分割されたフィールドとしてトランザクションの明細行を解析するために、異なるデータ タイプの複数の入れ子になった要素が、ルート\明細行\タイプ\レコード要素に追加されていることに注意してください。 「見積申請」のオプションが [なし] として構成されていることに注意してください。 つまり、解析ファイルでは、このタイプのすべてのフィールドには囲まれた文字が含まれていないと見なされます。   
9. Iツリーで、[受取: ファイル\ルート: 順番\行: 順番 1..* \タイプ: ケース\レコード: 順番 1..1 (,)\TransactionDate: 日時] を選択します。
    * たとえば、DATETIME タイプのルート\明細行\タイプ\レコード\TransactionDate 要素は、トランザクションの日付、および時間の値を M/d/yyyy の形式で解析ファイルから取得するように構成されています。   
10. ツリーで、[受取: ファイル\ルート: 順番\行: 順番 1..* \タイプ: ケース\レコード: 順番 1..1 (,)\CountryCode: 文字列 0..1 ] を選択します。
    * 文字列タイプのルート\明細行\タイプ\レコード\CountryCode 要素は、[多様性] フィールドで「ゼロ、1 つ」オプションとして構成されることに注意してください。 この設定では、オプションとして解析明細行で CountryCode フィールドの値が考慮されます。   
11. Iツリーで、[受取: ファイル\ルート: 順番\行: 順序 1..* \タイプ: ケース\レコード: 順序 1..1 (,)\注釈: 順番 1..1 (,)] を選択します。
    * 順番タイプのルート\明細行\タイプ\レコード\注釈要素は、[見積申請] のフィールドに 「すべて」オプション、および [見積マーク] フィールドに二重引用符文字があるように構成されています。 これは、解析ファイル内のこのタイプの行のすべてのフィールド (入れ子になった要素によって説明: 文字列型のテキスト) は二重引用符で囲まれているとみなされることを意味します。  
12. ツリーで、[受取: ファイル\ルート: 順番\行: 順番 1..* \タイプ: ケース\未解析: 順番 1..1 ] を選択します。
    * 順番タイプのルート\明細行\タイプ\の解析されていない要素は、上記の親 CASE 要素で説明された構造と一致しない構造のトランザクション明細行を解析するために構成されています。   

## <a name="review-the-setting-of-the-format-mapping-to-the-data-model"></a>データ モデルに対する書式マッピングの設定の確認
1. [形式をモデルにマップ] をクリックします。
    * モデル マッピング「CSV 形式からのモデルへのマッピング」は、着信する CSV ファイルからデータ モデルへのデータ転送のデータ フローを記述します。   
2. [デザイナー] をクリックします。
3. ツリーで、「形式」を展開します。
    * 設計された形式が、ここではデータ ソース コンポーネントとして示されていることに注意してください。  
4. ツリーで、[形式\収入: ファイル (収入)] を展開します。
5. ツリーで、[形式\受取: ファイル (受取)\ルート: 順番 (ルート)] を展開します。
6. ツリーで、[形式\受取: ファイル (受取)\ルート: 順序 (ルート)\行: 順番 1..* (行)] を展開します。
7. ツリーで、[形式\受取: ファイル (受取)\ルート: 順番 (ルート)\行: 順番 1..* (行)\タイプ: ケース (タイプ)] を展開します。
8. ツリーで、[形式\受取: ファイル (受取)\ルート: 順番 (ルート)\行: 順番 1..* (行)\タイプ: ケース (タイプ)\レコード: 順番 1..1 (,)(レコード)] を展開します。
9. ツリーで、[形式\受取: ファイル (受取)\ルート: 順番 (ルート)\行: 順番 1..* (行)\タイプ: ケース (タイプ)\レコード: 順番 1..1 (,)(レコード)\データ] を展開します。
10. ツリーで、[形式\受取: ファイル (受取)\ルート: 順番 (ルート)\行: 順番 1..* (行)\タイプ: ケース (タイプ)\レコード: 順番 1..1 (,)(レコード)\データ\CountryCode: 文字列 0..1 (CountryCode)] を展開します。
11. ツリーで、[形式\受取: ファイル (受取)\ルート: 順番 (ルート)\行: 順番 1..* (行)\タイプ: ケース (タイプ)\レコード: 順番 1..1 (,)(レコード)\データ\TransactionDate: 日時 (TransactionDate)] を選択します。
    * TransactionDate や CountryCode などの必須およびオプションの書式要素は、定義済みの「書式」データ ソース コンポーネントの外観が異なることに注意してください。   
12. ツリーで、[トランザクション = $both''] を展開します。
    * インポート ファイルの構造を定義する書式の要素が、データ モデルの要素にバインドされることに注意してください。 これらのバインドに基づき、インポートされた CSV ファイルの内容は、実行時に既存のデータ モデル内に格納されます。 CountryRegion 要素のバインディングに注意してください。 国コード値が指定されていない受信ファイル内のトランザクション要素の場合、デフォルトの国コードである「USA」がデータモデルに自動入力されます。   
13. [詳細の表示] に切り替えます。
14. [検証] タブをクリックします。
15. [検索] をクリックします。
16. [検索] フィールドに、「仕入先」を入力します。
17. [次を検索] をクリックします。
    * この書式マッピングには、ビジネス観点からインポートされたデータの正確性を検証する、ユーザー定義のロジックが含まれる場合があります。 たとえば、設定に基づいて、構造がヘッダー行およびトランザクション行の構造と一致しないインポート ファイル内の明細行については、このケースについてユーザーに通知する警告メッセージが情報ログで生成され、ファイル内のトランザクションの順序番号が表示されます。   
18. ページを閉じます。

## <a name="run-the-format-mapping"></a>形式マッピングの実行
テストのために、以前にダウンロードした 1099entriescsv.csv ファイルを使用して形式マッピングを実行します。 生成された出力は選択された CSV ファイルからインポートされ、実際のインポート時にカスタム データ モデルに読み込まれるデータが表示されます。   
1. [実行] をクリックします。
    * [参照] をクリックし、以前ダウンロードした 1099entriescsv.csv ファイルに移動します。  
2. [OK] をクリックします。
    * 受けつけられない明細行に関する警告メッセージに注意してください。 7 行目に二重引用符でトランザクション コメント テキストが含まれていないときに、4 行目には許容されない形式で表示される収入値が含まれます。   
    * 選択ファイルからインポートされてデータ モデルにポートされたデータを表すXML 書式の出力を確認します。 インポートされた CSV ファイルのすべての 7 つの行が処理されたことに注意してください。 フィールドのタイトル行 1 はスキップされ、4 つのトランザクションは正しく解析され、2 つのトランザクションは無効であると認識されました。   
3. ページを閉じます。
4. ページを閉じます。


