--- 
title: "電子申告 (ER) 用に必要なコンフィギュレーションを作成して外部ファイルからデータをインポートする"
description: "次の手順では、「システム管理者」または「電子申告開発者」ロールのユーザーが、電子申告 (ER) コンフィギュレーションを設計して、外部ファイルから Dynamics 365 for Finance and Operations, Enterprise Edition アプリケーションにデータをインポートする方法を説明します。"
author: NickSelin
manager: AnnBe
ms.date: 02/22/2017
ms.topic: business-process
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
audience: Application User
ms.reviewer: kfend
ms.search.scope: Operations
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: AX 7.0.0
ms.translationtype: HT
ms.sourcegitcommit: 7e0a5d044133b917a3eb9386773205218e5c1b40
ms.openlocfilehash: c0d9636fe8a8d5230859da8fe557fe11a9513ba0
ms.contentlocale: ja-jp
ms.lasthandoff: 09/29/2017

---
# <a name="create-required-configurations-to-import-data-from-an-external-file-for-electronic-reporting-er"></a>電子申告 (ER) 用に必要なコンフィギュレーションを作成して外部ファイルからデータをインポートする

[!include[task guide banner](../../includes/task-guide-banner.md)]

次の手順では、「システム管理者」または「電子申告開発者」ロールのユーザーが、電子申告 (ER) コンフィギュレーションを設計して、外部ファイルから Dynamics 365 for Finance and Operations, Enterprise Edition アプリケーションにデータをインポートする方法を説明します。 この例では、サンプル会社 Litware, Inc. 用に、必要な ER コンフィギュレーションを作成します。これらのステップを完了するには、まずタスク ガイド「ER コンフィギュレーション プロバイダーの作成および有効なプロバイダーとしてのマーク付け」にあるステップを完了する必要があります。 これらのステップは、USMF データ セットを使用して完了することができます。 また、電子レポートの概要トピックからのリンク (https://go.microsoft.com/fwlink/?linkid=852550) を使用して、1099model.xml、1099format.xml、1099entries.xml、1099entries.xlsx のファイルをローカルにダウンロードして保存する必要があります。

    * ER は、ビジネス ユーザーに対し、Dynamics 365 for Finance and Operations, Enterprise Edition 内のテーブルに外部データ ファイルを、.XML または .TXT 形式でインポートするプロセスを構成するための機能を提供します。 最初に、インポートするデータを表す、抽象データ モデルと ER データ モデルのコンフィギュレーションを設計する必要があります。 次に、インポートするファイルの構造を定義、およびデータをファイルから抽象データ モデルにポートするために使用する方法を定義する必要があります。 その抽象データ モデルのために、設計されたデータ モデルに配置される ER 形式のコンフィギュレーションを作成する必要があります。 次に、インポート データが抽象データ モデル データとして存在する方法、および Dynamics 365 for Finance and Operations, Enterprise Edition 内のテーブルを更新するための使用方法を説明するマッピングで、データ モデルのコンフィギュレーションを拡張する必要があります。  ER データ モデルのコンフィギュレーションには、アプリケーションの送信先に対するデータ モデルのバインディングを説明する、新しいモデル マッピングを追加する必要があります。  
    * 次のシナリオでは、ER データのインポート機能を示します。 これには、外部で追跡されてから、Dynamics 365 for Finance and Operations, Enterprise Edition にインポートされ、1099 の仕入先の決済で後から報告される、仕入先トランザクションが含まれます。   

## <a name="add-a-new-er-model-configuration"></a>新しい ER モデル コンフィギュレーションの追加
1. [組織管理] > [ワークスペース] > [電子申告] の順に移動します。
    * サンプル会社 'Litware, Inc.' のコンフィギュレーション プロバイダーが 使用可能であり、アクティブとしてマークされていることを確認します。 このコンフィギュレーション プロバイダーが表示されない場合は、「コンフィギュレーション プロバイダーの作成および有効なプロバイダーとしてのマーク付け」という手順のステップを完了する必要があります。   
2. [コンフィギュレーションをレポートする] をクリックします。
    * データのインポートをサポートするために新しいモデルを作成する代わりに、既にダウンロードしてあるファイル 1099model.xml をロードします。 このファイルには、仕入先のトランザクションのカスタム データ モデルが含まれています。 このデータ モデルは、AOT データ エンティティ内にある Dynamics 365 for Finance and Operations, Enterprise Edition のデータ コンポーネントにマッピングされます。   
3. [交換] をクリックします。
4. [XML ファイルから読み込む] をクリックします。
    * [参照] をクリックし、以前ダウンロードした 1099model.xml ファイルに移動します。  
5. [OK] をクリックします。
6. ツリーで、[1099 Payments model] を選択します。

## <a name="review-data-model-settings"></a>データ モデルの設定の確認
1. [デザイナー] をクリックします。
    * このモデルは、ビジネスの観点から仕入先のトランザクションを表すために設計されたもので、Dynamics 365 for Finance and Operations, Enterprise Edition 内の実装とは異なります。   
2. ツリーで、[1099-MISC] を展開します。
3. ツリーで、[1099-MISC\Transactions] を選択します。
4. ツリーで、[1099-MISC\Transactions] を展開します。
    * このモデルのトランザクションの要素は、個々のトランザクションを表します。 子要素は、トランザクションごとに、仕入先の口座およびトランザクションの日付などの必須情報を指定するために使用します。   
5. ページを閉じます。

## <a name="add-a-new-er-format-configuration-that-supports-data-import"></a>データのインポートをサポートする新しい ER 書式のコンフィギュレーションの追加
    * このサブタスクの手順は、外部ファイルからのデータ インポートを管理するために、書式コンフィギュレーションを新規作成する方法を示します。   
1. [コンフィギュレーションの作成] をクリックすると、ドロップ ダイアログが開きます。
2. [新規] フィールドで、「1099 Payments model のデータ モデルに基づいた書式」と入力します。
3. [データのインポートのサポート] フィールドで [はい] を選択します。
4. ESC キーを押してこのページを閉じます。
    * データのインポートをサポートするために新しい書式を作成する代わりに、既にダウンロードしてあるファイル 1099format.xml をロードします。 このファイルには、インポートするファイルの定義された構造と、仕入先のトランザクションのカスタム データ モデルに対する構造のマッピングが含まれています。   
5. [交換] をクリックします。
6. [XML ファイルから読み込む] をクリックします。
    * [参照] をクリックし、以前ダウンロードした 1099format.xml ファイルに移動します。  
7. [OK] をクリックします。
8. ツリーで、[1099 Payments model] を展開します。
9. ツリーで、[1099 Payments model\Format for importing vendors' transactions] を選択します。

## <a name="review-format-settings"></a>書式設定の確認
1. [デザイナー] をクリックします。
2. [詳細の表示] をオンに切り替えます。
3. [展開] / [折りたたみ] をクリックします。
4. [展開] / [折りたたみ] をクリックします。
    * 設計された形式は、外部ファイルの予想構造を表します。 このファイルは XML 形式であり、決済のルート要素を含んでいる必要があります。 各仕入先のトランザクションは、ゼロ対多の多様性を持つように定義されているトランザクション要素で表されます。 つまり、受信ファイルが 0 個から複数のトランザクションの範囲を含む可能性があります。 「トランザクション」要素の入れ子要素は、単一トランザクションの属性を表します。 国を除くすべての属性が、必須としてマークされていることに注意してください。これはインポートするファイルに含める必要があることを意味します。   

## <a name="review-the-settings-of-the-format-mapping-to-the-data-model"></a>データ モデルに対する書式マッピングの設定の確認
1. [形式をモデルにマップ] をクリックします。
    * 「仕入れ先のトランザクションのインポート要」マッピングには、受信 XML ファイルからカスタム データ モデルの選択部分へのデータ転送ルールが含まれます。これは 1099-MISC 定義を選択して定義されます。  
2. [デザイナー] をクリックします。
3. [詳細の表示] をオンに切り替えます。
4. ツリーで、[format: Record] を展開します。
5. ツリーで、[format: Record] を選択します。
    * 設計された形式が、ここではデータ ソース コンポーネントとして示されていることに注意してください。  
6. ツリーで、[format: Record\*settlement: XML Element 1..1 (settlement): Record] を展開します。
7. ツリーで、[format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list] を展開します。
8. ツリーで、[format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list\*vendor: XML Element 1..1 (vendor): Record] を展開します。
9. ツリーで、[format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list\country: XML Element 0..1 (country): Record] を展開します。
10. ツリーで、[format: Record\*settlement: XML Element 1..1 (settlement): Record\transaction: XML Element 0..* (transaction): Record list\*vendor: XML Element 1..1 (vendor): Record] を選択します。
    * 必須およびオプションの形式要素の表示が、事前に定義された「書式」データ ソース コンポーネントでは異なることに注意してください。  
11. ツリーで、[Transactions: Record list= format.settlement.'$enumerated'] を展開します。
    * インポート ファイルの構造を定義する書式の要素が、カスタム データ モデルの要素にバインドされることに注意してください。 これらのバインドに基づき、インポートされた XML ファイルの内容は、実行時に既存のデータ モデル内に格納されます。 国要素のバインディングに注意してください。 そのような要素を持たない受信ファイル内のトランザクション要素の場合、デフォルトの国コードである 'USA' がデータ モデルに自動入力されます。  
12. [検証] タブをクリックします。
    * この書式マッピングには、ビジネス観点からインポートされたデータの正確性を検証する、ユーザー定義のロジックが含まれる場合があります。 たとえば、設定に応じて、定義された国コードがないインポート ファイル内のトランザクションの場合、ユーザーに事例を説明してトランザクションの順次番号を示す情報ログに警告メッセージが生成されます。  
13. ページを閉じます。

## <a name="run-the-format-mapping-to-the-data-model"></a>データ モデルに対する書式マッピングの実行
    * テストのため、この書式マッピングを実行します。 以前ダウンロードしたファイル、1099entries.xml を使用します。 このファイルは、仕入先トランザクションを管理するために使用する 1099entries.xlsx ワークブックからエクスポートすることができます。 生成された出力は選択された XML ファイルからインポートされ、実際のインポート時にカスタム データ モデルを設定します。  
1. [実行] をクリックします。
    * [参照] をクリックし、以前ダウンロードした 1099entries.xml ファイルに移動します。  
2. [OK] をクリックします。
    * インポートされたファイルのトランザクションに国コードが無いことに関する警告メッセージに注意してください。  
    * 選択ファイルからインポートされてデータ モデルにポートされたデータを表す出力を、XML 書式で確認します。   
3. ページを閉じます。
4. ページを閉じます。

## <a name="review-the-settings-for-the-model-mapping-to-the-destinations"></a>出力先に対する書式マッピングの設定の確認
1. ツリーで、[1099 Payments model] を選択します。
2. [デザイナー] をクリックします。
3. [モデルからデータ ソースへのマップ] をクリックします。
    * 1099 の手動トランザクション インポート用マッピングは、宛先の方向タイプで定義されました。 つまり、それはデータのインポートをサポートするために入力されており、Dynamics 365 for Finance and Operations, Enterprise Edition アプリケーション内のテーブルを更新するために、どのようにインポートされた外部ファイルおよび抽象データとして存在するモデルデータを使用するかを定義するルールの設定を含んでいます。  
4. [デザイナー] をクリックします。
5. ツリーで、[model: Data model 1099 Payments model] を展開します。
6. ツリーで、[model: Data model 1099 Payments model\Transactions: Record list] を展開します。
    * 設計されたモデルが、ここではデータ ソース要素として示されていることに注意してください。 実行時に、外部ファイルからインポートされたデータが格納されます。 システム内でトランザクションの仕入先口座の入力が可能であるか、国および都道府県コードを入力する組合せ等が存在するかどうかなどを含め、インポート データが現在のアプリケーションのデータに準拠するように、複数のテーブルがデータ ソースとして追加されました。  
7. ツリーで、[model: Data model 1099 Payments model\Transactions: Record list\$failed: Calculated field = IF(OR(ISEMPTY(model.Transactions.'$refs'.vendor), ISEMPTY(model.Transactions.'$refs'.vendor1099), ISEMPTY(model.Transactions.'$refs'.box1099), ISEMPTY(model.Transactions.'$refs'.country), ISEMPTY(model.Transactions.'$refs'.state), ISEMPTY(model.Transactions.'$refs'.location)), true, false): Boolean] を選択します。
8. [編集] をクリックします。
9. [式の編集] をクリックします。
    * 1 つのインポートされたトランザクションに対して少なくとも 1 つの検証に失敗するとき、このトランザクションはデータ ソースの属性 ‘$failed’ により失敗としてマークされます。  
10. ページを閉じます。
11. [キャンセル] をクリックします。
12. ツリーで、[tax1099trans: Table 'VendSettlementTax1099' records= model.Validated] を選択します。
13. [宛先の編集] をクリックします。
    * インポートされたデータでアプリケーション テーブルが更新される方法を指定するため、この ER 宛先が追加されました。 この場合、データ テーブル VendSettlementTax1099 が選択されました。 レコード アクションの挿入が選択されているため、インポートされたトランザクションは VendSettlementTax1099 テーブルに挿入されます。 単一のモデル マッピングに複数の宛先が含まれる場合があることに注意してください。 これは、インポートされたデータが同時に複数のアプリケーションのテーブルを更新するために使用可能であることを意味します。 テーブル、ビュー、およびデータ エンティティは、ER 宛先として使用することができます。   
    * このアクションのために特別に設計された Dynamics 365 for Finance and Operations, Enterprise Edition アプリケーション (ボタンまたはメニュー項目など) 内のポイントからマッピングがコールされる場合、ER の宛先は統合ポイントとしてマークする必要があります。 この例では、ERTableDestination#VendSettlementTax1099 の点です。  
14. [キャンセル] をクリックします。
15. [すべて表示] をクリックします。
16. [マップ済みのものだけを表示] をクリックします。
17. ツリーで、['tax1099trans: Table 'VendSettlementTax1099' records= model.Validated] を展開します。
    * 唯一検証されたトランザクションを含むデータ ソース要素が、作成された宛先にバインドされることに注意してください。 アプリケーションのデータと互換性がないものをスキップするため、インポートされたトランザクションをフィルター処理することができます。  
18. ツリーで、['failed: Table 'VendSettlementTax1099Entity' records= model.Failed] を選択します。
19. [検証] タブをクリックします。
    * このモデル マッピングには、既存のアプリケーション データからインポートされたデータの正確性を検証する、ユーザー定義のロジックが含まれる場合があります。 たとえば、現在の設定に応じて、インポート ファイルのトランザクションにシステム内に無い仕入れ先口座が含まれる場合、ユーザーに通知して、不正確な仕入先の口座コードを示す警告メッセージが生成されます。  
    * [検証後のアクション] オプションを各検証に使用して、インポート処理を継続するか停止するか、既に実行された挿入や更新を保持するかロールバックするか指定することができることに注意してください。  
20. [マップ済みのものだけを表示] をクリックします。
21. [すべて表示] をクリックします。
22. ページを閉じます。
    * このモデル マッピングを実行して、設計された形式およびモデル マッピングをテストします。 1099entries.xml ファイルを使用します。 選択したファイルからのデータはシステムにインポートされます。  
23. [実行] をクリックします。
    * ダイアログ ボックス内に、インポートされたファイルをパースしてからデータをデータ モデルにポートするために使用する、書式マッピングに関する追加質問が含まれていないことに注意してください。 これは、このモデルを使用する書式が現在 1 つのみ存在するためです。これはデータ インポートをサポートするために設計されたとマークされています。  
    * インポートされたトランザクションを、手動で入力済みまたはインポート済みの他のトランザクションと区別するための、伝票 ID を定義します。  
24. [伝票 ID の入力] フィールドで、'IMPORT-001' と入力します。
    * '1099entries.xml' ファイルを参照して取得します。  
25. [OK] をクリックします。
    * 生成された警告の一覧には、不正確な仕入先口座、不正確な税 1099 ボックス コード、不足している国コード等に関する情報が用意されます。この警告の一覧と、実行 XML ファイルに含まれるコンテンツを比較します。  
26. ページを閉じます。
27. ページを閉じます。
28. ページを閉じます。
29. ページを閉じます。
30. [買掛金勘定] > [定期処理のタスク] > [税金 1099] > [1099s の仕入先決済] の順に移動します。
    * このフォームでは、インポートされたトランザクションに基づいて作成された Tax1099Summary テーブルに、累積的なトランザクションを表示します。  
31. [開始日] フィールドで、日付を「2000-01-01」に設定します。
32. [手動 1099 トランザクション] をクリックします。
    * このフォームには、手動で追加されたトランザクションと、直前にインポートされたトランザクションのリストが含まれています。  
33. [伝票列] フィルターを開きます。
34. [次の値で始まる] フィルター演算子を使用して、[伝票] フィールドに "IMPORT-001" を入力します。

## <a name="review-the-relationship-between-model-and-format-mappings"></a>モデルと書式マッピング間の関係の確認
1. ページを閉じます。
2. ページを閉じます。
3. [組織管理] > [ワークスペース] > [電子申告] の順に移動します。
4. [コンフィギュレーションをレポートする] をクリックします。
5. ツリーで、[1099 Payments model] を選択します。
    * 同じデータの .TXT ファイル形式でのインポートをサポートすると仮定します。   
6. [コンフィギュレーションの作成] をクリックすると、ダイアログ ボックスが開きます。 
7. [新規] フィールドで、「1099 Payments model のデータ モデルに基づいた書式」と入力します。
8. [名前] フィールドに、「TXT ファイルからデータをインポート」と入力します。
9. [データのインポートのサポート] フィールドで [はい] を選択します。
10. [コンフィギュレーションの作成] をクリックします。
11. [デザイナー] をクリックします。
12. [形式をモデルにマップ] をクリックします。
13. [新規] をクリックします。
14. [定義] フィールドで値を入力または選択します。
    * [1099-MISC] オプションを選択します。  
15. [名前] フィールドに、「TXT ファイルからデータをインポート」と入力します。
16. [説明] フィールドに、「TXT ファイルからデータをインポート」と入力します。
17. [保存] をクリックします。
18. ページを閉じます。
19. ページを閉じます。
20. [編集] をクリックします。
    * 修正プログラム「KB 4012871 異なるバージョンの Dynamics 365 for Finance and Operations, Enterprise Edition 上で展開するために異なる種類の要件を指定する機能を使用した別個のコンフィギュレーションでの GER モデル マッピングのサポート」 (https://fix.lcs.dynamics.com/Issue/Resolved?kb=4012871) をインストールした場合、入力した形式のコンフィギュレーションのための次のステップ、「[モデル マッピングの既定] フラグをオンにする」を実行します。 それ以外の場合、次のステップをスキップします。  
21. [モデル マッピング] フィールドの既定値で [はい] を選択します。
22. ツリーで、[1099 Payments model] を選択します。
23. [デザイナー] をクリックします。
24. [モデルからデータ ソースへのマップ] をクリックします。
25. [実行] をクリックします。
    * 修正プログラム「KB 4012871 異なるバージョンの Dynamics 365 for Finance and Operations, Enterprise Edition 上で展開するために異なる種類の要件を指定する機能を使用した別個のコンフィギュレーションでの GER モデル マッピングのサポート」 (https://fix.lcs.dynamics.com/Issue/Resolved?kb=4012871) をインストールした場合、ルックアップ フィールドで目的のモデル マッピングを選択します。 修正プログラムをまだインストールしていない場合、マッピングは既定の書式設定の定義で既に選択されているため、次のステップに進みます。  
    * 修正プログラムの KB 4012871 がインストールされていない場合、インポートするファイルをパースするために使用する追加のモデル マッピング質問がダイアログ ボックスに含まれていることに注意してください。 次にデータはダイアログ ボックスからデータ モデルにポートされます。 現時点では、インポートする計画のファイル タイプに応じてどの書式マッピングを使用する必要があるか選択することができます。  
    * アクション用に特別に設計された Dynamics 365 for Finance and Operations, Enterprise Edition 内のポイントからこのモデル マッピングをコールする場合は、ER の出力先および書式マッピングを統合の一部としてマークする必要があります。  
26. [キャンセル] をクリックします。
27. ページを閉じます。
28. ページを閉じます。


