---
title: "サンドボックス データベース更新の要求"
description: "このトピックでは、サンドボックスのユーザー受け入れテスト (UAT) 環境で、Microsoft Dynamics 365 for Finance and Operations のデータベースの更新を要求する方法について説明します。"
author: Robadawy
manager: AnnBe
ms.date: 10/31/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: IT Pro, Developer
ms.reviewer: margoc
ms.search.scope: Operations
ms.custom: 257614
ms.assetid: 558598db-937e-4bfe-80c7-a861be021db1
ms.search.region: Global
ms.author: robadawy
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.translationtype: HT
ms.sourcegitcommit: 879eb9f2a63a8514791f74965005ed3e22bc0de7
ms.openlocfilehash: fed845c5630efb3df90ed69888bd23a06091c94a
ms.contentlocale: ja-jp
ms.lasthandoff: 04/20/2018

---

# <a name="request-a-sandbox-database-refresh"></a>サンドボックス データベース更新の要求

[!include [banner](../includes/banner.md)]

Microsoft Dynamics Lifecycle Services (LCS) を使用して、サンドボックス ユーザー承認テスト (UAT) 環境で、Microsoft Dynamics 365 for Finance and Operations のデータベースのリフレッシュを要求することができます。 データベースの更新対象となるサンド ボックス UAT 環境に、本番環境のデータベース (および財務報告データベース) をコピーできます。 別の UAT 環境を使用する場合は、その環境からデータベースをコピーすることもできます。

この機能により、生産データを使用して UAT 環境で予定されているコード変更をテストできます。 また、デバッグの目的で、生産データベースを UAT 環境にコピーすることもできます。

## <a name="database-refresh-process"></a>データベース更新プロセス

Microsoft サービス エンジニアリング チームは、環境をオフラインにして、更新を実行し、環境をオンラインに戻します。 ダウンタイム期間が約 2 時間であると予測することができます。 ユーザーが要求を入力してから、マイクロソフトのサービス エンジニアが措置を講じるまでの時間が、ユーザーの環境のダウンタイムよりも長くなります。 今後、データベース更新を実行するために使用できるセルフ サービスのメソッドを提供する予定です。

1. LCS で、左上のハンバーガー アイコンを選択してから、**作業項目**を選択します。
2. **作業項目**ページの、ツールバーで**追加**を選択し、**データベースの更新**を選択します。
3. **データベース更新の要求**ダイアログ ボックスで、これらの手順に従います。

    1. **環境名**フィールドで、更新する環境を選択します。
    2. **データベース** フィールドでは、更新するデータベースは常に Microsoft Dynamics AX データベースまたは Finance and Operations データベースです。 エンティティ格納などの他のデータベースでは、データベースの更新が現在サポートされていません。
    3. チェック ボックスを隣に置いたステートメントを注意深く読んで確認してください。

4. 要求を送信した後、作業項目のリストに戻ります。 ここで、要求のステータスを表示し、または再スケジューリングし、または要求をキャンセルできます。
5. サービス エンジニア リング チームがお客様の要求を達成できることを確認したとき、その要求のステータスは **要求受入済** に変更されます。 この時点で、次のいずれかの手順を実行できます。

    - サービス エンジニア リング チームによる更新が完了するまで待ちます。 復元が完了したら、ステータスが **"成功"** に変更されます。
    - ID を選択するか、要求を選択してツール バーで **再スケジューリング** を選択することにより、リクエストを再スケジューリングします。 ダウンタイム ウィンドウの日時を変更することができます。
    - 要求を選択し、ツールバーの**キャンセル**を選択して、要求をキャンセルします。

## <a name="conditions-of-a-database-refresh"></a>データベース更新の条件
データベース更新の操作の要件および条件の一覧を次に示します。

- 要求は、要求を完了するためにリソースを確実に使用できるようにするため、目的のダウンタイム期間の 24 時間前までに送信する必要があります。
- 更新により、ターゲット環境の既存のデータベースが消去されます。 更新が完了すると、既存のデータベースを復元することはできません。
- 更新プロセスが完了するまで、ターゲット環境は使用できなくなります。
- リフレッシュは、Finance and Operations and Financial Reporting データベースにのみ影響します。
- Azure blob storage のドキュメントは、ある環境から別の環境にコピーされません。 つまり、添付されたドキュメント処理ドキュメントとチームプレートは変更されず、現在の状態にとどまります。 
- 管理者ユーザー、およびその他の内部サービス ユーザー アカウントを除くすべてのユーザーは無効になります。 このプロセスにより、他のユーザーをシステムに戻す前に、管理者ユーザーがデータを削除または難読化できます。 
- 管理者ユーザーは、特定のサービスまたは URL に統合エンドポイントを再接続するなど、必要な構成の変更を加える必要があります。
- 定期的にインポートおよびエクスポート ジョブされるすべてのデータ管理フレームワークは完全に処理され復元が開始される前にターゲット システムで停止する必要があります。 さらに、すべての定期的なインポートおよびエクスポート ジョブが完全に処理された後に、データベースをソースから選択することをお勧めします。 これにより、いずれかのシステムから Azure ストレージにオーファン ファイルが存在しないことが保証されます。 これは、データベースがターゲット環境にリストアされた後にオーファン ファイルを処理できないため重要です。 復元後、統合ジョブを再開することができます。
- 実行するように設定されていたすべてのバッチは**源泉**状態として設定され、環境が再コンフィギュレーションされる前にバッチは実行を停止します。 
- SMTP サーバー構成、すべての電子メール アドレス、およびすべての **印刷管理**設定 (ネットワーク プリンターを含む) が削除されました。 
- LCS でプロジェクト所有者または環境マネージャーのロールを持つユーザーは、すべての非実稼働環境の SQL とマシンの資格情報にアクセスできます。 

## <a name="steps-to-complete-after-a-database-refresh-for-environments-that-use-retail-functionality"></a>Retail 機能を使用する環境のデータベース更新後に実行する手順
データベースが更新されたとき、コピーされたデータベースが完全に機能するには、その前に、環境再プロビジョニング ツールを実行する必要があります。 このステップでは、すべての Retail コンポーネントが最新であることを保証します。

> [!IMPORTANT]
> 小売機能がすべての環境に含まれているため、Retail コンポーネントを使用していない場合でもこのステップを完了することをお勧めします。

続行する前に、次の前提条件が満たされていることを確認する必要があります。

1. 必要な修正プログラムを適用するには、次のいずれかのステップを実行します。

    - ターゲット環境が Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition 7.2 (2017 年 7 月) 以降を実行している場合、KB 4035399 を適用します。
    - ターゲット環境が Microsoft Dynamics 365 for Operations バージョン 1611 (2016 年 11 月) を実行している場合、次の修正プログラムを適用します。

        - KB 4025631
        - KB 4035355
        - KB 4035492
        - KB 4010947

2. 既定のチャネル データベースおよび既定のチャネル データ グループの名前は **既定** にする必要があります。 これらの名前を変更していた場合は、名前を元に戻す必要があります。

環境再プロビジョニング ツールを実行するには、これらの手順に従います。

1. LCS で、共有アセット ライブラリ内の**ソフトウェア配置可能パッケージ**を選択します。
2. 環境再プロビジョニング ツールをダウンロードします。
3. 自身のプロジェクトのアセット ライブラリで、**ソフトウェア配置可能パッケージ**を選択します。
4. **新規作成** コマンドを選択して、新しいパッケージを作成します。
5. パッケージの名前と説明を入力します。 パッケージ名として **環境再プロビジョニング ツール** を使用することができます。
6. 先ほどダウンロードしたパッケージをアップロードします。
7. ターゲット環境の**環境の詳細**ページで、**メンテナンス** > **更新プログラムの適用**を選択します。
8. 先ほどアップロードした環境再プロビジョニング ツールを選択し、**適用** を選択してパッケージを適用します。
9. パッケージの配置の進捗を監視します。

配置可能パッケージを適用する方法の詳細については、[配置可能パッケージの適用](../deployment/create-apply-deployable-package.md) を参照してください。 配置可能パッケージを手動で適用する方法の詳細については、[配置可能パッケージのインストール](../deployment/install-deployable-package.md) を参照してください。

