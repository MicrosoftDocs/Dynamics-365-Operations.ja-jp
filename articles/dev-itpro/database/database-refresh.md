---
title: "サンドボックス データベース更新の要求"
description: "このトピックでは、サンドボックスのユーザー受け入れテスト (UAT) 環境で、Microsoft Dynamics 365 for Finance and Operations のデータベースの更新を要求する方法について説明します。"
author: LaneSwenka
manager: AnnBe
ms.date: 01/07/2019
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: IT Pro, Developer
ms.reviewer: margoc
ms.search.scope: Operations
ms.custom: 257614
ms.assetid: 558598db-937e-4bfe-80c7-a861be021db1
ms.search.region: Global
ms.author: laneswenka
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.translationtype: HT
ms.sourcegitcommit: ea143e231f8090b80df376a9054bb23f3997d7ac
ms.openlocfilehash: 459306dc47fa29d408ae2d50289b4971f3b357b1
ms.contentlocale: ja-jp
ms.lasthandoff: 01/08/2019

---

# <a name="request-sandbox-database-refreshes"></a><span data-ttu-id="47c0b-103">サンドボックス データベース更新の要求</span><span class="sxs-lookup"><span data-stu-id="47c0b-103">Request sandbox database refreshes</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="47c0b-104">Microsoft Dynamics Lifecycle Services (LCS) を使用して、サンドボックス ユーザー承認テスト (UAT) 環境に対して、Microsoft Dynamics 365 for Finance and Operations のデータベースのリフレッシュを要求することができます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-104">You can use Microsoft Dynamics Lifecycle Services (LCS) to request a refresh of the database for Microsoft Dynamics 365 for Finance and Operations to a sandbox user acceptance testing (UAT) environment.</span></span> <span data-ttu-id="47c0b-105">データベースの更新では、対象となるサンドボックス UAT 環境に、本番環境のトランザクション データベースをコピーできます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-105">A database refresh lets you copy the transactional database of your production environment into the target, sandbox UAT environment.</span></span> <span data-ttu-id="47c0b-106">このプロセスには、財務報告データベースのコピーが含まれます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-106">This process includes copying the Financial Reporting database.</span></span> <span data-ttu-id="47c0b-107">別のサンドボックス環境を使用する場合は、その環境から対象のサンドボックス UAT 環境にデータベースをコピーすることもできます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-107">If you have another sandbox environment, you can also copy the databases from that environment to your target, sandbox UAT environment.</span></span>

<span data-ttu-id="47c0b-108">この機能により、生産データを使用して UAT 環境で予定されているコード変更をテストできます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-108">This functionality lets you use production data to test upcoming code changes in a UAT environment.</span></span> <span data-ttu-id="47c0b-109">また、デバッグの目的で、生産データベースを UAT 環境にコピーすることもできます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-109">You can also copy a production database into a UAT environment for debugging purposes.</span></span>

> [!Important]
> <span data-ttu-id="47c0b-110">生産報告を目的としてサンドボックス環境に生産のデータをコピーすることはできません。</span><span class="sxs-lookup"><span data-stu-id="47c0b-110">Copying production data to your sandbox environment for the purpose of production reporting is not supported.</span></span>  

## <a name="self-service-database-refresh"></a><span data-ttu-id="47c0b-111">データベースのセルフ サービスエ更新</span><span class="sxs-lookup"><span data-stu-id="47c0b-111">Self-service database refresh</span></span>
<span data-ttu-id="47c0b-112">人手または手動のプロセスに依存しないでお客様にアプリケーション ライフサイクル管理機能を提供することを目標として、Lifecycle Services チームは自動化されたデータベースの更新アクションを導入しました。</span><span class="sxs-lookup"><span data-stu-id="47c0b-112">With the goal of providing Application Lifecycle Management capabilities to our customers without relying on human or manual processes, the Lifecycle Services team has introduced an automated Refresh Database action.</span></span> <span data-ttu-id="47c0b-113">別の環境のデータでサンドボックス環境を更新するには、パブリック プレビューに含まれるセルフ サービス アクションの一部としてこのアクションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-113">To refresh your sandbox environment with data from another environment, you can perform this action as part of the Self-service action that is in Public preview.</span></span> <span data-ttu-id="47c0b-114">このプロセスについては以下で概要を説明します。また、このプロセスは、完全にサポートされる機能です。</span><span class="sxs-lookup"><span data-stu-id="47c0b-114">This process is outlined below, and is fully-supported functionality.</span></span>

1. <span data-ttu-id="47c0b-115">ターゲット サンドボックスの **環境の詳細** ページにアクセスし、**メンテナンス** > **データベースの移動** メニューのオプションをクリックします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-115">Visit your target sandbox **Environment Details** page , and click the **Maintain** > **Move database** menu option.</span></span>
2. <span data-ttu-id="47c0b-116">**データベースの選択** オプションを選択し、ソース環境を選択します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-116">Select the **Refresh database** option and choose your source environment.</span></span>
3. <span data-ttu-id="47c0b-117">警告に注意し、ソース環境からコピーされていないデータの要素の一覧を確認します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-117">Note the warnings and review the list of data elements that are not copied from the source environment.</span></span>
4. <span data-ttu-id="47c0b-118">更新操作がすぐに開始されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-118">The refresh operation will begin immediately.</span></span>
5. <span data-ttu-id="47c0b-119">更新操作が完了したら、パッケージ展開、データベース移動、アップグレードなどの別のサービス操作を実行する前に、工程で**サインオフ**する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-119">After the refresh operation is completed, you must **Sign off** on the operation before you can perform another servicing operation, such as package deployment, database movement, or upgrade.</span></span>

### <a name="refresh-operation-failed"></a><span data-ttu-id="47c0b-120">更新操作が失敗しました</span><span class="sxs-lookup"><span data-stu-id="47c0b-120">Refresh operation failed</span></span>
<span data-ttu-id="47c0b-121">失敗した場合、**ロールバック**を実行するオプションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-121">In case of failure, the option to perform a **Rollback** is available.</span></span>  <span data-ttu-id="47c0b-122">工程が最初に失敗した後にロールバック オプションをクリックすると、対象となるサンドボックス環境が更新の開始前の状態に戻されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-122">By clicking the rollback option after the operation has initially failed, your target sandbox environment will be restored to the state it was before the refresh began.</span></span> <span data-ttu-id="47c0b-123">Azure SQL ポイントインタイム復元機能により、データベースを復元できるようになります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-123">This is made possible by the Azure SQL Point-in-time restore capability to restore the database.</span></span> <span data-ttu-id="47c0b-124">新しく更新されたデータでデータベースの同期を完了できないをターゲット サンドボックスにカスタマイズがある場合は、これがよく必要になります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-124">This is often required if a customization is present in the target sandbox that cannot complete a database synchronization with the newly refreshed data.</span></span>  

<span data-ttu-id="47c0b-125">失敗の根本原因を特定するには、ロールバック操作を開始する前に、使用可能なボタンを使用して Runbook ログをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-125">To determine the root cause of the failure, download the runbook logs using the available buttons before starting the rollback operation.</span></span>

### <a name="data-elements-that-arent-copied-during-refresh"></a><span data-ttu-id="47c0b-126">更新中にはコピーされないデータ要素</span><span class="sxs-lookup"><span data-stu-id="47c0b-126">Data elements that aren't copied during refresh</span></span>
<span data-ttu-id="47c0b-127">実稼働環境をサンドボックス環境に、またはサンドボックス環境を別のサンドボックス環境に更新するときは、ターゲット環境にコピーされない特定のデータベース要素があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-127">When refreshing a production environment to a sandbox environment, or a sandbox environment to another sandbox environment, there are certain elements of the database that are not copied over to the target environment.</span></span>  <span data-ttu-id="47c0b-128">これは、データが環境固有であるか、非製造環境から実際の電子メールが送信されるなどの運用上の問題が発生する可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="47c0b-128">This is because the data is either environment specific, or could cause operational issues such as sending realistic email out of a non-production environment.</span></span>  <span data-ttu-id="47c0b-129">これらのデータ要素として次のものがあります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-129">These data elements include:</span></span>

* <span data-ttu-id="47c0b-130">LogisticsElectronicAddress テーブル内の電子メール アドレス。</span><span class="sxs-lookup"><span data-stu-id="47c0b-130">Email addresses in the LogisticsElectronicAddress table.</span></span>
* <span data-ttu-id="47c0b-131">BatchJobHistory、BatchHistory、および BatchConstraintHistory テーブルのバッチ ジョブ履歴。</span><span class="sxs-lookup"><span data-stu-id="47c0b-131">Batch job history in the BatchJobHistory, BatchHistory, and BatchConstraintHistory tables.</span></span>
* <span data-ttu-id="47c0b-132">SysEmailSMTPPassword テーブルの SMTP パスワード。</span><span class="sxs-lookup"><span data-stu-id="47c0b-132">SMTP password in the SysEmailSMTPPassword table.</span></span>
* <span data-ttu-id="47c0b-133">SysEmailParameters テーブルの SMTP 中継サーバー。</span><span class="sxs-lookup"><span data-stu-id="47c0b-133">SMTP Relay server in the SysEmailParameters table.</span></span>
* <span data-ttu-id="47c0b-134">メール プロバイダーは、Exchange プロバイダーを使用して誤った発信メールを防ぐために SysEmailParameters テーブルで SMTP にリセットされます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-134">Mail provider is reset to SMTP in the SysEmailParameters table to prevent accidental, outbound mail using the Exchange provider.</span></span>
* <span data-ttu-id="47c0b-135">PrintMgmtSettings と PrintMgmtDocInstance テーブルの印刷管理設定。</span><span class="sxs-lookup"><span data-stu-id="47c0b-135">Print Management settings in the PrintMgmtSettings and PrintMgmtDocInstance tables.</span></span>
* <span data-ttu-id="47c0b-136">SysServerConfig、SysServerSessions、SysCorpNetPrinters、SysClientSessions、BatchServerConfig、および BatchServerGroup テーブル内の環境固有のレコード。</span><span class="sxs-lookup"><span data-stu-id="47c0b-136">Environment-specific records in the SysServerConfig, SysServerSessions, SysCorpNetPrinters, SysClientSessions, BatchServerConfig, and BatchServerGroup tables.</span></span>
* <span data-ttu-id="47c0b-137">DocuValue テーブル内のドキュメント添付ファイル。</span><span class="sxs-lookup"><span data-stu-id="47c0b-137">Document attachments in the DocuValue table.</span></span>
* <span data-ttu-id="47c0b-138">管理者と Microsoft サービス アカウントを除くすべてのユーザーが無効になります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-138">All users except for the administrator and Microsoft service accounts are disabled.</span></span>
* <span data-ttu-id="47c0b-139">すべてのバッチ ジョブは、[保留] 状態に設定されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-139">All batch jobs are set to Withhold status.</span></span>

### <a name="environment-administrator"></a><span data-ttu-id="47c0b-140">環境管理者</span><span class="sxs-lookup"><span data-stu-id="47c0b-140">Environment administrator</span></span>
<span data-ttu-id="47c0b-141">対象となる環境のシステム管理者アカウント ('Admin' の UserId) は、Lifecycle Services から値 Administrator にリセットされます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-141">The System Administrator account in the target environment (UserId of 'Admin') is reset to the value of the Administrator from Lifecycle Services.</span></span>  <span data-ttu-id="47c0b-142">これがどのアカウントになるかをプレビューするには、LCS でターゲット サンドボックスの **環境の詳細** ページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-142">To preview which account this will be, visit your target sandbox **Environment Details** page in LCS.</span></span>  <span data-ttu-id="47c0b-143">環境が最初に展開されたときに選択された **環境管理者** フィールドの値は、トランザクション データベース内のシステム管理者となるように更新されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-143">The value of the **Environment Administrator** field that was selected when the environment was first deployed is updated to be the System Administrator in the transactional database.</span></span> <span data-ttu-id="47c0b-144">これは、環境のテナントが環境管理者のテナントとなることも意味します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-144">This also means that the tenant of the environment will be that of the Environment Administrator.</span></span>  <span data-ttu-id="47c0b-145">別のアカウントを使用することを要求する場合、ターゲット サンドボックスを割り当て解除して削除し、別のアカウントを選択して再展開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-145">If you require a different account to be used, you will need to deallocate and delete the target sandbox, and redeploy selecting another account.</span></span> <span data-ttu-id="47c0b-146">この後、データを復元するためにデータベースの更新操作をもう 1 回実行することができます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-146">After this, you can perform another refresh database action to restore the data.</span></span>

## <a name="database-refresh-via-service-request"></a><span data-ttu-id="47c0b-147">サービス要求を通じたデータベース更新</span><span class="sxs-lookup"><span data-stu-id="47c0b-147">Database refresh via service request</span></span>

> [!NOTE]
> <span data-ttu-id="47c0b-148">2018 年 10 月の時点で、同じ環境内の別の更新を開始する前に、データベース更新要求をサインオフする必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-148">As of October 2018, database refresh requests must be signed off before another refresh of the same environment can be started.</span></span> <span data-ttu-id="47c0b-149">これは、データベース移動操作の将来の自動化をサポートするためです。</span><span class="sxs-lookup"><span data-stu-id="47c0b-149">This is to support future automation of database movement operations.</span></span> <span data-ttu-id="47c0b-150">サインオフするには、**環境の詳細** ページにアクセスし、**サインオフ** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-150">To sign off, visit your **Environment Details** page and click the **Signoff** button.</span></span> <span data-ttu-id="47c0b-151">将来に向けて多くのデータベース更新サービス要求を作成できますが、各要求間でサインオフする必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-151">You can create many database refresh service requests out in to the future, however you must sign off in between each one.</span></span>
>
> <span data-ttu-id="47c0b-152">**2019 年 1 月 31 日より後のサービスの日付では、データベースの更新のためのサービス要求は認められなくなります**。</span><span class="sxs-lookup"><span data-stu-id="47c0b-152">Service requests for database refresh **will not be accepted for servicing dates after January 31, 2019**.</span></span> <span data-ttu-id="47c0b-153">この日付の跡、すべての更新処理が上記のセルフサービス アクションを使用して実行されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-153">After this date, all refresh operations will be performed using the self-service actions outlined above.</span></span>

<span data-ttu-id="47c0b-154">Microsoft サービス エンジニアリング チームは、環境をオフラインにして、更新を実行し、環境をオンラインに戻します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-154">The Microsoft Service Engineering team will take your environment offline, complete the refresh, and then bring the environment back online.</span></span> <span data-ttu-id="47c0b-155">ダウンタイム期間が約 2 時間であると予測することができます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-155">You can expect the downtime period to be approximately two hours.</span></span> <span data-ttu-id="47c0b-156">ユーザーが要求を入力してから、マイクロソフトのサービス エンジニアが措置を講じるまでの時間が、ユーザーの環境のダウンタイムよりも長くなります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-156">The period after you enter your request and before our Service Engineers take action will be longer than your environment's downtime.</span></span> <span data-ttu-id="47c0b-157">今後、データベース更新を実行するために使用できるセルフ サービスのメソッドを提供する予定です。</span><span class="sxs-lookup"><span data-stu-id="47c0b-157">In the future, we will provide a self-service method that you can use to perform your database refreshes.</span></span>

1. <span data-ttu-id="47c0b-158">LCS のプロジェクト ホーム ページで、**サービス要求** を選択します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-158">In LCS, on the Project home page, select **Service requests**.</span></span>
2. <span data-ttu-id="47c0b-159">**サービス要求**ページの、ツールバーで**追加**を選択し、**データベースの更新**を選択します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-159">On the **Service requests** page, select **Add** on the toolbar, and then select **Database refresh**.</span></span>
3. <span data-ttu-id="47c0b-160">**データベース更新の要求**ダイアログ ボックスで、これらの手順に従います。</span><span class="sxs-lookup"><span data-stu-id="47c0b-160">In the **Request for database refresh** dialog box, follow these steps:</span></span>

    1. <span data-ttu-id="47c0b-161">**環境名**フィールドで、更新する環境を選択します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-161">In the **Environment name** field, select the environment to refresh.</span></span>
    2. <span data-ttu-id="47c0b-162">**データベース** フィールドでは、更新するデータベースは常に Microsoft Dynamics AX データベースまたは Finance and Operations データベースです。</span><span class="sxs-lookup"><span data-stu-id="47c0b-162">In the **Database** field, the database to refresh is always the Microsoft Dynamics AX database or the Finance and Operations database.</span></span> <span data-ttu-id="47c0b-163">エンティティ格納などの他のデータベースでは、データベースの更新が現在サポートされていません。</span><span class="sxs-lookup"><span data-stu-id="47c0b-163">Other databases, such as Entity store aren't currently supported for database refresh.</span></span>
    3. <span data-ttu-id="47c0b-164">チェック ボックスを隣に置いたステートメントを注意深く読んで確認してください。</span><span class="sxs-lookup"><span data-stu-id="47c0b-164">Carefully read and acknowledge the statements that have check boxes next to them.</span></span>

4. <span data-ttu-id="47c0b-165">要求を送信した後、作業項目のリストに戻ります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-165">After you submit your request, you are returned to the list of work items.</span></span> <span data-ttu-id="47c0b-166">ここで、要求のステータスを表示し、または再スケジューリングし、または要求をキャンセルできます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-166">Here, you can view the status of the request, or reschedule or cancel the request.</span></span>
5. <span data-ttu-id="47c0b-167">サインオフまたはロールバックを待機している事前サービス要求が環境にないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-167">Ensure no prior servicing request on your environment is awaiting signoff or rollback.</span></span> <span data-ttu-id="47c0b-168">環境の詳細ページに移動し、完了した更新やパッケージの展開をサインオフします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-168">Visit your Environment details page and sign off any completed refresh or package deployment.</span></span>
6. <span data-ttu-id="47c0b-169">サービス エンジニア リング チームがお客様の要求を達成できることを確認したとき、その要求のステータスは **要求受入済** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-169">When the Service Engineering team has acknowledged that they can complete your request, the status of the request is changed to **Request accepted**.</span></span> <span data-ttu-id="47c0b-170">この時点で、次のいずれかの手順を実行できます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-170">At this point, you can follow any of these steps:</span></span>

    - <span data-ttu-id="47c0b-171">サービス エンジニア リング チームによる更新が完了するまで待ちます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-171">Wait for the Service Engineering team to complete the refresh.</span></span> <span data-ttu-id="47c0b-172">復元が完了したら、ステータスが **"成功"** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-172">When the restore is completed, the status is changed to **Succeeded**.</span></span>
    - <span data-ttu-id="47c0b-173">ID を選択するか、要求を選択してツール バーで **再スケジューリング** を選択することにより、リクエストを再スケジューリングします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-173">Reschedule the request by selecting the ID, or by selecting the request and then selecting **Reschedule** on the toolbar.</span></span> <span data-ttu-id="47c0b-174">ダウンタイム ウィンドウの日時を変更することができます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-174">You can then change the dates and times for the downtime window.</span></span>
    - <span data-ttu-id="47c0b-175">要求を選択し、ツールバーの**キャンセル**を選択して、要求をキャンセルします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-175">Cancel the request by selecting the request and then selecting **Cancel** on the toolbar.</span></span>

## <a name="conditions-of-a-database-refresh"></a><span data-ttu-id="47c0b-176">データベース更新の条件</span><span class="sxs-lookup"><span data-stu-id="47c0b-176">Conditions of a database refresh</span></span>
<span data-ttu-id="47c0b-177">データベース更新の操作の要件および条件の一覧を次に示します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-177">Here is the list of requirements and conditions of operation for a database refresh:</span></span>

- <span data-ttu-id="47c0b-178">パッケージの展開や事前データベース更新など、環境の詳細ページから以前のサービス操作を*サインオフする必要があります*。</span><span class="sxs-lookup"><span data-stu-id="47c0b-178">Any previous servicing operation, such as a package deployment or prior database refresh, *must be signed off* from your environment details page.</span></span>
- <span data-ttu-id="47c0b-179">要求は、要求を完了するためにリソースを確実に使用できるようにするため、目的のダウンタイム期間の 5 時間前までに送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-179">Requests must be submitted 5 hours before the desired downtime window, to help ensure that resources will be available to complete the request.</span></span>
- <span data-ttu-id="47c0b-180">更新により、ターゲット環境の既存のデータベースが消去されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-180">A refresh erases the existing database in the target environment.</span></span> <span data-ttu-id="47c0b-181">更新が完了すると、既存のデータベースを復元することはできません。</span><span class="sxs-lookup"><span data-stu-id="47c0b-181">The existing database can't be recovered after the refresh is completed.</span></span>
- <span data-ttu-id="47c0b-182">更新プロセスが完了するまで、ターゲット環境は使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-182">The target environment will be unavailable until the refresh process is completed.</span></span>
- <span data-ttu-id="47c0b-183">リフレッシュは、Finance and Operations and Financial Reporting データベースにのみ影響します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-183">The refresh will affect only the Finance and Operations and Financial Reporting databases.</span></span>
- <span data-ttu-id="47c0b-184">Azure blob storage のドキュメントは、ある環境から別の環境にコピーされません。</span><span class="sxs-lookup"><span data-stu-id="47c0b-184">Documents in Azure blob storage are not copied from one environment to another.</span></span> <span data-ttu-id="47c0b-185">つまり、添付されたドキュメント処理ドキュメントとチームプレートは変更されず、現在の状態にとどまります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-185">This means that attached document handling documents and templates won't be changed and will remain in their current state.</span></span>
- <span data-ttu-id="47c0b-186">管理者ユーザー、およびその他の内部サービス ユーザー アカウントを除くすべてのユーザーは無効になります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-186">All users except the Admin user and other internal service user accounts will be disabled.</span></span> <span data-ttu-id="47c0b-187">このプロセスにより、他のユーザーをシステムに戻す前に、管理者ユーザーがデータを削除または難読化できます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-187">This process allows the Admin user to delete or obfuscate data before allowing others users back into the system.</span></span>
- <span data-ttu-id="47c0b-188">管理者ユーザーは、特定のサービスまたは URL に統合エンドポイントを再接続するなど、必要な構成の変更を加える必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-188">The Admin user must make required configuration changes, such as reconnecting integration endpoints to specific services or URLs.</span></span>
- <span data-ttu-id="47c0b-189">定期的にインポートおよびエクスポート ジョブされるすべてのデータ管理フレームワークは完全に処理され復元が開始される前にターゲット システムで停止する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-189">All data management framework recurring import and export jobs must be fully processed and stopped in the target system prior to initiating the restore.</span></span> <span data-ttu-id="47c0b-190">さらに、すべての定期的なインポートおよびエクスポート ジョブが完全に処理された後に、データベースをソースから選択することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-190">In addition, we recommend that you select the database from the source after all recurring import and export jobs have been fully processed.</span></span> <span data-ttu-id="47c0b-191">これにより、いずれかのシステムから Azure ストレージにオーファン ファイルが存在しないことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-191">This will ensure there are no orphaned files in Azure storage from either system.</span></span> <span data-ttu-id="47c0b-192">これは、データベースがターゲット環境にリストアされた後にオーファン ファイルを処理できないため重要です。</span><span class="sxs-lookup"><span data-stu-id="47c0b-192">This is important because orphaned files cannot be processed after the database is restored in the target environment.</span></span> <span data-ttu-id="47c0b-193">復元後、統合ジョブを再開することができます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-193">After the restore, the integration jobs can be resumed.</span></span>
- <span data-ttu-id="47c0b-194">実行するように設定されていたすべてのバッチは**源泉**状態として設定され、環境が再コンフィギュレーションされる前にバッチは実行を停止します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-194">All batches that were set to run are set to **Withhold** status, to stop batches from running before the environment has been reconfigured.</span></span>
- <span data-ttu-id="47c0b-195">SMTP サーバー構成、すべての電子メール アドレス、およびすべての **印刷管理**設定 (ネットワーク プリンターを含む) が削除されました。</span><span class="sxs-lookup"><span data-stu-id="47c0b-195">The SMTP server configuration, all email addresses, and all **Print management** settings, including network printers are removed.</span></span>
- <span data-ttu-id="47c0b-196">LCS でプロジェクト所有者または環境マネージャーのロールを持つユーザーは、すべての非実稼働環境の SQL とマシンの資格情報にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="47c0b-196">Any user with a role of Project owner or Environment manager in LCS will have access to the SQL and machine credentials for all non-production environments.</span></span>

## <a name="steps-to-complete-after-a-database-refresh-for-environments-that-use-retail-functionality"></a><span data-ttu-id="47c0b-197">Retail 機能を使用する環境のデータベース更新後に実行する手順</span><span class="sxs-lookup"><span data-stu-id="47c0b-197">Steps to complete after a database refresh for environments that use Retail functionality</span></span>
[!include [environment-reprovision](../includes/environment-reprovision.md)]

## <a name="known-issues"></a><span data-ttu-id="47c0b-198">既知の問題</span><span class="sxs-lookup"><span data-stu-id="47c0b-198">Known issues</span></span>

### <a name="incompatible-version-of-financial-reporting-between-source-and-target-environments"></a><span data-ttu-id="47c0b-199">ソース環境とターゲット環境間での財務報告の互換性のないバージョン</span><span class="sxs-lookup"><span data-stu-id="47c0b-199">Incompatible version of Financial Reporting between source and target environments</span></span>
<span data-ttu-id="47c0b-200">財務報告のバージョンがソースおよびターゲット環境間で異なる場合は、データベースの更新プロセス (セルフサービスまたはサービス要求経由) を正常に完了できません。</span><span class="sxs-lookup"><span data-stu-id="47c0b-200">The database refresh process (self-service or via service request) cannot be completed successfully if the version of Financial Reporting is different between the source and target environment.</span></span> <span data-ttu-id="47c0b-201">この問題を解決するには、財務報告の最新バージョンが存在するように両方の環境を更新します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-201">To resolve this issue, update both environments to have the latest version of Financial Reporting.</span></span>

* <span data-ttu-id="47c0b-202">実装プロジェクトで**アセット ライブラリ**にアクセスし、**ソフトウェア展開可能パッケージ** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="47c0b-202">Visit the **Asset Library** in your implementation project, and then click **Software deployable package**.</span></span>
* <span data-ttu-id="47c0b-203">**インポート** ボタンをクリックし、最新の Microsoft Dynamics 財務報告バイナリ更新プログラム パッケージを検索して、インポート対象としてこれを選択します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-203">Click the **Import** button and find the latest Microsoft Dynamics Financial Reporting binary update package and select this for import.</span></span>
* <span data-ttu-id="47c0b-204">ソース環境とターゲット環境の両方で最新バージョンが確実に使用されるように、両方の環境にこのパッケージを適用します。</span><span class="sxs-lookup"><span data-stu-id="47c0b-204">Apply this package to both the source and target environments to ensure they are both using the latest version.</span></span>

<span data-ttu-id="47c0b-205">お使いのバージョンを調べる方法の詳細については、[レポート デザイナーでバージョンを調べる方法](https://www.youtube.com/watch?v=icfA5Q3kp4w)ビデオを視聴してください。</span><span class="sxs-lookup"><span data-stu-id="47c0b-205">For instructions about how to determine the version you're using, watch the [How to find the version of Report designer](https://www.youtube.com/watch?v=icfA5Q3kp4w) video.</span></span>

### <a name="incompatible-application-versions-between-source-and-target-environments"></a><span data-ttu-id="47c0b-206">ソース環境とターゲット環境間での互換性のないアプリケーション バージョン</span><span class="sxs-lookup"><span data-stu-id="47c0b-206">Incompatible application versions between source and target environments</span></span>
<span data-ttu-id="47c0b-207">ソースおよびターゲット環境のアプリケーション リリースが同じでない場合は、データベースの更新プロセス (セルフサービスまたはサービス要求経由) を正常に完了できません。</span><span class="sxs-lookup"><span data-stu-id="47c0b-207">The database refresh process (self-service or via service request) cannot be completed if the Application release of your source and target environment are not the same.</span></span> <span data-ttu-id="47c0b-208">これは、データ アップグレード プロセスが、更新などのデータベース移動操作によって実行されず、データ損失が発生する可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="47c0b-208">This is because the data upgrade process is not executed by database movement operations such as refresh, and data loss can occur.</span></span>  

<span data-ttu-id="47c0b-209">新しいアプリケーション バージョンにサンドボックス UAT 環境をアップグレードする場合 (たとえば、7.3 から 8.1)、必ずアップグレードを開始する前にデータベースの更新アクションを実行してください。</span><span class="sxs-lookup"><span data-stu-id="47c0b-209">If upgrading your sandbox UAT environment to a newer Application version (for example, 7.3 to 8.1), be sure to perform the database refresh action prior to starting the upgrade.</span></span> <span data-ttu-id="47c0b-210">サンドボックスが新しいバージョンにアップグレードされると、サンドボックス UAT 環境に古い実稼働環境データベースを復元することはできません。</span><span class="sxs-lookup"><span data-stu-id="47c0b-210">After your sandbox is upgraded to the newer version, you cannot restore an older production environment database in to the sandbox UAT environment.</span></span>  

<span data-ttu-id="47c0b-211">逆に、実稼働環境がターゲット サンドボックスよりも新しい場合、更新前にターゲット サンドボックスをアップグレードするか、更新の実行前にそのまま割り当て解除、削除、および再展開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="47c0b-211">Conversely, if your production environment is newer than your target sandbox, you will need to either upgrade the target sandbox prior to the refresh or simply deallocate, delete, and redeploy prior to performing the refresh.</span></span>

