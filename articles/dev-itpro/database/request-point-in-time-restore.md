---
redirect_url: /dynamics365/unified-operations/dev-itpro/database/dbmovement-operations
title: 非実稼働環境でのデータベースの復元
description: Microsoft Dynamics 365 for Finance and Operations では、データベースを要求後 35 日以内の特定の時点に復元するように要求できます。 このトピックでは、Point-in-Time 復元を要求する方法について説明します。
author: MargoC
manager: AnnBe
ms.date: 06/20/2017
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: IT Pro
ms.reviewer: margoc
ms.search.scope: Operations
ms.custom: 257614
ms.assetid: 558598db-937e-4bfe-80c7-a861be021db1
ms.search.region: Global
ms.author: tabell
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: 06c9954b756508dfce5e5ee377b616fcc3cc000b
ms.sourcegitcommit: 2b890cd7a801055ab0ca24398efc8e4e777d4d8c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2019
ms.locfileid: "1537106"
---
# <a name="restore-databases-in-non-production-environments"></a>非実稼働環境でのデータベースの復元

[!include [banner](../includes/banner.md)]

Microsoft Dynamics 365 for Finance and Operations では、データベースを要求後 35 日以内の特定の時点に復元するように要求できます。 このトピックでは、Point-in-Time 復元を要求する方法について説明します。

ポイントインタイム復元は、Microsoft Dynamics 365 for Finance and Operations で使用できる Microsoft Azure SQL データベース機能です。 ポイントインタイム復元では、破壊試験後に、非製造環境を既知の正常な状態にリセットします。 緊急の場合は、実稼働環境でポイントインタイム復元を実行することもできます。 ただし、生産復元を要求するには、このトピックに記載されているプロセスを使用しないでください。 代わりに、Microsoft サポートに問い合わせてください。

> [!IMPORTANT]
> ポイントインタイム リストア機能により、かならず新しいデータベースが作成されます。 新しいデータベースを Dynamics 365 for Finance and Operations 環境に取り込むには、元のデータベースを新しいデータベースに置き換える必要があります。 したがって、新しいデータベースを取り込んだ後、すべてのバックアップの履歴はなくなります。 その時点から履歴の追跡が再び開始されます。

[![ポイント イン タイム復元前後のデータベースの例](./media/pitrestorebehaviour.png)](./media/pitrestorebehaviour.png)

## <a name="code-versioning"></a>コード バージョン管理
選択する復元時点を決定するときは、コード バージョン管理を考慮することが重要です。それは、コードの現在のバージョンが復元時点のデータベースの状態と互換性がない場合があるためです。 たとえば、今日のデータベースは、Microsoft Dynamics 365 for Finance and Operations プラットフォーム更新プログラム 2、およびいくつかのカスタマイズを実行しています。 ただし、10 日前には、2016 年 2 月にリリースされた Microsoft Dynamics AX 、さらにそのビルドを作成されたカスタマイズが環境で実行されていました。 データベースを 10 日前の状態に復元しようとしましたが、環境でコードの最新バージョンが実行されている場合、データベースがアップグレードされているため、期待どおりに動作しない可能性があります。 問題を発生させることなく、データベースのバージョンとコードのバージョンを混在させることはできますが、問題が発生する可能性があることに注意してください。 一般に、Microsoft からの、またはカスタマイズのメジャー バージョンからのメジャー バージョン リリースを混同しないことをお勧めします。 ポイントインタイム復元を要求する最も一般的なシナリオを次に示します。

- サンドボックス環境で実行されるユーザー テストにはいくつかのバグがあります。
- バグは開発環境で修正され、新しいビルドはサンドボックス環境に展開されます。
- データベースをまったく同じ方法で再テストできるように、ポイントインタイム復元を要求して、テストを実施する前の時点にデータベースを復元します。 この場合、修正が配置されたため、コード バージョンとデータベースの不一致が発生します。 ただし、この不一致により問題が発生することはあまりありません。 カスタマイズを行う開発者に問い合わせ、進めることができることを確認してください。
- データベースを復元した後、それを同期します。

## <a name="point-in-time-restore-process"></a>ポイントインタイム復元プロセス
Microsoft サービス エンジニアリング チームは、環境をオフラインにして、ポイント イン タイム復元を実行し、環境をオンラインに戻します。 ダウンタイム期間が 2 時間未満であると予測することができます。 ユーザーが要求を入力してから、マイクロソフトのサービス エンジニアが措置を講じるまでの時間が、ユーザーの環境のダウンタイムよりも長くなります。 今後、独自のポイントインタイム復元を実行するために使用できるセルフ サービスのメソッドを提供する予定です。

1. Microsoft Dynamics Lifecycle Services (LCS) ウィンドウの左上にあるハンバーガー アイコンをクリックし、一覧から**作業項目**を選択します。

    [![作業項目](./media/selectworkitems.png)](./media/selectworkitems.png)

2. **作業項目**ページで、ツール バーの**追加**をクリックし、**データベース ポイントインタイム復元要求**をクリックします。

    [![データベース ポイントインタイム復元要求](./media/createrequest.png)](./media/createrequest.png)

3. **データベース ポイントインタイム復元要求**ダイアログ ボックスで、これらの手順に従います。

    1. **環境名**フィールドで、復元する環境を選択します。

        > [!NOTE]
        > Azure SQL データベース環境のみを復元することができます。 したがって、Microsoft SQL Server に基づく 1 つのボックス環境は選択できません。

    2. **データベース** フィールドでは、復元するデータベースは常に Microsoft Dynamics AX または Microsoft Dynamics 365 for Finance and Operations です。 エンティティ格納や財務報告など、他のデータベースでは、ポイントインタイム復元が現在サポートされていません。
    3. **特定の時点の復元**フィールドに情報を入力します。 Azure SQL データベースを使用すると、要求を作成する日の 35 日前までの時点にデータベースを復元できます。 環境が 35 日未満の場合、または以前に復元されている場合は、最大時間が少なくなります。
    4. **ダウンタイム開始日を優先**および**ダウンタイム終了日を優先**フィールドに情報を入力します。 サイクル終了日は、サイクル開始日の少なくとも 1 時間後でなければなりません。 要求は、要求を完了するためにリソースを確実に使用できるようにするため、推奨されるダウンタイム期間の少なくとも 24 時間前までに送信する必要があります。
    5. チェック ボックスを隣に置いた 3 つのステートメントを注意深く読んで確認してください。

    [![データベース ポイント イン タイム復元ダイアログ ボックスの要求](./media/requestform.png)](./media/requestform.png)

4. 要求を送信した後、作業項目のリストにリダイレクトされます。 ここで、要求のステータスを表示し、または再スケジューリングし、または要求をキャンセルできます。
5. Microsoft サービス エンジニア リング チームがお客様の要求を達成できることを確認したとき、その要求のステータスは **要求受入済** に変わります。 この時点で、次のいずれかの手順を実行できます。

    - サービス エンジニア リング チームによる復元が完了するまで待ちます。 復元が完了したら、ステータスが **"成功"** に変更されます。
    - ID をクリックするか、要求を選択してツール バーで **再スケジューリング** をクリックすることにより、リクエストを再スケジューリングします。 ダウンタイム ウィンドウの日時、および復元する時点を変更することができます。
    - 要求を選択し、ツールバーの**キャンセル**をクリックして、要求をキャンセルします。

## <a name="enable-change-tracking"></a>変更追跡の有効化
データベースで変更追跡が有効になっている場合は、ALTER DATABASE コマンドを使用して、新しく復元したデータベースで変更追跡を再度有効にしてください。

新しいデータベースで店舗の業務手順の現在のバージョン (変更追跡に関連する) が使用されていることを確認するには、データ管理のデータ エンティティの変更追跡を有効または無効にする必要があります。 これは、店舗の業務手順の更新をトリガーするために必要なので、どのエンティティでも実行できます。

## <a name="conditions-of-a-point-in-time-restore"></a>ポイントインタイム復元要求の条件
ポイントインタイム復元の操作の要件および条件の一覧を次に示します。

- 要求は、要求を完了するためにリソースを確実に使用できるようにするため、目的のダウンタイム期間の 24 時間前までに送信する必要があります。
- ポイントインタイム復元により、ターゲット環境の既存のデータベースが消去されます。 復元が完了すると、既存のデータベースを復元することはできません。
- 更新プロセスが完了するまで、ターゲット環境は使用できなくなります。
- ポイントインタイム リストアは、Dynamics 365 for Finance and Operations データベースのみに影響します。

    - Azure blob storage に格納されているドキュメント処理のドキュメントは、変更されず現在の状態で残ります。 同様のルールは、 X++ のカスタマイズによって Azure Blob Storage に保存されているすべてのドキュメントに適用されます。
    - 財務諸表データベースは、現在の状態にも残ります、復元が完了した後にリセットする必要があります。

- Dynamics 365 for Finance and Operations データベースは、要求された時点の正確な状態のままになります。 バッチの保留または復元したデータベースへのアクセスの制限は行い **ません**。
- LCS で**プロジェクト所有者**または**環境マネージャー**のロールを持つ LCS ユーザーは、すべての非実稼働環境の Azure SQL データベースとマシンの資格情報にアクセスします。 非実稼働環境にコピーされたデータのセキュリティを保証するには、これらのロールのメンバーシップを制限します。
