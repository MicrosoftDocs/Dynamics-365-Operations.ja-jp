---
title: "オンプレミス配置への更新プログラムの適用"
description: "このトピックでは、Microsoft Dynamics 365 for Finance and Operations のオンプレミス展開に更新プログラムを適用する方法について説明します。"
author: manalidongre
manager: AnnBe
ms.date: 03/01/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Developer, IT Pro
ms.reviewer: kfend
ms.search.scope: Operations
ms.custom: 
ms.assetid: 
ms.search.region: Global
ms.author: sarvanis
ms.search.validFrom: 2017-06-30
ms.dyn365.ops.version: Platform update 12
ms.translationtype: HT
ms.sourcegitcommit: efcb77ff883b29a4bbaba27551e02311742afbbd
ms.openlocfilehash: 3d537dc1a9e0bdf8cfba86dd24c7a5949d0d6c6d
ms.contentlocale: ja-jp
ms.lasthandoff: 05/08/2018

---
# <a name="apply-updates-to-an-on-premises-deployment"></a><span data-ttu-id="f14bd-103">オンプレミス配置への更新プログラムの適用</span><span class="sxs-lookup"><span data-stu-id="f14bd-103">Apply updates to an on-premises deployment</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="f14bd-104">このトピックでは、Microsoft Dynamics 365 for Finance and Operations のオンプレミス展開に、サポートされている更新を適用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-104">This topic explains how to apply supported updates to an on-premises deployment of Microsoft Dynamics 365 for Finance and Operations.</span></span> <span data-ttu-id="f14bd-105">オンプレミス環境でのすべての更新には Microsoft Dynamics Lifecycle Services (LCS) を通じて行われます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-105">All updates to on-premises environments are done through Microsoft Dynamics Lifecycle Services (LCS).</span></span>

## <a name="search-for-and-download-updates"></a><span data-ttu-id="f14bd-106">更新プログラムの検索とダウンロード</span><span class="sxs-lookup"><span data-stu-id="f14bd-106">Search for and download updates</span></span>
<span data-ttu-id="f14bd-107">オンプレミス環境に適用できる更新プログラムを検索する方法の詳細については、[問題検索](../lifecycle-services/issue-search-lcs.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-107">For more information about how to find the updates that you can apply to your on-premises environment, see [Issue search](../lifecycle-services/issue-search-lcs.md).</span></span> <span data-ttu-id="f14bd-108">LCS の**環境の詳細**ページの**更新**セクションで、タイルから更新プログラムをダウンロードする方法の詳細については、[更新プログラムをダウンロード](../migration-upgrade/download-hotfix-lcs.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-108">For information about how to download updates from the tiles in the **Updates** section of the **Environment details** page in LCS, see [Download updates](../migration-upgrade/download-hotfix-lcs.md).</span></span>
   
> [!NOTE]
> <span data-ttu-id="f14bd-109">オンプレミス環境を更新するときは、常に**環境** 詳細ページの更新タイルから更新プログラムを選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-109">When you are updating an on-premises environment, always select updates from the update tiles on the **Environment** details page.</span></span> <span data-ttu-id="f14bd-110">別の場所からの更新を選択した場合、更新が機能しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-110">If you select updates from another location, the updates might not work.</span></span> 

## <a name="update-an-on-premises-deployment"></a><span data-ttu-id="f14bd-111">オンプレミス配置の更新</span><span class="sxs-lookup"><span data-stu-id="f14bd-111">Update an on-premises deployment</span></span>
<span data-ttu-id="f14bd-112">展開中または展開の完了後のいずれかのオンプレミス環境に対して、更新プログラムを適用することができます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-112">You can apply updates to an on-premises environment either during deployment or after the deployment is completed.</span></span>

<span data-ttu-id="f14bd-113">オンプレミス環境が展開されているときは、カスタム パッケージの展開を **詳細** 設定で選択することができます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-113">While an on-premises environment is being deployed, you can select to deploy a custom package in the **Advanced** settings.</span></span> <span data-ttu-id="f14bd-114">カスタマイズまたはアプリケーション X++ の更新を適用する方法の詳細については、[カスタム モデルの開発とオンプレミス環境への配置](develop-deploy-custom-models-on-premises.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-114">For more information about how to apply customizations or application X++ updates, see [Develop and Deploy custom models to on-premises environments](develop-deploy-custom-models-on-premises.md).</span></span>

<span data-ttu-id="f14bd-115">オンプレミス環境の展開後にオンプレミス環境に更新を適用するには、環境の **環境の詳細** ページにある **管理** で **更新プログラムを適用** を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-115">To apply updates to an on-premises environment after it has been deployed, in LCS, on the **Environment details** page for the environment, under **Maintain**, select **Apply updates**.</span></span>

> [!NOTE]
> <span data-ttu-id="f14bd-116">プラットフォーム更新プログラム 12 またはそれ以降の環境でのみ、展開後に更新プログラムを適用することができます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-116">You can apply updates after deployment only on environments that have Platform update 12 or later.</span></span> <span data-ttu-id="f14bd-117">環境には、LCS で使用可能なローカル エージェントの最新バージョンも必要です。</span><span class="sxs-lookup"><span data-stu-id="f14bd-117">The environment must also have the latest version of the local agent available in LCS.</span></span> <span data-ttu-id="f14bd-118">詳細については、「[ローカル エージェントの更新](../lifecycle-services/update-local-agent.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-118">For more information, see [Update the local agent](../lifecycle-services/update-local-agent.md).</span></span> <span data-ttu-id="f14bd-119">プラットフォーム更新プログラム 12 よりも古いプラットフォームのバージョンを使用している場合は、すでに展開されている環境を再構成して、カスタマイズを更新したり、最新のプラットフォーム リリースに更新したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-119">If you're on a platform version that is older than Platform update 12, you can reconfigure an environment that is already deployed to update the customizations or update to the latest platform release.</span></span> <span data-ttu-id="f14bd-120">環境を再配置する方法の詳細については、 [オンプレミス環境を再配置](redeploy-on-prem.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-120">For more information about how to redeploy an environment, see [Redeploy an on-premises environment](redeploy-on-prem.md).</span></span>

## <a name="apply-application-or-binary-updates-through-lcs"></a><span data-ttu-id="f14bd-121">アプリケーションまたは LCS を通じてバイナリ更新プログラムを適用します</span><span class="sxs-lookup"><span data-stu-id="f14bd-121">Apply application or binary updates through LCS</span></span>
<span data-ttu-id="f14bd-122">次の手順を使用して、X++、すべてのバイナリ、またはプラットフォーム バイナリの更新プログラムを適用できます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-122">The following steps can be used to apply X++, All Binary, or Platform Binary updates.</span></span> <span data-ttu-id="f14bd-123">1 つのプラットフォーム リリースから別に移動する方法の詳細については、このトピックで後述する「最新のプラットフォーム更新プログラムの適用」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-123">For information about how to move from one platform release to another, see the "Apply the latest platform update" section later in this topic.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f14bd-124">更新のアプリケーションには、環境のダウンタイムが必要です。</span><span class="sxs-lookup"><span data-stu-id="f14bd-124">The application of updates requires downtime for your environment.</span></span> <span data-ttu-id="f14bd-125">したがって、更新中に環境内でビジネス トランザクションを実行することはできません。</span><span class="sxs-lookup"><span data-stu-id="f14bd-125">Therefore, no business transactions can be performed in the environment during the update.</span></span> <span data-ttu-id="f14bd-126">次の手順を完了したら、システムが使用されていないことと、公式ダウンタイム通知システムがすべてのシステム ユーザーに通知済みであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-126">When you complete the following steps, verify that the system isn't being used, and that an official downtime notice has been communicated to all system users.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="f14bd-127">前提条件</span><span class="sxs-lookup"><span data-stu-id="f14bd-127">Prerequisites</span></span>
- <span data-ttu-id="f14bd-128">開始する前に、Management Reporter (MR)、Microsoft Dynamics AX、および Microsoft SQL Server Reporting Services (SSRS データベース) の完全バックアップを完了してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-128">Before you begin, complete a full backup of the Management Reporter (MR), Microsoft Dynamics AX, and Microsoft SQL Server Reporting Services (SSRS databases).</span></span> <span data-ttu-id="f14bd-129">コードは LCS を通じて復元されますが、データが失われないよう保証するためにデータベースを手動で復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-129">Although the code is restored through LCS, the database must be manually restored to help guarantee that there is no data loss.</span></span>
- <span data-ttu-id="f14bd-130">環境をプラットフォーム更新プログラム 12 の最新ビルドに更新します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-130">Update your environment to the latest build of Platform update 12.</span></span>
- <span data-ttu-id="f14bd-131">ローカル エージェントを最新バージョンに更新します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-131">Update the local agent to the latest version.</span></span> <span data-ttu-id="f14bd-132">詳細については、「[ローカル エージェントの更新](../lifecycle-services/update-local-agent.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-132">For more information, see [Update the local agent](../lifecycle-services/update-local-agent.md).</span></span>
- <span data-ttu-id="f14bd-133">更新のタイプに応じて、以下の手順を実行して配置可能パッケージを生成します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-133">Depending on the type of update, complete the following steps to generate a deployable package:</span></span>

    - <span data-ttu-id="f14bd-134">**アプリケーションのバイナリ更新** - [ダウンロード更新 wiki](../migration-upgrade/download-hotfix-lcs.md) の手順に従って、LCS のアセット ライブラリに直接アップデートをダウンロードまたは保存します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-134">**Application binary updates** – Download or save the update directly to the Asset library in LCS by following the steps in [Download updates wiki](../migration-upgrade/download-hotfix-lcs.md).</span></span>
    - <span data-ttu-id="f14bd-135">**アプリケーションの X++ 更新** - 開発環境に必要な修正プログラムをダウンロードし、[ランタイム環境に適用するためには、モデルの配置可能なパッケージを作成する](create-apply-deployable-package.md) の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="f14bd-135">**Application X++ updates** – Download the required hotfix to your development environment, and then follow the steps in [Create a deployable package of your models in order to apply it to a runtime environment](create-apply-deployable-package.md).</span></span>
    - <span data-ttu-id="f14bd-136">**カスタマイズ** - [カスタムモデルの開発と展開](develop-deploy-custom-models-on-premises.md) の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="f14bd-136">**Customizations** – Follow the steps in [Develop and deploy custom models](develop-deploy-custom-models-on-premises.md).</span></span>

### <a name="update-a-sandbox-environment"></a><span data-ttu-id="f14bd-137">サンドボックス環境の更新</span><span class="sxs-lookup"><span data-stu-id="f14bd-137">Update a sandbox environment</span></span>
1. <span data-ttu-id="f14bd-138">LCS アセット ライブラリで、このトピックの「前提条件」のセクションで生成された配置可能パッケージを、 **ソフトウェア配置可能パッケージ**  タブにアップロードします。</span><span class="sxs-lookup"><span data-stu-id="f14bd-138">In the LCS Asset library, upload the deployable package that was generated in the "Prerequisites" section of this topic to the **Software deployable packages** tab.</span></span>
2. <span data-ttu-id="f14bd-139">LCS で、オンプレミスの実装プロジェクト開き、更新する環境の**環境の詳細**ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-139">In LCS, open the on-premises implementation project, and then open the **Environment details** page of the environment to update.</span></span>
3. <span data-ttu-id="f14bd-140">**管理** で、**更新プログラムを適用** を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-140">Under **Maintain**, select **Apply updates**.</span></span> <span data-ttu-id="f14bd-141">ダイアログ ボックスでは、アセット ライブラリにアップロードされた更新を表示します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-141">A dialog box shows the updates that were uploaded to the Asset library.</span></span> <span data-ttu-id="f14bd-142">アセット ライブラリで**有効**としてマークされているパッケージのみが表示されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-142">Note that only packages that are marked as **Valid** in the Asset library appear.</span></span>
4. <span data-ttu-id="f14bd-143">更新プログラムを選択し、**適用** を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-143">Select the update, and then select **Apply**.</span></span>
5. <span data-ttu-id="f14bd-144">確認メッセージで**はい**を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-144">In the confirmation message, select **Yes**.</span></span> <span data-ttu-id="f14bd-145">この環境でサービス操作が開始されました。</span><span class="sxs-lookup"><span data-stu-id="f14bd-145">The servicing operation has started on this environment.</span></span>

    <span data-ttu-id="f14bd-146">環境の状態は、**配置済み** から **準備** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-146">The environment state is changed from **Deployed** to **Preparation**.</span></span> <span data-ttu-id="f14bd-147">**準備**段階中では、実際の配置がまだ開始されていません。</span><span class="sxs-lookup"><span data-stu-id="f14bd-147">During the **Preparation** stage, the actual deployment hasn't yet started.</span></span> <span data-ttu-id="f14bd-148">したがって、準備ができなくても、オンプレミス環境には触れずに使用することができます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-148">Therefore, even if preparation fails, the on-premises environment isn't touched and can be used.</span></span>

    >[!NOTE]
    > <span data-ttu-id="f14bd-149">**準備**ステージがオンプレミス環境に直接関連付けしなくても、この時はトランザクションを実行しない環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f14bd-149">Even though the **Preparation** stage doesn't directly touch the on-premises environment, we recommend that you not use the environment to perform transactions during this time.</span></span>

    <span data-ttu-id="f14bd-150">準備が完了したら、環境の状態は **準備**から **配置中** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-150">When the preparation is completed, the environment state is changed from **Preparation** to **Deploying**.</span></span>

    <span data-ttu-id="f14bd-151">更新が完了すると、環境状態は**展開**に戻されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-151">After the update is completed, the environment state is changed back to **Deployed**.</span></span> <span data-ttu-id="f14bd-152">更新プログラムの適用に失敗したとき、環境状態は **失敗** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-152">If application of the update fails, the environment state is changed to **Failed**.</span></span> <span data-ttu-id="f14bd-153">パッケージ アプリケーションが失敗する場合に行う操作の詳細については、このトピックで後述の「更新が失敗したアプリケーションを解決する」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-153">For information about what to do if package application fails, see the "Resolve a failed update application" section later in this topic.</span></span>

6. <span data-ttu-id="f14bd-154">環境で実行された操作を表示するには、**履歴**および**環境の詳細**ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-154">Open the **History** and **Environment details** pages to view the operations that were performed on the environment.</span></span> <span data-ttu-id="f14bd-155">展開、サービス、およびロールバックなど、環境で実行された主要なアクションのレコードを表示することもできます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-155">You can also view a record of major actions that were performed on the environment, such as deployments, servicing, and rollbacks.</span></span>

### <a name="update-a-production-environment"></a><span data-ttu-id="f14bd-156">実稼動環境の更新</span><span class="sxs-lookup"><span data-stu-id="f14bd-156">Update a production environment</span></span>
<span data-ttu-id="f14bd-157">実稼働環境を更新する前に、サンドボックス環境でパッケージ アプリケーションの更新を正常に完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-157">Before you update a production environment, you must successfully complete the package application update on a sandbox environment.</span></span>

1. <span data-ttu-id="f14bd-158">パッケージを適用しているサンドボックス環境のプロジェクトで、アセット ライブラリを開いてから、**ソフトウェア配置可能パッケージ** タブでパッケージを選択し、**リリース候補**としてマークします。</span><span class="sxs-lookup"><span data-stu-id="f14bd-158">In the project for the sandbox environment that you applied the package to, open the Asset library, and then, on the **Software deployable packages** tab, select the package, and mark it as a **Release candidate**.</span></span>
2. <span data-ttu-id="f14bd-159">**環境の詳細**ページで、**メンテナンス**の下にある、**更新プログラムの適用**を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-159">On the **Environment details** page, under **Maintain**, select **Apply updates**.</span></span> <span data-ttu-id="f14bd-160">ダイアログ ボックスでは、**リリース候補**としてマークされたパッケージのみ表示されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-160">In the dialog box, only packages that are marked as a **Release candidate** are shown.</span></span>
3. <span data-ttu-id="f14bd-161">確認メッセージで**はい**を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-161">In the confirmation message, select **Yes**.</span></span>

    <span data-ttu-id="f14bd-162">サンドボックス環境を更新するときに、環境状態は**展開**から**準備**に変更されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-162">As when you updated the sandbox environment, the environment state is changed from **Deployed** to **Preparation**.</span></span> <span data-ttu-id="f14bd-163">**準備**段階中では、実際の配置がまだ開始されていません。</span><span class="sxs-lookup"><span data-stu-id="f14bd-163">During the **Preparation** stage, the actual deployment hasn't yet started.</span></span> <span data-ttu-id="f14bd-164">したがって、準備ができなくても、オンプレミス環境には触れずに使用することができます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-164">Therefore, even if preparation fails, the on-premises environment isn't touched and can be used.</span></span>

    >[!NOTE]
    > <span data-ttu-id="f14bd-165">**準備**ステージがオンプレミス環境に直接関連付けしなくても、この時はトランザクションを実行しない環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f14bd-165">Even though the **Preparation** stage doesn't directly touch the on-premises environment, we recommend that you not use the environment to perform transactions during this time.</span></span>

    <span data-ttu-id="f14bd-166">準備が完了したら、環境の状態は **準備**から **配置中** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-166">When the preparation is completed, the environment state is changed from **Preparation** to **Deploying**.</span></span>

    <span data-ttu-id="f14bd-167">更新が完了すると、環境状態は**展開**に戻されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-167">After the update is completed, the environment state is changed back to **Deployed**.</span></span> <span data-ttu-id="f14bd-168">更新プログラムの適用に失敗したとき、環境状態は **失敗** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-168">If application of the update fails, the environment state is changed to **Failed**.</span></span> <span data-ttu-id="f14bd-169">パッケージ アプリケーションが失敗する場合に行う操作の詳細については、このトピックで後述の「更新が失敗したアプリケーションを解決する」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-169">For information about what to do if package application fails, see the "Resolve a failed update application" section later in this topic.</span></span>

4. <span data-ttu-id="f14bd-170">環境で実行された操作を表示するには、**履歴**および**環境の詳細**ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-170">Open the **History** and **Environment details** pages to view the operations that were performed on the environment.</span></span> <span data-ttu-id="f14bd-171">展開、サービス、およびロールバックなど、環境で実行された主要なアクションのレコードを表示することもできます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-171">You can also view a record of major actions that were performed on the environment, such as deployments, servicing, and rollbacks.</span></span>

## <a name="resolve-a-failed-update-application"></a><span data-ttu-id="f14bd-172">更新が失敗したアプリケーションを解決</span><span class="sxs-lookup"><span data-stu-id="f14bd-172">Resolve a failed update application</span></span>
<span data-ttu-id="f14bd-173">更新プログラムの適用に失敗したとき、環境状態は **失敗** です。</span><span class="sxs-lookup"><span data-stu-id="f14bd-173">When application of an update fails, the environment state is **Failed**.</span></span> <span data-ttu-id="f14bd-174">最初のステップは、更新アプリケーションが失敗した理由を特定することです。</span><span class="sxs-lookup"><span data-stu-id="f14bd-174">The first step is to determine why the update application failed.</span></span> <span data-ttu-id="f14bd-175">ログの場所は、エラーが発生したステージによって異なります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-175">The location of the logs varies, depending on the stage where the failure occurred:</span></span>

- <span data-ttu-id="f14bd-176">**準備段階:** **準備**段階で操作が失敗すると、ログが LCS にアップロードされます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-176">**Preparation stage:** If the operation fails during the **Preparation** stage, the logs are uploaded to LCS.</span></span> <span data-ttu-id="f14bd-177">ログ ファイルで、**ログをダウンロード**を選択してログ ファイルをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="f14bd-177">In the log files, select **Download logs** to download the log files.</span></span> <span data-ttu-id="f14bd-178">パッケージに結合の問題があった場合、エラーがログ ファイルに含まれます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-178">If the package has any merge issues, the error is included in the log file.</span></span>
- <span data-ttu-id="f14bd-179">**配置ステージ:** **配置**ステージで操作が失敗すると、ログはオンプレミス環境にあります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-179">**Deploying stage:** If the operation fails during the **Deploying** stage, the logs are located in the on-premises environment.</span></span> <span data-ttu-id="f14bd-180">この環境にサインインした後、ログとイベント ビューアーにアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-180">You must sign in to the environment, and then access the logs and event viewer.</span></span>

<span data-ttu-id="f14bd-181">トラブルシューティング ログの使用方法の詳細については、[Dynamics 365 for Finance and Operations オンプレミスのトラブルシューティング](troubleshoot-on-prem.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-181">For more information about how to use the troubleshooting logs, see [Troubleshoot Dynamics 365 for Finance and Operations on-premises](troubleshoot-on-prem.md).</span></span>

<span data-ttu-id="f14bd-182">ログを確認しエラーの原因を特定すると、次のいずれかの操作を実行して環境を正常な状態に復元します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-182">After you review the logs and determine the cause of the failure, complete one of the following operations to restore the environment to a healthy state.</span></span> <span data-ttu-id="f14bd-183">**失敗**状態の環境で実行できるアクションはありません。</span><span class="sxs-lookup"><span data-stu-id="f14bd-183">No actions can be performed on an environment that is in a **Failed** state.</span></span> <span data-ttu-id="f14bd-184">まず、環境を正常な状態に戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-184">The environment must first be restored to a healthy state.</span></span>

- <span data-ttu-id="f14bd-185">**失敗した操作の再試行** – アプリケーションの更新に失敗した場合は、**再試行** を選択し、失敗した操作から復旧させます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-185">**Retry failed operation** – If update application fails, select **Retry** to recover from the failed operation.</span></span>
- <span data-ttu-id="f14bd-186">**更新をロールバック** – 失敗した更新をロールバックするには、**ロールバック**を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-186">**Roll back the update** – To roll back the update that failed, select **Rollback**.</span></span> <span data-ttu-id="f14bd-187">ロールバックを開始する前に、最新の問題のない状態にデータベースを復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-187">Before you start the rollback, you must restore the database to the last known good state.</span></span> <span data-ttu-id="f14bd-188">**ロールバック** を選択すると、環境は最後の正常な状態に復元されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-188">When you select **Rollback**, the environment is restored to the last known good state.</span></span> <span data-ttu-id="f14bd-189">環境の状態は、**準備** に変更され、次に **配置中** に変更され、次に **配置済み** または **失敗** に変更されます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-189">The environment state is then changed to **Preparation**, then to **Deploying**, and then to either **Deployed** or **Failed**.</span></span>

    >[!NOTE]
    > <span data-ttu-id="f14bd-190">**ロールバック** ボタンは、データベースをロールバックしません。</span><span class="sxs-lookup"><span data-stu-id="f14bd-190">The **Rollback** button doesn't roll back the database.</span></span> <span data-ttu-id="f14bd-191">ユーザーは、更新プログラムの適用の前に行ったと分かっている最後のバックアップに、データベースを復元する責任があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-191">You're responsible for restoring the database to the last known backup that was made before update application.</span></span> <span data-ttu-id="f14bd-192">このステップは、データの損失がないことを保証するために重要です。</span><span class="sxs-lookup"><span data-stu-id="f14bd-192">This step is critical to help guarantee that there is no data loss.</span></span>

- <span data-ttu-id="f14bd-193">**状態の更新** – **準備**段階で更新アプリケーションが失敗すると、障害は LCS 側にあり、更新アプリケーションはまだ起動していません。</span><span class="sxs-lookup"><span data-stu-id="f14bd-193">**Refresh the state** – If update application fails during the **Preparation** stage, the failure is on the LCS side, and update application hasn't yet started.</span></span> <span data-ttu-id="f14bd-194">したがって、オンプレミス環境は良好な状態です。</span><span class="sxs-lookup"><span data-stu-id="f14bd-194">Therefore, the on-premises environment is in a good state.</span></span> <span data-ttu-id="f14bd-195">LCS 環境の状態を **Deployed** に戻すには、プロジェクト ダッシュボード ページで **更新** を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-195">To restore the LCS environment state to **Deployed**, on the project dashboard page, select **Refresh**.</span></span>
- <span data-ttu-id="f14bd-196">**環境の削除と再配置** - 再試行とロールバックのオプションが機能しない場合は、環境を削除して再配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-196">**Delete and redeploy an environment** – If the retry and rollback options don't work, you must delete and redeploy the environment.</span></span> <span data-ttu-id="f14bd-197">環境を削除するには、[プロジェクト ダッシュボード] ページで **削除** を選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-197">To delete the environment, on the project dashboard page, select **Delete**.</span></span> <span data-ttu-id="f14bd-198">次に、環境を構成するオプションを表示します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-198">You then see the option to configure the environment.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="f14bd-199">このオプションは実稼働環境では使用**しない**でください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-199">This option should **not** be used on a production environment.</span></span> <span data-ttu-id="f14bd-200">ただし、環境を正常な状態に復元するサンドボックス環境で使用できます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-200">However, it can be used on a sandbox deployment to restore the environment to a healthy state.</span></span> 
    
    > <span data-ttu-id="f14bd-201">このオプションは環境を新規に配置することを必要とするため、以前に適用された更新は失われます。</span><span class="sxs-lookup"><span data-stu-id="f14bd-201">Because this option requires that you do a fresh deployment of the environment, you lose any updates that were previously applied.</span></span> <span data-ttu-id="f14bd-202">カスタマイズおよびバイナリ更新プログラムは、環境に再適用される必要があります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-202">Any customizations and binary updates must be reapplied to the environment.</span></span>

## <a name="apply-the-latest-platform-update"></a><span data-ttu-id="f14bd-203">最新のプラットフォーム更新プログラムを適用</span><span class="sxs-lookup"><span data-stu-id="f14bd-203">Apply the latest platform update</span></span> 
<span data-ttu-id="f14bd-204">最新のプラットフォーム アップデートを適用する方法は2つあります。</span><span class="sxs-lookup"><span data-stu-id="f14bd-204">There are two ways to apply the latest platform update:</span></span>

- <span data-ttu-id="f14bd-205">新しい環境を展開し、展開中に最新のプラットフォーム更新トポロジを選択します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-205">Deploy a new environment, and select the latest platform update topology during deployment.</span></span> <span data-ttu-id="f14bd-206">次に、環境を配備するための通常の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="f14bd-206">Then follow the usual steps for deploying an environment.</span></span>
- <span data-ttu-id="f14bd-207">環境を再配置することにより、既存の環境を最新の更新プログラムで更新する</span><span class="sxs-lookup"><span data-stu-id="f14bd-207">Update an existing environment with the latest update by redeploying the environment.</span></span> <span data-ttu-id="f14bd-208">環境を再配置する方法の詳細については、 [オンプレミス環境を再配置](redeploy-on-prem.md) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f14bd-208">For more information about how to redeploy an environment, see [Redeploy an on-premises environment](redeploy-on-prem.md).</span></span>

