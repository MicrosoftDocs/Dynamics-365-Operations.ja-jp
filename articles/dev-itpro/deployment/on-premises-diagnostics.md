---
title: オンプレミス診断
description: このトピックでは、Microsoft Dynamics 365 for Finance and Operations のオンプレミス配置の診断データを公開するための情報を提供します。
author: sarvanisathish
manager: AnnBe
ms.date: 08/08/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Developer, IT Pro
ms.reviewer: sericks
ms.search.scope: Operations
ms.custom: 60373
ms.assetid: ''
ms.search.region: Global
ms.author: sarvanis
ms.search.validFrom: 2018-04-20
ms.dyn365.ops.version: Platform Update 12
ms.openlocfilehash: 346c7c329772d591e925517b6f9ee7136152106c
ms.sourcegitcommit: 16bfa0fd08feec1647829630401ce62ce2ffa1a4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/02/2019
ms.locfileid: "1848105"
---
# <a name="on-premises-diagnostics"></a><span data-ttu-id="a2776-103">オンプレミス診断</span><span class="sxs-lookup"><span data-stu-id="a2776-103">On-premises diagnostics</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="a2776-104">Microsoft Dynamics 365 for Finance and Operations は、最新式の Azure Diagnostic Tool を使用して、クラウド ベースの顧客の機能を提供する Azure Services の正常性およびパフォーマンスを監視します。</span><span class="sxs-lookup"><span data-stu-id="a2776-104">The Microsoft Dynamics 365 for Finance and Operations team monitors the health and performance of the Azure Services that provide functionality for our cloud-based customers by using state-of-the-art Azure diagnostic tools.</span></span> <span data-ttu-id="a2776-105">Finance and Operations オンプレミスで実装し、オンプレミス ソリューションの正常性とパフォーマンスを監視できるようにするには、いくつかのサード パーティ製品が利用可能です。</span><span class="sxs-lookup"><span data-stu-id="a2776-105">For customers who have implemented Finance and Operations on-premises and would like to have the ability to monitor the health and performance of their on-premises solution, there are several third-party offerings available.</span></span> 

<span data-ttu-id="a2776-106">このトピックでは、Elastic Stack の設定とコンフィギュレーション、サード パーティ製品、およびオンプレミス ソリューションの診断モニタリングを提供できる多くの選択肢の 1 つについて説明します。</span><span class="sxs-lookup"><span data-stu-id="a2776-106">This topic describes the setup and configuration of Elastic Stack, a third-party product, and one of many choices that can provide  diagnostic monitoring of your on-premises solution.</span></span>

<span data-ttu-id="a2776-107">診断ソリューションを検討する際、次の実装の基礎を検討してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-107">When you consider a diagnostic solution, consider the following fundamentals of your implementation:</span></span>

- <span data-ttu-id="a2776-108">診断システムは、30 日分に相当する診断情報を収集し、格納できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-108">Your diagnostic system should be able to collect and store 30 days' worth of diagnostic information.</span></span>
- <span data-ttu-id="a2776-109">診断リポジトリは、多くのクライアント コンピューターで共有できるように中心的な場所に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-109">Your diagnostic repository should be set up in a central location that is sharable among many client computers.</span></span>
- <span data-ttu-id="a2776-110">イベント タイプ、分類、およびデータを含む構造化診断イベントを作成します。</span><span class="sxs-lookup"><span data-stu-id="a2776-110">Create structured diagnostics events, including event type, classification, and data.</span></span>
- <span data-ttu-id="a2776-111">未加工のテキスト (逆シリアル化) に格納されているイベントを簡単に照会および検索します。</span><span class="sxs-lookup"><span data-stu-id="a2776-111">Events stored in raw text (deserialized) can be easily queried and searched.</span></span>
- <span data-ttu-id="a2776-112">イベントに機密情報や個人データを格納しないでください。</span><span class="sxs-lookup"><span data-stu-id="a2776-112">Avoid storing sensitive or personal data in events.</span></span>

> [!NOTE]
> <span data-ttu-id="a2776-113">既定では、Elastic Stack クラスター内の通信は HTTPS 経由で送信されません。</span><span class="sxs-lookup"><span data-stu-id="a2776-113">By default, communication in an Elastic Stack cluster is not sent over HTTPS.</span></span> <span data-ttu-id="a2776-114">リスクを考慮し、それらのリスクの軽減策を準備または実装していない限り、Elastic スタックを設定しないでください。</span><span class="sxs-lookup"><span data-stu-id="a2776-114">Don't set up the Elastic Stack unless you've considered the risks, and prepared or implemented mitigations for those risks.</span></span> <span data-ttu-id="a2776-115">X-Pack の支払済バージョン は、Elastic Stack のコミュニケーションを暗号化するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-115">The paid version of X-Pack can be used to encrypt communication in the Elastic Stack.</span></span> <span data-ttu-id="a2776-116">設定の詳細については、クラスタでの TLS の設定を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-116">For setup information, see Setting up TLS on a cluster.</span></span> <span data-ttu-id="a2776-117">オープン ソース Elasticsearch プラグイン もあります。</span><span class="sxs-lookup"><span data-stu-id="a2776-117">There is also an open source Elasticsearch plug-in.</span></span> <span data-ttu-id="a2776-118">ドキュメントによると、Microsoft はこのプラグインをテストしていませんが、HTTPS を有効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-118">Although Microsoft hasn't tested this plug-in, according to the documentation, it can enable HTTPS.</span></span> <span data-ttu-id="a2776-119">Microsoft では、HTTPs、VPN、または別のセキュリティで保護された、暗号化されたプロトコルを使用して、暗号化された通信を常に使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a2776-119">Microsoft recommends that you always utilize encrypted communication using HTTPs, VPN, or another secure, encrypted protocol.</span></span> <span data-ttu-id="a2776-120">コンテンツにエンド ユーザー、顧客、個人または機密データが含まれている場合、多くの業界認定および法律では、暗号化された送信を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-120">Many industry certifications and laws require the use of encrypted transmission if your content includes end user, customer, personal, or sensitive data.</span></span>

## <a name="diagnostic-data-guidelines"></a><span data-ttu-id="a2776-121">診断データのガイドライン</span><span class="sxs-lookup"><span data-stu-id="a2776-121">Diagnostic data guidelines</span></span>
<span data-ttu-id="a2776-122">Microsoft Dynamics 365 for Finance and Operations の配置と実行を診断するためには、診断データへのアクセスが必要です。</span><span class="sxs-lookup"><span data-stu-id="a2776-122">To diagnose the deployment and execution of Microsoft Dynamics 365 for Finance and Operations, you must have access to diagnostic data.</span></span> <span data-ttu-id="a2776-123">クラウドの配置では、マイクロソフトは、サービスの診断データを保存して監視し、環境を健全に保ちます。</span><span class="sxs-lookup"><span data-stu-id="a2776-123">For a cloud deployment, Microsoft stores and monitors the diagnostic data from services to help keep the environment healthy.</span></span> <span data-ttu-id="a2776-124">オンプレミス配置に関しては、顧客がこのタスクを担当します。</span><span class="sxs-lookup"><span data-stu-id="a2776-124">For an on-premises deployment, the customer is responsible for this task.</span></span>

<span data-ttu-id="a2776-125">使用したい診断データ ストアおよびクエリ ツールを選択することができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-125">You can select the diagnostic data store and query tool that you prefer to use.</span></span> <span data-ttu-id="a2776-126">ただし、最低限、ツールは、次のタスクを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-126">However, at a minimum, the tool should perform the following tasks:</span></span>

- <span data-ttu-id="a2776-127">ストアは、30 日間分の診断データを格納できます。</span><span class="sxs-lookup"><span data-stu-id="a2776-127">The store should be able to store 30 days' worth of diagnostic data.</span></span>
- <span data-ttu-id="a2776-128">イベントが集約される場所に格納されると、サポート エンジニアは問題に関連するイベントを検索する複数のマシン間を切り替える必要がありません。</span><span class="sxs-lookup"><span data-stu-id="a2776-128">The events should be stored in a centralized location, so that support engineers don't have to switch between multiple machines to find events that are relevant to an issue.</span></span>
- <span data-ttu-id="a2776-129">イベントは、イベント タイプおよびイベント データに基づいて、発見が可能です。</span><span class="sxs-lookup"><span data-stu-id="a2776-129">The events should be discoverable based on event type and event data.</span></span>
- <span data-ttu-id="a2776-130">イベント データ (XML 形式) では、逆シリアル化すると、イベント データを照会および移動が可能です。</span><span class="sxs-lookup"><span data-stu-id="a2776-130">The event data (in XML format) should be deserialized so that the event data can be queried on and traversed.</span></span>

## <a name="elastic-stack-example"></a><span data-ttu-id="a2776-131">Elastic スタックの例</span><span class="sxs-lookup"><span data-stu-id="a2776-131">Elastic Stack example</span></span>
<span data-ttu-id="a2776-132">前のセクションに表示されている診断データのガイドラインを満たすため、Microsoft は Elastic スタックの設定をテストしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-132">To meet the diagnostic data guidelines that are listed in the previous section, Microsoft tested the Elastic Stack setup.</span></span> <span data-ttu-id="a2776-133">この設定には次のコンポーネントが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a2776-133">This setup includes the following components:</span></span>

- <span data-ttu-id="a2776-134">**Elasticsearch** – ストレージ、イベント インデックス作成、およびイベント クエリの実行。</span><span class="sxs-lookup"><span data-stu-id="a2776-134">**Elasticsearch** – For storage, event indexing, and event querying.</span></span> <span data-ttu-id="a2776-135">Elasticsearch の詳細については、[Elastic Web サイト](https://www.elastic.co/products/elasticsearch)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-135">For more information about Elasticsearch, see the [Elastic website](https://www.elastic.co/products/elasticsearch).</span></span>
- <span data-ttu-id="a2776-136">**Logstash** – 負荷分散およびイベント データ変換用。</span><span class="sxs-lookup"><span data-stu-id="a2776-136">**Logstash** – For load distribution and event data transformation.</span></span>
- <span data-ttu-id="a2776-137">**Winlogbeat** – 診断データ収集用。</span><span class="sxs-lookup"><span data-stu-id="a2776-137">**Winlogbeat** – For diagnostic data collection.</span></span>
- <span data-ttu-id="a2776-138">**Kibana** – Elasticsearch に格納されているデータを照会するためのインタフェース。</span><span class="sxs-lookup"><span data-stu-id="a2776-138">**Kibana** – An interface for querying the data that is stored in Elasticsearch.</span></span>

> [!NOTE]
> <span data-ttu-id="a2776-139">既定では、Elastic Stack クラスター内の通信は HTTPS 経由で送信され**ない**ようになっています。</span><span class="sxs-lookup"><span data-stu-id="a2776-139">By default, communication in an Elastic Stack cluster is **not** sent over HTTPS.</span></span> <span data-ttu-id="a2776-140">リスクを考慮し、それらのリスクの軽減策を準備または実装していない限り、Elastic スタックを設定しないでください。</span><span class="sxs-lookup"><span data-stu-id="a2776-140">Don't set up the Elastic Stack unless you've considered the risks, and prepared or implemented mitigations for those risks.</span></span> <span data-ttu-id="a2776-141">X-Pack の[支払済バージョン](https://www.elastic.co/subscriptions) は、Elastic Stack のコミュニケーションを暗号化するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-141">The [paid version](https://www.elastic.co/subscriptions) of X-Pack can be used to encrypt communication in the Elastic Stack.</span></span> <span data-ttu-id="a2776-142">設定の詳細については、[クラスタでの TLS の設定](https://www.elastic.co/guide/en/x-pack/current/ssl-tls.html)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-142">For setup information, see [Setting up TLS on a cluster](https://www.elastic.co/guide/en/x-pack/current/ssl-tls.html).</span></span> <span data-ttu-id="a2776-143">オープン ソース [Elasticsearch プラグイン](https://github.com/floragunncom/search-guard-ssl) もあります。</span><span class="sxs-lookup"><span data-stu-id="a2776-143">There is also an open source [Elasticsearch plug-in](https://github.com/floragunncom/search-guard-ssl).</span></span> <span data-ttu-id="a2776-144">ドキュメントによると、Microsoft はこのプラグインをテストしていませんが、HTTPS を有効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-144">Although Microsoft hasn't tested this plug-in, according to the documentation, it can enable HTTPS.</span></span>

<span data-ttu-id="a2776-145">Elastic スタックを展開する場合、このトピックで説明されている手順を実行するなら異なる経験になるかもしれません。</span><span class="sxs-lookup"><span data-stu-id="a2776-145">If you deploy the Elastic Stack, your experience might vary if you follow the steps that are described in this topic.</span></span> <span data-ttu-id="a2776-146">テストでは、Microsoft は、Elastic Stack コンポーネントのバージョン 6.2.3 と、Microsoft Dynamics 365 for Finance and Operations 7.3 およびプラットフォーム更新プログラム 12 を使用しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-146">For its tests, Microsoft used version 6.2.3 of the Elastic Stack components and Microsoft Dynamics 365 for Finance and Operations 7.3 with platform update 12.</span></span>

<span data-ttu-id="a2776-147">このトピックでは、Elastic Stack が Finance and Operations のオンプレミス配置のために動作するために必要な設定、およびコンフィギュレーションの手順を Microsoft がどのように処理したかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="a2776-147">This topic describes how Microsoft handled the setup and configuration steps that are required for the Elastic Stack to work for a on-premises deployment of Finance and Operations.</span></span> <span data-ttu-id="a2776-148">Finance and Operations に関連していないガイダンスについては、Elastic.co のドキュメントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-148">For guidance that isn't related to Finance and Operations, see the documentation on Elastic.co.</span></span>

## <a name="install-and-configure-the-elastic-stack"></a><span data-ttu-id="a2776-149">Elastic スタックのインストールと構成</span><span class="sxs-lookup"><span data-stu-id="a2776-149">Install and configure the Elastic Stack</span></span>
<span data-ttu-id="a2776-150">Winlogbeat を除くすべての Elastic スタックのホストされているコンポーネントはすべて Java 上で動作します。</span><span class="sxs-lookup"><span data-stu-id="a2776-150">All hosted components of the Elastic Stack, except Winlogbeat, run on Java.</span></span> <span data-ttu-id="a2776-151">テスト シナリオでは、Microsoft は最初に Elasticsearch、Logstash、または Kibana (つまり、すべてのオーケストレータ ノード) を実行する各ノードに、Java ランタイム環境 (JRE) 8 (64 ビット) の最新バージョンをダウンロードしてインストールしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-151">For the test scenario, Microsoft first downloaded and installed the latest version of Java Runtime Environment (JRE) 8 (64-bit) on each node that will run Elasticsearch, Logstash, or Kibana (that is, all the Orchestrator nodes).</span></span> <span data-ttu-id="a2776-152">[https://www.oracle.com/technetwork/java/javase/downloads/index.html](https://www.oracle.com/technetwork/java/javase/downloads/index.html) から Java 8 を取得することができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-152">You can get Java 8 from [https://www.oracle.com/technetwork/java/javase/downloads/index.html](https://www.oracle.com/technetwork/java/javase/downloads/index.html).</span></span>

<span data-ttu-id="a2776-153">2018 年 6 月現在、Elastic スタックは Java 8 で実行します。</span><span class="sxs-lookup"><span data-stu-id="a2776-153">As of June 2018, the Elastic Stack runs on Java 8.</span></span> <span data-ttu-id="a2776-154">Java の新しいバージョンで実行しようとすると、すべてが動作しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-154">Any attempt to run it on a newer version of Java might not work.</span></span>

> [!NOTE]
> <span data-ttu-id="a2776-155">Linux では、Winlogbeat を除く、全体の Elastic Stack をホストできます。</span><span class="sxs-lookup"><span data-stu-id="a2776-155">The whole Elastic Stack, except Winlogbeat, can be hosted on Linux.</span></span> <span data-ttu-id="a2776-156">テストでは、Microsoft が Microsoft Windows サーバー 2016 の仮想マシン (Vm) のスタックをホストしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-156">For its tests, Microsoft hosted the stack on Microsoft Windows Server 2016 virtual machines (VMs).</span></span>

<span data-ttu-id="a2776-157">各ノード上のさまざまなコンポーネントのファイアウォールで、ポートを開くことを忘れないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="a2776-157">Remember to open ports in the firewall for the various components on each node.</span></span>

<span data-ttu-id="a2776-158">設定中に行き詰まった場合、Elastic.co には Elastic スタックのインストールとコンフィギュレーションについての広範かつ適切なドキュメントがあります。</span><span class="sxs-lookup"><span data-stu-id="a2776-158">If you get stuck during setup, Elastic.co has extensive and well-written documentation about the installation and configuration of the Elastic Stack.</span></span> <span data-ttu-id="a2776-159">特定のタイプのエラーについては、Web 検索で Elastic.co フォーラムと StackOverflow の両方から信頼性の高い結果が得られます。</span><span class="sxs-lookup"><span data-stu-id="a2776-159">For help with specific types of errors, web searches yield reliable results from both the Elastic.co forum and StackOverflow.</span></span>

### <a name="component-matrix"></a><span data-ttu-id="a2776-160">コンポーネントのマトリックス</span><span class="sxs-lookup"><span data-stu-id="a2776-160">Component matrix</span></span>
<span data-ttu-id="a2776-161">テストでは、マイクロソフトは、小規模から中規模の Finance and Operations 配置用の次の設定を使用しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-161">For its tests, Microsoft used the following setup for a small to medium-sized Finance and Operations deployment.</span></span>

| <span data-ttu-id="a2776-162">ノード</span><span class="sxs-lookup"><span data-stu-id="a2776-162">Node</span></span>            | <span data-ttu-id="a2776-163">Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="a2776-163">Elasticsearch</span></span> | <span data-ttu-id="a2776-164">Logstash</span><span class="sxs-lookup"><span data-stu-id="a2776-164">Logstash</span></span> | <span data-ttu-id="a2776-165">Kibana</span><span class="sxs-lookup"><span data-stu-id="a2776-165">Kibana</span></span> | <span data-ttu-id="a2776-166">Winlogbeat</span><span class="sxs-lookup"><span data-stu-id="a2776-166">Winlogbeat</span></span> |
|-----------------|---------------|----------|--------|------------|
| <span data-ttu-id="a2776-167">オーケストレータ #1</span><span class="sxs-lookup"><span data-stu-id="a2776-167">Orchestrator #1</span></span> | <span data-ttu-id="a2776-168">x</span><span class="sxs-lookup"><span data-stu-id="a2776-168">X</span></span>             |          |        | <span data-ttu-id="a2776-169">x</span><span class="sxs-lookup"><span data-stu-id="a2776-169">X</span></span>          |
| <span data-ttu-id="a2776-170">オーケストレータ #2</span><span class="sxs-lookup"><span data-stu-id="a2776-170">Orchestrator #2</span></span> | <span data-ttu-id="a2776-171">x</span><span class="sxs-lookup"><span data-stu-id="a2776-171">X</span></span>             | <span data-ttu-id="a2776-172">x</span><span class="sxs-lookup"><span data-stu-id="a2776-172">X</span></span>        |        | <span data-ttu-id="a2776-173">x</span><span class="sxs-lookup"><span data-stu-id="a2776-173">X</span></span>          |
| <span data-ttu-id="a2776-174">オーケストレータ #3</span><span class="sxs-lookup"><span data-stu-id="a2776-174">Orchestrator #3</span></span> |               | <span data-ttu-id="a2776-175">x</span><span class="sxs-lookup"><span data-stu-id="a2776-175">X</span></span>        | <span data-ttu-id="a2776-176">x</span><span class="sxs-lookup"><span data-stu-id="a2776-176">X</span></span>      | <span data-ttu-id="a2776-177">x</span><span class="sxs-lookup"><span data-stu-id="a2776-177">X</span></span>          |
| <span data-ttu-id="a2776-178">AOS #1...*n*</span><span class="sxs-lookup"><span data-stu-id="a2776-178">AOS #1...*n*</span></span>    |               |          |        | <span data-ttu-id="a2776-179">x</span><span class="sxs-lookup"><span data-stu-id="a2776-179">X</span></span>          |

> [!IMPORTANT]
> <span data-ttu-id="a2776-180">Microsoft は、テスト目的で、ELK インストールのために オーケストレータ機械を使用しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-180">For testing purposes, Microsoft used the Orchestrator machines for the ELK installation.</span></span> <span data-ttu-id="a2776-181">オーケストレーション サービスから重要なリソースを奪う可能性があるため、実稼動環境または重要なサンドボックス環境で ELK のインストールにオーケストレータ マシンを使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="a2776-181">Because it can take up critical resources from the Orchestration services, don't use the Orchestrator machines for ELK installations on production environments or critical Sandbox Environments.</span></span> <span data-ttu-id="a2776-182">代わりに、別のマシンを使用して ELK サービスをホストします。</span><span class="sxs-lookup"><span data-stu-id="a2776-182">Instead, use separate machines to host the ELK services.</span></span>

### <a name="elasticsearch"></a><span data-ttu-id="a2776-183">Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="a2776-183">Elasticsearch</span></span>
<span data-ttu-id="a2776-184">Elasticsearch のインストールは、非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="a2776-184">The installation of Elasticsearch is fairly straightforward.</span></span> <span data-ttu-id="a2776-185">テストでは、Microsoft が、「[Microsoft Windows インストーラー (MSI) ファイル](https://www.elastic.co/downloads/elasticsearch)」をオーケストレータ #1 および オーケストレータ #2 ノードにダウンロードしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-185">For its tests, Microsoft downloaded the [Microsoft Windows Installer (MSI) file](https://www.elastic.co/downloads/elasticsearch) onto the Orchestrator #1 and Orchestrator #2 nodes.</span></span> <span data-ttu-id="a2776-186">インストーラの既定の設定のほとんどはそのままにしておくことができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-186">Most of the default settings in the installer can be left as is.</span></span> <span data-ttu-id="a2776-187">このセクションでは、Microsoft が変更した設定について説明します。</span><span class="sxs-lookup"><span data-stu-id="a2776-187">This section describes the settings that Microsoft changed.</span></span>

<span data-ttu-id="a2776-188">オペレーティング システム (OS) が再起動された場合に、Elasticsearch がもう一度実行を開始するのを容易にするために、Microsoft は、それを Windows 上でサービスとしてインストールしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-188">To facilitate Elasticsearch to start running again if the operating system (OS) is restarted, Microsoft installed it as a service on Windows.</span></span> <span data-ttu-id="a2776-189">インストーラーを使用して、サービスを設定できます。</span><span class="sxs-lookup"><span data-stu-id="a2776-189">The installer can be used to set up the service.</span></span>

<span data-ttu-id="a2776-190">インストーラーの**コンフィギュレーション**で、Microsoft は、各 Elasticsearch ノードをクラスターにインストールするときに、同じクラスター名を使用しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-190">On the **Configuration** page of the installer, Microsoft used the same cluster name when it installed each Elasticsearch node in the cluster.</span></span>

<span data-ttu-id="a2776-191">Microsoft はすべての Elasticsearch ノードを Data、Master、Ingest という 3 つの役割をすべて実行するように設定しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-191">Microsoft set every Elasticsearch node to perform all three roles: Data, Master, and Ingest.</span></span>

<span data-ttu-id="a2776-192">Kibana と Elasticsearch の使用量に応じて、メモリ増設を検討してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-192">Depending on the amount that you expect Kibana and Elasticsearch to be used, consider increasing the memory usage.</span></span> <span data-ttu-id="a2776-193">C:\\ProgramData\\Elastic\\Elasticsearch\\config\\jvm.options ファイルの -Xm オプションを後で変更し、Elasticsearch を再起動することによって、この設定を変更することができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-193">You can change this setting later by modifying the -Xm options in the C:\\ProgramData\\Elastic\\Elasticsearch\\config\\jvm.options file and restarting Elasticsearch.</span></span>

<span data-ttu-id="a2776-194">設定した Elasticsearch ノードの数に応じて、検出の最小マスターノードを適切に設定できます。</span><span class="sxs-lookup"><span data-stu-id="a2776-194">Depending on the number of Elasticsearch nodes that you set up, you can set the Discovery minimum master nodes appropriately.</span></span> <span data-ttu-id="a2776-195">わからない場合は、マスター ノードを空にしておくことができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-195">If you aren't sure, you can keep the master nodes empty.</span></span> <span data-ttu-id="a2776-196">探索および Node の詳細については、[Node](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-196">For more information about discovery and nodes, see [Node](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html).</span></span>

<span data-ttu-id="a2776-197">発見可能性に関しては、**ネットワークの設定**で、Microsoft は、各ノードの**ネットワーク ホスト**値をノードの IP アドレスに設定し、すべての Elasticsearch ノードの IP アドレスを、各ノードの **Unicast Hosts** リストに追加します。</span><span class="sxs-lookup"><span data-stu-id="a2776-197">For discoverability, in **Network settings**, Microsoft set the **Network host** value of each node to that node's IP address and added the IP addresses of all Elasticsearch nodes to the **Unicast Hosts** list for each node.</span></span> <span data-ttu-id="a2776-198">たとえば、IP アドレスが 10.0.0.12 のオーケストレータ #1 の場合、Microsoft は **Network host** の値を **10.0.0.12** に設定し、次の IP アドレスを **Unicast Hosts** リストに追加しました。10.0.0.12 および 10.0.0.13 (10.0.0.13 はオーケストレータ #2)</span><span class="sxs-lookup"><span data-stu-id="a2776-198">For example, for Orchestrator #1, which has the IP address 10.0.0.12, Microsoft set the **Network host** value to **10.0.0.12** and added the following IP addresses to the **Unicast Hosts** list: 10.0.0.12 and 10.0.0.13, where 10.0.0.13 is Orchestrator #2.</span></span>

<span data-ttu-id="a2776-199">**Elasticsearch 6.3 以降のバージョンをインストールする場合、この段落は無視できます。**</span><span class="sxs-lookup"><span data-stu-id="a2776-199">**If you're installing Elasticsearch version 6.3 or higher, you can disregard this paragraph.**</span></span> <span data-ttu-id="a2776-200">今または後で、X-Pack をインストールすることができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-200">You can install X-Pack either now or later.</span></span> <span data-ttu-id="a2776-201">設定および X-Pack をインストールする必要があるかどうかに関する詳細については、このトピックの「X-Pack」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-201">For more information about setup and whether you should install X-Pack, see the "X-Pack" section of this topic.</span></span> <span data-ttu-id="a2776-202">ここでは、X-Pack がどういうものか理解していない限り、インストールしないでください。</span><span class="sxs-lookup"><span data-stu-id="a2776-202">For now, unless you know what X-Pack is for, don't install it.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a2776-203">ファイアウォールの HTTP ポート (既定では、ポート 9200) と、ノード通信ポート (既定では、ポート 9300) を開きます。</span><span class="sxs-lookup"><span data-stu-id="a2776-203">Open the HTTP port (by default, port 9200) and the node communication port (by default, port 9300) in your firewall.</span></span>

<span data-ttu-id="a2776-204">インストールが成功したことを確認するには、ブラウザーを起動し、アプリケーションのアドレスを開きます。</span><span class="sxs-lookup"><span data-stu-id="a2776-204">To verify that the installation was successful, start a browser, and open the application address.</span></span> <span data-ttu-id="a2776-205">いくつかの JavaScript Object Notation (JSON) 出力が表示されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-205">You should see some JavaScript Object Notation (JSON) output.</span></span>

### <a name="logstash"></a><span data-ttu-id="a2776-206">Logstash</span><span class="sxs-lookup"><span data-stu-id="a2776-206">Logstash</span></span>
<span data-ttu-id="a2776-207">テストの設定では、Microsoft は、Winlogbeat のいくつかのイベントで調整が必要なことがわかりました。</span><span class="sxs-lookup"><span data-stu-id="a2776-207">In its test setup, Microsoft found that some events from Winlogbeat required adjustments.</span></span> <span data-ttu-id="a2776-208">Logstash は、その機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="a2776-208">Logstash provides that functionality.</span></span>

<span data-ttu-id="a2776-209">Microsoft は Logstash をオーケストレータ #2 および オーケストレータ #3 ノードで C:\\ELK\\Logstash にダウンロードしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-209">Microsoft downloaded Logstash to C:\\ELK\\Logstash on the Orchestrator #2 and Orchestrator #3 nodes.</span></span>

<span data-ttu-id="a2776-210">Logstash が起動時に実行されることを確認するために、Non-Sucking サービス マネージャー (NSSM) を使用して、Logstash バッチ スクリプトのサービスを設定しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-210">To help ensure that Logstash runs on startup, we used the Non-Sucking Service Manager (NSSM) to set up a service for the Logstash batch script.</span></span>

1. <span data-ttu-id="a2776-211">Nssm.exe を Logstash の bin フォルダーにコピーする (たとえば、C:\\ELK\\Logstash\\6.2.4\\bin\\) 。</span><span class="sxs-lookup"><span data-stu-id="a2776-211">Copy nssm.exe to the Logstash bin folder (for example, C:\\ELK\\Logstash\\6.2.4\\bin\\).</span></span>
2. <span data-ttu-id="a2776-212">bin フォルダーから Windows PowerShell を開き、次のコマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="a2776-212">Open Windows PowerShell from the bin folder, and run the following command.</span></span>

    ```
    .\nssm.exe install Logstash
    ```

3. <span data-ttu-id="a2776-213">**アプリケーション**タブで、次のフィールドを設定して、**保存**をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a2776-213">On the **Application** tab, set the following fields, and then click **Save**:</span></span>

    - <span data-ttu-id="a2776-214">**パス:** C:\\ELK\\Logstash\\6.2.4\\bin\\logstash.bat</span><span class="sxs-lookup"><span data-stu-id="a2776-214">**Path:** C:\\ELK\\Logstash\\6.2.4\\bin\\logstash.bat</span></span>
    - <span data-ttu-id="a2776-215">**起動ディレクトリ:** C:\\ELK\\Logstash\6.2.4</span><span class="sxs-lookup"><span data-stu-id="a2776-215">**Startup directory:** C:\\ELK\\Logstash\6.2.4</span></span>
    - <span data-ttu-id="a2776-216">**引数:** -f C:\\ELK\\Logstash\\config\\logstash-dyn365finops.conf</span><span class="sxs-lookup"><span data-stu-id="a2776-216">**Arguments:** -f C:\\ELK\\Logstash\\config\\logstash-dyn365finops.conf</span></span>

    <span data-ttu-id="a2776-217">(より多くの設定ができます。</span><span class="sxs-lookup"><span data-stu-id="a2776-217">(There are more settings that you can set.</span></span> <span data-ttu-id="a2776-218">ただし、今のところ、これらの設定で十分です。)</span><span class="sxs-lookup"><span data-stu-id="a2776-218">However, these settings suffice for now.)</span></span>

4. <span data-ttu-id="a2776-219">次のコマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="a2776-219">Run the following command.</span></span>

    ```
    .\nssm.exe start Logstash
    ```

<span data-ttu-id="a2776-220">Microsoft が実行したテストでは、NSSM には、インストールされたサービスの再起動に問題がありました。</span><span class="sxs-lookup"><span data-stu-id="a2776-220">In the tests that Microsoft performed, NSSM had trouble restarting the installed services.</span></span> <span data-ttu-id="a2776-221">Logstash と Kibana に対し NSSM は 100% の信頼性がなかったため、サービスは OS 起動サービスとして扱われました。</span><span class="sxs-lookup"><span data-stu-id="a2776-221">Because NSSM wasn't 100-percent reliable for Logstash and Kibana, the service was treated as an OS startup service and little else.</span></span>

<span data-ttu-id="a2776-222">Microsoft は、Logstash に対し構成ファイルを作成し、[C:\\ELK\\Logstash\\6.2.4\\config](https://aka.ms/ConfigFilesOnPremises) にプットします。このファイルは Finance and Operations 診断で、便利な変換を実行します。</span><span class="sxs-lookup"><span data-stu-id="a2776-222">Microsoft created a configuration file for Logstash and put it in [C:\\ELK\\Logstash\\6.2.4\\config](https://aka.ms/ConfigFilesOnPremises). This file performs useful transformations on Finance and Operations diagnostics.</span></span>

<span data-ttu-id="a2776-223">設定のためコンフィギュレーションを行うには、クラスターの Elasticsearch ノードを指すように、**出力**セクションの**ホスト**フィールドを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-223">To make the configuration work for your setup, you must change the **hosts** fields in the **output** section so that they point to the Elasticsearch nodes in your cluster.</span></span> <span data-ttu-id="a2776-224">たとえば、**ホスト** を **\["ORCH1:9200", "ORCH2:9200"\]** に変更します。</span><span class="sxs-lookup"><span data-stu-id="a2776-224">For example, change **hosts** to **\["ORCH1:9200", "ORCH2:9200"\]**.</span></span>

<span data-ttu-id="a2776-225">構成は、次のセクションから Winlogbeat 構成を使用してテストされました。</span><span class="sxs-lookup"><span data-stu-id="a2776-225">The configuration was tested by using the Winlogbeat configuration from the next section.</span></span>

<span data-ttu-id="a2776-226">ビートが Logstash にデータを送信できるように、Logstash をホストしているコンピューターのファイアウォールで、Winlogbeat ポート (既定では、ポート 5044) を開くことを忘れないでください。</span><span class="sxs-lookup"><span data-stu-id="a2776-226">Remember to open the Winlogbeat port (by default, port 5044) in your firewall on the machine that is hosting Logstash, so that Beats can send data to Logstash.</span></span>

### <a name="winlogbeat"></a><span data-ttu-id="a2776-227">Winlogbeat</span><span class="sxs-lookup"><span data-stu-id="a2776-227">Winlogbeat</span></span>
<span data-ttu-id="a2776-228">Microsoft は Winlogbeat を C:\\ELK\\Winlogbeat の 各 Application Object Server (AOS) およびオーケストレータ ノードにダウンロードし、[winlogbeat.yml file](https://aka.ms/ConfigFilesOnPremises) を構成しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-228">Microsoft downloaded Winlogbeat to each Application Object Server (AOS) and Orchestrator node at C:\\ELK\\Winlogbeat, and configured the [winlogbeat.yml file](https://aka.ms/ConfigFilesOnPremises).</span></span>

<span data-ttu-id="a2776-229">設定のためコンフィギュレーションを行うには、すべての Logstash ノードを指すように **output.logstash.hosts** フィールドを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-229">To make the configuration work for your set up, you must change the **output.logstash.hosts** fields so that they point to all your Logstash nodes.</span></span> <span data-ttu-id="a2776-230">Winlogbeat は、負荷分散を処理します。</span><span class="sxs-lookup"><span data-stu-id="a2776-230">Winlogbeat handles the load balancing.</span></span>

<span data-ttu-id="a2776-231">Winlogbeat が Orchestrator ノード上で実行されている場合、**Tags** フィールドは **AOS** から  **ORCH** もしくはそれに類する値に変更できます。</span><span class="sxs-lookup"><span data-stu-id="a2776-231">When Winlogbeat runs on an Orchestrator node, the **Tags** field can be changed from **AOS** to **ORCH** or a similar value.</span></span> <span data-ttu-id="a2776-232">Microsoft は **fields.env** フィールドを使用して、配置環境 (サンド ボックス、サンド ボックス -n、または生産) を設定します。</span><span class="sxs-lookup"><span data-stu-id="a2776-232">Microsoft also used the **fields.env** field to set the environment of the deployment (sandbox, sandbox-n, or production).</span></span> <span data-ttu-id="a2776-233">このようにして、複数の環境およびノード タイプからのデータが照会されると、より明確な分離が行われます。</span><span class="sxs-lookup"><span data-stu-id="a2776-233">In this way, there is a cleaner separation when data from multiple environments and node types is queried.</span></span>

<span data-ttu-id="a2776-234">Winlogbeat には、サービス インストーラーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a2776-234">Winlogbeat includes a service installer.</span></span> <span data-ttu-id="a2776-235">Microsoft は、このインストーラーを使用して、各ノード上のサービスとして Winlogbeat を設定しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-235">Microsoft used this installer to set up Winlogbeat as a service on each node.</span></span> <span data-ttu-id="a2776-236">Windows ロゴキーと R キーを同時に押して、ツールの実行を開始し、次のコマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="a2776-236">Press the Windows logo key+R to start the Run tool, and then run the following command.</span></span>

```
powershell.exe -ExecutionPolicy Bypass -File C:\ELK\Winlogbeat\install-service-winlogbeat.ps1
```

### <a name="kibana"></a><span data-ttu-id="a2776-237">Kibana</span><span class="sxs-lookup"><span data-stu-id="a2776-237">Kibana</span></span>
<span data-ttu-id="a2776-238">Kibana は、Elasticsearch の診断データをクエリするインターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="a2776-238">Kibana provides the interface to query the diagnostic data in Elasticsearch.</span></span>

<span data-ttu-id="a2776-239">Microsoft は Kibana を C:\\ELK\\Kibana にダウンロードし、次の方法で kibana.yml ファイルを構成しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-239">Microsoft downloaded Kibana to C:\\ELK\\Kibana and configured the kibana.yml file in the following manner.</span></span>

```
server.host: "10.0.0.14"
server.name: "Dyn365FinOps On-Premises Diagnostics"
elasticsearch.url: "http://ORCH1:9200"
```

<span data-ttu-id="a2776-240">Kibana から、Microsoft は**管理**タブでインデックス パターンを定義しなければなりませんでした。インデックス パターンは名前でインデックスをグループ化するため、1 つのインデックス パターンが作成された 2 つのインデックス: 配置-\* およびランタイム-\* を必要とするためです。</span><span class="sxs-lookup"><span data-stu-id="a2776-240">From Kibana, Microsoft had to define index patterns on the **Management** tab. Because index patterns group indexes by name, an index pattern was required for the two indexes that were made: deployment-\* and runtime-\*.</span></span> <span data-ttu-id="a2776-241">インデックス名は、大文字と小文字が区別されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-241">The index names are case-sensitive.</span></span>

<span data-ttu-id="a2776-242">Microsoft は、既定のパターンとしてランタイム -\* インデックス パターンを設定しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-242">Microsoft set the runtime-\* index pattern as the default pattern.</span></span> <span data-ttu-id="a2776-243">**管理**タブのインデックス パターンを確認するときは、アスタリスク (\*) をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a2776-243">When you're looking at the index patterns on the **Management** tab, click the asterisk (\*).</span></span> <span data-ttu-id="a2776-244">インデックス パターンが、**Discover** タブに表示されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-244">The index pattern will then appear on the **Discover** tab.</span></span>

<span data-ttu-id="a2776-245">[![ランタイム インデックス パターン](./media/runtime-index-patter.png)](./media/runtime-index-patter.png)</span><span class="sxs-lookup"><span data-stu-id="a2776-245">[![Runtime index pattern](./media/runtime-index-patter.png)](./media/runtime-index-patter.png)</span></span>

<span data-ttu-id="a2776-246">Microsoft は Kibana を Logstash と同じ方法でサービスとして実行し、Kibana が OS の起動時に起動されるようにしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-246">Microsoft ran Kibana as a service in the same manner as Logstash, so that Kibana is started at OS startup.</span></span> <span data-ttu-id="a2776-247">Logstash とは異なり、kibana.bat は、コンフィギュレーション ファイルのパスは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="a2776-247">Unlike Logstash, kibana.bat doesn't need the path of the configuration files.</span></span> <span data-ttu-id="a2776-248">したがって、C:\\ELK\\Kibana\\6.2.4\\bin\\kibana.bat を参照する NSSM サービスをインストールできます。</span><span class="sxs-lookup"><span data-stu-id="a2776-248">Therefore, you can just install an NSSM service that points to C:\\ELK\\Kibana\\6.2.4\\bin\\kibana.bat.</span></span>

<span data-ttu-id="a2776-249">ネットワーク上で Kibana を参照したいなら、Kibana 用のポートを開くことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-249">If you want users to browse Kibana on your network, remember to open the port for Kibana.</span></span> <span data-ttu-id="a2776-250">既定のポートは 5601 です。</span><span class="sxs-lookup"><span data-stu-id="a2776-250">The default port is 5601.</span></span>

#### <a name="example-queries-on-the-discover-tab-in-kibana"></a><span data-ttu-id="a2776-251">Kibana の検出タブでのクエリの例</span><span class="sxs-lookup"><span data-stu-id="a2776-251">Example queries on the Discover tab in Kibana</span></span>
<span data-ttu-id="a2776-252">次のサンプル クエリでは、診断データの調査を開始できます。</span><span class="sxs-lookup"><span data-stu-id="a2776-252">The following sample queries can help you start probing the diagnostic data.</span></span> <span data-ttu-id="a2776-253">例に示されているもの以上のものが必要な場合、次のクエリのいずれかをお試しください。</span><span class="sxs-lookup"><span data-stu-id="a2776-253">If you require something more than the examples show, you can try one of the following queries:</span></span>

- <span data-ttu-id="a2776-254">**低速データベース クエリの検索:** 検索フィールドに**低速**と入力して、イベント データのどこかに「低速」という単語が含まれているイベントを検索します。</span><span class="sxs-lookup"><span data-stu-id="a2776-254">**Find slow database queries:** Enter **slow** in the search field to find events that have the word "slow" somewhere in the event data.</span></span> <span data-ttu-id="a2776-255">より正確にするには、**AosDatabaseSlowQuery** のタスク名を持つイベントを検索し、検索フィールドに **TaskName:AosDatabaseSlowQuery** と入力します。</span><span class="sxs-lookup"><span data-stu-id="a2776-255">If you want to be more precise, you can find events that have a task name of **AosDatabaseSlowQuery** and then enter **TaskName:AosDatabaseSlowQuery** in the search field.</span></span>
- <span data-ttu-id="a2776-256">**最新の例外を見つける:** **例外**を検索フィールドに入力して、例外をスローしたイベント、または例外を処理してログに記録したイベントを探します。</span><span class="sxs-lookup"><span data-stu-id="a2776-256">**Find recent exceptions:** Enter **exception** in the search field to find events that have either thrown an exception, or handled an exception and logged it.</span></span> <span data-ttu-id="a2776-257">Kibana の右上隅で、検索を制限する必要がある期間を選択します。</span><span class="sxs-lookup"><span data-stu-id="a2776-257">In the upper-right corner of Kibana, you can select the time frame that the search should be limited to.</span></span> <span data-ttu-id="a2776-258">そこで設定したタイム フレームは、タブの間で保持されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-258">The time frame that you set there is persisted between tabs.</span></span> <span data-ttu-id="a2776-259">したがって、**視覚化**タブ上のデータは選択されているタイム フレームに反映されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-259">Therefore, the data on the **Visualize** tab will reflect the selected time frame.</span></span>

    <span data-ttu-id="a2776-260">[![検索の時間枠](./media/time-visualize.png)](./media/time-visualize.png)</span><span class="sxs-lookup"><span data-stu-id="a2776-260">[![Search time frame](./media/time-visualize.png)](./media/time-visualize.png)</span></span> 

- <span data-ttu-id="a2776-261">**AOS ノードからイベントを検索:** ノードからすべてのイベントを検索するために、検索フィールドに **host:AOS1** と入力します。</span><span class="sxs-lookup"><span data-stu-id="a2776-261">**Find events from an AOS node:** Enter **host:AOS1** in the search field to find all events from that node.</span></span>
- <span data-ttu-id="a2776-262">**他のイベントと最も近い、特定のイベントを見つける:** 興味のあるイベントが見つかったら、そのイベントのヘッダーの横にある**関連するドキュメントを表示します**をクリックして、同時に発生したイベントを見つけます。</span><span class="sxs-lookup"><span data-stu-id="a2776-262">**Find events with proximity, in time, to another:** When you've found an event that you're interested in, click **View surrounding documents** next to the header of that event to find events that occurred at the same time.</span></span> <span data-ttu-id="a2776-263">同時に発生した、異なる Microsoft Dynamics AX Application Object Server (AOS) ノードからのイベントが表示されている場合、追加のフィルターを追加して、必要なノードからのイベントのみを表示できます。</span><span class="sxs-lookup"><span data-stu-id="a2776-263">If you see events that occurred at around the same time but from different AOS nodes, you can add additional filtering to view only events from the node that you want.</span></span>

    <span data-ttu-id="a2776-264">[![関連するドキュメントを表示します](./media/events-with-proximity.PNG)](./media/events-with-proximity.PNG)</span><span class="sxs-lookup"><span data-stu-id="a2776-264">[![View surrounding documents](./media/events-with-proximity.PNG)](./media/events-with-proximity.PNG)</span></span>

#### <a name="thirty-day-data-retention"></a><span data-ttu-id="a2776-265">30 日間のデータの保持</span><span class="sxs-lookup"><span data-stu-id="a2776-265">Thirty-day data retention</span></span>
<span data-ttu-id="a2776-266">古いデータからハード ディスクを保持するために、Microsoft は Curator v5.5 を使用して 30 日以上経過したインデックスをクリーンアップしました。</span><span class="sxs-lookup"><span data-stu-id="a2776-266">To keep its hard disks free from stale data, Microsoft used Curator v5.5 to clean up indexes that were older than 30 days.</span></span>

<span data-ttu-id="a2776-267">Microsoft はキュレーターを C:\\ELK\\Curator でオーケストレータ ノードのいずれかにダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="a2776-267">Microsoft downloaded Curator to one of the Orchestrator nodes at C:\\ELK\\Curator.</span></span> <span data-ttu-id="a2776-268">Microsoft は、[C:\\ELK\\Curator](https://aka.ms/ConfigFilesOnPremises) に配置された構成ファイルを使用して、キュレーターを Elasticsearch クラスターに接続しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-268">Microsoft then used the configuration file that was put in [C:\\ELK\\Curator](https://aka.ms/ConfigFilesOnPremises) to connect Curator to its Elasticsearch cluster.</span></span>

<span data-ttu-id="a2776-269">キュレーターはアクションを実行し、Microsoft は [C:\\ELK\\Curator](https://aka.ms/ConfigFilesOnPremises) 内に配置された 30 日前のインデックスをクリーンアップするアクションを作成しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-269">Curator runs actions, and Microsoft created an action to clean up 30-day-old indexes that were put in [C:\\ELK\\Curator](https://aka.ms/ConfigFilesOnPremises).</span></span>

<span data-ttu-id="a2776-270">Microsoft は、Windows タスク スケジューラの基本的なタスクを作成します。</span><span class="sxs-lookup"><span data-stu-id="a2776-270">Microsoft created a basic task in Windows Task Scheduler.</span></span> <span data-ttu-id="a2776-271">このタスクは、土曜日と日曜日に毎週トリガーを持ち、トリガーにはプログラムを開始するための次の設定があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-271">This task has a weekly trigger on Saturday and Sunday, and the trigger has the following settings to start a program:</span></span>

- <span data-ttu-id="a2776-272">**プログラム/スクリプト:** C:\\ELK\\Curator\\curator.exe</span><span class="sxs-lookup"><span data-stu-id="a2776-272">**Program/script:** C:\\ELK\\Curator\\curator.exe</span></span>
- <span data-ttu-id="a2776-273">**引数を追加:** --curator.yml のコンフィグレーション .\\30 日\_データ\_保存\_actions.yml</span><span class="sxs-lookup"><span data-stu-id="a2776-273">**Add arguments:** --config curator.yml .\\30day\_data\_retention\_actions.yml</span></span>
- <span data-ttu-id="a2776-274">**開始:** C:\\ELK\\Curator</span><span class="sxs-lookup"><span data-stu-id="a2776-274">**Start in:** C:\\ELK\\Curator</span></span>

## <a name="x-pack"></a><span data-ttu-id="a2776-275">X-Pack</span><span class="sxs-lookup"><span data-stu-id="a2776-275">X-Pack</span></span>
> [!IMPORTANT]
> <span data-ttu-id="a2776-276">2018 年 6 月現在、バージョン 6.3 以降の Elastic スタック コンポーネントがリリースされています。</span><span class="sxs-lookup"><span data-stu-id="a2776-276">As of June 2018, Elastic Stack components have been released that start with version 6.3.</span></span> <span data-ttu-id="a2776-277">この更新されたバージョンでは、X-Pack の無料機能を毎年ライセンスを更新することなくデフォルトで有効にすること、また、後で有料機能にオプトインすることで、X-Pack をより上手く処理します。</span><span class="sxs-lookup"><span data-stu-id="a2776-277">This updated version handles X-Pack in a more graceful manner, by enabling the free features of X-Pack by default, without requiring that you update the license every year, and by letting you opt in to the paid features afterward.</span></span> <span data-ttu-id="a2776-278">6.3 よりも前の Elastic スタック バージョンをインストールしている場合、このセクションの内容は設定に部分的にのみ適用されます。</span><span class="sxs-lookup"><span data-stu-id="a2776-278">If you install an Elastic Stack version that is earlier than 6.3, the content in this section only partially applies to the setup.</span></span>

<span data-ttu-id="a2776-279">Elasticsearch のインストール時に X-Pack をインストールするように選択できます。</span><span class="sxs-lookup"><span data-stu-id="a2776-279">You can select to install X-Pack when you install Elasticsearch.</span></span> <span data-ttu-id="a2776-280">代わりに、[インストールをすることができます。](https://www.elastic.co/guide/en/x-pack/current/installing-xpack.html)。</span><span class="sxs-lookup"><span data-stu-id="a2776-280">Alternatively, you can [install it later](https://www.elastic.co/guide/en/x-pack/current/installing-xpack.html).</span></span>

<span data-ttu-id="a2776-281">X-Pack には無料の基本ライセンスがあり、毎年更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-281">X-Pack has a free basic license that must be updated every year.</span></span>

<span data-ttu-id="a2776-282">Microsoft では、Kibana からコンマ区切り値 (CSV) 形式でエクスポートするデータのクエリを有効にするために無料版がインストールされています。</span><span class="sxs-lookup"><span data-stu-id="a2776-282">Microsoft installed the free version to enable query data to be exported from Kibana in comma-separated value (CSV) format.</span></span> <span data-ttu-id="a2776-283">X-Pack ではその他の便利な機能がありますが、いくつかは有料サブスクリプションでのみ使用可能です。</span><span class="sxs-lookup"><span data-stu-id="a2776-283">There are other useful features in X-Pack, but some are available only in a paid subscription.</span></span>

<span data-ttu-id="a2776-284">無料の機能だけを有効にし、他の X-Pack の試用版の機能を使用しないように、Microsoft は、elasticsearch.yml および kibana.yml のコンフィギュレーション ファイルに次の設定を追加しました。</span><span class="sxs-lookup"><span data-stu-id="a2776-284">To enable only the free features and avoid using other X-Pack trial features, Microsoft added the following settings to our elasticsearch.yml and kibana.yml configuration files:</span></span>

```
xpack.graph.enabled: false
xpack.ml.enabled: false
xpack.security.enabled: false
xpack.watcher.enabled: false
```

<span data-ttu-id="a2776-285">これらの設定は、セキュリティ モジュールが有効ではないため、Kibana と Elasticsearch が資格情報を求めることも停止します。</span><span class="sxs-lookup"><span data-stu-id="a2776-285">These settings also stop Kibana and Elasticsearch from asking for credentials because the security module is no longer enabled.</span></span>

<span data-ttu-id="a2776-286">X-Pack を動作させるには、logstash.yml 構成ファイルも次のように構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2776-286">For X-Pack to work, the logstash.yml configuration file must also be configured in the following manner.</span></span>

```
xpack.monitoring.elasticsearch.url: "http://orch1:9200"
```

<span data-ttu-id="a2776-287">X-Pack の支払済バージョンには、クラスター、パスワードで保護されたデータ アクセスなどの接続に使用するための HTTPS 暗号化が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a2776-287">The paid version of X-Pack includes HTTPS encryption for connections throughout the cluster, password-protected data access, and more.</span></span> <span data-ttu-id="a2776-288">X-Pack の詳細については、[Elastic Web サイト](https://www.elastic.co/products/x-pack)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-288">For more information about X-Pack, see the [Elastic website](https://www.elastic.co/products/x-pack).</span></span>

### <a name="export-a-query-to-a-csv-file"></a><span data-ttu-id="a2776-289">CSV ファイルへのクエリのエクスポート</span><span class="sxs-lookup"><span data-stu-id="a2776-289">Export a query to a CSV file</span></span>
<span data-ttu-id="a2776-290">Kibana では、**検出**タブで、クエリを作成し、保存します。</span><span class="sxs-lookup"><span data-stu-id="a2776-290">In Kibana, on the **Discover** tab, write a query, and save it.</span></span> <span data-ttu-id="a2776-291">クエリを保存した後、**検出**ページの上部にある**レポート** タブの **CSV を生成**をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a2776-291">After you save the query, on the **Reporting** tab at the top of the **Discover** page, click **Generate CSV**.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="a2776-292">トラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="a2776-292">Troubleshooting</span></span>
### <a name="you-dont-receive-any-data-in-kibana"></a><span data-ttu-id="a2776-293">Kibana 内のデータを受信しません</span><span class="sxs-lookup"><span data-stu-id="a2776-293">You don't receive any data in Kibana</span></span>
<span data-ttu-id="a2776-294">Kibana で、何もデータを受け取っていない場合、Winlogbeat から Logstash、Elasticsearch、および Kibana のログを確認してください。</span><span class="sxs-lookup"><span data-stu-id="a2776-294">If you don't receive any data in Kibana, review the logs from Winlogbeat to Logstash, Elasticsearch, and Kibana.</span></span> <span data-ttu-id="a2776-295">Winlogbeat のインストールでは、C:\\ProgramData\\winlogbeat\\Logs にログが記録されますが、他の Elastic スタック コンポーネントはログをインストール パスに近づけることに注意してください (例: C:\\ELK\\Elasticsearch\\logs)。</span><span class="sxs-lookup"><span data-stu-id="a2776-295">Note that the Winlogbeat installation puts its logs in C:\\ProgramData\\winlogbeat\\Logs, whereas the other Elastic Stack components put their logs close to the installation path (for example, in C:\\ELK\\Elasticsearch\\logs).</span></span>
