---
title: "新しい環境、VSTS、および小売プロジェクトの分岐の設定"
description: "このトピックでは、新しい環境、Microsoft Visual Studio Team Services、および Microsoft Dynamics 365 for Retail の実装プロジェクトの分岐を設定するための推奨事項について説明します。"
author: Andreash1
manager: AnnBe
ms.date: 07/09/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-365-retail
ms.technology: 
ms.search.form: 
audience: IT Pro
ms.reviewer: kfend
ms.search.scope: Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: andreash
ms.search.validFrom: 2017-12-31
ms.dyn365.ops.version: Retail 7.3
ms.translationtype: HT
ms.sourcegitcommit: 965826f5fddc2f53f33157434929eb265979376e
ms.openlocfilehash: caa27491983fd043b71c43449aa377c05295f450
ms.contentlocale: ja-jp
ms.lasthandoff: 09/17/2018

---

# <a name="set-up-new-environments-vsts-and-branches-for-retail-projects"></a><span data-ttu-id="ea473-103">新しい環境、VSTS、および小売プロジェクトの分岐の設定</span><span class="sxs-lookup"><span data-stu-id="ea473-103">Set up new environments, VSTS, and branches for Retail projects</span></span>

[!include [banner](../../includes/banner.md)]

<span data-ttu-id="ea473-104">Microsoft Dynamics AX 7.0 以降では、ほとんどの環境がクラウドでホストされます。</span><span class="sxs-lookup"><span data-stu-id="ea473-104">Starting in Microsoft Dynamics AX 7.0, most environments are hosted in the cloud.</span></span> <span data-ttu-id="ea473-105">それらは (Microsoft サブスクリプションで) Microsoft によってホストされるか、(顧客サブスクリプションで) クラウド ホストされています。</span><span class="sxs-lookup"><span data-stu-id="ea473-105">They are either Microsoft-hosted (on a Microsoft subscription) or cloud-hosted (on a customer subscription).</span></span> <span data-ttu-id="ea473-106">既定では、環境は、Microsoft によってホストされます。</span><span class="sxs-lookup"><span data-stu-id="ea473-106">By default, environments are Microsoft-hosted.</span></span> <span data-ttu-id="ea473-107">通常、クラウド ホスト環境は、開発環境またはビルド環境を詳細に制御するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-107">Typically, cloud-hosted environments are used to provide more control over a development or build environment.</span></span> <span data-ttu-id="ea473-108">詳細については、「[Lifecycle Services (LCS) ユーザー ガイド](../../dev-itpro/lifecycle-services/lcs-user-guide.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ea473-108">For more details, see [Lifecycle Services (LCS) user guide](../../dev-itpro/lifecycle-services/lcs-user-guide.md).</span></span>

<span data-ttu-id="ea473-109">第 1 層のマシンは、開発者、または、ビルド環境です。</span><span class="sxs-lookup"><span data-stu-id="ea473-109">Tier 1 machines are developer or build environments.</span></span>

## <a name="development-tier-1-environments"></a><span data-ttu-id="ea473-110">第 1 層環境の開発</span><span class="sxs-lookup"><span data-stu-id="ea473-110">Development Tier 1 environments</span></span>

<span data-ttu-id="ea473-111">コード拡張を含む Microsoft Dynamics 365 for Retail の実装については、管理権限を持つ開発環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ea473-111">For implementations of Microsoft Dynamics 365 for Retail that include code extensions, we recommend that you use a development environment that has administrative privileges.</span></span> <span data-ttu-id="ea473-112">管理者特権のない開発環境を使用する場合は、他のプログラミング ツールおよびオペレーティング システム (OS) の機能をインストールまたはコンフィギュレーションできません。</span><span class="sxs-lookup"><span data-stu-id="ea473-112">If you use a development environment that doesn't have administrative privileges, other programming tools and features of the operating system (OS) can't be installed or configured.</span></span> <span data-ttu-id="ea473-113">代わりの設定は、別の Microsoft Azure サブスクリプションをホストされているマシンです。</span><span class="sxs-lookup"><span data-stu-id="ea473-113">An alternative setup is a machine that is hosted on a separate Microsoft Azure subscription.</span></span> <span data-ttu-id="ea473-114">(このタイプのマシンは Microsoft Dynamics Lifecycle Services [LCS] で「クラウド ホスト環境」としても呼ばれています。)</span><span class="sxs-lookup"><span data-stu-id="ea473-114">(This type of machine is also known as "cloud-hosted" in Microsoft Dynamics Lifecycle Services [LCS].)</span></span>

<span data-ttu-id="ea473-115">第 1 層の開発またはビルド環境には 3 つのホスト モデル : Microsoft によってホストされる環境、クラウドでホストされている環境、および自己ホストされダウンロードされた仮想マシン (VM) があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-115">There are three hosting models for a Tier 1 development or build environment: a Microsoft-hosted environment, a cloud-hosted environment, and a self-hosted downloaded virtual machine (VM).</span></span>

<span data-ttu-id="ea473-116">チャネル コンポーネントを拡張する場合は、開発の準備を整えられるように、開発環境を構成する方法の詳細については、このトピックで後の「開発環境の準備」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-116">If you want to extend channel components, see the "Prepare the development environment" section later in this topic for information about how to configure a development environment so that it's ready for development.</span></span>

<span data-ttu-id="ea473-117">使用するホスティング モデルの財務的影響のため、レベル 1 環境を単純なテスト環境または高品質なテスト環境として使用することで、ホスティング コストの一部を削減できます。</span><span class="sxs-lookup"><span data-stu-id="ea473-117">Because the hosting model that you use has a financial impact, you can reduce some of the hosting cost by using a Tier 1 environment as a simple test environment or golden configuration environment.</span></span> <span data-ttu-id="ea473-118">1 つのレベル 1 環境は、Microsoft Dynamics 定期売買では無料です。</span><span class="sxs-lookup"><span data-stu-id="ea473-118">One Tier 1 environment is free with your Microsoft Dynamics subscription.</span></span> <span data-ttu-id="ea473-119">このアプローチは理想的ではありませんが、ほとんどのプロジェクトで有効です。</span><span class="sxs-lookup"><span data-stu-id="ea473-119">Although this approach isn't ideal, it should work for most projects.</span></span>

> [!NOTE]
> <span data-ttu-id="ea473-120">いつでもクラウド ホスト環境をシャットダウンできます。</span><span class="sxs-lookup"><span data-stu-id="ea473-120">You can shut down cloud-hosted environments at any time.</span></span> <span data-ttu-id="ea473-121">この機能は、ホスティングのコストを削減するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="ea473-121">This capability helps reduce the hosting cost.</span></span>

<span data-ttu-id="ea473-122">ホスティングの代替方法は、LCS から仮想ハードディスク (VHD) をダウンロードし、サーバー上にローカルにホストすることです。</span><span class="sxs-lookup"><span data-stu-id="ea473-122">A hosting alternative is to download a virtual hard disk (VHD) from LCS and host it locally on a server.</span></span> <span data-ttu-id="ea473-123">開発の観点からは、VHD イメージはホスト VM と同じ処理能力を備えています。</span><span class="sxs-lookup"><span data-stu-id="ea473-123">From a development perspective, VHD images have the same capabilities as a hosted VM.</span></span> <span data-ttu-id="ea473-124">唯一の違いは、LCS の展開が VHD でサポートされていないことです。</span><span class="sxs-lookup"><span data-stu-id="ea473-124">The only difference is that LCS deployments aren't supported on VHDs.</span></span> <span data-ttu-id="ea473-125">ただし、コマンド ラインの配置はサポートされています。</span><span class="sxs-lookup"><span data-stu-id="ea473-125">However, command-line deployments are supported.</span></span>

<span data-ttu-id="ea473-126">次のテーブルでは、それぞれのホスティング モデルの長所と短所を示します。</span><span class="sxs-lookup"><span data-stu-id="ea473-126">The following table shows the advantages and disadvantages of each hosting model.</span></span> <span data-ttu-id="ea473-127">プロジェクトに最も適したモデルを評価するために、この情報を使用します。</span><span class="sxs-lookup"><span data-stu-id="ea473-127">Use this information to evaluate the model that will work best for your project.</span></span>

<table>
<thead>
<tr>
<th><span data-ttu-id="ea473-128">ホスティング モデル</span><span class="sxs-lookup"><span data-stu-id="ea473-128">Hosting model</span></span></th>
<th><span data-ttu-id="ea473-129">メリット</span><span class="sxs-lookup"><span data-stu-id="ea473-129">Advantages</span></span></th>
<th><span data-ttu-id="ea473-130">欠点</span><span class="sxs-lookup"><span data-stu-id="ea473-130">Disadvantages</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td><span data-ttu-id="ea473-131">Microsoft によってホストされる環境 (LCS プロジェクトでは、既定またはアドオンに基づく)</span><span class="sxs-lookup"><span data-stu-id="ea473-131">Microsoft-hosted environment (in an LCS project, default or based on an add-on)</span></span></td>
<td>
<ul>
<li><span data-ttu-id="ea473-132">1 つの環境は、定期売買に含まれています。</span><span class="sxs-lookup"><span data-stu-id="ea473-132">One environment is included in the subscription.</span></span> <span data-ttu-id="ea473-133">ビルド環境としてこの環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ea473-133">We recommend that you use this environment as a build environment.</span></span></li>
<li><span data-ttu-id="ea473-134">テレメトリ データは収集され、LCS 診断のページで利用可能です。</span><span class="sxs-lookup"><span data-stu-id="ea473-134">Telemetry data is collected and is available on the LCS diagnostics page.</span></span></li>
</ul>
</td>
<td>
<ul>
<li><span data-ttu-id="ea473-135">ユーザーは、管理アクションを実行できません。</span><span class="sxs-lookup"><span data-stu-id="ea473-135">Users can't perform administrative actions.</span></span></li>
<li><span data-ttu-id="ea473-136">したがって、ユーザーは、ツールまたは証明書をインストールできません。</span><span class="sxs-lookup"><span data-stu-id="ea473-136">Therefore, users can't install any tools or certificates.</span></span></li>
</ul>
</td>
</tr>
<tr>
<td><span data-ttu-id="ea473-137">クラウドでホストされている環境 (LCS プロジェクトで、プライベートのサブスクリプション)</span><span class="sxs-lookup"><span data-stu-id="ea473-137">Cloud-hosted environment (in an LCS project, private subscription)</span></span></td>
<td>
<ul>
<li><span data-ttu-id="ea473-138">ユーザーには完全な管理権限があり、任意のツールをインストールすることができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-138">Users have full administrative rights and can install any tools.</span></span></li>
<li><span data-ttu-id="ea473-139">ユーザーは、証明書をインストールできます。</span><span class="sxs-lookup"><span data-stu-id="ea473-139">Users can install certificates.</span></span></li>
</ul>
</td>
<td><span data-ttu-id="ea473-140">追加のコストがあります。</span><span class="sxs-lookup"><span data-stu-id="ea473-140">There is additional cost.</span></span> <span data-ttu-id="ea473-141">(ただし、環境を廃止することによりコストを軽減することができます。)</span><span class="sxs-lookup"><span data-stu-id="ea473-141">(However, you can mitigate this cost by shutting down the environment.)</span></span></td>
</tr>
<tr>
<td><span data-ttu-id="ea473-142">自己ホストされダウンロードされた VM</span><span class="sxs-lookup"><span data-stu-id="ea473-142">Self-hosted downloaded VM</span></span></td>
<td><span data-ttu-id="ea473-143">経験は、ホストに依存します。</span><span class="sxs-lookup"><span data-stu-id="ea473-143">The experience depends on the host.</span></span> <span data-ttu-id="ea473-144">経験は、VM がソリッド ステート ドライブ (SSD) で実行するなら、さらに速くなります。</span><span class="sxs-lookup"><span data-stu-id="ea473-144">The experience can be much faster if the VM runs on a solid-state drive (SSD).</span></span></td>
<td><span data-ttu-id="ea473-145">ユーザーは、LCS のパッケージを配置することはできません。</span><span class="sxs-lookup"><span data-stu-id="ea473-145">Users can't deploy any packages from LCS.</span></span></td>
</tr>
</tbody>
</table>

<span data-ttu-id="ea473-146">第 2 層およびそれ以上のマシンは、複数のテストと検証の目的のためのマルチ ボックス環境です。</span><span class="sxs-lookup"><span data-stu-id="ea473-146">Tier 2 and higher machines are multi-box environments for multiple test and verification purposes.</span></span> <span data-ttu-id="ea473-147">実稼働環境はハンズ オンであり、LCS でサイズ変更のプロセスによって環境の規模が決定されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-147">Production environments are hands-off, and the size of the environment is determined by the sizing process in LCS.</span></span>

## <a name="branches-build-definitions-and-environments"></a><span data-ttu-id="ea473-148">分岐、ビルド定義、および環境</span><span class="sxs-lookup"><span data-stu-id="ea473-148">Branches, build definitions, and environments</span></span>

<span data-ttu-id="ea473-149">分岐は、ソフトウェア開発における重要なプラクティスです。</span><span class="sxs-lookup"><span data-stu-id="ea473-149">Branching is an important practice in software development.</span></span> <span data-ttu-id="ea473-150">分岐の詳細については、[分岐および結合入門書](https://msdn.microsoft.com/en-us/library/aa730834(v=vs.80).aspx)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-150">For more information about branching, see [Branching and Merging Primer](https://msdn.microsoft.com/en-us/library/aa730834(v=vs.80).aspx).</span></span>

<span data-ttu-id="ea473-151">前のページからの分岐の要約は以下の通りです。</span><span class="sxs-lookup"><span data-stu-id="ea473-151">Here is a summary of branching from the preceding page:</span></span>

> <span data-ttu-id="ea473-152">分岐と統合の戦略には、リスクと生産性のトレードオフがあります。</span><span class="sxs-lookup"><span data-stu-id="ea473-152">A branching and merging strategy involves a tradeoff between risk and productivity.</span></span> <span data-ttu-id="ea473-153">孤立して作業することの安全性と引き換えに、他の人と作業する生産性が向上します。</span><span class="sxs-lookup"><span data-stu-id="ea473-153">You trade the safety of working in isolation for the increased productivity of working with other people.</span></span> <span data-ttu-id="ea473-154">生産性の向上にはコストが伴います。追加作業量は今後ソフトウェアの資産をマージするために必要です。</span><span class="sxs-lookup"><span data-stu-id="ea473-154">The productivity increases come with a cost—the additional effort required for merging software assets sometime in the future.</span></span>
>
> <span data-ttu-id="ea473-155">ブランチを使用すると、チームや個人が並行して作業できるため、個々のソフトウェア資産の分離とコントロールが向上し、生産性が増します。</span><span class="sxs-lookup"><span data-stu-id="ea473-155">Using branches provides better isolation and control of individual software assets and increases productivity, because teams or individuals can work in parallel.</span></span> <span data-ttu-id="ea473-156">ただし、分岐を使用すると、後で分岐全体を再構成する必要があるため、マージ アクティビティの増加も必要になり、そのためリスクも増加します。</span><span class="sxs-lookup"><span data-stu-id="ea473-156">However, using branches also requires an increase in merge activities and therefore risk, because you must later reassemble branches into a whole.</span></span>

<span data-ttu-id="ea473-157">Microsoft Dynamics 365 for Finance and Operations のための実装プロジェクトのデリバリーの詳細については、[Dynamics 365 for Operations を使用した継続的デリバリー (ビデオ)](https://mbspartner.microsoft.com/D365/Videos/101393) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ea473-157">For more information about the delivery of implementation projects for Microsoft Dynamics 365 for Finance and Operations, watch [Continuous Delivery Using Dynamics 365 for Operations (video)](https://mbspartner.microsoft.com/D365/Videos/101393).</span></span>

<span data-ttu-id="ea473-158">分岐を作成するうえで、唯一の最良な戦略はありません。</span><span class="sxs-lookup"><span data-stu-id="ea473-158">There is no single best strategy for creating branches.</span></span> <span data-ttu-id="ea473-159">使用されるアプローチは、プロジェクト、および実装のサイズによって異なります。</span><span class="sxs-lookup"><span data-stu-id="ea473-159">The approach that is used depends on the project and the size of the implementation.</span></span> <span data-ttu-id="ea473-160">Joris De Gruyter が上記のビデオで述べているアプローチは成功したメソッドです。</span><span class="sxs-lookup"><span data-stu-id="ea473-160">The approach that Joris De Gruyter mentions in the preceding video is a successful method.</span></span>

<span data-ttu-id="ea473-161">次の図は、3 つのコード ブランチを示しています: Dev、Main、および ProdRel1。</span><span class="sxs-lookup"><span data-stu-id="ea473-161">The following illustration shows three code branches: Dev, Main, and ProdRel1.</span></span> <span data-ttu-id="ea473-162">数字は、セットアップの順序を示します。</span><span class="sxs-lookup"><span data-stu-id="ea473-162">The numbers indicate the order of setup.</span></span>

![分岐の作成](./media/1-Three-Code-Branch.png)

<span data-ttu-id="ea473-164">設定の説明は以下の通りです。</span><span class="sxs-lookup"><span data-stu-id="ea473-164">Here is an explanation of the setup.</span></span> <span data-ttu-id="ea473-165">かっこ内の数字は、前の図の番号を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-165">The numbers in brackets refer to the numbers in the preceding illustration:</span></span>

- <span data-ttu-id="ea473-166">**Dev** ブランチ [2] は、テストの準備ができていない、または安定していない可能性がある日常作業に使用されますが、他の開発者と共有する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-166">The **Dev** branch [2] is used for daily work that isn't ready for testing or might not be stable, but that must be shared with other developers.</span></span> <span data-ttu-id="ea473-167">大規模なチームは、さまざまな機能または目的のために、複数の開発ブランチを持つこともできます。</span><span class="sxs-lookup"><span data-stu-id="ea473-167">For larger teams, you might want to have multiple Dev branches for different features or purposes.</span></span>
- <span data-ttu-id="ea473-168">**Main** ブランチ [1] は、品質基準を満たし、他のユーザーによるテストの準備ができている変更のためのものです。</span><span class="sxs-lookup"><span data-stu-id="ea473-168">The **Main** branch [1] is for changes that meet a certain quality bar and are ready for testing by other people.</span></span> <span data-ttu-id="ea473-169">このテストには、ユーザー承認テスト、パフォーマンス テスト、統合テスト、および修正プログラム後のサニティ テストが含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-169">This testing might include user acceptance tests, performance tests, integration tests, and sanity tests after hotfixes.</span></span> <span data-ttu-id="ea473-170">この分岐の配置可能パッケージは、ビルド環境で作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-170">Deployable packages for this branch must be created by a build environment.</span></span> <span data-ttu-id="ea473-171">ベスト プラクティスとして、レベル 1 環境で X++ パッケージを生成し、それらのパッケージを公式テストまたは実稼動環境に配置するべきではありません。</span><span class="sxs-lookup"><span data-stu-id="ea473-171">As a best practice, you should not generate X++ packages in a Tier 1 environment and then deploy those packages into an official test or production environment.</span></span> <span data-ttu-id="ea473-172">それ以外の場合は、コミットされていないソースの変更が含まれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-172">Otherwise, uncommitted source changes could be included.</span></span> <span data-ttu-id="ea473-173">適切なアプローチは、常に正式なビルド環境でビルドされたパッケージを展開します。</span><span class="sxs-lookup"><span data-stu-id="ea473-173">The correct approach is always to deploy packages that were built on official build environments.</span></span>
- <span data-ttu-id="ea473-174">**ProdRel1** ブランチ [3] は、任意の時点で実稼働環境に配備される際、全てのソース コードを保留します。</span><span class="sxs-lookup"><span data-stu-id="ea473-174">The **ProdRel1** branch [3] holds all source code exactly as it's deployed in a production environment at any given point.</span></span> <span data-ttu-id="ea473-175">ビルド環境で使用できますが、必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="ea473-175">A build environment can be used but isn't required.</span></span> <span data-ttu-id="ea473-176">Main ブランチからのパッケージが実稼働環境に配置されている場合、運用配置後に (Main から ProdRel1 へ) コードをマージする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-176">If packages from the Main branch are deployed to a production environment, the code should be merged (from Main to ProdRel1) after a production deployment.</span></span> <span data-ttu-id="ea473-177">生産用分岐を用意することで、ビルドが必要な場合に、後で公式ビルドを生成することができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-177">By having a branch for production, you can generate official builds later if you require them.</span></span>
- <span data-ttu-id="ea473-178">3 つのすべての分岐は、 X++ コード (メタデータのフォルダー内の拡張機能および修正プログラム)、および Retail ソフトウェア開発キット (SDK) のコピーの両方を **RetailSdk** のフォルダー [5, 6, 7] 内に保持しています。</span><span class="sxs-lookup"><span data-stu-id="ea473-178">All three branches hold both X++ code (extensions and hotfixes in Metadata folders) and a copy of the Retail software development kit (SDK) in **RetailSdk** folders [5, 6, 7].</span></span> <span data-ttu-id="ea473-179">Retail SDKには、基準の Microsoft コードおよびコードの拡張子が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ea473-179">The Retail SDK includes base Microsoft code and code extensions.</span></span> <span data-ttu-id="ea473-180">この基本コードとコードの拡張機能は、各分岐で異なります。</span><span class="sxs-lookup"><span data-stu-id="ea473-180">This base code and the code extensions can differ in each branch.</span></span>
- <span data-ttu-id="ea473-181">**RetailSdk-mirror** フォルダー [4] は、Microsoft 変更を Retail SDK に持ち込むために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-181">The **RetailSdk-mirror** folder [4] is used to bring in Microsoft changes to the Retail SDK.</span></span> <span data-ttu-id="ea473-182">開発またはビルドの目的で使用されていません。</span><span class="sxs-lookup"><span data-stu-id="ea473-182">It isn't used for development or build purposes.</span></span> <span data-ttu-id="ea473-183">新しいバージョンまたは修正プログラムを使用する場合にのみ更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-183">It should be updated only when a new version or hotfix is used.</span></span> <span data-ttu-id="ea473-184">プロセスの詳細については [Dynamics 365 for Finance and Operations 修正プログラムおよび配置のチート シート](https://dynamicsnotes.com/dynamics-365-for-finance-and-operations-hotfix-and-deployment-cheat-sheet/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-184">For a detailed description of the process, see [Dynamics 365 for Finance and Operations hotfix and deployment cheat sheet](https://dynamicsnotes.com/dynamics-365-for-finance-and-operations-hotfix-and-deployment-cheat-sheet/).</span></span>

<span data-ttu-id="ea473-185">小規模な小売プロジェクトでは、分岐が 2 つしかなくても構いません (メイン = 開発分岐)。</span><span class="sxs-lookup"><span data-stu-id="ea473-185">For small Retail projects, it's acceptable to have only two branches (Main = Dev branch).</span></span> <span data-ttu-id="ea473-186">ただし、コード送信はテスト ビルドの品質に即座に影響を与える可能性があるため、開発者は規範を守らなければなりません。</span><span class="sxs-lookup"><span data-stu-id="ea473-186">However, developers must be more disciplined, because any code submissions can immediately affect the quality of test builds.</span></span> 

<span data-ttu-id="ea473-187">複数のブランチから配置可能なパッケージを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-187">You can build deployable packages out of multiple branches.</span></span> <span data-ttu-id="ea473-188">この場合、ビルド可能な各分岐に対して 1 つのビルド定義を持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-188">In this case, you must have one build definition for each branch that can be built.</span></span> <span data-ttu-id="ea473-189">ビルド環境が配置される際、初期のビルド定義が自動的に作成されます (Main ブランチ)。</span><span class="sxs-lookup"><span data-stu-id="ea473-189">The initial build definition is automatically created when a build environment is deployed (Main branch).</span></span> <span data-ttu-id="ea473-190">他のブランチのビルドのコピーを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-190">You can make copies of the build for other branches.</span></span> <span data-ttu-id="ea473-191">小売コードを組み込むには、小規模な追加を行う必要があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-191">Note that you must make small additions to incorporate the Retail code.</span></span>

<span data-ttu-id="ea473-192">次の高レベルの手順を使用して、開発作業を開始できるように環境を設定します。</span><span class="sxs-lookup"><span data-stu-id="ea473-192">The following high-level steps are used to set up an environment so that development work can begin.</span></span> <span data-ttu-id="ea473-193">カッコ内の数字の詳細については、前述の図と関連情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-193">For details about the numbers in brackets, see the previous illustration and the related information.</span></span>

1. <span data-ttu-id="ea473-194">Microsoft Visual Studio Team Services (VSTS) [1] にビルド環境と空の Main ブランチを配置します。</span><span class="sxs-lookup"><span data-stu-id="ea473-194">Deploy a build environment and an empty Main branch in Microsoft Visual Studio Team Services (VSTS) [1].</span></span>
2. <span data-ttu-id="ea473-195">開発環境の配置をする。</span><span class="sxs-lookup"><span data-stu-id="ea473-195">Deploy a development environment.</span></span>
3. <span data-ttu-id="ea473-196">開発ブランチとリリース ブランチ (たとえば、前の図 ProdRel1) を作成する [2, 3]。</span><span class="sxs-lookup"><span data-stu-id="ea473-196">Create the Dev branch and the release branch (for example, ProdRel1 in the previous illustration) [2, 3].</span></span>
4. <span data-ttu-id="ea473-197">Retail SDK [4–7] を追加します。</span><span class="sxs-lookup"><span data-stu-id="ea473-197">Add the Retail SDK [4–7].</span></span>
5. <span data-ttu-id="ea473-198">開発環境を準備します。</span><span class="sxs-lookup"><span data-stu-id="ea473-198">Prepare the development environment.</span></span>
6. <span data-ttu-id="ea473-199">オプション: 別のリリース ブランチの 2 つ目のビルド環境を配置します。</span><span class="sxs-lookup"><span data-stu-id="ea473-199">Optional: Deploy a second build environment for a different release branch.</span></span>
7. <span data-ttu-id="ea473-200">ビルド定義を準備します。</span><span class="sxs-lookup"><span data-stu-id="ea473-200">Prepare the build definitions.</span></span>

<span data-ttu-id="ea473-201">これらすべての手順が完了した後、分岐、環境、およびビルドが準備完了になります。</span><span class="sxs-lookup"><span data-stu-id="ea473-201">After you've completed all these steps, your branches, environment, and builds will be ready.</span></span>

<span data-ttu-id="ea473-202">次のセクションでは、各手順の詳細について説明します。</span><span class="sxs-lookup"><span data-stu-id="ea473-202">The following sections explain each step in detail.</span></span>

## <a name="deploy-a-build-environment-and-an-empty-main-branch-in-vsts"></a><span data-ttu-id="ea473-203">ビルド環境と VSTS の空の Main ブランチを配置する</span><span class="sxs-lookup"><span data-stu-id="ea473-203">Deploy a build environment and an empty Main branch in VSTS</span></span>

<span data-ttu-id="ea473-204">LCS のポータルを使用して、新しいビルド環境を配置します。</span><span class="sxs-lookup"><span data-stu-id="ea473-204">Use the LCS portal to deploy a new build environment.</span></span> <span data-ttu-id="ea473-205">管理者権限がある場合は、より多くのオプションと機能を有することができるため、クラウド ホスト環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ea473-205">We recommend that you use a cloud-hosted environment, because you will have more options and capabilities if you have administrative rights.</span></span> <span data-ttu-id="ea473-206">このトピックで前述した、「第 1 層環境の開発」のさまざまな環境ホスティング モデルに関するテーブルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-206">See the table about the various environment hosting models in the "Development Tier 1 environments" section, earlier in this topic.</span></span>

<span data-ttu-id="ea473-207">未所持の場合は、新しい VSTS プロジェクトを作成して開始します。</span><span class="sxs-lookup"><span data-stu-id="ea473-207">Start by creating a new VSTS project if you don't already have one.</span></span> <span data-ttu-id="ea473-208">VSTS アカウントで、**新しいプロジェクト**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-208">In your VSTS account, select **New project**.</span></span>

![VSTS プロジェクト](./media/2-VSTS-project.png)

<span data-ttu-id="ea473-210">新しい VSTS プロジェクトが作成されると、VSTS へのアクセスを許可する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-210">After the new VSTS project is created, you must allow VSTS to access it.</span></span> <span data-ttu-id="ea473-211">最初に、VSTS アカウントに新しい個人用のアクセス トークンを作成します。</span><span class="sxs-lookup"><span data-stu-id="ea473-211">First, create a new personal access token on the VSTS account.</span></span> <span data-ttu-id="ea473-212">次に、正しい URL と個人用アクセス トークンで LCS プロジェクトをコンフィギュレーションします。</span><span class="sxs-lookup"><span data-stu-id="ea473-212">Then configure the LCS project with the correct URL and personal access token.</span></span>

![LCS プロジェクト](./media/3-LCS-project.png)

<span data-ttu-id="ea473-214">LCS プロジェクトが VSTS にリンクされたら、配置の準備ができています。</span><span class="sxs-lookup"><span data-stu-id="ea473-214">After the LCS project is linked to VSTS, you're ready to deploy.</span></span>

<span data-ttu-id="ea473-215">新しい環境を追加、バージョンを選択、**DEVTEST** をトポロジとして追加、およびビルド環境を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-215">Add a new environment, select the version, select **DEVTEST** as the topology, and select a build environment.</span></span> <span data-ttu-id="ea473-216">次のページで、意味のある環境名を入力します。</span><span class="sxs-lookup"><span data-stu-id="ea473-216">On the next page, enter a meaningful name for the environment.</span></span> <span data-ttu-id="ea473-217">次に、ビルド エージェントの類似の名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="ea473-217">Then enter a similar name for the build agent.</span></span>

![ビルド エージェント](./media/4-build-agent.png)

<span data-ttu-id="ea473-219">次に、**仮想マシン名をカスタマイズ**で、一意の名前を入力してから配置します。</span><span class="sxs-lookup"><span data-stu-id="ea473-219">Next, under **Customize virtual machine names**, enter a unique name, and then deploy.</span></span>

<span data-ttu-id="ea473-220">ビルド ボックスは配置され、ビルド定義および Main ブランチが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-220">The build box is deployed, and the build definition and Main branch are created.</span></span> <span data-ttu-id="ea473-221">このプロセスには数時間かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-221">This process might take a couple of hours.</span></span>

![ビルド ボックス Main ブランチ](./media/5-build-box-main-branch.png)

![ビルド定義](./media/19-build-definitions.png)

![既定プールのエージェント](./media/20-agents-for-pool-default.png)

## <a name="deploy-a-development-environment"></a><span data-ttu-id="ea473-225">開発環境の配置</span><span class="sxs-lookup"><span data-stu-id="ea473-225">Deploy a development environment</span></span>

<span data-ttu-id="ea473-226">実装プロジェクトの LCS ポータルを使用して、クラウド ホストの開発環境を作成します。</span><span class="sxs-lookup"><span data-stu-id="ea473-226">Use the LCS portal of your implementation project to create a cloud-hosted development environment.</span></span> <span data-ttu-id="ea473-227">正しいユーザー アカウントにサイン インしていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-227">Make sure that you're signed in to the correct user account.</span></span> <span data-ttu-id="ea473-228">このユーザー アカウントは開発マシンのテナントの作成に使用されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-228">This user account is used to create the tenant of the development machine.</span></span> <span data-ttu-id="ea473-229">たとえば、LCS に `lily@pad.com` としてサインインしている場合、環境は @pad.com テナント用に設定され、そのテナントからのユーザが必要です。</span><span class="sxs-lookup"><span data-stu-id="ea473-229">For example, if you're signed in to LCS as `lily@pad.com`, the environment is set up for the @pad.com tenant and expects users from that tenant.</span></span> <span data-ttu-id="ea473-230">他のユーザーを追加することができますが、POSの有効化はそのテナントのユーザーが行う必要があります</span><span class="sxs-lookup"><span data-stu-id="ea473-230">Although other users can be added, the POS activation must be done by a user from that tenant.</span></span> <span data-ttu-id="ea473-231">場合によっては、顧客、パートナー、または他の関係者が異なるドメインの電子メール アカウントを使用する場合など、異なるドメインのユーザー アカウントが使用されることもあります。</span><span class="sxs-lookup"><span data-stu-id="ea473-231">In some cases, user accounts from different domains can be used, such as when customers, partners, or other parties use email accounts from different domains.</span></span> <span data-ttu-id="ea473-232">このような場合、配置中に使用されたテナントのみがユーザーをアクティブ化できるため、POS が有効なうちに調整が必要です。</span><span class="sxs-lookup"><span data-stu-id="ea473-232">In these cases, coordination is required during POS activation, because only the tenant that was used during deployment can activate users.</span></span>

<span data-ttu-id="ea473-233">正しいバージョンを選択し、**DEVTEST** を選択し、**DEV** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-233">Select the correct version, select **DEVTEST**, and then select **DEV**.</span></span> <span data-ttu-id="ea473-234">わかりやすい固有の名前を入力し、詳細設定でもマシン名が固有であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-234">Enter a meaningful and unique name, and make sure that the machine name is also unique in the advanced settings.</span></span> <span data-ttu-id="ea473-235">マシン準備のプロセスは、数時間かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-235">The process of preparing the machine might take a couple of hours.</span></span>

<span data-ttu-id="ea473-236">現在、Dev 分岐は存在しないため、VSTS をローカル ディレクトリにマッピングするプロセスをスキップ可能です。</span><span class="sxs-lookup"><span data-stu-id="ea473-236">Because there is currently no Dev branch, you can skip the process of mapping VSTS to the local directories.</span></span> <span data-ttu-id="ea473-237">ただし、後でそのプロセスを完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-237">However, you will have to complete that process later.</span></span>

## <a name="create-the-dev-and-release-branches"></a><span data-ttu-id="ea473-238">開発およびリリースの分岐を作成する</span><span class="sxs-lookup"><span data-stu-id="ea473-238">Create the Dev and release branches</span></span>

<span data-ttu-id="ea473-239">既述のように、頻繁に行われるが、あまり頻繁にテストされない変更を保持するブランチを持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-239">As was mentioned earlier, you must have a branch that holds changes that are often made but less often tested.</span></span> <span data-ttu-id="ea473-240">生産のソース コードを格納するブランチも必要です。</span><span class="sxs-lookup"><span data-stu-id="ea473-240">You must also have a branch that holds the source code for production.</span></span> <span data-ttu-id="ea473-241">次の図は、予期される階層を示しています。</span><span class="sxs-lookup"><span data-stu-id="ea473-241">The following illustration shows the expected hierarchy.</span></span>

![Main ブランチ階層](./media/6-main-branch-hierarchy.png)

<span data-ttu-id="ea473-243">分岐を作成するには、次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="ea473-243">Follow these steps to create the branches.</span></span>

1. <span data-ttu-id="ea473-244">開発環境にサインインします。</span><span class="sxs-lookup"><span data-stu-id="ea473-244">Sign in to a development environment.</span></span>
2. <span data-ttu-id="ea473-245">管理者は、Microsoft Visual Studio を起動し、VSTS プロジェクトへのアクセスを持つアカウントを使用して記録するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="ea473-245">Start Microsoft Visual Studio as an administrator, and make sure that you signed in by using an account that has access to the VSTS project.</span></span>
3. <span data-ttu-id="ea473-246">チーム エクスプローラーでは、この接続が存在しない場合に、VSTS のプロジェクトに Visual Studio を接続します。</span><span class="sxs-lookup"><span data-stu-id="ea473-246">In Team Explorer, connect Visual Studio to the VSTS project, if this connection doesn't already exist.</span></span>
4. <span data-ttu-id="ea473-247">**トランク**/**メイン** フォルダーをローカル フォルダーにマップします (このマッピングが既に存在しない場合)。</span><span class="sxs-lookup"><span data-stu-id="ea473-247">Map the **Trunk**/**Main** folder to a local folder (if this mapping doesn't already exist).</span></span> <span data-ttu-id="ea473-248">このマッピングは一時的なものです。</span><span class="sxs-lookup"><span data-stu-id="ea473-248">This mapping is temporary.</span></span>
5. <span data-ttu-id="ea473-249">ソース管理エクスプローラーでは、**メイン** フォルダーを右クリックし、**分岐および結合** \> **分岐への変換**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-249">In Source Control Explorer, right-click the **Main** folder, and then select **Branching and Merging** \> **Convert to Branch**.</span></span>
6. <span data-ttu-id="ea473-250">**Main** ブランチを右クリックし、**分岐とマージ** \>**分岐**を選択し、新しい分岐を**開発**と名付けます。</span><span class="sxs-lookup"><span data-stu-id="ea473-250">Right-click the **Main** branch, select **Branching and Merging** \> **Branch**, and name the new branch **Dev**.</span></span>
7. <span data-ttu-id="ea473-251">**保留中の変更**を使用し、この変更内容を VSTS に送信します。</span><span class="sxs-lookup"><span data-stu-id="ea473-251">Use **Pending Changes**, and submit this change to VSTS.</span></span>
8. <span data-ttu-id="ea473-252">**Main** ブランチを右クリックし、**分岐とマージ** \>**分岐**を選択し、新しい分岐を **ProdRel1** と名付けます。</span><span class="sxs-lookup"><span data-stu-id="ea473-252">Right-click the **Main** branch, select **Branching and Merging** \> **Branch**, and name the new branch **ProdRel1**.</span></span>
9. <span data-ttu-id="ea473-253">**保留中の変更**を使用し、この変更内容を VSTS に送信します。</span><span class="sxs-lookup"><span data-stu-id="ea473-253">Use **Pending Changes**, and submit this change to VSTS.</span></span>

<span data-ttu-id="ea473-254">この時点で、 Visual Studio の Source Depot エクスプローラーは次の図のようになります。</span><span class="sxs-lookup"><span data-stu-id="ea473-254">At this point, Source Depot Explorer in Visual Studio should resemble the following illustration.</span></span>

![Source Depot エクスプローラー](./media/7-source-depot-explorer.png)

## <a name="add-the-retail-sdk"></a><span data-ttu-id="ea473-256">Retail SDK を追加</span><span class="sxs-lookup"><span data-stu-id="ea473-256">Add the Retail SDK</span></span>

<span data-ttu-id="ea473-257">次に、3 つのコード分岐のそれぞれに Retail SDK を追加して、コードの変更を Dev から Main に、そして最終的に ProdRel1 に反映させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-257">Next, you must add the Retail SDK to each of the three code branches, so that code changes can be propagated from Dev to Main and eventually to ProdRel1.</span></span> <span data-ttu-id="ea473-258">このステップでは、X++ コードと同様に、これらの分岐間での別々の変更も可能です。</span><span class="sxs-lookup"><span data-stu-id="ea473-258">This step also enables separate changes between these branches, as for the X++ code.</span></span> <span data-ttu-id="ea473-259">したがって、 X++ コードと共にすべての分岐に Retail SDK があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-259">Therefore, we will have the Retail SDK in every branch, together with the X++ code.</span></span> 

<span data-ttu-id="ea473-260">最初に、ミラー分岐を追加します。</span><span class="sxs-lookup"><span data-stu-id="ea473-260">First, add the mirror branch.</span></span> <span data-ttu-id="ea473-261">Retail SDK のミラー ブランチは、Microsoft からの更新プログラムをインポートする際、コード マージのベースラインとして必要です。</span><span class="sxs-lookup"><span data-stu-id="ea473-261">The Retail SDK mirror branch is required as a baseline for code merges when updates from Microsoft are imported.</span></span> <span data-ttu-id="ea473-262">更新プログラムを実行するプロセスについては、このトピックの後で説明があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-262">The process for taking updates will be explained later in this topic.</span></span> <span data-ttu-id="ea473-263">最初にミラー分岐を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-263">First, you must create the mirror branch.</span></span>

<span data-ttu-id="ea473-264">ミラー ブランチまたはフォルダーは、プロジェクトごとに 1 回のみ必要です。</span><span class="sxs-lookup"><span data-stu-id="ea473-264">The mirror branch or folder is only required one time per project.</span></span>

1. <span data-ttu-id="ea473-265">開発を開始する正確なバージョンのある変更していない Retail SDK を検索します。</span><span class="sxs-lookup"><span data-stu-id="ea473-265">Find the unchanged Retail SDK that has the exact version that you want to start your development with.</span></span> <span data-ttu-id="ea473-266">この Retail SDK は、サービス ドライブ上のすべての開発マシン、またはダウンロードされたすべての修正プログラムに表示されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-266">This Retail SDK can be found on every development machine on the service drive, or in every downloaded hotfix.</span></span> <span data-ttu-id="ea473-267">Microsoft-version.txt ファイルを調べることによって、Retail SDK のバージョンを一意に識別することができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-267">You can uniquely identify a version of the Retail SDK by inspecting the Microsoft-version.txt file.</span></span> <span data-ttu-id="ea473-268">このファイルは、Retail SDK ミラー フォルダへの更新以外は変更しないでください。</span><span class="sxs-lookup"><span data-stu-id="ea473-268">This file should not be changed, except by an update to the Retail SDK mirror folder.</span></span>

    ![Retail SDK](./media/8-retail-sdk.png)

2. <span data-ttu-id="ea473-270">ソース管理エクスプローラーでは、**トランク** フォルダーを右クリックし、**フォルダーへの品目の追加**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-270">In Source Control Explorer, right-click the **Trunk** folder, and then select **Add Items to Folder**.</span></span>
2. <span data-ttu-id="ea473-271">小売 SDK でトップ フォルダーを選択し、**次へ**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-271">Select the top folder in the Retail SDK, and then select **Next**.</span></span>
3. <span data-ttu-id="ea473-272">Visual Studioは、追加されるファイルの数を示します。</span><span class="sxs-lookup"><span data-stu-id="ea473-272">Visual Studio shows the number of files that will be added.</span></span> <span data-ttu-id="ea473-273">**RetailSdk** フォルダーが**トランク** フォルダーの下にあることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-273">Make sure that the **RetailSdk** folder is under the **Trunk** folder.</span></span>
4. <span data-ttu-id="ea473-274">項目を選択してから、**項目を含む**を選択して、除外されたアイテムが 0 (ゼロ) であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-274">Make sure that there are 0 (zero) excluded items by selecting items and then selecting **Include items**.</span></span>

    ![ソース管理](./media/9-source-control.png)

5. <span data-ttu-id="ea473-276">**完了** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-276">Select **Finish**.</span></span> <span data-ttu-id="ea473-277">このプロセスには数分かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-277">This process will take a few minutes.</span></span>
6. <span data-ttu-id="ea473-278">処理が完了したら、フォルダーの名前を **RetailSdk-mirror** に変更します。</span><span class="sxs-lookup"><span data-stu-id="ea473-278">When the process is completed, rename the folder **RetailSdk-mirror**.</span></span>

<span data-ttu-id="ea473-279">次に、各分岐に分岐する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-279">Next, you must branch to each branch.</span></span> <span data-ttu-id="ea473-280">コードの変更と同じパスをたどります。最初は Dev、その後は Main、次に ProdRel1 に進みます。</span><span class="sxs-lookup"><span data-stu-id="ea473-280">Follow the same path that the code changes will flow in: first to Dev, then to Main, and then to ProdRel1.</span></span>

1. <span data-ttu-id="ea473-281">ミラー分岐のフォルダーを選択し、右クリックして、**分岐とマージ** \> **分岐**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-281">Select the folder for the mirror branch, right-click, and then select **Branching and Merging** \> **Branch**.</span></span>
2. <span data-ttu-id="ea473-282">**開発**分岐に移動し、**/RetailSdk** を名前に追加し、それから **OK** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-282">Go to the **Dev** branch, append **/RetailSdk** to the name, and then select **OK**.</span></span>

    ![分岐の変更](./media/10-branch-change.png)

3. <span data-ttu-id="ea473-284">**保留中の変更**を使用し、変更内容を送信します。</span><span class="sxs-lookup"><span data-stu-id="ea473-284">Use **Pending Changes**, and submit the changes.</span></span>
4. <span data-ttu-id="ea473-285">同様の手順に従って、**開発**ブランチの **RetailSdk** フォルダを **Main** ブランチに分岐します。</span><span class="sxs-lookup"><span data-stu-id="ea473-285">Follow the same steps to branch the **RetailSdk** folder of the **Dev** branch to the **Main** branch.</span></span>
5. <span data-ttu-id="ea473-286">同様の手順に従って、**Main** ブランチの **RetailSdk** フォルダを **ProdRel1** ブランチに分岐します。</span><span class="sxs-lookup"><span data-stu-id="ea473-286">Follow the same steps to branch the **RetailSdk** folder of the **Main** branch to the **ProdRel1** branch.</span></span>

<span data-ttu-id="ea473-287">この時点で、 X++ および小売拡張機能設定のコード ブランチとコード場所があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-287">At this point, you have the code branches and code locations for the X++ and Retail extensions setup.</span></span> <span data-ttu-id="ea473-288">ソース管理エクスプローラーでは、ファイル構造は次の図のようになります。</span><span class="sxs-lookup"><span data-stu-id="ea473-288">In Source Control Explorer, the file structure should resemble the following illustration.</span></span>

![ソース管理エクスプローラー](./media/11-source-control-explorer.png)

<span data-ttu-id="ea473-290">小売カスタマイズのバージョンを変更する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="ea473-290">You should also change the version of the Retail customization.</span></span> <span data-ttu-id="ea473-291">このバージョンは、Dev、Main、および ProdRel1 の分岐で異なっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-291">This version should differ in the Dev, Main, and ProdRel1 branches.</span></span> <span data-ttu-id="ea473-292">Customization.settings ファイルを変更するか、**RetailSdk\\BuildTools** フォルダーに新しい global.props ファイルを追加してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-292">Either change the Customization.settings file, or add a new global.props file in the **RetailSdk\\BuildTools** folder.</span></span> <span data-ttu-id="ea473-293">たとえば、Dev に 1.0.0.x、Main に 1.0.1.x、ProdRel1 に 1.0.2.x と番号を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-293">For example, you can number Dev as 1.0.0.x, Main as 1.0.1.x, and ProdRel1 as 1.0.2.x.</span></span>

## <a name="prepare-the-development-environment"></a><span data-ttu-id="ea473-294">開発環境の準備</span><span class="sxs-lookup"><span data-stu-id="ea473-294">Prepare the development environment</span></span>

<span data-ttu-id="ea473-295">小売開発タスクに開発環境を準備することができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-295">You can now prepare the development environment for Retail development tasks.</span></span> <span data-ttu-id="ea473-296">開発環境では、Dev ブランチの X++ と Retail SDK の両コード の場所をローカル フォルダーにマップします。</span><span class="sxs-lookup"><span data-stu-id="ea473-296">The development environment will map the code locations for both X++ and the Retail SDK in the Dev branch to local folders.</span></span> <span data-ttu-id="ea473-297">メタデータ フォルダー (X++) は、常に PackagesLocalDirectory フォルダーへ割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-297">The Metadata folder (X++) must be always mapped to the PackagesLocalDirectory folder.</span></span> <span data-ttu-id="ea473-298">RetailSdk フォルダーの場所は、次のガイドラインに従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-298">The location of the RetailSdk folder must follow these guidelines:</span></span>

- <span data-ttu-id="ea473-299">場所は、ローカル ユーザーのフォルダーのどこかにあるはずです。</span><span class="sxs-lookup"><span data-stu-id="ea473-299">The location should be somewhere inside the local user's folder.</span></span>
- <span data-ttu-id="ea473-300">いかなるファイルのファイル パスは、256 文字を超えてはいけません。</span><span class="sxs-lookup"><span data-stu-id="ea473-300">The file path of any file should have no more than 256 characters.</span></span> <span data-ttu-id="ea473-301">そのため、Retail SDK のルートへの短いパスを使用します。</span><span class="sxs-lookup"><span data-stu-id="ea473-301">Therefore, use a short path for the root of the Retail SDK.</span></span> <span data-ttu-id="ea473-302">たとえば、**c:\\ユーザー\\\<ユーザー名\>\\ソース\\RetailSdk** を使用できます。</span><span class="sxs-lookup"><span data-stu-id="ea473-302">For example, you can use **c:\\users\\\<user name\>\\Source\\RetailSdk**.</span></span>

<span data-ttu-id="ea473-303">X++ および Retail SDK をマップするには、現在のワークスペースを編集する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-303">To map the X++ and Retail SDK, you must edit the current workspace.</span></span> <span data-ttu-id="ea473-304">**保留中の変更** \> **操作** \> **ワークスペース**を選択し、現在のワークスペースを次の図のように更新します。</span><span class="sxs-lookup"><span data-stu-id="ea473-304">Select **Pending Changes** \> **Actions** \> **Workspaces**, and update the current workspace so that it resembles the following illustration.</span></span> <span data-ttu-id="ea473-305">既述のように、分岐のメタデータ フォルダーを PackagesLocalDirectory フォルダーに、RetailSdk を選択した短縮フォルダーにマップする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-305">As was mentioned earlier, you should map the Metadata folder of the branch to the PackagesLocalDirectory folder and the RetailSdk to a short folder of your choice.</span></span>

![現在のワークスペースの編集](./media/12-edit-current-workspace.png)

<span data-ttu-id="ea473-307">ファイルの実際のダウンロードには数分かかります。</span><span class="sxs-lookup"><span data-stu-id="ea473-307">The actual download of the files can take a few minutes.</span></span>

<span data-ttu-id="ea473-308">コード ブランチのカスタマイズがあるかどうかに関係なく、次の手順は、開発ボックスを小売拡張コードに書き込み実行できる状態に戻すのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="ea473-308">Regardless of whether there are customizations in the code branches, the following steps help bring a development box into a state where Retail extension code can be written and run.</span></span> <span data-ttu-id="ea473-309">計画されているカスタマイズに応じて、いくつかの手順はオプションとなります。</span><span class="sxs-lookup"><span data-stu-id="ea473-309">Some steps might be optional, depending on the customizations that are planned.</span></span>

1. <span data-ttu-id="ea473-310">好みの開発ツールをインストールします。</span><span class="sxs-lookup"><span data-stu-id="ea473-310">Install your favorite development tools.</span></span> <span data-ttu-id="ea473-311">自動化されたスクリプトの詳細については、[最も必要な開発ツールを Chocolatey で 5 分で自動インストールする](https://dynamicsnotes.com/auto-installing-most-needed-dev-tools-in-5-mins/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-311">For information about one automated script, see [Auto-Installing most needed dev tools in 5 mins with Chocolatey](https://dynamicsnotes.com/auto-installing-most-needed-dev-tools-in-5-mins/).</span></span>
2. <span data-ttu-id="ea473-312">コンパイル時間を削減するには、Microsoft Windows Defender からコードのフォルダーを除外します。</span><span class="sxs-lookup"><span data-stu-id="ea473-312">To help reduce the compile time, exclude the code folders from Microsoft Windows Defender.</span></span>
3. <span data-ttu-id="ea473-313">開発/メタデータ フォルダー内のコードが既にある場合は、すべての Retail モデルを構築してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-313">If there is already code in the Dev/Metadata folder, build all Retail models.</span></span> <span data-ttu-id="ea473-314">すべてのモデルを選択し、**データベース同期**を選択します。</span><span class="sxs-lookup"><span data-stu-id="ea473-314">Select all the models, and then select **Database sync**.</span></span>
4. <span data-ttu-id="ea473-315">開発経験を速めるために、Microsoft インターネット インフォメーション サービス (IIS) に切り替えます。</span><span class="sxs-lookup"><span data-stu-id="ea473-315">To speed up the development experience, switch to Microsoft Internet Information Services (IIS).</span></span> <span data-ttu-id="ea473-316">手順については、[MSDyn365FO. IIS Express から開発 VM の IIS に切り替える方法](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-316">For instructions, see [MSDyn365FO. How to switch from IIS Express to IIS on development VM.](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/).</span></span> <span data-ttu-id="ea473-317">この手順は、管理者権限 (クラウド ホスト環境) を持つ第 1 層の VM でのみ実行できます。</span><span class="sxs-lookup"><span data-stu-id="ea473-317">This step can be done only on the Tier 1 VM where you have administrative privileges (cloud-hosted environment).</span></span>
5. <span data-ttu-id="ea473-318">オプション: 適切なデータが含まれている生産データベースの最新のコピーを復元します。</span><span class="sxs-lookup"><span data-stu-id="ea473-318">Optional: Restore a recent copy of a production database that has good data.</span></span>

    1. <span data-ttu-id="ea473-319">既存のデータベース **AxDB_Orig** の名前を変更します。</span><span class="sxs-lookup"><span data-stu-id="ea473-319">Rename the existing database **AxDB_Orig**.</span></span>
    2. <span data-ttu-id="ea473-320">Microsoft SQL Server Management Studio では、.bak ファイルを復元します。</span><span class="sxs-lookup"><span data-stu-id="ea473-320">In Microsoft SQL Server Management Studio, restore the .bak file.</span></span> <span data-ttu-id="ea473-321">(.bacpac ファイルが存在する場合、[Azure SQL データベースから SQL Server 環境に Finance and Operations データベースをコピー](https://docs.microsoft.com/en-us/dynamics365/unified-operations/dev-itpro/database/copy-database-from-azure-sql-to-sql-server)に記載されている手順に従います。)</span><span class="sxs-lookup"><span data-stu-id="ea473-321">(If a .bacpac file exists, follow the steps in [Copy a Finance and Operations database from Azure SQL Database to a SQL Server environment](https://docs.microsoft.com/en-us/dynamics365/unified-operations/dev-itpro/database/copy-database-from-azure-sql-to-sql-server).)</span></span>
    3. <span data-ttu-id="ea473-322">Visual Studio で、モデル ストアを更新します。</span><span class="sxs-lookup"><span data-stu-id="ea473-322">In Visual Studio, refresh the model store.</span></span>
    4. <span data-ttu-id="ea473-323">Visual Studio では、データベースのソースおよびコピー先の環境が異なるバージョンの場合、完全なビルドを実行します。</span><span class="sxs-lookup"><span data-stu-id="ea473-323">In Visual Studio, do a full build if the source and destination environments of the database are on different versions.</span></span>
    5. <span data-ttu-id="ea473-324">Visual Studio で、データベースの完全同期を実行します。</span><span class="sxs-lookup"><span data-stu-id="ea473-324">In Visual Studio, run a full database synchronization.</span></span>
    6. <span data-ttu-id="ea473-325">バッチ サービスが実行中であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-325">Make sure that the Batch service is running.</span></span>
    7. <span data-ttu-id="ea473-326">環境再プロビジョニング ツールを実行します。</span><span class="sxs-lookup"><span data-stu-id="ea473-326">Run the Environment reprovisioning tool.</span></span> <span data-ttu-id="ea473-327">(LCS 資産ライブラリで最新バージョンを見つけて、**Maintain** 関数を使用して展開します。)</span><span class="sxs-lookup"><span data-stu-id="ea473-327">(Find the latest version in the LCS Asset library, and deploy it by using the **Maintain** function.)</span></span>
    8. <span data-ttu-id="ea473-328">ツールが成功したことを確認します。</span><span class="sxs-lookup"><span data-stu-id="ea473-328">Verify that the tool succeeded.</span></span> <span data-ttu-id="ea473-329">次のクエリでは、更新されたすべてのローカル開発コンピューターの URL が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-329">The following query should show the URLs of all local development machines that were updated.</span></span>

        ```
        select * from dbo.RETAILCHANNELPROFILEPROPERTY where ISSYSTEMRECORD = 1
        ```

    9. <span data-ttu-id="ea473-330">Retail では、古いデータを削除するために **小売用スケジューラの初期化**ジョブを実行します。</span><span class="sxs-lookup"><span data-stu-id="ea473-330">In Retail, run the **Initialize Retail Scheduler** job to delete old data.</span></span>

6. <span data-ttu-id="ea473-331">ユーザーアカウントを使用して Retail にサイン インできることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-331">Make sure that you now can sign in to Retail by using your user account.</span></span> <span data-ttu-id="ea473-332">生産データベースの元の管理者でない場合は、管理者プロビジョニング ツールを実行して所有権を取得することができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-332">If you weren't the original Admin user in the production database, you can run the Admin provisioning tool to take ownership.</span></span> <span data-ttu-id="ea473-333">(このツールは PackagesLocalDirectory/bin フォルダーにあります。)</span><span class="sxs-lookup"><span data-stu-id="ea473-333">(This tool is in the PackagesLocalDirectory/bin folder.)</span></span>
7. <span data-ttu-id="ea473-334">Commerce Data Exchange (CDX) データの同期が機能することを確認します。</span><span class="sxs-lookup"><span data-stu-id="ea473-334">Verify that Commerce Data Exchange (CDX) data synchronization works.</span></span> <span data-ttu-id="ea473-335">Retail では、**ダウンロード セッション**に移動します。</span><span class="sxs-lookup"><span data-stu-id="ea473-335">In Retail, go to **Download sessions**.</span></span> <span data-ttu-id="ea473-336">多くの適用済セッションが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-336">You should see many applied sessions.</span></span> <span data-ttu-id="ea473-337">表示されない場合は、ジョブ **9999** を選択して実行してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-337">If you don't see them, select job **9999**, and run it.</span></span>
8. <span data-ttu-id="ea473-338"><https://www.microsoft.com/en-us/download/details.aspx?id=48593> から TypeScript バージョン 2.2.2 をインストールします。</span><span class="sxs-lookup"><span data-stu-id="ea473-338">Install TypeScript version 2.2.2 from <https://www.microsoft.com/en-us/download/details.aspx?id=48593>.</span></span>
9. <span data-ttu-id="ea473-339">コマンド プロンプトから Retail SDK の完全なビルドを実行します。</span><span class="sxs-lookup"><span data-stu-id="ea473-339">Do a full build of the Retail SDK from a command prompt.</span></span>

    1. <span data-ttu-id="ea473-340">管理者として、Microsoft Visual Studio 2015 の MSbuild コマンド プロンプトを開きます。</span><span class="sxs-lookup"><span data-stu-id="ea473-340">Open an MSbuild command prompt for Microsoft Visual Studio 2015 as an administrator.</span></span>
    2. <span data-ttu-id="ea473-341">ローカル VM で、 Retail SDK の場所にディレクトリを変更します。</span><span class="sxs-lookup"><span data-stu-id="ea473-341">Change the directory to the location of your Retail SDK on the local VM.</span></span>
    3. <span data-ttu-id="ea473-342">**msbuild** と入力し、Enter キーを押します。</span><span class="sxs-lookup"><span data-stu-id="ea473-342">Type **msbuild**, and then press Enter.</span></span> <span data-ttu-id="ea473-343">ビルドは成功するはずです。</span><span class="sxs-lookup"><span data-stu-id="ea473-343">The build should succeed.</span></span>

10. <span data-ttu-id="ea473-344">開発/サンプル Retail Modern POS (MPOS) 証明書をローカル コンピューターの信頼されたルート証明書ストアに追加する: **...\\RetailSDK\\BuildTools\\ModernPOSAppxSigningCert-Contoso.pfx**。</span><span class="sxs-lookup"><span data-stu-id="ea473-344">Add the development/sample Retail Modern POS (MPOS) certificate to the local machine's trusted root certificate store: **...\\RetailSDK\\BuildTools\\ModernPOSAppxSigningCert-Contoso.pfx**.</span></span> <span data-ttu-id="ea473-345">パスワードを空の文字列に設定します。</span><span class="sxs-lookup"><span data-stu-id="ea473-345">Set the password to an empty string.</span></span>
11. <span data-ttu-id="ea473-346">**...\\RetailSDK \\References\\YourCompany|Contoso.ModernPOSSetupOffline.exe** でインストーラーを実行して、MPO または MPOSOffline をインストールする</span><span class="sxs-lookup"><span data-stu-id="ea473-346">Install MPOS or MPOSOffline by running the installer at **...\\RetailSDK \\References\\YourCompany|Contoso.ModernPOSSetupOffline.exe**.</span></span> <span data-ttu-id="ea473-347">ClientBroker ファイルを配置するのには、1 回でこの手順を完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-347">You must complete this step one time to deploy the ClientBroker files.</span></span>
12. <span data-ttu-id="ea473-348">Visual Studio で、**ModernPOS.sln** (管理者として) を開き、完全なリビルドを実行します。</span><span class="sxs-lookup"><span data-stu-id="ea473-348">In Visual Studio, open **ModernPOS.sln** (as an administrator), and do a full rebuild.</span></span>
13. <span data-ttu-id="ea473-349">F5 キーを押して、MPOS をデバッガーで起動します。</span><span class="sxs-lookup"><span data-stu-id="ea473-349">Press F5 to start MPOS in the debugger.</span></span>
14. <span data-ttu-id="ea473-350">Finance and Operations では、**チャネル プロファイル** ページを開き、既定の チャネル プロファイルのために Retail サーバー URL をコピーします。</span><span class="sxs-lookup"><span data-stu-id="ea473-350">In Finance and Operations, open the **Channel profiles** page, and copy the Retail Server URL for the default channel profile.</span></span>
15. <span data-ttu-id="ea473-351">ブラウザー ウィンドウを開き、アドレス バーに URL を貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="ea473-351">Open a browser window, and paste the URL into the address bar.</span></span> <span data-ttu-id="ea473-352">ローカル Retail サーバーを参照できるようになります。</span><span class="sxs-lookup"><span data-stu-id="ea473-352">You should be able to browse to your local Retail Server.</span></span>
16. <span data-ttu-id="ea473-353">Finance and Operations では、(アクティブ化) のいずれかの作業者への外部ユーザーの資格情報を加え、パスワードを保存し、最初のサインインの際にパスワード リセットを許可しないでください。</span><span class="sxs-lookup"><span data-stu-id="ea473-353">In Finance and Operations, add external user credentials to any worker (for activation), save the password, and don't allow a password reset on first sign-in.</span></span>
17. <span data-ttu-id="ea473-354">Finance and Operations では、**1060** (**AX/Distribution schedule**) ジョブを実行してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-354">In Finance and Operations, run job **1060** (**AX/Distribution schedule**).</span></span>
18. <span data-ttu-id="ea473-355">手順 16 で追加したものと同じ Azure Active Directory (Azure AD) ユーザーを使用して、MPOS を有効にします。</span><span class="sxs-lookup"><span data-stu-id="ea473-355">Activate MPOS by using the same Azure Active Directory (Azure AD) user that you added in step 16.</span></span> <span data-ttu-id="ea473-356">Retail サーバーの URL を貼り付け、ストアとレジスターを選択し、有効化を完了します。</span><span class="sxs-lookup"><span data-stu-id="ea473-356">Paste the Retail Server URL, select a store and a register, and finish the activation.</span></span>

<span data-ttu-id="ea473-357">ローカルのソースからデバッガで MPOS を実行できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="ea473-357">You should now be able to run MPOS in the debugger from your local sources.</span></span>

<span data-ttu-id="ea473-358">開発環境を準備するプロセスが完了したところです。</span><span class="sxs-lookup"><span data-stu-id="ea473-358">The process of preparing a development environment is now completed.</span></span> <span data-ttu-id="ea473-359">この時点で、任意の拡張コード (X++、Commerce Runtime [CRT]、Retail サーバー、チャネル SQL、小売時点 [POS] など) を VSTS に書き込み、デバッグ、テスト、送信することができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-359">At this point, any extension code (X++, Commerce runtime [CRT], Retail Server, channel SQL, point of sale [POS], and so on) can be written, debugged, tested, and submitted to VSTS.</span></span>

## <a name="optional-deploy-a-second-build-environment-for-a-different-release-branch"></a><span data-ttu-id="ea473-360">オプション: 別のリリース ブランチの 2 つ目のビルド環境を配置</span><span class="sxs-lookup"><span data-stu-id="ea473-360">Optional: Deploy a second build environment for a different release branch</span></span>

<span data-ttu-id="ea473-361">複数のリリースを同時に管理する必要がある場合は、異なるコード ブランチ (例えば、Main2 または Main3、または ProdRel1 または ProdRel2) から配置可能パッケージを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-361">If you must maintain multiple releases at the same time, you must create deployable packages from different code branches (for example, Main2 or Main3, and/or ProdRel1 or ProdRel2).</span></span>

<span data-ttu-id="ea473-362">2 つ目のビルド環境を設定する手順は、最初のビルド環境の手順と同じです。</span><span class="sxs-lookup"><span data-stu-id="ea473-362">The steps to set up a second build environment are the same as the steps for the first build environment.</span></span> <span data-ttu-id="ea473-363">この時点で、VSTS プロジェクトおよび LCS プロジェクトと VSTS プロジェクト間のリンクが既に存在しています。</span><span class="sxs-lookup"><span data-stu-id="ea473-363">At this point, a VSTS project, and the link between the LCS project and the VSTS project, already exist.</span></span>

<span data-ttu-id="ea473-364">ビルド環境を分離するには、リリース ブランチの新しい VSTS エージェント キューを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ea473-364">To separate the build environments, we recommend that you create a new VSTS agent queue for the release branch.</span></span> <span data-ttu-id="ea473-365">複数の分岐に対してエージェント キュー (およびそのビルド環境) を共有する方法はありますが、この方法は扱いにくいことがあります。</span><span class="sxs-lookup"><span data-stu-id="ea473-365">Although there are ways to share an agent queue (and its build environment) for multiple branches, this approach can be tricky.</span></span>

<span data-ttu-id="ea473-366">現時点では、ビルド環境は、配置中にターゲット環境としてバイナリ修正プログラムのバージョンと同じプラットフォームにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-366">Currently, the build environment must be on the same platform and binary hotfix version as the target environment during deployment.</span></span> <span data-ttu-id="ea473-367">それ以外の場合は、LCS でバージョンの互換性がないため配置可能パッケージを拒否する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-367">Otherwise, LCS might reject the deployable package because of version incompatibility.</span></span>

<span data-ttu-id="ea473-368">最初に新しい VSTS エージェント キューを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-368">First, you must create a new VSTS agent queue.</span></span>

![VSTS エージェント キュー](./media/13-VSTS-agent-queue.png)

<span data-ttu-id="ea473-370">LCS から配置する際、**PRODREL1** をエージェント プールの名前として使用してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-370">When you deploy from LCS, use **PRODREL1** as the name of the agent pool.</span></span>

![LCS のキュー名](./media/14-queue-name-lcs.png)

<span data-ttu-id="ea473-372">次に、**仮想マシン名をカスタマイズ** タブで、一意の名前を入力してから配置します。</span><span class="sxs-lookup"><span data-stu-id="ea473-372">Next, on the **Customize virtual machine names** tab, enter a unique name, and then deploy.</span></span>

<span data-ttu-id="ea473-373">新しいビルドの展開およびエージェント キューの作成にかかるプロセスは、数時間かかります。</span><span class="sxs-lookup"><span data-stu-id="ea473-373">The process of deploying a new build and creating a new agent queue can take a couple of hours.</span></span>

![新しいエージェント キュー](./media/15-new-agent-queue.png)

## <a name="prepare-the-build-definitions"></a><span data-ttu-id="ea473-375">ビルド定義の準備</span><span class="sxs-lookup"><span data-stu-id="ea473-375">Prepare the build definitions</span></span>

<span data-ttu-id="ea473-376">このトピックで前述の手順を完了すると、1 つのビルド定義および 2 つのエージェント キューがある必要があり、各エージェント キューは 1 つのエージェントを持つ必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-376">After you complete the steps earlier in this topic, you should have one build definition and two agent queues, and each agent queue should have one agent.</span></span> <span data-ttu-id="ea473-377">異なる分岐をビルドするには、ビルド定義を異なる方法でコンフィギュレーションしなければなりません。</span><span class="sxs-lookup"><span data-stu-id="ea473-377">To build different branches, you must configure the build definition differently.</span></span> <span data-ttu-id="ea473-378">したがって、ビルド定義を複製する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-378">Therefore, you must clone the build definition.</span></span>

<span data-ttu-id="ea473-379">ただし、ビルド定義を複製する前に、この手順を 2 回実行する必要がないように、Retail SDK をビルドに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-379">However, before you clone the build definition, you must add the Retail SDK into the build, so that you don't have to complete this step twice.</span></span> <span data-ttu-id="ea473-380">**Unified Operations プラットフォーム - Build Main** という名前の既存のビルド定義を編集するには、[Retail SDK を継続的ビルド システムと統合 (VSTS)](https://docs.microsoft.com/en-us/dynamics365/unified-operations/retail/dev-itpro/retail-sdk/integrate-retail-sdk-continuous-build) の手順に従って、Main 分岐のメタデータビルドに Retail SDK を統合します。</span><span class="sxs-lookup"><span data-stu-id="ea473-380">To edit the existing build definition, which is named **Unified Operations platform - Build Main**, follow the steps in [Integrate the Retail SDK with the continuous build system (VSTS)](https://docs.microsoft.com/en-us/dynamics365/unified-operations/retail/dev-itpro/retail-sdk/integrate-retail-sdk-continuous-build) to integrate the Retail SDK into the metadata build of the Main branch.</span></span>

<span data-ttu-id="ea473-381">複数のビルド ブランチおよび環境がある場合、ビルド定義を複製し、新しいビルド定義に名前を付けるだけで、どのブランチのためであるかを明確にします。</span><span class="sxs-lookup"><span data-stu-id="ea473-381">If you had multiple build branches and environments, just clone the build definition, and name the new build definition so that it's clear which branch it's for.</span></span> <span data-ttu-id="ea473-382">(複製機能は VSTS のポータルで使用することができます)。</span><span class="sxs-lookup"><span data-stu-id="ea473-382">(The clone feature is available in the VSTS portal).</span></span> <span data-ttu-id="ea473-383">作成した新しいエージェント キューを選択し、任意のビルド ステップまたはソース マッピングの次のパスを変更します。</span><span class="sxs-lookup"><span data-stu-id="ea473-383">Select the new agent queue that you created, and change the following paths in any build steps or source mappings.</span></span> <span data-ttu-id="ea473-384">(パスで、**メイン**を **ProdRel1** に変更します。)</span><span class="sxs-lookup"><span data-stu-id="ea473-384">(In the paths, change **Main** to **ProdRel1**.)</span></span>

- <span data-ttu-id="ea473-385">ソース マッピング</span><span class="sxs-lookup"><span data-stu-id="ea473-385">Source mappings</span></span>
- <span data-ttu-id="ea473-386">Retail SDK ビルド ステップ</span><span class="sxs-lookup"><span data-stu-id="ea473-386">Retail SDK build step</span></span>
- <span data-ttu-id="ea473-387">Retail SDK のコピー バイナリ ステップ</span><span class="sxs-lookup"><span data-stu-id="ea473-387">Retail SDK copy binaries step</span></span>
- <span data-ttu-id="ea473-388">ソリューション ステップ (X++ ビルド) の構築</span><span class="sxs-lookup"><span data-stu-id="ea473-388">Build the solution step (X++ build)</span></span>
- <span data-ttu-id="ea473-389">Retail SDK のコピー パッケージ ステップ</span><span class="sxs-lookup"><span data-stu-id="ea473-389">Retail SDK copy packages step</span></span>

## <a name="tips"></a><span data-ttu-id="ea473-390">ヒント</span><span class="sxs-lookup"><span data-stu-id="ea473-390">Tips</span></span>

- <span data-ttu-id="ea473-391">ビルド定義の**変数**セクションでこれらの変更を行うことで、公式ビルドを速めることができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-391">You can speed up an official build by making these changes in the **Variables** section of the build definition:</span></span>

    - <span data-ttu-id="ea473-392">**DeployReports** を **0** に設定します。</span><span class="sxs-lookup"><span data-stu-id="ea473-392">Set **DeployReports** to **0**.</span></span>
    - <span data-ttu-id="ea473-393">**SkipSourcePackageGeneration** を **1** に設定します。</span><span class="sxs-lookup"><span data-stu-id="ea473-393">Set **SkipSourcePackageGeneration** to **1**.</span></span>

- <span data-ttu-id="ea473-394">各分岐の小売カスタマイズのバージョンを変更します。</span><span class="sxs-lookup"><span data-stu-id="ea473-394">Change the version of the Retail customization in each branch.</span></span> <span data-ttu-id="ea473-395">バージョンは、Dev、Main、および ProdRel1 の分岐で異なっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-395">The version should be different in the Dev, Main, and ProdRel1 branches.</span></span> <span data-ttu-id="ea473-396">Customization.settings ファイルを変更するか、RetailSdk\\BuildTools フォルダーに新しい global.props ファイルを追加してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-396">Either change the Customization.settings file, or add a new global.props file under the RetailSdk\\BuildTools folder.</span></span> <span data-ttu-id="ea473-397">ファイル名には、任意の種類の番号を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-397">You can use any kind of numbering for the file name.</span></span> <span data-ttu-id="ea473-398">たとえば、Dev に 1.0.0.x、Main に 1.0.1.x、ProdRel1 に 1.0.2.x と番号を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-398">For example, you can number Dev as 1.0.0.x, Main as 1.0.1.x, and ProdRel1 as 1.0.2.x.</span></span>
- <span data-ttu-id="ea473-399">効率性のため、使用されていないときは、ビルドや開発環境をシャットダウンします。</span><span class="sxs-lookup"><span data-stu-id="ea473-399">For efficiency, shut down build or development environments when they aren't being used.</span></span>
- <span data-ttu-id="ea473-400">クラウド ホストの階層 1 開発環境（管理者権限を持つ）を使用している場合は、IIS Express から IIS に切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-400">If you're using cloud-hosted Tier 1 development environments (where you have administrative privileges), you can switch from IIS Express to IIS.</span></span> <span data-ttu-id="ea473-401">IIS を使用してすべての Web アプリケーションを実行すると、より堅牢になりパフォーマンスが向上し、切り替えが回避されます。</span><span class="sxs-lookup"><span data-stu-id="ea473-401">Using IIS for running all web application is more robust, more performant, and avoids the switching.</span></span> <span data-ttu-id="ea473-402">詳細については、[MSDyn365FO. IIS Express から開発 VM の IIS に切り替える方法](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea473-402">For details, see [MSDyn365FO. How to switch from IIS Express to IIS on development VM](https://ievgensaxblog.wordpress.com/2018/04/02/msdyn365fo-how-to-switch-from-iis-express-to-iis-on-development-vm/).</span></span>
- <span data-ttu-id="ea473-403">プロトタイプの目的で、開発者は VSTS ソースコントロールを使用せずに開発 VM で Retail SDK を変更したいと思うかもしれません。</span><span class="sxs-lookup"><span data-stu-id="ea473-403">For prototyping purposes, a developer might want to change the Retail SDK on a development VM without using VSTS source control.</span></span> <span data-ttu-id="ea473-404">手を加えずに常に元の Retail SDK を保持し、一時的に使用できるコピーを作成します。</span><span class="sxs-lookup"><span data-stu-id="ea473-404">Always keep the original Retail SDK untouched, and make a copy that you can work in temporarily.</span></span> <span data-ttu-id="ea473-405">このようにして、変更されていない Retail SDK を必要に応じて、後でミラー分岐に入れることができます。</span><span class="sxs-lookup"><span data-stu-id="ea473-405">In that way, you can take the unchanged Retail SDK into your mirror branch later, if it's required.</span></span>
- <span data-ttu-id="ea473-406">現時点では、ビルド環境は、ターゲット環境としてバイナリ修正プログラムのバージョンと同じプラットフォームにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea473-406">Currently, a build environment must be on the same platform and binary hotfix version as the target environment.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ea473-407">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="ea473-407">Additional resources</span></span>

[<span data-ttu-id="ea473-408">コードおよび小売プロジェクトの環境の更新</span><span class="sxs-lookup"><span data-stu-id="ea473-408">Update code and environments for Retail projects</span></span>](./updating-environments.md)

[<span data-ttu-id="ea473-409">テストおよびパフォーマンス</span><span class="sxs-lookup"><span data-stu-id="ea473-409">Testing and performance</span></span>](./retail-implementation-testing-performance.md)

