---
title: カスタマイズされた Retail Modern POS のデバイスの有効化
description: このトピックでは、カスタマイズした Retail Modern POS アプリケーションを使用する場合に、デバイスの有効化が正常に動作するように、Microsoft Dynamics 365 バックオフィスを設定する方法について説明します。
author: jashanno
manager: AnnBe
ms.date: 08/24/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: IT Pro
ms.reviewer: rhaertle
ms.search.scope: Operations, Retail
ms.search.region: Global
ms.author: jashanno
ms.search.validFrom: 2017-09-31
ms.dyn365.ops.version: Application update 3
ms.openlocfilehash: a8e834e8e251849f111c6ac56885158e8993ddd0
ms.sourcegitcommit: f87de0f949b5d60993b19e0f61297f02d42b5bef
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2019
ms.locfileid: "2025538"
---
# <a name="device-activation-of-a-customized-retail-modern-pos"></a><span data-ttu-id="2b0d8-103">カスタマイズされた Retail Modern POS のデバイスの有効化</span><span class="sxs-lookup"><span data-stu-id="2b0d8-103">Device activation of a customized Retail Modern POS</span></span>

[!INCLUDE [banner](../includes/banner.md)]

<span data-ttu-id="2b0d8-104">このトピックでは、カスタマイズした Retail Modern POS アプリケーションを使用する場合に、デバイスの有効化が正常に動作するように、Microsoft Dynamics 365 バックオフィスを設定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-104">This topic explains how to configure Microsoft Dynamics 365 headquarters so that device activation works correctly when a customized Retail Modern POS application is used.</span></span> <span data-ttu-id="2b0d8-105">カスタマイズされた返信アドレスを取得し、バックオフィスでその値を入力するために必要な手順を説明します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-105">It describes the steps that are required in order to obtain the customized reply address and enter that value in headquarters.</span></span>

<span data-ttu-id="2b0d8-106">Retail Modern POS は、Microsoft Dynamics 365 Retail のクライアント側コンポーネントです。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-106">Retail Modern POS is a client-side component for Microsoft Dynamics 365 Retail.</span></span> <span data-ttu-id="2b0d8-107">Retail Modern POS を使用するには、デバイスの有効化を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-107">To use Retail Modern POS, you must perform device activation.</span></span> <span data-ttu-id="2b0d8-108">デバイスの有効化は、ユーザーを認証する Azure Active Directory (Azure AD) を使用します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-108">Device activation uses Microsoft Azure Active Directory (Azure AD) to authenticate users.</span></span> <span data-ttu-id="2b0d8-109">この領域の拡張機能は、Web アカウント マネージャー サービスを活用するためにデバイスの有効化のフローを変更しました。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-109">Enhanced functionality in this area has modified the device activation flow to take better advantage of the Web Account Manager service.</span></span> <span data-ttu-id="2b0d8-110">この拡張の一部として、認証承認プロセスのセキュリティが強化されました。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-110">As part of this enhancement, there is now enhanced security for the authentication approval process.</span></span> <span data-ttu-id="2b0d8-111">このセキュリティ強化では、コールバック URI に特定の一意の値が必要になるため、Retail Modern POS のカスタマイズ時に、Dynamics 365 バックオフィスで追加設定が必要です。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-111">This enhanced security requires additional configuration in Dynamics 365 headquarters when Retail Modern POS is customized, because a specific, unique value is now required for the callback URI.</span></span> <span data-ttu-id="2b0d8-112">(コールバック URI は、返信 URI とも呼ばれます。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-112">(The callback URI is also known as the reply URI.)</span></span>

<span data-ttu-id="2b0d8-113">既定では、Retail Modern POS はこのコールバック URI に既に登録されています。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-113">By default, Retail Modern POS is already registered for this callback URI.</span></span> <span data-ttu-id="2b0d8-114">ただし、Retail Modern POS をカスタマイズするとき、コールバック URI が変更されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-114">However, when Retail Modern POS is customized, the callback URI is changed.</span></span> <span data-ttu-id="2b0d8-115">したがって、再度動作するように正しく構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-115">Therefore, it must be correctly configured so that it works again.</span></span> <span data-ttu-id="2b0d8-116">このトピックでは、この構成を完了するために従う必要がある手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-116">This topic describes the steps that you must follow to complete this configuration.</span></span> <span data-ttu-id="2b0d8-117">この構成が完了しない場合、カスタマイズされた Retail Modern POS アプリケーションでデバイスの有効化を実行しようとすると、エラー メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-117">If this configuration isn't completed, you receive an error message when you try to perform device activation in the customized Retail Modern POS application.</span></span> <span data-ttu-id="2b0d8-118">このエラー メッセージは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-118">This error message resembles the following example:</span></span>

> <span data-ttu-id="2b0d8-119">AADSTS50011: The reply address 'ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]' does not match the reply addresses configured for the application</span><span class="sxs-lookup"><span data-stu-id="2b0d8-119">AADSTS50011: The reply address 'ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]' does not match the reply addresses configured for the application</span></span>

> [!NOTE]
> - <span data-ttu-id="2b0d8-120">Dynamics 365 バックオフィスを構成する前に、カスタマイズされた Retail Modern POS アプリケーションを 1 回使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-120">We recommend that you try to use the customized Retail Modern POS application one time before you configure Dynamics 365 headquarters.</span></span> <span data-ttu-id="2b0d8-121">これにより、エラー メッセージがどのようなものかを確認し、カスタマイズされた返信アドレスをより簡単に取得できます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-121">In this way, you can see what the error message looks like and more easily obtain the customized reply address.</span></span>
> - <span data-ttu-id="2b0d8-122">エラーは、Retail Modern POS アプリケーションに対応するアプリケーション ID に使用される返信アドレスを指定します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-122">The error specifies the reply address that is used for the application ID that corresponds to the Retail Modern POS application.</span></span>

## <a name="setup"></a><span data-ttu-id="2b0d8-123">セットアップ</span><span class="sxs-lookup"><span data-stu-id="2b0d8-123">Setup</span></span>
<span data-ttu-id="2b0d8-124">次の手順は、カスタマイズされた Retail Modern POS アプリケーションを使用する場合に、デバイスの有効化が正常に動作できるようにするために必要です。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-124">The following steps are required so that device activation works correctly when the customized Retail Modern POS application is used.</span></span> <span data-ttu-id="2b0d8-125">2 つの Azure AD アプリケーションを作成します。1 つは Retail Modern POS 用、1 つは Retail Server 用です。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-125">You will create two Azure AD applications: one for Retail Modern POS and one for Retail Server.</span></span> <span data-ttu-id="2b0d8-126">Retail Server Azure AD アプリケーションは、Retail Modern POS が Retail Server を通じてリソースを使用するために必要です。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-126">The Retail Server Azure AD application is required because Retail Modern POS uses resources through Retail Server.</span></span> <span data-ttu-id="2b0d8-127">したがって、Retail Modern POS が使用される場合は両方の Azure AD アプリケーションが使用されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-127">Therefore, both Azure AD applications are used when Retail Modern POS is used.</span></span> <span data-ttu-id="2b0d8-128">このシナリオでは、Retail Server は、Retail Modern POS が要求する保護されているリソースのエンドポイントとして機能します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-128">In this scenario, Retail Server serves as the endpoint for protected resources that Retail Modern POS requests.</span></span>

### <a name="create-the-retail-server-azure-ad-application"></a><span data-ttu-id="2b0d8-129">Retail サーバーの Azure AD アプリケーションを作成する</span><span class="sxs-lookup"><span data-stu-id="2b0d8-129">Create the Retail Server Azure AD application</span></span>
1. <span data-ttu-id="2b0d8-130">Web ブラウザーで、<https://portal.azure.com/>に移動します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-130">In a web browser, go to <https://portal.azure.com/>.</span></span>
2. <span data-ttu-id="2b0d8-131">Azure AD アプリケーションを作成するための十分なアクセス許可を持つ Azure AD 資格情報を使用してログインします。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-131">Sign in by using Azure AD credentials that have enough permission to create Azure AD applications.</span></span>
3. <span data-ttu-id="2b0d8-132">**Azure Active Directory** \> **App registrations** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-132">Select **Azure Active Directory** \> **App registrations**.</span></span>
4. <span data-ttu-id="2b0d8-133">**新しいアプリケーション登録**を選択して、次の値を入力することで、Retail サーバー Azure AD アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-133">Create the Retail Server Azure AD application by selecting **New application registration** and entering the following values:</span></span>

    - <span data-ttu-id="2b0d8-134">**名前:** **カスタマイズされた Retail Server** を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-134">**Name:** Enter **Customized Retail Server**.</span></span> <span data-ttu-id="2b0d8-135">(他の固有の値を入力できますが、記録しておいてください。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-135">(You can enter any other unique value, but be sure to make a note of it.)</span></span>
    - <span data-ttu-id="2b0d8-136">**アプリケーション タイプ:** **Web アプリ/API** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-136">**Application type:** Select **Web app / API**.</span></span>
    - <span data-ttu-id="2b0d8-137">**サインオン URL:** 実際の物理的な場所をポイントしない固有 URL を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-137">**Sign-on URL:** Enter any unique URL that doesn't point to a real, physical location.</span></span> <span data-ttu-id="2b0d8-138">たとえば、「`https://MyNotRealURL`」を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-138">For example, enter `https://MyNotRealURL`.</span></span>

5. <span data-ttu-id="2b0d8-139">Azure が **サインオン URL** フィールドの値を検証するように、Tab キーを押します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-139">Press the Tab key so that Azure can validate the value in the **Sign-on URL** field.</span></span> <span data-ttu-id="2b0d8-140">次に、**作成** を選択し、処理が正常に完了するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-140">Then select **Create**, and wait until the operation is successfully completed.</span></span> <span data-ttu-id="2b0d8-141">(エラーが発生する場合は、解決してもう一度やり直します。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-141">(If an error occurs, address it, and then try again.)</span></span>

    <span data-ttu-id="2b0d8-142">タイルに、新しい Retail Server Azure AD アプリケーションの詳細が表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-142">A tile appears that shows the details of the new Retail Server Azure AD application.</span></span>

6. <span data-ttu-id="2b0d8-143">タイルの上部の **設定** を選択し、アプリケーションの **設定** タイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-143">Select **Settings** at the top of the tile to open the **Settings** tile for the application.</span></span> <span data-ttu-id="2b0d8-144">次に、**プロパティ** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-144">Then select **Properties**.</span></span>
7. <span data-ttu-id="2b0d8-145">**プロパティ** タイルで、**アプリケーション ID URI** フィールドの値をコピーします。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-145">On the **Properties** tile, copy the value in the **App ID URI** field.</span></span> <span data-ttu-id="2b0d8-146">この値は、次のセクションで Retail Modern POS の DLLHost.exe.config ファイルに貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-146">You will paste this value into the DLLHost.exe.config file for Retail Modern POS in the next section.</span></span>

> [!NOTE]
> <span data-ttu-id="2b0d8-147">このトピックの後半で再び使用するため、Web ブラウザー ウィンドウを閉じないでください。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-147">Don't close the web browser window, because you will use it again later in this topic.</span></span>

### <a name="update-the-retail-modern-pos-configuration"></a><span data-ttu-id="2b0d8-148">Retail Modern POS 設定の更新</span><span class="sxs-lookup"><span data-stu-id="2b0d8-148">Update the Retail Modern POS configuration</span></span>
1. <span data-ttu-id="2b0d8-149">ファイル エクスプローラーで、**C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\Retail Modern POS\\ClientBroker** に移動します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-149">In File Explorer, go to **C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\Retail Modern POS\\ClientBroker**.</span></span> <span data-ttu-id="2b0d8-150">(このパスは、コンピューターの Microsoft Windows オペレーティング システムが、x64 アーキテクチャ ベースであることを前提としています)。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-150">(This path assumes that the Microsoft Windows operating system on the computer is based on the x64 architecture.)</span></span>
2. <span data-ttu-id="2b0d8-151">エクスプローラーで、**ファイル** \> **Windows PowerShell を開く** \> **管理者として Windows PowerShell を開く** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-151">In File Explorer, select **File** \> **Open Windows PowerShell** \> **Open Windows PowerShell as administrator**.</span></span>
3. <span data-ttu-id="2b0d8-152">表示された Microsoft Windows PowerShell ウィンドウで、**notepad DLLHost.exe.config** と入力して Enter キーを押します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-152">In the Microsoft Windows PowerShell window that appears, enter **notepad DLLHost.exe.config**, and then press the Enter key.</span></span> <span data-ttu-id="2b0d8-153">(Windows PowerShell ウィンドウは、現在のファイル ディレクトリを既にポイントしています。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-153">(The Windows PowerShell window will already be pointed to the current file directory.)</span></span>
4. <span data-ttu-id="2b0d8-154">表示されたメモ帳ウィンドウで、**AADRetailServerResourceId** キーに対応する値を見つけます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-154">In the Notepad window that appears, find the value that corresponds to the **AADRetailServerResourceId** key.</span></span> <span data-ttu-id="2b0d8-155">(この値は、既定では `https://commerce.dynamics.com` です)。次に、前のセクションの手順 7 でコピーしたアプリケーション ID URI 値を貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-155">(By default, this value is `https://commerce.dynamics.com`.) Then paste the App ID URI value that you copied in step 7 in the previous section.</span></span>
5. <span data-ttu-id="2b0d8-156">**ファイル** \> **保存** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-156">Select **File** \> **Save**.</span></span>

> [!NOTE]
> <span data-ttu-id="2b0d8-157">次にセクションで再び使用するため、メモ帳ウィンドウを閉じないでください。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-157">Don't close the Notepad window, because you will use it again in the next section.</span></span>

### <a name="create-the-customized-retail-modern-pos-azure-ad-application"></a><span data-ttu-id="2b0d8-158">カスタマイズされた Retail Modern POS Azure AD アプリケーションを作成する</span><span class="sxs-lookup"><span data-stu-id="2b0d8-158">Create the customized Retail Modern POS Azure AD application</span></span>
1. <span data-ttu-id="2b0d8-159"><https://portal.azure.com/> が開いている Web ブラウザー ウィンドウに戻り、「Retail サーバーの Azure AD アプリケーションを作成する」セクションの手順 3 と 4 を繰り返して、Retail Modern POS Azure AD アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-159">Return to the web browser window where <https://portal.azure.com/> is open, and create the Retail Modern POS Azure AD application by repeating steps 3 through 4 in the "Create the Retail Server Azure AD application" section.</span></span> <span data-ttu-id="2b0d8-160">ただし、今回は次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-160">However, enter the following values this time:</span></span>

    - <span data-ttu-id="2b0d8-161">**名前:** **カスタマイズされた Retail Modern POS** を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-161">**Name:** Enter **Customized Retail Modern POS**.</span></span> <span data-ttu-id="2b0d8-162">(他の固有の値を入力できますが、記録しておいてください。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-162">(You can enter any other unique value, but be sure to make a note of it.)</span></span>
    - <span data-ttu-id="2b0d8-163">**アプリケーション タイプ:** **ネイティブ**を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-163">**Application type:** Select **Native**.</span></span>
    - <span data-ttu-id="2b0d8-164">**リダイレクト URI:** このトピックの先頭でお勧めしたように、Dynamics 365 バックオフィスを構成することなく、カスタマイズされた Retail Modern POS アプリケーションを使用するしようとすると、エラー メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-164">**Redirect URI:** If you tried to use the customized Retail Modern POS application without configuring Dynamics 365 headquarters, as we recommended at the beginning of this topic, you received an error message.</span></span> <span data-ttu-id="2b0d8-165">そのエラー メッセージに対応する返信アドレス (リダイレクト URI) を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-165">Enter the reply address (redirect URI) that corresponds to that error message.</span></span> <span data-ttu-id="2b0d8-166">値の先頭は **ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]** です。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-166">The value will start with **ms-appx-web://Microsoft.AAD.BrokerPlugin/[...]**.</span></span>

        > [!NOTE]
        > - <span data-ttu-id="2b0d8-167">Windows のイベント ビューアーの **Microsoft-Dynamics-Commerce-ModernPos/Operational** で返信アドレス (リダイレクト URI) を表示することもできます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-167">You can also see the reply address (redirect URI) in Event Viewer in Windows, under **Microsoft-Dynamics-Commerce-ModernPos/Operational**.</span></span> <span data-ttu-id="2b0d8-168">イベント ID は 40619 です。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-168">The event ID is 40619.</span></span> <span data-ttu-id="2b0d8-169">エラー メッセージの先頭は "This UWP application was assigned the following callback URI to be used while interacting with Azure AD: ms-appx-web://Microsoft.AAD.BrokerPlugIn/S-1-15-2-[...]" です。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-169">The error message will start with the following text: "This UWP application was assigned the following callback URI to be used while interacting with Azure AD: ms-appx-web://Microsoft.AAD.BrokerPlugIn/S-1-15-2-[...]"</span></span>
        > - <span data-ttu-id="2b0d8-170">Azure AD アプリケーションが作成されたら、必要に応じて追加リダイレクト URI を指定できます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-170">After the Azure AD application is created, you can specify additional redirect URIs as you require.</span></span> <span data-ttu-id="2b0d8-171">異なるコールバック URI のある複数のパッケージが何らかの理由で生成された場合、この 1 つの Azure AD アプリケーションを保持し、その中にすべてのリダイレクト URI を保持してください。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-171">If multiple packages that have different callback URIs have been generated for any reason, keep this single Azure AD application, and maintain all redirect URIs in it.</span></span>

2. <span data-ttu-id="2b0d8-172">Azure が **リダイレクト URI** フィールドの値を検証するように、Tab キーを押します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-172">Press the Tab key so that Azure can validate the value in the **Redirect URI** field.</span></span> <span data-ttu-id="2b0d8-173">次に、**作成** を選択し、処理が正常に完了するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-173">Then select **Create**, and wait until the operation is successfully completed.</span></span> <span data-ttu-id="2b0d8-174">(エラーが発生する場合は、解決してもう一度やり直します。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-174">(If an error occurs, address it, and then try again.)</span></span>

    <span data-ttu-id="2b0d8-175">タイルに、新しいカスタマイズされた Retail Modern POS Azure AD アプリケーションの詳細が表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-175">A tile appears that shows the details of the new customized Retail Modern POS Azure AD application.</span></span>

3. <span data-ttu-id="2b0d8-176">**アプリケーション ID** フィールドを見つけ、値をコピーします。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-176">Find the **Application ID** field, and copy the value.</span></span> <span data-ttu-id="2b0d8-177">(この値は、**AADClientId** キーに対応する値として DLLHost.exe.config ファイルに貼り付けます。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-177">(You will paste this value into the DLLHost.exe.config file as the value that corresponds to the **AADClientId** key.)</span></span>
4. <span data-ttu-id="2b0d8-178">タイルの上部の **設定** を選択し、アプリケーションの **設定** タイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-178">Select **Settings** at the top of the tile to open the **Settings** tile for the application.</span></span> <span data-ttu-id="2b0d8-179">次に、**必要なアクセス許可** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-179">Then select **Required permissions**.</span></span>
5. <span data-ttu-id="2b0d8-180">**必要なアクセス許可** タイルで **+ 追加** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-180">On the **Required permissions** tile, select **+ Add**.</span></span>
6. <span data-ttu-id="2b0d8-181">**API アクセスの追加** タイルで、**1 API を選択する** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-181">On the **Add API access** tile, select **1 Select an API**.</span></span>
7. <span data-ttu-id="2b0d8-182">**API を選択** タイルの検索フィールで、「Retail サーバーの Azure AD アプリケーションを作成する」のセクションで作成した Retail Server Azure AD アプリケーションの名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-182">On the **Select an API** tile, in the search field, enter the name of the Retail Server Azure AD application that you created in the "Create the Retail Server Azure AD application" section.</span></span> <span data-ttu-id="2b0d8-183">(このトピックでは、アプリケーションの名前は**カスタマイズされた Retail サーバー**です)。そのアプリケーションに対応する品目を選択し、**選択** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-183">(In this topic, the application is named **Customized Retail Server**.) Select the item that corresponds to that application, and then select **Select**.</span></span>

    <span data-ttu-id="2b0d8-184">**API アクセスを追加する** タイルで、**2 アクセス許可を選択** が自動的に選択され、**アクセスを有効にする** という名前の新しいタイルが表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-184">On the **Add API access** tile, **2 Select permission** is automatically selected, and a new tile appears that is named **Enable Access**.</span></span>

8. <span data-ttu-id="2b0d8-185">**アクセスを有効にする** タイルで、**カスタマイズされた Retail サーバーにアクセスする** 行の上にマウス ポインターを置き、左側に表示されるチェック ボックスを選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-185">On the **Enable Access** tile, hold the mouse pointer over the line for **Access Customized Retail Server**, and then select the check box that appears on the left side.</span></span> <span data-ttu-id="2b0d8-186">(Retail Server Azure AD アプリケーションに別の名前を入力し、**カスタマイズされた Retail サーバー** の代わりに、その名前が行で使用される場合)。タイルの下部にある **選択** ボタンが使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-186">(If you entered a different name for the Retail Server Azure AD application, that name is used on the line instead of **Customized Retail Server**.) The **Select** button at the bottom of the tile becomes available.</span></span>
9. <span data-ttu-id="2b0d8-187">**選択** を選択して **API アクセスを追加する** タイルに戻ります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-187">Select **Select** to return to the **Add API access** tile.</span></span>
10. <span data-ttu-id="2b0d8-188">**完了** を選択し、**必要なアクセス許可** タイルに戻ります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-188">Select **Done** to return to the **Required permissions** tile.</span></span>
11. <span data-ttu-id="2b0d8-189">**アクセス許可の付与** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-189">Select **Grant Permissions**.</span></span> <span data-ttu-id="2b0d8-190">アクセス許可を付与することを確認するメッセージが表示されたら、**はい** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-190">When a message prompts you to verify that you want to grant the permissions, select **Yes**.</span></span>
12. <span data-ttu-id="2b0d8-191">DLLHost.exe.config ファイルの内容が表示されているメモ帳ウィンドウに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-191">Switch to the Notepad window that shows the contents of the DLLHost.exe.config file.</span></span> <span data-ttu-id="2b0d8-192">(前のセクションの手順を完了した後にこのウィンドウから離れます。)</span><span class="sxs-lookup"><span data-stu-id="2b0d8-192">(You left this window after you completed the steps in the previous section.)</span></span>
13. <span data-ttu-id="2b0d8-193">**AADClientId** キーに対応する値を見つけます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-193">Find the value that corresponds to the **AADClientId** key.</span></span> <span data-ttu-id="2b0d8-194">(既定では、この値はバックオフィス環境に対応するグローバル一意識別子 [GUID] です)。手順 3 でコピーした値を貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-194">(By default, this value is a globally unique identifier [GUID] that corresponds to the headquarters environment.) Paste the value that you copied in step 3.</span></span>
14. <span data-ttu-id="2b0d8-195">**ファイル** \> **保存** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-195">Select **File** \> **Save**.</span></span>

### <a name="configure-dynamics-365-headquarters"></a><span data-ttu-id="2b0d8-196">Dynamics 365 バックオフィスの構成</span><span class="sxs-lookup"><span data-stu-id="2b0d8-196">Configure Dynamics 365 headquarters</span></span>
<span data-ttu-id="2b0d8-197">前の手順は、Retail Modern POS アプリケーションを認証できるようにするために必要でした。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-197">The previous steps were required so that the Retail Modern POS application can be authenticated.</span></span> <span data-ttu-id="2b0d8-198">ここでは、要求を承認できるように、次の手順を実行し、新しい Azure AD アプリケーションを Dynamics 365 バックオフィスの安全なプログラムの一覧に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-198">You must now follow these steps to add the new Azure AD applications to the list of safe programs in Dynamics 365 headquarters, so that the requests are authorized.</span></span> <span data-ttu-id="2b0d8-199">(安全なプログラムの一覧はホワイトリストと呼ばれることもあります)。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-199">(A list of safe programs is sometimes also referred to as a whitelist.)</span></span>

1. <span data-ttu-id="2b0d8-200">Web ブラウザーで、Dynamics 365 バック オフィス URL に移動し、Azure AD 資格情報を使用してログインします。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-200">In a web browser, go to the Dynamics 365 headquarters URL, and sign in by using Azure AD credentials.</span></span>
2. <span data-ttu-id="2b0d8-201">**小売** &gt; **本社の設定** &gt; **パラメーター** &gt; **小売共有パラメーター**の順にを移動します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-201">Go to **Retail** &gt; **Headquarters setup** &gt; **Parameters** &gt; **Retail shared parameters**.</span></span>
3. <span data-ttu-id="2b0d8-202">**ID プロバイダー** タブの **ID プロバイダー** セクションで、`HTTPS://sts.windows.net/` から始まるプロバイダーを選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-202">On the **Identity Providers** tab, in the **Identity providers** section, select the provider that begins with `HTTPS://sts.windows.net/`.</span></span> <span data-ttu-id="2b0d8-203">選択したプロバイダーに基づいて、**依存する関係者** セクションの値が更新されます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-203">The values in the **Relying parties** section are updated, based on the provider that you selected.</span></span>
5. <span data-ttu-id="2b0d8-204">**依存する関係者** セクションで、**+ 追加**を選択し、次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-204">In the **Relying parties** section, select **+ Add**, and enter the following values:</span></span>

    - <span data-ttu-id="2b0d8-205">**ClientId:** 前のセクションの手順 3 でコピーし、手順 13 で DLLHost.exe.config に貼り付けた値を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-205">**ClientId:** Enter the value that you copied in step 3 in the previous section and then pasted into the DLLHost.exe.config file in step 13.</span></span>
    - <span data-ttu-id="2b0d8-206">**タイプ:** **パブリック** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-206">**Type:** Select **Public**.</span></span>
    - <span data-ttu-id="2b0d8-207">**UserType:** **作業者** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-207">**UserType:** Select **Worker**.</span></span>
    - <span data-ttu-id="2b0d8-208">**名前:** このエントリが参照する、ユーザーがわかりやすい説明を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-208">**Name:** Enter a description to help users understand what this entry references.</span></span>

6. <span data-ttu-id="2b0d8-209">アクション ウィンドウで、**保存**を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-209">On the Action Pane, select **Save**.</span></span> <span data-ttu-id="2b0d8-210">作成した依存する関係者は選択したままにしてください。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-210">The relying party that you just created should remain selected.</span></span>
7. <span data-ttu-id="2b0d8-211">**サーバー リソース ID** セクションで、**+ 追加**を選択し、次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-211">In the **Server resource IDs** section, select **+ Add**, and enter the following values:</span></span>

    - <span data-ttu-id="2b0d8-212">**サーバー リソース ID:** 「Retail Modern POS 設定の更新」の手順 4 でコピーした URL を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-212">**Server Resource Id:** Enter the URL that you copied in step 4 in the "Update the Retail Modern POS configuration" section.</span></span> <span data-ttu-id="2b0d8-213">(最初は、「Retail サーバーの Azure AD アプリケーションを作成する」の手順 4 でこの値を作成しました)。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-213">(You originally created this value in step 4 in the "Create the Retail Server Azure AD application" section.)</span></span>
    - <span data-ttu-id="2b0d8-214">**名前:** このエントリが参照する、ユーザーがわかりやすい説明を入力します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-214">**Name:** Enter a description to help users understand what this entry references.</span></span>

8. <span data-ttu-id="2b0d8-215">アクション ウィンドウで、**保存**を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-215">On the Action Pane, select **Save**.</span></span>
9. <span data-ttu-id="2b0d8-216">**小売** &gt; **小売 IT** \> **配送スケジュール** の順に移動します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-216">Go to **Retail** &gt; **Retail IT** \> **Distribution schedule**.</span></span>
10. <span data-ttu-id="2b0d8-217">ジョブ **1110** (**グローバル構成**) を選択し、アクション ペインで **今すぐ実行** を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-217">Select job **1110** (**Global configuration**), and then, on the Action Pane, select **Run now**.</span></span> <span data-ttu-id="2b0d8-218">このジョブは、新しいデータを同期させます。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-218">This job synchronizes the new data.</span></span> <span data-ttu-id="2b0d8-219">ただし、Retail サーバーにはキャッシュがあり、数分は更新されません。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-219">However, there is a cache in Retail Server that won't be updated for several minutes.</span></span> <span data-ttu-id="2b0d8-220">したがって、迅速な更新が必要な場合、Retail サーバー アプリケーション プールを再利用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-220">Therefore, if you require an immediate update, the Retail Server application pool must be recycled.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2b0d8-221">最適な結果を得るため、Retail Modern POS が終了していることと、DLLHost.exe のインスタンスがタスク マネージャーに存在しないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-221">For best results, verify that Retail Modern POS is closed, and that no instances of DLLHost.exe exist in Task Manager.</span></span>

### <a name="perform-retail-modern-pos-device-activation"></a><span data-ttu-id="2b0d8-222">Retail Modern POS のデバイスの有効化の実行</span><span class="sxs-lookup"><span data-stu-id="2b0d8-222">Perform Retail Modern POS device activation</span></span>
<span data-ttu-id="2b0d8-223">Retail Modern POS デバイスを有効化してください。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-223">Try to activate the Retail Modern POS device.</span></span> <span data-ttu-id="2b0d8-224">依然として問題が発生する場合は、Windowsでイベント ビューアーを開き、Retail Modern POS に対応するログを表示します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-224">If you still experience issues, open Event Viewer in Windows, and view the logs that correspond to Retail Modern POS.</span></span> <span data-ttu-id="2b0d8-225">前のセクションで見逃したステップを判断する際に役立つを警告やエラーを探します。</span><span class="sxs-lookup"><span data-stu-id="2b0d8-225">Look for warnings and errors that might help you determine which steps you missed in the previous sections.</span></span>
