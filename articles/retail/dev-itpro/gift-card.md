---
title: 外部ギフト カードのサポート
description: このトピックでは、Microsoft Dynamics 365 for Retail で現在利用できる外部ギフト カードのサポートについて説明します。
author: sericks007
manager: AnnBe
ms.date: 10/10/2017
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Developer
ms.devlang: ''
ms.reviewer: robinr
ms.search.scope: Operations, Retail
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.search.industry: retail
ms.author: ivanv
ms.search.validFrom: 2017-10-02
ms.dyn365.ops.version: Application update 4
ms.openlocfilehash: 753b2983176b5cc1e51ffb18bfafefbfb07b2bd4
ms.sourcegitcommit: a25f988c4a159a1aea98641cf9eb0e0b9979d00f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/14/2019
ms.locfileid: "1541012"
---
# <a name="support-for-external-gift-cards"></a>外部ギフト カードのサポート

[!include [banner](../../includes/banner.md)]

顧客にシームレスなエクスペリエンスを提供するために、小売業者はさまざまな支払方法を受け入れることができることを望んでいます。 ギフト カードは、現金やクレジット カードの次に最も頻繁に使用される支払方法の 1 つです。 多くの小売業者にとっての重要な要件は、販売時点管理 (POS) でさまざまなタイプのギフト カードを各種プロバイダーから受け入れることです。

Microsoft Dynamics 365 for Retail は現在、外部ギフト カードをサポートします。 したがって、小売業者は、GiveX などのギフト カード プロバイダーからのサードパーティ ギフト カードを POS を使用して受け入れられます。 この機能を活用するには、外部のギフト カード サービス プロバイダのアカウントが必要です。 この機能は、ソリューションが提供していた標準のギフト カード サポートとは異なります。

最初から用意されている Verifone Payment コネクタもアップデートされ、外部ギフト カードの機能をサポートしています。 最初の更新で GiveX との統合が可能になりました。

外部ギフト カードは、小売用バックオフィスと POS の両方に設定する必要があります。 ギフト カードをコンフィギュレーションする前に、小売業者は外部のギフト カード サービス プロバイダーのアカウントが必要です。

## <a name="retail-headquarters-configuration"></a>小売用バックオフィス コンフィギュレーション

1. **ハードウェア プロファイル**を検索して **POS ハードウェア プロファイル** ページを開きます。
2. **POS ハードウェア プロファイル**ページで、次の手順に従います。

   1. ページの左側にあるナビゲーション バーで、**仮想**を選択します。
   2. **編集**を選択します。
   3. **ETF サービス**クイック タブの、**コネクタ**グリッドで、最初の入力 **TestConnector** を選択します。
   4. **サポートされる支払/入金タイプ** フィールドに、**GiftCard** を追加します。

       ![サポートされている支払/入金タイプのリストへの GiftCard の追加](./media/01.png)

   5. **保存** を選択します。

      > [!NOTE]
      > また、**新規** ボタンを使用して複数の支払コネクタを作成することができます。 この方法で、ソリューションに追加された複数のコネクタのサポートを利用できます。 異なる支払メソッドのために異なる支払コネクタを設定することができます。 たとえば、1 つのコネクタですべてのクレジット カードを処理できますが、別のコネクタでギフト カードを処理することができます。

3. **支払方法** を検索して **支払方法** ページを開きます。
4. **新規** を選択し、次の手順に従います。

    1. **支払方法**フィールドに **12** と入力します。
    2. **支払方法名**フィールドに、**外部ギフト カード**と入力します。
    3. **既定の機能**フィールドで、**カード**を選択します。
    4. **保存** を選択します。

5. **すべての小売店舗**ページを開きます。
6. 一覧で、**ヒューストン**の店舗を選択します。
7. アクション ウィンドウで、**設定** &gt; **支払方法**を選択します。
8. **新規**を選択します。
9. **支払方法**フィールドに **12** と入力します。 次に、**支払方法名** および **関数** フィールドが自動的に設定されます。
10. **一般**クイック タブで、次のフィールドを設定します。

    - **工程名** フィールドを **支払ギフト カード** に設定します。
    - **コネクタ名** フィールドを **TestConnector** に設定します。

11. **転記**クイック タブで、**ギフト カード品目番号**フィールドを **0010** に設定します。

    ![ギフト カード品目の番号フィールドの設定](./media/05_02.png)

12. **保存** を選択します。
13. 手順4で作成したギフトカードに新たに作成した外部のギフトカードの支払い方法を割り当てるには、 **Card setup** を選択し、 **New** をクリックします。  
14. **ボタン グリッド**ページを開きます。
15. ページの左側にあるナビゲーション バーで、**F2S1M** を検索してフィルター処理オプションを選択します。
16. アクション ウィンドウで、**デザイナー**を選択しボタン デザイナー アプリケーションをダウンロードします。
17. グリッド デザイナーが表示されたら、空の (灰色) 領域を右クリックして、**新規作成ボタン** を選択します。

    ![新しいボタン](./media/07.png)

18. 新しいボタンを右クリックし、**ボタン プロパティ** を選択します。
19. 次のマトリックスに従って **アクション**、**支払タイプ**、および**ボタンのテキスト** プロパティを設定します。

    | アクション            | 支払タイプ       | ボタンのテキスト        |
    |-------------------|--------------------|-----------------------|
    | ギフト カードの発行   | 外部ギフト カード | Ext Issue ギフト カード   |
    | ギフト カードに追加  | 外部ギフト カード | ギフト カードに Ext 追加  |
    | ギフト カード残高 | 外部ギフト カード | Ext Gift カード残高 |
    | ギフト カードで支払う     | 外部ギフト カード | Ext Pay ギフト カード     |

    完了したら、ボタンのレイアウトは次の図のようになります。

    ![完了したボタン レイアウト](./media/10.png)

20. デザイナーを閉じます。
21. **配送スケジュール**を検索します。
22. ページの左側にあるナビゲーション バーで、**1090**、**1115**、および **1070** を検索します。
23. アクション ウィンドウで、**今すぐ実行**を選択します。
24. **ダウンロード セッション**を検索してジョブのステータスを確認してください。
25. すべてのジョブの横に **適用済** が表示されるまで待ってから、ブラウザーを閉じます。

## <a name="reset-iis-if-youre-using-retail-store-scale-unit"></a>Retail Store Scale Unit を使用している場合、IIS をリセットします。

ストアにある Retail Store Scale Unit (RSSU) を使用している場合は、管理者としてコマンド プロンプト ウィンドウを開き、**iisreset** と入力します。 それ以外の場合、Retail サーバーが更新されるまで待機します。

## <a name="update-merchant-properties"></a>商人プロパティの更新

1. ファイル エクスプローラーで、**C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\Retail Hardware Station\\ConfigurationUtility** に移動します。
2. **HardwareStationConfigurationUtility** 実行可能プログラムを実行します。
3. 正しい Retail サーバー URL を入力してユーティリティをコンフィギュレーションし、**インストール**を選択します。
4. ダウンロードが正常に完了したことを確認するには、**C:\\ProgramData\\Microsoft Dynamics AX\\Retail Hardware Station** に移動し、**MerchantInformation.xml** ファイルのタイムスタンプを確認します。 これは最新である必要があります。

## <a name="configure-and-test-retail-modern-pos"></a>Retail Modern POS のコンフィギュレーションとテスト

1. Retail Modern POS の申請を開始
2. 標準の資格情報を使用してログインします。
3. メッセージが表示されたら、**ドロワー以外の操作の実行** を選択します。
4. メイン画面で、**ハードウェア ステーションの選択**を選択します。
5. ページの右側にあるバーで、**管理**を選択します。
6. **仮想周辺機器** をオンにし、**OK** を選択します。
7. **使用可能なペアリング済ステーション** フィールドで、**仮想周辺機器**を選択します。
8. 新しいシフトを開くか、非ドロワー操作を実行するように求められます。 新しいシフトを開くことができるようになりました。
9. メイン画面で、**現在のトランザクション**を選択します。
10. **ギフト カード** を選択します。
11. **Ext Issue ギフト カード** を選択します。
12. **9** で始まる数を入力し、次に金額を指定します。
13. 品目がカートに追加された後、現金またはカードを使用して支払うことができます。

## <a name="troubleshooting"></a>トラブルシューティング 

### <a name="issue-an-error-occurs-when-you-start-the-hardwarestationconfigurationutility-program"></a>問題: HardwareStationConfigurationUtility プログラムの起動時にエラーが発生します

1. 上位のコマンド プロンプトからは、メモ帳で **HardwareStationConfigurationUtility.exe.config** ファイルを開きます。
2. ファイルで、次の手順に従います。

    1. **DataServiceUrl** 値を適切な Retail サーバー URL に置き換えます。
    2. **AADLogonUrl** の値が正しいことを確認します。

3. ファイルを保存して閉じます。
4. ユーティリティを再起動します。

### <a name="issue-a-token-error-occurs-when-you-try-to-pair-virtual-peripherals"></a>問題: 仮想周辺機器をペアリングしようとしたときにトークン エラーが発生します

1. MPOS を終了します。
2. **C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\Retail Hardware Station\\Package** に移動します。
3. 上位のコマンド プロンプトからは、メモ帳で **Web.config** ファイルを開きます。
4. **RetailServer** 値を適切な Retail サーバー値に置き換えます。
5. ファイルを保存して閉じます。
6. MPOS を再起動します。
7. 問題が解消しない場合は、MPOS を終了し、タスク マネージャーを使用して、実行中の dllhost.exe インスタンスを終了させ、インターネット インフォメーション サービス (IIS) のリセットを別に行います。
