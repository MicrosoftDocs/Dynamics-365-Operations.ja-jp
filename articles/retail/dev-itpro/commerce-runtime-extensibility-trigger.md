---
title: Commerce Rumtime (CRT) の拡張機能とトリガー
description: この記事では、Microsoft Dynamics AX commerce ランタイム (CRT) のトリガー サポートについて説明します。 CRTは、すべての要求に対してプレトリガーおよびポストトリガーをサポートしています。
author: RobinARH
manager: AnnBe
ms.date: 06/20/2017
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Developer
ms.reviewer: rhaertle
ms.search.scope: Operations, Retail
ms.custom: 17731
ms.assetid: 2d6ec331-b266-4dbc-97c5-db2919b662dc
ms.search.region: Global
ms.search.industry: Retail
ms.author: sijoshi
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update
ms.openlocfilehash: f859f486757aa2c408dabc6537892cacf0dfa8ba
ms.sourcegitcommit: 27a98a7a0f1d2623f5236a88066f483def30889c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/01/2019
ms.locfileid: "1833085"
---
# <a name="commerce-runtime-crt-extensibility-and-triggers"></a>Commerce Rumtime (CRT) の拡張機能とトリガー

[!include [banner](../includes/banner.md)]

この記事では、Dynamics 365 for Retail commerce ランタイム (CRT) のトリガー サポートについて説明します。 CRTは、すべての要求に対してプレトリガーおよびポストトリガーをサポートしています。

## <a name="crt-trigger-overview"></a>CRT トリガーの概要

Commerce Runtime (CRT) トリガーによって CRT のワークフローを拡張でき、全ての CRT リクエストが実行される前後に、ビジネス ロジックに追加できるようにします。 次の 2 つの方法が使用されます。

-   **OnExecuting** – このメソッドは、要求が対応する **IRequestHandler** 実装によって処理される前に呼び出されます。
-   **OnExecuted** – このメソッドは、要求が対応する **IRequestHandler** 実装によって処理された後に呼び出されます。

## <a name="crt-trigger-interface"></a>CRT トリガー インターフェイス
トリガーを実装するには、次のコード例に示すように、これらのタスクを完了する必要があります。

1.  **IRequestTrigger** を実装します。
2.  **SupportedRequestTypes** を指定して、トリガーを実行する必要のある要求のタイプを定義します。
3.  要求の解決前にビジネス ロジックを実行する必要がある場合、トリガーの実装を **OnExecuting** メソッドに記述します。
4.  要求の解決後にビジネス ロジックを実行する必要がある場合、トリガーの実装を **OnExecuted** メソッドに記述します。

<!-- -->

    /// <summary>
    /// The interface for request trigger.
    /// </summary>
    public interface IRequestTrigger
    {
        /// <summary>
        /// Gets the collection of request types supported by this trigger.
        /// </summary>
        /// <remarks>If null or empty collection returned trigger will be called for all request.</remarks>
        IEnumerable<Type> SupportedRequestTypes { get; }
        /// <summary>
        /// Invoked before request has been processed by <see cref="IRequestHandler"/>.
        /// </summary>
        /// <param name="request">The incoming request message.</param>
        void OnExecuting(Request request);
        /// <summary>
        /// Invoked after request has been processed by <see cref="IRequestHandler"/>.
        /// </summary>
        /// <param name="request">The request message processed by handler.</param>
        /// <param name="response">The response message generated by handler.</param>
        void OnExecuted(Request request, Response response);
    }

    Sample trigger implemntation for Get customer data request:

            public class GetCustomerTriggers : IRequestTrigger
        {
            /// <summary>
            /// Gets the supported requests for this trigger.
            /// </summary>
            public IEnumerable<Type> SupportedRequestTypes
            {
                get
                {
                    return new[] { typeof(GetCustomerDataRequest) };
                }
            }

            /// <summary>
            /// Post trigger code to retrieve extension properties.
            /// </summary>
            /// <param name="request">The request.</param>
            /// <param name="response">The response.</param>
            public void OnExecuted(Request request, Response response)
            {
                ThrowIf.Null(request, "request");
                ThrowIf.Null(response, "response");

                //Custom logic
            }

            /// <summary>
            /// Pre trigger code.
            /// </summary>
            /// <param name="request">The request.</param>
            public void OnExecuting(Request request)
            {
                //Custom logic
            }
        }

## <a name="trigger-commerceruntimeconfig-updates-for-70"></a>7.0 の CommerceRunTime.config 更新プログラムをトリガーする
CRT を拡張するときは、ユーザー独自のアセンブリ内で拡張機能を記述する必要があります。 トリガー拡張子をアセンブリに書き込んだ後、Retail サーバー bin フォルダーに拡張子ライブラリをコピーし、実行時にトリガーがロードされるように、CRT の commerceRuntime.config ファイルの**合成**セクションに入力を追加します。 次の例は、**CRTExtensionTrigger** アセンブリ内のトリガー実装のエントリを含む .config ファイルを示しています。 

[![CRTExtensionTrigger](./media/crtextensiontrigger-1024x489.png)](./media/crtextensiontrigger.png)

オフライン モードで作業する CRT 拡張機能については、合成セクションの拡張ライブラリ情報で **...\Microsoft Dynamics 365\70\Retail Modern POS\ClientBroker\CommerceRuntime.MPOSOffline.config** を更新し、その拡張ライブラリをコピーして **...\Microsoft Dynamics 365\70\Retail Modern POS\ClientBroker** に貼り付けます。

## <a name="trigger-commerceruntimeconfig-updates-for-71-with-may-2017-monthly-update-72-and-73"></a>7.1 (2017 年 5 月の月次更新)、7.2 および 7.3 の CommerceRunTime.config 更新プログラムのトリガー
拡張ライブラリを **...\RetailServer\webroot\bin\ext フォルダー**にコピーして貼り付け、構成セクションのカスタム拡張ライブラリ情報を含む **commerceRuntime.ext.config** ファイルを更新します。 この例では、**Contoso.Commerce.Runtime.Services** はカスタムの拡張機能名です。
    <add source="assembly" value="Contoso.Commerce.Runtime.Services" /> 

オフライン モードで作業する CRT 拡張機能については、合成セクションの拡張ライブラリ情報で **...\Microsoft Dynamics 365\70\Retail Modern POS\ClientBroker\extCommerceRuntime.MPOSOffline.ext.config** を更新し、その拡張ライブラリをコピーして **...\Microsoft Dynamics 365\70\Retail Modern POS\ClientBroker\ext** に貼り付けます。
