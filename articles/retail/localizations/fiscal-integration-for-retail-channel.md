---
title: "小売チャネルの会計統合"
description: "このトピックでは、Retail POS の会計統合の概要を示します。"
author: josaw
manager: annbe
ms.date: 11/01/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-365-retail
ms.technology: 
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2018-11-1
ms.dyn365.ops.version: 8.1.1
ms.translationtype: HT
ms.sourcegitcommit: 0450326dce0ba6be99aede4ebc871dc58c8039ab
ms.openlocfilehash: c852d095505abecbd44d29e9e7b53875e9069def
ms.contentlocale: ja-jp
ms.lasthandoff: 11/01/2018

---
# <a name="fiscal-integration-for-retail-channel"></a>小売チャネルの会計統合

[!include [banner](../includes/banner.md)]

このトピックは、Microsoft Dynamics 365 for Retail で利用できる会計統合機能の概要です。 会計統合機能は、小売業界における不正を防止する地域の会計法をサポートするために設計されたフレームワークです。 会計統合を使用してカバーすることができる典型的なシナリオは次のとおりです。

- 会計レシートを印刷し、顧客に提供する。
- POS で実施された売上および返品に関連する情報の、当局が提供する外部サービスへの提出を確保する。
- 当局によって承認されたデジタル署名によるデータ保護の使用。

このトピックでは、ユーザーが次のタスクを実行できるように、会計統合を設定するためのガイドラインを示します。 

- 貯蓄、デジタル署名、会計データの保護された送信などの会計登録目的で使用する会計デバイスまたはサービスである会計コネクタをコンフィギュレーションします。
- 出力メソッドと会計ドキュメントの生成のアルゴリズムを定義するドキュメント プロバイダーをコンフィギュレーションします。
- 一連のステップと各ステップで使用されるコネクタのグループを定義する会計登録プロセスをコンフィギュレーションします。
- 会計登録プロセスを POS 機能プロファイルに割り当てます。
- コネクタ技術プロファイルを、ハードウェア プロファイル (ローカルの会計コネクタ用) または POS 機能プロファイル (他の会計コネクタ タイプ用) のいずれかに割り当てます。

## <a name="fiscal-integration-execution-flow"></a>会計統合実行フロー
次のシナリオでは、一般的な会計統合実行フローを示します。

1. 会計登録プロセスの初期化
  
   小売トランザクションが終了した後など、会計登録が必要なアクションを実行した後は、会計登録プロセスは現在の POS 機能プロファイルに関連付けられます。

1. 会計コネクタを検索します。
   
   会計登録プロセスに含まれる会計登録ステップごとに、システムにより会計コネクタの一覧と照合されます。 これらのコネクタには、指定されたコネクタ グループに含まれる機能プロファイルと、現在のハードウェア プロファイル (**ローカル**のみに対応するコネクタ タイプ用) または現在の POS 機能プロファイル (他のコネクタ タイプ用) に関連した技術プロファイルを持つコネクタの一覧があります。
   
1. 会計統合を実行します。

   システムは、検索されたコネクタとリンクされているアセンブリで定義されているすべての必要なアクションを実行します。 これは、このコネクタの前の手順で見つかった機能プロファイルおよび技術プロファイルの設定に従って実行されます。

## <a name="setup-needed-before-using-fiscal-integration"></a>会計統合を使用する前に必要な設定
会計統合機能を使用する前に、次の設定を定義する必要があります:

- 会計機能プロファイル番号の**小売パラメーター**ページで番号順序を定義します。
  
- 以下の参照の**小売共有パラメーター**ページで番号順序を定義します。
  
  - 会計技術プロファイル番号
  - 会計コネクタ グループ番号
  - 登録プロセス番号

- 会計統合のために使用する予定のデバイスまたはサービスごとに、**小売 > チャネル設定 > 会計統合 > 会計コネクタ**で**会計コネクタ**を作成します。

-  すべての会計コネクタに**小売 > チャネル設定 > 会計統合 > 会計ドキュメント プロバイダー**で**会計ドキュメント プロバイダー**を作成します。 データ マッピングは、会計ドキュメント プロバイダーの一部と見なされます。 同じコネクター (州固有の規則など) に異なるデータ マッピングを設定するには、異なる会計文書プロバイダーを作成する必要があります。

- **小売 > チャンネル設定 > 会計統合 > コネクタ機能プロファイル**で会計ドキュメント プロバイダーごとに**コネクタ機能プロファイル**を作成します。
  - コネクタ名を選択します。
  - ドキュメント プロバイダーを選択します。
  - **サービス設定**タブで VAT 率の設定を指定します。
  - **データ マッピング**タブで VAT コード マッピングと支払/入金タイプのマッピングを指定します。

  #### <a name="examples"></a>例 

  |  | 書式設定 | 例 | 
  |--------|--------|--------|
  | VAT 率の設定 | 値 : VATrate | 1 : 2000, 2 : 1800 |
  | VAT コードのマッピング | VATcode : 値 | vat20: 1、vat18: 2 |
  | 支払/入金タイプのマッピング | TenderTyp: 値 | 現金 : 1, カード : 2 |

- **小売 > チャネル設定 > 会計統合 > 会計コネクタ グループ**で**会計コネクタ グループ**を作成します。 コネクタ グループは、同じ機能を実行し、会計登録プロセスの同じ段階で使用される会計コネクタにリンクされた機能プロファイルのサブセットです。

   - 機能プロファイルをコネクタ グループに追加します。 **機能プロファイル**ページで**追加**をクリックしてから、プロファイル番号を選択します。
   - 機能プロファイルの使用を中断する場合は、**無効にする**を**はい**に設定します。 
   
     この変更は、現在のコネクタ グループのみに影響します。 他のコネクタ グループで同じ機能プロファイルを引き続き使用できます。

     >[!NOTE]
     > コネクタ グループ内では、各会計コネクタには 1 つの機能プロファイルしか含めることができません。

- **小売 > チャネル設定 > 会計統合 > コネクタ技術プロファイル**で会計コネクタごとに**コネクタ技術プロファイル**を作成します。
  - コネクタ名を選択します。
  - コネクタ タイプを選択します: 
      - **ローカル** - 物理デバイスまたはローカル コンピューターにインストールされるアプリケーションには、このタイプを設定します。
      - **内部** - 会計デバイスおよび Retail サーバーに接続されているサービスには、このタイプを設定します。
      - **外部** - 税務当局によって提供される Web ポータルなどの外部の会計サービスには、このタイプを設定します。
    
  - **接続**タブで設定を指定します。

      
 >[!NOTE]
 > 以前に読み込まれたコンフィギュレーションの更新されたバージョンは、機能プロファイルと技術プロファイルの両方に読み込まれます。 適切なコネクタまたはドキュメント プロバイダーが既に使用されている場合は、通知されます。 既定では、機能および技術プロファイルで手動で作成されているすべての変更が保存されます。 これらのプロファイルをコンフィギュレーションの既定のパラメーター セットで上書きするには、**コネクタ機能プロファイル**ページおよび**コネクタ技術プロファイル**ページで**更新**をクリックします。
 
- **小売 > チャネル設定 > 会計統合 > 会計登録プロセス**で会計統合の固有のプロセスごとに**会計登録プロセス**を作成します。 登録プロセスは、登録ステップおよび各ステップで使用されるコネクタ グループの順序によって定義されます。 
  
  - プロセスに登録ステップを追加します:
      - **追加** をクリックします。
      - コネクタ タイプを選択します。
      
      >[!NOTE]
      > このフィールドは、システムが技術プロファイルでコネクタを検索する場所を、コネクタ タイプ**ローカル**のハードウェア プロファイル、または他の会計コネクタ タイプの POS 機能プロファイルのいずれかで定義します。
      
   - コネクタ グループを選択します。
   
     >[!NOTE]
     > **検証**をクリックして、登録プロセスの構造の整合性を確認します。 次の場合に検証を行うことをお勧めします:
       >- POS 機能プロファイルおよびハードウェア プロファイルへのバインディングを含む、すべての設定が完了した後の新しい登録プロセス。
       >- 既存の登録プロセスに更新を行った後。

-  **小売 > チャネル設定 > POS 設定 > POS プロファイル > 機能プロファイル**で会計登録プロセスを POS 機能プロファイルにバインドします。
   - **会計登録プロセス**タブで**編集**をクリックしてから、**プロセス番号**を選択します。
- **小売 > チャネル設定 > POS 設定 > POS プロファイル > ハードウェア プロファイル**でコネクタ技術プロファイルをハードウェア プロファイルにバインドします。
   - **会計技術プロファイル**タブで**編集**をクリックしてから、**新規**をクリックします。
   - **プロファイル番号**フィールドでコネクタ技術プロファイルを選択します。
   
     >[!NOTE]
     > ハードウェア プロファイルには、複数の技術プロファイルを追加できます。 ただし、ハードウェア プロファイルにいずれかのコネクタ グループとの共通部分が 1 つ以上ある場合は、この方法はサポートされません。 不適切な設定を避けるために、すべてのハードウェア プロファイルを更新した後は登録プロセスを検証することをお勧めします。

