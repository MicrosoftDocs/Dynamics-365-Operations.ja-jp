---
title: Azure ストレージ アカウントとキー コンテナーの作成
description: このトピックでは、Azure ストレージ アカウントとキー コンテナーを作成する方法について説明します。
author: gionoder
manager: AnnBe
ms.date: 09/22/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: kfend
ms.search.scope: Core, Operations
ms.custom: 97423
ms.assetid: ''
ms.search.region: Global
ms.author: janeaug
ms.search.validFrom: 2020-07-08
ms.dyn365.ops.version: AX 10.0.12
ms.openlocfilehash: 5a883011bbff6d82504497d739c07f1ada9e5f69
ms.sourcegitcommit: d6250ee5ced43be39e789324a895fd1c07178935
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/19/2020
ms.locfileid: "4039772"
---
# <a name="create-an-azure-storage-account-and-a-key-vault"></a><span data-ttu-id="16ddf-103">Azure ストレージ アカウントとキー コンテナーの作成</span><span class="sxs-lookup"><span data-stu-id="16ddf-103">Create an Azure storage account and a key vault</span></span>

[!include [banner](../includes/banner.md)]



<span data-ttu-id="16ddf-104">電子請求のアドオン サービスでは、会社が所有している Microsoft Azure のリソースにすべての業務データを格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16ddf-104">The Electronic invoicing add-on service takes responsibility for storing all your business data in the Microsoft Azure resources that are owned by your company.</span></span> <span data-ttu-id="16ddf-105">サービスが正常に動作し、電子請求書アドオンで必要とされ生成されるすべてのビジネス データにアクセスできるようにするためには、2 つの主要な Azure リソースを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="16ddf-105">To ensure that the service works correctly, and that all the business data that is needed for and generated by the Electronic invoicing add-on is accessed only by the add-on, you must create two main Azure resources:</span></span>

- <span data-ttu-id="16ddf-106">電子請求書を格納するための Azure ストレージ アカウント (Blob ストレージ)</span><span class="sxs-lookup"><span data-stu-id="16ddf-106">An Azure storage account (Blob storage) to store electronic invoices</span></span>
- <span data-ttu-id="16ddf-107">証明書とストレージアカウントの一意リソース識別子 (URI) を格納するためのAzure key vault</span><span class="sxs-lookup"><span data-stu-id="16ddf-107">An Azure key vault to store certificates and the Uniform Resource Identifier (URI) of the storage account</span></span>

> [!NOTE]
> <span data-ttu-id="16ddf-108">電子請求書作成アドオンで使用するには、専用のキー コンテナーのリソースと顧客の Blob ストレージを特別に割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="16ddf-108">A dedicated key vault resource and customer Blob storage must be allocated specifically for use with the Electronic invoicing add-on.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="16ddf-109">必要条件</span><span class="sxs-lookup"><span data-stu-id="16ddf-109">Prerequisites</span></span>

<span data-ttu-id="16ddf-110">このトピックのタスクを完了する前に、以下の前提条件を完了していることを確認してください :</span><span class="sxs-lookup"><span data-stu-id="16ddf-110">Before you can complete the steps in this topic, you must make sure that the following tasks have been completed:</span></span>

- <span data-ttu-id="16ddf-111">Azure でのキー コンテナーのリソースの作成。</span><span class="sxs-lookup"><span data-stu-id="16ddf-111">Create a key vault resource in Azure.</span></span> <span data-ttu-id="16ddf-112">詳細については、[Azure のキー コンテナー](https://docs.microsoft.com/azure/key-vault/general/overview)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="16ddf-112">For more information, see [About Azure Key Vault](https://docs.microsoft.com/azure/key-vault/general/overview).</span></span>
- <span data-ttu-id="16ddf-113">Azure ストレージ アカウント (Blob ストレージ) の作成。</span><span class="sxs-lookup"><span data-stu-id="16ddf-113">Create an Azure storage account (Blob storage).</span></span> <span data-ttu-id="16ddf-114">詳細については、[Azure ストレージ アカウントを管理する](https://docs.microsoft.com/azure/storage/blobs/) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="16ddf-114">For more information, see [Maintaining Azure Storage Account](https://docs.microsoft.com/azure/storage/blobs/).</span></span>

## <a name="overview"></a><span data-ttu-id="16ddf-115">概要</span><span class="sxs-lookup"><span data-stu-id="16ddf-115">Overview</span></span>

<span data-ttu-id="16ddf-116">このトピックでは、2 つの主要な手順について説明します :</span><span class="sxs-lookup"><span data-stu-id="16ddf-116">In this topic, you will complete two main steps:</span></span>

- <span data-ttu-id="16ddf-117">Azure のストレージ アカウントを設定してストレージ アカウントの URI を取得します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-117">Set up the Azure storage account to get the storage account URI.</span></span>
- <span data-ttu-id="16ddf-118">キーコンテナーを設定し、ストレージ アカウントの URI を格納します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-118">Set up the key vault to store the storage account URI.</span></span>

## <a name="set-up-the-azure-storage-account-to-get-the-storage-account-uri"></a><span data-ttu-id="16ddf-119">Azure のストレージ アカウントを設定してストレージ アカウントの URI を取得する</span><span class="sxs-lookup"><span data-stu-id="16ddf-119">Set up the Azure storage account to get the storage account URI</span></span>

1. <span data-ttu-id="16ddf-120">電子請求のアドオンで使用するストレージ アカウントを開きます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-120">Open the storage account that you plan to use with the Electronic invoicing add-on.</span></span>
2. <span data-ttu-id="16ddf-121">**Blob サービス** \> **コンテナー** に移動 し、新しいコンテナーを作成します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-121">Go to **Blob service** \> **Containers** , and create a new container.</span></span>
3. <span data-ttu-id="16ddf-122">コンテナーの名前を入力し、 **パブリック アクセス レベル** フィールドを **プライベート (匿名アクセスなし)** に設定し ます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-122">Enter a name for the container, and set the **Public access level** field to **Private (no anonymous access)**.</span></span>
4. <span data-ttu-id="16ddf-123">コンテナーを開き、 **設定 \> アクセス ポリシー** に移動します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-123">Open the container, and go to **Settings \> Access policy**.</span></span>
5. <span data-ttu-id="16ddf-124">**ポリシーの追加** を選択して、保存されているアクセス ポリシーを追加します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-124">Select **Add policy** to add a stored access policy.</span></span>
6. <span data-ttu-id="16ddf-125">必要に応じて、 **識別子** フィールドと **アクセス許可** フィールドを設定します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-125">Set the **Identifier** and **Permissions** fields as appropriate.</span></span> <span data-ttu-id="16ddf-126">**キーのアクセス許可** フィールドで、すべてのアクセス許可を選択します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-126">In the **Permissions** field, you should select all permissions.</span></span>

    ![Blob ストレージのアクセス許可を付与する](media/e-Invoicing-services-create-azure-resources-grant-blob-permissions.png)

7. <span data-ttu-id="16ddf-128">開始日と有効期限を入力します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-128">Enter the start and expiry dates.</span></span> <span data-ttu-id="16ddf-129">有効期限は未来の日付にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="16ddf-129">The expiry date should be in future.</span></span>
8. <span data-ttu-id="16ddf-130">**OK** をクリックしてポリシーを保存し、変更をコンテナーに保存します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-130">Select **OK** to save the policy, and then save your changes to the container.</span></span>
9. <span data-ttu-id="16ddf-131">ストレージ アカウントに戻り、 **記憶域エクスプローラー (プレビュー)** を開きます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-131">Return to the storage account, and open **Storage Explorer (preview)**.</span></span>
10. <span data-ttu-id="16ddf-132">コンテナーを右クリックし、 **共有アクセス署名の取得** を選択します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-132">Right-click the container, and then select **Get Shared Access Signature**.</span></span>
11. <span data-ttu-id="16ddf-133">**共有アクセス署名** ダイアログ ボックスで、 **URI** フィールドに値をコピーして格納します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-133">In the **Shared Access Signature** dialog box, copy and store the value in the **URI** field.</span></span> <span data-ttu-id="16ddf-134">この値は、次の手順で使用され、 *共有アクセス署名 URI* として参照されます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-134">This value will be used in the next procedure and will be referred to as the *shared access signature URI*.</span></span>

    ![URI 値の選択とコピー](media/e-Invoicing-services-create-azure-resources-select-and-copy-uri.png)

## <a name="set-up-the-key-vault-to-store-the-storage-account-uri"></a><span data-ttu-id="16ddf-136">キー コンテナーを設定し、ストレージ アカウントの URI を格納する</span><span class="sxs-lookup"><span data-stu-id="16ddf-136">Set up the key vault to store the storage account URI</span></span>

1. <span data-ttu-id="16ddf-137">電子請求書作成アドオンで使用するキー コンテナーを開きます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-137">Open the key vault that you intend to use with the Electronic invoicing add-on.</span></span>
2. <span data-ttu-id="16ddf-138">**設定** \> **秘密** に移動し、 **生成/インポート** を選択して 新しい秘密を作成します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-138">Go to **Settings** \> **Secrets** , and then select **Generate/Import** to create a new secret.</span></span>
3. <span data-ttu-id="16ddf-139">**シークレットを作成** ページの **アップロード オプション** フィールドで、 **手動** を選択します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-139">On the **Create a secret** page, in the **Upload options** field, select **Manual**.</span></span>
4. <span data-ttu-id="16ddf-140">秘密の名称を入力します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-140">Enter the name of the secret.</span></span> <span data-ttu-id="16ddf-141">この名前は、Regulatory Configuration Services (RCS) のサービス設定時に使用され、 *キー コンテナーの秘密名称* と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-141">This name will be used during setup of the service in Regulatory Configuration Service (RCS) and will be referred to as the *key vault secret name*.</span></span>
5. <span data-ttu-id="16ddf-142">**値** フィールドで、 **共有アクセス署名 URI** を選択し、 **作成** を選択します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-142">In the **Value** field, select **Shared Access Signature URI** , and then select **Create**.</span></span>
6. <span data-ttu-id="16ddf-143">アクセス ポリシーを設定して、電子請求書発行アドオンに自分が作成した秘密への適切なレベルの安全なアクセス権を付与します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-143">Set up the access policy to grant the Electronic invoicing add-on the correct level of secure access to the secret you created.</span></span> <span data-ttu-id="16ddf-144">**設定 \>アクセス ポリシー** に移動し 、 **アクセス ポリシーの追加** を選択します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-144">Go to **Settings \> Access policy** , and select **Add Access Policy**.</span></span>
7. <span data-ttu-id="16ddf-145">**取得** と **一覧** の操作に、秘密のアクセス許可を設定します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-145">Set the secret permissions for the **Get** and **List** operations.</span></span>

    ![サービス アクセスの付与](media/e-Invoicing-services-create-azure-resources-grant-service-access.png)

8. <span data-ttu-id="16ddf-147">**取得** と **一覧** の操作に、証明書のアクセス許可を設定します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-147">Set the certificate permissions for **Get** and **List** operations.</span></span>

    ![証明書のアクセス許可の付与](media/e-Invoicing-services-create-azure-resources-grant-certificate-permission.png)

9. <span data-ttu-id="16ddf-149">**プリンシパル** ダイアログ ボックスで、 **電子請求のアドオン** を追加してプリンシパルを選択し ます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-149">In the **Principal** dialog box, select the principal by adding **Electronic invoicing add-on**.</span></span>
10. <span data-ttu-id="16ddf-150">**追加** を選択し、 **キー コンテナーの変更を保存する** を選択します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-150">Select **Add** , and then select **Save Key Vault changes**.</span></span>
11. <span data-ttu-id="16ddf-151">**概要** ページで、 キー コンテナーの **DNS 名** の値をコピーして保存します。</span><span class="sxs-lookup"><span data-stu-id="16ddf-151">On the **Overview** page, copy the **DNS name** value for the key vault.</span></span> <span data-ttu-id="16ddf-152">この値は、RCS におけるサービスの設定時に使用され、 *キー コンテナーの URI* として参照されます。</span><span class="sxs-lookup"><span data-stu-id="16ddf-152">This value will be used during setup of the service in RCS and will be referred as the *key vault URI*.</span></span>
