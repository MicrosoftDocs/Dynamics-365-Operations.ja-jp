---
title: 機能設定の使用
description: このトピックでは、電子請求の機能を設定する方法について説明します。
author: dkalyuzh
ms.date: 12/15/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: kfend
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: dkalyuzh
ms.search.validFrom: ''
ms.dyn365.ops.version: ''
ms.openlocfilehash: 41ffc9c7009291a55392e50c5e490d3288d122bc
ms.sourcegitcommit: ffdb6794746ffe5461f9dcf34ed8e64976d22d2d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/02/2022
ms.locfileid: "8371626"
---
# <a name="work-with-feature-setups"></a>機能設定の使用

[!include [banner](../includes/banner.md)]

電子ファイルの生成およびその他の処理手順 (たとえば、ファイルへのデジタル署名、政府の Webサービスへのファイルの送信と応答の受信、またはファイルの保存) を設定するには、電子請求機能の処理パイプライン、適用ルール、および変数を設定します。

設定情報は、*機能設定* の概念で組み合わされ、作成、削除、調整できます。 電子請求機能の完成版については、情報も表示できます。

電子ファイルを生成、処理、および受信するためのさまざまなシナリオを定義するために、必要な数の機能設定項目を作成できます。 これらの機能設定項目には、実行のための独立した処理アクションと条件がありますが、1 つの電子請求機能の一部として作成され、そのライフサイクルと配置プロセスを継承します。

## <a name="add-a-feature-setup"></a>機能設定の追加

1. 規制構成サービス (RCS) のアカウントにログインします。
2. **グローバリゼーション機能** ワークスペースの **機能** セクションで、 **電子請求** タイルを選択します。
3. **電子請求機能** ページで、ステータスが **ドラフト** の電子請求機能のバージョンを選択をします。
4. **設定** タブで **追加** を選択します。
5. **機能設定の作成** ドロップダウン ダイアログの **新規** フィールド グループで、次のいずれかのオプションを選択します:
 
    - **カスタム設定** – 設定タイプに応じて、空のチャネル、空の処理パイプライン リスト、適用ルール用の空のセクション、および既定の変数セットを含む新しい機能設定を作成します。
    - **機能設定から** – 現在の電子請求機能の範囲内に別の機能設定のコピーを作成します。

6. 最後の手順で **カスタム設定** オプションを選択した場合は、機能設定項目の名前と説明を入力し、**設定タイプ** フィールド グループで次のいずれかのオプションを選択します:

    - **処理パイプライン** – このオプションを選択し、送信用の電子ドキュメントを生成および処理します。 この設定タイプの場合は、空の処理パイプライン リスト、適用ルール用の空のセクション、および既定の変数セットがシステムによって作成されます。 受信電子ドキュメントのチャネルは使用できません。
    - **データ チャネル** – 定義したチャネルの 1 つから受信電子ドキュメントを受信し、追加のアクションなしで Microsoft Dynamics 365 Finance または Dynamics 365 Supply Chain Management に直接渡すプロセスを設定するには、このオプションを選択します。 この設定タイプの場合、システムはデータ チャネル用の事前定義済みパラメーター リスト、適用ルール用の空のセクション、および既定の変数セットを作成します。 処理パイプラインにアクションを追加することはできません。
    - **データ チャネルと処理パイプライン** – この設定タイプは、**データ チャネル** 設定タイプに似ています。 ただし、受信電子ドキュメントが Finance または Supply Chain Management に渡される前に、処理パイプラインで追加のアクションを設定できます。

7. 最後の手順で **データ チャネル** または **データ チャネルと処理パイプライン** オプションを選択した場合は、**データ チャネルの選択** フィールドで、統合するチャネルを選択する必要があります。
8. **作成** を選択します。

機能設定を作成したら、**編集** を選択して構成できます。

## <a name="edit-a-feature-setup"></a>機能設定の編集

機能設定のタイプに応じて、送信用電子ファイルを生成して外部チャネルに送信するプロセス、または受信ドキュメントを受信して Finance または Supply Chain Management アプリケーションに渡すプロセスを構成できます。

### <a name="data-channel"></a>データ チャネル

*データ チャネル* は電子ファイルを取得し、そのファイルを処理するか、Finance または Supply Chain Management に直接渡します。 このオプションは、**処理パイプライン** タイプの機能設定に使用できません。

データ チャネルを設定するには、チャネルの名前を入力します。 次に、選択したチャネル タイプに基づいてパラメーターを定義します。 データ チャネル識別子は、データ チャネルを識別するために特別に作成される変数を参照する必要があります。 Finance または Supply Chain Management で参照として使用されます。

**添付ファイル フィルター** タブで、チャネルから特定のファイルを取得する一連のフィルターを定義する必要があります。 ファイル名拡張子が異なることが予想される場合や、ファイル名に応じてファイルを別の方法で処理する必要がある場合は、複数の行を作成できます。 主なパラメーターを次に示します:

- **名前** – 処理時にシステムが参照するファイルの名前を入力します。 Finance および Supply Chain Management アプリケーションでは、送信ログのファイルを確認できます。
- **フィルター** – ファイルを選択するフィルターを定義します。
- **オプション** – このチェックボックスがオフの場合、ファイルが必須です。 この場合、チャネルにフィルターに対応するファイルが含まれていないと、エラー メッセージが表示されます。 このパラメーターはメールに適用されます。

チャネルがメールボックスで、受信メールに複数の添付ファイルが含まれている場合、サービスが添付ファイルを処理する方法を定義するルールを構成できます。 サービスでは、各添付ファイルを個別の電子請求書と見なしたり、1 つの添付ファイルを 1 つの主要な請求書として、他のすべての添付ファイルを追加として処理することができます。

### <a name="processing-pipeline"></a>処理中のパイプライン

*処理パイプライン* は、正常に完了するまで順番に実行される一連の *アクション* です。 処理パイプラインを使用すると、電子ファイルを生成して他の手順を実行するためのプロセスを設定できます (たとえば、ファイルへのデジタル署名、外部 Web サービスへの送信、応答の解析、受信ドキュメントの受信と処理など)。

アクションの一覧はあらかじめ定義されています。 **新規** ボタンおよび **削除** ボタンを使用して、ドキュメントの送信または受信に必要なプロセスを論理的に定義するアクションの組み合わせを指定できます。

アクションの順序は重要です。 順序は、**上へ** ボタンと **下へ** ボタンを使用して調節できます。

各アクションには、構成または調整できる一連のパラメーターがあります。 特定の一連のパラメーターは、アクションのタイプによって異なります。

- **アクション** – アクションのタイプを選択します。
- **アクション名** - アクションの名前を入力します。 この名前は、送信ログと、Finance アプリケーションおよび Supply Chain Management アプリケーションのメッセージに表示されます。
- **説明** – プロセス内のアクションの目的に関する詳細を入力します。
- **再試行の有効化** – このチェックボックスを選択すると、**アクションの再試行** フィールドでアクションを選択し、**再試行パラメーター** タブで追加のパラメーターを構成できます。

    再試行機能を使用すると、特定のアクションを実行できない場合にサービスの動作を構成できます。 たとえば、接続しようとする外部 Web サービスが応答しない場合は、システムが接続を再び再試行する回数、間隔、および処理パイプラインでのアクションを指定できます。

- **結果のエクスポート** – 処理パイプラインで *1 つ* のアクションに対してこのチェックボックスを選択できます。 Finance または Supply Chain Management アプリケーションにアクションによって生成される電子ファイルは、**電子ドキュメントの送信ログ** ページからエクスポートできます。

### <a name="applicability-rules"></a>適合性ルール

*適用ルール* は、電子請求機能セットによって電子請求機能を実行するためのコンテキストを提供する構成可能な条件です。
Finance または Supply Chain Management から電子請求に送信されたビジネス ドキュメントは、電子請求機能セットが特定の電子請求機能バージョンおよび特定の機能設定項目を呼び出して、送信処理をできるようにする明示的な参照は行いません。 ただし、ビジネス ドキュメントが正しく構成されている場合、どの電子請求機能バージョンおよび処理パイプラインを選択して実行する必要があるかを決定するための、電子請求に必要な要素が含まれています。

適用ルールにより、電子請求サービスは送信処理に使用する必要のある正確な電子請求機能を検索できます。 適切な機能を検索するために、送信されたビジネス ドキュメントの **コンテキスト** フィールドが、適用ルール内の条件と照合されます。

適用ルールは、次の方法で操作できます:

- **新規** を選択して、一連の適用ルールに新しい条件を追加します。
- **削除** を選択して条件を削除します。
- 複数のレコードを選択し、**グループ** ボタンまたは **グループ解除** ボタンを使用して、項目または論理ステートメントの組み合わせを作成します。 たとえば、グループ化する行を選択し、**条件のグループ化** を選択します。 句をグループ化すると、新しい列がグリッドに追加されます。 この列は、グループ化された条件の論理演算子を指定します。 次のタイプの演算子がサポートされています:

    - Equal
    - Not equal
    - 大なり/小なり
    - 以上/以下
    - Contains
    - 次の値で始まる

    > [!NOTE]
    > 句のグループ化を解除するときは、常に最も内側のグループ化レベルから開始します。

### <a name="variables"></a>変数

*変数* を使用すると、アクション間の処理パイプラインおよびデータ フローを設定する際に柔軟性が向上します。 一部のアクション パラメーターで変数を参照して、データまたは電子ファイルを一時的に保存できます。 一部の変数は、Finance または Supply Chain Management アプリケーションと電子請求サービスの間でデータを渡するために使用されます。

システムは、いくつかの変数を既定で作成します。 たとえば、**BusinessDocumentDataModel** 変数には、送信プロセス中に接続されたアプリケーションからの呼び出しに含まれる JavaScript Object Notation (JSON) 構造のビジネス データが含まれます。

以下のタイプの変数を使用できます:

- **定数** – パイプライン アクションの処理に使用される一時的なデータを格納するコンテナー。
- **クライアントから** – 変数のコンテンツは、送信プロセスの実行時に Dynamics 365 クライアントから取得されます。
- **クライアントへ** – 変数のコンテンツは、送信プロセスの実行時に Dynamics 365 クライアントによってインポートできるようになります。
- **データ型** – 変数に格納されている情報のデータ型を選択します。

### <a name="parameters"></a>パラメーター

**ビジネス データの削減を無効にする** オプションは、電子ドキュメントの送信中に Finance または Supply Chain Management アプリケーションからのビジネス データ ペイロードの構造を最適化するために使用されます。 最適化により、必要な電子ファイルにさらに変換するために電子請求サービスに送られるデータを削減できます。 既定値は **いいえ** です。

- **はい** – Finance または Supply Chain Management は、**電子レポート** モジュールで定義された **請求書モデル** または **会計モデル** (ブラジル向け) 構造の JSON ファイルを送信します。 モデルのすべての要素には、最終的な電子ファイル構造に関係なく、アプリケーション側のビジネス データが入力されます。 通常、モデルにはターゲット ファイル構造が必要とするよりも多くのビジネス データが含まれており、このデータをアプリケーションで生成するために多くの時間が必要になる場合があります。 1 つの電子請求機能と機能設定で異なる出力ファイルを生成するまれなイベントでは、このオプションに対して **はい** の値が必要です。 **はい** の値は、シナリオ、電子ファイルの構造、およびビジネス データの完全性のトラブルシューティングを行うときに役立ちます。
- **いいえ** – Finance または Supply Chain Management は、ビジネス データがない状態で、サービスに最初の呼び出しを行います。 この呼び出しの目的は、処理パイプライン内の電子ファイル変換に使用される電子レポート (ER) 構成に関する情報を取得することです。 この情報はアプリケーションに返され、アプリケーションはこの情報を使用して、**請求書モデル** または **会計モデル** (ブラジル向け) 構造の JSON ファイルに含めるビジネス データのサブセットを決定します。 このオプションの **いいえ** の値を使用すると、アプリケーションが電子ファイルを正常に生成するために必要なビジネス データのみを送信できるため、アプリケーションがサービスに送信するビジネス データの量を削減できます。

### <a name="validate-a-feature-setup"></a>機能設定の検証

検証を実行して、構成全体の整合性を確認できます。 たとえば、アクションの必須パラメーターを空白のままにした場合、検証ではこの不整合が検出され、警告メッセージが表示されます。

- **機能バージョン設定** ページのアクション ペインで **検証** を選択します。

## <a name="delete-a-feature-setup"></a>機能設定の削除

1. **電子請求機能** ページで、ステータスが **ドラフト** の電子請求機能のバージョンを選択をします。
2. **設定** タブで、**削除** を選択します。
3. 表示されたメッセージ ボックスで、**はい** を選択して、機能設定を削除することを確認します。
