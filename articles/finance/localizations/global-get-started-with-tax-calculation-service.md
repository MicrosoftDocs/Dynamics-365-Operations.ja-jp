---
title: 税計算の使用を開始する
description: この記事では、税の計算を設定する方法について説明します。
author: EricWangChen
ms.date: 03/25/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: kfend
ms.search.region: Global
ms.author: wangchen
ms.search.validFrom: 2021-04-01
ms.dyn365.ops.version: 10.0.18
ms.custom: intro-internal
ms.search.form: TaxIntegrationTaxServiceParameters
ms.openlocfilehash: 2b9af7a8bef9d479c4f2ec59ef533403a74251b1
ms.sourcegitcommit: adadbc6e355e2ad68a1f6af26a1be1f89dc8eec6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/22/2022
ms.locfileid: "9573308"
---
# <a name="get-started-with-tax-calculation"></a>税計算の使用を開始する

[!include [banner](../includes/banner.md)]

この記事では、税の計算の使用を開始する方法を説明します。 この記事のセクションは、Microsoft Dynamics Lifecycle Services (LCS)、Regulatory Configuration Service (RCS)、Dynamics 365 Finance、Dynamics 365 Supply Chain Management の高いレベルのデザインと構成手順について説明します。 

この設定は、次の 3 つの主要なステップで構成されています。

1. LCS で、税計算アドインをインストールします。
2. RCS で、税計算機能を設定します。 この設定は、法人ごとに固有のものではありません。 Finance および Supply Chain Management の法人間で共有できます。
3. Finance および Supply Chain Management で、法人別に税計算パラメーターを設定します。

## <a name="high-level-design"></a>高レベル設計

### <a name="runtime-design"></a><a name="runtime"></a> ランタイム デザイン

次の図は、税金計算の高いレベルのランタイム デザインを示しています。 税金計算は複数の Dynamics 365 アプリと統合可能なので、この図では財務との統合を例に示しています。

1. 販売注文や発注書などのトランザクションは財務で作成されています。
2. 財務では、売上税グループと品目売上税グループの既定値が自動的に使用されます。
3. トランザクションで **売上税** ボタンが選択されると、税額計算がトリガされます。 次に、財務によって税務上の計算サービスにデータが送信されます。
4. 税計算サービスは、より正確な売上税グループと品目売上税グループを同時に見つけ、税務機能の事前に定義されたルールで積載データを一致させることができます。

    - ペイロードを **税グループの適用** マトリックスと一致できる場合は、売上税グループの値が適用ルール内の一致する税グループ値で上書 きされます。 それ以外の場合は、財務から売上税グループ値を使用し続けます。
    - ペイロードを **品目税グループの適用** マトリックスと一致できる場合は、品目売上税グループの値が適用ルール内の一致する品目税グループ値で上書きされます。 それ以外の場合は、財務から品目売上税グループ値を使用し続けます。

5. 税計算サービスは、売上税グループと品目売上税グループの共通部分を使用して最終的な税コードを決定します。
6. 税計算サービスは、決定された最終的な税コードに基づいて税金を計算します。
7. 税計算サービスは、税計算の結果を財務に返します。

![税計算ランタイムのデザイン。](media/tax-calculation-runtime-logic.png)

### <a name="high-level-configuration"></a>高レベル構成

次の手順では、税計算サービスの構成プロセスの高レベルの概要を示します。

1. LCS で、自分の LCS プロジェクトに **税計算** アドインをインストールします。
2. RCS で、**税計算** 機能を作成します。
3. RCS で、**税計算** 機能を設定します。

    1. 税構成バージョンを選択します。
    2. 税コードを作成します。
    3. 税グループを作成します。
    4. 品目税グループを作成します。
    5. オプション: 顧客または仕入先のマスタ データから入力された既定の売上税グループを上書きする場合、税グループの適用を作成します。
    6. オプション: 品目マスタ データから入力された既定の品目売上税グループを上書きする場合、品目グループの適用を作成します。

4. RCS では、**税計算** 機能を完成して公開します。
5. 財務で、公開されている **税計算** 機能を選択します。

これらの手順を完了すると、次の設定が自動的に RCS から財務に同期されます。

- 消費税コード
- 消費税グループ
- 品目消費税グループ

この記事の残りのセクションでは、より詳細の構成ステップを提供します。

## <a name="prerequisites"></a>必要条件

この記事の残りの手順を完了する前に、以下の前提条件を満たす必要があります。<!--TO HERE-->

- LCS アカウントにアクセスし、Dynamics 365 バージョン 10.0.21 以降を実行する第 2 層以上の環境を持つ LCS プロジェクトを展開する必要があります。
- 組織に対する RCS 環境を作成し、アカウントにアクセスする必要があります。 RCS 環境の作成方法の詳細については、[Regulatory Configuration Service の概要](rcs-overview.md) を参照してください。
- 次の機能は、業務ニーズに基づいて、展開された Finance または Supply Chain Management の **機能管理** ワークスペースで有効になっている必要があります。

    - 税計算サービス
    - 複数の VAT 登録番号のサポート
    - 移動オーダーの税機能

- 次の機能は、展開された RCS 環境の **機能管理** ワークスペースで有効になっている必要があります。

    - グローバリゼーション機能

- 必要に応じて、次のロールが RCS 環境のユーザーに割り当てられる必要があります。

    - 電子申告開発者
    - グローバリゼーション機能の開発者
    - 税エンジン開発者
    - 税エンジン機能コンサルタント
    - 税サービスの開発者

## <a name="set-up-tax-calculation-in-lcs"></a>LCS で、税計算を設定します

1. [LCS](https://lcs.dynamics.com)にサインインします。
2. Microsoft Power Platform 統合の設定を完了します。 詳細については、[アドインの概要](../../fin-ops-core/dev-itpro/power-platform/add-ins-overview.md) を参照してください。
3. 展開されている環境のいずれかを選択し、**新しいアドインのインストール** を選択します。
4. **税計算** を選択します。
5. 契約条件を読んで合意し、**インストール** を選択します。

## <a name="set-up-tax-calculation-in-rcs"></a>RCS で、税計算を設定します

このセクションの手順は、特定の法人に関連しています。 この手順を実行する必要があるのは 1 回だけであり、RCS のどの法人でもこれを実行できます。

1. [RCS](https://marketing.configure.global.dynamics.com/) にサインインします。
2. **電子申告** ワークスペースで、新しいコンフィギュレーション プロバイダーを追加します。 会社名をプロバイダーの名前として使用します。 詳細については、[構成プロバイダーを作成して、有効としてマークする](../../fin-ops-core/dev-itpro/analytics/tasks/er-configuration-provider-mark-it-active-2016-11.md) を参照してください。
3. 作成したコンフィギュレーション プロバイダーを選択し、**有効に設定** を選択します。
4. **Microsoft** コンフィギュレーション プロバイダーを選択し、**リポジトリ** を選択します。
5. **タイプ** フィールドで、**グローバル** を選択します。
6. **開く** を選択します。
7. **税データ モデル** に移動し、ファイル ツリーを展開して、 **税コンフィギュレーション** を選択します。
8. 正しい [税構成バージョン](global-tax-calcuation-service-overview.md#versions) を、財務バージョンに基づいて選択し、**インポート** を選択します。
9. **グローバリゼーション機能** ワークスペースに戻り、**機能** を選択し、**税計算** タイルを選択して、**追加** を選択します。
10. 次のいずれかの機能タイプを選択します。

    - **新機能** - 空のコンテンツを含む機能の設定を作成します。
    - **既存の機能に基づく** - 既存の機能から機能を作成し、既存の機能設定からコンテンツをコピーします。

11. 機能の名前と説明を入力して、**機能の作成** を選択します。

    機能作成後に、ドラフト バージョンが自動的に作成されます。 **バージョンを取得** を選択して、完了したバージョンのドラフト バージョンをリベースできます。

12. 機能のドラフト バージョンを選択し、**編集** を選択します。 **税計算の設定** ページが自動入力されます。
13. **コンフィギュレーション バージョン** を選択します。 手順 8 でインポートしたコンフィギュレーション バージョンが表示されます。

    Microsoft は、税計算の既定の税コンフィギュレーションを提供します。 このコンフィギュレーションでは、税計算動作に関する要件のほとんどがカバーされます。 これは、市場フィードバックに基づいて更新されます。 特定の要件を満たすためにコンフィギュレーションを拡張する必要がある場合、独自の税コンフィギュレーションを生成および選択する方法の詳細については、[税務サービスの拡張機能を構築する方法 ](./tax-service-add-data-fields-tax-integration-by-extension.md)を参照してください。

14. **コンフィギュレーション バージョン** を選択すると、いくつかのタブが表示されます。 ここに表示される順序に従って、必須のタブ設定を完了します。

    **必須の設定**

    - **税コード**- 税コードのマスター データを管理します。 現在のバージョンを有効にした場合、このタブで作成された税コードはすべて Finance に自動的に同期されます。
    - **税グループ**- 税グループ マスター データおよびグループの下の税コードを定義します。
    - **品目別税グループ**- 品目別税グループ マスター データおよびグループの下の税コードを定義します。

    **オプションの設定**

    - **税グループの適用性**- 税グループを決定するマトリックスを定義します。 このマトリックスの適用ルールが Dynamics 365 の課税対象ドキュメントと一致しない場合、税計算では課税対象ドキュメント行の既定値が使用されます。
    - **品目別税グループの適用性**- 品目別税グループを決定するマトリックスを定義します。 このマトリックスの適用ルールが Dynamics 365 の課税対象ドキュメントと一致しない場合、税計算では課税対象ドキュメント行の既定値が使用されます。
    - **顧客の税登録番号の適用性**- 1 件の顧客に複数の税登録番号がある場合は、税計算によって正しい税登録番号を自動的に決定できます。 このタブのマトリックスでは、決定を行うのに使用する必要があるルールを定義します。 このオプションを選択しない場合、Finance および Supply Chain Management は引き続き、販売トランザクションの課税対象ドキュメントに既定の税登録番号を使用します。
    - **仕入先税登録番号の適用性**- 1 件の仕入先に複数の税登録番号がある場合は、税計算によって正しい税登録番号を自動的に決定できます。 このタブのマトリックスでは、決定を行うのに使用する必要があるルールを定義します。 このオプションを選択しない場合、Finance および Supply Chain Management は引き続き、購入トランザクションの課税対象ドキュメントに既定の税登録番号を使用します。
    - **リスト コードの適用性**- より柔軟で構成可能なルールによって、**リスト コード** フィールドの値が自動的に特定されるのに役立ちます。 このタブのマトリックスでは、決定を行うのに使用する必要があるルールを定義します。 このオプションを選択しない場合、Finance および Supply Chain Management は引き続き、課税対象ドキュメントに既定のコードを使用します。

14. **税コード** タブで、**追加** を選択し、税コードと説明を入力します。
15. **税コンポーネント** を選択します。 税コンポーネントは、選択された税コンフィギュレーションの以前のバージョンで定義された一連の方法です。 次の税コンポーネントを使用できます。

    - 正味金額別
    - 総額別
    - 数量別
    - 利益幅別
    - 税の税

16. **保存** を選択します。 選択した税コンポーネントに基づいて、使用可能なフィールドが増加します。
17. 次のオプションを使用して、税コードの性質を識別します。

    - 免税対象である
    - 利用税である
    - 逆請求である
    - 基準額計算から除外

    利用税のシナリオでは、正の税率を持つ単一の税コードを設定し、**利用税である** とマークします。

    逆請求のシナリオでは、2 つの税コードを設定します。税コードの 1 つは正の税率で、もう一方の税コードには負の税率が設定されますが、税率は同じです。 負の税コードを **逆請求である** してマークします。 Finance の逆請求ソリューションの詳細については 、[VAT/GST スキームの逆請求メカニズム](emea-reverse-charge.md)を参照してください。

    価格込みトランザクションの税基準額計算から除外する必要がある一部の税タイプ (一部の国の関税など) については、**基準額計算から除外** チェック ボックスをオンにします。 このパラメーターの詳細については、[価格に税金が含まれる場合の価格上の税金の計算が有効](global-exclude-from-tax-base-amount-calculation.md) を参照してください。

    この税コードの税率と税額の上限を管理します。

18. 手順 14 ～ 17 を繰り返して、必要なすべての税コードを追加します。
19. **税グループ** タブで、**税グループ** 列を選択し、マトリックスに入力条件として追加した後、税グループのマスター データを管理するための明細行を追加します。

    次に例を示します。

    | 税グループ    | 税コード           |
    | ------------ | ------------------- |
    | DEU_Dom | DEU_VAT19; DEU_VAT7 |
    | DEU_EU       | DEU_Exempt          |
    | BEL_Dom | BEL_VAT21; BEL_VAT6 |
    | BEL_EU       | BEL_Exempt          |

20. **品目別税グループ** タブで、**品目別税グループ** 列を選択し、マトリックスに入力条件として追加した後、品目別税グループのマスター データを管理するための明細行を追加します。

    次に例を示します。

    | 品目別税グループ | 税コード                                    |
    | -------------- | -------------------------------------------- |
    | 満載           | DEU_VAT19; BEL_VAT21; DEU_Exempt; BEL_Exempt |
    | 減額率        | DEU_VAT7; BEL_VAT6; DEU_Exempt; BEL_Exempt   |

21. **税グループの適用性** タブで、正しい税グループを決定するために必要な列を選択し、**追加** を選択します。 各列の値を入力または選択します。 **税グループ** フィールドはこのマトリックスの出力となります。 このタブが構成されていない場合、トランザクション行の売上税グループが使用されます。

    次に例を示します。

    | 業務プロセス | 出荷元 | 発送先 | 税グループ    |
    | ---------------- | --------- | ------- | ------------ |
    | 営業            | DEU       | DEU     | DEU_Dom |
    | 営業            | DEU       | FRA     | DEU_EU       |
    | 営業            | BEL       | BEL     | BEL_Dom |
    | 営業            | BEL       | FRA     | BEL_EU       |
    
    > [!NOTE]
    > 課税対象ドキュメント明細行の既定の消費税グループが正しい場合、このマトリックスを空白のままにします。 詳細については、この記事にある [ランタイム デザイン](#runtime) セクションを参照してください。

22. **品目別税グループの適用性** タブで、正しい税コードを決定するために必要な列を選択し、**追加** を選択します。 各列の値を入力または選択します。 **品目別税グループ** フィールドはこのマトリックスの出力です。 このタブに何も設定されていない場合は、トランザクション行の品目別売上税グループが使用されます。

    次に例を示します。

    | 品目コード | 品目別税グループ |
    | --------- | -------------- |
    | D0001     | 全           |
    | D0003     | 減額率        |

    > [!NOTE]
    > 課税対象ドキュメント明細行の既定の品目消費税グループが正しい場合、このマトリックスを空白のままにします。 詳細については、この記事にある [ランタイム デザイン](#runtime) セクションを参照してください。

    税計算で税コードを決定する方法の詳細については、[売上税グループと品目別売上税グループ決定のロジック](global-sales-tax-group-determination.md) を参照してください。

23. ビジネス ニーズに基づいて顧客税登録番号、仕入先税登録番号、およびリスト コードの適用方法を設定します。
24. **保存** を選択し、ページを閉じます。
25. **ステータスの変更** \> **完了** を選択します。 ステータスが **完了** に変更された後は、バージョンを編集できなくなります。
26. **状態の変更** \> **公開** を選択します。 このバージョンの税機能の設定は、グローバル リポジトリにプッシュされ、Finance の各法人に表示されます。

## <a name="set-up-tax-calculation-in-dynamics-365"></a>Dynamics 365 で、税計算を設定します

RCS で設定が完了すると、税機能の発行済みバージョンが完成します。 Finance で税計算を設定する手順に従います。

このセクションの設定は法人が行います。 Finance で税計算を有効にした法人ごとに、この機能を構成する必要があります。

1. Finance で、**税** \> **設定** \> **税コンフィギュレーション** \> **税計算のパラメーター** の順に移動します。
2. **一般** タブで、次のフィールドを設定します。

    - **税計算サービスの有効化**- 法人に対して税計算を有効にするには 、このチェックボックスをオンにします。 現在の法人に対して有効になっていない場合、法人は引き続き既存の税エンジンを使用して税金を決定および計算します。
    - **機能の設定** - 法人用に対して公開済みの税機能の設定とバージョンを選択します。 公開された税機能の設定方法と完了方法の詳細については、この記事の前のセクションを参照してください。
    - **業務プロセス** – 有効にする業務プロセスを選択します。

3. **計算** タブで、法人に対して予想される丸めルールを定義します。 丸めロジックの詳細については、[税計算の丸めルール](https://go.microsoft.com/fwlink/?linkid=2166988) を参照してください。
4. **エラー処理** タブ で、法人に対して予想されるエラー処理方法を定義します。 3 つのオプションを使用できます。

    - なし
    - 警告
    - エラー

    **詳細** セクションで各結果コードのエラーの処理方法を設定できます。 または、一部の結果コードが税計算サービスと同期しない場合は、**一般** セクションで既定の方法を設定できます。

5. **複数の VAT 登録** タブで、VAT 申告、EU 販売リスト、イントラスタットを個別に有効にし、複数の VAT 登録シナリオで使用できます。 複数の VAT 登録に対する税レポートの詳細については、[複数の VAT 登録のレポート](emea-reporting-for-multiple-vat-registrations.md) を参照してください。
6. 設定を保存し、追加の法人ごとに前のステップを繰り返します。 新しいバージョンを公開し、適用する場合、**税計算パラメーター** ページの **一般** タブの **機能設定** フィールドを設定します (手順 2 を参照)。
