---
title: サービス環境
description: この記事では、電子請求のサービス環境とその設定方法について説明します。
author: gionoder
ms.date: 02/28/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: gionoder
ms.search.validFrom: ''
ms.dyn365.ops.version: ''
ms.custom: ''
ms.assetid: ''
ms.search.form: ''
ms.openlocfilehash: ff6f50ff78676f5efed7d905fb622ad662b541d7
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2022
ms.locfileid: "9291602"
---
# <a name="service-environments"></a>サービス環境

[!include [banner](../includes/banner.md)]

サービス環境は、電子請求サービスで処理されるグローバリゼーション機能および対応ドキュメントをサポートするために作成される論理パーティションです。 セキュリティ シークレットやデジタル証明書、アクセス許可 (ガバナンス) は、サービス環境レベルで構成する必要があります。

必要な数のサービス環境を作成できます。 作成するすべてのサービス環境は互いに独立しています。 ベスト プラクティスとして、少なくとも 2 つのサービス環境を作成することをお勧めします:

- 主に開発と検証を目的とした 1 つの環境。 通常、この環境はユーザー受け入れテスト (UAT) 環境です。
- 運用目的の 1 つの環境。 通常、この環境は運用環境です。

このタイプのパーティション分割により、電子請求プロセスが運用に移行する前に、サンドボックスで検証およびカスタマイズされます。

サービス環境は、Regulatory Configuration Service (RCS) で作成および管理する必要があります。 準備が整い次第、電子請求サービスに公開する必要があります。 公開プロセスは、サービス環境のパラメーターを RCS インスタンスから電子請求サービスに送信します。

新しいサービス環境を作成したり、既存のサービス環境を調整 (例えば、ユーザーや Microsoft Azure Key Vault シークレットを追加または削除するなど) したりした後に公開プロセスを完了しないと、変更は有効になりません。 公開された環境のみが、Dynamics 365 Finance および Dynamics 365 Supply Chain Management からアクセスできます。

## <a name="service-environment-statuses"></a>サービス環境のステータス

サービス環境は、ステータスで管理できます。 **サービス環境** ページで環境のステータスを表示できます。 次のステータスがあります:

- **未公開** - 環境は作成済ですが、まだ公開されていません。
- **公開済** - 環境が電子請求サービスに公開されました。
- **変更済** - 公開された環境の属性は変更されましたが、まだ公開されていません。

## <a name="users"></a>ユーザー

各サービス環境では、Finance または Supply Chain Management から電子請求に接続できるユーザーを一覧表示する必要があります。

## <a name="applications"></a>アプリケーション

場合によっては、Finance または Supply Chain Management 以外のアプリケーションが、電子請求サービスに接続して、さらに処理するために電子ドキュメントを送信したり、ドキュメントの送信ステータスなどの情報を取得する必要がある場合があります。 これらのシナリオでは、アプリケーションをアプリケーションの一覧で定義する必要があります。 このようにして、電子請求サービスにアクセスできます。 また、アプリケーションを Azure Active Directory (Azure AD) でアプリケーションとして登録し、オブジェクト ID を使用して識別する必要があります。 

Microsoft では、電子請求サービスに接続できるアプリケーションに対する高いレベルのセキュリティ制御が必要なので、Microsoft (<DGXRegulatoryservicesengineering@service.microsoft.com>) に連絡してアプリケーションに関する次の詳細情報を提供する必要があります:

- Azure AD テナント ID
- Microsoft Dynamics Lifecycle Services (LCS) 環境 ID
- アプリケーション ID (クライアント ID)
- オブジェクト ID
- アプリケーションの正当性と高レベルの説明

Microsoft は、要求を評価し、アプリケーションをセキュリティ レジスターに登録し、電子請求で処理できることを確認します。

## <a name="number-sequences"></a>番号順序

シナリオで番号シーケンス (例えば、ファイル名) が必要な場合は、特定の環境向けに定義された番号シーケンスを使用できますが、グローバリゼーション機能全体または特定のグローバリゼーション機能のいずれかでも使用できます。 番号シーケンスを定義すると、変数および処理パイプラインで使用できます。 その使用を追跡するには、**番号シーケンス** ページで **In use** パラメーターの **Current** の値を探します。

### <a name="working-with-number-sequences"></a>番号シーケンスの使用
**番号シーケンス** ページで: 

- **新規** を選択して、番号シーケンスを作成します。 次に、名前と説明を入力します。 
- 番号シーケンスが使用されていない場合は、**削除** を選択して削除します。
- アクション ペインで **公開** を選択して、変更を番号シーケンスに公開する必要はありません。 更新は自動的に実行されます。

## <a name="create-a-key-vault-reference"></a>Key Vault 参照を作成する

1. RCS アカウントにサインインします。
2. **グローバリゼーション機能** ワークスペースの **環境t** セクションで、**電子請求** タイルを選択します。
3. **環境の設定** ページのアクション ペインで、**サービス環境** を選択します。
4. **サービス環境** ページのアクション ペインで、**Key Vault パラメーター** を選択します。
5. **Key Vault パラメーター** ページで **新規** を選択して、Key Vault 参照を作成します。
6. **名前** フィールドに Key Vault 参照の名前を入力します。
7. **説明** フィールドに説明を入力します。
8. **Key Vault URI** フィールドで、キー コンテナー (`https://<your key vault>.vault.azure.net/`) から Key Vault URI を貼り付けます。 詳細については、[Azure ポータルで Azure Key Vault を作成する](e-invoicing-create-azure-key-vault-azure-portal.md) を参照してください。
9. **保存** を選択します。
    
## <a name="create-a-secret-for-the-storage-account-secret-token"></a>ストレージ アカウントのシークレット トークンにシークレットを作成する

1. **Key Vault パラメーター** ページで、前の手順で作成した Key Vault 参照を選択してから、**証明書** セクションで **追加** を選択します。
2. **名前** フィールドに、ストレージ アカウント シークレットの名前を入力します。 この名前は、ストレージの Shared Access Signature (SAS) トークンを保持する Key Vault シークレットの名前と一致する必要があります。 詳細については、[Azure ポータルで Azure ストレージ アカウントを作成する](e-invoicing-create-azure-storage-account-azure-portal.md) を参照してください。 
3. **説明** フィールドに説明を入力します。
4. **タイプ** フィールドで、**シークレット** を選択します。
5. **保存** を選択します。
    
## <a name="create-a-service-environment"></a>サービス環境の作成

1. **サービス環境** ページで **新規** を選択し、サービス環境を作成します。
2. **名前** フィールドに、電子請求環境の名前を入力します。
3. **説明** フィールドに説明を入力します。
4. **ストレージ SAS トークンのシークレット** フィールドで、ストレージ アカウントへのアクセス認証に使用する必要のあるストレージ アカウント シークレットの名前を選択します。
5. **ユーザー** セクションで、**追加** を選択し、環境を通じて電子請求書を送信し、ストレージ アカウントに接続できるユーザーを追加します。
6. **ユーザーID** フィールドに、ユーザーのエイリアスを入力します。 
7. **メール** フィールドに、ユーザーのメール アドレスを入力します。
8. **保存** を選択します。
9. アクション ペインで **公開** を選択して、環境を電子請求サービスに公開します。 **ステータス** フィールドの値が **公開済** に変更されたことを確認します。
