---
title: 財務仕訳帳の既定の財務分析コード
description: このトピックでは、財務仕訳帳に入力される取引において、財務分析コードの値がどのように設定されるかを定義するルールについて説明します。 また、固定分析コードが使用されるシナリオについても取り上げます。
author: kweekley
ms.date: 09/04/2021
ms.topic: index-page
ms.prod: ''
ms.technology: ''
ms.search.form: LedgerJournalTransDaily, LedgerJournalTransVendInvoice, LedgerJournalTransVendPaym, LedgerJournalTransCustPaym
audience: Application User
ms.reviewer: roschlom
ms.search.region: Global
ms.author: kweekley
ms.search.validFrom: 2020-12-14
ms.dyn365.ops.version: 10.0.17
ms.openlocfilehash: 327bc27f068e1f9eefacc6b5defa27044cb1a77e
ms.sourcegitcommit: d420b96d37093c26f0e99c548f036eb49a15ec30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/03/2021
ms.locfileid: "7472535"
---
# <a name="default-financial-dimensions-on-financial-journals"></a>財務仕訳帳の既定の財務分析コード

[!include [banner](../includes/banner.md)]

このトピックでは、財務仕訳帳に入力される取引で、財務分析コードの値がどのように設定されるかを定義するルールについて説明します (在庫仕訳帳とプロジェクト仕訳帳は除きます)。 また、固定分析コードが使用されるシナリオについても取り上げます。

## <a name="symptom"></a>現象

財務仕訳帳の勘定または相手勘定で、財務分析コード値が期待通りに設定されていません。 次に 2 つのサンプル シナリオを示します。

伝票は、仕訳帳の一般仕訳帳に入力されます。 この勘定は仕入先勘定で、相手勘定は銀行口座です。 仕入先の財務分析コードは既定で勘定に入力されますが、銀行の財務分析コードは既定では相手勘定に入力されません。 代わりに、勘定の分析コード値が既定で相手勘定に入力されます。

顧客には既定の財務分析コード値が割り当てられており、収益主勘定では部門の財務分析コードに固定分析コード値が割り当てられています。 伝票は一般仕訳帳に入力されます。  この勘定は顧客で、相手勘定は勘定科目 (具体的には固定分析コードを持つ収益勘定) です。 固定分析コードは、収益主勘定の相手勘定には設定されていません。 代わりに、顧客から取得された勘定の部門分析コード値に設定されます。  伝票を転記すると、転記された勘定項目では固定分析コード値が使用されますが、伝票では収益勘定に顧客の部門値が常に表示されます。 

仕訳帳内の伝票に設定されている財務分析コードには、どのようなルールが適用されますか?

## <a name="resolution"></a>解決策

既定では、一般仕訳帳や仕入先請求仕訳帳などの財務仕訳帳内で伝票の明細行に財務分析コードを入力する際には、次のルールが適用されます。 

1. **仕訳帳ヘッダー**

   - 既定では、仕訳帳ヘッダー分析コードは仕訳帳名分析コードから入力されます。

2. **仕訳帳明細行の勘定**

   - 既定では、仕訳帳明細行の勘定分析コードは仕訳帳ヘッダー分析コードから入力されます。
   - 空白の財務分析コードがある場合、顧客、仕入先、銀行、固定資産、プロジェクト、または元帳の分析コードが既定で入力されます。

     - 勘定タイプが **元帳** の場合、取引の入力中は勘定科目の固定分析コードが既定の分析コードとして使用されます。
     - 勘定タイプが **顧客**、**仕入先**、**銀行**、**固定資産**、または **プロジェクト** の場合、主勘定はまだ決定できません。 したがって、勘定に固定分析コードが既定で入力されることはありません。

3. **仕訳帳明細行の相手勘定**

 - まず、仕訳帳明細行の相手勘定分析コードには、既定で仕訳帳明細行の勘定分析コードが入力されます。

 - 空白の財務分析コードがある場合、次に既定エントリとして使用されるのは顧客、仕入先、銀行、固定資産、プロジェクト、または元帳の既定の分析コードです。
   1. 相手勘定タイプが **元帳** の場合、取引の入力中は勘定科目の固定分析コードが既定の分析コードとして使用されます。 分析コード値が既定で勘定から入力済みの場合、主勘定の既定/固定の分析コード値によって既存の値が上書きされることはありません。
   2. 相手勘定タイプが **顧客**、**仕入先**、**銀行**、**固定資産**、または **プロジェクト** の場合、主勘定がまだ不明のため固定分析コードが相手勘定から既定で設定されることはありません。

4. **転記**

    1. 転記中に、(勘定と相手勘定の両方について) 勘定項目の各行の主勘定に固定分析コードがあるかどうかが評価されます。 固定分析コードが定義されている場合、その固定分析コード値は既存の値または空白の値に置き換えられます。

        転記後には、固定分析コード値は仕分帳明細行に表示され **ません**。 代わりに、転記後に伝票を表示したときに勘定項目上に表示されます。

    2. 転記中に他の分析コード値が既定で入力されることはありません。小額丸め勘定や会社間の貸借勘定といった、転記中に追加される可能性のある勘定科目も同様です。 他の勘定科目で使用される既定の分析コード エントリは、勘定または相手勘定から取得されます。

分析コード値を既定で入力する目的で、仕訳帳の既定のプロセスでは空白の分析コード値が意図的に空白にされているのか、あるいは既定のエントリが作成されなかったのかを判別することができません。 分析コード値が意図的に空白のままされている場合でも、上で説明した既定値設定の順序にしたがって既定値が設定されることがあります。 分析コードに空白の値を設定する必要がある場合は、空の分析コードの代わりに使用されるように、値が **0** (ゼロ) または **空白** の分析コードを作成する必要が生じることがあります。

財務分析コードの既定値設定の順序の例として、次のシナリオをご確認ください。

### <a name="scenario-1"></a>シナリオ 1

**一般会計 \> 仕分帳の設定 \> 仕訳帳の名前** に移動し、仕訳帳名 **GenJrn** を選択します。 次に、**財務分析コード** クイックタブで、既定の財務分析コードに次の値を定義します。

- **BUSINESSUNIT:** 001
- **DEPARTMENT:** 024

[![仕訳帳の名前ページ](./media/financial-dimension-defaulting-jrnl-names-01.png)](./media/financial-dimension-defaulting-jrnl-names-01.png)

**一般会計 \> 仕分け入力 \> 一般仕訳帳** に移動し、**GenJrn** という名前の新しい一般仕訳帳を作成します。 **財務分析コード** タブに示されているように、既定では分析コードは仕訳帳名 (LedgerJournalName テーブル) から仕訳帳ヘッダー (LedgerJournalTable テーブル) に入力されます。

[![[一般仕訳帳] ページの [財務分析コード] タブ](./media/financial-dimension-defaulting-genrl-jrnl-02.png)](./media/financial-dimension-defaulting-genrl-jrnl-02.png)

**明細行** に移動します。 **勘定タイプ** フィールドで **元帳** を選択し、**勘定** フィールドに **170150** と入力します。 次に、**タブ** キーを選択してフィールドから移動します。 既定では、仕訳帳ヘッダーから分析コードが入力されます。 したがって、**勘定** の値は **170150-001-024** と表示されます。

[![[仕訳伝票] ページの一般仕訳帳の仕訳帳明細行](./media/financial-dimension-defaulting-jrnl-vchr-03.png)](./media/financial-dimension-defaulting-jrnl-vchr-03.png)

**勘定** の値を **170150-001-023** に変更します。 借方金額と貸方金額のいずれかを入力します。 **相手勘定タイプ** フィールドで **元帳** を選択し、**相手勘定** フィールドに **600150** と入力します。 既定では、勘定から分析コード値が入力されます。 したがって、**相手勘定** の値は **600150-001-023** と表示されます。

### <a name="scenario-2"></a>シナリオ 2

シナリオ 1 で仕訳帳名に定義したものと同じ財務分析コードを使用します。 次に、**売掛金勘定 \> 顧客 \> すべての顧客** に移動して、顧客 US-001 の既定の財務分析コードを定義します。 顧客を選択して顧客の詳細を開きます。 **財務分析コード** タブの **BUSINESSUNIT** 分析コードの既定値 (**001**) を変更しないでください。 **COSTCENTER** 分析コードを追加し、値に **007** を入力します。

**GenJrn** という仕訳帳名を使用する新しい一般仕訳帳を作成します。 **財務分析コード** タブで、**BUSINESSUNIT** の既定値を **001** から **002** に変更します。

**明細行** に移動します。 **勘定タイプ** フィールドで **顧客** を選択し、**勘定** フィールドに **US-001** と入力します。 帳簿外の勘定タイプの財務分析コードを表示するには、**財務分析コード \> 勘定** を選択します。 財務分析コード値には次の既定のエントリが入力されます。

- **BUSINESSUNIT:** 002 – 既定のエントリは仕訳帳ヘッダーから取得されます。 既定値が入力済みのため、顧客 US-001 から **001** が既定で入力されることはありません。
- **COSTCENTER:** 007 – 既定のエントリは、顧客 US-001 の設定から取得されます。
- **DEPARTMENT:** 024 – 既定のエントリは仕訳帳ヘッダーから取得されます。

明細行に戻り、**相手勘定タイプ** で **元帳** を選択し、**相手勘定** フィールドに **600150** と入力します。 明細行には次のような既定の財務分析コード値が入力されます。

- **BUSINESSUNIT:** 002 – 既定のエントリは、勘定の財務分析コードから取得されます。 (最初は、仕訳帳ヘッダーの値が既定で入力されていました。)
- **DEPARTMENT:** 024 – 既定のエントリは、勘定の財務分析コードから取得されます。 (最初は、仕訳帳ヘッダーの値が既定で入力されていました。)
- **COSTCENTER:** 007 – 既定のエントリは、勘定の財務分析コードから取得されます。 (最初は、顧客の値が既定で入力されていました。)

### <a name="scenario-3"></a>シナリオ 3

シナリオ 2 で使用したものと同じ仕訳帳に、新しい明細行を追加します。 **勘定タイプ** フィールドで **元帳** を選択し、**勘定** フィールドに **170150** と入力します。 既定の分析コード値を消去して、主勘定の 170150 だけを残します。 **相手勘定タイプ** フィールドで **顧客** を選択し、**相手勘定** フィールドに **US-001** と入力します。 財務分析コード値には次の既定のエントリが入力されます。

- **BUSINESSUNIT:** 002 – 勘定の分析コード値が空白であるため、既定のエントリは仕訳帳ヘッダーから取得されます。 既定値が仕訳帳ヘッダーから取得済みのため、顧客 US-001 から **001** が既定で入力されることはありません。 **BUSINESSUNIT** の値を意図的に空白にした場合は、相手勘定の財務分析コードも削除する必要があります。
- **COSTCENTER:** 007 – 勘定の財務分析コード値と仕訳帳ヘッダーの分析コード値が空白であるため、既定のエントリは顧客 US-001 から取得されます。 **COSTCENTER** の値を意図的に空白にした場合は、相手勘定の財務分析コードも削除する必要があります。
- **DEPARTMENT:** 024 – 勘定の分析コード値が空白であるため、既定のエントリは仕訳帳ヘッダーから取得されます。 **DEPARTMENT** の値を意図的に空白にした場合は、相手勘定の財務分析コードも削除する必要があります。

### <a name="scenario-4"></a>シナリオ 4

シナリオ 1 とシナリオ 2 で仕訳帳名と顧客に定義したものと同じ既定の財務分析コード値を使用します。 次に、主勘定 170150 の **BUSINESSUNIT** 財務分析コードに、固定分析コード値を定義します。 **一般会計 \> 勘定科目表 \> 勘定 \> 主勘定** に移動します。 **主勘定** フィールドで **170150** を選択して、**法人の上書き** タブの **追加** を選択します。 法人に **USMF** を選択し、**追加** を選択します。 そのレコードを選択して、**既定の分析コード** を選択します。 **BUSINESSUNIT** 分析コードを **固定値** に変更し、値として **003** を入力します。

**GenJrn** という仕訳帳名を使用する新しい一般仕訳帳を作成します。 **財務分析コード** タブで、既定の分析コード値をすべて削除します。

**明細行** に移動します。 **勘定タイプ** フィールドで **元帳** を選択し、**勘定** フィールドに **170150** と入力します。 次に、**タブ** キーを選択してフィールドから移動します。 勘定 170150 の主勘定設定を使用して、既定の分析コード値が入力されます。 したがって、**勘定** の値は **170150-003** と表示されます。

**勘定** の値を **170150-004** に変更します。 **仕訳帳の機能によって、固定分析コード値の変更が妨げられることはありません。** 借方金額と貸方金額のいずれかを入力します。 **相手勘定タイプ** フィールドで **元帳** を選択し、**相手勘定** フィールドに **170250** と入力します。 財務分析コード値 004 が勘定から既定値として入力されます。 次にドキュメントを転記します。 仕訳帳で、**伝票** を選択します。 転記時に **BUSINESSUNIT** の値が固定分析コード値 **003** に変更されている点に注意してください。

仕訳帳の伝票に戻ると、**BUSINESSUNIT** 分析コードに固定分析コード値が反映されて **いません**。 ここには、常に転記前の画面に表示されていた値が表示されます。 伝票に入力されたすべての値は、転記プロセスによって変更されることはありません。 転記時に変更されるのは、勘定項目だけです。

## <a name="developer-notes"></a>開発者向けのメモ

既定値設定プロセスのコードを確認したい開発者の方は、次の方法を確認してください。

- **LedgerJournalEngine.accountModified()** – このメソッドは、すべての仕訳帳で標準の (そして一部の仕訳帳タイプによってオーバーライドされる) 基本勘定分析コード値の既定値設定プロセスへのメイン エントリ ポイントです。
- **LedgerJournalEngine.offsetAccountModified()** – このメソッドは、相手勘定分析コードの既定値設定プロセスへのメイン エントリ ポイントです。
