---
title: 電子メッセージの設定
description: この記事では、電子メッセージ (EM) 機能の設定方法を説明します。
author: AdamTrukawka
ms.date: 11/18/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: atrukawk
ms.search.validFrom: 2021-06-23
ms.dyn365.ops.version: 8.0999999999999996
ms.openlocfilehash: 12beb1adbfa4e2f235c8a7c69e786d342c4a4f68
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2022
ms.locfileid: "9279305"
---
# <a name="set-up-electronic-messages"></a>電子メッセージの設定

[!include [banner](../includes/banner.md)]

**電子メッセージ** (EM) 機能は、さまざまなドキュメント タイプのさまざまな電子レポート処理を管理するのに役立ちます。 [対象国固有のレポート機能](electronic-messaging.md#country-specific-regulatory-features-supported-by-the-em-functionality) をサポートする複雑なシナリオの中には、電子メッセージが、多くのメッセージの状態、メッセージ項目の状態、アクション、追加フィールド、および実行可能なクラスを組み合わせて設定されているものがあります。 このようなシナリオでは、データ エンティティのパッケージをインポートすることができます。 これらのデータ エンティティのパッケージを使用する場合は、データ管理ツールを使用して法人にそれらをインポートする必要があります。 データ管理ツールの使用方法の詳細については、[データ管理](../../fin-ops-core/dev-itpro/data-entities/data-entities-data-packages.md)を参照してください。

データ エンティティのパッケージをインポートしない場合は、EM 機能を手動で設定することができます。 この場合は、次の要素を設定する必要があります。

- [番号順序](#sequences)
- [メッセージ項目タイプ](#types)
- [メッセージ項目の状態](#item)
- [メッセージ状態](#statuses)
- [追加フィールド](#additional)
- [実行可能なクラスの設定](#executable)
- [レコード アクションの設定](#populate)
- [複数の会社からのレコードの設定](#multiple-companies-populate)
- [Web アプリケーション](#applications)
- [Web サービスの設定](#settings)
- [メッセージ処理アクション](#actions)
- [電子メッセージの処理](#processing)

次のセクションでは、これらの各要素の詳細について説明します。

## <a name="number-sequences"></a><a id="sequences"></a>番号順序

メッセージおよびメッセージ項目両方の番号順序を設定します。 番号順序は、メッセージおよびメッセージ項目に自動的に番号を付けるために使用されます。 割り当てられた番号は、システム内のメッセージおよびメッセージ項目の固有 ID として使用されます。 電子メッセージの番号順序は、**一般会計** \> **元帳の設定** \> **一般会計パラメーター** で設定できます。

## <a name="message-item-types"></a><a id="types"></a>メッセージ項目タイプ

メッセージ項目タイプは、電子メッセージに使用されるレコードのタイプを識別します。 メッセージ項目タイプは、**税** \> **設定** \> **電子メッセージ** \> **メッセージ項目タイプ** で設定できます。

## <a name="message-item-statuses"></a><a id="item"></a>メッセージ項目の状態

メッセージ項目の状態は、設定している処理中のメッセージ項目に適用される状態を識別します。 メッセージ項目の状態は、**税** \> **設定** \> **電子メッセージ** \> **メッセージ項目の状態** で設定できます。

メッセージ項目の状態の **削除を許可** パラメーターは、**電子メッセージ** ページ、または **電子メッセージ項目** ページの、この状態のメッセージ項目を削除できるかどうかを定義します。

## <a name="message-statuses"></a><a id="statuses"></a>メッセージ状態

メッセージの処理で使用できるメッセージ状態を設定します。 メッセージの状態は、**税** \> **設定** \> **電子メッセージ** \> **メッセージの状態** で設定できます。

次のテーブルは、**メッセージの状態** ページのフィールドについて説明しています。

| フィールド名          | 説明 |
|---------------------|-------------|
| メッセージ状態      | メッセージの状態の固有の名前を入力します。 メッセージの状態は、あらゆる時点での電子メッセージの状態を特徴付けるために使用されます。 入力した名前は、**電子メッセージ** ページ、および電子メッセージに関連するログに表示されます。 |
| 説明         | メッセージの状態の説明を入力します。 |
| 応答タイプ       | メッセージの状態の応答タイプを選択します。 処理中のアクションは、1 つ以上の応答タイプを生成する可能性があります。 たとえば、**Web サービス** タイプのアクションは、実行の結果に応じて、**正常に実行されました** タイプ、または **技術エラー** タイプの応答を生成する可能性があります。 この場合、両方の応答タイプに対するメッセージの状態を定義します。 アクション タイプおよび関連する応答タイプに関する詳細については、後述の [アクション タイプを処理するメッセージ](#action-types) セクションを参照してください。 |
| メッセージ項目の状態 | 時には、電子メッセージの状態が関連するメッセージ項目の状態に影響を与えます。 このフィールドでメッセージ項目の状態を選択して、メッセージの状態と関連付けます。 |
| 削除の許可        | ユーザーが **電子メッセージ** ページでこの状態を持つ電子メッセージを削除できるようにする場合は、このチェックボックスを選択します。 |

## <a name="additional-fields"></a><a id="additional"></a>追加フィールド

EM 機能を使用すると、Microsoft Dynamics 365 Finance のトランザクション テーブルから、メッセージ項目としてレコードを収集できます。 この方法で、レポートのためにレコードを準備し、報告することができます。 ただし、トランザクション テーブルには、レポート要件を満たす方法でレコードに入力するための十分な情報がない場合があります。 レコードに対して報告する必要のあるすべての情報を記入するために、追加フィールドを設定することができます。 追加フィールドは、メッセージおよびメッセージ項目に関連付けることができます。 追加フィールドは、**税** \> **設定** \> **電子メッセージ** \> **追加フィールド** で設定できます。

次のテーブルは、**追加フィールド** ページの一般的なフィールドについて説明しています。

| フィールド       | 説明 |
|-------------|-------------|
| フィールド名  | プロセスに関連する、電子メッセージまたはメッセージ項目の追加フィールドの名前を入力します。 プロセスの作業中に、ユーザー インターフェイス (UI) にこの名前が表示されます。 プロセスに関連付けられている電子申告 (ER) コンフィギュレーションでも使用できます。 |
| 説明 | 追加フィールドの説明を入力します。 |
| ユーザーの編集   | ユーザーが UI で追加フィールドの値を変更できるようにする場合は、このオプションを **はい** に設定します。 |
| カウンター     | 追加フィールドが電子メッセージに番号順序を含めるようにする場合は、このオプションを **はい** に設定します。 追加フィールドの値は、**電子申告のエクスポート** タイプのアクションが実行する際に自動的に入力されます。 |
| 非表示      | **電子メッセージ** ページまたは **電子メッセージの項目** ページの UI で、追加のフィールドを非表示にする場合は、このオプションを **はい** に設定します。 |

**値** クイック タブでは、追加のフィールドに含められる値を事前に定義できます。 これらの値をユーザーが選択できます。 したがって、これらのデータは、処理時に手動で入力する必要はありません。 次の表でフィールドについて説明します。

| フィールド                | 説明 |
|----------------------|-------------|
| フィールド値          | 報告時にメッセージまたはメッセージ項目に使用するフィールドの値を入力します。 |
| 説明          | フィールドの値の説明を入力します。 |
| 勘定タイプ         | いくつかのフィールドの値は、特定の勘定タイプに限定される可能性があります。 次の値のいずれかを選択します。**すべて**、**顧客**、または **仕入先**。 |
| アカウント コード         | **勘定タイプ** フィールドで、**顧客** または **仕入先** を選択した場合は、フィールド値の使用を、特定のグルーブまたはテーブルに限定することができます。 |
| アカウント/グループ番号 | **勘定タイプ** フィールドで、**顧客** または **仕入先** を選択し、**アカウント コード** フィールドにグループもしくはテーブルを入力した場合は、このフィールドに特定のグループまたは窓口機関を入力することができます。 |
| 開始            | 値の考慮を開始する日付を指定します。 |
| 有効期限           | 値の考慮を停止する日付を指定します。 |

既定では、**アカウント/グループ番号**、**アカウント コード**、**有効**、および **有効期限** フィールドによって定義されている条件の組み合わせは、追加フィールドの値の選択に影響を与えません。 ただし、実行可能なクラスでこれらの組み合わせを使用して、追加フィールドの値を計算する特定のロジックを実装することができます。

## <a name="executable-class-settings"></a><a id="executable"></a>実行可能なクラスの設定

実行可能なクラスは、プロセスに対して何らかの評価が必要な場合に、アクションに関連して電子メッセージ処理が呼び出すことができる X++ メソッドまたはクラスです。

処理時に呼び出す必要がある実行可能なクラスを、**税** \> **設定** \> **電子メッセージ** \> **実行可能なクラス設定** で手動で設定できます。 **実行可能なクラス設定** ページで行を作成し、次のフィールドを設定します。

| フィールド                 | 説明 |
|-----------------------|-------------|
| 実行可能なクラス      | 関連してこのクラスが呼び出されるメッセージ処理アクションの設定中に使用される名前を入力します。 |
| 説明           | 実行可能なクラスの説明を入力します。 |
| 実行可能なクラス名 | X++ 実行可能なクラスを選択します。 |
| 実行レベル       | このフィールドは、選択された実行可能なクラスに対して値が事前に定義されているため、自動的に設定されます。 このフィールドは、関連する評価が実行されるレベルを制限します。 |
| クラスの説明     | このフィールドは、選択された実行可能なクラスに対して値が事前に定義されているため、自動的に設定されます。 |
| アクション タイプ           | このフィールドは、**機能管理** ワークスペースで、**\[EM\] の実行可能なクラスのアクション タイプ** 機能が有効になっている場合に使用できます。 実行可能なクラスのアクション タイプを指定するには、このフィールドを使用します。 このフィールドにより、**電子メッセージ** ページの電子メッセージに使用できる次のアクションを詳細に制御できます。 |

一部の実行可能なクラスには、実行可能なクラスを初めて実行する前に定義する必要のある必須パラメーターがあります。 これらのパラメーターを定義するには、アクション ペインで **パラメーター** を選択します。 表示されるダイアログ ボックスで、フィールドを設定し、**OK** を選択します。 **OK** を選択することが重要です。 そうしないなら、パラメーターはデータベースに保存されず、実行可能なクラスは正しく呼び出されません。

## <a name="populate-records-actions"></a><a id="populate"></a>レコード アクションの設定

メッセージ項目テーブルにレコードを追加してそれを電子メッセージに追加するアクションを設定するためには、レコード アクションの設定を使用します。 たとえば、電子メッセージで顧客請求書を報告する必要がある場合、顧客請求書仕訳帳テーブルの **データ ソース** フィールドにリンクされているレコード アクションの設定を設定する必要があります。

レコード アクションの設定は、**税** \> **設定** \> **電子メッセージ** \> **レコード アクションの設定** で行うことができます。 レコードをテーブルに追加するすべてのアクションに対して新しいレコードを作成し、次のフィールドを設定します。

| フィールド       | 説明 |
|-------------|-------------|
| 氏名        | プロセスでレコードに入力するアクションの名前を入力します。 |
| 説明 | レコード アクションの設定の説明を入力します。 |

**データ ソースの設定** クイック タブでは、プロセスに使用されるすべてのデータ ソースの行を追加し、次のフィールドを設定します。

| フィールド                  | 説明 |
|------------------------|-------------|
| 氏名                   | データ ソース名を入力します。 |
| メッセージ項目タイプ      | データ ソースのレコードを作成するときに使用するメッセージ項目のタイプを選択します。 |
| 勘定タイプ           | データ ソースのレコードに関連付ける勘定タイプを選択します。 |
| マスター テーブル名      | データ ソースにするテーブルを選択します。 |
| ドキュメント番号フィールド  | ドキュメント番号を取得するフィールドを、選択したテーブルから選択します。 このフィールドの値は、メッセージ項目の **文書番号** フィールドの値として使用されます。 |
| ドキュメントの日付フィールド    | ドキュメントの日付を取得するフィールドを、選択したマスター テーブルから選択します。 このフィールドの値は、メッセージ項目の **メッセージ項目の日付** フィールドの値として使用されます。 |
| ドキュメント アカウント フィールド | ドキュメント アカウントを取得するフィールドを、選択したマスター テーブルから選択します。 このフィールドの値は、メッセージ項目の **アカウント番号** フィールドの値として使用されます。 |
| 法人                | このフィールドは、**レコード アクションの設定の会社間クエリ** 機能が、**機能管理** ワークスペースで有効になっている場合に使用できます。 レコード アクションの設定の会社間データ ソースを設定するには、この機能を使用します。 データは複数の会社から取得できます。 |
| ユーザー クエリ             | <p>グリッドの上で **クエリの編集** を選択してクエリを設定する場合に、選択したマスター テーブルに適用するデータ入力の基準を指定すると、このチェックボックスが自動的にオンになります。 それ以外の場合は、すべてのレコードが選択されたマスター データ ソースから入力されます。</p><p>**レコード アクション設定の会社間クエリ** 機能が **機能管理** ワークスペースで有効になっており、複数の会社からレコードを収集する必要がある場合、レポートに含める必要がある追加の法人ごとに行を追加します。 新しい行ごとに、**クエリの編集** を選択し、その行の **会社** フィールドで指定された法人に固有の関連基準を指定します。 完了すると、レポートに含める必要があるすべての法人の行が **Datasources 設定** グリッドに表示されます。</p> |

## <a name="populate-records-from-multiple-companies"></a><a id="multiple-companies-populate"></a>複数の会社からのレコードの設定

会社が同じ Finance データベース内の複数の法人からレポートする必要がある場合は、レポートにデータを含める必要があるすべての法人に [レコード アクションの設定](#populate) を設定します。

Finance 環境でこの機能を有効にするには、以下の手順を実行します。 

1. **ワークスペース** \> **機能管理** に移動します。
2. リストの **レコード アクション設定の会社間クエリ** 機能を検索して選択します。
3. **直ちに有効化** を選択します。 

レポートにデータを含める必要がある複数の会社の [レコード アクションの設定](#populate) を設定するには、次の手順に従います。

1. **税** \> **設定** \> **電子メッセージ** \> **レコード アクションの設定** に移動します。

    **レコード アクション設定の会社間クエリ** 機能を有効にすると、**レコード アクションの設定** ページの **データ ソースの設定** グリッドに **会社** フィールドが表示されます。 [レコード アクションの設定](#populate) の全般的な設定時に作成された既存のレコードの場合、このフィールドには現在の法人の ID が表示されます。

2. **データ ソースの設定** グリッドで、レポートに含める必要がある各関連法人の行を追加し、次のフィールドを設定します。

    | フィールド名             | 値 |
    |------------------------|-------|
    | Name                   | このレコードの取得元を理解するのに役立つテキスト値を入力します。 例えば、**データ ソース名 - 関連会社 1** を入力します。 |
    | メッセージ項目タイプ      | EM 処理に必要なメッセージ品目タイプを選択します。 |
    | 勘定タイプ           | EM 処理に必要な勘定タイプを選択します。 EM処理に特定の勘定タイプがない場合は、**すべて** を選択します。 |
    | マスター テーブル名      | EM 処理に必要なマスター テーブルの名前を指定します。 |
    | ドキュメント番号フィールド  | EM 処理のレコード内のドキュメント番号を含むフィールドを指定します。 |
    | ドキュメントの日付フィールド    | EM 処理のレコード内のドキュメントの日付を含むフィールドを指定します。 |
    | ドキュメント アカウント フィールド | EM 処理のレコード内のドキュメント アカウントを含むフィールドを指定します。 |
    | 会社                | 関連法人の ID を選択します。 |
    | ユーザー クエリ             | **クエリの編集** を選択して基準を定義すると、このチェック ボックス が自動的に選択されます。 |

3. 新しい行ごとに **クエリの編集** を選択し、その行の **会社** フィールドで指定した法人に関連基準を指定します。

## <a name="web-applications"></a><a id="applications"></a>Web アプリケーション

Web アプリケーション設定を使用して、Open Authorization (OAuth) 2.0 をサポートするように Web アプリケーションを設定します。 OAuth は、ユーザーが自分のアクセス資格情報を共有することなく、自分に代わって「安全な委任アクセス」をアプリケーションに付与できるようにするオープン標準です。 認証コードおよびアクセス トークンを取得することによって、認証プロセスを進めることもできます。 **税** \> **設定** \> **電子メッセージ** \> **Web アプリケーション** で、Web アプリケーションの設定を行うことができます。

次のテーブルは、**Web アプリケーション** ページのフィールドについて説明しています。

| フィールド                        | 説明 |
|------------------------------|-------------|
| アプリケーション名             | Web アプリケーションの名前を入力します。 |
| 説明                  | Web アプリケーションの説明を入力します。 |
| 基準 URL                     | Web アプリケーションのベース インターネット アドレスを入力します。 |
| 認証 URL パス       | 認証用の URL を作成するために使用するパスを指定します。 |
| トークン URL パス               | トークン用 URL を作成するために使用するパスを指定します。 |
| リダイレクト URL                 | リダイレクト URL を入力します。 |
| クライアント ID                    | Web アプリケーションのクライアント ID を入力します。 |
| クライアント シークレット                | Web アプリケーションのクライアント シークレットを入力します。 |
| サーバー トークン                 | Web アプリケーションのサーバー トークンを入力します。 |
| 認証形式マッピング | 認証の要求を生成するために使用する ER 形式を選択します。 |
| インポート トークン モデル マッピング   | アクセス トークンを保存するために使用する ER インポート モデル マッピングを選択します。 |
| 許可済のスコープ                | アプリケーションへの要求に対して付与されるスコープ。 このフィールドは、自動的に更新されます。 |
| アクセス トークンの有効期限:  | アクセス トークンの有効期限が切れるまでの残り時間。 このフィールドは、自動的に更新されます。 | 
| 適用                       | Web 要求の **受け入れ** プロパティを指定します。 たとえば、**application/vnd.hmrc.1.0+json** と入力します。 |
| コンテンツ タイプ                 | コンテンツ タイプを指定します。 たとえば、**application/json** と入力します。 |

さらに、認証プロセスをサポートするために、**Web アプリケーション** ページのアクション ウィンドウで次のボタンが利用できます:

- **認証コードを取得** ー Web アプリケーションの認証を初期化します。 この機能では、**認証形式のマッピング** フィールドで指定された ER 形式を使用 して、認証要求が生成されます。
- **アクセス トークンを取得** ー アクセス トークンの取得のプロセスを初期化します。
- **アクセス トークンを更新** ー アクセス トークンを更新します。 この機能は、**インポート トークン モデル マッピング** フィールドで指定された ER 形式を使用して、受信したアクセス トークンに関する情報をインポートします。

Web アプリケーションへのアクセス トークンが暗号化された形式でシステムのデータベースに保存されている場合、Web サービスへの要求に使用することができます。 セキュリティの目的のため、トークンへのアクセスは要求に対処するよう許可されているセキュリティ ロールのみに限定する必要があります。 セキュリティ グループの外部から要求に対処しようとすると、選択した Web アプリケーションを使用した相互運用が許可されていないことを示すエラーが表示されます。 アクセス トークンにアクセスできるセキュリティ ロールを設定するには、**Web アプリケーション** ページの **セキュリティ ロール** クイック タブを使用します。 Web アプリケーションに対してセキュリティ ロールが定義されていない場合、システム管理者のみがこの Web アプリケーションを使用して相互運用することができます。

選択した Web アプリケーションを含む各アクションについて、**アクション ログ** クイック タブには、ユーザーおよび日時に関する情報が保存されます。

一部の Web サービスでは、要求に異なるヘッダーを含める必要があります。 システム管理者は、追加のヘッダーとその値を **追加ヘッダー** クイック タブで設定し、要求の生成中にそれらを使用できます。

## <a name="web-service-settings"></a><a id="settings"></a>Web サービスの設定

Web サービス設定を使用して、Web サービスへの直接のデータ送信を設定します。 Web サービスの設定は、**税** \> **設定** \> **電子メッセージ** \> **Web サービスの設定** で行うことができます。

次のテーブルは、**Web サービスの設定** ページのフィールドについて説明しています。

| フィールド                          | 説明 |
|--------------------------------|-------------|
| Web サービス                    | Web サービスの名前を入力します。 |
| 説明                    | Web サービスの説明を入力します。 |
| インターネット アドレス               | <p>Web サービスのインターネット アドレスを入力します。 Web アプリケーションが Web サービスに指定されていて、Web サービスのインターネット アドレスをその Web アプリケーションに対して定義されたのと同じものにする場合、**ベース URL をコピー** ボタンを選択します。 Web アプリケーションのベース URL がこのフィールドにコピーされます。</p><p>**警告:** ここで構成するサード パーティのサービスやその他のサービスは、証明書を必要とせず、Microsoft のプライバシー基準を満たしていない可能性があります。 各サービスのプライバシーに関するドキュメントを確認し、各サービス プロバイダと共にサービスが提供するコンプライアンスのレベルの詳細を確認する必要があります。 これらのサービスがセキュリティ、プライバシー、および法的基準を満たしていることを確認する責任はお客様にあります。 サービスの使用に関するリスクは、お客様が負うものとします。 Microsoft は明示的な担保、保証、条件を提示しません。 HTTPS などのセキュリティで保護され、認証された接続を提供するサービスのみを使用することを強く推奨します。</p> |
| 証明書                    | 以前に設定した Azure Key Vault 証明書を選択します。 |
| Web アプリケーション                | 以前に設定した Web アプリケーションを選択します。 |
| 応答タイプ - XML        | 応答タイプが XML の場合、このオプションを **はい** に設定します。 |
| 要求メソッド                 | 要求されたメソッドを指定します。 HTTPは、特定のリソースに対して実行されるアクションを示す要求メソッドのセットを定義します。 要求メソッドは、**GET**、**POST**、または別の HTTP メソッドにすることができます。 |
| 要求ヘッダー                | 要求ヘッダーを指定する。 要求ヘッダーは、HTTP 要求で使用できる HTTP ヘッダーです。 メッセージの内容とは関連しません。 |
| 適用                         | Web 要求の受け入れプロパティを指定します。 |
| エンコードの承諾                | Accept-Encoding 値を指定します。 Accept-Encoding 要求 HTTP ヘッダーは、クライアントが理解できるコンテンツのエンコードを通知します。 このコンテンツ エンコードは、通常、圧縮アルゴリズムです。 |
| コンテンツ タイプ                   | コンテンツ タイプを指定します。 Content-Type エンティティ HTTP ヘッダーは、リソースのメディア タイプを示します。 |
| 正常な応答コード       | 要求が成功したことを示す HTTP 状態コードを指定します。 |
| 要求ヘッダー形式マッピング | Web 要求ヘッダーを生成するために使用される ER 形式を選択します。 |

## <a name="message-processing-actions"></a><a id="actions"></a>メッセージ処理アクション

メッセージ処理アクションを使用して処理のアクションを作成し、そのパラメーターを設定します。 メッセージ処理アクションの設定は、**税** \> **設定** \> **電子メッセージ** \> **メッセージ処理アクション** で行うことができます。

次のテーブルで、**メッセージ処理のアクション** ページでフィールドについて説明します。

### <a name="general-fasttab"></a>全般クイック タブ

| フィールド                                     | 説明 |
|-------------------------------------------|-------------|
| アクション タイプ                               | アクションのタイプを選択します。 使用可能なオプションの詳細については、後述する [メッセージ処理のアクションのタイプ](#action-types) セクションを参照してください。 |
| 形式マッピング                            | アクションに呼び出される ER フォーマットを選択します。 このフィールドは、**電子申告のエクスポート**、**電子申告のインポート** および **電子申告のエクスポート メッセージ** タイプのアクションにのみ使用できます。 |
| URL パスの形式マッピング               | アクションに呼び出される ER フォーマットを選択します。 この形式は、選択した Web サーバーに対して指定されているベース インターネット アドレスに追加される URL アドレスのパスを作成するために使用します。 このフィールドは、**Web サービス** タイプのアクションにのみ使用できます。 |
| メッセージ項目タイプ                         | アクションを評価するレコードのタイプを選択します。 このフィールドは、**メッセージ項目実行レベル**、**電子申告のエクスポート**、**電子申告のインポート**、**Web サービス** の各タイプや、他のタイプのアクションに使用できます。 このフィールドを空白のままにすると、メッセージの処理に定義されたすべてのメッセージ項目タイプが評価されます。 |
| 実行可能なクラス                          | 既存の実行可能なクラス設定を選択します。 このフィールドは、**メッセージ項目実行レベル** および **メッセージ項目実行レベル** タイプのアクションにのみ使用できます。 |
| レコード アクションの設定                   | レコード アクションを設定する既存のデータを選択します。 このフィールドは、**レコードの設定** タイプのアクションにのみ使用できます。 |
| Web サービス                               | 既存の Web サービスを選択します。 このフィールドは、**Web サービス** タイプのアクションにのみ使用できます。 |
| 送信するファイル名                         | このアクションで送信する必要がある電子メッセージの添付ファイル名を入力します。 複数の添付ファイルの元のファイル名が同じ場合は、最新の添付ファイルが送信されます。 指定した元のファイル名を持つ添付ファイルが見つからない場合、要求はコンテンツなしで送信されます。 このフィールドは、**Web サービス** タイプのアクションにのみ使用できます。 |
| ファイル名                                 | アクションの結果となるファイルの名前を指定します。 このファイルは、Web サーバーからの応答または生成されるレポートです。 このフィールドは、**Web サービス** および **電子申告のエクスポート メッセージ** タイプのアクションにのみ使用できます。 |
| 元伝票にファイルの添付          | 生成したファイルを、参照するマスター テーブルの EM 項目のレコードに関連付ける場合は、このチェックボックスをオンにします。 このフィールドは、**電子申告のエクスポート** および **Web サービス** タイプのアクションにのみ使用できます。 |
| 出力アーカイブから項目にファイルを添付 | 出力アーカイブ ファイルから別の XML ファイルを展開し、対応する電子メッセージ項目に関連付ける場合は、このチェックボックスをオンにします。 このフィールドは、**電子申告のエクスポート** タイプのアクションにのみ使用できます。 |
| エクスポートあたりのメッセージ項目数        | 1 つのファイル (メッセージ) に含めるメッセージ項目の数に制限を指定します。 このフィールドは、**電子申告のエクスポート** タイプのアクションにのみ使用できます。 |
| ER ソースの使用                             | インポートに ER ソース パラメーターを使用する場合は、このチェックボックスをオンにします。 選択されていない場合は、電子メッセージの添付ファイルが使用されます。 このフィールドは、**電子申告のインポート** タイプのアクションにのみ使用できます。 |
| ダイアログの表示                               | レポート生成の前にユーザーにダイアログ ボックスを表示する必要がある場合、このオプションを **はい** に設定します。 このフィールドは、**電子申告のエクスポート メッセージ** タイプのアクションにのみ使用できます。 |

#### <a name="message-processing-action-types"></a><a id="action-types"></a>メッセージ処理アクション タイプ

**アクション タイプ** フィールドでは、次のオプションを使用できます。

- **メッセージを作成** – このアクションを使用して、ユーザーが **電子メッセージ** ページで手動でメッセージを作成できるようにします。 初期状態はこのタイプのアクションに設定できません。
- **レコードの設定** – このアクション タイプは既に設定されている必要があります。 レコードの設定アクションと関連付けて、アクションが処理に含まれるようにします。 このアクション タイプは (事前に電子メッセージが作成されていない場合) メッセージ処理の最初のアクションとして、または **メッセージの作成** アクションのタイプによって以前に作成されたメッセージにメッセージ項目を追加するアクションとして使用されるものとみなされます。 したがって、このタイプのアクションでは、結果状態はメッセージ項目に対してのみ設定できます。 初期状態はメッセージにのみ設定することができます。
- **メッセージの実行レベル** – このアクション タイプを使用して、メッセージ レベルで評価する必要がある実行可能なクラスを設定します。
- **メッセージ項目実行レベル** – このアクション タイプを使用して、メッセージ項目レベルで評価する必要がある実行可能なクラスを設定します。
- **電子申告のエクスポート** - このアクション タイプは、メッセージ項目レベルでエクスポート ER コンフィギュレーションに基づくレポートを生成するアクションに使用します。
- **電子申告のエクスポート メッセージ** – このアクション タイプは、メッセージ レベルでエクスポート ER コンフィギュレーションに基づくレポートを生成するアクションに使用します (たとえば、メッセージにメッセージ項目がない場合)。
- **電子申告のインポート** ー このアクション タイプは、インポート ER コンフィギュレーションに基づくレポートを生成するアクションに使用します。
- **メッセージ レベルのユーザーの処理** – このアクション タイプは、メッセージ レベルのユーザーによる何らかの手動操作を想定したアクションに使用します。 たとえば、ユーザーは、メッセージの状態を更新する場合があります。
- **ユーザーの処理** – このアクション タイプは、メッセージ項目レベルのユーザーによる何らかの手動操作を想定したアクションに使用します。 たとえば、ユーザーは、メッセージ項目の状態を更新する場合があります。
- **Web サービス** – このアクション タイプは、Web サービスに生成されたレポートを送信するアクションに使用します。 イタリアの購買および販売の請求書通信レポートには、このアクション タイプは使用されません。 このアクション タイプに対して、**メッセージ処理アクション** ページは確認テキストを指定できる **その他の詳細** クイック タブを含みます。 この確認テキストは、選択した Web サービスに対して要求が対処される前にユーザーに表示されます。
- **検証要求** – このアクション タイプは、サーバーからの検証要求に使用します。

### <a name="initial-statuses-fasttab"></a>初期状態 クイック タブ

> [!NOTE]
> **初期状態** クイック タブは、**メッセージの作成** の初期のアクション タイプを持つアクションでは使用できません。

| フィールド               | 説明 |
|---------------------|-------------|
| メッセージ項目の状態 | 選択されたメッセージ処理アクションを評価するメッセージ項目の状態を選択します。 |
| 説明         | 選択されたメッセージ項目の状態の説明。 |

### <a name="result-statuses-fasttab"></a>結果状態 クイック タブ

| フィールド               | 説明 |
|---------------------|-------------|
| メッセージ状態      | 選択されたメッセージ処理アクションを評価するメッセージ状態を選択します。 このフィールドは、メッセージ レベルで評価されるメッセージ処理アクションでのみ使用できます。 たとえば、**電子申告のエクスポート** および **電子申告のインポート** タイプのアクションには使用可能ですが、**ユーザー処理** および **メッセージ項目実行レベル** タイプのアクションには使用できません。 |
| 説明         | 選択されたメッセージ状態の説明。 |
| 応答タイプ       | 選択されたメッセージ状態の応答タイプ |
| メッセージ項目の状態 | 選択されたメッセージ処理アクションが評価された後で使用可能な結果状態を選択します。 このフィールドは、メッセージ項目レベルで評価されるメッセージ処理アクションでのみ使用できます。 たとえば、**ユーザー処理** および **メッセージ項目実行レベル** タイプのアクションで使用できます。 メッセージ レベルで評価されるメッセージ処理アクションの場合、このフィールドには、選択されたメッセージ状態に対して設定されたメッセージ項目の状態が表示されます。 |

次のテーブルでは、さまざまなアクション タイプおよび応答タイプに設定する必要がある結果状態を示します。

| 電子メッセージのアクション タイプ/応答タイプ | 正常に実行されました | ビジネス エラー | 技術エラー | ユーザー定義 | キャンセル |
|----------------------------------------------|-----------------------|----------------|-----------------|--------------|--------|
| メッセージの作成                               | x                     |                |                 |              |        |
| 電子申告のエクスポート                  | x                     |                |                 |              |        |
| 電子申告のインポート                  |                       |                |                 |              |        |
| Web サービス                                  | x                     |                | x               |              |        |
| ユーザー処理                              |                       |                |                 |              |        |
| メッセージ実行レベル                      |                       |                |                 |              |        |
| レコードの設定                             |                       |                |                 |              |        |
| メッセージ項目実行レベル                 |                       |                |                 |              |        |
| 要求の検証                         | x                     | x              | x               |              |        |
| 電子申告のエクスポート メッセージ          | x                     |                |                 |              |        |
| メッセージ レベルのユーザー処理                |                       |                |                 |              |        |

## <a name="electronic-message-processing"></a><a id="processing"></a>電子メッセージの処理

電子メッセージの処理は、EM 機能の基本概念です。 電子メッセージを評価するアクションを集計します。 アクションは、初期状態と結果状態を使用してリンクすることができます。 または、**ユーザー処理** タイプのアクションを個別に開始することもできます。 電子メッセージの処理を設定するには、**税** \> **設定** \> **電子メッセージ** \> **電子メッセージの処理** に移動します。

**アクション** クイック タブでは、定義済みのアクションを処理に追加することができます。 アクションを個別に実行する必要があるか、または処理によって開始できるかどうかを指定することができます。 処理のアクションをユーザーだけが初期化できるように指定するには、そのアクションの **個別に実行** フィールドを **はい** に設定します。 アクションの初期状態として定義された状態にあるメッセージまたはメッセージ項目の処理によってアクションを開始する必要がある場合、**個別に実行** フィールドを **いいえ** に設定します。 **ユーザー アクション** タイプのアクションは、常に個別でのみ実行する必要があります。

場合によっては、最初のアクションが個別に実行されるように設定されていても、いくつかのアクションをシーケンスに集約する必要があります。 たとえば、ユーザーはレポートの生成を初期化する必要があります。 たとえば、レポートが生成された直後にそれを Web サービスに送信し、Web サービスからの応答をシステムに反映する必要があります。 このようなケースでは、常に一緒に実行する必要があるアクションの非分解シーケンスを作成することができます。 **アクション** クイック タブで、グリッドの上にある **非分解シーケンス** を選択して、シーケンスを作成します。 次に、1 つのシーケンスとして実行する必要があるすべてのアクションに対して、**非分解シーケンス** フィールドのシーケンスを選択します。 この例の場合、シーケンスの最初のアクションでは **個別に実行** フィールドを **はい** に設定することができますが、他のすべてのアクションでは **いいえ** に設定します。

**電子レポート エクスポート** および **電子レポート エクスポート メッセージ** タイプのアクションは、入力パラメーターを持つ ER 形式を実行します。 電子メッセージ処理にこれらのタイプのいずれかのアクションが含まれる場合は、レポート生成の前に入力パラメーターの値を指定する必要があります。 これにより、システムはバッチ処理を使用してレポートを生成できます。 グリッド上の **パラメーター** を選択して、選択したアクション タイプ (**電子申告 エクスポート** または **電子申告 エクスポート メッセージ**) のパラメーターを設定できます。 バッチ処理で指定したパラメーターを使用して実行する必要があるアクションについて、**パラメーターを使用** チェックボックスをオンにします。

**メッセージ項目追加フィールド** クイック タブでは、メッセージ項目に関連する定義済み追加フィールドを追加することができます。 フィールドが関連するメッセージ項目のタイプごとに追加フィールドを追加する必要があります。 処理時に追加のフィールドに割り当てられる既定値を指定できます。

**メッセージ追加フィールド** クイック タブでは、メッセージに関連する定義済み追加フィールドを追加することができます。 処理時に追加のフィールドに割り当てられる既定値を指定できます。

**セキュリティ ロール** クイック タブでは、特定の処理のためのシステムで定義済みのセキュリティ ロールを設定することができます。 特定のロールを持つユーザーには、そのロールに対して定義されている処理のみが表示されます。

**バッチ** クイック タブでは、バッチ処理で実行する処理を設定できます。 アクション ペインで **処理の実行** を選択して処理を開始するときに、**電子メッセージ** または **電子メッセージ項目** ページで直接処理するためのバッチ処理を設定することをお勧めします。
