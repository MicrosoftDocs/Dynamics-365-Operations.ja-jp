---
title: 簡易 ER 形式を呼び出して Excel レポートを生成するよう設定し、処理を実行する
description: この記事では、電子メッセージを設定および使用する方法を示す例を提供します。
author: liza-golub
ms.date: 07/06/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: kfend
ms.custom: ''
ms.search.region: Global
ms.author: elgolu
ms.search.validFrom: 2021-06-24
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: 9894aabde854189e6fc1b6bb62051747f190e3ec
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/03/2022
ms.locfileid: "8904589"
---
# <a name="set-up-and-run-processing-to-call-a-simple-exporting-er-format-to-generate-an-excel-report"></a>簡易 ER 形式を呼び出して Excel レポートを生成するよう設定し、処理を実行する

[!include [banner](../includes/banner.md)]

ER 形式を作成してデータ ソースにマップし、完成させた後に、**電子申告** ワークスペースを使用してそれを実行できます。 レポートが生成された後、ローカルに保存することができます。

レポート処理の次の側面をコントロールするには、電子メッセージ処理を設定します。

- レポートの作成者に関するログ情報。
- レポートの作成日時に関するログ情報。
- 以前の期間に生成されたレポートを保存します。

次の例は、Microsoft Excel のエクスポート ER 形式に基づくレポートを生成するために電子メッセージを設定する方法を示します。 この例に従う場合は、Excel の ER エクスポート形式を作成し、データ ソースにマップし、完了している必要があります。 また、番号順序は既に電子メッセージに設定されている必要があります。

処理を構築するときは、設定する処理アクションと状態を最初に定義すると役立ちます。 次の図は、この例の処理を示しています。

![処理スキーム](media/processing-scheme.png)

## <a name="create-message-statuses"></a>メッセージ状態の作成

1. **税** \> **設定** \> **電子メッセージ** \> **メッセージの状態** に移動します。
2. 次のメッセージ状態を作成します。

    - 新規
    - 準備済
    - 生成済

    ![メッセージ状態](media/message-statuses.png)

3. **新しい** 状態の行で、**削除を許可** チェックボックスをオンにし、ユーザーがこの状態にあるメッセージを削除できるようにします。

## <a name="create-additional-fields"></a>追加フィールドの作成

1. **税** \> **設定** \> **電子メッセージ** \> **追加フィールド** に移動します。
2. 追加フィールドとその値を追加します。
3. **ユーザーの編集** オプションを **はい** に設定し、ユーザーがフィールドを編集できるようにします。

![追加フィールド](media/additional-fields.png)

## <a name="create-message-processing-actions"></a>メッセージ処理アクションの作成

この例では、次のメッセージ処理アクションを作成します。

- **メッセージの作成**
- **準備済に更新**
- **レポートの生成**
- **初期状態への更新** (オプション)

アクションを作成するには、これらの手順に従います。

1. **税** \> **設定** \> **電子メッセージ** \> **メッセージ処理アクション** に移動します。
2. **メッセージの作成** という名前の付いたアクションを作成します。 **一般** クイック タブの **アクション タイプ** フィールドで、**メッセージの作成** を選択します。
3. **準備済に更新** という名前の付いたアクションを作成し、次のフィールドを設定します。

    - **一般** クイック タブの **アクション タイプ** フィールドで、**メッセージ レベルのユーザー処理** を選択します。
    - **初期状態** クイック タブの **メッセージ状態** フィールドで、**新規** を選択します。
    - **結果状態** クイック タブの **メッセージ状態** フィールドで、**準備済** を選択します。 **応答タイプ** フィールドに、**正常に実行されました** と入力します。

4. **レポートの生成** という名前の付いたアクションを作成し、次のフィールドを設定します。

    - **一般** クイック タブの **アクション タイプ** フィールドで、**電子申告のエクスポート** を選択します。 **形式マッピング** フィールドで、エクスポート ER 形式を選択します。 オプションは、**Excel**、**XML**、**JSON**、**Text** および **Other** です。
    - **初期状態** クイック タブの **メッセージ状態** フィールドで、**準備済** を選択します。
    - **結果状態** クイック タブの **メッセージ状態** フィールドで、**生成済** を選択します。 **応答タイプ** フィールドに、**正常に実行されました** と入力します。

    ![レポート アクションの生成](media/generate-report-action.png)

5. オプション: ユーザーがレポートを複数回再生できるようにする場合は、**初期状態への更新** という名前のクションを作成し、次のフィールドを設定します。

    - **一般** クイック タブの **アクション タイプ** フィールドで、**メッセージ レベルのユーザー処理** を選択します。
    - **初期状態** クイック タブの **メッセージ状態** フィールドで、**生成済** を選択します。
    - **結果状態** クイック タブで、2 つのメッセージの状態ごとに個別の明細行を追加します (**準備済** および **新規**)。 両方の明細行に対して **応答タイプ** フィールドを **正常に実行されました** に設定します。

## <a name="electronic-message-processing"></a>電子メッセージの処理

この例では、すべてのアクションを個別に実行するように設定する必要があります。 ユーザーがすべてのアクションを初期化することを前提としています。

1. **税** \> **設定** \> **電子メッセージ** \> **電子メッセージの処理** に移動します。
2. 処理のためにレコードを追加し、すべての定義済のアクションおよび追加フィールドを追加します。
3. オプション: **セキュリティ ロール** クイック タブで、特定のレポートへのアクセスを限定する処理のセキュリティ ロールを定義します。
4. **税** \> **照会およびレポート** \> **電子メッセージ** \> **電子メッセージ** に移動します。
5. **新規** を選択してメッセージを作成します。 この時点で、日付と説明を追加できます。 追加フィールドの値を必要に応じて更新することもできます。

    ![電子メッセージの作成](media/create-electronic-message.png)

    **アクション ログ** のグリッドでは、クイック タブは、メッセージ上で実行されるすべてのアクションのログを自動的に入力します。

    メッセージ状態を削除または更新できるようになりました。 

6. メッセージ状態を更新するには、**状態の更新** を選択します。 **新しい状態** フィールドで **準備済** を選択してから、**OK** を選択します。

    ![メッセージ状態の更新](media/update-status.png)

    メッセージ状態が **準備済** に更新されます。

7. **レポートの生成** を選択してレポートを生成します。

    レポートが生成され、メッセージ状態およびアクションのログは更新されます。

8. 生成されたレポートを表示するには、ページの右上隅にある **添付ファイル** ボタン (紙クリップ記号) を選択します。

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
