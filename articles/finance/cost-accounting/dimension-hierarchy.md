---
title: 分析コード階層
description: このトピックでは、分析コード階層について説明します。 分析コード階層を使用して、原価会計のレポート構造、コスト ポリシー、およびセキュリティ設定を定義します。
author: AndersGirke
manager: AnnBe
ms.date: 06/16/2017
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: CAMDimensionHierarchy,
audience: Application User
ms.reviewer: roschlom
ms.search.scope: Core, Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: Manufacturing
ms.author: roschlom
ms.search.validFrom: 2016-11-30
ms.dyn365.ops.version: Version 1611
ms.openlocfilehash: 71ba02fc6be4ab9a7871c10a9f95c474e52ae765
ms.sourcegitcommit: 199848e78df5cb7c439b001bdbe1ece963593cdb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/13/2020
ms.locfileid: "4445104"
---
# <a name="dimension-hierarchy"></a>分析コード階層

[!include [banner](../includes/banner.md)]

このトピックでは、分析コード階層について説明します。 分析コード階層を使用して、原価会計のレポート構造、コスト ポリシー、およびセキュリティ設定を定義します。  

## <a name="overview"></a>概要

分析コード階層は、原価会計のさまざまな場所で使用します。 分析コード階層を使用して、次の情報を定義できます。

-  組織の要件に適合するレポート構造
-  コスト ポリシー
-  セキュリティ設定

分析コード階層の例を次に示します。

![分析コード階層の例](./media/dimension-hierarchy.png)

次のタイプの分析コードに対して分析コード階層を作成することができます。

-  原価要素分析コード
-  原価オブジェクト分析コード
-  統計分析コード

> [!NOTE]
> - 異なる分析視点が必要な場合は、同じ分析コードに対して複数の分析コード階層を作成できます。
> - 分析コード階層は、1 つの分析コードにのみ関連付けることができます。
> - 分析コード階層は構造内に無制限にレベルを持つことができます。 すべてのレベルは **原価管理** ワークスペースで使用可能です。 レポート用に Microsoft Excel または Microsoft Power BI を使用する場合は、分析コード階層の最初の 15 レベルのみがエクスポートされます。 この制限があるのは、Excel も Power BI も固定スキーマを必要とするためです。
> - 分析コード階層は、日付に対して有効ではありません。 このため、分析コード階層への変更は直ちにレコードに保存され、日付前と日付後を比較することはできません。

## <a name="dimension-hierarchy-type"></a>分析コード階層タイプ

新しい分析コード階層を作成する際には、階層タイプを選択する必要があります。 **原価会計** > **分析コード** > **分析コード階層** に移動します。 **新規** をクリックし、分析コード階層タイプを選択します。 **分析コード カテゴリ階層** または **分析コード分類階層** のいずれかを選択することができます。

### <a name="dimension-categorization-hierarchy"></a>分析コード カテゴリ階層

**分析コードカテゴリ階層** タイプはレポート用に使用します。 コスト要素分析コードのみをサポートします。 このタイプを選択する場合は、次のルールが適用されます。

-  分析コード メンバーは、階層構造に複数回関連付けることができます。
-  コスト動作をリーフ ノードに割り当てることにより、さまざまなノードにコスト要素分析コード メンバーを追加できます。

### <a name="dimension-classification-hierarchy"></a>分析コード分類階層

**分析コード分類階層** タイプはルールの定義、およびレポート用に使用します。 コスト オブジェクト、コスト要素、および統計分析コードなどのすべての分析コードをサポートします。 このタイプを選択する場合は、分析コード メンバーは階層構造に 1 回のみ関連付けることができます。

## <a name="create-and-maintain-a-dimension-hierarchy"></a>分析コード階層の作成と管理

分析コード階層は、ノードとリーフ ノードのリレーションシップを持つツリー構造として作成されます。

-  ノードは 1:_n_ サブノードを持つことができます。
-  ノードはサブノードとそれに割り当てられたリーフ ノードの両方を持つことはできません。
-  リーフ ノードは、階層の最下位レベルでのみ割り当てることができます。

### <a name="example"></a>例

小規模の会社が次の組織構造を持っています。「財務」および「人事管理」は「管理」の下にある部署、また「組み立て」および「梱包業」は「生産」の下にある部署です。

![組織構造の例](./media/dimension-hierarchy-org.png)

コスト オブジェクト分析コードは、組織内のすべてのコスト センターを表します。

- 原価オブジェクト分析コード
    - コスト センター

すべてのコスト センターを表すコスト オブジェクト分析コードは以下のように設定できます。

| コスト センター | 説明 |
|--------------|-------------|
| CC001        | HR          |
| CC002        | 財務     |
| CC003        | 税申告         |
| CC007        | AR/AP       |
| CC005        | 組み立て    |
| CC006        | 梱包業   |

コスト要素分析コードは、組織内のすべてのコスト要素を表します。

- 原価要素分析コード
    - コスト要素

すべてのコスト要素を表すコスト要素分析コードは以下のように設定できます。

| コスト要素 | 説明 |
|---------------|-------------|
| 10001         | 電気 |
| 10010         | クリーニング    |
| 10011         | 暖房     |
| 40001         | COGS        |

組織のレポート要件を満たす分析コード階層は、以下のように設定できます。

**分析コード階層の詳細**

| 分析コード階層名 | 分析コード    | 分析コード階層タイプ名      | アクセス リスト階層 |
|--------------------------|--------------|------------------------------------|-----------------------|
| 組織             | コスト センター | 分析コード分類階層 | 無                    |

レポートの分析コード階層は、以下のように設定できます。

|                   | 分析コード メンバーの範囲   |                         |
|-------------------|---------------------------|-------------------------|
| **ノード**         | **移動元分析コード メンバー** | **移動先分析コード メンバー** |
| 組織      |                           |                         |
| &nbsp;&nbsp;管理者         |                           |                         |
|&nbsp;&nbsp;&nbsp;&nbsp;財務   | CC002                     | CC003                   |
|                   | CC007                     | CC007                   |
| &nbsp;&nbsp;&nbsp;&nbsp;HR        | CC001                     | CC001                   |
| &nbsp;&nbsp;生産    |                           |                         |
| &nbsp;&nbsp;&nbsp;&nbsp;梱包業 | CC005                     | CC005                   |
| &nbsp;&nbsp;&nbsp;&nbsp;組み立て  | CC006                     | CC006                   |

ポリシー要件を満たす分析コード階層は、以下のように設定できます。

**分析コード階層の詳細**

| 分析コード階層名 | 分析コード     | 分析コード階層タイプ名      |
|--------------------------|---------------|------------------------------------|
| 原価動作            | コスト要素 | 分析コード分類階層 |

ポリシーの分析コード階層は、以下のように設定できます。

|                   | 分析コード メンバーの範囲   |                         |
|-------------------|---------------------------|-------------------------|
| **ノード**         | **移動元分析コード メンバー** | **移動先分析コード メンバー** |
| 原価動作     |                           |                         |
| &nbsp;&nbsp;固定費    | 10001                     | 10011                   |
|&nbsp;&nbsp;変動費 | 40001                     | 40010                   |

> [!NOTE]
> **分析コード メンバーの範囲** で、ノードは 1:_n_ 分析コード メンバーの範囲を含めることができます。 分析コード メンバとしてまだ存在していない分析コード メンバー ID を挿入することができます。 この方法により、階層が今後弾力性のあるものになります。  

### <a name="copy-a-hierarchy"></a>階層のコピー

新しい分析コード階層の開始点として、現在の分析コード階層をコピーすることができます。 この方法は、前の分析コード階層を新しい分析コード階層と比較したい場合に役立ちます。

### <a name="rearrange-nodes-in-a-hierarchy"></a>階層内のノードの再配置

構造内の現在のレベル内でノードを上下に移動できます。 この方法で、**原価管理** ワークスペースのレポート用のノードの順序を並べ替えることができます。

ターゲット ノードを選択して、ノードを階層内の新しい場所に移動します。 ノードを移動する 2 つの方法があります。

- **下へ移動** – 階層内の現在の位置から選択したノードを移動し、選択したターゲット ノードの **下に** 挿入します。
- **後に移動** – 階層内の現在の位置から選択したノードを移動し、階層内のそのレベルの選択したターゲット ノードの **後に** 挿入します。

> [!NOTE] 
> Excel また Power BI では既定で英数字の並べ替え順序を使用しているため、それらのツールにデータをエクスポートする場合はノードの順序は維持されません。 手動で順序を並べ替える必要があります。

## <a name="define-dimension-hierarchies-for-reporting"></a>レポートの分析コード階層の定義

分析コード階層はレポートにとって重要です。 それによって個々の組織に適合する特定の構造を定義することができます。 分析コード階層のノード レベルでなされる集約により、組織のどのレベルの利害関係者でも任意のレベルのデータを参照することができます。

分析コード階層は、次のレポート ツールで使用できます。 この方法は、レポート構造の一貫性を保証するのに役立ちます。

- **原価管理** ワークスペース (クライアント):

    - コンフィギュレーションによる管理。

- **原価管理** ワークスペース (モバイル アプリケーション):

    - コンフィギュレーションによる管理。

- Excel

    - エクスポート定義ごとの特定の分析コード階層を選択するためのオプションを提供します。

        - 1 つのコスト要素分析コード階層 (必須)
        - 1 つのコスト オブジェクト分析コード階層 (オプション)
        - 1 つの統計分析コード階層 (オプション)

- Power BI:

    - すべての分析コード階層を使用できます。
    
Excel または Power BI を使用してレポートを作成する場合は、分析コード階層の最初の 15 レベルのみがエクスポートされます。 この制限があるのは、Excel も Power BI も固定スキーマを必要とするためです。 階層に 15 より多いレベルがある場合は、追加のレベルはエクスポートされません。 正規化テーブルには、階層内の各分析コード メンバーのレコードが含まれています。 そのため、自動化集約が行われます。 この動作は、階層内の使用可能な 15 のレベルのいずれの残高も正しいことを保証するのに役立ちます。

次の例では、レポート構造における分析コード階層の例を示します。

| コスト オブジェクト分析コード階層 - レベル 1 | コスト オブジェクト分析コード階層 - レベル 2 | コスト オブジェクト分析コード階層 - レベル 3 | コスト オブジェクト分析コード階層 - レベル 4 | コスト オブジェクト分析コード階層 - レベル 15 |
|-------------------------------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|--------------------------------------------|
| 組織                              | 管理者                                     | 財務                                   | CC002                                     |                                            |
| 組織                              | 管理者                                     | 財務                                   | CC003                                     |                                            |
| 組織                              | 管理者                                     | 財務                                   | CC007                                     |                                            |
| 組織                              | 管理者                                     | HR                                        | CC001                                     |                                            |
| 組織                              | 生産                                | 梱包業                                 | CC005                                     |                                            |
| 組織                              | 生産                                | 組み立て                                  | CC006                                     |                                            |

### <a name="update-the-dimension-hierarchies-that-are-used-for-reporting"></a>レポートのために使用される分析コード階層の更新 

時間と共に、前述のレポート作成ツールで使用されている分析コード階層を更新する必要があります。 分析コード階層を更新するには、クライアントを更新します。

- **原価管理** ワークスペース (クライアント)
- **原価管理** ワークスペース (モバイル アプリケーション)

分析コード階層の更新は、事前キャッシュしたジョブで 24 時間ごとに取得します。 エクスポートしたデータが更新された後は、次のツールで更新済の分析コード階層が使用可能です。

- Excel
- Power BI

> [!NOTE] 
> 分析コード階層キャッシュの更新を手動で開始するため、更新する必要のある分析コード階層用に Excel への新しいエクスポートを作成できます。

## <a name="define-dimension-hierarchies-for-cost-policies"></a>コスト ポリシーの分析コード階層の定義

原価会計は、詳細なルールを定義している複数のポリシーで構成されます。 次のポリシーのために 1 つまたは複数の分析コード階層を定義する必要があります。

- 原価動作
- 原価配分
- 原価配賦
- 原価ロールアップ

分析コード階層によりルールが作成しやすくなります。 すべての分析コード メンバーのルールを作成しなくてよいように、分析コード階層レベルが提供する分析コード メンバーの集約を利用できます。 重複するルールがある場合、間接費の計算時にシステムが考慮する特定のルールを定義する必要があります。

### <a name="example-define-a-cost-behavior-policy"></a>例: コスト動作ポリシーを定義する

以下のように、新しいコスト動作ポリシーが作成され、適切な分析コード階層がポリシーに割り当てられます。

**コスト動作ポリシー**

| ポリシー名   | 原価要素分析コード階層 | 原価オブジェクト分析コード階層 | 会計通貨 |
|---------------|----------------------------------|---------------------------------|---------------------|
| 原価動作 | 原価動作                    | 組織                    | USD                 |

**ルール**

| 原価要素分析コード階層ノード | 原価オブジェクト分析コード階層ノード | 固定割合 | 固定金額 | 発効日 | 失効日 |
|---------------------------------------|--------------------------------------|------------------|--------------|------------|----------|
| 固定費                            | 組織                         | 100.00           | 0.00         | 1/1/2017   | 許可しない    |
| 10001                                 | 組織                         | 0.00             | 150.00       | 1/1/2017   | 許可しない    |
| 10001 (\*)                             | 財務                              |                  | 50.00        | 1/1/2017   | 許可しない    |
| コスト動作や変動費 (\*\*)   | 組織                         | 0.00             | 0.00         | 1/1/2017   | 許可しない    |

\* 変動費ノードは必要ありません。 コストが固定費に分類されていない場合は、変動費になります。

\*\* コスト要素メンバー 10001 と財務階層レベル (CC002、CC003、CC007) の下で集約されるすべてのコスト オブジェクト メンバーの組み合わせに対して詳細なルールが作成されます。

前述のルールは分析コード階層が提供する柔軟性を示します。 高レベルのルールを定義することで、メンテナンスを最小限に抑えることができます。 特定の業務目標に適合する詳細なルールを定義することができます。

ルール内で使用する分析コード階層が更新される場合、システムが自動的に更新を進めます。

ルール内の粒度のレベルが必要なくなった場合、そのルールを失効にできます。

たとえば、財務コスト オブジェクトの分析コード階層ノードの特定のコスト動作ルールが必要でなくなりました。 この場合は、**ルールを失効にする** をクリックしてルールを失効させます。

| 原価要素分析コード階層ノード | 原価オブジェクト分析コード階層ノード | 固定割合 | 固定金額 | 発効日 | 失効日  |
|---------------------------------------|--------------------------------------|------------------|--------------|------------|-----------|
| 固定費                            | 組織                         | 100,00           | 0.00         | 1/1/2017   | 許可しない     |
| 10001                                 | 組織                         | 0.00             | 150,00       | 1/1/2017   | 許可しない     |
| 10001                                 | 財務                              |                  | 50,00        | 1/1/2017   | 20/1/2017 |
| コスト動作または変動費        | 組織                         | 0.00             | 0.00         | 1/1/2017   | 許可しない     |

2017 年 1 月 20 日以降に実行される間接費計算は、このルールを考慮しなくなります。

> [!NOTE] 
> **発効日** および **失効日** フィールドは日付と時刻に対して有効です。 同じ日にルールの失効と新しい間接費の計算を実行できます。

## <a name="define-dimension-hierarchies-for-security-setup"></a>セキュリティ設定の分析コード階層の定義

原価会計のデータは、レポート単位を担当するすべてのマネージャーに使用可能にする必要があります。 原価会計用語では、レポート単位は、コスト オブジェクトまたは一連のコスト オブジェクトとして表されます。

すべてのマネージャーは、収益や利益幅といった機密性の高いビジネス データにアクセスできるようになる可能性があります。 そのため、マネージャーが自分に関連のあるデータのみを参照するよう、セキュリティを設定することが重要です。 データ セキュリティを管理するために、分析コード階層を定義します。

- 分析コード階層の使用は、分析コード階層参照で選択されている分析コード値がコスト オブジェクト分析コードである場合にのみ適用されます。
- アクセス リスト階層内のコスト オブジェクト分析コードごとに 1 つの分析コード階層のみを有効にできます。

**分析コード階層の詳細**

| 分析コード階層名 | 分析コード    | 分析コード階層タイプ名      | アクセス リスト階層 |
|--------------------------|--------------|------------------------------------|-----------------------|
| 組織             | コスト センター | 分析コード分類階層 | **有**               |

新しい **ユーザー** クイック タブは階層デザイナーで利用可能です。 ここでは、階層内の各ノードに 1 つまたは複数のユーザー ID を挿入できます。

|                 | ユーザー            | 分析コード メンバーの範囲   |                         |
|-----------------|------------------|---------------------------|-------------------------|
| **ノード**       | **ユーザー ID**      | **移動元分析コード メンバー** | **移動先分析コード メンバー** |
| 組織    | ベンジャミン、クレア |                           |                         |
| &nbsp;&nbsp;管理者         | 4 月            |                           |                         |
| &nbsp;&nbsp;&nbsp;&nbsp;財務   | アリシア           | CC002                     | CC003                   |
|                 |                  | CC007                     | CC007                   |
| &nbsp;&nbsp;&nbsp;&nbsp;HR        | アーニー            | CC001                     | CC001                   |
| &nbsp;&nbsp;生産    | デビッド            |                           |                         |
| &nbsp;&nbsp;&nbsp;&nbsp;梱包業 | エレン            | CC005                     | CC005                   |
| &nbsp;&nbsp;&nbsp;&nbsp;組み立て  | クリス            | CC006                     | CC006                   |

> [!NOTE] 
> 原価計算のすべてのエントリを表示できるように、原価経理担当者は階層の最上部に割り当てられる必要があります。

アクセス リスト階層とそのセキュリティ設定を有効にするには、**原価会計** > **設定** > **パラメーター** > **一般** に移動します。 **コスト オブジェクト分析コード メンバーに対する表示アクセスの有効化** パラメーターを選択します。

アクセス リスト階層の設定は、次の領域に表示されるデータを制御するために使用されます。

- **原価管理** ワークスペース (クライアント):

    - シナリオをドリルスルーするために使用されるフォーム内のデータ

- **原価管理** ワークスペース (モバイル アプリケーション):

    - カードの残高

- Power BI:

    - Power BI ビジュアル化に表示されるデータ
    - Dynamics 365 Finance クライアントに埋め込まれた Power BI ビジュアル化データ

> [!NOTE] 
> - アクセス リスト階層が Power BI のデータに影響を及ぼす前に、アクセス リスト階層と Power BI の行レベルのセキュリティがペアリングされる必要があります。 詳細については、「[原価会計コンテンツ パックのセキュリティ設定](../../dev-itpro/analytics/setup-security-cost-accounting-content-pack.md)」を参照してください。
> - アクセス リスト階層は、Excel へのデータのエクスポートの保護には役立ちません。 したがって、そのレポート ツールは、データの表示に完全なアクセス権を持つ必要があるコスト経理担当者およびマネージャーのみが使用します。
